<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Simple Image Editor</title>
        <link rel="stylesheet" type="text/css" href="./main.css">
        <link rel="stylesheet" type="text/css" href="./pintura/pintura.css" />
        
    </head>
    <body data-module="ScrollTracker" class="page-landing" data-scroll="1" data-scroll-progress="0">
        <main>
            <div class="hero">

                <div class="content-gutter content-limit">
            
                    <div class="hero-intro">
                        <h1>A powerful Image Editor</h1>
            <!-- <p>Set image requirements and help customers get better pictures. Crop, rotate, resize, filter, adjust colors, and much more…</p> -->
            
                        <p>
                            <div class="inline-editor" style="width: 800px; height: 700px; padding-left: 80px"></div>
                        </p>
                    </div>
                </div>
            
            </div>
        
        
        </main>
        
        <script type="module">
            import {
                // editor
                appendEditor,
                createDefaultImageReader,
                createDefaultImageWriter,
                createDefaultShapePreprocessor,
                locale_en_gb,

                // plugins
                setPlugins,
                plugin_crop,
                plugin_crop_locale_en_gb,
                plugin_filter,
                plugin_filter_defaults,
                plugin_filter_locale_en_gb,
                plugin_finetune,
                plugin_finetune_defaults,
                plugin_finetune_locale_en_gb,
                plugin_annotate,
                plugin_annotate_locale_en_gb,
                markup_editor_defaults,
                markup_editor_locale_en_gb,
                plugin_frame,
                plugin_frame_defaults,
                plugin_frame_locale_en_gb,
            } from './pintura/pintura.js';

            setPlugins(
                plugin_crop,
                plugin_filter,
                plugin_finetune,
                plugin_frame,
                // plugin_annotate,
            );

            // inline
            {
                const editor = appendEditor('.inline-editor', {
                    src: './sample.jfif',
                    // This will set a square crop aspect ratio
                    imageCropAspectRatio: 3 / 2,
                    // Offer different crop options
                    cropSelectPresetFilter: 'landscape',
                    cropSelectPresetOptions: [
                        [undefined, 'Custom'],
                        [1, 'Square'],

                        // shown when cropSelectPresetFilter is set to 'landscape'
                        [3 / 2, '3:2'],
                        [4 / 3, '4:3'],
                        [5 / 4, '5:4'],
                        [7 / 5, '7:5'],
                        [14 / 11, '14:11'],
                        [16 / 9, '16:9'],
                        [1.4142 / 1, 'ISO（1.4142 : 1）'],

                        // shown when cropSelectPresetFilter is set to 'portrait'
                        [2 / 3, '2:3'],
                        [3 / 4, '3:4'],
                        [4 / 5, '4:5'],
                        [5 / 7, '5:7'],
                        [11 / 14, '11:14'],
                        [1 / 1.4142, 'ISO（1 : 1.4142）'],
                    ],

                    cropEnableRotationInput: true,
                    cropEnableButtonRotateLeft: true,
                    // cropEnableButtonFlipHorizontal: false,
                    cropEnableZoomInput: true,
                    cropImageSelectionCornerStyle: 'hook',
                    cropEnableSelectPreset: true,
                    cropEnableInfoIndicator: true,
                    hasCropSelectPresetOptions: true,
                    imageReader: createDefaultImageReader(),
                    imageWriter: createDefaultImageWriter(),
                    shapePreprocessor: createDefaultShapePreprocessor(),
                    enableBrowseImage: true,                    
                    ...plugin_filter_defaults,
                    ...plugin_frame_defaults,
                    ...plugin_finetune_defaults,
                    ...markup_editor_defaults,
                    locale: {
                        ...locale_en_gb,
                        ...plugin_crop_locale_en_gb,
                        ...plugin_finetune_locale_en_gb,
                        ...plugin_filter_locale_en_gb,
                        ...plugin_annotate_locale_en_gb,
                        ...plugin_frame_locale_en_gb,
                        ...markup_editor_locale_en_gb,
                    },
                });

                const downloadFile = (file) => {
                    // Create a hidden link and set the URL using createObjectURL
                    const link = document.createElement('a');
                    link.style.display = 'none';
                    link.href = URL.createObjectURL(file);
                    link.download = file.name;

                    // We need to add the link to the DOM for "click()" to work
                    document.body.appendChild(link);
                    link.click();

                    // To make this work on Firefox we need to wait a short moment before clean up
                    setTimeout(() => {
                        URL.revokeObjectURL(link.href);
                        link.parentNode.removeChild(link);
                    }, 0);
                };

                editor.on('load', (res) => console.log('inline result', res));

                editor.on('process', (res) => {
                    downloadFile(res.dest);
                        // var resultUrl = URL.createObjectURL(res.dest);
                        // document
                        //     .querySelector('.inline-result')
                        //     .setAttribute('src', resultUrl)
                    }
                );
            }

        </script>
    </body>
</html>
