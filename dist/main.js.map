{"version":3,"file":"main.js","mappings":"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,CACX,EACAzgB,EAAE6uB,GACGA,GAAWjJ,GAAO8/B,GAClBqU,GAAWA,EAAU/5D,IACrBg6D,GAAWA,EAAUh6D,IACP3R,EAAI,KAAK,MAC3Bu3D,GAAU,EACVpkC,GAAQqkC,EACT,EAEF,CAEA,MAGM49B,GAA+B,EAE/B6B,GAAa,gBAGbzB,GAAmB,GAGzB,SAAS0B,GAAWx/B,EAAQn2B,EAASo2B,GACpC,IAAIw/B,EACAC,EACAC,EACA3lE,EACA4lE,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAz2B,EACA4C,EACA8zB,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACA9gC,EACA+gC,EACA54F,EACA64F,EACAC,EACAC,EACAC,EACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACArxB,GACAsxB,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACArQ,GACAC,GACAqQ,GACAlQ,GACAmQ,GACAC,GAEAC,GAIAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACA/uB,GACAgvB,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GAEAC,GAIAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACArT,GACAsT,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAtT,GACAuT,GACA/T,GACAgU,GACAC,GACAhU,GACAiU,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GAxFHC,GAA6B9uE,GAiC7B+uE,GAAwB/uE,GAwDzBmB,GAAoB2jC,EAAQtD,IAAsBsL,GAAW/H,EAAa,IAAKuoC,GAAwBxgC,KACvGhI,EAAOzjC,GAAGC,WAAWx3B,MAAK,IAAMglG,OAChChqC,EAAOzjC,GAAGC,WAAWx3B,MAAK,IAAMilG,OAChC,MAAMC,GAAax+E,KACb8Y,GAAWvB,KACjB,IAAMhnB,MAAOouD,IAAsBxgC,GAC7B0gC,OAAQ4/B,IAA2BtgE,GACrC,OAAEW,IAAWX,GACb,OAAE+sC,IAAuB/sC,GACzB,GAAEz9B,IAAmBy9B,GACrB,KAAEugE,IAAqBvgE,GACvB,MAAEwgE,IAAsBxgE,GACxB,WAAEygE,GAAa,QAAWzgE,GAC1B,SAAEk0B,IAAW,GAAUl0B,GACvB,OAAEtpB,IAAuBspB,GACzB,eAAE0gE,IAAiB,GAAU1gE,GAC7B,WAAE2gE,IAAa,GAAU3gE,GACzB,mBAAE4gE,GAAqB,KAAS5gE,GAChC,kBAAE6gE,GAAoB,GAAM7gE,GAC5B,qBAAE8gE,GAAuB,IAAO9gE,GAChC,WAAE+gE,GAAa,KAAMtkG,QAAQC,SAAQ,KAAUsjC,GAC/C,iBAAEghE,GAAmB,KAAMvkG,QAAQC,SAAQ,KAAUsjC,GACrD,iBAAEihE,GAAmBz6F,GAAgBw5B,GACrC,kBAAEkhE,GAAoB16F,GAAgBw5B,GACtC,2BAAEmhE,GAA6B36F,GAAgBw5B,GAC/C,mBAAEohE,IAAqB,GAASphE,GAChC,mBAAEqhE,IAAqB,GAASrhE,GAChC,sBAAEshE,IAAwB,GAASthE,GACnC,cAAEuhE,IAAgB,GAASvhE,GAC3B,YAAEwhE,IAAc,GAASxhE,GACzB,kBAAEyhE,IAAoB,GAAUzhE,GAChC,gBAAE0hE,IAAkB,GAAS1hE,GAC7B,iBAAE2hE,IAAmB,GAAU3hE,GAC/B,kBAAE4hE,IAAoB,GAAU5hE,GAChC,wBAAE6hE,IAAwC7hE,GAC1C,2BAAE8hE,IAA2C9hE,GAC7C,0BAAE+hE,GAA4B,QAAW/hE,GACzC,gCAAEgiE,GAAkC,QAAWhiE,GAC/C,8BAAEiiE,GAAgC,UAAajiE,GAC/C,gCAAEkiE,GAAkC,OAAUliE,GAC9C,sCAAEmiE,GAAwC,UAAaniE,GACvD,oCAAEoiE,GAAsC,UAAapiE,GACrD,sBAAEqiE,GAAwB,MAASriE,GACnC,uBAAEsiE,IAAuCtiE,GACzC,2BAAEuiE,IAA2CviE,GAC7C,6BAAEwiE,IAA6CxiE,GAC/C,kCAAEyiE,IAAkDziE,GACpD,4BAAE0iE,IAA8B,GAAU1iE,GAC1C,UAAEqrD,IAAY,GAASrrD,GACvB,WAAEsrD,IAAa,GAAStrD,GACxB,mBAAEurD,IAAqB,GAASvrD,GAChC,gBAAEwrD,IAAgCxrD,GAClC,eAAEyrD,IAA+BzrD,GACjC,kBAAE2iE,IAAoB,GAAU3iE,GAChC,eAAE0rD,IAA+B1rD,GACjC,qBAAE2rD,IAAqC3rD,GACvC,kBAAE4iE,GAAoB,CAAC,IAAM,GAAK,EAAG,KAAM,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,KAAQ5iE,GACvE,eAAE6rD,GAAiB,KAAS7rD,GAC5B,iBAAE8rD,GAAmB,IAAQ9rD,GAC7B,sBAAE+rD,GAAwB,GAAM/rD,GAChC,UAAEksD,GAAY,MAASlsD,GACvB,gBAAE6iE,IAAgC7iE,GAClC,cAAE8iE,GAAgB,CAAE1nG,KAAM,IAAM,EAAGgE,MAAOM,GAAKA,IAAQsgC,GACvD,iBAAE+iE,IAAiC/iE,GACnC,cAAEgjE,GAAgB,CAAC,GAAMhjE,EAC7B,MAAMje,GAAMs+E,GAAWt+E,IACjBkhF,GAAkB,CAAC,EACzB,IAAI,KAAE5tE,IAAS2K,EAGf,MAAMkjE,GAAgB9iE,GAAS,CAAC,GAEhC5N,GAAoB2jC,EAAQ+sC,IAAe9pG,GAASg9D,EAAa,GAAIwlC,GAAiBxiG,KACtFkgC,GAAW,gBAAiB4pE,IAC5B,MAAMC,GAA4B/iE,GAAS0gE,IAC3CtuE,GAAoB2jC,EAAQgtC,IAA2B/pG,GAASg9D,EAAa,IAAK+oC,GAA6B/lG,KAC/GkgC,GAAW,uBAAwB6pE,IACnC,IAAIC,GAA8B,GAGlC,MAAMC,GAAqBjxC,KAE3B5/B,GAAoB2jC,EAAQktC,IAAoBjqG,GAASg9D,EAAa,GAAI8pC,GAAsB9mG,KAGhG,MAAMkqG,GAAmB7jD,MAA8B,KAEjD8jD,GAAiBl4F,GAAWi4F,GAAkBA,IAC9CrgG,GAAoB6vC,KAEpB0wD,GAAWxmG,GAAOP,QAAQC,QAAQwiG,IAAgBA,GAAaliG,EAAK,CAAE4Z,aAAc,WAAYvT,MAAKwT,IAE1G,IAAoB,IAAhBA,EAAuB,OAG3B,MAAM,QAAEnB,EAAO,YAAEC,GAAgBkB,GAAe,CAAC,EAGjD,OAAOT,MAAMpZ,EAAK,CAAE0Y,UAASC,gBAAetS,MAAKxJ,IAChD,GAAmB,MAAfA,EAAI6c,OAAgB,KAAM,GAAG7c,EAAI6c,WAAW7c,EAAI4pG,cACpD,OAAO5pG,EAAIyG,MAAM,IACf+C,MAAK/C,GAAQgoF,GAAkBhoF,EAAMwiG,GAAe7/F,MAAoBI,MAAKtE,GAAamqF,GAAiBnqF,EAAW+2F,IAAkB,IAG5I,IAAI,uBAAE4N,GAAyB1mG,IAAOkD,EAASlD,GAE9CwmG,GAASxmG,GACRkU,GAAUlU,GAEV,IAAIP,SAAQC,GAAWA,EAAQO,EAAkBD,MAEjD+Y,GAAO/Y,IAAQqU,GAAOrU,GACpBsrF,GAAkBtrF,EAAK8lG,GAAe7/F,IAAmBI,MAAKtE,GAAamqF,GAAiBnqF,EAAW+2F,UACvGn6F,IAAcqkC,EAElB,MAAM2jE,GApsGgB,MACnB,IAAIjyD,EACAztC,EACJ,MAAM2/F,EAAclc,GAAgBnqE,QAAO,CAACC,EAAMC,KAC9CD,EAAKC,GArBC,SAAUpc,EAAKnD,EAAKo8B,GAC9B,IAAIgG,EAAc,GAClB,MAAO,CACHpiC,IA4BC9E,IAEQ6K,GAELA,EAAM08B,OAAOljB,GAAMvf,IAAI9E,EAAM,EA/BjCkhC,OAkCClW,IACQngB,GAELA,EAAM08B,OAAOljB,GAAM6c,OAAOlW,EAAG,EApCjCy/E,QAAUzqG,IACNknC,EAAY9kC,SAAS4oB,GAAOA,EAAGhrB,IAAO,EAE1C64B,UAAY7N,IACRkc,EAAYnlC,KAAKipB,GAcrB,CAACA,IAEG,IAAKngB,EACD,OAAOmgB,IACGngB,EAAM08B,OAAOljB,GAAMwU,UAAU7N,EAC3CgO,EAAO,EAlBP/wB,CAAI+iB,GACG,KACHkc,EAAcA,EAAYtrB,QAAQwtB,GAASA,IAASpe,GAAG,GAIvE,CAKqB0/E,GAsBNtmF,IACR,CAAC,GAkBJ,MAAO,CACH8c,OAlBYypE,IAOZ,GANA9/F,EAAQ8/F,EACJryD,IAEAA,EAAOl2C,SAAS42B,GAAUA,MAC1Bsf,OAAS/1C,IAERooG,EAID,OAFAH,EAAkB,KAAEC,aAAQloG,QAC5BioG,EAAuB,UAAEC,aAAQloG,GAGrC+1C,EAASg2C,GAAgBh5E,KAAKkY,GAASm9E,EAASpjE,OAAO/Z,GAAMqL,WAAW74B,IACpEwqG,EAAYh9E,GAAMi9E,QAAQzqG,EAAM,KACjC,EAIHunC,OAAQijE,EACRvvE,QAAS,KACDqd,GACAA,EAAOl2C,SAAS42B,GAAUA,KAAQ,EAE7C,EAgpGe4xE,IACX9gG,KAAM+gG,GAAW9pG,KAAMme,GAAW4f,SAAUgsE,GAAepvF,KAAMqvF,GAAWn8D,UAAWpb,GAAgBokB,aAAcozD,GAAmBj6D,gBAAiB0H,GAAsBzJ,iBAAkBmH,GAAuBl3B,KAAMgsF,GAAen8D,YAAauH,GAAkBtH,YAAam8D,GAAkBC,UAAWC,GAAgBn8D,WAAYo8D,GAAqB74D,oBAAqB84D,GAA0BzsF,SAAUstB,GAAe0C,cAAeY,GAAoBwK,WAAYsxD,GAAiB16F,MAAO26F,GAAY16F,MAAO26F,GAAY36E,gBAAiB4rB,GAAsB3rB,gBAAiB26E,GAAyBtlF,YAAaulF,GAAkBtlF,kBAAmBulF,GAAwBtlF,MAAOulF,GAAYnlF,SAAUolF,GAAetlF,MAAOulF,GAAY33D,WAAY43D,GAAiB73D,WAAY83D,GAAiB/3D,UAAWg4D,GAAgBpuD,MAAOquD,GAAYl4D,MAAO8D,IAAewyD,GAAWhjE,OACh4BnO,GAAoB2jC,EAAQ8tC,IAAW7qG,GAASg9D,EAAa,IAAKgnC,GAAahkG,KAC/Eo5B,GAAoB2jC,EAAQ79C,IAAWlf,GAASg9D,EAAa,IAAKykC,GAAazhG,KAC/Eo5B,GAAoB2jC,EAAQ+tC,IAAe9qG,GAASg9D,EAAa,IAAK2mC,GAAiB3jG,KACvFo5B,GAAoB2jC,EAAQguC,IAAW/qG,GAASg9D,EAAa,IAAK6oC,GAAa7lG,KAC/Eo5B,GAAoB2jC,EAAQvpC,IAAgBxzB,GAASg9D,EAAa,IAAKimC,GAAkBjjG,KACzFo5B,GAAoB2jC,EAAQiuC,IAAmBhrG,GAASg9D,EAAa,IAAKgmC,GAAqBhjG,KAC/Fo5B,GAAoB2jC,EAAQtkB,IAAsBz4C,GAASg9D,EAAa,IAAKwoC,GAAwBxlG,KACrGo5B,GAAoB2jC,EAAQ5mB,IAAuBn2C,GAASg9D,EAAa,GAAImpC,GAAyBnmG,KACtGo5B,GAAoB2jC,EAAQkuC,IAAejrG,GAASg9D,EAAa,IAAK6nC,GAAiB7kG,KACvFo5B,GAAoB2jC,EAAQ5wB,IAAensC,GAASg9D,EAAa,IAAK4kC,GAAiB5hG,KACvFo5B,GAAoB2jC,EAAQyuC,IAAYxrG,GAASg9D,EAAa,IAAK2kC,GAAc3hG,KACjFo5B,GAAoB2jC,EAAQ0uC,IAAYzrG,GAASg9D,EAAa,IAAK0kC,GAAc1hG,KACjFo5B,GAAoB2jC,EAAQrgB,IAAsB18C,GAASg9D,EAAa,IAAKmlC,GAAwBniG,KACrGo5B,GAAoB2jC,EAAQivC,IAAiBhsG,GAASg9D,EAAa,GAAIwkC,GAAmBxhG,KAC1Fo5B,GAAoB2jC,EAAQkvC,IAAiBjsG,GAASg9D,EAAa,GAAI6kC,GAAmB7hG,KAC1Fo5B,GAAoB2jC,EAAQmvC,IAAgBlsG,GAASg9D,EAAa,IAAKklC,GAAkBliG,KACzFo5B,GAAoB2jC,EAAQovC,IAAYnsG,GAASg9D,EAAa,GAAIukC,GAAcvhG,KAChFo5B,GAAoB2jC,EAAQhlB,IAAY/3C,GAASg9D,EAAa,IAAK8mC,GAAc9jG,KAEjF,MAAMosG,GAAuB,CAACxoG,EAAKixC,EAAOw3D,EAAc,IAAM,IAAIhpG,SAAQ,CAACC,EAASwE,KAElF,GAAImnF,GAAYrrF,GAwBf,YAvBuB6iD,KA58DQ/gD,OAAOoE,IACtC,MAAMqY,QAIiBjb,EAJgB4C,EAIP,IAAIzG,SAASC,IAC7C,MAAM+kB,EAAS,IAAIC,WACnBD,EAAO3kB,OAAS,IAAMJ,EAAQ+kB,EAAOE,QACrCF,EAAOikF,kBAAkBplG,EAAK,KAHR,IAACA,EAFvB,MAOkC,EAAC9G,GAAQgmD,QAAQ,MAAS,CAAC,KAK7D,IAAI1lD,EAAS,EAIb,GAFAA,GAAU,EANU,aAOFN,EAAKmB,UAAUb,GAE7B,OAAO,EAGX,GAFAA,GAAU,EATU,aAULN,EAAKmB,UAAUb,GAE1B,OAAO,EACX,IAAI6rG,GAAU,EAEV16F,GAAK,EACT,IAAK,IAAIjQ,EAAIlB,EAAQkB,EAAIwkD,EAAOxkD,IAO5B,GALK2qG,GAjBW,aAiBAnsG,EAAKmB,UAAUK,KAC3B2qG,GAAU,EACV3qG,GAAK,GAGJ2qG,GArBW,IAwBFnsG,EAAKO,SAASiB,GAEF,CACtBiQ,EAAIjQ,EACJ,KACJ,CAGJ,GAAIiQ,EAAI,EACJ,OAAO,EAEX,MAAM26F,EAAIpsG,EAAKmB,UAAUsQ,EAAI,IACvB46F,EAAIrsG,EAAKmB,UAAUsQ,EAAI,IACvB66F,EAAItsG,EAAKmB,UAAUsQ,EAAI,IACvB86F,EAAIvsG,EAAKmB,UAAUsQ,EAAI,IAC7B,OAAU,QAAN26F,GAA0B,aAANC,EACb,GACI,aAANC,GAA0B,aAANC,EAClB,IACI,aAANH,GAA0B,QAANC,EAClB,IACJ,CAAC,EAxDDG,CADM,IAAIzrG,SAASghB,GACgB,EA08DxC0qF,CAA6BjpG,GAC7BP,QAAQC,WAEK2G,MAAK4U,IAEnB,MAAMuwE,EAAQlsF,SAASqB,cAAc,SAErC6qF,EAAM0d,aAAc,EACpB1d,EAAM30E,QAAU,OAEhB20E,EAAMG,aAAe,KACpBH,EAAMnwC,QAAQpgC,SAAWA,EACzBuwE,EAAMI,YAAcJ,EAAMtwD,UAAY+mE,GAztFvB,GAAE/xF,EAAKjS,KAASiS,EAAoB,IAAbjS,EAAMiS,GAytFOi5F,CAAelH,GAAW,IAAM,IACnFviG,EAAQ8rF,EAAM,EAGfA,EAAMxrF,IAAMyE,IAAIC,gBAAgB1E,GAGhCwrF,EAAMK,MAAM,IAMd,IACIud,EADAl4D,GAAY,EAEhBD,EAAME,OAAS,IAAMD,GAAY,EACjC,MAAM3Z,EAAM3uB,KAAK2uB,MAEjBmvE,GAAuB1mG,GAAKqG,MAAKtE,IAChC,MAAMkf,EAAOrY,KAAK2uB,MAAQA,EAC1BryB,aAAakkG,GAEbA,EAAQ1jG,YACP,KACKwrC,GACJxxC,EAAQqC,EAAU,GAEnB0B,KAAKxF,IAAI,EAAGwqG,EAAcxnF,GAC1B,IACCna,MAAM5C,EAAO,KAGZ,OAAE2tC,GAAM,kBAAE6D,GAAiB,eAAEC,GAAc,YAAEh8B,GAAW,oBAAEi8B,IAAwBjS,GAMxF,IAAI0lE,GALJ7zE,GAAoB2jC,EAAQtnB,IAAQz1C,GAASg9D,EAAa,IAAK4oC,GAAU5lG,KACzEo5B,GAAoB2jC,EAAQzjB,IAAmBt5C,GAASg9D,EAAa,IAAK2oC,GAAqB3lG,KAC/Fo5B,GAAoB2jC,EAAQxjB,IAAgBv5C,GAASg9D,EAAa,IAAKolC,GAAkBpiG,KACzFo5B,GAAoB2jC,EAAQx/C,IAAavd,GAASg9D,EAAa,GAAI8oC,GAAe9lG,KAClFo5B,GAAoB2jC,EAAQvjB,IAAqBx5C,GAASg9D,EAAa,GAAIqpC,GAAuBrmG,KAGlG,MAAMktG,GAA2B5lE,GAAQokE,IAAyB,CAACyB,EAAqBroG,KAClFqoG,IAGDF,KACHA,GAA+Bl4D,SAC/Bk4D,QAAiC1qG,GAIlC0qG,GAAiC,CAAEl4D,OAAQnyC,GAE3CwpG,GAAqBe,EAAqBF,IAAgChjG,KAAKnF,GAAK4F,OAAMC,QAExF,IAIGyiG,GAAkBr1D,GAAWlf,WAAUob,GAASgzD,GAAWl+E,IAAI,SAAUkrB,KAGzEo5D,GAAoBrmE,KAK1B9G,GAAW,KAFK8G,GAAS,CAAC,IAK1B,MAAM+qD,GAAW/qD,IAAS,GAE1B5N,GAAoB2jC,EAAQg1B,IAAU/xF,GAASg9D,EAAa,GAAIupC,GAAYvmG,KAC5E,MAAMgyF,GAAYhrD,IAAS,GAC3B5N,GAAoB2jC,EAAQi1B,IAAWhyF,GAASg9D,EAAa,GAAIypC,GAAazmG,KAC9E,MAAMstG,GAAsBtmE,IAAS,GACrC5N,GAAoB2jC,EAAQuwC,IAAqBttG,GAASg9D,EAAa,IAAKyoC,GAAuBzlG,KACnG,MAAMutG,GAAuBvmE,IAAS,GACtC5N,GAAoB2jC,EAAQwwC,IAAsBvtG,GAASg9D,EAAa,GAAI0pC,GAAwB1mG,KAGpG,MAAMwtG,GAAyBxmE,KAE/B5N,GAAoB2jC,EAAQywC,IAAwBxtG,GAASg9D,EAAa,GAAI2pC,GAA0B3mG,KAGxG,MAAMytG,GAAqBzmE,KAE3B5N,GAAoB2jC,EAAQ0wC,IAAoBztG,GAASg9D,EAAa,IAAK0oC,GAAsB1lG,KAGjG,MAAM0tG,GAAuBpmE,GAAQ,CAACmmE,GAAoBH,KAAsB,SAA+B/qG,IAAxBmjG,GACrFA,GACAD,KAEFrsE,GAAoB2jC,EAAQ2wC,IAAsB1tG,GAASg9D,EAAa,GAAIwpC,GAAwBxmG,KAMpG,MAAM2tG,GAAsB3mE,GAAS,CAAC,EAAG,EAAG,IAE5C5N,GAAoB2jC,EAAQ4wC,IAAqB3tG,GAASg9D,EAAa,GAAIonC,GAAuBpkG,KAClG,MAAM4tG,GAAsB5mE,GAAS,CAAC,EAAG,EAAG,IAC5C5N,GAAoB2jC,EAAQ6wC,IAAqB5tG,GAASg9D,EAAa,IAAKglC,GAAuBhiG,KACnG,MAAM6tG,GAAgB70C,GAAO,CAAC,EAAG,EAAG,IACpC5/B,GAAoB2jC,EAAQ8wC,IAAe7tG,GAASg9D,EAAa,IAAK+kC,GAAiB/hG,KACvF,MAAM8tG,GAAqB9mE,KAGrBkzB,GAAalzB,KAEnB5N,GAAoB2jC,EAAQ7C,IAAYl6D,GAASg9D,EAAa,GAAIslC,GAActiG,KAGhF,MAAMkzF,GAAWlsD,KAEjB5N,GAAoB2jC,EAAQm2B,IAAUlzF,GAASg9D,EAAa,IAAKy0B,GAAYzxF,KAG7E,MAcM+tG,GAAU/mE,GAAS1zB,MACzB8lB,GAAoB2jC,EAAQgxC,IAAS/tG,GAASg9D,EAAa,GAAI+mC,GAAW/jG,KAC1E,MAAMguG,GAAWhnE,GAAS1zB,MAC1B8lB,GAAoB2jC,EAAQixC,IAAUhuG,GAASg9D,EAAa,GAAIkpC,GAAYlmG,KAC5E,MAAMiuG,GAAWjnE,KACjB5N,GAAoB2jC,EAAQkxC,IAAUjuG,GAASg9D,EAAa,IAAKskC,GAAYthG,KAK7E,MAAMkuG,GAAkBrf,GAAgB,mBAAmBrzE,GAAWA,EAAU,eAAiB,mBAEjG4d,GAAoB2jC,EAAQmxC,IAAiBluG,GAASg9D,EAAa,IAAKymC,GAAmBzjG,KAC3F,MAAMmuG,GAAmBtf,GAAgB,kBAAkBrzE,GAAWA,EAAU,gBAAkB,qBAClG4d,GAAoB2jC,EAAQoxC,IAAkBnuG,GAASg9D,EAAa,IAAKwmC,GAAoBxjG,KAK7F,MAAMouG,GAAsBpnE,IAAS,GAE/BisD,GAAgBjsD,IAAS,GAC/B5N,GAAoB2jC,EAAQk2B,IAAejzF,GAASg9D,EAAa,IAAK40B,GAAiB5xF,KAEvF,MAAMquG,GAAwBtnE,QAASxkC,GAAWuC,IACjD,MAAMwpG,EAAWt1C,GAAO,GAMlBtwC,EAAO,CAACuqE,GAAcp6D,WAJZ74B,IACfsuG,EAASxpG,IAAI9E,EAAQ,EAAI,EAAE,IAGoBsuG,EAASz1E,UAAU/zB,IAGnE,MAAO,IAAM4jB,EAAKtmB,SAAQ42B,GAASA,KAAQ,IAG5CI,GAAoB2jC,EAAQsxC,IAAuBruG,GAASg9D,EAAa,IAAK8kC,GAAyB9hG,KAGvG,MAAMuuG,GAAgBvnE,KAEtB5N,GAAoB2jC,EAAQwxC,IAAevuG,GAASg9D,EAAa,IAAKqmC,GAAiBrjG,KACvF,MAAMw9D,GAAax2B,KACnB5N,GAAoB2jC,EAAQS,IAAYx9D,GAASg9D,EAAa,GAAI0W,GAAc1zE,KAGhFkgC,GAAW,aAAcs9B,IAEzB,MAAMgxC,GAAuBxnE,GAASsgE,IACtCluE,GAAoB2jC,EAAQyxC,IAAsBxuG,GAASg9D,EAAa,IAAK4mC,GAAwB5jG,KAKrG,MAAMyuG,GAAgBznE,IAAS,GAE/B5N,GAAoB2jC,EAAQ0xC,IAAezuG,GAASg9D,EAAa,IAAKioC,GAAiBjlG,KACvFkgC,GAAW,gBAAiBuuE,IAC5B,MAAMC,GAAwB1nE,KAC9B5N,GAAoB2jC,EAAQ2xC,IAAuB1uG,GAASg9D,EAAa,IAAKkoC,GAAyBllG,KACvG,MAAM2uG,GAAsB3nE,KAC5B5N,GAAoB2jC,EAAQ4xC,IAAqB3uG,GAASg9D,EAAa,IAAK+nC,GAAuB/kG,KAEnG,MAAM4uG,GAA4B7nE,QAASxkC,GAAWuC,IACrD,MAAMwpG,EAAWtnE,QAASzkC,GAcpBmmB,EAAO,CAEZuiF,GAAcpyE,WAdA,KACd,IAAKgsE,GAAgB,OAGrB,GAAII,GAAgB,OAAOqJ,EAASxpG,IAAIsO,GAAYyxF,KAGpD,MAAMgK,EAAc91B,GAAc8rB,GAAgBE,GAjjBrB,EAijBqE2C,IAElG4G,EAASxpG,IAAI+pG,EAAY,IAOzBP,EAASz1E,UAAU/zB,IAGpB,MAAO,IAAM4jB,EAAKtmB,SAAQ42B,GAASA,KAAQ,IAGtCw6D,GAAqBxsD,KAC3B5N,GAAoB2jC,EAAQy2B,IAAoBxzF,GAASg9D,EAAa,IAAKu0B,GAAsBvxF,KACjG,MAAM8uG,GAA6B9nE,KACnC5N,GAAoB2jC,EAAQ+xC,IAA4B9uG,GAASg9D,EAAa,IAAKgoC,GAA8BhlG,KACjH,MAAM+uG,GAA2B/nE,QAASzkC,GAC1C62B,GAAoB2jC,EAAQgyC,IAA0B/uG,GAASg9D,EAAa,IAAKqoC,GAA4BrlG,KAC7G,MAAMgvG,GAA2BhoE,GAASn4B,KAC1CuqB,GAAoB2jC,EAAQiyC,IAA0BhvG,GAASg9D,EAAa,IAAKsoC,GAA4BtlG,KAE7G,MAAMivG,GAAiB,CAACC,EAAkB/C,KACzC,IAAKA,IAAe+C,EAAkB,MAAO,CAAE3+E,IAAK,EAAGD,MAAO,EAAGE,OAAQ,EAAGH,KAAM,GAClF,MAAMkC,EAASI,GAAwBw5E,EAAY+C,EAAkBn4E,GAC/DtE,EAASH,GAAaC,EAAQ28E,GAEpC,MAAO,CACN3+E,IAAKlpB,KAAKsG,IAAI8kB,EAAOlC,KACrBD,MAAOjpB,KAAKsG,IAAI8kB,EAAOnC,OACvBE,OAAQnpB,KAAKsG,IAAI8kB,EAAOjC,QACxBH,KAAMhpB,KAAKsG,IAAI8kB,EAAOpC,MACtB,EAII8+E,GAAgBnoE,GAAS,CAAC,GAE1BooE,GAAgB9nE,GAAQ,CAAC2mE,GAAUF,GAASC,GAAUmB,KAAgB,EAAE7N,EAAWyC,EAAUmC,EAAWmJ,GAAiBvqG,KAC9H,IAAKw8F,EAAW,OAAOx8F,OAAIvC,GAC3B,IAAI+sG,EAAc,EAGW,IAAzB9R,EAAcl9F,QAAiBk8F,IAClC8S,EAAcpJ,EAAUl3F,EAAIk3F,EAAUhiG,QAGvCY,EAAImP,GAAWqtF,EAAUvyF,EAAIg1F,EAASh1F,EAAGuyF,EAAUtyF,EAAI+0F,EAAS/0F,EAAIsgG,EAAahO,EAAUr9F,MAAOq9F,EAAUp9F,QAAQ,IAGrH,IAAIqrG,GAAmB,CAAEl/E,KAAM,EAAGC,MAAO,EAAGC,IAAK,EAAGC,OAAQ,GAC5D,MAAMg/E,GAAmBxoE,IAAS,GAE5ByoE,GAAenoE,GAAQ,CAACkoE,GAAkBrD,GAAYiD,GAAenc,KAAgB,EAAEyc,EAAmBnO,EAAaoO,EAAgB/d,GAAiB9sF,KAC7J,IAAK6qG,EACJ,OAAO7qG,EAAI,CAAEurB,KAAM,EAAGC,MAAO,EAAGC,IAAK,EAAGC,OAAQ,IAIjD,IAAKk/E,EAAmB,OAGxB,MAAM3uG,EAAOsG,KAAKyM,IAAI67F,EAAe1rG,MAAO0rG,EAAezrG,QAGrD0rG,EAAkBX,GAAe,CAAEhrG,MAAOlD,EAAMmD,OAAQnD,GAAQwgG,GAGlEjzF,EAAaihG,GAAiBh/E,IAAK,KAAOjiB,EAAashG,EAAgBr/E,IAAK,IAAMjiB,EAAaihG,GAAiB/+E,OAAQ,KAAOliB,EAAashG,EAAgBp/E,OAAQ,IAAMliB,EAAaihG,GAAiBj/E,MAAO,KAAOhiB,EAAashG,EAAgBt/E,MAAO,IAAMhiB,EAAaihG,GAAiBl/E,KAAM,KAAO/hB,EAAashG,EAAgBv/E,KAAM,KAElVk/E,GAAmBK,EACnB9qG,EAAI8qG,GAAgB,IAGrBx2E,GAAoB2jC,EAAQ0yC,IAAczvG,GAASg9D,EAAa,IAAK0nC,GAAgB1kG,KAErF,MAAM6vG,GAAcvoE,GAAQ,CAACkoE,GAAkBC,KAAe,EAAEC,EAAmBhL,GAAgB5/F,KAClG,IAAK4qG,EAAmB,OAAO5qG,GAAI,GACnCA,EAAIL,OAAOijB,OAAOg9E,GAAez8E,MAAKjoB,GAASA,EAAQ,IAAG,IAG3Do5B,GAAoB2jC,EAAQ8yC,IAAa7vG,GAASg9D,EAAa,IAAK2nC,GAAe3kG,KAEnF,MAAM8vG,GAAiBxoE,GAAQ,CAACkoE,GAAkBvB,GAAU4B,GAAaJ,KAAe,EAAEC,EAAmBpO,EAAWqD,EAAcD,GAAgB5/F,KACrJ,GAAKw8F,EACL,OAAKoO,GAAsB/K,OAC3B7/F,EAAImP,GAAWqtF,EAAUvyF,EAAI21F,EAAcr0E,KAAMixE,EAAUtyF,EAAI01F,EAAcn0E,IAAK+wE,EAAUr9F,MAAQygG,EAAcr0E,KAAOq0E,EAAcp0E,MAAOgxE,EAAUp9F,OAASwgG,EAAcn0E,IAAMm0E,EAAcl0E,SADnJ1rB,EAAI,IAAKw8F,GACkJ,IAGtMnO,GAAY7rD,GAAQ,CAAC8nE,GAAeS,GAAaJ,KAAe,EAAEE,EAAgBhL,EAAcD,GAAgB5/F,IAChH6qG,EACAhL,OACL7/F,EAAImP,GAAW07F,EAAe5gG,EAAI21F,EAAcr0E,KAAMs/E,EAAe3gG,EAAI01F,EAAcn0E,IAAKo/E,EAAe1rG,MAAQygG,EAAcr0E,KAAOq0E,EAAcp0E,MAAOq/E,EAAezrG,OAASwgG,EAAcn0E,IAAMm0E,EAAcl0E,SAD7L1rB,EAAI6qG,GADF7qG,OAAIvC,KAKjC62B,GAAoB2jC,EAAQo2B,IAAWnzF,GAASg9D,EAAa,IAAKw0B,GAAaxxF,KAE/E,MAAM+vG,GAAqBzoE,GAAQ,CAACmnE,GAAevvF,GAAWitB,KAAgB,EAAE84D,EAAgBxD,EAAYG,GAAiB98F,KAE5H,IAAKmgG,IAAmBxD,EAAY,OAAO38F,OAAIvC,GAE/C,MAAM8Q,EAAOE,GAAmBkuF,GAEhC38F,EAD2BsQ,GAAW/B,EAAMuuF,GACrB,IAGlBoO,GAAoB1oE,GAAQ,CAACyoE,KAAqB,EAAEE,GAAsBnrG,KAC/E,IAAKmrG,EAAqB,OAAOnrG,OAAIvC,GACrC,MAAM2tG,EAAcz8F,GAAqBw8F,GACzCnrG,EAAIuR,GAAoB65F,GAAa,IAGtC92E,GAAoB2jC,EAAQizC,IAAmBhwG,GAASg9D,EAAa,IAAK8nC,GAAqB9kG,KAE/F,MAAMozF,GAAc9rD,GAAQ,CAAC6rD,GAAW8X,GAAe+E,GAAmBxB,KAAuB,EAAEhd,EAAYqT,EAAgBC,EAAoBlB,GAAwB9+F,KAI1K,IAAK0sF,IAAeqT,GAHmBK,IAA0BH,GAGE,OAGnE,MAAM,MAAE9gG,EAAK,OAAEC,GAAW4gG,GAAsBD,EAG1Cl2F,EAAStH,KAAKyM,IAAI09E,EAAWvtF,MAAQA,EAAOutF,EAAWttF,OAASA,GAKtEY,EAFc8+F,EAAwBj1F,EAAStH,KAAKyM,IAAI,EAAGnF,GAEjD,IAGXyqB,GAAoB2jC,EAAQq2B,IAAapzF,GAASg9D,EAAa,IAAK60B,GAAe7xF,KAEnF,MAAMmwG,GAA2B7oE,GAAQ,CAACmnE,GAAevvF,GAAWitB,GAAegnD,GAAW8a,GAAU7a,KAAc,EACpH6R,EACAxD,EACAG,EACApQ,EACA8P,EACAzP,GACE/sF,KAEH,KAAKmgG,GAAmBzT,GAAe8P,GAAcG,GAAY,OAAO38F,OAAIvC,GAE5E,MAAM8Q,EAAOE,GAAmBkuF,GAC1B2O,EAAa/5F,GAAoBhC,GAAYhB,EAAMw+E,IACnDwe,EAAe76F,GAAeg8E,EAAY4e,GAChDA,EAAWrhG,EAAIshG,EAAathG,EAC5BqhG,EAAWphG,EAAIqhG,EAAarhG,EAE5BlK,EAD2BsQ,GAAWg7F,EAAYxO,GAC3B,IAGxB1hE,GAAW,2BAA4BiwE,IAKvC,MAAM7c,GAAqBtsD,QAASzkC,GAEpC62B,GAAoB2jC,EAAQu2B,IAAoBtzF,GAASg9D,EAAa,IAAKs0B,GAAsBtxF,KAEjG,MAAMuzF,GAA+BjsD,GAAQ,CAAC2jE,GAAe9X,KAAY,EAAE0R,EAAgBrT,MAE1F,GAAKA,GAAeqT,EAEpB,OAAOx9F,KAAKyM,IAAI09E,EAAWvtF,MAAQ4gG,EAAe5gG,MAAOutF,EAAWttF,OAAS2gG,EAAe3gG,OAAO,IAG9F2uF,GAA2BvrD,GAAQ,CAAC2jE,GAAezX,KAAqB,EAAEqR,EAAgBtT,KAE1FsT,GAAmBtT,EAEjBlqF,KAAKyM,IAAI+wF,EAAe5gG,MAAQstF,EAAoBttF,MAAO4gG,EAAe3gG,OAASqtF,EAAoBrtF,QAF1D,IAKrDk1B,GAAoB2jC,EAAQ81B,IAA0B7yF,GAASg9D,EAAa,GAAI6pC,GAA4B7mG,KAE5G,MAAMswG,GAAuBhpE,GAAQ,CAACgsD,GAAoBT,KAA2B,EAAEvB,EAAqBuV,KAEtGvV,GAAwBuV,EAGtBA,EAA4BvV,EAH4B,IAMhEl4D,GAAoB2jC,EAAQuzC,IAAsBtwG,GAASg9D,EAAa,IAAKooC,GAAwBplG,KACrG,MAAMqzF,GAAoBrsD,GAASn4B,KACnCuqB,GAAoB2jC,EAAQs2B,IAAmBrzF,GAASg9D,EAAa,IAAKq0B,GAAqBrxF,KAE/F,MAAMyzF,GAA4BzsD,GAAS,CAC1Cr4B,OAAQy2F,GACR5uC,YAAa66B,KAGRkf,GAAiC,KACtC9c,GAA0B3uF,IAAI,CAC7B6J,YAAQpM,EACRi0D,YAAa3nD,KACZ,EAGG2hG,GAAiCzpE,QAASxkC,GAAWuC,IAC1D,MAAMwpG,EAAWt1C,QAAOz2D,EAAW,CAAEgM,UAAW,OAE1CkiG,EAAuC,IAA1B/wB,KACjBrsE,GAAQ0C,GAAU1C,EAAMhM,KAAK4Y,OAC7B7S,EAEIsjG,EAAU,KACf,IAAKnf,GAAqB,OAC1B,MAAMof,EAAgB/e,KAAmByR,GAGzC,GAAI4B,GAAgB,CACnB,MAAM5xF,EAAOD,GAAYm+E,IAGzB,OAFAp9E,GAAgBd,EAAMiyF,IACtBnxF,GAAgBd,EAAMm+E,IACf8c,EAASxpG,IAAIuO,EAAM,CAAEgmD,KAAMs3C,GACnC,CAEA,MAAM9B,EAAc91B,GAAcwY,GAAqB8T,GAA2B5K,GAA+BiN,IAG7GmH,EAAY5qG,MAAQ,IACvB4qG,EAAY5qG,MAAQ,EACpB4qG,EAAY9/F,EAAIwiF,GAAoBxiF,GAGjC8/F,EAAY3qG,OAAS,IACxB2qG,EAAY3qG,OAAS,EACrB2qG,EAAY7/F,EAAIuiF,GAAoBviF,GAIrCmF,GAAgB06F,EAAard,IAG7Br9E,GAAgB06F,EAAaxd,IAG7Bh9E,GAAYw6F,EAAazJ,KAGxBuL,GAAiBF,EAAW5B,GAE7BP,EAASxpG,IAAI+pG,EAAa,CAAEx1C,KAAMs3C,GAAgB,EAG7CjoF,EAAO,CAEZyqE,GAAUt6D,UAAU63E,GAEpBld,GAAmB36D,UAAU63E,GAE7BJ,GAAqBz3E,UAAU63E,GAC/Brd,GAAkBx6D,UAAU63E,GAE5BvE,GAAWtzE,UAAU63E,GAErBpC,EAASz1E,UAAU/zB,IAIpB,MAAO,IAAM4jB,EAAKtmB,SAAQ42B,GAASA,KAAQ,IAG5CI,GAAoB2jC,EAAQyzC,IAAgCxwG,GAASg9D,EAAa,GAAIynC,GAAkCzkG,KACxH,MAAM4wG,GAAiC5pE,GAAS,GAChD5N,GAAoB2jC,EAAQ6zC,IAAgC5wG,GAASg9D,EAAa,IAAK4nC,GAAkC5kG,KAEzH,MAAM6wG,GAA0B,KAC/B,IAAKhM,KAAmBrT,GAAY,OACpC,IAAIn+E,EAAOwB,GAAazB,GAAYyxF,IAAiBhT,IAAgB,GACrE,MAAMrmD,EAAah2B,GAAeg8E,GAAY38E,GAAazB,GAAY0xF,IAAqBjT,KAC5F19E,GAAgBd,EAAMm4B,GACtB,MAAMslE,EAAuBxP,GAAUr9F,MAAQoP,EAAKpP,MAC9C8sG,EAAwBzP,GAAUp9F,OAASmP,EAAKnP,OAChDyK,EAAStH,KAAKyM,IAAI,EAAGg9F,EAAsBC,GACjDH,GAA+B9rG,IAAI6J,GACnC0F,GAAYhB,EAAM1E,GAxmpBK,EAACqiG,EAAWx+E,KACjC,MAAOpe,EAAGvC,EAAG7B,EAAG6G,GAAKf,GAAak7F,GAC9B58F,EAAIoe,EAAWxjB,IACfgiG,EAAUhiG,EAAI3H,KAAKxF,IAAI2wB,EAAWxjB,EAAGgiG,EAAUhiG,IAC/C6C,EAAI2gB,EAAWvuB,QACf+sG,EAAUjiG,EAAIyjB,EAAWvuB,MAAQ+sG,EAAU/sG,OAC3C+L,EAAIwiB,EAAWtuB,SACf8sG,EAAUhiG,EAAIwjB,EAAWtuB,OAAS8sG,EAAU9sG,QAC5C2S,EAAI2b,EAAWzjB,IACfiiG,EAAUjiG,EAAI1H,KAAKxF,IAAI2wB,EAAWzjB,EAAGiiG,EAAUjiG,GACnC,EAimpBlBkiG,CAAiB59F,EAAM,IAAKiuF,GAAWvyF,EAAG,EAAGC,EAAG,IAEhDwkF,GAAmB1uF,IAAIuO,EAAK,EAIvBu/E,GAA6BtrD,GAAQ,CAAC6rD,GAAWC,GAAa6X,GAAe/rF,KAAY,EAAEsyE,EAAYK,EAAcgT,EAAgBpD,GAAa38F,KAElJ0sF,IAAeqT,GAAmBpD,IAEvC38F,EAAIosG,GAA8B1f,EAAYK,GAAgB,EAAGgT,GAAkBpD,GAAY,IAGhGroE,GAAoB2jC,EAAQ61B,IAA4B5yF,GAASg9D,EAAa,GAAI4pC,GAA8B5mG,KAEhH,MAAMkxG,GAAgC,CAAC/d,EAAWC,EAAahkD,IAC/BA,EAASnrC,OAASkvF,EAAUlvF,OAASmrC,EAASlrC,QAAUivF,EAAUjvF,OAKhGsR,GAAe29E,EAAWt+E,GAAazB,GAAYg8B,GAAWgkD,IAE9Dv9E,GAAgBs9E,EAAWl+E,GAAgBm6B,IAI7C,IAAI+hE,GAEAC,GAEJ,MAAMC,GAA8BC,IAEnC,GAAI9U,GAAwB2U,IAAiBn8F,GAAUm8F,GAAeG,IAAqBF,KAAmBvf,GAAc,OAG5H,GAAIoT,GAAgB,OAAO4L,KAG3BM,GAAgBG,EAEhBF,GAAiBvf,GACjB,MAAM0f,EAA6BL,GAA8BI,EAAkBzf,GAAcgT,IAAkBpD,IACnHjO,GAAmB1uF,IAAIysG,EAA2B,EAInD,IAAIC,IAA2B,EAE/B,MAAMC,GAAmBre,GAAYv6D,WAAUlqB,KAE1C6iG,SAAuCjvG,IAAXoM,GAAyBk2F,KAEzDwM,GAA4B7f,IAC5BggB,IAA2B,EAAI,IAI1BE,GAAiBve,GAAUt6D,WAAUxlB,IAErCA,QAAyB9Q,IAAjBsvF,IAA+BgT,IAE5CwM,GAA4Bh+F,EAAK,IAG5Bs+F,GAAqBlD,GAAc51E,WAAU+4E,KAC7CA,GAAYpgB,IAAY6f,GAA4B7f,GAAW,IAMrE,IAAIqgB,GAEJ,MAAMC,GAAkChD,GAA2Bj2E,WAAUxlB,IAC5E,IAAKA,EAGJ,OAFAw+F,QAA6BtvG,OAC7Bs4B,GAAgB6zE,GAAuBxJ,QAAyB3iG,EAAW2iG,IAI5E2M,GAA6B1M,GAC7B,MAAM4M,EAAgB3+F,GAAYyxF,IAClC6J,GAAsB5pG,IAAIitG,EAAc,IAInCC,GAA0Bxe,GAAmB36D,WAAUxlB,IAE5D,IAAKA,IAAS2xF,GAA6B,OAE3C,MAAMtkG,GAlypBc+M,EAkypBQ2F,GAAYC,GAlypBjBrD,EAkypBwBg1F,GAjypB7Cv3F,EAAEsB,GAAKiB,EAAEjB,EACTtB,EAAEuB,GAAKgB,EAAEhB,EACTvB,EAAExJ,OAAS+L,EAAE/L,MACbwJ,EAAEvJ,QAAU8L,EAAE9L,OACPuJ,GALU,IAACA,EAAGuC,EAmypBvB+E,GAAWrU,EAAQmxG,IACnB,MAAM5yF,EA7xpBQ,EAACxR,EAAGuC,KAChBvC,EAAEsB,GAAKiB,EAAEjB,EACTtB,EAAEuB,GAAKgB,EAAEhB,EACTvB,EAAExJ,OAAS+L,EAAE/L,MACbwJ,EAAEvJ,QAAU8L,EAAE9L,OACPuJ,GAwxpBIwkG,CAAQ7+F,GAAY8xF,IAAyBxkG,GAC1DuqG,GAAcnmG,IAAIma,EAAK,IAqClBizF,GAAqBjH,GAAcpyE,WAlCRxlB,IAGhC,IAAKA,IAASk+E,GAAqB,OAGnC,GAAI0T,GAIH,YAFKD,IAA6B6L,MAMnC,GAAIjf,IAAkBoT,IAA+BD,GAAsB,OAG3E,MAAMoN,EAAgCl9F,GAAgBs8E,IAEhD/+C,EAAsBv9B,GAAgB5B,GAC5C,GAAI/E,EAAa6jG,EAA+B,KAAO7jG,EAAakkC,EAAqB,GAAI,OAI7F,MAAM,MAAEvuC,EAAK,OAAEC,GAAW4gG,IAAsBD,GAE1Cl2F,EAAStH,KAAKyM,IAAI09E,GAAWvtF,MAAQA,EAAOutF,GAAWttF,OAASA,GAChEnD,EAAOkR,GAAWoB,EAAKpP,MAAQ0K,EAAQ0E,EAAKnP,OAASyK,GACrDgB,EAAgD,IAA1C4hF,GAAoBttF,MAAQlD,EAAKkD,OACvC2L,EAAkD,IAA5C2hF,GAAoBrtF,OAASnD,EAAKmD,QACxCg+D,EAAgBjuD,GAAWs9E,GAAoBxiF,EAAIY,EAAI4hF,GAAoBviF,EAAIY,EAAI7O,EAAKkD,MAAOlD,EAAKmD,QAC1GsvF,GAAmB1uF,IAAIo9D,EAAc,IAKhCkwC,GAAc9qE,GAAQ,CAAC8rD,GAAa6X,GAAezX,GAAoBib,KAAgB,EAAE5c,EAAcgT,EAAgBtT,EAAqB0T,GAAiBngG,KAElK,IAAK+sF,IAAiBgT,IAAmBtT,EAAqB,OAG9D,GAAI0T,EAAgB,OAAOngG,EAAI8/F,IAE/B,MAAMkM,EAAuBvf,EAAoBttF,MAAQ4gG,EAAe5gG,MAClE8sG,EAAwBxf,EAAoBrtF,OAAS2gG,EAAe3gG,OAE1EY,EADeuC,KAAKxF,IAAIivG,EAAsBC,GAAyBlf,EAC5D,IAGNwgB,GAAqB/qE,GAAQ,CAAC8rD,GAAagf,KAAc,EAAEvgB,EAAcygB,GAAextG,KAExFwtG,GAGLxtG,EADe+sF,EAAeygB,EACnB,IAGZl5E,GAAoB2jC,EAAQs1C,IAAoBryG,GAASg9D,EAAa,IAAKmoC,GAAsBnlG,KAKjG,IAAIuyG,GAAkB,CAAEliF,KAAM,EAAGC,MAAO,EAAGC,IAAK,EAAGC,OAAQ,GAE3D,MAAMgiF,GAAclrE,GAAQ,CAAC6kE,GAAY3Y,KAAqB,EAAE+N,EAAahQ,GAAsBzsF,KAElG,IAAKysF,EAAqB,OAAOzsF,EAAIytG,IAGrC,MAAME,EAAiBxD,GAAe1d,EAAqBgQ,GAGvDjzF,EAAaikG,GAAgBhiF,IAAK,KAAOjiB,EAAamkG,EAAeliF,IAAK,IAAMjiB,EAAaikG,GAAgB/hF,OAAQ,KAAOliB,EAAamkG,EAAejiF,OAAQ,IAAMliB,EAAaikG,GAAgBjiF,MAAO,KAAOhiB,EAAamkG,EAAeniF,MAAO,IAAMhiB,EAAaikG,GAAgBliF,KAAM,KAAO/hB,EAAamkG,EAAepiF,KAAM,KAE1UkiF,GAAkBE,EAClB3tG,EAAI2tG,GAAe,IAGdC,GAAiBprE,GAAQ,CAACkrE,KAAc,EAAEG,GAAe7tG,KAC9DA,EAAIL,OAAOijB,OAAOirF,GAAc1qF,MAAKjoB,GAASA,EAAQ,IAAG,IAGpD4yG,GAAsB55C,GAAO,KAAO,CACzCL,UAAW,IACXC,QAAS,GACTrqD,UAAW,OAGNskG,GAAevrE,GACpB,CACCumE,GACAF,GACAiF,GACApC,GACAF,GACAnE,GACAuG,GACAF,GACA3C,KAED,EACE9N,EACAqC,EACA0O,EACAC,EACAC,EACAzR,EACA0R,EACAN,EACAhO,GACE7/F,KACH,IAAKiuG,GAASvW,EAAsB,OAAO13F,EAAI,IAC/C,IAAI,EAAEiK,EAAC,EAAEC,EAAC,MAAE/K,EAAK,OAAEC,GAAW6uG,EAC9BhkG,GAAK,GACLC,GAAK,GACL/K,GAAS,GACTC,GAAU,GACV,MAAMquB,EAAS,GAEf,GAAIgvE,EAAa,CAEhB,GAAI0R,EAAiB,CACpB,IAAI,KAAE5iF,EAAI,MAAEC,EAAK,IAAEC,EAAG,OAAEC,GAAWmiF,EACnCtiF,GAAQ2iF,EACR1iF,GAAS0iF,EACTziF,GAAOyiF,EACPxiF,GAAUwiF,EACV,MACME,EADmB/iB,GAAYiU,GACC,CAAC,EAAG,EAAG,EAAG,MAAS,CAAC,EAAG,EAAG,EAAG,MAEnE7xE,EAAOxwB,KAAK,CACXgN,EAAGA,EAAIshB,EAAO,GACdrhB,EAAGA,EAAIuhB,EAAM,GACbtsB,MAAOA,EAAQosB,EAAOC,EAAQ,EAC9BpsB,OAAQA,EAASqsB,EAAMC,EAAS,EAChCG,YAAa,EACbC,YAAasiF,EACbljF,QAAS20E,EAAe,EAAI,IAE9B,CAGA,MAAMwO,EAAgBhjB,GAAY4R,GAEdR,GAAeA,EAAY6R,YAAcjjB,GAAYoR,EAAY6R,aAEhED,IACpB5gF,EAAOxwB,KAAK,CACXgN,EAAGA,EAAI,EACPC,EAAGA,EAAI,EACP/K,MAAOA,EAAQ,EACfC,OAAQA,EAAS,EACjBysB,YAAa,EACbC,YAAa,CAAC,EAAG,EAAG,EAAG,IACvBZ,QAAS8iF,IAGVvgF,EAAOxwB,KAAK,CACXgN,EAAGA,EAAI,EACPC,EAAGA,EAAI,EACP/K,MAAOA,EAAQ,EACfC,OAAQA,EAAS,EACjBysB,YAAa,EACbC,YAAa,CAAC,EAAG,EAAG,EAAG,IACvBZ,QAAS8iF,IAGZ,CAEAhuG,EAAI,IAEAytB,EAEH,CACCxjB,IACAC,IACA/K,QACAC,SACAysB,YAAa,EACbC,YAAamxE,EACb/xE,QAAS8iF,IAET,IAKEO,GAAqBrsE,GAAS,IAEpC5N,GAAoB2jC,EAAQs2C,IAAoBrzG,GAASg9D,EAAa,IAAKinC,GAAsBjkG,KAGjG,MAAMszG,GAAehsE,GAAQ,CAACurE,GAAcQ,KAAqB,EAAEE,EAAetP,GAAsBn/F,KACvGA,EAAI,IAAIyuG,KAAkBtP,GAAqB,IAGhD7qE,GAAoB2jC,EAAQu2C,IAActzG,GAASg9D,EAAa,GAAIspC,GAAgBtmG,KAKpF,MAAMwzG,GAAiBx6C,GAAO,EAAG,CAAEzqD,UAAW,OAE9C6qB,GAAoB2jC,EAAQy2C,IAAgBxzG,GAASg9D,EAAa,IAAKmnC,GAAkBnkG,KACzF,MAAMyzG,GAAkBz6C,KACxB5/B,GAAoB2jC,EAAQ02C,IAAiBzzG,GAASg9D,EAAa,IAAKunC,GAAmBvkG,KAC3F,MAAM0zG,GAAiB16C,KACvB5/B,GAAoB2jC,EAAQ22C,IAAgB1zG,GAASg9D,EAAa,IAAKsnC,GAAkBtkG,KACzF,MAAM2zG,GAAmB36C,KACzB5/B,GAAoB2jC,EAAQ42C,IAAkB3zG,GAASg9D,EAAa,IAAKqnC,GAAoBrkG,KAC7F,MAAM4zG,GAAoB56C,KAC1B5/B,GAAoB2jC,EAAQ62C,IAAmB5zG,GAASg9D,EAAa,IAAKknC,GAAqBlkG,KAK/F,MAAM6zG,GAA0B7sE,IAAS,GAEzC5N,GAAoB2jC,EAAQ82C,IAAyB7zG,GAASg9D,EAAa,IAAK+lC,GAA2B/iG,KAC3G,MAAM8zG,GAAqB9sE,KAE3B,IAAI+sE,GADJ36E,GAAoB2jC,EAAQ+2C,IAAoB9zG,GAASg9D,EAAa,IAAKkmC,GAAsBljG,KAGjG,MAAMg0G,GAAe1sE,GAAQ,CAACusE,GAAyBC,KAAqB,EAAE/Q,EAA0BG,GAAsBp+F,KAE7H,IAAKi+F,IAA6BG,EAEjC,YADAp+F,OAAIvC,GAWL,GANIwxG,KACHA,GAA8Bh/D,SAC9BioB,EAAa,IAAK+2C,QAAgCxxG,IAI/C0wB,GAASiwE,GAEZ,OAAOp+F,EAlkIQ,CAAChB,IACf,MAAM4pC,EAAQvpC,EAAE,SAAU,CAAEF,MAAOH,EAAOG,MAAOC,OAAQJ,EAAOI,SAEhE,OADAwpC,EAAM3pC,WAAW,MAAMmC,UAAUpC,EAAQ,EAAG,GACrC4pC,CAAK,EA+jIFumE,CAAY/Q,IAIxB,MAAMgR,EAA2BC,GAAa7zG,OAAS,EAAIozE,GAAc,IAAM,EAG/E1W,EAAa,IAAK+2C,GAAgC,CAAEh/D,OAAQnyC,IAE5DwpG,GAAqBlJ,EAAqB6Q,GAA+BG,GAA0BjqG,KAAKnF,GAAK4F,OAAMC,IAElHkwB,GAAgBrH,GAAgByvE,GAAgB55F,MAAQsB,EAAKs4F,GAAgB,IAG3EhvE,SAAQ,KAEV+oC,EAAa,IAAK+2C,QAAgCxxG,EAAU,GAC3D,IA/jCgCwkG,KAA8BA,GAA6BluE,GAAUm7E,IAAcjvC,GAAW/H,EAAa,IAAKilC,GAAgBl9B,KAmkCnK,IAAI,oBAAEqvC,IAAoCxtE,EAK1C,MAAMytE,GAAwBrtE,GAAS,CAAC,GAExC5N,GAAoB2jC,EAAQs3C,IAAuBr0G,GAASg9D,EAAa,IAAKsmC,GAAyBtjG,KACvG,MAAMk+D,GAAkBl3B,GAAS,IACjC5N,GAAoB2jC,EAAQmB,IAAiBl+D,GAASg9D,EAAa,GAAIopC,GAAmBpmG,KAG1F,MAOMs0G,GAAkBhtE,GACvB,CACC6rD,GACAD,GACAh0E,GACA0vF,GACApb,GACA6e,GACAlmE,GACAq/D,GACAC,GACA6E,GACAjd,GACA+a,KAED,EACE5c,EACAC,EACAgQ,EACA8S,EACAhjB,EACA4T,EACAvD,EACAD,EACAD,EACA0D,EACA/T,EACAmjB,GACE1vG,KACH,IAAK0sF,IAAeD,EAAqB,OACzC,MAAM+iB,EA7uesB,EAACnhB,EAAWD,EAAUh0E,EAAWkwB,EAAUokD,EAAoBX,EAA0B4hB,EAA+BC,EAAYvoE,EAAeq/D,EAAYC,KAC1L,KAAKtY,GAAcD,GAAah0E,GAAckwB,GAAaslE,GACvD,OAEJA,GAAc7hB,EACd,MAAM8hB,EAAWt+F,GAAoBjD,GAAY8/E,IAC3C0hB,EAAa1gG,GAAWygG,GACxBE,EAAc3gG,GAAWi/E,GACzB9mD,EAAY94B,GAAmB2L,GAC/BotB,EAAcp4B,GAAWm4B,GAEzByD,EAAe9C,GAAgB9tB,EAAWkwB,EAAUjD,GACpD2oE,EAAqB5gG,GAAW47B,GAChCilE,EAAmB5kG,GAAed,GAAYi9B,GAAcwoE,GAE5DE,EAAc7kG,GAAed,GAAYwlG,GAAcD,GAE7DG,EAAiBhmG,GAAKimG,EAAYjmG,EAClCgmG,EAAiB/lG,GAAKgmG,EAAYhmG,EAElC,MAAMynD,EAAcnnD,GAAaD,GAAY0lG,IAE7Ct+C,EAAY1nD,GAAKimG,EAAYjmG,EAC7B0nD,EAAYznD,GAAKgmG,EAAYhmG,EAE7B,MAAMimG,EAAuB/gG,GAAWC,GAAgBA,GAAgBf,GAAYogF,GAAqBihB,GAAgCthB,IACnI+hB,EAAuB/kG,GAAe8kG,EAAsBJ,GAElE,OADA3kG,GAAU6kG,EAAkBG,GACrB,CACH/nF,OAAQspC,EACRD,YAAau+C,EACbl2F,SAAU,CACN9P,EAAG08F,EAAapkG,KAAKgG,GAAK,EAC1B2B,EAAGw8F,EAAankG,KAAKgG,GAAK,EAC1Bw2C,EAAG1X,GAEPz9B,MAAOgmG,EACV,EAwsesBS,CAAyB3jB,EAAYC,EAAWgQ,EAAY8S,EAA4BhjB,EAAqB6T,EAAuB/T,EAAoB8T,EAAqBvD,EAAgBD,EAAaD,IACjO8S,GAAwBnX,EAA0BiX,GACnDxvG,EAAIwvG,EAAgB,IAItBl7E,GAAoB2jC,EAAQu3C,IAAiBt0G,GAASg9D,EAAa,IAAKumC,GAAmBvjG,KAE3F,MAAMo1G,GAAe9tE,GACpB,CACCqkE,GACAC,GACAC,GACAC,GACAC,KAED,EAAEsJ,EAAcC,EAAoBC,EAAQC,EAAWC,GAAS3wG,KAC/D,MAAMyyB,EAAgB89E,GAAgB5wG,OAAOoC,KAAKwuG,GAAc//F,KAAIrV,GAAQo1G,EAAap1G,KAAO2b,OAAO4gC,SAUvG13C,EARgB,CACfwhB,MAAOivF,QAAUhzG,EACjBmkB,SAAU8uF,QAAajzG,EACvBikB,MAAOivF,QAAUlzG,EACjB8jB,kBAAmBivF,QAAsB/yG,EACzC6jB,YAAamR,GAAiBA,EAAcj3B,QAAUg3B,GAAgCC,IAG3E,IAOd,IAAIm+E,GAEAC,GACJ,MAAMC,GA1iIkB,MAErB,IAAKv3F,KACD,OAAO,EAEX,MAAM7C,EAAUhC,UAAUC,UAAU5N,MAAM,4BAA8B,IACjE,CAAEgqG,EAAOC,GAASt6F,EAAQlG,KAAKhP,GAAM4yE,SAAS5yE,EAAG,KAAO,IAE/D,OAAOuvG,EAAQ,IAAiB,KAAVA,GAAgBC,GAAS,CAAE,EAkiIzBC,GACrBC,GAAMhvE,GAAS,CAAC,GACtB5N,GAAoB2jC,EAAQi5C,IAAKh2G,GAASg9D,EAAa,IAAKulC,GAAOviG,KACnE,MAAMi2G,GAAoBv2B,KAEpBzxD,GAAa8Y,GAASkvE,IAAmBnxG,IAC9C,MAAMoxG,EAAyB,IAAMpxG,EAAI46E,MACnCy2B,EAAqBx8C,WAAW,gBAAgBs8C,WAEtD,OADAE,EAAmBv8C,YAAYs8C,GACxB,IAAMC,EAAmBt8C,eAAeq8C,EAAuB,IAGvE98E,GAAoB2jC,EAAQ9uC,IAAYjuB,GAASg9D,EAAa,GAAIwnC,GAAcxkG,KAEhF,MAAMo2G,GA5iIa,EAACC,EAAUhiE,KAE3B,MAAM,IAAE1rB,EAAG,IAAEI,GAAQN,KAGfjM,EAAU,GACVrG,EAAQ6wB,GAAS,GACjBte,EAAO,GACP4tF,EAAa,IAAM5tF,EAAKtmB,SAAS4oB,GAAOA,EAAG,CAAE7U,MAAO+iB,GAAgB/iB,GAAQ7V,OAAQkc,EAAQlc,WAC5F81G,EAAU,CACRjgG,YACA,OAAO+iB,GAAgB/iB,EAC3B,EACIA,UAAMvU,GAENA,EAAI6xC,OAAO8iE,UAAU30G,GAAKA,EAAI,EAC9BA,EAAI4rC,GAAM5rC,EAAG,EAAG4a,EAAQlc,OAAS,GAEjC6V,EAAMrR,IAAIlD,GACVyyC,EAAS73B,EAAQ45F,EAAQjgG,QAEzBmgG,GACJ,EACIriE,YACA,OAAOz3B,EAAQA,EAAQlc,OAAS,EACpC,EACAA,OAAM,IACKkc,EAAQlc,OAEnBk2G,OACI,MAAMC,EAAWL,EAAQjgG,QAEzB,OADA4S,EAAI,OAAQ0tF,GACLA,CACX,EACAC,OACI,MAAMD,EAAWL,EAAQjgG,QAEzB,OADA4S,EAAI,OAAQqtF,EAAQjgG,OACbsgG,CACX,EACAE,SACIn6F,EAAQlc,OAAS,EACjB81G,EAAQjgG,MAAQ,EAChB4S,EAAI,SACR,EACA5mB,MAAM8xC,GAEEA,GACAI,EAAS,IACFgiE,OACApiE,IAGX,MAAM2iE,EAAWP,IACXQ,EAAYr6F,EAAQA,EAAQlc,OAAS,GAEvCqe,KAAKD,UAAUk4F,KAAcj4F,KAAKD,UAAUm4F,KAGhDr6F,EAAQlc,OAAS81G,EAAQjgG,MAAQ,EAEjCqG,EAAQza,KAAK60G,GAEbzgG,EAAMrR,IAAI0X,EAAQlc,OAAS,GAC3Bg2G,IACJ,EACAxxG,IAAImvC,EAAQ,CAAC,GAETz3B,EAAQlc,OAAS,EACjB81G,EAAQjgG,MAAQ,EAEhB,MAAM2gG,EAAmBnwG,MAAMC,QAAQqtC,GAAmBA,EAAV,CAACA,GAEjDz3B,EAAQza,QAAQ+0G,GAEhBV,EAAQjgG,MAAQqG,EAAQlc,OAAS,CACrC,EACA2H,IAAG,IACQ,IAAIuU,GAEfqc,UAAU7N,IACNtC,EAAK3mB,KAAKipB,GACVA,EAAG,CAAE7U,MAAOigG,EAAQjgG,MAAO7V,OAAQkc,EAAQlc,SACpC,IAAMooB,EAAKjN,OAAOiN,EAAKpN,QAAQ0P,GAAK,IAE/CmtB,GAAIxvB,GAER,OAAOytF,CAAO,EAs9HDW,EACf,IAEQjT,KAER7vD,IAECpZ,GAAgBkd,GAAY+rD,GAAc7vD,EAAO6vD,IAGjDiK,GAAQjpG,IAAIi/F,GAAS,IAhpCOiD,KAAyBA,GAAwBnuE,GAAUu9E,IAASrxC,GAAW/H,EAAa,IAAK6mC,GAAW9+B,KAspC1I,MAAMiyC,GAAyB,KAE9B,MAAMC,EAAW,CAAEloG,EAAG,EAAGC,EAAG,KAAMyyF,IAE5ByV,EAAenhG,GAAUF,GAAgBohG,EAAUnT,GAAY/yD,iBAAkB1pC,KAAK4Y,OAQtFk3F,EAAkBpP,GACvB,IAEIjE,GAEHjlF,SAAU,EACVI,KAAMi4F,GAKPpT,IAIKsT,EAA4B,CAACD,GAG/Bx4F,KAAKD,UAAUy4F,KAAqBx4F,KAAKD,UAAUolF,KACtDsT,EAA0Br1G,KAAK,IAAK+hG,KAIrCsS,GAAQtxG,IAAIsyG,EAA0B,EAGjCC,GAAsB7jF,GAAeqF,WAAUob,IAE/CA,GAGAA,EAAM/oC,UAGX8rG,IAAwB,IAGnBL,GAAS,IAAMhP,KAAa19F,MAAKqtG,GAAeA,GAAelB,GAAQO,WAKvEY,GAA2BvwE,IAAS,GAE1C5N,GAAoB2jC,EAAQw6C,IAA0Bv3G,GAASg9D,EAAa,IAAKylC,GAA4BziG,KAE7G,MAAMw3G,GAAe,KACpB70G,OAAO+P,MAAQlG,KAAK2uB,MAGpBN,GAAgB08E,GAA0B9U,IAA4B,EAAMA,IAE5EmF,KAAmB39F,MAAKwtG,IAEvB,IAAKA,EAEJ,YADA58E,GAAgB08E,GAA0B9U,IAA4B,EAAOA,IAK9E,IAAIzpE,EAEJA,EAAQ0+E,GAAc7+E,WAAU74B,IACjB,IAAVA,IAGJg5B,GAASA,IAGTuI,GAAS,gBAAe,GACvB,GACD,EAGGo2E,GAAyB3M,GAAkBnyE,WAAUob,IAC1D,IAAKA,EAAO,OACZpZ,GAAgB08E,GAA0B9U,IAA4B,EAAMA,IAC5E,MAAM,SAAEv3F,EAAQ,MAAE4wB,GAAUmY,GACxB/oC,GAAY4wB,IAAOjB,GAAgB08E,GAA0B9U,IAA4B,EAAOA,GAA0B,IAGzH0R,GAz2HS,MACZ,MAAM5sE,EAAS,GACTL,EAAc,GACd+M,EAAQ,GAQR2jE,EAAgB,KAClB1wE,EAAY9kC,SAASwF,GAAOA,EAAGqsC,IAAO,EAEpC4jE,EAAY/+E,IACdA,EAAME,MAAQF,EAAMD,WAAW74B,GAXZ,EAAC84B,EAAO94B,KAC3B,MAAMmW,EAAQoxB,EAAOjsB,QAAQwd,GACzB3iB,EAAQ,IAEZ89B,EAAM99B,GAASnW,EACf43G,IAAe,EAM0BE,CAAeh/E,EAAO94B,KAC/D43G,GAAe,EA+BnB,MAAO,CACCt3G,aACA,OAAOinC,EAAOjnC,MAClB,EACA6gC,MAzBU,KACVoG,EAAOnlC,SAAS02B,GAAUA,EAAME,UAChCuO,EAAOjnC,OAAS,EAChB2zC,EAAM3zC,OAAS,CAAC,EAuBhBy3G,QAlCaj/E,IACbyO,EAAOwwE,QAAQj/E,GACf++E,EAAS/+E,EAAM,EAiCf7wB,IAPSkO,GAAUoxB,EAAOpxB,GAQ1BpU,KAhCU+2B,IACVyO,EAAOxlC,KAAK+2B,GACZ++E,EAAS/+E,EAAM,EA+Bfzf,OAxBYyf,IACZA,EAAME,QACN,MAAM7iB,EAAQoxB,EAAOjsB,QAAQwd,GAC7ByO,EAAO9rB,OAAOtF,EAAO,GACrB89B,EAAMx4B,OAAOtF,EAAO,EAAE,EAqBtB/T,QAZawF,GAAO2/B,EAAOnlC,QAAQwF,GAanCgU,OAZYhU,GAAO2/B,EAAO3rB,OAAOhU,GAajCixB,UArBejxB,IACfs/B,EAAYnlC,KAAK6F,GACjBA,EAAGqsC,GACI,KACH/M,EAAYzrB,OAAOyrB,EAAY5rB,QAAQ1T,GAAK,EAAE,GAkBrD,EA8yHiBowG,GACrB5+E,GAAoB2jC,EAAQo3C,IAAcn0G,GAASg9D,EAAa,GAAImmC,GAAgBnjG,KAEpF,MAAMi4G,GAA8B3wE,GAAQ,CAAC6sE,KAAe,EAAEhR,GAAgBr+F,KAC7E,IAAKq+F,EAAc7iG,OAAQ,OAAOwE,IAClC,MAAM,OAAEqoB,EAAM,YAAEqpC,EAAW,SAAE33C,EAAQ,MAAEnQ,GAAUy0F,EAAc,GAC/Dr+F,EAAI,CAAEqoB,SAAQqpC,cAAa33C,WAAUnQ,SAAQ,IAGxCwpG,GAAYlxE,KAClB5N,GAAoB2jC,EAAQm7C,IAAWl4G,GAASg9D,EAAa,IAAK0mC,GAAa1jG,KAG/E,IAGIgzF,GAHAD,GAAe,GAKnB,MAAMolB,GAA8BnxE,KAC9B0sD,GAAsB1sD,KAEtBoxE,GAA4B9wE,GACjC,CACCgsD,GACAI,GACAN,GACAG,KAED,EACEjC,EACAK,EACAE,EACAH,KAEMJ,IAELK,GAAwBE,EAAe,EACtCH,EACA,KAOC2mB,GAAa,IAEf9wE,GAEHsjE,aACA3rF,aAEA4rF,iBACAC,aACAruD,wBACAjE,wBACApC,oBACA60D,oBACA/0D,yBACA80D,iBACAI,uBACAqD,yBACApD,4BACAF,kBACAj/D,iBACAsD,sBACA+7D,cACAC,cACAF,mBAEAI,oBACAC,0BACAC,cACAC,iBACAC,cAEAC,mBACAC,mBACAC,kBACAC,cAEA6H,gBAEAF,sBAEAQ,mBAEAD,yBAEA+B,WAEA12E,UAAW6uE,GACXtgF,cACAy5E,wBACA7M,oBACAyd,qBA39C2B,EA49C3BxO,iBAEAoE,mBACAC,oBACA6H,OACA9iB,YACAC,aACAic,iBACAD,iBACA/b,eACAqc,gBACAI,eACAwC,sBACA3e,uBACAua,YACA6B,kBACA/d,YACAC,aACAI,gBAAiBmb,GACjBpb,mBAAoBqb,GACpBnb,eAAgBib,GAChBI,wBACAyK,+BACAxK,uBACAC,uBACAC,iBACAC,sBACA8E,uBAEAsF,aAEA7kB,qBACAC,sBACA8kB,6BACA7kB,gCACAE,6BAEA4f,sBAEAn1C,mBAEA+0B,iBAEAmb,uBAEAC,yBAEAM,uBAEAC,6BAEApb,sBAEAub,4BAEAyB,kCAEA1B,8BAEAsD,eAEA6F,+BAEA7C,wBAIMiD,GAAWxtG,MAElB,MAAM0tG,GAAgB,QAAQnxG,MAC9B,IAAIoxG,GAAe,GAGfC,GAAMp6F,KAEV,MAYMq6F,GAAY,CAACtuE,EAAUtR,KAC5B,MAAM6/E,EANuB14G,KAC7B,MAAM24G,EAAczZ,GAAyBtzE,iBAAiB5rB,GAC9D,OAxoIEunB,GAD2BA,EAyoIEoxF,GAxoIfl9F,OAEV,QAAQ3W,KAAKyiB,GACNA,EACFhgB,OAAO,GACPuE,MAAM,KACNuJ,IAAI9G,YACJ8G,KAAI,CAAChP,EAAG1E,IAAM0E,GAAW,IAAN1E,EAAU,EAAI,OAGtC,OAAOmD,KAAKyiB,GACLA,EACFhgB,OAAO,GACPuE,MAAM,KACNuJ,IAAI9G,YACJ8G,KAAKhP,GAAMA,EAAI,MAGpB,KAAKvB,KAAKyiB,GA1BH,CAAC0X,IACZ,MAAO,CAAE25E,EAAG1rG,EAAGjE,GAAKg2B,EAAInzB,MAAM,IAC9BmzB,EAAqB,IAAfA,EAAI5+B,OAAe,IAAIu4G,IAAIA,IAAI1rG,IAAIA,IAAIjE,IAAIA,IAAMg2B,EACvD,MAAO,CAAErtB,EAAGmP,EAAGhR,GAAK,4CAA4C8oG,KAAK55E,GACrE,MAAO,CAACrtB,EAAGmP,EAAGhR,GAAGsF,KAAKhP,GAAM4yE,SAAS5yE,EAAG,IAAM,KAAI,EAuBvCyyG,CAASvxF,GAGhB,+CAA+CziB,KAAKyiB,GAC7CA,EACFzb,MAAM,KACNuJ,KAAKhP,GAAM4yE,SAAS5yE,EAAG,MACvBgP,KAAKhP,GAAMA,EAAI,WAJxB,EAvB0B,IAACkhB,CAyoIc,EAIxBwxF,CAAsB5uE,GAGpCuuE,GAAgC,IAAlBA,EAAW,KAG9BA,EAAWr4G,OAAS,EAGpBw4B,EAAMh0B,IAAI6zG,EAAY,CAAEt/C,MAAOqa,KAAc,EAGxCulC,GAAa,KAClBP,GAAU,QAAS9K,IAGjB8K,GADFnP,GACY,qBACA,mBADsBoE,IAGlC+K,GAAU,gBAAiB7K,IAC3B6K,GAAU,oBAAqB5K,GAAmB,EAQ7CoL,GAAa5xE,GAAQ,CAACgtE,GAAiBc,GAAc14D,GAAsBwwD,KAA2B,EAAE3J,EAAkB4V,EAAeroF,EAAiBsoF,KACxJ7V,GAAoB,IACvBA,KACA4V,EACHroF,kBACAC,gBAAiBqoF,KAInBhgF,GAAoB2jC,EAAQm8C,IAAYl5G,GAASg9D,EAAa,IAAKomC,GAAcpjG,KAEjF,MAcMq5G,GAAsBC,IAC3BnF,GAAa/xG,SAAQ,CAACyI,EAAOsL,KAC5B,MAAM6Z,EAAoB,IAAV7Z,EAAc,EAAI,EAElCtL,EAAM/F,IAAI,IAAKw0G,EAAmBtpF,UAASunC,OAD5B,GACsC8rC,GAAe,GACnE,EAIH,IAAIkW,GAEJ,MAAM7B,GAAgB3/C,QAAQx1D,EAAW,CAAEu8B,SAAU,MAErD,IAAI06E,GADJpgF,GAAoB2jC,EAAQ26C,IAAe13G,GAASg9D,EAAa,GAAI6lC,GAAiB7iG,KAKtF,MAAMy5G,GAAqBzyE,IAAS,GAGpC,IAAI0yE,GADJtgF,GAAoB2jC,EAAQ08C,IAAoBz5G,GAASg9D,EAAa,IAAK8lC,GAAsB9iG,KAGjG,MAAM25G,GAAc3gD,QAAOz2D,EAAW,CACrCo2D,UAAW,GACXC,QAAS,GACTrqD,UAAW,MAGZ6qB,GAAoB2jC,EAAQ48C,IAAa35G,GAASg9D,EAAa,GAAIgpC,GAAehmG,KAClF,MAAM45G,GAAe5gD,GAAO,EAAG,CAAEL,UAAW,GAAKpqD,UAAW,MAC5D6qB,GAAoB2jC,EAAQ68C,IAAc55G,GAASg9D,EAAa,GAAIipC,GAAgBjmG,KAEpF,MAAM65G,GAAa7gD,GAAO,EAAG,CAC5BL,UAAW,IACXC,QAAS,GACTrqD,UAAW,MAGZ6qB,GAAoB2jC,EAAQ88C,IAAY75G,GAASg9D,EAAa,IAAK2lC,GAAc3iG,KAEjF,MAAM85G,GAAc9gD,QAAOz2D,EAAW,CACrCo2D,UAAW,IACXC,QAAS,GACTrqD,UAAW,MAGZ6qB,GAAoB2jC,EAAQ+8C,IAAa95G,GAASg9D,EAAa,IAAK4lC,GAAe5iG,KAEnF,MAAM+5G,GAAe/gD,QAAOz2D,EAAW,CACtCo2D,UAAW,IACXC,QAAS,GACTrqD,UAAW,MAIZ,IAAIyrG,GADJ5gF,GAAoB2jC,EAAQg9C,IAAc/5G,GAASg9D,EAAa,IAAK0lC,GAAgB1iG,KAGrF,MAWMi6G,GAA4B,KACjC14E,GAAS,iBAAiB,EAGrB24E,GAA+B,KACpC34E,GAAS,qBACT1G,GAAgB08E,GAA0B9U,IAA4B,EAAOA,GAA0B,EAIlGxmC,GAAiB/yD,GAAKA,EAAE+yD,iBAGxBk+C,GAAmBvE,GACvB1sG,IAEA,MAAM0f,EAAQ1f,EAAEkxG,QAAUlxG,EAAEkxG,QAAQ,GAAKlxG,EAGrC0f,EAAMzZ,MAAQ,IAAMyZ,EAAMzZ,MAAQxM,OAAO03G,WAAa,IAG1Dp+C,GAAe/yD,EAAE,EAEjBtG,EAGI03G,GAAmBtzE,GAAS,IAElC5N,GAAoB2jC,EAAQu9C,IAAkBt6G,GAASg9D,EAAa,IAAKqlC,GAAoBriG,KAC7FkgC,GAAW,cAAeo6E,IAE1B,MA+DMC,GAAiBzwG,KAGrBA,GACDwd,GAASxd,KA9zII,CAACA,GAAS,SAAS/E,KAAK+E,EAAK3C,QAAU,MAAMpC,KAAK+E,EAAK3C,MA8zIjDqzG,CAAS1wG,KAC3Bwd,GAASxd,KAAU,QAAU/E,KAAK+E,IAGnCy3B,GAAS,YAAaz3B,EAAK,EAUtB2wG,GAAmB3wG,IACnBA,GACLywG,GAAezwG,EAAK,EAGf4wG,GAAmB,KACnBlS,IAjtIM,EAAC19F,EAAU,CAAC,IAAM,IAAIzH,SAASC,IAExC,MAAM,OAAEq3G,EAAS,WAAc7vG,EAEzB8vG,EAAYz2G,EAAE,QAAS,CACzBS,MAAO,wDACPuC,KAAM,OACNwzG,WAGEE,EAAmB,KAErB,MAAO/wG,GAAQ8wG,EAAUE,MAEzBF,EAAUzhG,YAAcyhG,EAAUvhG,SAClCuhG,EAAUv9E,oBAAoB,SAAUw9E,GAExCv3G,EAAQwG,EAAK,EAGjB8wG,EAAUx9E,iBAAiB,SAAUy9E,GAErCx8F,MAAWnb,SAASkW,KAAKN,OAAO8hG,GAEhCA,EAAU7vB,OAAO,IA0rInBgwB,GAAS9wG,KAAKwwG,GAAiB,EAsBhC,IAAIO,GAwBAC,GAHAt5C,GAAc,GAKlB,MAAMu5C,GAAkBl0E,KACxB9G,GAAW,aAAcg7E,IAGzBh7E,GAAW,WAAYgzD,IAEvB,MAAMioB,GAAgB,KAAM,CAE3BC,gBAAiB,IAAIpZ,IAErBqZ,UAAW,IAAItZ,IAEfuZ,eAAgB,IAAKzd,GAErB5K,cAAerB,GACfyc,sBAAuBvM,GAEvB5O,SAAU9/E,GAAYq+E,IAEtB0B,UAAW//E,GAAYo+E,IAEvB1vB,sBAAuBy5C,GACvBC,sBAAuBC,GACvBC,iBAAkBC,GAClB/5C,iBAAkBg6C,KAKbC,GAA0B,CAAC7sF,EAAOkzC,EAAexzD,IAG/C0jB,GAAoBpD,EAAO/c,GAAWiwD,EAAcj+D,MAAQyK,EAAOwzD,EAAch+D,OAASwK,IAI5FotG,GAA2B,CAAC9sF,EAAOkzC,EAAexzD,KACvDsgB,EAAM4xC,WAAa3xD,GAAoBizD,GACvClzC,EAAMgE,OAAStkB,EACRsgB,GAGF+sF,GAAgBxpF,IACrB,MAAMypF,EAAkB,GAExB,OADAzpF,EAAOnwB,SAAQ4sB,GAASgtF,EAAgBj6G,KAAKk6G,GAAajtF,MACnDgtF,EAAgBpgG,OAAO4gC,QAAQ,EAGjCy/D,GAAejtF,GAEhBa,GAAYb,IACfA,EAAMpe,OAAS,CAAC9B,GAAakgB,EAAMG,GAAIH,EAAMI,IAAKtgB,GAAakgB,EAAMpO,GAAIoO,EAAMM,KACxEN,KAnjoBe,CAACA,GAAUO,GAAYP,KAAWA,EAAMtF,KAAKppB,OAujoBhE47G,CAAiBltF,IAAYA,EAAM8B,iBAAgD,IAA7B9B,EAAM8B,gBAAgB,KAE3EtB,GAAiBR,KACpBA,EAAM/qB,MAAQ,EACd+qB,EAAM9qB,OAAS8qB,EAAMxF,YAItBwF,EAAM2B,YAAc,EAEpB3B,EAAM4B,YAAc,CAAC,EAAG,EAAG,EAAG,IAC9B5B,EAAM8B,gBAAkB,CAAC,EAAG,EAAG,EAAG,KAI5B9B,GAIR,IAMImtF,GANAC,GAAqC,GAErCC,GAAiC,GACjCC,GAA4B,GAC5BC,GAAiC,GACjCC,GAA4B,GAE5BC,GAA8B,CAAC,EAEnC,MAAMC,GAAoB,CAACC,EAAaC,EAAmBC,EAAwBC,EAAwBC,EAAuBC,KACjI,MAAM,sBAAEl7C,EAAqB,sBAAE05C,EAAqB,iBAAEE,EAAgB,iBAAE95C,EAAgB,cAAEM,EAAa,MAAExzD,GAAUiuG,EAG7GM,EAAqBd,KAAwBztG,EAE7CwuG,EAAcD,IAAuBjoG,GAAUynG,GAA6Bv6C,GAG9Eg7C,IACHf,GAAsBztG,EACtB+tG,GAA8Bv6C,IAI3BJ,GAAyB+6C,IAA2Bhb,MACvDua,GAAqCS,EAAuBjhG,OAAOmU,IAAgBza,IAAIyZ,IAAeya,MAAK,CAAC/7B,EAAGuC,IAC1GvC,EAAE0vG,YAAoB,EACtBntG,EAAEmtG,aAAqB,EACpB,IACL7nG,KAAI0Z,GAASoD,GAAoBpD,EAAOyyE,QAGxCwb,GAAsBG,IAAwCt7C,GAAyB+6C,IAA2Bhb,MACrHwa,GAAiCN,GAAcK,GAAmC9mG,KAAI0Z,GAAS+H,EAAgB/H,EAAO,CACrHne,MAAO8wF,GACP7wF,MAAO4wF,GACP7iF,SAAU+iF,GACVlzF,QACAwjB,QAAS3e,GAAmBkuF,QACzBxqE,SAID2qC,IACH06C,GAA4BM,EAAkBhhG,OAAOmU,IAAgBza,KAAI0Z,GAASoD,GAAoBpD,EAAOyyE,QAI1G+Z,GAAyBsB,IAA2Btb,IAAoB0b,KAC3EX,GAAiCR,GAAce,EAAuBlhG,OAAOmU,IAAgBza,IAAIyZ,IAAeya,MAAK,CAAC/7B,EAAGuC,IACpHvC,EAAE0vG,YAAoB,EACtBntG,EAAEmtG,aAAqB,EACpB,IACL7nG,KAAI0Z,GAAS6sF,GAAwB7sF,EAAOkzC,EAAexzD,KAAQ4G,KAAI0Z,GAAS+H,EAAgB/H,EAAO,CAAEkD,QAASgwC,MAAkBjrC,OAAO3hB,KAAI0Z,GAAS8sF,GAAyB9sF,EAAOkzC,EAAexzD,QAIvMgtG,GAAoBsB,IAAsBzb,IAAe2b,KAC5DV,GAA4BQ,EAC1BjB,GAAc,CAACiB,GAAmB1nG,IAAIyZ,IAAezZ,KAAI0Z,GAAS6sF,GAAwB7sF,EAAOkzC,EAAexzD,KAAQ4G,IAAIyhB,GAAiBE,OAAO3hB,KAAI0Z,GAAS8sF,GAAyB9sF,EAAOkzC,EAAexzD,MAChN,IAGH,MAAM2uG,EAAgCtB,GAAcgB,EAAsBnhG,OAAOmU,KAEjF,MAAO,CAEN6xC,mBACAD,YAAa26C,GAEbx6C,wBACAD,iBAAkBw6C,GAElBb,wBACAx5C,iBAAkBu6C,GAElBb,mBACAz5C,YAAau6C,GAEbz6C,gBAAiBs7C,EACjB,EAOF,IAAI9B,IAA6B,EAG7B6B,IAAuC,EAIvC3B,IAA6B,EAK7BE,IAAwB,EAKxBC,IAAwB,EA+wC5B,OA1wCA77E,IAAU,KACTqtE,KACAsE,KACAD,KACAE,KACAG,KACAE,KACAE,KACAmF,KACAM,KACAzJ,GAAgBjzE,UAChBkzE,GAAiBlzE,UACjBsvE,GAAWtvE,UACXk5E,GAAahzE,QAGbi7E,GAAmC97G,OAAS,EAE5C+7G,GAA+B/7G,OAAS,EACxCg8G,GAA0Bh8G,OAAS,EACnCi8G,GAA+Bj8G,OAAS,EACxCk8G,GAA0Bl8G,OAAS,EAEnC,IACC08D,EAAa,IAAKo3C,QAAsB7xG,GACxCy6D,EAAa,IAAKu8C,QAAmBh3G,EAGtC,CAFE,MAAMoI,GAER,KAyGDoyD,EAAOl2B,MAAQD,IACV,UAAWA,GAASo2B,EAAa,IAAKoK,GAAQxgC,EAAQ5tB,OACtD,WAAY4tB,GAASo2B,EAAa,IAAKkqC,GAAatgE,EAAQ0gC,QAC5D,WAAY1gC,GAASo2B,EAAa,IAAKz1B,GAASX,EAAQW,QACxD,WAAYX,GAASo2B,EAAa,EAAG2W,GAAS/sC,EAAQ+sC,QACtD,OAAQ/sC,GAASo2B,EAAa,EAAG7zD,GAAKy9B,EAAQz9B,IAC9C,SAAUy9B,GAASo2B,EAAa,IAAKmqC,GAAOvgE,EAAQugE,MACpD,UAAWvgE,GAASo2B,EAAa,IAAKoqC,GAAQxgE,EAAQwgE,OACtD,eAAgBxgE,GAASo2B,EAAa,IAAKqqC,GAAazgE,EAAQygE,YAChE,aAAczgE,GAASo2B,EAAa,IAAKlC,GAAWl0B,EAAQk0B,UAC5D,WAAYl0B,GAASo2B,EAAa,IAAK1/C,GAASspB,EAAQtpB,QACxD,mBAAoBspB,GAASo2B,EAAa,IAAKsqC,GAAiB1gE,EAAQ0gE,gBACxE,eAAgB1gE,GAASo2B,EAAa,IAAKuqC,GAAa3gE,EAAQ2gE,YAChE,uBAAwB3gE,GAASo2B,EAAa,EAAGwqC,GAAqB5gE,EAAQ4gE,oBAC9E,sBAAuB5gE,GAASo2B,EAAa,EAAGyqC,GAAoB7gE,EAAQ6gE,mBAC5E,yBAA0B7gE,GAASo2B,EAAa,EAAG0qC,GAAuB9gE,EAAQ8gE,sBAClF,eAAgB9gE,GAASo2B,EAAa,IAAK2qC,GAAa/gE,EAAQ+gE,YAChE,qBAAsB/gE,GAASo2B,EAAa,IAAK4qC,GAAmBhhE,EAAQghE,kBAC5E,qBAAsBhhE,GAASo2B,EAAa,EAAG6qC,GAAmBjhE,EAAQihE,kBAC1E,sBAAuBjhE,GAASo2B,EAAa,IAAK8qC,GAAoBlhE,EAAQkhE,mBAC9E,+BAAgClhE,GAASo2B,EAAa,IAAK+qC,GAA6BnhE,EAAQmhE,4BAChG,uBAAwBnhE,GAASo2B,EAAa,IAAKgrC,GAAqBphE,EAAQohE,oBAChF,uBAAwBphE,GAASo2B,EAAa,IAAKirC,GAAqBrhE,EAAQqhE,oBAChF,0BAA2BrhE,GAASo2B,EAAa,IAAKkrC,GAAwBthE,EAAQshE,uBACtF,kBAAmBthE,GAASo2B,EAAa,EAAGmrC,GAAgBvhE,EAAQuhE,eACpE,gBAAiBvhE,GAASo2B,EAAa,IAAKorC,GAAcxhE,EAAQwhE,aAClE,sBAAuBxhE,GAASo2B,EAAa,IAAKqrC,GAAoBzhE,EAAQyhE,mBAC9E,oBAAqBzhE,GAASo2B,EAAa,IAAKsrC,GAAkB1hE,EAAQ0hE,iBAC1E,qBAAsB1hE,GAASo2B,EAAa,IAAKurC,GAAmB3hE,EAAQ2hE,kBAC5E,sBAAuB3hE,GAASo2B,EAAa,IAAKwrC,GAAoB5hE,EAAQ4hE,mBAC9E,4BAA6B5hE,GAASo2B,EAAa,IAAKyrC,GAA0B7hE,EAAQ6hE,yBAC1F,+BAAgC7hE,GAASo2B,EAAa,GAAI0rC,GAA6B9hE,EAAQ8hE,4BAC/F,8BAA+B9hE,GAASo2B,EAAa,IAAK2rC,GAA4B/hE,EAAQ+hE,2BAC9F,oCAAqC/hE,GAASo2B,EAAa,IAAK4rC,GAAkChiE,EAAQgiE,iCAC1G,kCAAmChiE,GAASo2B,EAAa,IAAK6rC,GAAgCjiE,EAAQiiE,+BACtG,oCAAqCjiE,GAASo2B,EAAa,IAAK8rC,GAAkCliE,EAAQkiE,iCAC1G,0CAA2CliE,GAASo2B,EAAa,IAAK+rC,GAAwCniE,EAAQmiE,uCACtH,wCAAyCniE,GAASo2B,EAAa,IAAKgsC,GAAsCpiE,EAAQoiE,qCAClH,0BAA2BpiE,GAASo2B,EAAa,IAAKisC,GAAwBriE,EAAQqiE,uBACtF,2BAA4BriE,GAASo2B,EAAa,GAAIksC,GAAyBtiE,EAAQsiE,wBACvF,+BAAgCtiE,GAASo2B,EAAa,GAAImsC,GAA6BviE,EAAQuiE,4BAC/F,iCAAkCviE,GAASo2B,EAAa,GAAIosC,GAA+BxiE,EAAQwiE,8BACnG,sCAAuCxiE,GAASo2B,EAAa,GAAIqsC,GAAoCziE,EAAQyiE,mCAC7G,gCAAiCziE,GAASo2B,EAAa,IAAKssC,GAA8B1iE,EAAQ0iE,6BAClG,cAAe1iE,GAASo2B,EAAa,GAAIi1B,GAAYrrD,EAAQqrD,WAC7D,eAAgBrrD,GAASo2B,EAAa,GAAIk1B,GAAatrD,EAAQsrD,YAC/D,uBAAwBtrD,GAASo2B,EAAa,IAAKm1B,GAAqBvrD,EAAQurD,oBAChF,oBAAqBvrD,GAASo2B,EAAa,GAAIo1B,GAAkBxrD,EAAQwrD,iBACzE,mBAAoBxrD,GAASo2B,EAAa,IAAKq1B,GAAiBzrD,EAAQyrD,gBACxE,sBAAuBzrD,GAASo2B,EAAa,GAAIusC,GAAoB3iE,EAAQ2iE,mBAC7E,mBAAoB3iE,GAASo2B,EAAa,GAAIs1B,GAAiB1rD,EAAQ0rD,gBACvE,yBAA0B1rD,GAASo2B,EAAa,GAAIu1B,GAAuB3rD,EAAQ2rD,sBACnF,sBAAuB3rD,GAASo2B,EAAa,GAAIwsC,GAAoB5iE,EAAQ4iE,mBAC7E,mBAAoB5iE,GAASo2B,EAAa,GAAIy1B,GAAiB7rD,EAAQ6rD,gBACvE,qBAAsB7rD,GAASo2B,EAAa,GAAI01B,GAAmB9rD,EAAQ8rD,kBAC3E,0BAA2B9rD,GAASo2B,EAAa,GAAI21B,GAAwB/rD,EAAQ+rD,uBACrF,cAAe/rD,GAASo2B,EAAa,EAAG81B,GAAYlsD,EAAQksD,WAC5D,oBAAqBlsD,GAASo2B,EAAa,IAAKysC,GAAkB7iE,EAAQ6iE,iBAC1E,kBAAmB7iE,GAASo2B,EAAa,IAAK0sC,GAAgB9iE,EAAQ8iE,eACtE,qBAAsB9iE,GAASo2B,EAAa,IAAK2sC,GAAmB/iE,EAAQ+iE,kBAC5E,kBAAmB/iE,GAASo2B,EAAa,GAAI4sC,GAAgBhjE,EAAQgjE,eACrE,SAAUhjE,GAASo2B,EAAa,EAAG/gC,GAAO2K,EAAQ3K,MAClD,2BAA4B2K,GAASo2B,EAAa,GAAIstC,GAAyB1jE,EAAQ0jE,wBACvF,wBAAyB1jE,GAASo2B,EAAa,IAAKo3C,GAAsBxtE,EAAQwtE,oBAAoB,EAG3Gr3C,EAAOzjC,GAAG4H,OAAS,KAoClB,GAnCuC,EAAnC67B,EAAOzjC,GAAGQ,MAAM,GAAsE,KAA/CijC,EAAOzjC,GAAGQ,MAAM,IAE1DkjC,EAAa,EAAG81B,GAA0B,OAAdA,GAAqBmW,GAAwBnW,IAGxB,IAA9C/1B,EAAOzjC,GAAGQ,MAAM,IACnBe,GAAgBkvE,GAA2BhE,GAA6B2B,GAAsB3B,IAGvD,OAApChpC,EAAOzjC,GAAGQ,MAAM,IAEnBkjC,EAAa,IAAKw/B,EAAsC,YAAf0K,IAGD,EAArCnqC,EAAOzjC,GAAGQ,MAAM,GAAuE,QAA9CijC,EAAOzjC,GAAGQ,MAAM,IAC5DkjC,EAAa,GAAIy/B,EAAY2L,KAAgB5L,GAGc,SAAxDz/B,EAAOzjC,GAAGQ,MAAM,IAEf8vE,IAEHnlG,OAAO+X,QAAQotF,IAAexnG,SAAQ,EAAEnC,EAAMq9G,MAE7C74G,OAAO+X,QAAQ8gG,GAAQl7G,SAAQ,EAAEorB,EAAMxtB,MAEjC6pG,GAAgB5pG,IAGrB+8D,EAAa,EAAG6sC,GAAgB5pG,GAAMutB,GAAQxtB,EAAO6pG,GAAgB,GACpE,IAKwC,EAAzC9sC,EAAOzjC,GAAGQ,MAAM,GAAuE,OAA1CijC,EAAOzjC,GAAGQ,MAAM,GAChE,CACC,IAAIyjF,GAAU,EAGd5T,GAAiBvnG,SAAQ,EAAElB,MACtB2oG,GAAgB3oG,KACpB87D,EAAa,EAAG6sC,GAAgB3oG,GAAO,CAAC,EAAG2oG,IAC3C0T,GAAU,EAAI,IAGXA,GACHvgD,EAAa,IAAKgtC,GAA8B,IAAIL,IAEtD,CAzwsBa,IAACl8F,EAAGuC,EA0irBKqD,EAAMmqG,EAy3B7B,GAvJsC,QAAlCzgD,EAAOzjC,GAAGQ,MAAM,IACnBmwE,GAAmBnlG,IAAIg2D,GAAW,EAAI,GAGc,GAAjDiC,EAAOzjC,GAAGQ,MAAM,KACnB4iE,EAAmB+L,IAjxsBLh7F,EAkxsBJg7F,GAlxsBOz4F,EAkxsBkBm6F,GAlxsBZl4F,GAAW5K,KAAKyM,IAAIrG,EAAExJ,MAAO+L,EAAE/L,OAAQoD,KAAKyM,IAAIrG,EAAEvJ,OAAQ8L,EAAE9L,UAmxsBjFimG,IAGmC,IAAlCptC,EAAOzjC,GAAGQ,MAAM,KACnBywE,GAAWrpE,OAAO0kE,GAAQ,IAGsB,GAA7C7oC,EAAOzjC,GAAGQ,MAAM,MACnB/C,EAAkB4uE,GAChB,CAAC32E,EAAOlkB,IAAY66F,GAAmB32E,EAAO,CAC9Cne,WAAOtO,EACPuO,WAAOvO,EACPsc,cAAUtc,KACPuI,EACH6yC,WAAW,IAEXvwC,GAG6C,MAA5C2vD,EAAOzjC,GAAGQ,MAAM,IACnB0zE,GAAuB1oG,IAAIqtF,IAG6C,MAArEp1B,EAAOzjC,GAAGQ,MAAM,IACnB2zE,GAAmB3oG,IAAoC,QAAhCwkG,IAErBjX,IAGsC,OAArCt1B,EAAOzjC,GAAGQ,MAAM,IACnBwoE,IAAepP,GAASpuF,IAAImP,GAAWquF,GAAYvzF,EAAGuzF,GAAYtzF,EAAGszF,GAAYr+F,MAAOq+F,GAAYp+F,SAGxC,UAAzD64D,EAAOzjC,GAAGQ,MAAM,GAA+F,KAA1CijC,EAAOzjC,GAAGQ,MAAM,KACxF23D,IAAa+K,GAAwByG,IAAmBA,GAAgB/3F,UAl2D9C,MAE3B,MAAMuyG,EAAqBjY,GAErBkY,EAAkBzoG,GAAgBw8E,IACpCgsB,GAAsBA,IAAuBC,IAGjDjlE,GAAqB3zC,IAAImQ,GAAgBw8E,KAGzCulB,KAAwB,EAu1D6D2G,GAGjD,EAAhC5gD,EAAOzjC,GAAGQ,MAAM,GAAmD,QAA/BijC,EAAOzjC,GAAGQ,MAAM,GAA8E,QAArDijC,EAAOzjC,GAAGQ,MAAM,IAChGkjC,EAAa,IAAKwgC,EAAgB7pB,IAAUq2B,GAA4B1pG,OACtE8mG,IAAS4C,GAA4B10F,KAAI,EAAEnM,KAAQA,IACnD,IAGwC,KAAvC4zD,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,GAAI+gC,EAAmBP,EAAcl9F,OAAS,GAGd,KAA1Cy8D,EAAOzjC,GAAGQ,MAAM,KACdikE,GAAkBgQ,GAAQjpG,IAAIwO,OAGO,IAAvCypD,EAAOzjC,GAAGQ,MAAM,KACdquE,IAAe6F,GAASlpG,IAAIwO,OAG8B,WAA5DypD,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAK4/B,GAAchL,IAAkB+K,GAGC,GAAhD5/B,EAAOzjC,GAAGQ,MAAM,KACnBkjC,EAAa,IAAK6/B,GAAqB0I,IAGA,QAApCxoC,EAAOzjC,GAAGQ,MAAM,GAAqF,SAAvDijC,EAAOzjC,GAAGQ,MAAM,IAEjEe,GACC0zE,GACAlL,GAAgC,WAAfgE,GACfzK,EACe,UAAfyK,IAECzK,GAAcC,EACjBwG,IAIsC,QAApCtmC,EAAOzjC,GAAGQ,MAAM,GAA6F,QAA/DijC,EAAOzjC,GAAGQ,MAAM,IAEjEe,GACC2iC,GACAkW,GAA6B,WAAf2zB,GACZ1K,EACe,UAAf0K,IAEC1K,GAAsBE,EACzBnpB,IAI0C,QAAxC3W,EAAOzjC,GAAGQ,MAAM,GAAgF,QAA9CijC,EAAOzjC,GAAGQ,MAAM,IACrE00E,GAAqB1pG,IAAIwiG,IAAkB9K,GAGJ,SAApCz/B,EAAOzjC,GAAGQ,MAAM,IACnB01E,GAAiB1qG,IAAIyiG,IAGY,EAA9BxqC,EAAOzjC,GAAGQ,MAAM,GAAgE,GAA9CijC,EAAOzjC,GAAGQ,MAAM,KACjDmC,KACHA,GAAKyF,cAAc6sD,GAAW,aAAc+C,KAC5Cr1D,GAAKyF,cAAc6sD,GAAW,OAAQ+C,MAIN,EAA9Bv0B,EAAOzjC,GAAGQ,MAAM,GAA+D,EAA7CijC,EAAOzjC,GAAGQ,MAAM,KACjDmC,KACHA,GAAKyF,cAAc6sD,GAAW,YAAa8C,KAC3Cp1D,GAAKyF,cAAc6sD,GAAW,MAAO8C,MAIM,EAAzCt0B,EAAOzjC,GAAGQ,MAAM,KAEf+qE,IAAgB0L,KAG4B,EAA7CxzC,EAAOzjC,GAAGQ,MAAM,KACnBgrE,IAAsB+L,KAGkC,QAArD9zC,EAAOzjC,GAAGQ,MAAM,GAAsF,KAAvCijC,EAAOzjC,GAAGQ,MAAM,GAAuE,QAAzCijC,EAAOzjC,GAAGQ,MAAM,KAChIkjC,EAAa,IAAKygC,EAAiBuM,GAA4BpuF,QAAO,EAAEzS,KAAQq0F,EAAcvgF,SAAS9T,KAAKyS,QAAO,EAAE,EAAGgiG,kBAAmBA,EAAY,CAAE9+E,SAAU6kE,OAAmBruF,KAAI,EAAEnM,EAAIg+F,KAAU,CAACh+F,EAAIg+F,EAAK78B,cAGzK,KAAxCvN,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAK0gC,EAAeD,EAAen9F,QAGf,OAA9By8D,EAAOzjC,GAAGQ,MAAM,GAA6D,UAAtCijC,EAAOzjC,GAAGQ,MAAM,GAA0E,KAAxCijC,EAAOzjC,GAAGQ,MAAM,IAC5GkjC,EAAa,GAAI4gC,EAAeuJ,IAAwB,iBAATA,IAAqB1J,EAAe58F,MAAK,EAAEsI,KAAQA,IAAOg+F,KACvGA,GACAzJ,EAAe,EAAID,EAAe,GAAG,QAAKl7F,GAGU,OAAnDw6D,EAAOzjC,GAAGQ,MAAM,IACnB8jE,GAAgBgV,GAAoB9tG,IAAI,KAAO,CAAEu0D,MAAOqa,KAGb,WAAxC3W,EAAOzjC,GAAGQ,MAAM,IAA4E,EAAvCijC,EAAOzjC,GAAGQ,MAAM,KACxEkjC,EAAa,IAAK8/B,EAAa6H,IAC5Bt9F,KAAKxF,OAAO4C,OAAOijB,OAAOg9E,KAC3B,GAGuE,SAAtE3nC,EAAOzjC,GAAGQ,MAAM,GAAiH,UAAhDijC,EAAOzjC,GAAGQ,MAAM,IAChG2qE,GAAiC,CACpC,IAAI5tF,EAAI4tF,GAAgC11F,EAAIyiF,GAAWziF,EACnD8C,EAAI2/E,GAAWziF,EAAIyiF,GAAWvtF,OAASwgG,GAAgC11F,EAAI01F,GAAgCxgG,OAC3GmQ,EAAIqwF,GAAgCz1F,EAAIwiF,GAAWxiF,EACnDgB,EAAIwhF,GAAWxiF,EAAIwiF,GAAWttF,QAAUugG,GAAgCz1F,EAAIy1F,GAAgCvgG,QAC5G8S,EAAI3P,KAAKyM,IAAI+C,EAAGzC,EAAGvC,EAAG7B,GAE1BwjG,GAAe1uG,IACdkS,EAAI8lF,EACF,EACAz1F,KAAKyM,IA96EgB,IA86ESzM,KAAKsG,IAAIqJ,EA76EX,KA86E9B,CAAEqiD,MAAOqa,IAEX,CAkCD,GA/ByC,QAArC3W,EAAOzjC,GAAGQ,MAAM,IAEnBkjC,EAAa,IAAK+/B,EAAiB,IAAOyH,IAGF,OAArCznC,EAAOzjC,GAAGQ,MAAM,GAAkF,UAApDijC,EAAOzjC,GAAGQ,MAAM,IACjE03D,IAAciiB,GAAgB3uG,IAC7B,CACCiK,EAAG,EACHC,EAAGwiF,GAAWxiF,EACd/K,MAAOutF,GAAWziF,EA77EY,GA87E5B,EACAyiF,GAAWziF,EACb7K,OAAQstF,GAAWttF,OAAS64F,GAE7B,CAAE1jC,MAAOqa,KAI8B,OAArC3W,EAAOzjC,GAAGQ,MAAM,GAA6F,UAA/DijC,EAAOzjC,GAAGQ,MAAM,IACjE03D,IAAckiB,GAAe5uG,IAC5B,CACCiK,EAAG,EACHC,EAAG,EACH/K,MAAOwtF,GAAUxtF,MACjBC,OAAQstF,GAAWxiF,EAAI+tF,GAExB,CAAE1jC,MAAOqa,KAI8B,OAArC3W,EAAOzjC,GAAGQ,MAAM,GAA6F,UAA/DijC,EAAOzjC,GAAGQ,MAAM,IAC7D03D,GAAY,CACf,IAAIziF,EAAIyiF,GAAWziF,EAAIyiF,GAAWvtF,MAC9BA,EAAQwtF,GAAUxtF,OAASutF,GAAWziF,EAAIyiF,GAAWvtF,OAErDA,EAv9E2B,KAw9E9B8K,GAAK9K,EACLA,EAAQ,GAGT0vG,GAAiB7uG,IAChB,CACCiK,IACAC,EAAGwiF,GAAWxiF,EACd/K,QACAC,OAAQstF,GAAWttF,OAAS64F,GAE7B,CAAE1jC,MAAOqa,IAEX,CAuDD,GApDyC,OAArC3W,EAAOzjC,GAAGQ,MAAM,GAA6E,UAA/CijC,EAAOzjC,GAAGQ,MAAM,IACjE03D,IAAcoiB,GAAkB9uG,IAC/B,CACCiK,EAAG,EACHC,EAAGwiF,GAAWxiF,EAAIwiF,GAAWttF,OAC7BD,MAAOwtF,GAAUxtF,MACjBC,OAAQutF,GAAUvtF,QAAUstF,GAAWxiF,EAAIwiF,GAAWttF,SAEvD,CAAEm1D,MAAOqa,KAIuC,QAA9C3W,EAAOzjC,GAAGQ,MAAM,GAAoG,UAA5DijC,EAAOzjC,GAAGQ,MAAM,KAC3EkjC,EAAa,IAAKggC,EAAcuH,IAAoB,CACnDp7F,GAAImzF,GACJxrE,gBAAiBszE,GACjBp0E,QAASm0E,MACNI,KAI6C,QAA9CxnC,EAAOzjC,GAAGQ,MAAM,GAAmG,UAA3DijC,EAAOzjC,GAAGQ,MAAM,KAC3EkjC,EAAa,IAAKigC,EAAaqH,IAAmB,CACjDn7F,GAAImzF,GACJxrE,gBAAiBszE,GACjBp0E,QAASm0E,MACNG,KAI6C,QAA9CvnC,EAAOzjC,GAAGQ,MAAM,GAAqG,UAA7DijC,EAAOzjC,GAAGQ,MAAM,KAC3EkjC,EAAa,IAAKkgC,EAAemH,IAAqB,CACrDl7F,GAAImzF,GACJxrE,gBAAiBszE,GACjBp0E,QAASm0E,MACNE,KAI6C,QAA9CtnC,EAAOzjC,GAAGQ,MAAM,GAAsG,UAA9DijC,EAAOzjC,GAAGQ,MAAM,KAC3EkjC,EAAa,IAAKmgC,EAAgB+G,IAAsB,CACvD/6F,GAAImzF,GACJxrE,gBAAiBszE,GACjBp0E,QAASm0E,MACND,KAI6E,OAA9EnnC,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAKogC,EAAmB,CAACH,EAAYC,EAAcC,EAAeH,GAAaphF,OAAO4gC,UAGtD,KAA1CugB,EAAOzjC,GAAGQ,MAAM,GAA+E,SAA9CijC,EAAOzjC,GAAGQ,MAAM,KAEhEsjE,GAAoB6G,GAAqB,CAE5C,MAAM4Z,EAAwB5Z,GAAoBroF,QAAOkiG,GAAUA,EAAO30G,KAAOmzF,KAEjF+W,GAAmBvuG,IAAI,IAAI+4G,KAA0BzgB,GACtD,CA6QD,GA1Q6C,OAAzCrgC,EAAOzjC,GAAGQ,MAAM,GAAuE,QAArCijC,EAAOzjC,GAAGQ,MAAM,KACrEg6E,GAAmBhvG,IAAI2kG,IAErBzF,SAAczhG,GAGiB,EAA9Bw6D,EAAOzjC,GAAGQ,MAAM,GAA+D,MAA7CijC,EAAOzjC,GAAGQ,MAAM,GAA6E,EAAxCijC,EAAOzjC,GAAGQ,MAAM,MAEzGkjC,EAAa,IAAKo3C,GAAsBnS,IACpCA,IAAehmE,GAAKyF,cAAc6sD,GAAW,cAAe6lB,MAIhB,KAA9Cr3C,EAAOzjC,GAAGQ,MAAM,KACfopE,KA13CL7P,GAAkBvuF,IAAI+J,KACtBykF,GAAmBxuF,SAAIvC,GACvBguG,KACAryC,GAAgBp5D,IAAI,KA03CmB,QAAnCi4D,EAAOzjC,GAAGQ,MAAM,KACnBkjC,EAAa,IAAKsgC,EAAUuG,GAAS1tF,MAAQ,GAGP,QAAnC4mD,EAAOzjC,GAAGQ,MAAM,KACnBkjC,EAAa,IAAKugC,EAAUsG,GAAS1tF,MAAQ0tF,GAASvjG,OAAS,GAGjB,EAA3Cy8D,EAAOzjC,GAAGQ,MAAM,IACnBq+E,GAA4BrzG,IAAIkuF,IAGmB,QAAhDj2B,EAAOzjC,GAAGQ,MAAM,KACnB45D,GAAoB5uF,IAAI8+F,IAGW,EAAhC7mC,EAAOzjC,GAAGQ,MAAM,GAA2E,KAAvDijC,EAAOzjC,GAAGQ,MAAM,IACvDkjC,EAAa,GAAI2gC,EAAcH,EAAcloF,KAAIyoG,IAChD,MAAM5W,EAAO1J,EAAe58F,MAAK,EAAEsI,KAAQ40G,IAAW50G,IACtD,GAAKg+F,EAEL,MAAO,CACNh+F,GAAI40G,EACJ39G,KAAM+mG,EAAK,GACX6W,QAASrqC,GAAO,GAAGoqC,SACnBE,SAAUtqC,GAAO,GAAGoqC,UACpB,IACCniG,OAAO4gC,UAAY,IAGmB,KAAtCugB,EAAOzjC,GAAGQ,MAAM,IACnBuzE,GAAkBvoG,IAAI84F,GAGwC,KAA3D7gC,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,GAAI6gC,EAAuBF,EAAYx5E,QACnD,CAACC,EAAMC,KACND,EAAKC,EAAKlb,IAAM00F,GAAwBA,EAAqBx5E,EAAKlb,KAAO,EAClEib,IAER,CAAC,IAIuC,KAAtC24C,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,GAAI8gC,EAAa,CAC7B79F,KAAMs4G,GACN7xC,SAAUk3B,IAI6B,KAArC7gC,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,GAAIqK,EAAOs2B,EAAYroF,KAAI6xF,IAAQ,CAC/Ch+F,GAAIg+F,EAAKh+F,GACT0oE,KAAMs1B,EAAK6W,QACXvsC,MAAO01B,EAAK8W,cAI2B,KAArClhD,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,GAAIiN,EAAS0zB,EAAYroF,KAAI6xF,GAAQA,EAAKh+F,MAGrB,MAA/B4zD,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,GAAIghC,EAAY/4B,GAAU,CAAC,cAAe,uBAAwBmC,MAGzC,UAAnCrK,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAKihC,EAAkBxM,KAAcA,GAAUxtF,MAAQ,IAClE,OACAwtF,GAAUxtF,MAAQ,IAAM,cAAW1B,IAGC,UAAnCw6D,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAKkhC,EAAkBzM,KAAcA,GAAUxtF,OAAS,KAAOwtF,GAAUvtF,QAAU,MAG1D,UAAnC64D,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAKmhC,EAAgB1M,KAAcA,GAAUvtF,OAAS,IACjE,OACAutF,GAAUvtF,OAAS,IAAM,aAAU3B,IAGJ,EAA9Bw6D,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAKohC,EAAUniE,IAAQA,GAAK9iB,YAAc8iB,GAAK9iB,WAAWyjE,UAAUtM,SAAS,iBAGlD,UAArCvT,EAAOzjC,GAAGQ,MAAM,GAAkE,GAAjCijC,EAAOzjC,GAAGQ,MAAM,GAAyD,UAAnCijC,EAAOzjC,GAAGQ,MAAM,IAC1GkjC,EAAa,IAAKqhC,EAAyBD,GAAW3M,IAAaikB,GAAcjkB,GAAUxtF,OAGlD,WAAtC84D,EAAOzjC,GAAGQ,MAAM,GAAoE,GAAjCijC,EAAOzjC,GAAGQ,MAAM,GAAyD,UAAnCijC,EAAOzjC,GAAGQ,MAAM,IAC5GkjC,EAAa,IAAKshC,EAAuBF,GAAW3M,IAAakkB,GAAelkB,GAAUvtF,QAGjB,WAAtE64D,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAKuhC,EAAaF,GAA0BC,GAGX,OAA3CvhC,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAKS,EAAgB8rC,IAGU,IAAzCxsC,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAKwhC,EAA+B,WAApBP,GAGyB,IAAnDlhC,EAAOzjC,GAAGQ,MAAM,GAA4E,UAAnCijC,EAAOzjC,GAAGQ,MAAM,IAC5EkjC,EAAa,KA1nCS3pD,EA0nCyBo+E,GA1nCnB+rB,EA0nC8B7U,GAAxC/iG,EAznCd6rF,GACoB,SAArB+rB,EAAoCnqG,EAAKpP,MAAQoP,EAAKnP,OAAS,YAAc,WACxD,eAArBs5G,EAA0CnqG,EAAKpP,MAAQ,IAAM,WAAa,YACrD,aAArBu5G,EAAwCnqG,EAAKnP,OAAS,IAAM,YAAc,gBAA9E,EAHuB,cA4nCkB,IAArC64D,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,GAAIyhC,EAA8B,cAAhB74F,GAGM,EAAlCm3D,EAAOzjC,GAAGQ,MAAM,GAA6D,GAAvCijC,EAAOzjC,GAAGQ,MAAM,IACzDkjC,EAAa,IAAK0hC,EAAYF,GAA8B,UAAlBL,GAGF,UAArCphC,EAAOzjC,GAAGQ,MAAM,GAAoE,UAAnCijC,EAAOzjC,GAAGQ,MAAM,IACpEkjC,EAAa,IAAK2hC,EAAqB8Z,IAAOhnB,IAAaikB,KAAgBjkB,GAAUxtF,QAAU2xG,IAGtD,EAAtC74C,EAAOzjC,GAAGQ,MAAM,GAA+D,OAArCijC,EAAOzjC,GAAGQ,MAAM,KAC7DkjC,EAAa,IAAK4hC,EAAkB,IAAI8E,IAAc,MAAO3Q,IAAcn3E,OAAO4gC,UAGtB,IAAzDugB,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAK6hC,GAAiC,6BAA6B+J,MAGtB,IAAvD7rC,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAK8hC,GAA+B,6BAA6B+J,MAGlB,KAAzD9rC,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAK+hC,GAA4B,0BAA0B+J,MAGN,KAA/D/rC,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAKgiC,GAAkC,gCAAgC+J,MAGpB,KAA7DhsC,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAKiiC,GAAgC,8BAA8B+J,MAG1C,UAAnCjsC,EAAOzjC,GAAGQ,MAAM,IAEnBkjC,EAAa,IAAKkiC,QAAgC38F,IAAdkvF,IAA2BA,GAAUxtF,MAAQ,GAAKwtF,GAAUvtF,OAAS,GAGxE,EAA9B64D,EAAOzjC,GAAGQ,MAAM,GAA2D,KAAzCijC,EAAOzjC,GAAGQ,MAAM,IACrDkjC,EAAa,IAAKmiC,GAA2BD,IAAmBjjE,IAAQ4oC,iBAAiB5oC,KAGpC,IAAlD8gC,EAAOzjC,GAAGQ,MAAM,IAEfqlE,IAA0B8Z,KAGY,IAAvCl8C,EAAOzjC,GAAGQ,MAAM,GAA+F,OAAlEijC,EAAOzjC,GAAGQ,MAAM,GAAyG,QAA9CijC,EAAOzjC,GAAGQ,MAAM,GAAsL,WAA9IijC,EAAOzjC,GAAGQ,MAAM,GAAqX,IAA1OijC,EAAOzjC,GAAGQ,MAAM,GAAoS,OAApEijC,EAAOzjC,GAAGQ,MAAM,KAC9kBk8E,GAAIlxG,IAAI,IACJy9F,GACH2E,cACAthG,cACAq4F,kBACAE,gBACAU,kCACAC,gCACAE,mCACAC,iCACAF,6BACAX,UACA8f,WAAYpjD,GACZyjC,aACAF,yBACAC,uBACA9gC,WAAYkW,GACZjW,gBACAywC,gBAAiBzK,GACjB0K,iBAAkB3K,GAClB9E,YACAC,qBACAT,kBACAigB,WAAYhW,GACZiW,cAAergB,GAAoBtB,EACnCp+E,MAAOo6F,KAI0B,GAA/B17C,EAAOzjC,GAAGQ,MAAM,KACnBkjC,EAAa,GAAIoiC,GAAS36F,OAAO+X,QAAQ+lF,IAAMjtF,KAAI,EAAEpU,EAAKlB,KAErD,UAAY+E,KAAK7D,GACblB,EAAQ2uF,GAAYztF,QAAOqB,EAI5BvC,IACL4b,OAAO4gC,SAAS70B,KAAK,MAGiB,KAAtCo1C,EAAOzjC,GAAGQ,MAAM,IAEnB8jE,GAAgBsa,GAAUpzG,IAAI,IAGwC,MAAnEi4D,EAAOzjC,GAAGQ,MAAM,KACnBkjC,EAAa,GAAIqiC,GAAmBkE,IAAoB9+F,OAAO+X,QAAQ8mF,IAAwB1nF,QAAO,EAAE,CAAC5b,KAAoB,MAATA,IAAemkB,QAClI,CAACC,GAAO,CAACpkB,MACD,IAAKokB,KAASpkB,KAGtB,CAAC,IAI2C,KAA1C+8D,EAAOzjC,GAAGQ,MAAM,KAInBkjC,EAAa,IAAKyiC,GAA4BwD,IAA4C,gBAAzBA,GAAgBxnE,MAG3B,QAAnDshC,EAAOzjC,GAAGQ,MAAM,IAEf2lE,IAA6B0U,IAChCA,GAAahzE,QAI2B,MAAtC47B,EAAOzjC,GAAGQ,MAAM,KAEnBkjC,EAAa,IAAKsiC,KAAa8D,MAAiBA,GAAY5sC,aAGf,QAA1CuG,EAAOzjC,GAAGQ,MAAM,GAAsE,SAAlCijC,EAAOzjC,GAAGQ,MAAM,GAAqE,EAAxCijC,EAAOzjC,GAAGQ,MAAM,KAChHwlE,IAAY2C,IAAiBA,KAAkBsX,KAClDv8C,EAAa,IAAKu8C,GAAmBtX,IAzsChB,MAEvB,MAAMoc,EAAalK,GAAa7zG,YAASiC,EAAY,CAAEg1D,OAAQ,MAGzD1sD,EAxoIU,EAAC5J,EAAMF,EAAM+J,EAAU,CAAC,KACtC,MAAQysD,OAAQ+mD,EAAgB,EAAGtuF,QAASuuF,EAAiB,GAAMzzG,EAC7Dy8B,EAAS,CAEXvX,QAAS,CAACgpC,GAAOulD,EAAgB,IAAKruB,GAAcv3B,UAAW,KAAQvrD,GACvEmqD,OAAQ,CAACyB,GAAOslD,EAAe,IAAKpuB,GAAcv3B,UAAW,KAAQvrD,GAErEopD,YAAa,CAACwC,QAAOz2D,EAAW2tF,IAAe9iF,GAC/CyR,SAAU,CAACm6C,QAAOz2D,EAAW87D,IAAwBjxD,GACrD+f,OAAQ,CAAC6rC,QAAOz2D,EAAW2tF,IAAe9iF,GAC1CsB,MAAO,CAACsqD,QAAOz2D,EAAW87D,IAAwBjxD,GAClDkZ,MAAO,CAAC0yC,QAAOz2D,EAAW87D,IAAyB/3D,GAAMA,GAAK,GAC9DogB,SAAU,CAACsyC,QAAOz2D,EAAW87D,IAAyB/3D,GAAMA,GAAK,GACjE8f,YAAa,CACT4yC,GAAO,IAAIi3B,IAAwBC,IAClC5pF,GAAMA,GAAK,IAAI2pF,KAEpB5pE,kBAAmB,CAAC2gB,QAASzkC,GAAa+D,GAAOA,GAAKA,EAAEugB,cAAYtkB,GACpEuuB,gBAAiB,CAACkoC,QAAOz2D,EAAW2tF,IAAe9iF,GACnD2jB,gBAAiB,CAACiW,QAASzkC,GAAY6K,IAGrCoxG,EAAe/5G,OAAO+X,QAAQ+qB,GAAQjyB,KAAI,EAAEpU,EAAKlB,KAAW,CAACkB,EAAKlB,EAAM,MACxEy+G,EAAaD,EAAalpG,KAAI,EAAE,CAAEwjB,KAAWA,IAE7C4lF,EAAej6G,OAAO+X,QAAQ+qB,GAAQpjB,QAAO,CAACC,GAAOljB,EAAKlB,MAC5D,MAAO84B,EAAO41C,GAAY1uE,EAE1B,OADAokB,EAAKljB,GAAO,CAAClB,EAAO2pC,IAAS7Q,EAAMh0B,IAAI4pE,EAAS1uE,GAAQ2pC,GACjDvlB,CAAI,GACZ,CAAC,GAEJ,IAAIu6F,EAEJ,MAAM1qE,EAAQ3M,GAAQm3E,GAAa71E,IAE/B+1E,EAAa/1E,EAAYzkB,QAAO,CAACy6F,EAAiB5+G,EAAOmW,KAErDyoG,EADYJ,EAAaroG,GAAO,IACTnW,EAChB4+G,IACR,CAAC,GAEJD,EAAW19G,KAAOA,EAClB09G,EAAW59G,KAAOA,EAElB49G,EAAWjwG,OAASk6B,EAAY,GACzB+1E,KAWX,OATA1qE,EAAMhsC,IAAM,IAAM02G,EAClB1qE,EAAMnvC,IAAM,CAAC2oB,EAAOwuD,KAChB,MAAMtyC,EAAO,CAAE0vB,MAAO4iB,GACtBx3E,OAAO+X,QAAQiR,GAAOrrB,SAAQ,EAAElB,EAAKlB,MAC5B0+G,EAAax9G,IAElBw9G,EAAax9G,GAAKlB,EAAO2pC,EAAK,GAChC,EAECsK,CAAK,EAglIAz5B,CAAYynF,GAAeR,GAAY4c,GAGrDlK,GAAa4D,QAAQltG,GAGrBwuG,GAAoBjW,GAAY,EA+rC9Byb,IAIoC,SAAlC9hD,EAAOzjC,GAAGQ,MAAM,GAAmE,MAAtCijC,EAAOzjC,GAAGQ,MAAM,KAEhEwlE,IAAY+Z,GAAoBjW,IAGU,QAAvCrmC,EAAOzjC,GAAGQ,MAAM,IAEfqpE,IAAiBA,GAAc7iG,OAAS,EAAG,CAC9C,IAAIw+G,EAAiB,GAErB3K,GAAa/xG,SAAQ,CAACyI,EAAOsL,KACd,IAAVA,GACAtL,EAAM5C,MAAM+nB,SAAW,GAAG8uF,EAAe/8G,KAAK8I,EAAM,IAGzDi0G,EAAe18G,SAAQyI,GAASspG,GAAa96F,OAAOxO,IACrD,CAyBD,GAtBoC,EAAhCkyD,EAAOzjC,GAAGQ,MAAM,GAA6D,QAAzCijC,EAAOzjC,GAAGQ,MAAM,IACvDkjC,EAAa,GAAIwiC,GAAkB7rB,IAAU4rB,GAAgBj/F,QAAUqzE,GAAOorC,kBAAkBxf,KAGnD,KAA1CxiC,EAAOzjC,GAAGQ,MAAM,KACnBkjC,EAAa,IAAK0iC,GAAmBuD,MAAqBA,GAAgB55F,OAG7B,KAA1C0zD,EAAOzjC,GAAGQ,MAAM,KACnBkjC,EAAa,GAAI2iC,IAAqBsD,KAAoBA,GAAgB/3F,eAAqC3I,IAAzB0gG,GAAgBxnE,MAGzD,KAA1CshC,EAAOzjC,GAAGQ,MAAM,KACnBkjC,EAAa,IAAK4iC,GAAoBqD,KAAoBA,GAAgBhsD,qBACxEgsD,GAAgBjsD,aAChB7D,MAGoD,QAAnD4pB,EAAOzjC,GAAGQ,MAAM,IACf2lE,IAA2B5kE,GAAgBg5E,GAAyB9Q,IAA2B,EAAOA,IAGlE,OAArChmC,EAAOzjC,GAAGQ,MAAM,GAAiE,SAAnCijC,EAAOzjC,GAAGQ,MAAM,GAAwE,KAA1CijC,EAAOzjC,GAAGQ,MAAM,KAC3GmpE,IAAmBA,GAAgB/3F,SAAU,CAChD,MAAM8zG,EAAoBtrC,GAAc,IAAM,EAG9C5qE,aAAa0wG,IAEbx8C,EAAa,IAAKw8C,GAAYlwG,YAC7B,KACCuxB,GAAgBg5E,GAAyB9Q,IAA2B,EAAMA,GAAyB,GAEpGic,GAEF,CAoDD,GAjD+C,IAA3CjiD,EAAOzjC,GAAGQ,MAAM,GAA2E,MAA1CijC,EAAOzjC,GAAGQ,MAAM,GAAsG,KAApEijC,EAAOzjC,GAAGQ,MAAM,KACtHkjC,EAAa,IAAK6iC,GAAqBoD,KAAoBvD,KAAqBC,KAAsBoD,IAG5C,QAAvDhmC,EAAOzjC,GAAGQ,MAAM,GAA8G,KAA7DijC,EAAOzjC,GAAGQ,MAAM,KAEpFkjC,EAAa,IAAK8iC,MAA2BoD,IAAyBjB,KAAmB8R,KAGd,KAAxEh3C,EAAOzjC,GAAGQ,MAAM,KAInBkjC,EAAa,IAAK+iC,GAAoB0C,IAA6BO,SAAsDzgG,IAAhCygG,GAAmB9kB,WAA2B8kB,GAAmB93F,UAG5G,IAA3C6xD,EAAOzjC,GAAGQ,MAAM,GAA2E,KAA1CijC,EAAOzjC,GAAGQ,MAAM,KACpEkjC,EAAa,IAAKgjC,GAAiCiD,MAAqBA,GAAgB55F,OAASs2F,KAG9D,EAAhC5iC,EAAOzjC,GAAGQ,MAAM,GAA8D,KAA1CijC,EAAOzjC,GAAGQ,MAAM,KACvDkjC,EAAa,IAAKijC,GAAuBtsB,KAAYsvB,IAElDA,GAAgB/3F,UAAY+3F,GAAgB55F,MAC5Co3C,GAAckzB,GAAOsrC,qBAAqBhc,IAAkBA,GAAgB55F,OAAS45F,GAAgB55F,MAAM6S,SAAU,IAAK,KAC1Hy3D,GAAOsrC,qBAAqB,CAC5B/gC,SAAU/qC,IACV1X,KAAM,mBALPk4C,GAAOsrC,qBAAqBhc,MASK,EAAhClmC,EAAOzjC,GAAGQ,MAAM,GAAiE,KAA7CijC,EAAOzjC,GAAGQ,MAAM,KACvDkjC,EAAa,IAAKkjC,GAA0B8C,IAAsBrvB,IAAUA,GAAOurC,wBAAwBlc,KAG3D,KAA7CjmC,EAAOzjC,GAAGQ,MAAM,KACnBkjC,EAAa,IAAKmjC,GAAuB6C,KAAuBA,GAAmB/rD,qBACjF+rD,GAAmBhsD,aACnB7D,MAG8C,KAA7C4pB,EAAOzjC,GAAGQ,MAAM,KACnBkjC,EAAa,IAAKojC,GAAoC4C,KAAuBA,GAAmB35F,OAGhD,KAA7C0zD,EAAOzjC,GAAGQ,MAAM,KACnBkjC,EAAa,IAAKqjC,GAAyB2C,IAAsBA,GAAmB35F,OAGjD,EAAhC0zD,EAAOzjC,GAAGQ,MAAM,GAA+D,IAA3CijC,EAAOzjC,GAAGQ,MAAM,GAAiE,MAAhCijC,EAAOzjC,GAAGQ,MAAM,GAAoT,QAA5RijC,EAAOzjC,GAAGQ,MAAM,GAChJ,GAAIxc,GAAQ,CACX,IAAIm0D,EACAyM,EACAihC,EACAC,EACAC,EACAv4G,EAASwW,MAASm0D,EAAQn0D,IAE1B6J,GAAS7J,IAAS4gE,EAAW5gE,GAAiB3W,MAAMC,QAAQ0W,OAC9Dm0D,EAAOyM,EAAUmhC,GAAiB/hG,IAClB,IAAb4gE,IAAoBkhC,GAAU,GAC9Bj4F,GAAS+2D,KAAWihC,GAAe,IAGxCniD,EAAa,GAAI08C,IAAejoC,GAASyM,IAAa,CACrDx0D,KAAM+nD,EACNknB,MAAOymB,GAAWD,EAClB/lB,kBAAmB,CAAE5wB,QAAS22C,EAAcjhC,YAC5Cqb,YAAa6lB,GAAW,CACvB3tC,MAAOkC,GAAO2rC,uBACdztC,KAAM8B,GAAO4rC,sBACbztC,QAASutC,GAAiB,KAAOriD,EAAa,IAAK1/C,QAAS/a,MAG/D,MACCy6D,EAAa,GAAI08C,GADP/lC,IAAUgsB,IAAqBD,IAAoBG,IAAsBC,GACpD,CAC9Bp2E,KAAMu2E,GACNtH,MAAO+G,IAAoBM,GAC3B5G,kBAAmB,CAClB5wB,QAASw3B,GACT9hB,SAAU0hB,IAEXrG,YAAamG,IAAoB,CAChCjuB,MAAOkC,GAAO2rC,uBACdztC,KAAM8B,GAAO4rC,sBACbztC,QAASmoC,KAGDtmC,IAAUosB,IAAqBG,GACV,CAC9Bx2E,KAAMw2E,GACNvH,MAAO0H,IAA0BD,GACjChH,kBAAmB,CAClB5wB,QAAS43B,GACTliB,SAAUiiB,IAEX5G,YAAa8G,IAA0B,CACtC5uB,MAAOkC,GAAO2rC,uBACdztC,KAAM8B,GAAO4rC,sBACbztC,QAASooC,UAIoB33G,GAuCjC,GAnCoC,MAAhCw6D,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAKsjC,QAA4B/9F,IAAX+a,IAGK,OAArCy/C,EAAOzjC,GAAGQ,MAAM,GAA+D,GAAjCijC,EAAOzjC,GAAGQ,MAAM,GAAmE,KAA7CijC,EAAOzjC,GAAGQ,MAAM,KACnGskE,GAAW4E,IAAsBA,GAAmB93F,WACvDuuG,GAAmB30G,KAAI,GACvBwE,YAAW,IAAMmwG,GAAmB30G,KAAI,IAAQ4uE,GAAc,IAAM,IAIpC,EAA9B3W,EAAOzjC,GAAGQ,MAAM,GAAwD,KAAtCijC,EAAOzjC,GAAGQ,MAAM,GAAgF,KAAnDijC,EAAOzjC,GAAGQ,MAAM,KAClGipE,IAA4B9mE,IAAQA,GAAKyF,cAAc6sD,GAAW,aAAcqP,IAGjB,IAA5D7gC,EAAOzjC,GAAGQ,MAAM,GAA2K,QAAzHijC,EAAOzjC,GAAGQ,MAAM,GAAiK,IAA9CijC,EAAOzjC,GAAGQ,MAAM,KACxNkjC,EAAa,IAAKujC,GAAiBuC,IAAuBtD,IAAmBG,IAAqBD,IAAoBG,IAAsBC,IAA0BC,IAAqBO,IAGhJ,QAAxCvjC,EAAOzjC,GAAGQ,MAAM,IACnBe,GAAgB68E,GAAe7U,GAAiBtC,GAAiB,EAAI,EAAGsC,IAGhC,OAArC9lC,EAAOzjC,GAAGQ,MAAM,GAAsE,QAAxCijC,EAAOzjC,GAAGQ,MAAM,IACjE49E,GAAc5yG,IAAIy7F,GAAiB,EAAI,EAAG,CAAEzhE,SAAU40C,GAAc,IAAM,IAG/B,QAAxC3W,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,GAAIwjC,GAAkBqC,GAAiB,GAGZ,EAArC9lC,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAKyjC,MAAciZ,KAAeA,GAAY/gB,QAGW,OAAnE57B,EAAOzjC,GAAGQ,MAAM,GAA2G,SAA/CijC,EAAOzjC,GAAGQ,MAAM,GAA4E,IAAlCijC,EAAOzjC,GAAGQ,MAAM,GAA+D,IAAvCijC,EAAOzjC,GAAGQ,MAAM,KAC7L0mE,IAAmBkZ,GAAa,CACnC5wG,aAAakxG,IACb,MAAMwF,EAAc,CAAEnmD,MAAsB,IAAhBqa,IAG5B,GAAI+sB,GAAU,CAEb,MAAMpnC,IAASqgD,GAAYrwG,QAAUqqE,GAErCkmC,GAAa90G,IAAI,EAAG06G,GAGpB7F,GAAY70G,IAAI89F,GAAc,CAAEvpC,SAGhC2D,EAAa,IAAKg9C,GAAwB1wG,YACzC,KACCuwG,GAAW/0G,IAAI,GAAI06G,EAAY,GAEhC,GAEF,MACC5F,GAAa90G,IAAI,EAAG06G,GAEpBxiD,EAAa,IAAKg9C,GAAwB1wG,YACzC,KACCuwG,GAAW/0G,IAAI,EAAG06G,EAAY,GAE/B,GAGH,CAuLD,GApL6C,IAAzCziD,EAAOzjC,GAAGQ,MAAM,KACd0mE,KACJuZ,GAAaj1G,SAAIvC,EAAW,CAAE82D,MAAM,IACpCsgD,GAAY70G,SAAIvC,EAAW,CAAE82D,MAAM,IACnCwgD,GAAW/0G,IAAI,EAAG,CAAEu0D,MAAM,MAIc,IAAtC0D,EAAOzjC,GAAGQ,MAAM,KACnBkjC,EAAa,IAAK0jC,GAA6B,GAAdiC,IAGQ,IAAtC5lC,EAAOzjC,GAAGQ,MAAM,GAAoE,GAAxCijC,EAAOzjC,GAAGQ,MAAM,KAC/DkjC,EAAa,GAAI2jC,GAAkB,yBAAyB+B,GAAgBhC,SAGhC,IAAzC3jC,EAAOzjC,GAAGQ,MAAM,GAAuE,EAAxCijC,EAAOzjC,GAAGQ,MAAM,KAElEkjC,EAAa,GAAIqkC,GAAUY,KAAkBzC,IAGT,GAAjCziC,EAAOzjC,GAAGQ,MAAM,GAA6E,GAAvDijC,EAAOzjC,GAAGQ,MAAM,IACzDkjC,EAAa,IAAK6jC,GAAsBD,KAAyBS,IAAWjD,GAC1EniC,GACAr5D,GAG8C,GAA7Cm6D,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,GAAI8jC,GAAkBD,IAGa,GAA7C9jC,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,GAAIyS,GAAoBoxB,IAGF,EAAhC9jC,EAAOzjC,GAAGQ,MAAM,GAA4D,OAAxCijC,EAAOzjC,GAAGQ,MAAM,GAAoH,WAAnFijC,EAAOzjC,GAAGQ,MAAM,GAAkJ,EAAlEijC,EAAOzjC,GAAGQ,MAAM,GAA2H,GAArEijC,EAAOzjC,GAAGQ,MAAM,GAAyF,GAA/BijC,EAAOzjC,GAAGQ,MAAM,KAExVkjC,EAAa,GAAI+jC,GAAeptB,IAAU6uB,IAz8K/B,CAACx3E,IACX,IACI,OAAOA,GAIX,CAFA,MAAOrgB,GACHkT,QAAQxU,MAAMsB,EAClB,GAm8K2D80G,EAAQ,IAAM3X,GACzE,CACC,CACC,MACA,QACA,CAAE9uF,MAAO,mBACT,CACC,CACC,MACA,YACA,CAAEA,MAAO,iBACT,CAECqvF,IAAqB,CACpB,SACA,QACA,CACC52B,MAAOkC,GAAO+rC,WACd7tC,KAAM8B,GAAOgsC,gBACb7tC,QAAS,IAAMvwC,GAAS,SACxBqwC,WAAW,IAIbq2B,IAAsB,CACrB,SACA,SACA,CACCx2B,MAAOkC,GAAOisC,kBACd/tC,KAAM8B,GAAOksC,iBACb/kD,UAAWwiC,EACXxrB,QAAS6kC,GACT/kC,WAAW,QAOjB,CACC,MACA,OACA,CACC54D,MAAO,wCAER,CACCkvF,IAAyB,CACxB,MACA,UACA,CAAElvF,MAAO,iBACT,CACC,CACC,SACA,OACA,CACCy4D,MAAOkC,GAAOmsC,gBACdjuC,KAAM8B,GAAOosC,eACbjlD,UAAWwiC,EACXxrB,QAASskC,GAAQI,KACjB5kC,WAAW,IAGb,CACC,SACA,OACA,CACCH,MAAOkC,GAAOqsC,gBACdnuC,KAAM8B,GAAOssC,eACbnlD,UAAWyiC,EACXzrB,QAASskC,GAAQM,KACjB9kC,WAAW,MAKfgtB,EAAgBt+F,QAAU,CACzB,MACA,eACA,CAAE0Y,MAAO,iBACT4lF,EAAgBhjF,OAAO4gC,SAASlnC,KAChC,EAAE+jB,EAAWn4B,EAAKusB,KAClB,CAAC4L,EAAWn4B,EAAK,IAAKusB,SAIzB,CACC,MACA,QACA,CAAEzU,MAAO,mBACT,CACsB,CACpB,SACA,SACA,CACCy4D,MAAO,eACPI,KAAM2sB,GAAY7qB,GAAOusC,sBACzBlnG,MAAO,sBACP84D,QAAS4oC,GACT9oC,UAAW4sB,IAGbwJ,IAAsB,CACrB,SACA,SACA,CACCv2B,MAAO,WACPI,KAAM2sB,GAAY7qB,GAAOwsC,iBACzBnnG,MAAO,sBACP84D,QAAS0lC,GACT5lC,UAAW4sB,OAMhB,IAAK+D,KACL,IAAMuH,GAAchlG,IAAI,CAAC,QAIc,OAArCi4D,EAAOzjC,GAAGQ,MAAM,IACnBkjC,EAAa,IAAKgkC,GAAgBsB,IAAeA,GAAYr+F,MAAQ,GAAKq+F,GAAYp+F,OAAS,GAG5D,EAAhC64D,EAAOzjC,GAAGQ,MAAM,GAAyE,WAArDijC,EAAOzjC,GAAGQ,MAAM,IACvDkjC,EAAa,GAAIikC,GAAYD,IAAiBrtB,IAAU+pB,GAGX,EAA1C3gC,EAAOzjC,GAAGQ,MAAM,KAEnBkjC,EAAa,IAAKkkC,GAAoBgB,MAAqBA,GAAgB5hG,QAG7B,UAA3Cy8D,EAAOzjC,GAAGQ,MAAM,GAA2E,SAApCijC,EAAOzjC,GAAGQ,MAAM,GAAyE,EAA1CijC,EAAOzjC,GAAGQ,MAAM,KAEzHkjC,EAAa,IAAKmkC,GAAuBD,IAAqBvpE,GAA6B8pE,GAAYS,KAGnC,UAAjEnlC,EAAOzjC,GAAGQ,MAAM,GAA6I,GAAhFijC,EAAOzjC,GAAGQ,MAAM,KAEhGonE,IAv4C6B,EAACkf,EAAkB7mE,EAAgB4nD,EAAsBzkD,KACvF,IAAKnD,EAAgB,OAGrB,MAAM8mE,EAAgB,CAAEzjE,eAAgBukD,GAEpCzkD,GAAwBA,EAAqB,GAAK,IACrD2jE,EAAcvvF,gBAAkB,IAAI4rB,IAGrCnD,EAAe6mE,EAAkBC,GAAep2G,MAAK0yC,IAEhDq+D,IAAuB51G,EAAc41G,IAGzCh+C,EAAa,IAAKg+C,GAAwBr+D,EAAgB,GACzD,EAu3CoB2jE,CAAuBre,GAAeG,GAAiBjB,GAAsBgB,IAGhD,SAA/CplC,EAAOzjC,GAAGQ,MAAM,GAA8E,SAApCijC,EAAOzjC,GAAGQ,MAAM,GAAyE,EAA1CijC,EAAOzjC,GAAGQ,MAAM,KACxHooE,IAAmB8Y,IAAyBvZ,GAAY,CAE3D,MAAM,MAAEx9F,EAAK,OAAEC,GAAWu9F,GAG1BzkC,EAAa,GAAI2E,GAAcugC,GAAgB5sF,KAAI0Z,IAClD,MAAM3b,EAAOY,GAAW+a,EAAMjgB,EAAGigB,EAAMhgB,EAAGggB,EAAM/qB,MAAO+qB,EAAM9qB,QAEvDywB,EADUvf,GAAWhC,GAAYC,GAAO2b,EAAMnQ,UAClBvJ,KAAIY,GAAUpH,GAAaoH,EAAOnH,EAAI9K,EAAOiS,EAAOlH,EAAI9K,KAE1F,MAAO,IACH8qB,EACH7lB,GAAI,YACJ0H,OAAO,EACPC,OAAO,EACPwgB,aAAc,EACdX,YAAa,EACbC,iBAAaruB,EACbuuB,gBAAiB,CAAC,EAAG,EAAG,GACxBC,gBAAiBiqF,GACjBp7C,yBAA0B,YAC1BjrC,oBACA,IAEH,CAGuC,GAApCooC,EAAOzjC,GAAGQ,MAAM,IACnBmhF,IAAcC,GAAgBp2G,IAAIm2G,IAGD,EAA9Bl+C,EAAOzjC,GAAGQ,MAAM,GAAmD,GAAjCijC,EAAOzjC,GAAGQ,MAAM,IAErDunE,IAAWplE,GAAKyF,cAAc6sD,GAAW,UAGI,MAA1CxxB,EAAOzjC,GAAGQ,MAAM,IAnvCqBkjC,EAAa,GAAIu+C,IAA6B,GAuvCL,UAA9Ex+C,EAAOzjC,GAAGQ,MAAM,IArvC6BkjC,EAAa,GAAIogD,IAAuC,GAyvC3D,MAA1CrgD,EAAOzjC,GAAGQ,MAAM,IApvCqBkjC,EAAa,GAAIy+C,IAA6B,GAwvC9C,MAArC1+C,EAAOzjC,GAAGQ,MAAM,IAnvCgBkjC,EAAa,GAAI2+C,IAAwB,GAuvCpC,EAArC5+C,EAAOzjC,GAAGQ,MAAM,IAlvCgBkjC,EAAa,GAAI4+C,IAAwB,EAovC7E,EAGD5+C,EAAa,IAAK2/B,GAAsBpgC,MAExC8gC,EAAsD,IAA1B3d,KAC1B14D,IACKA,IACL/W,GAAY+W,EAAWmG,OAAQ9lB,KAAK4Y,OACpChQ,GAAY+W,EAAWwvC,YAAanvD,KAAK4Y,OAAM,EAE/C7S,EAKF4vD,EAAa,IAAKuiC,GAAkB,EAAEvP,MAAmB,SAASp0E,OAAO4gC,UAIzEwgB,EAAa,IAAK4jC,GAAuBviF,OAxpLrB,OAAb+xE,KACAA,GAAWjyE,GAAY,YACpBiyE,IAspLyD3pC,OAGnEuW,EAAa,GAAIokC,GA/mMK,EAACmf,EAAOxrE,GAAS,IAAU7rC,IAC/B,SAAXA,EAAE/B,OAEF4tC,GACA7rC,EAAEq0B,kBACNgjF,EAAMr3G,EAAE+0B,OAAO92B,KAAM+B,EAAE+0B,OAAOh9B,MAAK,EA0mMTu/G,CAAiBvZ,GAAWl+E,MAElD,CACN+pE,GACA+W,GACA5tE,GACA03C,GACAxqE,GACAq+F,GACAC,GACAC,GACAG,GACAM,GACAO,GACAQ,GACAC,GACAC,GACAC,GACApX,GACAC,GACAE,GACAmX,GACAjX,GACAC,GACAiX,GACA/W,GACAC,GACAC,GACAiX,GACAU,GACA0J,GACAoC,GACAV,GACAC,GACA5iB,GACAC,GACA0mB,GACA/3C,GACAs5C,GACApd,EACAwD,GACA7B,GACAgB,GACAb,GACA/B,EACAnB,EACAsB,EACAJ,EACA4D,GACAC,GACAK,GACAS,GACAE,GACA9uB,GACAmvB,GACAM,GACAiB,GACAI,GACAC,GACA+T,GACA+C,GACA6B,GACA3B,GACAE,GACAC,GACAxa,GACAH,GACAF,GACAtxB,GACAqxB,GACAH,GACAtB,GACAD,GACAX,EACAT,EACA/zB,EACA5C,EACAy2B,EACAiG,GACA+B,GACAE,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAgD,GACAC,GACAE,GACAY,GACA3rF,GACA4rF,GACAC,GACAv3E,GACAw3E,GACAvyD,GACAtC,GACA80D,GACA9+D,GACAq/D,GACAC,GACA/uD,GACAsvD,GACAC,GACAC,GACAC,GACAp0D,GACAtC,GACA6D,GACAC,GACAh8B,GACAi8B,GACAu4C,GACAC,GACAsb,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACA3zC,GACAg5B,GACA6a,GACAC,GACAC,GACAC,GACAC,GACAlb,GACAob,GACAE,GACA/wC,GACAgxC,GACAC,GACAC,GACAC,GACAnb,GACAsb,GACAC,GACAC,GACAS,GACAI,GACA1c,GACA6c,GACA5c,GACAE,GACAT,GACAyd,GACAjd,GACAmd,GACAI,GACAhe,GACAyf,GACAgB,GACAC,GACAE,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAO,GACAn2C,GACAo2C,GACA0B,GACA/nF,GACAspF,GACApD,GACA+D,GACAG,GA93D2B,EAAG3jG,SAAQ+rG,mBAClC/rG,IAAWunB,IAAS,qBAAuBl3B,KAAK07G,IAChDthB,IAA0B8Z,IAAY,EA83D1CC,GACAxB,GACA+B,GACAE,GACAC,GACAC,GACAC,GACAC,GAhzDmB7wG,IAEnB,MAAMmwD,KAAUqgD,KAAeA,GAAYngB,eAAiB7lB,GAG5DomC,GAAYh1G,IAAIoE,EAAE+0B,OAAOh6B,MAAO,CAAEo1D,SAGlC0gD,GAAaj1G,IAAIuC,KAAK4Y,MAAwB,IAAjB/W,EAAE+0B,OAAOh6B,OAAc,CAAEo1D,QAAO,EA0yD7D8gD,GACAG,GAxwDqBpxG,IACrB,MAAM,QAAEw3G,EAAO,QAAEC,EAAO,QAAEC,EAAO,SAAE11C,GAAahiE,EAGhD,GAAgB,IAAZw3G,GAAiB5lD,GAEpB,YADA5xD,EAAE+yD,iBAUH,GALI/yD,EAAEwL,QAAsB,KAAZgsG,GAAkBzkF,GAAKq0C,SAASpnE,EAAEwL,UAAY85E,GAAYtlF,EAAEwL,SAC3ExL,EAAE+yD,iBAIa,KAAZykD,IAAmBC,GAAWC,GASjC,YARI11C,GAAYy1C,EAEfvK,GAAQM,OAGRN,GAAQI,QAIH,GAAgB,KAAZkK,GAAkBE,EAI5B,YAFAxK,GAAQM,OAOT,GAAgB,MAAZgK,EAAiB,OAErB,GAAIC,GAAWC,EAAS,OAGxB,MAAMC,EAAS,IAAIjmF,IAAI,IAAIynE,GAAmBqe,IAE9CpG,GAAiBx1G,IAAI6B,MAAM0kB,KAAKw1F,GAAQ,EAGrB,EAAG3/G,MAAKw/G,cAE3B,GAAY,SAARx/G,EAAgB,OAAOo5G,GAAiBx1G,IAAI,IAEhDw1G,GAAiBx1G,IAAIu9F,GAAkBzmF,QAAOklG,GAAcA,IAAeJ,IAAS,EAI5D,KACxBpG,GAAiBx1G,IAAI,GAAG,EAICoE,IACrBslF,GAAYtlF,EAAEwL,SAClBxL,EAAE+yD,gBAAgB,EAeK/yD,IAElBo/F,IAELiS,GAAerxG,EAAE+0B,OAAOk+B,UAAU,GAAG,EAgsDrCu+C,GAnrDmBxxG,IAEnB,IAAKq/F,GAAkB,OAGvB,MAAMwY,EAAcvzE,IAAO7qC,OAAO03G,WAAahzG,KAAKsG,IAAI8jF,GAAU1iF,IAAM0iF,GAAUxtF,MAAO,EAAG,GAEtF+8G,EAAcxzE,IAAO7qC,OAAOs+G,YAAc55G,KAAKsG,IAAI8jF,GAAUziF,IAAMyiF,GAAUvtF,OAAQ,EAAG,GAG1F68G,EAAc,KAAQC,EAAc,KAGxCzG,IAAgBrxG,EAAEg4G,eAAiBv+G,OAAOu+G,eAAepG,MAAM,GAAG,EAwqDlEK,GACAuB,GAl7CyBxzG,IAErBo4F,IAAatsF,GAAU9L,EAAE+0B,OAAQqjE,KAGrCzmE,GAAgBozE,GAAU3M,GAAYp4F,EAAE+0B,OAAQqjE,GAAU,EA+6C1DhkF,GACA82F,GACAhtC,GACA8/B,GACA3/D,GACA4/D,GACAC,GACAC,GACAvsC,GACAwsC,GACAC,GACAI,GACAC,GACAE,GACAC,GACAC,GACAC,GACAC,GACAE,GACAC,GACAC,GACAC,GACAC,GACAC,GACAE,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAK,GACAnX,GACAE,GACAoX,GACAC,GACAC,GACAhhF,GACAqhF,GACA+J,GACAwF,GACAC,GACAQ,GACAgB,GACA7Z,GACAD,GACAxD,EACAsD,GACAxC,EACAI,EACArB,EACAD,EACAuD,GACAzC,EACAwC,GACAF,GACAD,GACAJ,GACAF,GACAC,GACAF,GACAH,GACAL,GACAE,GACAI,GACAC,GACAH,GACAD,GACAU,GACAD,GACAb,GACAF,GACAD,GACApB,EACAS,EACAD,EACAjhC,EACA6gC,EACAD,EACAE,EACAQ,GACAE,GACAD,GACAF,GACAD,GACAV,EACAF,EACAr4F,EACAu5F,GACAD,GACA1B,EACAC,EACAL,EACAJ,EACAG,EACAD,EACAD,EACAF,EACAD,EACAN,EACAK,EACAF,EACAC,EACA6E,GACAC,GACAC,GACAC,GACApQ,GACAC,GACAG,GACAqQ,GACAC,GACAC,GACAC,GACAG,GACAE,GACAC,GACAC,GACAC,GACAE,GACAC,GACAC,GACAC,GACAC,GACAE,GACAE,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAG,GACAC,GACAC,GACAC,GACAE,GACAC,GACAC,GACAG,GACAC,GACAE,GACAC,GACAzT,GACAC,GACAiU,GACAI,GACAC,GAhkDD,WACC5oC,EAAa,GAAI04C,GAAcvd,GAAWkiB,YAC1Cr9C,EAAa,GAAI24C,GAAexd,GAAW8oB,YAC5C,EAEwB/3G,GAAK2xB,GAAgBmzE,GAAU9H,GAAYh9F,EAAE+0B,OAAQioE,IACtD,EAAGjoE,YAAa++B,EAAa,GAAI4gC,EAAe3/D,GAC1D,CAAC8pC,EAAOo/B,IAASA,EAAKh+F,KAAO4+D,EAE1C,SAAqC/nE,EAAO+nE,GACvChL,EAAOzjC,GAAG0M,UAAU6jE,GAAgB9hC,GAAQ/nE,KAC/C6pG,GAAgB9hC,GAA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","sources":["webpack://imageeditor/./pintura/pintura.js","webpack://imageeditor/./src/index.js"],"sourcesContent":["/*!\r\n* Pintura Image Editor 8.49.2 \r\n* (c) 2018-2022 PQINA Inc. - All Rights Reserved\r\n* License: https://pqina.nl/pintura/license/\r\n*/\r\n/* eslint-disable */\r\n\r\nconst JFIF_MARKER = 0xffe0;\r\nconst EXIF_MARKER = 0xffe1;\r\nconst SOS_MARKER = 0xffda;\r\nconst XMP_MARKER = 0xffe1;\r\nconst MPF_MARKER = 0xffe2;\r\nconst Markers = [\r\n    { value: JFIF_MARKER, name: 'jfif' },\r\n    { value: SOS_MARKER, name: 'sos' },\r\n    { value: EXIF_MARKER, subvalue: 0x4578, name: 'exif' },\r\n    { value: XMP_MARKER, subvalue: 0x6874, name: 'xmp' },\r\n    { value: MPF_MARKER, subvalue: 0x4d50, name: 'mpf' },\r\n];\r\nconst JPEG_SOI_MARKER = 0xffd8; // start of JPEG\r\nconst JPEG_MARKER_PREFIX = 0xff;\r\nvar dataViewGetApplicationMarkers = (view) => {\r\n    // If no SOI marker exit here because we're not going to find the APP1 header in a non-jpeg file\r\n    if (view.getUint16(0) !== JPEG_SOI_MARKER)\r\n        return undefined;\r\n    const length = view.byteLength; // cache the length here\r\n    let offset = 2; // start at 2 as we skip the SOI marker\r\n    let marker; // this will hold the current marker\r\n    // resulting markers\r\n    let res = undefined;\r\n    while (offset < length) {\r\n        // test if marker is valid JPEG marker (starts with ff)\r\n        if (view.getUint8(offset) !== JPEG_MARKER_PREFIX)\r\n            break;\r\n        // let's read the full marker\r\n        marker = view.getUint16(offset);\r\n        // read marker if included in marker types\r\n        const markerDescription = Markers.find((descriptor) => {\r\n            if (descriptor.value === marker) {\r\n                if (descriptor.subvalue)\r\n                    return descriptor.subvalue === view.getUint16(offset + 2 + 2);\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n        if (markerDescription) {\r\n            const { name } = markerDescription;\r\n            if (!res)\r\n                res = {};\r\n            // prevent overwriting by double markers\r\n            if (!res[name]) {\r\n                res[name] = {\r\n                    offset,\r\n                    size: view.getUint16(offset + 2),\r\n                };\r\n            }\r\n        }\r\n        // Image stream starts here, no markers found\r\n        if (marker === SOS_MARKER)\r\n            break;\r\n        // next offset is 2 to skip over marker type and then we add marker data size to skip to next marker\r\n        offset += 2 + view.getUint16(offset + 2);\r\n    }\r\n    // no APP markers found\r\n    return res;\r\n};\r\n\r\nconst APP1_MARKER = 0xffe1;\r\nconst APP1_EXIF_IDENTIFIER = 0x45786966;\r\nconst TIFF_MARKER = 0x002a;\r\nconst BYTE_ALIGN_MOTOROLA = 0x4d4d;\r\nconst BYTE_ALIGN_INTEL = 0x4949;\r\n// offset = start of APP1_MARKER\r\nvar dataViewGetExifTags = (view, offset) => {\r\n    // If no APP1 marker exit here because we're not going to find the EXIF id header outside of APP1\r\n    if (view.getUint16(offset) !== APP1_MARKER)\r\n        return undefined;\r\n    // get marker size\r\n    const size = view.getUint16(offset + 2); // 14197\r\n    // Let's skip over app1 marker and size marker (2 + 2 bytes)\r\n    offset += 4;\r\n    // We're now at the EXIF header marker (we'll only check the first 4 bytes, reads \"exif\"), if not there, exit\r\n    if (view.getUint32(offset) !== APP1_EXIF_IDENTIFIER)\r\n        return undefined;\r\n    // Let's skip over 6 byte EXIF marker\r\n    offset += 6;\r\n    // Read byte alignment\r\n    const byteAlignment = view.getUint16(offset);\r\n    if (byteAlignment !== BYTE_ALIGN_INTEL && byteAlignment !== BYTE_ALIGN_MOTOROLA)\r\n        return undefined;\r\n    const storedAsLittleEndian = byteAlignment === BYTE_ALIGN_INTEL;\r\n    // Skip over byte alignment\r\n    offset += 2;\r\n    // Test if valid tiff marker data, should always be 0x002a\r\n    if (view.getUint16(offset, storedAsLittleEndian) !== TIFF_MARKER)\r\n        return undefined;\r\n    // Skip to first IDF, position of IDF is read after tiff marker (offset 2)\r\n    offset += view.getUint32(offset + 2, storedAsLittleEndian);\r\n    // helper method to find tag offset by marker\r\n    const getTagOffsets = (marker) => {\r\n        const offsets = [];\r\n        let i = offset;\r\n        const max = offset + size - 16;\r\n        for (; i < max; i += 12) {\r\n            const tagOffset = i;\r\n            // see if is match, if not, next entry\r\n            if (view.getUint16(tagOffset, storedAsLittleEndian) !== marker)\r\n                continue;\r\n            // add offset\r\n            offsets.push(tagOffset);\r\n        }\r\n        return offsets;\r\n    };\r\n    return {\r\n        read: (address) => {\r\n            const tagOffsets = getTagOffsets(address);\r\n            if (!tagOffsets.length)\r\n                return undefined;\r\n            // only return first found tag\r\n            return view.getUint16(tagOffsets[0] + 8, storedAsLittleEndian);\r\n        },\r\n        write: (address, value) => {\r\n            const tagOffsets = getTagOffsets(address);\r\n            if (!tagOffsets.length)\r\n                return false;\r\n            // overwrite all found tags (sometimes images can have multiple tags with the same value, let's make sure they're all set)\r\n            tagOffsets.forEach((offset) => view.setUint16(offset + 8, value, storedAsLittleEndian));\r\n            return true;\r\n        },\r\n    };\r\n};\r\n\r\nconst ORIENTATION_TAG = 0x0112;\r\nvar arrayBufferImageExif = (data, key, value) => {\r\n    // no data, no go!\r\n    if (!data)\r\n        return;\r\n    const view = new DataView(data);\r\n    // Get app1 header offset\r\n    const markers = dataViewGetApplicationMarkers(view);\r\n    if (!markers || !markers.exif)\r\n        return;\r\n    // Get EXIF tags read/writer\r\n    const tags = dataViewGetExifTags(view, markers.exif.offset);\r\n    if (!tags)\r\n        return;\r\n    // Read the exif orientation marker\r\n    return value === undefined ? tags.read(key) : tags.write(key, value);\r\n};\r\n\r\nconst backup = '__pqina_webapi__';\r\nvar getNativeAPIRef = (API) => (window[backup] ? window[backup][API] : window[API]);\r\n\r\nvar noop$1 = (...args) => { };\r\n\r\nconst FileReaderDataFormat = {\r\n    ArrayBuffer: 'readAsArrayBuffer',\r\n};\r\nvar readFile = (file, onprogress = noop$1, options = {}) => new Promise((resolve, reject) => {\r\n    const { dataFormat = FileReaderDataFormat.ArrayBuffer } = options;\r\n    const reader = new (getNativeAPIRef('FileReader'))();\r\n    reader.onload = () => resolve(reader.result);\r\n    reader.onerror = reject;\r\n    reader.onprogress = onprogress;\r\n    reader[dataFormat](file);\r\n});\r\n\r\nvar blobReadSection = async (blob, slice = [0, blob.size], onprogress) => (await readFile(blob.slice(...slice), onprogress));\r\n\r\nvar getImageOrientationFromFile = async (file, onprogress) => {\r\n    // 64 * 2048 should be plenty to find extract header\r\n    // Exif metadata are restricted in size to 64 kB in JPEG images because\r\n    // according to the specification this information must be contained within a single JPEG APP1 segment.\r\n    const head = await blobReadSection(file, [0, 64 * 2048], onprogress);\r\n    return arrayBufferImageExif(head, ORIENTATION_TAG) || 1;\r\n};\r\n\r\nlet result$c = null;\r\nvar isBrowser = () => {\r\n    if (result$c === null)\r\n        result$c = typeof window !== 'undefined' && typeof window.document !== 'undefined';\r\n    return result$c;\r\n};\r\n\r\nlet result$b = null;\r\nvar canOrientImages = () => new Promise((resolve) => {\r\n    if (result$b === null) {\r\n        // 2x1 pixel image 90CW rotated with orientation EXIF header\r\n        const testSrc = 'data:image/jpg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4QA6RXhpZgAATU0AKgAAAAgAAwESAAMAAAABAAYAAAEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAD/2wBDAP//////////////////////////////////////////////////////////////////////////////////////wAALCAABAAIBASIA/8QAJgABAAAAAAAAAAAAAAAAAAAAAxABAAAAAAAAAAAAAAAAAAAAAP/aAAgBAQAAPwBH/9k=';\r\n        let testImage = isBrowser() ? new Image() : {};\r\n        testImage.onload = () => {\r\n            // should correct orientation if is presented in landscape,\r\n            // in which case the browser doesn't autocorrect\r\n            result$b = testImage.naturalWidth === 1;\r\n            testImage = undefined;\r\n            resolve(result$b);\r\n        };\r\n        testImage.src = testSrc;\r\n        return;\r\n    }\r\n    return resolve(result$b);\r\n});\r\n\r\nvar canvasToImageData = (canvas) => {\r\n    const imageData = canvas\r\n        .getContext('2d')\r\n        .getImageData(0, 0, canvas.width, canvas.height);\r\n    return imageData;\r\n};\r\n\r\nvar h = (name, attributes, children = []) => {\r\n    const el = document.createElement(name);\r\n    // @ts-ignore\r\n    const descriptors = Object.getOwnPropertyDescriptors(el.__proto__);\r\n    for (const key in attributes) {\r\n        if (key === 'style') {\r\n            el.style.cssText = attributes[key];\r\n        }\r\n        else if ((descriptors[key] && descriptors[key].set) ||\r\n            /textContent|innerHTML/.test(key) ||\r\n            typeof attributes[key] === 'function') {\r\n            el[key] = attributes[key];\r\n        }\r\n        else {\r\n            el.setAttribute(key, attributes[key]);\r\n        }\r\n    }\r\n    children.forEach((child) => el.appendChild(child));\r\n    return el;\r\n};\r\n\r\nconst MATRICES = {\r\n    1: () => [1, 0, 0, 1, 0, 0],\r\n    2: (width) => [-1, 0, 0, 1, width, 0],\r\n    3: (width, height) => [-1, 0, 0, -1, width, height],\r\n    4: (width, height) => [1, 0, 0, -1, 0, height],\r\n    5: () => [0, 1, 1, 0, 0, 0],\r\n    6: (width, height) => [0, 1, -1, 0, height, 0],\r\n    7: (width, height) => [0, -1, -1, 0, height, width],\r\n    8: (width) => [0, -1, 1, 0, 0, width],\r\n};\r\nvar getImageOrientationMatrix = (width, height, orientation = -1) => {\r\n    if (orientation === -1)\r\n        orientation = 1;\r\n    return MATRICES[orientation](width, height);\r\n};\r\n\r\nvar releaseCanvas = (canvas) => {\r\n    canvas.width = 1;\r\n    canvas.height = 1;\r\n    const ctx = canvas.getContext('2d');\r\n    ctx && ctx.clearRect(0, 0, 1, 1);\r\n};\r\n\r\nvar isImageData = (obj) => 'data' in obj;\r\n\r\nvar imageDataToCanvas = async (imageData, orientation = 1) => {\r\n    const [width, height] = (await canOrientImages()) || orientation < 5\r\n        ? [imageData.width, imageData.height]\r\n        : [imageData.height, imageData.width];\r\n    const canvas = h('canvas', { width, height });\r\n    const ctx = canvas.getContext('2d');\r\n    // transform image data ojects into in memory canvas elements so we can transform them (putImageData isn't affect by transforms)\r\n    if (isImageData(imageData) && !(await canOrientImages()) && orientation > 1) {\r\n        const inMemoryCanvas = h('canvas', {\r\n            width: imageData.width,\r\n            height: imageData.height,\r\n        });\r\n        const ctx = inMemoryCanvas.getContext('2d');\r\n        ctx.putImageData(imageData, 0, 0);\r\n        imageData = inMemoryCanvas;\r\n    }\r\n    // get base transformation matrix\r\n    if (!(await canOrientImages()) && orientation > 1) {\r\n        ctx.transform.apply(ctx, getImageOrientationMatrix(imageData.width, imageData.height, orientation));\r\n    }\r\n    // can't test for instanceof ImageBitmap as Safari doesn't support it\r\n    // if still imageData object by this point, we'll use put\r\n    if (isImageData(imageData)) {\r\n        ctx.putImageData(imageData, 0, 0);\r\n    }\r\n    else {\r\n        ctx.drawImage(imageData, 0, 0);\r\n    }\r\n    // if image data is of type canvas, clean it up\r\n    if (imageData instanceof HTMLCanvasElement)\r\n        releaseCanvas(imageData);\r\n    return canvas;\r\n};\r\n\r\nvar orientImageData = async (imageData, orientation = 1) => {\r\n    if (orientation === 1)\r\n        return imageData;\r\n    // correct image data for when the browser does not correctly read exif orientation headers\r\n    if (!(await canOrientImages()))\r\n        return canvasToImageData(await imageDataToCanvas(imageData, orientation));\r\n    return imageData;\r\n};\r\n\r\nvar isObject = (v) => typeof v === 'object';\r\n\r\nconst copy = (val) => (isObject(val) ? deepCopy(val) : val);\r\nconst deepCopy = (src) => {\r\n    let dst;\r\n    if (Array.isArray(src)) {\r\n        dst = [];\r\n        src.forEach((val, i) => {\r\n            dst[i] = copy(val);\r\n        });\r\n    }\r\n    else {\r\n        dst = {};\r\n        Object.keys(src).forEach((key) => {\r\n            const val = src[key];\r\n            dst[key] = copy(val);\r\n        });\r\n    }\r\n    return dst;\r\n};\r\n\r\nvar isString = (v) => typeof v === 'string';\r\n\r\nvar isFunction = (v) => typeof v === 'function';\r\n\r\nvar imageToCanvas = (image, { width, height, canvasMemoryLimit, }) => {\r\n    let canvasWidth = width || image.naturalWidth;\r\n    let canvasHeight = height || image.naturalHeight;\r\n    // if no width and no height use defaults\r\n    if (!canvasWidth && !canvasHeight) {\r\n        // if these are 0 it's possible that we're trying to convert an SVG that doesn't have width or height attributes\r\n        // https://bugzilla.mozilla.org/show_bug.cgi?id=1328124\r\n        canvasWidth = 300;\r\n        canvasHeight = 150;\r\n    }\r\n    // determine if requires more memory than limit, if so limit target size\r\n    const requiredCanvasMemory = canvasWidth * canvasHeight;\r\n    if (canvasMemoryLimit && requiredCanvasMemory > canvasMemoryLimit) {\r\n        const canvasScalar = Math.sqrt(canvasMemoryLimit) / Math.sqrt(requiredCanvasMemory);\r\n        canvasWidth = Math.floor(canvasWidth * canvasScalar);\r\n        canvasHeight = Math.floor(canvasHeight * canvasScalar);\r\n    }\r\n    // create new canvas element\r\n    const canvas = h('canvas');\r\n    canvas.width = canvasWidth;\r\n    canvas.height = canvasHeight;\r\n    const ctx = canvas.getContext('2d');\r\n    ctx.drawImage(image, 0, 0, canvasWidth, canvasHeight);\r\n    return canvas;\r\n};\r\n\r\n// turns image into canvas only after it's fully loaded\r\nvar imageToCanvasSafe = (image, options) => new Promise((resolve, reject) => {\r\n    const ready = () => resolve(imageToCanvas(image, options));\r\n    if (image.complete && image.width) {\r\n        // need to test for image.width, on ie11 it will be 0 for object urls\r\n        ready();\r\n    }\r\n    else {\r\n        image.onload = ready;\r\n        image.onerror = reject;\r\n    }\r\n});\r\n\r\nvar blobToCanvas = async (imageBlob, canvasMemoryLimit) => {\r\n    const imageElement = h('img', {\r\n        src: URL.createObjectURL(imageBlob),\r\n    });\r\n    const canvas = await imageToCanvasSafe(imageElement, { canvasMemoryLimit });\r\n    URL.revokeObjectURL(imageElement.src);\r\n    return canvas;\r\n};\r\n\r\nvar canCreateImageBitmap = () => 'createImageBitmap' in window;\r\n\r\nvar canCreateOffscreenCanvas = () => 'OffscreenCanvas' in window;\r\n\r\nvar isSVGFile = (blob) => /svg/.test(blob.type);\r\n\r\nvar getUniqueId = () => Math.random()\r\n    .toString(36)\r\n    .substr(2, 9);\r\n\r\nvar functionToBlob = (fn) => new Blob(['(', typeof fn === 'function' ? fn.toString() : fn, ')()'], {\r\n    type: 'application/javascript',\r\n});\r\n\r\nconst wrapFunction = (fn) => `function () {self.onmessage = function (message) {(${fn.toString()}).apply(null, message.data.content.concat([function (err, response) {\r\n    response = response || {};\r\n    const transfer = 'data' in response ? [response.data.buffer] : 'width' in response ? [response] : [];\r\n    return self.postMessage({ id: message.data.id, content: response, error: err }, transfer);\r\n}]))}}`;\r\nconst workerPool = new Map();\r\nvar thread = (fn, args, transferList) => new Promise((resolve, reject) => {\r\n    const workerKey = fn.toString();\r\n    let pooledWorker = workerPool.get(workerKey);\r\n    if (!pooledWorker) {\r\n        // create worker for this function\r\n        const workerFn = wrapFunction(fn);\r\n        // create a new web worker\r\n        const url = URL.createObjectURL(functionToBlob(workerFn));\r\n        const messages = new Map();\r\n        const worker = new Worker(url);\r\n        // create a pooled worker, this object will contain the worker and active messages\r\n        pooledWorker = {\r\n            url,\r\n            worker,\r\n            messages,\r\n            terminationTimeout: undefined,\r\n            terminate: () => {\r\n                clearTimeout(pooledWorker.terminationTimeout);\r\n                pooledWorker.worker.terminate();\r\n                URL.revokeObjectURL(url);\r\n                workerPool.delete(workerKey);\r\n            },\r\n        };\r\n        // handle received messages\r\n        worker.onmessage = function (e) {\r\n            // should receive message id and message\r\n            const { id, content, error } = e.data;\r\n            // automatically clean up workers after half a second\r\n            clearTimeout(pooledWorker.terminationTimeout);\r\n            pooledWorker.terminationTimeout = setTimeout(() => {\r\n                if (messages.size > 0)\r\n                    return;\r\n                pooledWorker.terminate();\r\n            }, 500);\r\n            // message route no longer valid\r\n            if (!messages.has(id))\r\n                return;\r\n            // get related thread and resolve with returned content\r\n            const message = messages.get(id);\r\n            // remove thread from threads cache\r\n            messages.delete(id);\r\n            // resolve or reject message based on response from worker\r\n            error != null ? message.reject(error) : message.resolve(content);\r\n        };\r\n        // pool this worker\r\n        workerPool.set(workerKey, pooledWorker);\r\n    }\r\n    // we need a way to remember this message so we generate a unique id and use that as a key for this request, that way we can link the response back to request in the pooledWorker.onmessage handler\r\n    const messageId = getUniqueId();\r\n    pooledWorker.messages.set(messageId, { resolve, reject });\r\n    // use pooled worker and await response\r\n    pooledWorker.worker.postMessage({ id: messageId, content: args }, transferList);\r\n});\r\n\r\nvar blobToImageData = async (imageBlob, canvasMemoryLimit) => {\r\n    let imageData;\r\n    // if can use OffscreenCanvas let's go for it as it will mean we can run this operation on a separate thread\r\n    if (canCreateImageBitmap() && !isSVGFile(imageBlob) && canCreateOffscreenCanvas()) {\r\n        try {\r\n            imageData = await thread((file, canvasMemoryLimit, done) => {\r\n                createImageBitmap(file)\r\n                    .then((bitmap) => {\r\n                    let canvasWidth = bitmap.width;\r\n                    let canvasHeight = bitmap.height;\r\n                    // determine if requires more memory than limit, if so limit target size\r\n                    const requiredCanvasMemory = canvasWidth * canvasHeight;\r\n                    if (canvasMemoryLimit && requiredCanvasMemory > canvasMemoryLimit) {\r\n                        const canvasScalar = Math.sqrt(canvasMemoryLimit) / Math.sqrt(requiredCanvasMemory);\r\n                        canvasWidth = Math.floor(canvasWidth * canvasScalar);\r\n                        canvasHeight = Math.floor(canvasHeight * canvasScalar);\r\n                    }\r\n                    const canvas = new OffscreenCanvas(canvasWidth, canvasHeight);\r\n                    const ctx = canvas.getContext('2d');\r\n                    ctx.drawImage(bitmap, 0, 0, canvasWidth, canvasHeight);\r\n                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n                    done(null, imageData);\r\n                })\r\n                    .catch((err) => {\r\n                    // fail silently\r\n                    done(err);\r\n                });\r\n            }, [imageBlob, canvasMemoryLimit]);\r\n        }\r\n        catch (err) {\r\n            // fails silently on purpose, we'll try to turn the blob into image data in the main thread\r\n            // console.error(err);\r\n        }\r\n    }\r\n    // use main thread to generate ImageData\r\n    if (!imageData || !imageData.width) {\r\n        const canvas = await blobToCanvas(imageBlob, canvasMemoryLimit);\r\n        imageData = canvasToImageData(canvas);\r\n        releaseCanvas(canvas);\r\n    }\r\n    return imageData;\r\n};\r\n\r\nvar canvasToBlob = (canvas, mimeType = undefined, quality = undefined) => new Promise((resolve, reject) => {\r\n    try {\r\n        canvas.toBlob((blob) => {\r\n            resolve(blob);\r\n        }, mimeType, quality);\r\n    }\r\n    catch (err) {\r\n        reject(err);\r\n    }\r\n});\r\n\r\nvar imageDataToBlob = async (imageData, mimeType, quality) => {\r\n    const canvas = await imageDataToCanvas(imageData);\r\n    const blob = await canvasToBlob(canvas, mimeType, quality);\r\n    releaseCanvas(canvas);\r\n    return blob;\r\n};\r\n\r\nvar blobWriteSection = (blob, section, slice = [0, blob.size]) => {\r\n    if (!section)\r\n        return blob;\r\n    return new Blob([section, blob.slice(...slice)], { type: blob.type });\r\n};\r\n\r\nconst mimeTypes = {\r\n    matroska: 'mkv',\r\n};\r\nvar getExtensionFromMimeType = (mimeType) => {\r\n    const ext = (mimeType.match(/\\/([a-z0-9]+)/) || [])[1];\r\n    if (/^x/.test(ext)) {\r\n        const [, post = ''] = mimeType.split('/x-');\r\n        return mimeTypes[post];\r\n    }\r\n    return ext;\r\n};\r\n\r\nvar getFilenameWithoutExtension = (name) => name.substr(0, name.lastIndexOf('.')) || name;\r\n\r\nvar getExtensionFromFilename = (filename) => filename.split('.').pop();\r\n\r\nconst ImageExtensionsRegex = /avif|bmp|gif|jpg|jpeg|jpe|jif|jfif|png|svg|tiff|webp/;\r\n/*\r\nSupport image mime types\r\n- image/webp\r\n- image/gif\r\n- image/avif\r\n- image/jpeg\r\n- image/png\r\n- image/bmp\r\n- image/svg+xml\r\n*/\r\nvar getMimeTypeFromExtension = (ext) => {\r\n    // empty string returned if extension not found\r\n    if (!ImageExtensionsRegex.test(ext))\r\n        return '';\r\n    // return MimeType for this extension\r\n    return 'image/' + (/jfif|jif|jpe|jpg/.test(ext) ? 'jpeg' : ext === 'svg' ? 'svg+xml' : ext);\r\n};\r\n\r\nvar getMimeTypeFromFilename = (name) => name && getMimeTypeFromExtension(getExtensionFromFilename(name).toLowerCase());\r\n\r\nvar matchFilenameToMimeType = (filename, mimeType) => {\r\n    // get the mime type that matches this extension\r\n    const fileMimeType = getMimeTypeFromFilename(filename);\r\n    // test if type already matches current mime type, no need to change name\r\n    if (fileMimeType === mimeType)\r\n        return filename;\r\n    // get the extension for this mimetype (gets all characters after the \"image/\" part)\r\n    // if mimeType doesn't yield an extension, use the fileMimeType\r\n    const targetMimeTypeExtension = getExtensionFromMimeType(mimeType) || fileMimeType;\r\n    return `${getFilenameWithoutExtension(filename)}.${targetMimeTypeExtension}`;\r\n};\r\n\r\nvar blobToFile = (blob, filename, mimetype) => {\r\n    const lastModified = new Date().getTime();\r\n    const blobHasMimeType = blob.type.length && !/null|text/.test(blob.type);\r\n    const blobMimeType = blobHasMimeType ? blob.type : mimetype;\r\n    const name = matchFilenameToMimeType(filename, blobMimeType);\r\n    try {\r\n        return new (getNativeAPIRef('File'))([blob], name, {\r\n            lastModified,\r\n            type: blobHasMimeType ? blob.type : blobMimeType,\r\n        });\r\n    }\r\n    catch (err) {\r\n        const file = blobHasMimeType ? blob.slice() : blob.slice(0, blob.size, blobMimeType);\r\n        file.lastModified = lastModified;\r\n        file.name = name;\r\n        return file;\r\n    }\r\n};\r\n\r\nvar getAspectRatio = (w, h) => w / h;\r\n\r\nvar passthrough = (v) => (v);\r\n\r\nconst PI = Math.PI;\r\nconst HALF_PI = Math.PI / 2;\r\nconst QUART_PI = HALF_PI / 2;\r\n\r\nvar isRotatedSideways = (a) => {\r\n    const rotationLimited = Math.abs(a) % Math.PI;\r\n    return rotationLimited > QUART_PI && rotationLimited < Math.PI - QUART_PI;\r\n};\r\n\r\n// enum Direction {\r\n//     Top = 't',\r\n//     Right = 'r',\r\n//     Bottom = 'b',\r\n//     Left = 'l',\r\n//     TopLeft = 'tl',\r\n//     TopRight = 'tr',\r\n//     BottomRight = 'br',\r\n//     BottomLeft = 'bl',\r\n// }\r\n// export const { Top, Right, Bottom, Left, TopLeft, TopRight, BottomRight, BottomLeft } = Direction;\r\n// export default Direction;\r\nconst Direction = {\r\n    Top: 't',\r\n    Right: 'r',\r\n    Bottom: 'b',\r\n    Left: 'l',\r\n    TopLeft: 'tl',\r\n    TopRight: 'tr',\r\n    BottomRight: 'br',\r\n    BottomLeft: 'bl',\r\n};\r\nconst { Top, Right, Bottom, Left, TopLeft, TopRight, BottomRight, BottomLeft } = Direction;\r\n\r\nvar DirectionCoordinateTable = {\r\n    [Top]: [0.5, 0],\r\n    [Right]: [1, 0.5],\r\n    [Bottom]: [0.5, 1],\r\n    [Left]: [0, 0.5],\r\n    [TopLeft]: [0, 0],\r\n    [TopRight]: [1, 0],\r\n    [BottomRight]: [1, 1],\r\n    [BottomLeft]: [0, 1],\r\n};\r\n\r\nvar fixPrecision = (value, precision = 12) => parseFloat(value.toFixed(precision));\r\n\r\n//\r\n// generic\r\n//\r\nconst scale = (value, scalar, pivot) => pivot + (value - pivot) * scalar;\r\nconst ellipseCreateFromRect = (rect) => ({\r\n    x: rect.x + rect.width * 0.5,\r\n    y: rect.y + rect.height * 0.5,\r\n    rx: rect.width * 0.5,\r\n    ry: rect.height * 0.5,\r\n});\r\n//\r\n// vector\r\n//\r\nconst vectorCreateEmpty = () => vectorCreate(0, 0);\r\nconst vectorCreate = (x, y) => ({ x, y });\r\nconst vectorCreateFromSize = (size) => vectorCreate(size.width, size.height);\r\nconst vectorCreateFromAny = (obj) => vectorCreate(obj.x, obj.y);\r\nconst vectorCreateFromPointerEvent = (e) => vectorCreate(e.pageX, e.pageY);\r\nconst vectorCreateFromPointerEventOffset = (e) => vectorCreate(e.offsetX, e.offsetY);\r\nconst vectorClone = (v) => vectorCreate(v.x, v.y);\r\nconst vectorUpdate = (v, x, y) => {\r\n    v.x = x;\r\n    v.y = y;\r\n    return v;\r\n};\r\nconst vectorInvert = (v) => {\r\n    v.x = -v.x;\r\n    v.y = -v.y;\r\n    return v;\r\n};\r\nconst vectorPerpendicular = (v) => {\r\n    const x = v.x;\r\n    v.x = -v.y;\r\n    v.y = x;\r\n    return v;\r\n};\r\nconst vectorRotate = (v, radians, pivot = vectorCreateEmpty()) => {\r\n    const cos = Math.cos(radians);\r\n    const sin = Math.sin(radians);\r\n    const tx = v.x - pivot.x;\r\n    const ty = v.y - pivot.y;\r\n    v.x = pivot.x + cos * tx - sin * ty;\r\n    v.y = pivot.y + sin * tx + cos * ty;\r\n    return v;\r\n};\r\nconst vectorLength = (v) => Math.sqrt(v.x * v.x + v.y * v.y);\r\nconst vectorNormalize = (v) => {\r\n    const length = Math.sqrt(v.x * v.x + v.y * v.y);\r\n    if (length === 0)\r\n        return vectorCreateEmpty();\r\n    v.x /= length;\r\n    v.y /= length;\r\n    return v;\r\n};\r\nconst vectorAngle = (v) => Math.atan2(v.y, v.x);\r\nconst vectorAngleBetween = (a, b) => Math.atan2(b.y - a.y, b.x - a.x);\r\nconst vectorEqual = (a, b) => a.x === b.x && a.y === b.y;\r\nconst vectorApply = (v, fn) => {\r\n    v.x = fn(v.x);\r\n    v.y = fn(v.y);\r\n    return v;\r\n};\r\nconst vectorAdd = (a, b) => {\r\n    a.x += b.x;\r\n    a.y += b.y;\r\n    return a;\r\n};\r\nconst vectorSubtract = (a, b) => {\r\n    a.x -= b.x;\r\n    a.y -= b.y;\r\n    return a;\r\n};\r\nconst vectorDivide = (v, l) => {\r\n    v.x /= l;\r\n    v.y /= l;\r\n    return v;\r\n};\r\nconst vectorMultiply = (v, f) => {\r\n    v.x *= f;\r\n    v.y *= f;\r\n    return v;\r\n};\r\nconst vectorDot = (a, b) => a.x * b.x + a.y * b.y;\r\nconst vectorCross = (a, b) => a.x * b.y - a.y * b.x;\r\nconst vectorDistanceSquared = (a, b = vectorCreateEmpty()) => {\r\n    const x = a.x - b.x;\r\n    const y = a.y - b.y;\r\n    return x * x + y * y;\r\n};\r\nconst vectorDistance = (a, b = vectorCreateEmpty()) => Math.sqrt(vectorDistanceSquared(a, b));\r\nconst vectorScale = (v, scalar, pivot) => {\r\n    v.x = scale(v.x, scalar, pivot.x);\r\n    v.y = scale(v.y, scalar, pivot.y);\r\n    return v;\r\n};\r\nconst vectorCenter = (v) => {\r\n    let x = 0;\r\n    let y = 0;\r\n    v.forEach((v) => {\r\n        x += v.x;\r\n        y += v.y;\r\n    });\r\n    return vectorCreate(x / v.length, y / v.length);\r\n};\r\nconst vectorsFlip = (points, flipX, flipY, cx, cy) => {\r\n    points.forEach((point) => {\r\n        point.x = flipX ? cx - (point.x - cx) : point.x;\r\n        point.y = flipY ? cy - (point.y - cy) : point.y;\r\n    });\r\n    return points;\r\n};\r\nconst vectorsRotate = (points, angle, cx, cy) => {\r\n    const s = Math.sin(angle);\r\n    const c = Math.cos(angle);\r\n    points.forEach((p) => {\r\n        p.x -= cx;\r\n        p.y -= cy;\r\n        const rx = p.x * c - p.y * s;\r\n        const ry = p.x * s + p.y * c;\r\n        p.x = cx + rx;\r\n        p.y = cy + ry;\r\n    });\r\n    return points;\r\n};\r\n//\r\n// size\r\n//\r\nconst toSize = (width, height) => ({ width, height });\r\nconst sizeClone = (size) => toSize(size.width, size.height);\r\nconst sizeCreateFromAny = (obj) => toSize(obj.width, obj.height);\r\nconst sizeCreateFromRect = (r) => toSize(r.width, r.height);\r\nconst sizeCreateFromArray = (a) => toSize(a[0], a[1]);\r\nconst sizeCreateFromImageNaturalSize = (image) => toSize(image.naturalWidth, image.naturalHeight);\r\nconst sizeCreateFromElement = (element) => {\r\n    if (/img/i.test(element.nodeName)) {\r\n        return sizeCreateFromImageNaturalSize(element);\r\n    }\r\n    return sizeCreateFromAny(element);\r\n};\r\nconst sizeCreate = (width, height) => toSize(width, height);\r\nconst sizeEqual = (a, b, format = passthrough) => format(a.width) === format(b.width) && format(a.height) === format(b.height);\r\nconst sizeScale = (size, scalar) => {\r\n    size.width *= scalar;\r\n    size.height *= scalar;\r\n    return size;\r\n};\r\nconst sizeCenter = (size) => vectorCreate(size.width * 0.5, size.height * 0.5);\r\nconst sizeRotate = (size, radians) => {\r\n    const r = Math.abs(radians);\r\n    const cos = Math.cos(r);\r\n    const sin = Math.sin(r);\r\n    const w = cos * size.width + sin * size.height;\r\n    const h = sin * size.width + cos * size.height;\r\n    size.width = w;\r\n    size.height = h;\r\n    return size;\r\n};\r\nconst sizeTurn = (size, radians) => {\r\n    const w = size.width;\r\n    const h = size.height;\r\n    if (isRotatedSideways(radians)) {\r\n        size.width = h;\r\n        size.height = w;\r\n    }\r\n    return size;\r\n};\r\nconst sizeContains = (a, b) => a.width >= b.width && a.height >= b.height;\r\nconst sizeApply = (size, fn) => {\r\n    size.width = fn(size.width);\r\n    size.height = fn(size.height);\r\n    return size;\r\n};\r\nconst sizeHypotenuse = (size) => Math.sqrt(size.width * size.width + size.height * size.height);\r\nconst sizeMin = (a, b) => sizeCreate(Math.min(a.width, b.width), Math.min(a.height, b.height));\r\n//\r\n// line\r\n//\r\nconst lineCreate = (start, end) => ({ start, end });\r\nconst lineClone = (line) => lineCreate(vectorClone(line.start), vectorClone(line.end));\r\nconst lineExtend = (line, amount) => {\r\n    if (amount === 0)\r\n        return line;\r\n    const v = vectorCreate(line.start.x - line.end.x, line.start.y - line.end.y);\r\n    const n = vectorNormalize(v);\r\n    const m = vectorMultiply(n, amount);\r\n    line.start.x += m.x;\r\n    line.start.y += m.y;\r\n    line.end.x -= m.x;\r\n    line.end.y -= m.y;\r\n    return line;\r\n};\r\nconst lineMultiply = (line, amount) => {\r\n    if (amount === 0)\r\n        return line;\r\n    const v = vectorCreate(line.start.x - line.end.x, line.start.y - line.end.y);\r\n    const n = vectorNormalize(v);\r\n    const m = vectorMultiply(n, amount);\r\n    line.end.x += m.x;\r\n    line.end.y += m.y;\r\n    return line;\r\n};\r\nconst lineExtrude = ({ start, end }, amount) => {\r\n    if (amount === 0)\r\n        return [\r\n            vectorCreate(start.x, start.y),\r\n            vectorCreate(start.x, start.y),\r\n            vectorCreate(end.x, end.y),\r\n            vectorCreate(end.x, end.y),\r\n        ];\r\n    const a = Math.atan2(end.y - start.y, end.x - start.x);\r\n    const sina = Math.sin(a) * amount;\r\n    const cosa = Math.cos(a) * amount;\r\n    return [\r\n        vectorCreate(sina + start.x, -cosa + start.y),\r\n        vectorCreate(-sina + start.x, cosa + start.y),\r\n        vectorCreate(-sina + end.x, cosa + end.y),\r\n        vectorCreate(sina + end.x, -cosa + end.y),\r\n    ];\r\n};\r\n//\r\n// rect\r\n//\r\nconst CornerSigns = [\r\n    vectorCreate(-1, -1),\r\n    vectorCreate(-1, 1),\r\n    vectorCreate(1, 1),\r\n    vectorCreate(1, -1),\r\n];\r\nconst toRect = (x, y, width, height) => ({\r\n    x,\r\n    y,\r\n    width,\r\n    height,\r\n});\r\nconst rectClone$1 = (rect) => toRect(rect.x, rect.y, rect.width, rect.height);\r\nconst rectCreateEmpty = () => toRect(0, 0, 0, 0);\r\nconst rectCreateFromDimensions = (width, height) => toRect(0, 0, width, height);\r\nconst rectCreateFromSize = (size) => toRect(0, 0, size.width, size.height);\r\nconst rectCreateFromBounds = (bounds) => toRect(bounds[3], bounds[0], bounds[1] - bounds[3], bounds[2] - bounds[0]);\r\nconst rectCreateFromAny = (obj) => toRect(obj.x || 0, obj.y || 0, obj.width || 0, obj.height || 0);\r\nconst rectCreateFromPoints = (points) => {\r\n    let xMin = points[0].x;\r\n    let xMax = points[0].x;\r\n    let yMin = points[0].y;\r\n    let yMax = points[0].y;\r\n    points.forEach((point) => {\r\n        xMin = Math.min(xMin, point.x);\r\n        xMax = Math.max(xMax, point.x);\r\n        yMin = Math.min(yMin, point.y);\r\n        yMax = Math.max(yMax, point.y);\r\n    });\r\n    return toRect(xMin, yMin, xMax - xMin, yMax - yMin);\r\n};\r\nconst rectCreateFromEllipse = (ellipse) => rectCreate(ellipse.x - ellipse.rx, ellipse.y - ellipse.ry, ellipse.rx * 2, ellipse.ry * 2);\r\nconst rectCreateWithCenter = (center, size) => toRect(center.x - size.width * 0.5, center.y - size.height * 0.5, size.width, size.height);\r\nconst rectCreate = (x, y, width, height) => toRect(x, y, width, height);\r\nconst rectCenter = (rect) => vectorCreate(rect.x + rect.width * 0.5, rect.y + rect.height * 0.5);\r\nconst rectTranslate$1 = (rect, t) => {\r\n    rect.x += t.x;\r\n    rect.y += t.y;\r\n    return rect;\r\n};\r\nconst rectScale$1 = (rect, scalar, pivot) => {\r\n    pivot = pivot || rectCenter(rect);\r\n    rect.x = scalar * (rect.x - pivot.x) + pivot.x;\r\n    rect.y = scalar * (rect.y - pivot.y) + pivot.y;\r\n    rect.width = scalar * rect.width;\r\n    rect.height = scalar * rect.height;\r\n    return rect;\r\n};\r\nconst rectClamp = (rect, sizeMin, sizeMax, pivot) => {\r\n    const x = (pivot.x - rect.x) / rect.width;\r\n    const y = (pivot.y - rect.y) / rect.height;\r\n    let width = Math.max(sizeMin.width, rect.width);\r\n    let height = Math.max(sizeMin.height, rect.height);\r\n    width = Math.min(sizeMax.width, width);\r\n    height = Math.min(sizeMax.height, height);\r\n    rect.x = pivot.x - x * width;\r\n    rect.y = pivot.y - y * height;\r\n    rect.width = width;\r\n    rect.height = height;\r\n    return rect;\r\n};\r\nconst rectGetCornerByTarget = (rect, target) => {\r\n    const [xf, yf] = DirectionCoordinateTable[target];\r\n    const x = xf * rect.width;\r\n    const y = yf * rect.height;\r\n    return vectorCreate(rect.x + x, rect.y + y);\r\n};\r\nconst rectMultiply = (rect, factor) => {\r\n    rect.x *= factor;\r\n    rect.y *= factor;\r\n    rect.width *= factor;\r\n    rect.height *= factor;\r\n    return rect;\r\n};\r\nconst rectDivide = (rect, factor) => {\r\n    rect.x /= factor;\r\n    rect.y /= factor;\r\n    rect.width /= factor;\r\n    rect.height /= factor;\r\n    return rect;\r\n};\r\nconst rectSubtract = (a, b) => {\r\n    a.x -= b.x;\r\n    a.y -= b.y;\r\n    a.width -= b.width;\r\n    a.height -= b.height;\r\n    return a;\r\n};\r\nconst rectAdd = (a, b) => {\r\n    a.x += b.x;\r\n    a.y += b.y;\r\n    a.width += b.width;\r\n    a.height += b.height;\r\n    return a;\r\n};\r\nconst rectEqual = (a, b, format = passthrough) => format(a.x) === format(b.x) &&\r\n    format(a.y) === format(b.y) &&\r\n    format(a.width) === format(b.width) &&\r\n    format(a.height) === format(b.height);\r\nconst rectAspectRatio = (rect) => getAspectRatio(rect.width, rect.height);\r\nconst rectUpdate = (rect, x, y, width, height) => {\r\n    rect.x = x;\r\n    rect.y = y;\r\n    rect.width = width;\r\n    rect.height = height;\r\n    return rect;\r\n};\r\nconst rectUpdateWithRect = (a, b) => {\r\n    a.x = b.x;\r\n    a.y = b.y;\r\n    a.width = b.width;\r\n    a.height = b.height;\r\n    return a;\r\n};\r\nconst rectRotate = (rect, radians, pivot) => {\r\n    if (!pivot)\r\n        pivot = rectCenter(rect);\r\n    return rectGetCorners(rect).map((vertex) => vectorRotate(vertex, radians, pivot));\r\n};\r\nconst rectCenterRect = (a, b) => toRect(a.width * 0.5 - b.width * 0.5, a.height * 0.5 - b.height * 0.5, b.width, b.height);\r\nconst rectContainsPoint = (rect, point) => {\r\n    if (point.x < rect.x)\r\n        return false;\r\n    if (point.y < rect.y)\r\n        return false;\r\n    if (point.x > rect.x + rect.width)\r\n        return false;\r\n    if (point.y > rect.y + rect.height)\r\n        return false;\r\n    return true;\r\n};\r\nconst rectCoverRect = (rect, aspectRatio, offset = vectorCreateEmpty()) => {\r\n    if (rect.width === 0 || rect.height === 0)\r\n        return rectCreateEmpty();\r\n    const inputAspectRatio = rectAspectRatio(rect);\r\n    if (!aspectRatio)\r\n        aspectRatio = inputAspectRatio;\r\n    let width = rect.width;\r\n    let height = rect.height;\r\n    if (aspectRatio > inputAspectRatio) {\r\n        // height remains the same, width is expanded\r\n        width = height * aspectRatio;\r\n    }\r\n    else {\r\n        // width remains the same, height is expanded\r\n        height = width / aspectRatio;\r\n    }\r\n    return toRect(offset.x + (rect.width - width) * 0.5, offset.y + (rect.height - height) * 0.5, width, height);\r\n};\r\nconst rectLimitInRect = (childRect, parentRect, aspectRatio) => {\r\n    const [t, r, b, l] = rectToBounds(childRect);\r\n    const rectOrigin = { ...childRect };\r\n    if (t < parentRect.y) {\r\n        childRect.height = childRect.height - (parentRect.y - t);\r\n        childRect.y = parentRect.y;\r\n    }\r\n    if (r > parentRect.x + parentRect.width) {\r\n        childRect.width = parentRect.x + parentRect.width - childRect.x;\r\n    }\r\n    if (b > parentRect.y + parentRect.height) {\r\n        childRect.height = parentRect.y + parentRect.height - childRect.y;\r\n    }\r\n    if (l < parentRect.x) {\r\n        childRect.width = childRect.width - (parentRect.x - l);\r\n        childRect.x = parentRect.x;\r\n    }\r\n    if (aspectRatio) {\r\n        // scalar\r\n        const scalar = Math.min(1, rectOrigin.width / childRect.width, rectOrigin.height / childRect.height);\r\n        return rectMultiply(rectOrigin, scalar);\r\n    }\r\n    return childRect;\r\n};\r\nconst rectOffsetInRect = (childRect, parentRect) => {\r\n    const [t, r, b, l] = rectToBounds(childRect);\r\n    if (t < parentRect.y)\r\n        childRect.y = Math.max(parentRect.y, childRect.y);\r\n    if (r > parentRect.width)\r\n        childRect.x = parentRect.width - childRect.width;\r\n    if (b > parentRect.height)\r\n        childRect.y = parentRect.height - childRect.height;\r\n    if (l < parentRect.x)\r\n        childRect.x = Math.max(parentRect.x, childRect.x);\r\n    return childRect;\r\n};\r\nconst rectContainRect = (rect, aspectRatio = rectAspectRatio(rect), offset = vectorCreateEmpty()) => {\r\n    if (rect.width === 0 || rect.height === 0)\r\n        return rectCreateEmpty();\r\n    let width = rect.width;\r\n    let height = width / aspectRatio;\r\n    if (height > rect.height) {\r\n        height = rect.height;\r\n        width = height * aspectRatio;\r\n    }\r\n    return toRect(offset.x + (rect.width - width) * 0.5, offset.y + (rect.height - height) * 0.5, width, height);\r\n};\r\nconst rectToBounds = (rect) => [\r\n    Math.min(rect.y, rect.y + rect.height),\r\n    Math.max(rect.x, rect.x + rect.width),\r\n    Math.max(rect.y, rect.y + rect.height),\r\n    Math.min(rect.x, rect.x + rect.width), // left\r\n];\r\nconst rectGetCorners = (rect) => [\r\n    vectorCreate(rect.x, rect.y),\r\n    vectorCreate(rect.x + rect.width, rect.y),\r\n    vectorCreate(rect.x + rect.width, rect.y + rect.height),\r\n    vectorCreate(rect.x, rect.y + rect.height),\r\n];\r\nconst rectApply = (rect, fn) => {\r\n    if (!rect)\r\n        return;\r\n    rect.x = fn(rect.x);\r\n    rect.y = fn(rect.y);\r\n    rect.width = fn(rect.width);\r\n    rect.height = fn(rect.height);\r\n    return rect;\r\n};\r\nconst rectApplyPerspective = (rect, perspective, pivot = rectCenter(rect)) => rectGetCorners(rect).map((corner, index) => {\r\n    const sign = CornerSigns[index];\r\n    return vectorCreate(scale(corner.x, 1.0 + sign.x * perspective.x, pivot.x), scale(corner.y, 1.0 + sign.y * perspective.y, pivot.y));\r\n});\r\nconst rectNormalizeOffset = (rect) => {\r\n    rect.x = 0;\r\n    rect.y = 0;\r\n    return rect;\r\n};\r\nconst convexPolyCentroid = (vertices) => {\r\n    const first = vertices[0];\r\n    const last = vertices[vertices.length - 1];\r\n    // make sure is closed loop\r\n    vertices = vectorEqual(first, last) ? vertices : [...vertices, first];\r\n    const fx = first.x;\r\n    const fy = first.y;\r\n    let twiceArea = 0;\r\n    let i = 0;\r\n    let x = 0;\r\n    let y = 0;\r\n    let a;\r\n    let b;\r\n    let f;\r\n    const l = vertices.length;\r\n    for (; i < l; i++) {\r\n        // current vertex\r\n        a = vertices[i];\r\n        // next vertex\r\n        b = vertices[i + 1 > l - 1 ? 0 : i + 1];\r\n        f = (a.y - fy) * (b.x - fx) - (b.y - fy) * (a.x - fx);\r\n        twiceArea += f;\r\n        x += (a.x + b.x - 2 * fx) * f;\r\n        y += (a.y + b.y - 2 * fy) * f;\r\n    }\r\n    f = twiceArea * 3;\r\n    return vectorCreate(fx + x / f, fy + y / f);\r\n};\r\nconst lineLineIntersection = (a, b) => getLineLineIntersectionPoint(a.start, a.end, b.start, b.end);\r\nconst getLineLineIntersectionPoint = (a, b, c, d) => {\r\n    const denominator = (d.y - c.y) * (b.x - a.x) - (d.x - c.x) * (b.y - a.y);\r\n    // lines are parallel\r\n    if (denominator === 0)\r\n        return undefined;\r\n    const uA = ((d.x - c.x) * (a.y - c.y) - (d.y - c.y) * (a.x - c.x)) / denominator;\r\n    const uB = ((b.x - a.x) * (a.y - c.y) - (b.y - a.y) * (a.x - c.x)) / denominator;\r\n    // intersection is not on the line itself\r\n    if (uA < 0 || uA > 1 || uB < 0 || uB > 1)\r\n        return undefined;\r\n    // return intersection point\r\n    return vectorCreate(a.x + uA * (b.x - a.x), a.y + uA * (b.y - a.y));\r\n};\r\n// checks if line intersects with one of the lines that can be drawn between the points (in sequence)\r\nconst linePointsIntersection = (line, points, { ignoreIdenticalLines = false, breakOnIntersection = false } = {}) => {\r\n    const l = points.length;\r\n    const intersections = [];\r\n    for (let i = 0; i < l - 1; i++) {\r\n        if (ignoreIdenticalLines &&\r\n            (vectorEqual(line.start, points[i]) ||\r\n                vectorEqual(line.start, points[i + 1]) ||\r\n                vectorEqual(line.end, points[i]) ||\r\n                vectorEqual(line.end, points[i + 1])))\r\n            continue;\r\n        const intersection = getLineLineIntersectionPoint(line.start, line.end, points[i], points[i + 1]);\r\n        if (!intersection)\r\n            continue;\r\n        if (breakOnIntersection)\r\n            return [intersection];\r\n        intersections.push(intersection);\r\n    }\r\n    return intersections.length ? intersections : undefined;\r\n};\r\nconst pointInPoly$1 = (point, vertices) => {\r\n    let i = 0;\r\n    let j = 0;\r\n    let c = false;\r\n    const l = vertices.length;\r\n    for (i = 0, j = l - 1; i < l; j = i++) {\r\n        if (vertices[i].y > point.y != vertices[j].y > point.y &&\r\n            point.x <\r\n                ((vertices[j].x - vertices[i].x) * (point.y - vertices[i].y)) /\r\n                    (vertices[j].y - vertices[i].y) +\r\n                    vertices[i].x) {\r\n            c = !c;\r\n        }\r\n    }\r\n    return c;\r\n};\r\n// first tests if points of a are to be found in b, then does the reverse\r\nconst polyIntersectsWithPoly = (a, b) => {\r\n    const bContainsCornerOfA = a.find((corner) => pointInPoly$1(corner, b));\r\n    if (bContainsCornerOfA)\r\n        return true;\r\n    const aContainsCornerOfB = b.find((corner) => pointInPoly$1(corner, a));\r\n    if (aContainsCornerOfB)\r\n        return true;\r\n    return false;\r\n};\r\nconst quadLines = (vertices) => {\r\n    const arr = [];\r\n    for (let i = 0; i < vertices.length; i++) {\r\n        let next = i + 1;\r\n        if (next === vertices.length)\r\n            next = 0;\r\n        arr.push(lineCreate(vectorClone(vertices[i]), vectorClone(vertices[next])));\r\n    }\r\n    return arr;\r\n};\r\nconst quadToLines = (vertices, extension = 0) => quadLines(vertices)\r\n    // extend the poly lines a tiny bit so we\r\n    // don't shoot rays between line gaps at corners\r\n    // this caused one intersection to be missing resulting\r\n    // in error while manipulating crop edges\r\n    // (rotate image 90degrees -> drag bottom edge) (2021-04-09)\r\n    .map((line) => lineExtend(line, extension));\r\nconst ellipseToPolygon = (center, rx, ry, rotation = 0, flipX = false, flipY = false, resolution = 12) => {\r\n    const points = [];\r\n    for (let i = 0; i < resolution; i++) {\r\n        points.push(vectorCreate(center.x + rx * Math.cos((i * (Math.PI * 2)) / resolution), center.y + ry * Math.sin((i * (Math.PI * 2)) / resolution)));\r\n    }\r\n    if (flipX || flipY)\r\n        vectorsFlip(points, flipX, flipY, center.x, center.y);\r\n    if (rotation)\r\n        vectorsRotate(points, rotation, center.x, center.y);\r\n    return points;\r\n};\r\n\r\nvar getImageTransformedRect = (imageSize, imageRotation) => {\r\n    const imageRect = rectCreateFromSize(imageSize);\r\n    const imageCenter = rectCenter(imageRect);\r\n    const imageTransformedVertices = rectRotate(imageRect, imageRotation, imageCenter);\r\n    return rectNormalizeOffset(rectCreateFromPoints(imageTransformedVertices));\r\n};\r\n\r\nvar isElement = (v, name) => v instanceof HTMLElement && (name ? new RegExp(`^${name}$`, 'i').test(v.nodeName) : true);\r\n\r\nvar isFile = (v) => v instanceof File;\r\n\r\nvar canvasToFile = async (canvas, mimeType, quality) => {\r\n    const blob = await canvasToBlob(canvas, mimeType, quality);\r\n    return blobToFile(blob, 'canvas');\r\n};\r\n\r\nvar getFilenameFromURL = (url) => url\r\n    .split('/')\r\n    .pop()\r\n    .split(/\\?|\\#/)\r\n    .shift();\r\n\r\n// @ts-ignore\r\nconst supportsReplaceChildren = isBrowser() && !!Node.prototype.replaceChildren;\r\nconst fn$1 = supportsReplaceChildren\r\n    ? // @ts-ignore\r\n        (parent, newChildren) => parent.replaceChildren(newChildren)\r\n    : (parent, newChildren) => {\r\n        while (parent.lastChild) {\r\n            parent.removeChild(parent.lastChild);\r\n        }\r\n        if (newChildren !== undefined) {\r\n            parent.append(newChildren);\r\n        }\r\n    };\r\n\r\nconst container = isBrowser() &&\r\n    h('div', {\r\n        class: 'PinturaMeasure',\r\n        style: 'position:absolute;left:0;top:0;width:99999px;height:0;pointer-events:none;contain:strict;margin:0;padding:0;',\r\n    });\r\nlet timeoutId;\r\nvar appendForMeasuring = (element) => {\r\n    // replace element children with this child\r\n    fn$1(container, element);\r\n    // append to DOM if not in it atm\r\n    if (!container.parentNode)\r\n        document.body.append(container);\r\n    // auto detach from DOM after it isn't used for a little while\r\n    clearTimeout(timeoutId);\r\n    timeoutId = setTimeout(() => {\r\n        container.remove();\r\n    }, 500);\r\n    // return added element for measuring\r\n    return element;\r\n};\r\n\r\nlet result$a = null;\r\nvar isSafari = () => {\r\n    if (result$a === null)\r\n        result$a =\r\n            isBrowser() && /^((?!chrome|android).)*(safari|iphone|ipad)/i.test(navigator.userAgent); // added |iphone|ipad as safari is not present in WebView on React Native\r\n    return result$a;\r\n};\r\n\r\nvar getImageElementSize = (imageElement) => new Promise((resolve, reject) => {\r\n    let shouldAutoRemove = false;\r\n    // test if image is attached to DOM, if not attached, attach so measurement is correct on Safari\r\n    if (!imageElement.parentNode && isSafari()) {\r\n        shouldAutoRemove = true;\r\n        // has width 0 and height 0 to prevent rendering very big SVGs (without width and height) that will for one frame overflow the window and show a scrollbar\r\n        imageElement.style.cssText = `position:absolute;visibility:hidden;pointer-events:none;left:0;top:0;width:0;height:0;`;\r\n        appendForMeasuring(imageElement);\r\n    }\r\n    // start testing size\r\n    const measure = () => {\r\n        const width = imageElement.naturalWidth;\r\n        const height = imageElement.naturalHeight;\r\n        const hasSize = width && height;\r\n        if (!hasSize)\r\n            return;\r\n        // clean up image if was attached for measuring\r\n        if (shouldAutoRemove)\r\n            imageElement.remove();\r\n        clearInterval(intervalId);\r\n        resolve({ width, height });\r\n    };\r\n    imageElement.onerror = (err) => {\r\n        clearInterval(intervalId);\r\n        reject(err);\r\n    };\r\n    const intervalId = setInterval(measure, 1);\r\n    measure();\r\n});\r\n\r\nvar getVideoElementSize = (element) => new Promise((resolve, reject) => {\r\n    const done = () => {\r\n        resolve({\r\n            width: element.videoWidth,\r\n            height: element.videoHeight,\r\n        });\r\n    };\r\n    if (element.readyState >= 1)\r\n        return done();\r\n    element.onloadedmetadata = done;\r\n    element.onerror = reject;\r\n});\r\n\r\nvar isImage = (file) => /^image/.test(file.type);\r\n\r\nvar getAsVideoOrImageElement = (src) => new Promise((resolve) => {\r\n    // undertmined or is video\r\n    const elementSrc = (isString(src) ? src : URL.createObjectURL(src));\r\n    const createImage = () => {\r\n        const image = new Image();\r\n        image.src = elementSrc;\r\n        resolve(image);\r\n    };\r\n    // we can already know it's an image\r\n    if (src instanceof Blob && isImage(src))\r\n        return createImage();\r\n    // try video first\r\n    const element = document.createElement('video');\r\n    element.preload = 'metadata';\r\n    element.onloadedmetadata = () => resolve(element);\r\n    // when errors we switch to image\r\n    element.onerror = createImage;\r\n    element.src = elementSrc;\r\n});\r\n\r\nvar isVideoElement = (element) => element.nodeName === 'VIDEO';\r\n\r\n// TODO: video rename function\r\nvar getImageSize = async (src) => {\r\n    // the image element we'll use to load the image\r\n    let mediaElement;\r\n    // if is not an image or video element, it must be a valid image or video source\r\n    if (!src['src']) {\r\n        mediaElement = await getAsVideoOrImageElement(src);\r\n    }\r\n    else {\r\n        mediaElement = src;\r\n    }\r\n    let size;\r\n    try {\r\n        size = isVideoElement(mediaElement)\r\n            ? await getVideoElementSize(mediaElement)\r\n            : await getImageElementSize(mediaElement);\r\n    }\r\n    finally {\r\n        isFile(src) && URL.revokeObjectURL(mediaElement.src);\r\n    }\r\n    return size;\r\n};\r\n\r\nconst awaitComplete = (image) => new Promise((resolve, reject) => {\r\n    if (image.complete)\r\n        return resolve(image);\r\n    image.onload = () => resolve(image);\r\n    image.onerror = reject;\r\n});\r\nvar imageToFile = async (imageElement) => {\r\n    try {\r\n        const size = await getImageSize(imageElement);\r\n        const image = await awaitComplete(imageElement);\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = size.width;\r\n        canvas.height = size.height;\r\n        const ctx = canvas.getContext('2d');\r\n        ctx.drawImage(image, 0, 0);\r\n        const blob = await canvasToBlob(canvas);\r\n        return blobToFile(blob, getFilenameFromURL(image.src));\r\n    }\r\n    catch (err) {\r\n        throw err;\r\n    }\r\n};\r\n\r\nvar isDataURI = (str) => /^data:/.test(str);\r\n\r\nvar createProgressEvent = (loaded = 0, lengthComputable = true) => new (getNativeAPIRef('ProgressEvent'))('progress', {\r\n    loaded: loaded * 100,\r\n    total: 100,\r\n    lengthComputable,\r\n});\r\n\r\nvar dataURIToFile = async (dataURI, filename = 'data-uri', onprogress = noop$1) => {\r\n    // basic loader, no size info\r\n    onprogress(createProgressEvent(0));\r\n    const res = await fetch(dataURI);\r\n    onprogress(createProgressEvent(0.33));\r\n    const blob = await res.blob();\r\n    let mimeType;\r\n    if (!isImage(blob))\r\n        mimeType = `image/${dataURI.includes(',/9j/') ? 'jpeg' : 'png'}`;\r\n    onprogress(createProgressEvent(0.66));\r\n    const file = blobToFile(blob, filename, mimeType);\r\n    onprogress(createProgressEvent(1));\r\n    return file;\r\n};\r\n\r\nvar getResponseHeader = (xhr, header, parse = (header) => header) => xhr.getAllResponseHeaders().indexOf(header) >= 0\r\n    ? parse(xhr.getResponseHeader(header))\r\n    : undefined;\r\n\r\nvar getFilenameFromContentDisposition = (header) => {\r\n    if (!header)\r\n        return null;\r\n    const matches = header.split(/filename=|filename\\*=.+''/)\r\n        .splice(1)\r\n        .map(name => name.trim().replace(/^[\"']|[;\"']{0,2}$/g, ''))\r\n        .filter(name => name.length);\r\n    return matches.length ? decodeURI(matches[matches.length - 1]) : null;\r\n};\r\n\r\nconst EditorErrorCode = {\r\n    URL_REQUEST: 'URL_REQUEST',\r\n    DOCTYPE_MISSING: 'DOCTYPE_MISSING',\r\n};\r\nclass EditorError extends Error {\r\n    constructor(message, code, metadata) {\r\n        super(message);\r\n        this.name = 'EditorError';\r\n        this.code = code;\r\n        this.metadata = metadata;\r\n    }\r\n}\r\n\r\n// should be called after xhr.open\r\nvar configureXHR = (xhr, options) => {\r\n    // https://developer.mozilla.org/en-US/docs/Web/API/fetch#parameters\r\n    // only handles headers and credentials for now\r\n    const { headers = {}, credentials } = options || {};\r\n    // apply options to xhr\r\n    Object.entries(headers).forEach(([header, value]) => xhr.setRequestHeader(header, value));\r\n    // set xhr withCredentials\r\n    if (credentials)\r\n        xhr.withCredentials = credentials !== 'omit';\r\n};\r\n\r\nvar fetchFile = (url, onprogress, options) => new Promise((resolve, reject) => {\r\n    const handleError = () => reject(new EditorError('Error fetching image', EditorErrorCode.URL_REQUEST, xhr));\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.onprogress = onprogress;\r\n    (xhr.onerror = handleError),\r\n        (xhr.onload = () => {\r\n            if (!xhr.response || xhr.status >= 300 || xhr.status < 200)\r\n                return handleError();\r\n            // we store the response mime type so we can add it to the blob later on, if it's missing (happens on Safari 10)\r\n            const mimetype = getResponseHeader(xhr, 'Content-Type');\r\n            // try to get filename and any file instructions as well\r\n            const filename = getResponseHeader(xhr, 'Content-Disposition', getFilenameFromContentDisposition) || getFilenameFromURL(url);\r\n            // convert to actual file if possible\r\n            resolve(blobToFile(xhr.response, filename, mimetype || getMimeTypeFromFilename(filename)));\r\n        });\r\n    // get helper\r\n    const { willRequest } = options;\r\n    Promise.resolve(willRequest && willRequest(url, { resourceType: 'image' }))\r\n        .then((requestInit) => {\r\n        // don't load image\r\n        if (requestInit === false)\r\n            return reject('Image load rejected');\r\n        // we're good to go\r\n        xhr.open('GET', url);\r\n        // set props\r\n        configureXHR(xhr, requestInit);\r\n        // fire xhr\r\n        xhr.responseType = 'blob';\r\n        xhr.send();\r\n    })\r\n        .catch(console.error);\r\n});\r\n\r\nvar urlToFile = (url, onprogress, options) => {\r\n    // use fetch to create blob from data uri\r\n    if (isDataURI(url))\r\n        return dataURIToFile(url, undefined, onprogress);\r\n    // load file from url\r\n    return fetchFile(url, onprogress, options);\r\n};\r\n\r\nvar isBlob = (v) => v instanceof Blob && !(v instanceof File);\r\n\r\nvar isImageBitmap = (obj) => 'close' in obj;\r\n\r\nvar srcToFile = async (src, onprogress, options) => {\r\n    if (isFile(src) || isBlob(src))\r\n        return src;\r\n    else if (isString(src))\r\n        return await urlToFile(src, onprogress, options);\r\n    else if (isElement(src, 'canvas'))\r\n        return await canvasToFile(src);\r\n    else if (isElement(src, 'img'))\r\n        return await imageToFile(src);\r\n    else if (isImageData(src) || isImageBitmap(src))\r\n        return await canvasToFile(await imageDataToCanvas(src));\r\n    else {\r\n        throw new EditorError('Invalid image source', 'invalid-image-source');\r\n    }\r\n};\r\n\r\nlet result$9 = null;\r\nvar isMac = () => {\r\n    if (result$9 === null)\r\n        result$9 = isBrowser() && /^mac/i.test(navigator.platform);\r\n    return result$9;\r\n};\r\n\r\nvar isUserAgent = (test) => isBrowser() ? RegExp(test).test(window.navigator.userAgent) : undefined;\r\n\r\nlet result$8 = null;\r\nvar isIOS = () => {\r\n    if (result$8 === null)\r\n        // first part is for iPhones and iPads iOS 12 and below second part is for iPads with iOS 13 and up\r\n        result$8 =\r\n            isBrowser() &&\r\n                (isUserAgent(/iPhone|iPad|iPod/) || (isMac() && navigator.maxTouchPoints >= 1));\r\n    return result$8;\r\n};\r\n\r\nvar orientImageSize = async (size, orientation = 1) => {\r\n    // browser can handle image orientation\r\n    if ((await canOrientImages()) || isIOS())\r\n        return size;\r\n    // no need to correct size\r\n    if (orientation < 5)\r\n        return size;\r\n    // correct image size\r\n    return sizeCreate(size.height, size.width);\r\n};\r\n\r\nvar isJPEG = (file) => /jpeg/.test(file.type);\r\n\r\nvar isPlainObject = (obj) => typeof obj == 'object' && obj.constructor == Object;\r\n\r\nvar stringify = (value) => (!isPlainObject(value) ? value : JSON.stringify(value));\r\n\r\nvar post = (url, dataset, options) => new Promise((resolve, reject) => {\r\n    const { token = {}, beforeSend = noop$1, onprogress = noop$1 } = options;\r\n    token.cancel = () => request.abort();\r\n    const request = new XMLHttpRequest();\r\n    request.upload.onprogress = onprogress;\r\n    request.onload = () => request.status >= 200 && request.status < 300 ? resolve(request) : reject(request);\r\n    request.onerror = () => reject(request);\r\n    request.ontimeout = () => reject(request);\r\n    request.open('POST', encodeURI(url));\r\n    beforeSend(request);\r\n    request.send(\r\n    // if is FormData, we use that\r\n    dataset instanceof FormData\r\n        ? dataset\r\n        : // reduce the dataset to FormData\r\n            dataset.reduce((formData, args) => {\r\n                // @ts-ignore\r\n                formData.append(...args.map(stringify));\r\n                return formData;\r\n            }, new FormData()));\r\n});\r\n\r\nvar ctxRotate = (ctx, rotation = 0, pivot) => {\r\n    if (rotation === 0)\r\n        return ctx;\r\n    ctx.translate(pivot.x, pivot.y);\r\n    ctx.rotate(rotation);\r\n    ctx.translate(-pivot.x, -pivot.y);\r\n    return ctx;\r\n};\r\n\r\nvar ctxTranslate = (ctx, x, y) => {\r\n    ctx.translate(x, y);\r\n    return ctx;\r\n};\r\n\r\nvar ctxScale = (ctx, x, y) => {\r\n    ctx.scale(x, y);\r\n    return ctx;\r\n};\r\n\r\nvar cropImageData = async (imageData, options = {}) => {\r\n    const { flipX, flipY, rotation, crop } = options;\r\n    const imageSize = sizeCreateFromAny(imageData);\r\n    const shouldFlip = flipX || flipY;\r\n    const shouldRotate = !!rotation;\r\n    const cropDefined = crop && (crop.x || crop.y || crop.width || crop.height);\r\n    const cropCoversImage = cropDefined && rectEqual(crop, rectCreateFromSize(imageSize));\r\n    const shouldCrop = cropDefined && !cropCoversImage;\r\n    // skip!\r\n    if (!shouldFlip && !shouldRotate && !shouldCrop)\r\n        return imageData;\r\n    // create drawing context\r\n    let imageDataOut;\r\n    let image = h('canvas', {\r\n        width: imageData.width,\r\n        height: imageData.height,\r\n    });\r\n    image.getContext('2d').putImageData(imageData, 0, 0);\r\n    // flip image data\r\n    if (shouldFlip) {\r\n        const ctx = h('canvas', {\r\n            width: image.width,\r\n            height: image.height,\r\n        }).getContext('2d');\r\n        ctxScale(ctx, flipX ? -1 : 1, flipY ? -1 : 1);\r\n        ctx.drawImage(image, flipX ? -image.width : 0, flipY ? -image.height : 0);\r\n        ctx.restore();\r\n        releaseCanvas(image);\r\n        image = ctx.canvas;\r\n    }\r\n    // rotate image data\r\n    if (shouldRotate) {\r\n        // if shouldRotate is true we also receive a crop rect\r\n        const outputSize = sizeApply(sizeCreateFromRect(rectCreateFromPoints(rectRotate(rectCreateFromAny(image), rotation))), Math.floor);\r\n        const ctx = h('canvas', {\r\n            width: crop.width,\r\n            height: crop.height,\r\n        }).getContext('2d');\r\n        ctxTranslate(ctx, -crop.x, -crop.y);\r\n        ctxRotate(ctx, rotation, sizeCenter(outputSize));\r\n        ctx.drawImage(image, (outputSize.width - image.width) * 0.5, (outputSize.height - image.height) * 0.5);\r\n        ctx.restore();\r\n        releaseCanvas(image);\r\n        image = ctx.canvas;\r\n    }\r\n    // crop image data\r\n    else if (shouldCrop) {\r\n        const ctx = image.getContext('2d');\r\n        imageDataOut = ctx.getImageData(crop.x, crop.y, crop.width, crop.height);\r\n        releaseCanvas(image);\r\n        return imageDataOut;\r\n    }\r\n    // done, return resulting image data\r\n    const ctx = image.getContext('2d');\r\n    imageDataOut = ctx.getImageData(0, 0, image.width, image.height);\r\n    releaseCanvas(image);\r\n    return imageDataOut;\r\n};\r\n\r\nvar resizeTransform = (options, done) => {\r\n    const { imageData, width, height } = options;\r\n    const inputWidth = imageData.width;\r\n    const inputHeight = imageData.height;\r\n    const outputWidth = Math.round(width);\r\n    const outputHeight = Math.round(height);\r\n    const inputData = imageData.data;\r\n    const outputData = new Uint8ClampedArray(outputWidth * outputHeight * 4);\r\n    const scaleX = inputWidth / outputWidth;\r\n    const scaleY = inputHeight / outputHeight;\r\n    const scaleXHalf = Math.ceil(scaleX * 0.5);\r\n    const scaleYHalf = Math.ceil(scaleY * 0.5);\r\n    for (let j = 0; j < outputHeight; j++) {\r\n        for (let i = 0; i < outputWidth; i++) {\r\n            const x2 = (i + j * outputWidth) * 4;\r\n            let weight = 0;\r\n            let weights = 0;\r\n            let weightsAlpha = 0;\r\n            let r = 0;\r\n            let g = 0;\r\n            let b = 0;\r\n            let a = 0;\r\n            const centerY = (j + 0.5) * scaleY;\r\n            for (let yy = Math.floor(j * scaleY); yy < (j + 1) * scaleY; yy++) {\r\n                const dy = Math.abs(centerY - (yy + 0.5)) / scaleYHalf;\r\n                const centerX = (i + 0.5) * scaleX;\r\n                const w0 = dy * dy;\r\n                for (let xx = Math.floor(i * scaleX); xx < (i + 1) * scaleX; xx++) {\r\n                    let dx = Math.abs(centerX - (xx + 0.5)) / scaleXHalf;\r\n                    const w = Math.sqrt(w0 + dx * dx);\r\n                    if (w < -1 || w > 1)\r\n                        continue;\r\n                    weight = 2 * w * w * w - 3 * w * w + 1;\r\n                    if (weight <= 0)\r\n                        continue;\r\n                    dx = 4 * (xx + yy * inputWidth);\r\n                    const ref = inputData[dx + 3];\r\n                    a += weight * ref;\r\n                    weightsAlpha += weight;\r\n                    if (ref < 255) {\r\n                        weight = (weight * ref) / 250;\r\n                    }\r\n                    r += weight * inputData[dx];\r\n                    g += weight * inputData[dx + 1];\r\n                    b += weight * inputData[dx + 2];\r\n                    weights += weight;\r\n                }\r\n            }\r\n            outputData[x2] = r / weights;\r\n            outputData[x2 + 1] = g / weights;\r\n            outputData[x2 + 2] = b / weights;\r\n            outputData[x2 + 3] = a / weightsAlpha;\r\n        }\r\n    }\r\n    // @ts-ignore\r\n    done(null, {\r\n        data: outputData,\r\n        width: outputWidth,\r\n        height: outputHeight,\r\n    });\r\n};\r\n\r\nvar imageDataObjectToImageData = (obj) => {\r\n    if (obj instanceof ImageData) {\r\n        return obj;\r\n    }\r\n    let imageData;\r\n    try {\r\n        imageData = new ImageData(obj.width, obj.height);\r\n    }\r\n    catch (err) {\r\n        // IE + Old EDGE (tested on 12)\r\n        const canvas = h('canvas');\r\n        imageData = canvas.getContext('2d').createImageData(obj.width, obj.height);\r\n    }\r\n    imageData.data.set(obj.data);\r\n    return imageData;\r\n};\r\n\r\nvar resizeImageData = async (imageData, options = {}, resizeImageData) => {\r\n    const { width, height, fit, upscale } = options;\r\n    // no need to rescale\r\n    if (!width && !height)\r\n        return imageData;\r\n    let targetWidth = width;\r\n    let targetHeight = height;\r\n    if (!width) {\r\n        targetWidth = height;\r\n    }\r\n    else if (!height) {\r\n        targetHeight = width;\r\n    }\r\n    if (fit !== 'force') {\r\n        const scalarWidth = targetWidth / imageData.width;\r\n        const scalarHeight = targetHeight / imageData.height;\r\n        let scalar = 1;\r\n        if (fit === 'cover') {\r\n            scalar = Math.max(scalarWidth, scalarHeight);\r\n        }\r\n        else if (fit === 'contain') {\r\n            scalar = Math.min(scalarWidth, scalarHeight);\r\n        }\r\n        // if image is too small, exit here with original image\r\n        if (scalar > 1 && upscale === false)\r\n            return imageData;\r\n        targetWidth = Math.round(imageData.width * scalar);\r\n        targetHeight = Math.round(imageData.height * scalar);\r\n    }\r\n    // make sure canvas has a size\r\n    targetWidth = Math.max(targetWidth, 1);\r\n    targetHeight = Math.max(targetHeight, 1);\r\n    // no need to resize?\r\n    if (imageData.width === targetWidth && imageData.height === targetHeight)\r\n        return imageData;\r\n    // run custom image data resizer if defined\r\n    if (resizeImageData)\r\n        return resizeImageData(imageData, targetWidth, targetHeight);\r\n    // let's use the included resize method\r\n    imageData = await thread(resizeTransform, [\r\n        {\r\n            imageData: imageData,\r\n            width: targetWidth,\r\n            height: targetHeight,\r\n        },\r\n    ], [imageData.data.buffer]);\r\n    // the resizer returns a plain object, not an actual image data object, lets create one\r\n    return imageDataObjectToImageData(imageData);\r\n};\r\n\r\nvar colorEffect = (options, done) => {\r\n    const { imageData, matrix } = options;\r\n    if (!matrix)\r\n        return done(null, imageData);\r\n    const outputData = new Uint8ClampedArray(imageData.width * imageData.height * 4);\r\n    const data = imageData.data;\r\n    const l = data.length;\r\n    const m11 = matrix[0];\r\n    const m12 = matrix[1];\r\n    const m13 = matrix[2];\r\n    const m14 = matrix[3];\r\n    const m15 = matrix[4];\r\n    const m21 = matrix[5];\r\n    const m22 = matrix[6];\r\n    const m23 = matrix[7];\r\n    const m24 = matrix[8];\r\n    const m25 = matrix[9];\r\n    const m31 = matrix[10];\r\n    const m32 = matrix[11];\r\n    const m33 = matrix[12];\r\n    const m34 = matrix[13];\r\n    const m35 = matrix[14];\r\n    const m41 = matrix[15];\r\n    const m42 = matrix[16];\r\n    const m43 = matrix[17];\r\n    const m44 = matrix[18];\r\n    const m45 = matrix[19];\r\n    let index = 0;\r\n    let r = 0.0;\r\n    let g = 0.0;\r\n    let b = 0.0;\r\n    let a = 0.0;\r\n    let mr = 0.0;\r\n    let mg = 0.0;\r\n    let mb = 0.0;\r\n    let ma = 0.0;\r\n    let or = 0.0;\r\n    let og = 0.0;\r\n    let ob = 0.0;\r\n    for (; index < l; index += 4) {\r\n        r = data[index] / 255;\r\n        g = data[index + 1] / 255;\r\n        b = data[index + 2] / 255;\r\n        a = data[index + 3] / 255;\r\n        mr = r * m11 + g * m12 + b * m13 + a * m14 + m15;\r\n        mg = r * m21 + g * m22 + b * m23 + a * m24 + m25;\r\n        mb = r * m31 + g * m32 + b * m33 + a * m34 + m35;\r\n        ma = r * m41 + g * m42 + b * m43 + a * m44 + m45;\r\n        or = Math.max(0, mr * ma) + (1.0 - ma);\r\n        og = Math.max(0, mg * ma) + (1.0 - ma);\r\n        ob = Math.max(0, mb * ma) + (1.0 - ma);\r\n        outputData[index] = Math.max(0.0, Math.min(1.0, or)) * 255;\r\n        outputData[index + 1] = Math.max(0.0, Math.min(1.0, og)) * 255;\r\n        outputData[index + 2] = Math.max(0.0, Math.min(1.0, ob)) * 255;\r\n        outputData[index + 3] = a * 255;\r\n    }\r\n    // @ts-ignore\r\n    done(null, {\r\n        data: outputData,\r\n        width: imageData.width,\r\n        height: imageData.height,\r\n    });\r\n};\r\n\r\nvar convolutionEffect = (options, done) => {\r\n    const { imageData, matrix } = options;\r\n    if (!matrix)\r\n        return done(null, imageData);\r\n    // calculate kernel weight\r\n    let kernelWeight = matrix.reduce((prev, curr) => prev + curr);\r\n    kernelWeight = kernelWeight <= 0 ? 1 : kernelWeight;\r\n    // input info\r\n    const inputWidth = imageData.width;\r\n    const inputHeight = imageData.height;\r\n    const inputData = imageData.data;\r\n    let i = 0;\r\n    let x = 0;\r\n    let y = 0;\r\n    const side = Math.round(Math.sqrt(matrix.length));\r\n    const sideHalf = Math.floor(side / 2);\r\n    let r = 0, g = 0, b = 0, a = 0, cx = 0, cy = 0, scy = 0, scx = 0, srcOff = 0, weight = 0;\r\n    const outputData = new Uint8ClampedArray(inputWidth * inputHeight * 4);\r\n    for (y = 0; y < inputHeight; y++) {\r\n        for (x = 0; x < inputWidth; x++) {\r\n            // calculate the weighed sum of the source image pixels that\r\n            // fall under the convolution matrix\r\n            r = 0;\r\n            g = 0;\r\n            b = 0;\r\n            a = 0;\r\n            for (cy = 0; cy < side; cy++) {\r\n                for (cx = 0; cx < side; cx++) {\r\n                    scy = y + cy - sideHalf;\r\n                    scx = x + cx - sideHalf;\r\n                    if (scy < 0) {\r\n                        scy = inputHeight - 1;\r\n                    }\r\n                    if (scy >= inputHeight) {\r\n                        scy = 0;\r\n                    }\r\n                    if (scx < 0) {\r\n                        scx = inputWidth - 1;\r\n                    }\r\n                    if (scx >= inputWidth) {\r\n                        scx = 0;\r\n                    }\r\n                    srcOff = (scy * inputWidth + scx) * 4;\r\n                    weight = matrix[cy * side + cx];\r\n                    r += inputData[srcOff] * weight;\r\n                    g += inputData[srcOff + 1] * weight;\r\n                    b += inputData[srcOff + 2] * weight;\r\n                    a += inputData[srcOff + 3] * weight;\r\n                }\r\n            }\r\n            outputData[i] = r / kernelWeight;\r\n            outputData[i + 1] = g / kernelWeight;\r\n            outputData[i + 2] = b / kernelWeight;\r\n            outputData[i + 3] = a / kernelWeight;\r\n            i += 4;\r\n        }\r\n    }\r\n    // @ts-ignore\r\n    done(null, {\r\n        data: outputData,\r\n        width: inputWidth,\r\n        height: inputHeight,\r\n    });\r\n};\r\n\r\nvar vignetteEffect = (options, done) => {\r\n    let { imageData, strength } = options;\r\n    if (!strength)\r\n        return done(null, imageData);\r\n    const outputData = new Uint8ClampedArray(imageData.width * imageData.height * 4);\r\n    const inputWidth = imageData.width;\r\n    const inputHeight = imageData.height;\r\n    const inputData = imageData.data;\r\n    const dist = (x, y) => {\r\n        dx = x - cx;\r\n        dy = y - cy;\r\n        return Math.sqrt(dx * dx + dy * dy);\r\n    };\r\n    let x = 0;\r\n    let y = 0;\r\n    let cx = inputWidth * 0.5;\r\n    let cy = inputHeight * 0.5;\r\n    let dx;\r\n    let dy;\r\n    let dm = dist(0, 0);\r\n    let fr, fg, fb;\r\n    let br, bg, bb, ba;\r\n    let fa;\r\n    let ca;\r\n    const blend = (index, input, output, alpha) => {\r\n        br = input[index] / 255;\r\n        bg = input[index + 1] / 255;\r\n        bb = input[index + 2] / 255;\r\n        ba = input[index + 3] / 255;\r\n        fa = 1.0 - alpha;\r\n        ca = fa * ba + alpha;\r\n        output[index] = ((fa * ba * br + alpha * fr) / ca) * 255;\r\n        output[index + 1] = ((fa * ba * bg + alpha * fg) / ca) * 255;\r\n        output[index + 2] = ((fa * ba * bb + alpha * fb) / ca) * 255;\r\n        output[index + 3] = ca * 255;\r\n    };\r\n    if (strength > 0) {\r\n        fr = 0;\r\n        fg = 0;\r\n        fb = 0;\r\n    }\r\n    else {\r\n        strength = Math.abs(strength);\r\n        fr = 1;\r\n        fg = 1;\r\n        fb = 1;\r\n    }\r\n    for (y = 0; y < inputHeight; y++) {\r\n        for (x = 0; x < inputWidth; x++) {\r\n            blend(\r\n            // index\r\n            (x + y * inputWidth) * 4, \r\n            // data in\r\n            inputData, \r\n            // data out\r\n            outputData, \r\n            // opacity\r\n            (dist(x, y) * strength) / dm);\r\n        }\r\n    }\r\n    // @ts-ignore\r\n    done(null, {\r\n        data: outputData,\r\n        width: imageData.width,\r\n        height: imageData.height,\r\n    });\r\n};\r\n\r\nvar noiseEffect = (options, done) => {\r\n    const { imageData, level, monochrome = false } = options;\r\n    if (!level)\r\n        return done(null, imageData);\r\n    const outputData = new Uint8ClampedArray(imageData.width * imageData.height * 4);\r\n    const data = imageData.data;\r\n    const l = data.length;\r\n    let index = 0;\r\n    let r;\r\n    let g;\r\n    let b;\r\n    const rand = () => (-1 + Math.random() * 2) * 255 * level;\r\n    const pixel = monochrome\r\n        ? () => {\r\n            const average = rand();\r\n            return [average, average, average];\r\n        }\r\n        : () => {\r\n            return [rand(), rand(), rand()];\r\n        };\r\n    for (; index < l; index += 4) {\r\n        [r, g, b] = pixel();\r\n        outputData[index] = data[index] + r;\r\n        outputData[index + 1] = data[index + 1] + g;\r\n        outputData[index + 2] = data[index + 2] + b;\r\n        outputData[index + 3] = data[index + 3];\r\n    }\r\n    // @ts-ignore\r\n    done(null, {\r\n        data: outputData,\r\n        width: imageData.width,\r\n        height: imageData.height,\r\n    });\r\n};\r\n\r\nvar gammaEffect = (options, done) => {\r\n    const { imageData, level } = options;\r\n    if (!level)\r\n        return done(null, imageData);\r\n    const outputData = new Uint8ClampedArray(imageData.width * imageData.height * 4);\r\n    const data = imageData.data;\r\n    const l = data.length;\r\n    let index = 0;\r\n    let r;\r\n    let g;\r\n    let b;\r\n    for (; index < l; index += 4) {\r\n        r = data[index] / 255;\r\n        g = data[index + 1] / 255;\r\n        b = data[index + 2] / 255;\r\n        outputData[index] = Math.pow(r, level) * 255;\r\n        outputData[index + 1] = Math.pow(g, level) * 255;\r\n        outputData[index + 2] = Math.pow(b, level) * 255;\r\n        outputData[index + 3] = data[index + 3];\r\n    }\r\n    // @ts-ignore\r\n    done(null, {\r\n        data: outputData,\r\n        width: imageData.width,\r\n        height: imageData.height,\r\n    });\r\n};\r\n\r\nvar isIdentityMatrix = (matrix) => {\r\n    /*\r\n    [\r\n        1, 0, 0, 0, 0\r\n        0, 1, 0, 0, 0\r\n        0, 0, 1, 0, 0\r\n        0, 0, 0, 1, 0\r\n    ]\r\n    */\r\n    const l = matrix.length;\r\n    let v;\r\n    const s = l >= 20 ? 6 : l >= 16 ? 5 : 3;\r\n    for (let i = 0; i < l; i++) {\r\n        v = matrix[i];\r\n        if (v === 1 && i % s !== 0)\r\n            return false;\r\n        else if (v !== 0 && v !== 1)\r\n            return false;\r\n    }\r\n    return true;\r\n};\r\n\r\nvar filterImageData = async (imageData, options = {}) => {\r\n    const { colorMatrix, convolutionMatrix, gamma: gammaLevel, noise: noiseLevel, vignette: vignetteStrength, } = options;\r\n    // filters\r\n    const filters = [];\r\n    // apply convolution matrix\r\n    if (convolutionMatrix) {\r\n        filters.push([convolutionEffect, { matrix: convolutionMatrix.clarity }]);\r\n    }\r\n    // apply noise\r\n    if (gammaLevel > 0) {\r\n        filters.push([gammaEffect, { level: 1.0 / gammaLevel }]);\r\n    }\r\n    // apply color matrix\r\n    if (colorMatrix && !isIdentityMatrix(colorMatrix)) {\r\n        filters.push([colorEffect, { matrix: colorMatrix }]);\r\n    }\r\n    // apply noise\r\n    if (noiseLevel > 0 || noiseLevel < 0) {\r\n        filters.push([noiseEffect, { level: noiseLevel }]);\r\n    }\r\n    // apply vignette\r\n    if (vignetteStrength > 0 || vignetteStrength < 0) {\r\n        filters.push([vignetteEffect, { strength: vignetteStrength }]);\r\n    }\r\n    // no changes\r\n    if (!filters.length)\r\n        return imageData;\r\n    // builds effect chain\r\n    const chain = (transforms, i) => `(err, imageData) => {\r\n            (${transforms[i][0].toString()})(Object.assign({ imageData: imageData }, filterInstructions[${i}]), \r\n                ${transforms[i + 1] ? chain(transforms, i + 1) : 'done'})\r\n        }`;\r\n    const filterChain = `function (options, done) {\r\n        const filterInstructions = options.filterInstructions;\r\n        const imageData = options.imageData;\r\n        (${chain(filters, 0)})(null, imageData)\r\n    }`;\r\n    imageData = await thread(filterChain, [\r\n        {\r\n            imageData: imageData,\r\n            filterInstructions: filters.map((t) => t[1]),\r\n        },\r\n    ], [imageData.data.buffer]);\r\n    // the resizer returns a plain object, not an actual image data object, lets create one\r\n    return imageDataObjectToImageData(imageData);\r\n};\r\n\r\nvar isNumber = (v) => typeof v === 'number';\r\n\r\nvar isEmoji = (str) => isString(str) &&\r\n    str.match(/(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\u0023-\\u0039]\\ufe0f?\\u20e3|\\u3299|\\u3297|\\u303d|\\u3030|\\u24c2|\\ud83c[\\udd70-\\udd71]|\\ud83c[\\udd7e-\\udd7f]|\\ud83c\\udd8e|\\ud83c[\\udd91-\\udd9a]|\\ud83c[\\udde6-\\uddff]|\\ud83c[\\ude01-\\ude02]|\\ud83c\\ude1a|\\ud83c\\ude2f|\\ud83c[\\ude32-\\ude3a]|\\ud83c[\\ude50-\\ude51]|\\u203c|\\u2049|[\\u25aa-\\u25ab]|\\u25b6|\\u25c0|[\\u25fb-\\u25fe]|\\u00a9|\\u00ae|\\u2122|\\u2139|\\ud83c\\udc04|[\\u2600-\\u26FF]|\\u2b05|\\u2b06|\\u2b07|\\u2b1b|\\u2b1c|\\u2b50|\\u2b55|\\u231a|\\u231b|\\u2328|\\u23cf|[\\u23e9-\\u23f3]|[\\u23f8-\\u23fa]|\\ud83c\\udccf|\\u2934|\\u2935|[\\u2190-\\u21ff])/g) !== null;\r\n\r\nvar hasProp = (obj, key) => obj.hasOwnProperty(key);\r\n\r\nvar isArray = (arr) => Array.isArray(arr);\r\n\r\nvar isApple = () => isIOS() || isMac();\r\n\r\nvar isWindows = () => /^win/i.test(navigator.platform);\r\n\r\n// macos:   font-size: 123, x: 63.5, y: 110\r\n// windows: font-size: 112, x: 64, y: 103\r\n// android: font-size: 112, x: 64, y: 102\r\nlet x = 64;\r\nlet y = 102;\r\nlet fontSize = 112;\r\nlet hasSetValues = false;\r\nvar getEmojiSVG = (emoji, alt) => {\r\n    if (!hasSetValues && isBrowser()) {\r\n        if (isWindows())\r\n            y = 103;\r\n        if (isApple()) {\r\n            x = 63.5;\r\n            y = 110;\r\n            fontSize = 123;\r\n        }\r\n        hasSetValues = true;\r\n    }\r\n    return `<svg${alt ? ` aria-label=\"${alt}\"` : ''} width=\"128\" height=\"128\" viewBox=\"0 0 128 128\" preserveAspectRatio=\"xMinYMin meet\" xmlns=\"http://www.w3.org/2000/svg\"><text x=\"${x}\" y=\"${y}\" alignment-baseline=\"text-top\" dominant-baseline=\"text-top\" text-anchor=\"middle\" font-size=\"${fontSize}px\">${emoji}</text></svg>`;\r\n};\r\n\r\nvar SVGToDataURL = (svg) => `data:image/svg+xml,${svg.replace('<', '%3C').replace('>', '%3E')}`;\r\n\r\nvar isBinary = (v) => v instanceof Blob;\r\n\r\nvar toPercentage = (value, total) => `${(value / total) * 100}%`;\r\n\r\nvar colorArrayToRGBA = (color) => `rgba(${Math.round(color[0] * 255)}, ${Math.round(color[1] * 255)}, ${Math.round(color[2] * 255)}, ${isNumber(color[3]) ? color[3] : 1})`;\r\n\r\n// tested and this seems a tiny bit faster than JSON.stringify\r\nvar objectUID = (obj) => Object.values(obj).join('_');\r\n\r\nvar timeout = (timeout = 0) => new Promise((resolve) => {\r\n    setTimeout(resolve, timeout);\r\n});\r\n\r\n// cannot use a ObjectURL because of a webkit bug (throws error in chrome / safari)\r\n// returns true if every pixel's uint32 representation is 0 (or \"blank\")\r\nconst isContextBlank = (ctx) => {\r\n    const buffer = new Uint32Array(ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height).data.buffer);\r\n    return !buffer.some((color) => color !== 0);\r\n};\r\nconst width = 80;\r\nconst height = 80;\r\nconst whenSVGSafeForDrawing = async (img, delay = 0) => {\r\n    // Safari has some trouble with custom fonts\r\n    const canvas = h('canvas', { width, height });\r\n    const ctx = canvas.getContext('2d');\r\n    // always wait a short while because it's never ready on first drawy\r\n    await timeout(delay);\r\n    // we draw the image so we can test if the content is drawn. If custom font isn't ready the canvas will be empty\r\n    ctx.drawImage(img, 0, 0, width, height);\r\n    if (isContextBlank(ctx) && delay <= 256)\r\n        return await whenSVGSafeForDrawing(img, delay + 16);\r\n    return true;\r\n};\r\n// store cached draw cycles here\r\nconst safariDrawCache = new Map();\r\nvar svgToImage = (svg, { safariCacheKey = '*' } = {}) => new Promise((resolve, reject) => {\r\n    const img = new Image();\r\n    img.onerror = reject;\r\n    img.onload = () => {\r\n        // We done!\r\n        if (!isSafari() || !svg.includes('@font-face') || safariDrawCache.has(safariCacheKey))\r\n            return resolve(img);\r\n        // wait for embedded fonts to load\r\n        whenSVGSafeForDrawing(img).then(() => {\r\n            safariDrawCache.set(safariCacheKey, true);\r\n            resolve(img);\r\n        });\r\n    };\r\n    img.src = 'data:image/svg+xml,' + svg;\r\n});\r\n\r\nvar blobToDataURL = (blob) => new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.onerror = reject;\r\n    reader.onload = () => resolve(reader.result);\r\n    reader.readAsDataURL(blob);\r\n});\r\n\r\nvar pubsub = () => {\r\n    let subs = [];\r\n    return {\r\n        sub: (event, callback) => {\r\n            subs.push({ event, callback });\r\n            return () => (subs = subs.filter((subscriber) => subscriber.event !== event || subscriber.callback !== callback));\r\n        },\r\n        pub: (event, value) => {\r\n            subs\r\n                .filter((sub) => sub.event === event)\r\n                .forEach((sub) => sub.callback(value));\r\n        }\r\n    };\r\n};\r\n\r\nvar escapeTags = (str) => str.replace(/</g, '&lt;').replace(/>/g, '&gt;');\r\n\r\n// used to make sure text is drawn outside of element in a correct way\r\nconst TextPadding = 32;\r\nconst textGetInitialLineOffset = ({ fontSize = 16, lineHeight = 20 } = {}) => Math.max(0, fontSize - lineHeight) * 0.5;\r\nconst textGetLineCount = (text = '') => text.split('\\n').length;\r\nconst textGetStyles = ({ color = [0, 0, 0], fontSize = 16, fontFamily = 'sans-serif', fontVariant = 'normal', fontWeight = 'normal', fontStyle = 'normal', textAlign = 'left', lineHeight = 20, }) => `font-size:${fontSize}px;font-style:${fontStyle};font-weight:${fontWeight};font-family:${fontFamily};font-variant:${fontVariant};line-height:${lineHeight}px;text-align:${textAlign};color:${colorArrayToRGBA(color)};`;\r\nconst textGetContentEditableStyles = (text, options) => {\r\n    const { width, height, disableNewline } = options;\r\n    const isAutoWidth = !width;\r\n    const allowNewline = disableNewline === false ? textGetLineCount(text) : undefined;\r\n    const widthValue = isAutoWidth ? 'auto' : `${width}px`;\r\n    const heightValue = height ? `${height}px` : 'auto';\r\n    const wordBreak = isAutoWidth ? 'normal' : 'break-word';\r\n    const whiteSpace = isAutoWidth && !allowNewline ? 'nowrap' : 'pre-line';\r\n    const paddingTop = textGetInitialLineOffset(options);\r\n    return `max-width:none;min-width:auto;width:${widthValue};height:${heightValue};margin-top:0;margin-bottom:0;padding-top:${paddingTop}px;word-break:${wordBreak};word-wrap:normal;white-space:${whiteSpace};overflow:visible;`;\r\n};\r\nconst TextMeasureCache = new Map();\r\nconst textMeasure = (text = '', options) => {\r\n    // gather props that impact size and test if can be found in cache\r\n    const { width = 0, height = 'auto', fontSize, fontFamily, lineHeight, fontWeight, fontStyle, fontVariant, } = options;\r\n    const uid = objectUID({\r\n        text,\r\n        fontFamily,\r\n        fontWeight,\r\n        fontStyle,\r\n        fontVariant,\r\n        fontSize,\r\n        lineHeight,\r\n        width,\r\n        height,\r\n    });\r\n    let measurement = TextMeasureCache.get(uid);\r\n    if (measurement)\r\n        return measurement;\r\n    // this is appended to the end of the text and helps us determine if text wrapped\r\n    const endMarker = h('span');\r\n    const element = appendForMeasuring(h('pre', {\r\n        contenteditable: 'true',\r\n        spellcheck: 'false',\r\n        style: `pointer-events:none;visibility:hidden;position:absolute;left:0;top:0;${textGetStyles({\r\n            fontFamily,\r\n            fontWeight,\r\n            fontStyle,\r\n            fontVariant,\r\n            fontSize,\r\n            lineHeight,\r\n        })};${textGetContentEditableStyles(text, options)}\"`,\r\n        innerHTML: text,\r\n    }, [endMarker]));\r\n    //\r\n    // insert a character at the end and ask bounding client rect, should change position if wrapping changes\r\n    //\r\n    const elementRect = element.getBoundingClientRect();\r\n    const endMarkerRect = endMarker.getBoundingClientRect();\r\n    measurement = {\r\n        textSize: sizeCreateFromAny(elementRect),\r\n        lastCharPosition: vectorApply(vectorCreateFromAny(endMarkerRect), Math.round),\r\n    };\r\n    TextMeasureCache.set(uid, measurement);\r\n    // clean up measured elements\r\n    element.remove();\r\n    return measurement;\r\n};\r\nconst TextSizeCache = new Map();\r\nconst textToSize = (text = '', options) => {\r\n    const { width = 0, height = 0 } = options;\r\n    if (width && height)\r\n        return sizeCreate(width, height);\r\n    // gather props that impact size and test if can be found in cache\r\n    const { fontSize, fontFamily, lineHeight, fontWeight, fontStyle, fontVariant } = options;\r\n    const uid = objectUID({\r\n        text,\r\n        fontFamily,\r\n        fontWeight,\r\n        fontStyle,\r\n        fontVariant,\r\n        fontSize,\r\n        lineHeight,\r\n        width,\r\n    });\r\n    let size = TextSizeCache.get(uid);\r\n    if (size)\r\n        return size;\r\n    // fix height calc on Safari\r\n    if (isSafari() && text.endsWith('\\n') && !text.endsWith('\\n\\n'))\r\n        text += '\\n';\r\n    // new measurement needed\r\n    const element = appendForMeasuring(h('pre', {\r\n        contenteditable: 'true',\r\n        spellcheck: 'false',\r\n        style: `pointer-events:none;visibility:hidden;position:absolute;${textGetStyles(options)};${textGetContentEditableStyles(text, options)}\"`,\r\n        innerHTML: text,\r\n    }, [h('span')]));\r\n    const rect = element.getBoundingClientRect();\r\n    // cache measurement for next query\r\n    size = sizeCreateFromAny(rect);\r\n    // add additional height to prevent cutting off footer\r\n    size.height += Math.max(0, fontSize - lineHeight);\r\n    TextSizeCache.set(uid, size);\r\n    return size;\r\n};\r\nconst getPathFromURL = (url) => url.pathname.split('/').slice(0, -1).join('/');\r\nconst createStyleSheetLoader = (url, willRequest) => {\r\n    const { sub, pub } = pubsub();\r\n    let text;\r\n    let error;\r\n    Promise.resolve(willRequest && willRequest(url, { resourceType: 'stylesheet' })).then((requestInit) => {\r\n        // prevent load\r\n        if (requestInit === false) {\r\n            error = 'requestPrevented';\r\n            return pub('error', error);\r\n        }\r\n        // get props\r\n        const { headers, credentials } = requestInit || {};\r\n        // fetching\r\n        fetch(url, { headers, credentials })\r\n            .then((res) => res.text())\r\n            .then((txt) => {\r\n            text = txt;\r\n            pub('load', text);\r\n        })\r\n            .catch((err) => {\r\n            error = err;\r\n            pub('error', error);\r\n        });\r\n    });\r\n    return {\r\n        sub: (event, cb) => {\r\n            if (event === 'load' && text)\r\n                return cb(text);\r\n            if (event === 'error' && error)\r\n                return cb(error);\r\n            sub(event, cb);\r\n        },\r\n    };\r\n};\r\nconst StyleSheetLoaders = new Map();\r\nconst loadStylesheet = (url, willRequest) => new Promise((resolve, reject) => {\r\n    let loader = StyleSheetLoaders.get(url);\r\n    if (typeof loader === 'undefined') {\r\n        loader = createStyleSheetLoader(url, willRequest);\r\n        StyleSheetLoaders.set(url, loader);\r\n    }\r\n    loader.sub('load', resolve);\r\n    loader.sub('error', reject);\r\n});\r\n// use this method to access rules because when accessing third party stylesheetes like google fonts it will throw a warning\r\nconst getRulesRemote = async (src, willRequest) => {\r\n    // could not access, let's try to load\r\n    let styleSheetContent;\r\n    try {\r\n        styleSheetContent = await loadStylesheet(src, willRequest);\r\n    }\r\n    catch (err) {\r\n        return [];\r\n    }\r\n    const style = h('style', {\r\n        innerHTML: styleSheetContent,\r\n        id: getUniqueId(),\r\n    });\r\n    document.head.append(style);\r\n    const tempStyleSheet = Array.from(document.styleSheets).find((styleSheet) => {\r\n        const node = styleSheet.ownerNode;\r\n        return node.id === style.id;\r\n    });\r\n    style.remove();\r\n    return Array.from(tempStyleSheet.cssRules);\r\n};\r\nconst RemoteStyleSheetRulesCache = new Map();\r\nconst filterFontFaceRules = (rules) => rules.filter((rule) => rule instanceof CSSFontFaceRule);\r\nconst filterImportRules = (rules) => rules.filter((rule) => rule instanceof CSSImportRule);\r\nconst getFontFaceRulesSafe = async (styleSheet, willRequest) => {\r\n    // if cached rules, return\r\n    if (RemoteStyleSheetRulesCache.has(styleSheet.href))\r\n        return RemoteStyleSheetRulesCache.get(styleSheet.href);\r\n    // try to get rules\r\n    let rules;\r\n    try {\r\n        // get all rules\r\n        rules = Array.from(styleSheet.cssRules);\r\n        // get @imports\r\n        for (const importRule of filterImportRules(rules)) {\r\n            const url = importRule.href;\r\n            // already loaded this one before\r\n            if (RemoteStyleSheetRulesCache.has(url)) {\r\n                const remoteRules = RemoteStyleSheetRulesCache.get(url);\r\n                rules = [...rules, ...remoteRules];\r\n                continue;\r\n            }\r\n            // get remote rules for this @import\r\n            const remoteRules = await getRulesRemote(url, willRequest);\r\n            // remember returned rules for next run\r\n            RemoteStyleSheetRulesCache.set(url, remoteRules);\r\n            // add found rules\r\n            rules = [...rules, ...remoteRules];\r\n        }\r\n    }\r\n    catch (err) {\r\n        const url = styleSheet.href;\r\n        // this tries to load the styles with `fetch`\r\n        rules = await getRulesRemote(url, willRequest);\r\n        // remember returned rules for next run\r\n        RemoteStyleSheetRulesCache.set(url, rules);\r\n    }\r\n    // only interested in font face rules\r\n    return filterFontFaceRules(rules);\r\n};\r\nconst getCSSPropertyValue = (rule, name) => rule.style.getPropertyValue(name);\r\nconst isMatchingFontRule = (rule, fontFamily) => {\r\n    if (!rule.style)\r\n        return false;\r\n    const family = getCSSPropertyValue(rule, 'font-family').replace(/^\"|\"$/g, '');\r\n    return family == fontFamily;\r\n};\r\nconst getMatchingFontRule = (rules, fontFamily) => {\r\n    const res = [];\r\n    for (const fontRule of rules) {\r\n        const isMatch = isMatchingFontRule(fontRule, fontFamily);\r\n        if (!isMatch)\r\n            continue;\r\n        res.push(fontRule);\r\n    }\r\n    return res;\r\n};\r\nconst getDocumentStylesheetFontFaceRules = async (willRequest) => {\r\n    const styleSheets = Array.from(document.styleSheets).map((styleSheet) => getFontFaceRulesSafe(styleSheet, willRequest));\r\n    const ruleSets = await Promise.all(styleSheets);\r\n    const rules = [];\r\n    ruleSets.forEach((ruleSet) => rules.push(...ruleSet));\r\n    return rules;\r\n};\r\nconst getFontSources = async (fontFamily, willRequest) => {\r\n    // get matching font face rules\r\n    const fontFaceRules = await getDocumentStylesheetFontFaceRules(willRequest);\r\n    // rules matching this font\r\n    const matchingRules = getMatchingFontRule(fontFaceRules, fontFamily);\r\n    if (!matchingRules.length)\r\n        return [];\r\n    return matchingRules.map((rule) => {\r\n        // create stylesheet root path so we can determine font path\r\n        const url = rule.parentStyleSheet.href && new URL(rule.parentStyleSheet.href);\r\n        const styleSheetPath = url ? url.origin + getPathFromURL(url) + '/' : '';\r\n        // create font source\r\n        const fontSources = rule.style.getPropertyValue('src');\r\n        const fontSrcFirst = fontSources.match(/url\\(\"?(.*?)\"?\\)/)[1];\r\n        // get styles\r\n        const fontProps = Array.from(rule.style)\r\n            .filter((prop) => prop != 'src')\r\n            .reduce((props, key) => {\r\n            props += key + ':' + getCSSPropertyValue(rule, key) + ';';\r\n            return props;\r\n        }, '');\r\n        // merge together to create path (Safari font URL is absolute so if it is we only use that url)\r\n        return [\r\n            /^http/.test(fontSrcFirst) ? fontSrcFirst : styleSheetPath + fontSrcFirst,\r\n            fontProps,\r\n        ];\r\n    });\r\n};\r\nconst FontLocal = new Map();\r\nconst FontCache = new Map();\r\n// application/x-font-ttf\r\n// application/x-font-truetype\r\n// application/x-font-opentype\r\n// application/font-woff\r\n// application/font-woff2\r\n// font/otf\r\n// font/ttf\r\n// font/woff\r\n// font/woff2\r\nconst getFontFormatByMimeType = (type) => {\r\n    if (!type || /woff2/.test(type))\r\n        return 'woff2';\r\n    if (/woff/.test(type))\r\n        return 'woff';\r\n    if (/ttf|truetype/.test(type))\r\n        return 'truetype';\r\n    if (/otf|opentype/.test(type))\r\n        return 'opentype';\r\n    if (/svg/.test(type))\r\n        return 'svg';\r\n    return 'woff2';\r\n};\r\nconst getFontFaceEmbed = async (fontFamily, willRequest) => {\r\n    // todo test if is local font\r\n    if (FontLocal.get(fontFamily))\r\n        return;\r\n    let fontStyles = FontCache.get(fontFamily);\r\n    if (!fontStyles) {\r\n        // not cached yet, let's find the font source and turn it into a dataURL\r\n        const fontSources = await getFontSources(fontFamily, willRequest);\r\n        // no source found, is local font\r\n        if (!fontSources.length) {\r\n            FontLocal.set(fontFamily, true);\r\n            return;\r\n        }\r\n        const fontFaces = [];\r\n        for (const [fontSource, fontProps] of fontSources) {\r\n            const blob = await fetch(fontSource).then((res) => res.blob());\r\n            const dataType = getFontFormatByMimeType(blob.type);\r\n            const dataURL = await blobToDataURL(blob);\r\n            fontFaces.push(`@font-face { src:url(${dataURL}) format('${dataType}');${fontProps};font-display:block; }`);\r\n        }\r\n        fontStyles = fontFaces.join('');\r\n        // cache the font so it's super fast in next request\r\n        FontCache.set(fontFamily, fontStyles);\r\n    }\r\n    return fontStyles;\r\n};\r\nvar textToImage = async (text = '', options) => {\r\n    // exit if no text\r\n    if (!text.length)\r\n        return;\r\n    const { imageWidth = 300, imageHeight = 150, paddingLeft = TextPadding, paddingRight = TextPadding, fontFamily, pixelRatio = 1, willRequest, } = options;\r\n    const width = (imageWidth + paddingLeft + paddingRight) * pixelRatio;\r\n    const height = imageHeight * pixelRatio;\r\n    const textStyles = textGetStyles(options);\r\n    const textContentEditableStyles = textGetContentEditableStyles(text, options);\r\n    const fontEmbed = await getFontFaceEmbed(fontFamily, willRequest);\r\n    const textEncoded = text\r\n        // these characters need to be encoded in an SVG dataURL\r\n        .replace(/&/g, '&amp;')\r\n        .replace(/#/g, '%23')\r\n        // no non-closing tags allowed in foreignObject as is xhtml namespace\r\n        .replace(/<br>/g, '___BR___')\r\n        // safari and firefox don't draw newline character so replace with <br/>\r\n        .replace(/\\n/g, '___BR___');\r\n    const textEscaped = escapeTags(textEncoded);\r\n    const textFinal = textEscaped.replace(/___BR___/g, '<br/>');\r\n    const svg = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\"><foreignObject x=\"0\" y=\"0\" width=\"${width}\" height=\"${height}\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"transform-origin:0 0;transform:scale(${pixelRatio})\">${fontEmbed ? `<style>${fontEmbed}</style>` : ''}<pre contenteditable=\"true\" spellcheck=\"false\" style=\"position:absolute;padding-right:${paddingRight}px;padding-left:${paddingLeft}px;${textStyles};${textContentEditableStyles}\">${textFinal}</pre></div></foreignObject></svg>`;\r\n    // uncomment for debugging\r\n    // document.body.append(h('div', { innerHTML: svg }));\r\n    return svgToImage(svg, { safariCacheKey: fontFamily });\r\n};\r\n\r\nconst shapeEqual = (a, b) => {\r\n    return JSON.stringify(a) === JSON.stringify(b);\r\n};\r\nconst shapeDeepCopy = (shape) => {\r\n    const shapeShallowCopy = { ...shape };\r\n    const shapeDeepCopy = deepCopy(shapeShallowCopy);\r\n    return shapeDeepCopy;\r\n};\r\nconst getContextSize = (context, size = {}) => {\r\n    const contextAspectRatio = rectAspectRatio(context);\r\n    let xOut;\r\n    let yOut;\r\n    const xIn = size.width || size.rx;\r\n    const yIn = size.height || size.ry;\r\n    if (xIn && yIn)\r\n        return sizeClone(size);\r\n    if (xIn || yIn) {\r\n        xOut = parseFloat(xIn || Number.MAX_SAFE_INTEGER);\r\n        yOut = parseFloat(yIn || Number.MAX_SAFE_INTEGER);\r\n        const min = Math.min(xOut, yOut);\r\n        if (isString(xIn) || isString(yIn)) {\r\n            xOut = `${min}%`;\r\n            yOut = `${min * contextAspectRatio}%`;\r\n        }\r\n        else {\r\n            xOut = min;\r\n            yOut = min;\r\n        }\r\n    }\r\n    else {\r\n        const min = 10;\r\n        xOut = `${min}%`;\r\n        yOut = `${min * contextAspectRatio}%`;\r\n    }\r\n    const xProp = size.width ? 'width' : size.rx ? 'rx' : undefined;\r\n    const yProp = size.width ? 'height' : size.rx ? 'ry' : undefined;\r\n    return {\r\n        [xProp || 'width']: xOut,\r\n        [yProp || 'height']: yOut,\r\n    };\r\n};\r\nconst shapeCreateFromEmoji = (emoji, props = {}) => {\r\n    return {\r\n        width: undefined,\r\n        height: undefined,\r\n        ...props,\r\n        aspectRatio: 1,\r\n        backgroundImage: SVGToDataURL(getEmojiSVG(emoji)),\r\n    };\r\n};\r\nconst shapeCreateFromImage = (src, shapeProps = {}) => {\r\n    const shapeDefaultLayout = shapeIsEllipse(shapeProps)\r\n        ? {}\r\n        : {\r\n            width: undefined,\r\n            height: undefined,\r\n            aspectRatio: undefined,\r\n        };\r\n    const shape = {\r\n        // required/default image shape props\r\n        backgroundColor: [0, 0, 0, 0],\r\n        // set default layout props\r\n        ...shapeDefaultLayout,\r\n        // merge with custom props\r\n        ...shapeProps,\r\n        // set image\r\n        backgroundImage: \r\n        // is svg or URL\r\n        isString(src) ? src : isBinary(src) ? URL.createObjectURL(src) : src,\r\n    };\r\n    return shape;\r\n};\r\nconst shapeCreateFromPreset = (preset, parentRect) => {\r\n    let shape;\r\n    if (isString(preset) || isBinary(preset)) {\r\n        // default props for \"quick\" preset\r\n        const shapeOptions = {\r\n            ...getContextSize(parentRect),\r\n            backgroundSize: 'contain',\r\n        };\r\n        // if is emoji, create default markup,\r\n        if (isEmoji(preset)) {\r\n            shape = shapeCreateFromEmoji(preset, shapeOptions);\r\n        }\r\n        // is URL, create default markup for image\r\n        else {\r\n            shape = shapeCreateFromImage(preset, shapeOptions);\r\n        }\r\n    }\r\n    else {\r\n        // is using src shortcut\r\n        if (preset.src) {\r\n            const contextSize = getContextSize(parentRect, preset.shape || preset);\r\n            // shape options\r\n            const shapeOptions = {\r\n                // default shape styles\r\n                ...preset.shape,\r\n                // precalcualte size of shape in context\r\n                ...contextSize,\r\n            };\r\n            // should auto-fix aspect ratio\r\n            if (preset.width && preset.height && !hasProp(shapeOptions, 'aspectRatio')) {\r\n                const width = shapeGetPropPixelValue(contextSize, 'width', parentRect);\r\n                const height = shapeGetPropPixelValue(contextSize, 'height', parentRect);\r\n                shapeOptions.aspectRatio = getAspectRatio(width, height);\r\n            }\r\n            // should auto-contain sticker in container\r\n            if (!shapeOptions.backgroundSize && !preset.shape && (!preset.width || !preset.height))\r\n                shapeOptions.backgroundSize = 'contain';\r\n            // emoji markup\r\n            if (isEmoji(preset.src)) {\r\n                shape = shapeCreateFromEmoji(preset.src, shapeOptions);\r\n            }\r\n            // is url\r\n            else {\r\n                shape = shapeCreateFromImage(preset.src, shapeOptions);\r\n            }\r\n        }\r\n        // should have markup defined\r\n        else if (preset.shape) {\r\n            shape = shapeDeepCopy(preset.shape);\r\n        }\r\n    }\r\n    if (hasProp(shape, 'backgroundImage')) {\r\n        // set transparent background if no background color defined\r\n        if (!hasProp(shape, 'backgroundColor')) {\r\n            shape.backgroundColor = [0, 0, 0, 0];\r\n        }\r\n        // for rectangles with image presets, disable these styles by default\r\n        if (!hasProp(shape, 'disableStyle')) {\r\n            shape.disableStyle = ['cornerRadius', 'backgroundColor', 'strokeColor', 'strokeWidth'];\r\n        }\r\n    }\r\n    return parentRect ? shapeComputeDisplay(shape, parentRect) : shape;\r\n};\r\nconst shapeLineGetStartPoint = (line) => vectorCreate(line.x1, line.y1);\r\nconst shapeLineGetEndPoint = (line) => vectorCreate(line.x2, line.y2);\r\n//#endregion\r\n//#region shape testing\r\n// shape types\r\nconst shapeIsText = (shape) => hasProp(shape, 'text');\r\nconst shapeIsTextBlock = (shape) => shapeIsText(shape) && !(shapeHasRelativeSize(shape) || hasProp(shape, 'width'));\r\nconst shapeIsTextBox = (shape) => shapeIsText(shape) && (shapeHasRelativeSize(shape) || hasProp(shape, 'width'));\r\nconst shapeIsRect = (shape) => !shapeIsText(shape) && shapeHasComputedSize(shape);\r\nconst shapeIsEllipse = (shape) => hasProp(shape, 'rx');\r\nconst shapeIsLine = (shape) => hasProp(shape, 'x1');\r\nconst shapeIsPath = (shape) => hasProp(shape, 'points');\r\n// shape state\r\nconst shapeIsTextEmpty = (shape) => shapeIsText(shape) && !shape.text.length;\r\nconst shapeIsTextEditing = (shape) => shapeIsText(shape) && shape.isEditing;\r\nconst shapeIsVisible = (shape) => hasProp(shape, 'opacity') ? shape.opacity > 0 : true;\r\nconst shapeIsSelected = (shape) => shape.isSelected;\r\nconst shapeIsEditing = (shape) => shape.isEditing;\r\nconst shapeIsDraft = (shape) => shape._isDraft;\r\nconst shapeHasSize = (shape) => hasProp(shape, 'width') && hasProp(shape, 'height');\r\nconst shapeHasNumericStroke = (shape) => isNumber(shape.strokeWidth) && shape.strokeWidth > 0; // only relevant if is bigger than 0\r\nconst shapeHasRelativePosition = (shape) => {\r\n    const hasRight = hasProp(shape, 'right');\r\n    const hasBottom = hasProp(shape, 'bottom');\r\n    return hasRight || hasBottom;\r\n};\r\nconst shapeHasTexture = (shape) => hasProp(shape, 'backgroundImage') || hasProp(shape, 'text');\r\nconst shapeHasRelativeSize = (shape) => ((hasProp(shape, 'x') || hasProp(shape, 'left')) && hasProp(shape, 'right')) ||\r\n    ((hasProp(shape, 'y') || hasProp(shape, 'top')) && hasProp(shape, 'bottom'));\r\nconst shapeHasComputedSize = (shape) => shapeHasSize(shape) || shapeHasRelativeSize(shape);\r\nconst shapeIsVisibleColor = (shape, colorProp) => {\r\n    const value = shape[colorProp];\r\n    if (!value)\r\n        return false;\r\n    if (value.length === 3)\r\n        return true;\r\n    return value[3] > 0;\r\n};\r\nconst shapeHasStroke = (shape) => shape.strokeWidth && shapeIsVisibleColor(shape, 'strokeColor');\r\n// actions\r\nconst shapeSelect = (shape) => {\r\n    shape.isSelected = true;\r\n    return shape;\r\n};\r\nconst shapeMakeDraft = (shape) => {\r\n    shape._isDraft = true;\r\n    return shape;\r\n};\r\nconst shapeMakeFinal = (shape) => {\r\n    shape._isDraft = false;\r\n    return shape;\r\n};\r\n// rights\r\nconst shapeCanStyle = (shape, style) => {\r\n    if (shape.disableStyle === true)\r\n        return false;\r\n    if (isArray(shape.disableStyle) && style) {\r\n        return !shape.disableStyle.includes(style);\r\n    }\r\n    return true;\r\n};\r\nconst shapeCanSelect = (shape) => shape.disableSelect !== true;\r\nconst shapeCanRemove = (shape) => shape.disableRemove !== true;\r\nconst shapeCanDuplicate = (shape) => shape.disableDuplicate !== true && shapeCanMove(shape);\r\nconst shapeCanReorder = (shape) => shape.disableReorder !== true;\r\nconst shapeCanFlip = (shape) => {\r\n    if (shape.disableFlip)\r\n        return false;\r\n    if (shapeIsDraft(shape) || shapeHasRelativePosition(shape))\r\n        return false;\r\n    return shapeHasTexture(shape);\r\n};\r\nconst shapeCanInput = (shape, input) => {\r\n    if (!shapeIsText(shape))\r\n        return false;\r\n    if (shape.disableInput === true)\r\n        return false;\r\n    if (isFunction(shape.disableInput))\r\n        return shape.disableInput(input != null ? input : shape.text);\r\n    return input || true;\r\n};\r\nconst shapeCanChangeTextLayout = (shape, layout) => {\r\n    if (shape.disableTextLayout === true)\r\n        return false;\r\n    if (isArray(shape.disableTextLayout) && layout) {\r\n        return !shape.disableTextLayout.includes(layout);\r\n    }\r\n    return true;\r\n};\r\nconst shapeCanManipulate = (shape) => shape.disableManipulate !== true && !shapeIsDraft(shape) && !shapeHasRelativePosition(shape);\r\nconst shapeCanMove = (shape) => shapeCanManipulate(shape) && shape.disableMove !== true;\r\nconst shapeCanResize = (shape) => shapeCanManipulate(shape) &&\r\n    shapeCanMove(shape) &&\r\n    shape.disableResize !== true &&\r\n    (shapeHasSize(shape) ||\r\n        shapeIsTextBox(shape) ||\r\n        shapeIsEllipse(shape) ||\r\n        shapeIsLine(shape) ||\r\n        (shapeIsPath(shape) && hasProp(shape, 'pathClose')));\r\nconst shapeCanRotate = (shape) => shapeCanManipulate(shape) &&\r\n    shape.disableRotate !== true &&\r\n    (shapeHasSize(shape) || hasProp(shape, 'text') || shapeIsEllipse(shape));\r\n//#endregion\r\n//#region shape formatting\r\nconst shapeDeleteRelativeProps = (shape) => {\r\n    delete shape.left;\r\n    delete shape.right;\r\n    delete shape.top;\r\n    delete shape.bottom;\r\n    return shape;\r\n};\r\nconst shapeDeleteTransformProps = (shape) => {\r\n    delete shape.rotation;\r\n    return shape;\r\n};\r\nconst shapeFormatStroke = (shape) => {\r\n    shape.strokeWidth = shape.strokeWidth || 1;\r\n    shape.strokeColor = shape.strokeColor || [0, 0, 0];\r\n    return shape;\r\n};\r\nconst shapeFormatFill = (shape) => {\r\n    shape.backgroundColor = shape.backgroundColor\r\n        ? shape.backgroundColor\r\n        : shape.strokeWidth || shape.backgroundImage\r\n            ? undefined\r\n            : [0, 0, 0];\r\n    return shape;\r\n};\r\nconst shapeFormatText = (shape) => {\r\n    shape.fontSize = shape.fontSize || '4%';\r\n    shape.fontFamily = shape.fontFamily || 'sans-serif';\r\n    shape.fontWeight = shape.fontWeight || 'normal';\r\n    shape.fontStyle = shape.fontStyle || 'normal';\r\n    shape.fontVariant = shape.fontVariant || 'normal';\r\n    shape.lineHeight = shape.lineHeight || '120%';\r\n    shape.color = shape.color || [0, 0, 0];\r\n    return shapeIsTextBlock(shape) ? shapeFormatTextBlock(shape) : shapeFormatTextBox(shape);\r\n};\r\nconst shapeFormatTextBlock = (shape) => {\r\n    // for now can't align if not allowed to use newlines\r\n    if (shape.disableNewline !== false) {\r\n        delete shape.textAlign;\r\n        shape.text = shape.text.replace(/\\n/g, ' ');\r\n    }\r\n    return shapeDeleteRelativeProps(shape);\r\n};\r\nconst shapeFormatTextBox = (shape) => {\r\n    shape.textAlign = shape.textAlign || 'left';\r\n    return shape;\r\n};\r\nconst shapeFormatRect = (shape) => {\r\n    shape.cornerRadius = shape.cornerRadius || 0;\r\n    shape.strokeWidth = shape.strokeWidth || 0;\r\n    shape.strokeColor = shape.strokeColor || [0, 0, 0];\r\n    return shapeFormatFill(shape);\r\n};\r\nconst shapeFormatEllipse = (shape) => {\r\n    shape.strokeWidth = shape.strokeWidth || 0;\r\n    shape.strokeColor = shape.strokeColor || [0, 0, 0];\r\n    return shapeFormatFill(shape);\r\n};\r\nconst shapeFormatPath = (shape) => {\r\n    shapeFormatStroke(shape);\r\n    shapeDeleteTransformProps(shape);\r\n    if (!hasProp(shape, 'pathClose')) {\r\n        shape.disableResize = true;\r\n        if (!hasProp(shape, 'disableMove')) {\r\n            shape.disableMove = true;\r\n        }\r\n    }\r\n    return shapeDeleteRelativeProps(shape);\r\n};\r\nconst shapeFormatLine = (shape) => {\r\n    shapeFormatStroke(shape);\r\n    shape.lineStart = shape.lineStart || undefined;\r\n    shape.lineEnd = shape.lineEnd || undefined;\r\n    shapeDeleteTransformProps(shape);\r\n    return shapeDeleteRelativeProps(shape);\r\n};\r\nconst shapeFormatDefaults = (shape) => {\r\n    if (!isString(shape.id))\r\n        shape.id = getUniqueId();\r\n    if (!hasProp(shape, 'rotation'))\r\n        shape.rotation = 0;\r\n    if (!hasProp(shape, 'opacity'))\r\n        shape.opacity = 1;\r\n    if (!hasProp(shape, 'disableErase'))\r\n        shape.disableErase = true;\r\n};\r\nconst shapeFormat = (shape) => {\r\n    shapeFormatDefaults(shape);\r\n    if (shapeIsText(shape)) {\r\n        shapeFormatText(shape);\r\n    }\r\n    else if (shapeIsRect(shape)) {\r\n        shapeFormatRect(shape);\r\n    }\r\n    else if (shapeIsPath(shape)) {\r\n        shapeFormatPath(shape);\r\n    }\r\n    else if (shapeIsLine(shape)) {\r\n        shapeFormatLine(shape);\r\n    }\r\n    else if (shapeIsEllipse(shape)) {\r\n        shapeFormatEllipse(shape);\r\n    }\r\n    return shape;\r\n};\r\nconst shapeGetDescription = (shape) => {\r\n    if (shapeIsText(shape))\r\n        return 'text';\r\n    if (shapeIsRect(shape))\r\n        return 'rectangle';\r\n    if (shapeIsPath(shape))\r\n        return 'path';\r\n    if (shapeIsLine(shape))\r\n        return 'line';\r\n    if (shapeIsEllipse(shape))\r\n        return 'ellipse';\r\n    return;\r\n};\r\n//#endregion\r\nconst toPixelValue = (percentage, total) => (parseFloat(percentage) / 100) * total;\r\n//#region shape transforming\r\nconst xRegExp = new RegExp(/^x|left|right|^width|rx|fontSize|cornerRadius|strokeWidth/, 'i');\r\nconst yRegExp = new RegExp(/^y|top|bottom|^height|ry/, 'i');\r\nconst compute = (key, value, { width, height }) => {\r\n    // handle array of percentage values\r\n    if (Array.isArray(value)) {\r\n        return value.map((v) => {\r\n            if (isObject(v)) {\r\n                // update the object itself\r\n                computeProps(v, { width, height });\r\n            }\r\n            return v;\r\n        });\r\n    }\r\n    // no need to compute (test with typeof instead of for perf)\r\n    if (typeof value !== 'string')\r\n        return value;\r\n    if (!value.endsWith('%'))\r\n        return value;\r\n    const f = parseFloat(value) / 100;\r\n    if (xRegExp.test(key))\r\n        return fixPrecision(width * f, 6);\r\n    if (yRegExp.test(key))\r\n        return fixPrecision(height * f, 6);\r\n    // dont auto-compute\r\n    return value;\r\n};\r\nconst computeProps = (obj, context) => {\r\n    Object.entries(obj).map(([key, value]) => {\r\n        obj[key] = compute(key, value, context);\r\n    });\r\n    // assume is percentage\r\n    const lineHeight = obj.lineHeight;\r\n    if (isString(lineHeight))\r\n        obj.lineHeight = Math.round(obj.fontSize * (parseFloat(lineHeight) / 100));\r\n};\r\nconst shapeComputeDisplay = (shape, context) => {\r\n    computeProps(shape, context);\r\n    shapeComputeRect(shape, context);\r\n    return shape;\r\n};\r\nconst shapeGetPropPixelTotal = (prop, parentRect) => {\r\n    let total;\r\n    if (/^x|width|rx|fontSize|strokeWidth|cornerRadius/.test(prop)) {\r\n        total = parentRect.width;\r\n    }\r\n    else if (/^y|height|ry/.test(prop)) {\r\n        total = parentRect.height;\r\n    }\r\n    return total;\r\n};\r\nconst shapeUpdateProp = (shape, prop, value, parentRect) => {\r\n    if (!isString(shape[prop])) {\r\n        shape[prop] = value;\r\n        return shape;\r\n    }\r\n    const total = shapeGetPropPixelTotal(prop, parentRect);\r\n    shape[prop] = total === undefined ? value : toPercentage(value, total);\r\n    return shape;\r\n};\r\nconst shapeGetPropPixelValue = (shape, prop, parentRect) => {\r\n    if (Array.isArray(shape[prop]))\r\n        return shape[prop].map((item) => {\r\n            return Object.entries(item).reduce((mapped, [key, value]) => {\r\n                mapped[key] = isString(value)\r\n                    ? toPixelValue(value, shapeGetPropPixelTotal(key, parentRect))\r\n                    : value;\r\n                return mapped;\r\n            }, {});\r\n        });\r\n    if (!isString(shape[prop]))\r\n        return shape[prop];\r\n    return toPixelValue(shape[prop], shapeGetPropPixelTotal(prop, parentRect));\r\n};\r\nconst shapeGetPropsPixelValues = (shape, props, parentRect) => {\r\n    return props.reduce((prev, prop) => {\r\n        const value = shapeGetPropPixelValue(shape, prop, parentRect);\r\n        prev[prop] = value;\r\n        return prev;\r\n    }, {});\r\n};\r\nconst shapeUpdateProps = (shape, props, parentRect) => {\r\n    Object.keys(props).forEach((key) => shapeUpdateProp(shape, key, props[key], parentRect));\r\n    return shape;\r\n};\r\nconst shapeBounds = (shape) => {\r\n    const rect = rectCreateEmpty();\r\n    const strokeWidth = shape.strokeWidth || 0;\r\n    if (shapeIsRect(shape)) {\r\n        rect.x = shape.x - strokeWidth * 0.5;\r\n        rect.y = shape.y - strokeWidth * 0.5;\r\n        rect.width = shape.width + strokeWidth;\r\n        rect.height = shape.height + strokeWidth;\r\n    }\r\n    else if (shapeIsLine(shape)) {\r\n        const { x1, y1, x2, y2 } = shape;\r\n        const left = Math.abs(Math.min(x1, x2));\r\n        const right = Math.abs(Math.max(x1, x2));\r\n        const top = Math.abs(Math.min(y1, y2));\r\n        const bottom = Math.abs(Math.min(y1, y2));\r\n        rect.x = left + strokeWidth * 0.5;\r\n        rect.y = right + strokeWidth * 0.5;\r\n        rect.width = right - left + strokeWidth;\r\n        rect.height = bottom - top + strokeWidth;\r\n    }\r\n    else if (shapeIsEllipse(shape)) {\r\n        rect.x = shape.x - shape.rx + strokeWidth * 0.5;\r\n        rect.y = shape.y - shape.ry + strokeWidth * 0.5;\r\n        rect.width = shape.rx * 2 + strokeWidth;\r\n        rect.height = shape.ry * 2 + strokeWidth;\r\n    }\r\n    if (rect && hasProp(shape, 'rotation')) {\r\n        rectRotate(rect, shape.rotation);\r\n    }\r\n    return rectToBounds(rect);\r\n};\r\nconst shapesBounds = (shapes, parentRect) => {\r\n    const bounds = shapes\r\n        .filter((shape) => shape.x < 0 || shape.y < 0 || shape.x1 < 0 || shape.y1 < 0)\r\n        .reduce((bounds, shape) => {\r\n        const [top, right, bottom, left] = shapeBounds(shape);\r\n        bounds.top = Math.min(top, bounds.top);\r\n        bounds.left = Math.min(left, bounds.left);\r\n        bounds.bottom = Math.max(bottom, bounds.bottom);\r\n        bounds.right = Math.max(right, bounds.right);\r\n        return bounds;\r\n    }, {\r\n        top: 0,\r\n        right: 0,\r\n        bottom: 0,\r\n        left: 0,\r\n    });\r\n    if (bounds.right > 0)\r\n        bounds.right -= parentRect.width;\r\n    if (bounds.bottom > 0)\r\n        bounds.bottom -= parentRect.height;\r\n    return bounds;\r\n};\r\nconst shapesFromCompositShape = (shape, parentRect, parser) => {\r\n    const shapeCopy = shapeDeepCopy(shape);\r\n    shapeComputeDisplay(shapeCopy, parentRect);\r\n    const shapes = parser(shapeCopy);\r\n    return Array.isArray(shapes) ? shapes : [shapes];\r\n};\r\nconst shapeComputeRect = (shape, context) => {\r\n    if (hasProp(shape, 'left'))\r\n        shape.x = shape.left;\r\n    if (hasProp(shape, 'right') && !isString(shape.right)) {\r\n        const r = context.width - shape.right;\r\n        if (hasProp(shape, 'left')) {\r\n            shape.x = shape.left;\r\n            shape.width = Math.max(0, r - shape.left);\r\n        }\r\n        else if (hasProp(shape, 'width')) {\r\n            shape.x = r - shape.width;\r\n        }\r\n    }\r\n    if (hasProp(shape, 'top'))\r\n        shape.y = shape.top;\r\n    if (hasProp(shape, 'bottom') && !isString(shape.bottom)) {\r\n        const b = context.height - shape.bottom;\r\n        if (hasProp(shape, 'top')) {\r\n            shape.y = shape.top;\r\n            shape.height = Math.max(0, b - shape.top);\r\n        }\r\n        else if (hasProp(shape, 'height')) {\r\n            shape.y = b - shape.height;\r\n        }\r\n    }\r\n    return shape;\r\n};\r\n// currently only used for drawing to canvas in output\r\nconst shapeScale = (shape, scale) => {\r\n    if (shapeIsPath(shape)) {\r\n        shape.points\r\n            .filter((point) => isNumber(point.x))\r\n            .forEach((point) => {\r\n            point.x *= scale;\r\n            point.y *= scale;\r\n        });\r\n    }\r\n    if (shapeIsLine(shape) && isNumber(shape.x1)) {\r\n        shape.x1 *= scale;\r\n        shape.y1 *= scale;\r\n        shape.x2 *= scale;\r\n        shape.y2 *= scale;\r\n    }\r\n    if (isNumber(shape.x) && isNumber(shape.y)) {\r\n        shape.x *= scale;\r\n        shape.y *= scale;\r\n    }\r\n    if (isNumber(shape.width) && isNumber(shape.height)) {\r\n        shape.width *= scale;\r\n        shape.height *= scale;\r\n    }\r\n    if (isNumber(shape.rx) && isNumber(shape.ry)) {\r\n        shape.rx *= scale;\r\n        shape.ry *= scale;\r\n    }\r\n    if (shapeHasNumericStroke(shape)) {\r\n        shape.strokeWidth *= scale;\r\n    }\r\n    if (shapeIsText(shape)) {\r\n        shape._scale = scale;\r\n        if (isNumber(shape.fontSize)) {\r\n            shape.fontSize *= scale;\r\n        }\r\n        if (isNumber(shape.lineHeight)) {\r\n            shape.lineHeight *= scale;\r\n        }\r\n        if (isNumber(shape.width) && !isNumber(shape.height))\r\n            shape.width *= scale;\r\n    }\r\n    if (hasProp(shape, 'cornerRadius') && isNumber(shape.cornerRadius)) {\r\n        shape.cornerRadius *= scale;\r\n    }\r\n    return shape;\r\n};\r\nconst shapeGetLength = (shape) => {\r\n    if (!shape.x1)\r\n        return;\r\n    return vectorDistance(vectorCreate(shape.x1, shape.y1), vectorCreate(shape.x2, shape.y2));\r\n};\r\nconst shapeGetCenter = (shape) => {\r\n    if (shapeIsRect(shape)) {\r\n        return vectorCreate(shape.x + shape.width * 0.5, shape.y + shape.height * 0.5);\r\n    }\r\n    if (shapeIsEllipse(shape)) {\r\n        return vectorCreate(shape.x, shape.y);\r\n    }\r\n    if (shape.text) {\r\n        // if is text box we try to use width & height values\r\n        if (shapeIsTextBox(shape)) {\r\n            const height = shape.height || textToSize(shape.text, shape).height;\r\n            return vectorCreate(shape.x + shape.width * 0.5, shape.y + height * 0.5);\r\n        }\r\n        // else we calculate text size\r\n        const size = textToSize(shape.text, shape);\r\n        return vectorCreate(shape.x + size.width * 0.5, shape.y + size.height * 0.5);\r\n    }\r\n    if (shapeIsPath(shape)) {\r\n        return vectorCenter(shape.points);\r\n    }\r\n    if (shapeIsLine(shape)) {\r\n        return vectorCenter([\r\n            shapeLineGetStartPoint(shape),\r\n            shapeLineGetEndPoint(shape),\r\n        ]);\r\n    }\r\n    return undefined;\r\n};\r\n//#endregion\r\nconst shapeGetLevel = (shapeInitialState, imageCurrentState) => {\r\n    let flipX = false;\r\n    if (imageCurrentState.flipX && shapeInitialState.flipX) {\r\n        flipX = true;\r\n    }\r\n    else if (!imageCurrentState.flipX && shapeInitialState.flipX) {\r\n        flipX = false;\r\n    }\r\n    else if (imageCurrentState.flipX && !shapeInitialState.flipX) {\r\n        flipX = true;\r\n    }\r\n    let flipY = false;\r\n    if (imageCurrentState.flipY && shapeInitialState.flipY) {\r\n        flipY = true;\r\n    }\r\n    else if (!imageCurrentState.flipY && shapeInitialState.flipY) {\r\n        flipY = false;\r\n    }\r\n    else if (imageCurrentState.flipY && !shapeInitialState.flipY) {\r\n        flipY = true;\r\n    }\r\n    let rotation = -imageCurrentState.rotation;\r\n    if ((flipX || flipY) && !(flipX && flipY))\r\n        rotation = -rotation;\r\n    return {\r\n        flipX,\r\n        flipY,\r\n        rotation,\r\n    };\r\n};\r\n\r\nvar ctxRoundRect = (ctx, x, y, width, height, radius) => {\r\n    if (width < 2 * radius)\r\n        radius = width / 2;\r\n    if (height < 2 * radius)\r\n        radius = height / 2;\r\n    ctx.beginPath();\r\n    ctx.moveTo(x + radius, y);\r\n    ctx.arcTo(x + width, y, x + width, y + height, radius);\r\n    ctx.arcTo(x + width, y + height, x, y + height, radius);\r\n    ctx.arcTo(x, y + height, x, y, radius);\r\n    ctx.arcTo(x, y, x + width, y, radius);\r\n    ctx.closePath();\r\n    return ctx;\r\n};\r\n\r\nvar isCanvas = (element) => /canvas/i.test(element.nodeName);\r\n\r\nvar isRemoteURL = (url) => new URL(url, location.href).origin !== location.origin;\r\n\r\nvar loadImage = (image, onSize = undefined) => new Promise((resolve, reject) => {\r\n    // the image element we'll use to load the image\r\n    let imageElement = image;\r\n    let sizeCalculated = false;\r\n    const reportSize = () => {\r\n        if (sizeCalculated)\r\n            return;\r\n        sizeCalculated = true;\r\n        isFunction(onSize) &&\r\n            /* Use Promise.resolve to make async but place before resolve of parent promise */\r\n            Promise.resolve().then(() => onSize(sizeCreate(imageElement.naturalWidth, imageElement.naturalHeight)));\r\n    };\r\n    // if is not an image element, it must be a valid image source\r\n    if (!imageElement.src) {\r\n        imageElement = new Image();\r\n        // if is remote image, set crossOrigin\r\n        // why not always set crossOrigin? -> because when set this fires two requests,\r\n        // one for asking permission and one for downloading the image\r\n        if (isString(image) && isRemoteURL(image))\r\n            imageElement.crossOrigin = 'anonymous';\r\n        imageElement.src = isString(image) ? image : URL.createObjectURL(image);\r\n    }\r\n    if (imageElement.complete) {\r\n        reportSize();\r\n        return resolve(imageElement);\r\n    }\r\n    // try to calculate size faster\r\n    if (isFunction(onSize))\r\n        getImageElementSize(imageElement).then(reportSize).catch(reject);\r\n    imageElement.onload = () => {\r\n        reportSize();\r\n        resolve(imageElement);\r\n    };\r\n    imageElement.onerror = reject;\r\n});\r\n\r\nconst cache = new Map([]);\r\nconst getImage = (src, options = {}) => new Promise((resolve, reject) => {\r\n    const { onMetadata = noop$1, onLoad = resolve, onError = reject, onComplete = noop$1, } = options;\r\n    let imageLoadState = cache.get(src);\r\n    // start loading\r\n    if (!imageLoadState) {\r\n        imageLoadState = {\r\n            loading: false,\r\n            complete: false,\r\n            error: false,\r\n            image: undefined,\r\n            size: undefined,\r\n            bus: pubsub(),\r\n        };\r\n        // store\r\n        cache.set(src, imageLoadState);\r\n    }\r\n    // wait for load\r\n    imageLoadState.bus.sub('meta', onMetadata);\r\n    imageLoadState.bus.sub('load', onLoad);\r\n    imageLoadState.bus.sub('error', onError);\r\n    imageLoadState.bus.sub('complete', onComplete);\r\n    // if is canvas, it's already done\r\n    if (isCanvas(src)) {\r\n        const canvas = src;\r\n        // get image\r\n        const image = canvas.cloneNode();\r\n        // update state\r\n        imageLoadState.complete = true;\r\n        imageLoadState.image = image;\r\n        imageLoadState.size = sizeCreateFromElement(canvas);\r\n    }\r\n    // already loaded\r\n    if (imageLoadState.complete) {\r\n        imageLoadState.bus.pub('meta', { size: imageLoadState.size });\r\n        if (imageLoadState.error) {\r\n            imageLoadState.bus.pub('error', imageLoadState.error);\r\n        }\r\n        else {\r\n            imageLoadState.bus.pub('load', imageLoadState.image);\r\n        }\r\n        imageLoadState.bus.pub('complete');\r\n        // reset subscribers\r\n        imageLoadState.bus = pubsub();\r\n        return;\r\n    }\r\n    // already loading, exit here\r\n    if (imageLoadState.loading)\r\n        return;\r\n    // now loading\r\n    imageLoadState.loading = true;\r\n    // resource needs to be loaded\r\n    loadImage(src, (size) => {\r\n        imageLoadState.size = size;\r\n        imageLoadState.bus.pub('meta', { size });\r\n    })\r\n        .then((image) => {\r\n        imageLoadState.image = image;\r\n        imageLoadState.bus.pub('load', image);\r\n    })\r\n        .catch((err) => {\r\n        imageLoadState.error = err;\r\n        imageLoadState.bus.pub('error', err);\r\n    })\r\n        .finally(() => {\r\n        imageLoadState.complete = true;\r\n        imageLoadState.loading = false;\r\n        imageLoadState.bus.pub('complete');\r\n        // reset subscribers\r\n        imageLoadState.bus = pubsub();\r\n    });\r\n});\r\n\r\nconst drawCanvas = (ctx, image, srcRect, destRect) => ctx.drawImage(image, srcRect.x, srcRect.x, srcRect.width, srcRect.height, destRect.x, destRect.y, destRect.width, destRect.height);\r\nvar ctxDrawImage = async (ctx, image, srcRect, destRect, draw = drawCanvas) => {\r\n    ctx.save();\r\n    ctx.clip();\r\n    await draw(ctx, image, srcRect, destRect);\r\n    ctx.restore();\r\n};\r\nconst getDrawImageParams = (container, backgroundSize, imageSize, backgroundCorners) => {\r\n    let srcRect = rectCreate(0, 0, imageSize.width, imageSize.height);\r\n    const destRect = rectClone$1(container);\r\n    if (backgroundCorners) {\r\n        srcRect = rectApply(rectCreateFromPoints(backgroundCorners), fixPrecision);\r\n        srcRect.x *= imageSize.width;\r\n        srcRect.width *= imageSize.width;\r\n        srcRect.y *= imageSize.height;\r\n        srcRect.height *= imageSize.height;\r\n    }\r\n    else {\r\n        if (backgroundSize === 'contain') {\r\n            const rect = rectContainRect(container, rectAspectRatio(srcRect));\r\n            destRect.width = rect.width;\r\n            destRect.height = rect.height;\r\n            destRect.x += rect.x;\r\n            destRect.y += rect.y;\r\n        }\r\n        else if (backgroundSize === 'cover') {\r\n            srcRect = rectContainRect(rectCreate(0, 0, srcRect.width, srcRect.height), rectAspectRatio(destRect));\r\n        }\r\n    }\r\n    return {\r\n        srcRect,\r\n        destRect,\r\n    };\r\n};\r\n\r\nconst defineRectShape = (ctx, shape) => {\r\n    shape.cornerRadius > 0\r\n        ? ctxRoundRect(ctx, shape.x, shape.y, shape.width, shape.height, shape.cornerRadius)\r\n        : ctx.rect(shape.x, shape.y, shape.width, shape.height);\r\n    return ctx;\r\n};\r\nconst fillRectShape = (ctx, shape) => {\r\n    shape.backgroundColor && ctx.fill();\r\n    return ctx;\r\n};\r\nconst strokeRectShape = (ctx, shape) => {\r\n    shape.strokeWidth && ctx.stroke();\r\n    return ctx;\r\n};\r\nvar drawRect = async (ctx, shape, options = {}) => new Promise(async (resolve, reject) => {\r\n    const { drawImage } = options;\r\n    ctx.lineWidth = shape.strokeWidth ? shape.strokeWidth : 1; // 1 is default value for lineWidth prop\r\n    ctx.strokeStyle = shape.strokeColor ? colorArrayToRGBA(shape.strokeColor) : 'none';\r\n    ctx.fillStyle = shape.backgroundColor ? colorArrayToRGBA(shape.backgroundColor) : 'none';\r\n    ctx.globalAlpha = shape.opacity;\r\n    if (shape.backgroundImage) {\r\n        let image;\r\n        try {\r\n            if (isCanvas(shape.backgroundImage)) {\r\n                image = shape.backgroundImage;\r\n            }\r\n            else {\r\n                image = await getImage(shape.backgroundImage);\r\n            }\r\n        }\r\n        catch (err) {\r\n            reject(err);\r\n        }\r\n        defineRectShape(ctx, shape);\r\n        fillRectShape(ctx, shape);\r\n        const { srcRect, destRect } = getDrawImageParams(shape, shape.backgroundSize, sizeCreateFromElement(image), shape.backgroundCorners);\r\n        await ctxDrawImage(ctx, image, srcRect, destRect, drawImage);\r\n        strokeRectShape(ctx, shape);\r\n        resolve([]);\r\n    }\r\n    else {\r\n        defineRectShape(ctx, shape);\r\n        fillRectShape(ctx, shape);\r\n        strokeRectShape(ctx, shape);\r\n        resolve([]);\r\n    }\r\n});\r\n\r\nvar drawEllipse = async (ctx, shape, options = {}) => new Promise(async (resolve, reject) => {\r\n    const { drawImage } = options;\r\n    ctx.lineWidth = shape.strokeWidth || 1; // 1 is default value for lineWidth prop\r\n    ctx.strokeStyle = shape.strokeColor ? colorArrayToRGBA(shape.strokeColor) : 'none';\r\n    ctx.fillStyle = shape.backgroundColor ? colorArrayToRGBA(shape.backgroundColor) : 'none';\r\n    ctx.globalAlpha = shape.opacity;\r\n    ctx.ellipse(shape.x, shape.y, shape.rx, shape.ry, 0, 0, Math.PI * 2);\r\n    shape.backgroundColor && ctx.fill();\r\n    if (shape.backgroundImage) {\r\n        let image;\r\n        try {\r\n            image = await getImage(shape.backgroundImage);\r\n        }\r\n        catch (err) {\r\n            reject(err);\r\n        }\r\n        const bounds = rectCreate(shape.x - shape.rx, shape.y - shape.ry, shape.rx * 2, shape.ry * 2);\r\n        const { srcRect, destRect } = getDrawImageParams(bounds, shape.backgroundSize, sizeCreateFromElement(image));\r\n        // @ts-ignore\r\n        await ctxDrawImage(ctx, image, srcRect, destRect, drawImage);\r\n        shape.strokeWidth && ctx.stroke();\r\n        resolve([]);\r\n    }\r\n    else {\r\n        shape.strokeWidth && ctx.stroke();\r\n        resolve([]);\r\n    }\r\n});\r\n\r\nvar drawText = async (ctx, shape, options) => {\r\n    // get text size\r\n    const size = shape.width && shape.height\r\n        ? sizeCreateFromAny(shape)\r\n        : textToSize(shape.text, shape);\r\n    const rect = {\r\n        x: shape.x,\r\n        y: shape.y,\r\n        width: size.width,\r\n        height: size.height,\r\n    };\r\n    drawRect(ctx, {\r\n        ...shape,\r\n        ...rect,\r\n        options,\r\n    });\r\n    // skip if no text\r\n    if (!shape.text.length)\r\n        return [];\r\n    const { willRequest } = options;\r\n    const image = await textToImage(shape.text, {\r\n        ...shape,\r\n        ...rect,\r\n        imageWidth: rect.width,\r\n        imageHeight: rect.height,\r\n        willRequest,\r\n    });\r\n    ctx.drawImage(image, shape.x - TextPadding, shape.y, image.width, image.height);\r\n    return [];\r\n};\r\n\r\n// TODO! START\r\n// -----------\r\nvar drawLine = async (ctx, shape) => new Promise(async (resolve) => {\r\n    ctx.lineWidth = shape.strokeWidth || 1; // 1 is default value for lineWidth prop\r\n    ctx.strokeStyle = shape.strokeColor ? colorArrayToRGBA(shape.strokeColor) : 'none';\r\n    ctx.globalAlpha = shape.opacity;\r\n    let lineStartPosition = shapeLineGetStartPoint(shape);\r\n    let lineEndPosition = shapeLineGetEndPoint(shape);\r\n    // draw line\r\n    ctx.moveTo(lineStartPosition.x, lineStartPosition.y);\r\n    ctx.lineTo(lineEndPosition.x, lineEndPosition.y);\r\n    shape.strokeWidth && ctx.stroke();\r\n    // draw other shapes\r\n    resolve([]);\r\n});\r\n// TODO! END\r\n// -----------\r\n\r\nvar drawPath = async (ctx, shape) => new Promise((resolve, reject) => {\r\n    ctx.lineWidth = shape.strokeWidth || 1; // 1 is default value for lineWidth prop\r\n    ctx.strokeStyle = shape.strokeColor ? colorArrayToRGBA(shape.strokeColor) : 'none';\r\n    ctx.fillStyle = shape.backgroundColor ? colorArrayToRGBA(shape.backgroundColor) : 'none';\r\n    ctx.globalAlpha = shape.opacity;\r\n    // draw line\r\n    const { points } = shape;\r\n    if (shape.pathClose)\r\n        ctx.beginPath();\r\n    ctx.moveTo(points[0].x, points[0].y);\r\n    const l = points.length;\r\n    for (let i = 1; i < l; i++) {\r\n        ctx.lineTo(points[i].x, points[i].y);\r\n    }\r\n    if (shape.pathClose)\r\n        ctx.closePath();\r\n    shape.strokeWidth && ctx.stroke();\r\n    shape.backgroundColor && ctx.fill();\r\n    resolve([]);\r\n});\r\n\r\nvar ctxFlip = (ctx, flipX, flipY, pivot) => {\r\n    if (!flipX && !flipY)\r\n        return ctx;\r\n    ctx.translate(pivot.x, pivot.y);\r\n    ctx.scale(flipX ? -1 : 1, flipY ? -1 : 1);\r\n    ctx.translate(-pivot.x, -pivot.y);\r\n    return ctx;\r\n};\r\n\r\nconst drawShape = async (ctx, shape, options) => {\r\n    // center, needed for transforms\r\n    const center = shapeGetCenter(shape);\r\n    // rotate context\r\n    ctxRotate(ctx, shape.rotation, center);\r\n    // flip context\r\n    ctxFlip(ctx, shape.flipX, shape.flipY, center);\r\n    let fn;\r\n    if (shapeIsRect(shape)) {\r\n        fn = drawRect;\r\n    }\r\n    else if (shapeIsEllipse(shape)) {\r\n        fn = drawEllipse;\r\n    }\r\n    else if (shapeIsLine(shape)) {\r\n        fn = drawLine;\r\n    }\r\n    else if (shapeIsPath(shape)) {\r\n        fn = drawPath;\r\n    }\r\n    else if (shapeIsText(shape)) {\r\n        fn = drawText;\r\n    }\r\n    if (fn) {\r\n        const subShapes = await fn(ctx, shape, options);\r\n        if (!subShapes.length)\r\n            return [];\r\n        const shapes = await drawShapes(ctx, subShapes, options);\r\n        return [shape, ...shapes];\r\n    }\r\n    return [];\r\n};\r\n\r\nvar drawShapes = async (ctx, shapes, options) => {\r\n    let drawnShapes = [];\r\n    for (const shape of shapes) {\r\n        ctx.save();\r\n        // clears previous shape's path\r\n        ctx.beginPath();\r\n        // wait for shape to draw before drawing next shape\r\n        drawnShapes = [...drawnShapes, ...(await drawShape(ctx, shape, options))];\r\n        ctx.restore();\r\n    }\r\n    return drawnShapes;\r\n};\r\n\r\nvar drawImageData = async (imageData, options = {}) => {\r\n    const { shapes = [], contextBounds = imageData, transform = noop$1, drawImage, willRequest, canvasMemoryLimit, computeShape = passthrough, preprocessShape = passthrough, } = options;\r\n    // no shapes to draw\r\n    if (!shapes.length)\r\n        return imageData;\r\n    // create drawing context\r\n    const canvas = h('canvas');\r\n    canvas.width = contextBounds.width;\r\n    canvas.height = contextBounds.height;\r\n    const ctx = canvas.getContext('2d');\r\n    ctx.putImageData(imageData, contextBounds.x || 0, contextBounds.y || 0);\r\n    // compute the position of all shapes\r\n    const computedShapes = shapes.map(shapeDeepCopy).map(computeShape).map(preprocessShape).flat();\r\n    // compute transforms for context\r\n    transform(ctx);\r\n    // draw shapes to canvas\r\n    await drawShapes(ctx, computedShapes, {\r\n        drawImage,\r\n        canvasMemoryLimit,\r\n        willRequest,\r\n    });\r\n    const imageDataOut = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n    releaseCanvas(canvas);\r\n    return imageDataOut;\r\n};\r\n\r\nvar fillImageData = async (imageData, options = {}) => {\r\n    const { backgroundColor, backgroundImage } = options;\r\n    const hasBackgroundColor = !(!backgroundColor || (backgroundColor && backgroundColor[3] === 0));\r\n    // no background set\r\n    if (!backgroundImage && !hasBackgroundColor)\r\n        return imageData;\r\n    // canvas to fill\r\n    const image = h('canvas');\r\n    image.width = imageData.width;\r\n    image.height = imageData.height;\r\n    const ctx = image.getContext('2d');\r\n    ctx.putImageData(imageData, 0, 0);\r\n    // fill behind image\r\n    ctx.globalCompositeOperation = 'destination-over';\r\n    if (hasBackgroundColor) {\r\n        ctx.fillStyle = colorArrayToRGBA(backgroundColor);\r\n        ctx.fillRect(0, 0, image.width, image.height);\r\n    }\r\n    if (backgroundImage) {\r\n        let image;\r\n        if (isCanvas(backgroundImage)) {\r\n            image = backgroundImage;\r\n        }\r\n        else {\r\n            image = await getImage(backgroundImage);\r\n        }\r\n        const { srcRect, destRect } = getDrawImageParams({\r\n            x: 0,\r\n            y: 0,\r\n            width: imageData.width,\r\n            height: imageData.height,\r\n        }, 'cover', {\r\n            width: image.width,\r\n            height: image.height,\r\n        });\r\n        ctx.drawImage(image, srcRect.x, srcRect.y, srcRect.width, srcRect.height, destRect.x, destRect.y, destRect.width, destRect.height);\r\n    }\r\n    const imageDataOut = ctx.getImageData(0, 0, image.width, image.height);\r\n    releaseCanvas(image);\r\n    return imageDataOut;\r\n};\r\n\r\nvar dotColorMatrix = (a, b) => {\r\n    const res = new Array(20);\r\n    // R\r\n    res[0] = a[0] * b[0] + a[1] * b[5] + a[2] * b[10] + a[3] * b[15];\r\n    res[1] = a[0] * b[1] + a[1] * b[6] + a[2] * b[11] + a[3] * b[16];\r\n    res[2] = a[0] * b[2] + a[1] * b[7] + a[2] * b[12] + a[3] * b[17];\r\n    res[3] = a[0] * b[3] + a[1] * b[8] + a[2] * b[13] + a[3] * b[18];\r\n    res[4] = a[0] * b[4] + a[1] * b[9] + a[2] * b[14] + a[3] * b[19] + a[4];\r\n    // G\r\n    res[5] = a[5] * b[0] + a[6] * b[5] + a[7] * b[10] + a[8] * b[15];\r\n    res[6] = a[5] * b[1] + a[6] * b[6] + a[7] * b[11] + a[8] * b[16];\r\n    res[7] = a[5] * b[2] + a[6] * b[7] + a[7] * b[12] + a[8] * b[17];\r\n    res[8] = a[5] * b[3] + a[6] * b[8] + a[7] * b[13] + a[8] * b[18];\r\n    res[9] = a[5] * b[4] + a[6] * b[9] + a[7] * b[14] + a[8] * b[19] + a[9];\r\n    // B\r\n    res[10] = a[10] * b[0] + a[11] * b[5] + a[12] * b[10] + a[13] * b[15];\r\n    res[11] = a[10] * b[1] + a[11] * b[6] + a[12] * b[11] + a[13] * b[16];\r\n    res[12] = a[10] * b[2] + a[11] * b[7] + a[12] * b[12] + a[13] * b[17];\r\n    res[13] = a[10] * b[3] + a[11] * b[8] + a[12] * b[13] + a[13] * b[18];\r\n    res[14] = a[10] * b[4] + a[11] * b[9] + a[12] * b[14] + a[13] * b[19] + a[14];\r\n    // A\r\n    res[15] = a[15] * b[0] + a[16] * b[5] + a[17] * b[10] + a[18] * b[15];\r\n    res[16] = a[15] * b[1] + a[16] * b[6] + a[17] * b[11] + a[18] * b[16];\r\n    res[17] = a[15] * b[2] + a[16] * b[7] + a[17] * b[12] + a[18] * b[17];\r\n    res[18] = a[15] * b[3] + a[16] * b[8] + a[17] * b[13] + a[18] * b[18];\r\n    res[19] = a[15] * b[4] + a[16] * b[9] + a[17] * b[14] + a[18] * b[19] + a[19];\r\n    return res;\r\n};\r\n\r\nvar getColorMatrixFromColorMatrices = (colorMatrices) => colorMatrices.length\r\n    ? colorMatrices.reduce((previous, current) => dotColorMatrix([...previous], current), colorMatrices.shift())\r\n    : [];\r\n\r\nvar roundFraction = (value, fr = 2) => Math.round(value * fr) / fr;\r\n\r\nvar getImageRedactionScaleFactor = (imageSize, redactionShapes) => {\r\n    const imageRes = imageSize.width * imageSize.height;\r\n    const maxShapeSize = redactionShapes.reduce((max, shape) => {\r\n        if (shape.width > max.width && shape.height > max.height) {\r\n            max.width = shape.width;\r\n            max.height = shape.height;\r\n        }\r\n        return max;\r\n    }, { width: 0, height: 0 });\r\n    const maxShapeRes = maxShapeSize.width * maxShapeSize.height;\r\n    const fraction = Math.max(0.5, 0.5 + (1 - maxShapeRes / imageRes) / 2);\r\n    return roundFraction(fraction, 5);\r\n};\r\n\r\nfunction noop() { }\r\nconst identity = x => x;\r\nfunction assign(tar, src) {\r\n    // @ts-ignore\r\n    for (const k in src)\r\n        tar[k] = src[k];\r\n    return tar;\r\n}\r\nfunction run(fn) {\r\n    return fn();\r\n}\r\nfunction blank_object() {\r\n    return Object.create(null);\r\n}\r\nfunction run_all(fns) {\r\n    fns.forEach(run);\r\n}\r\nfunction is_function(thing) {\r\n    return typeof thing === 'function';\r\n}\r\nfunction safe_not_equal(a, b) {\r\n    return a != a ? b == b : a !== b || ((a && typeof a === 'object') || typeof a === 'function');\r\n}\r\nfunction is_empty(obj) {\r\n    return Object.keys(obj).length === 0;\r\n}\r\nfunction subscribe(store, ...callbacks) {\r\n    if (store == null) {\r\n        return noop;\r\n    }\r\n    const unsub = store.subscribe(...callbacks);\r\n    return unsub.unsubscribe ? () => unsub.unsubscribe() : unsub;\r\n}\r\nfunction get_store_value(store) {\r\n    let value;\r\n    subscribe(store, _ => value = _)();\r\n    return value;\r\n}\r\nfunction component_subscribe(component, store, callback) {\r\n    component.$$.on_destroy.push(subscribe(store, callback));\r\n}\r\nfunction create_slot(definition, ctx, $$scope, fn) {\r\n    if (definition) {\r\n        const slot_ctx = get_slot_context(definition, ctx, $$scope, fn);\r\n        return definition[0](slot_ctx);\r\n    }\r\n}\r\nfunction get_slot_context(definition, ctx, $$scope, fn) {\r\n    return definition[1] && fn\r\n        ? assign($$scope.ctx.slice(), definition[1](fn(ctx)))\r\n        : $$scope.ctx;\r\n}\r\nfunction get_slot_changes(definition, $$scope, dirty, fn) {\r\n    if (definition[2] && fn) {\r\n        const lets = definition[2](fn(dirty));\r\n        if ($$scope.dirty === undefined) {\r\n            return lets;\r\n        }\r\n        if (typeof lets === 'object') {\r\n            const merged = [];\r\n            const len = Math.max($$scope.dirty.length, lets.length);\r\n            for (let i = 0; i < len; i += 1) {\r\n                merged[i] = $$scope.dirty[i] | lets[i];\r\n            }\r\n            return merged;\r\n        }\r\n        return $$scope.dirty | lets;\r\n    }\r\n    return $$scope.dirty;\r\n}\r\nfunction update_slot_base(slot, slot_definition, ctx, $$scope, slot_changes, get_slot_context_fn) {\r\n    if (slot_changes) {\r\n        const slot_context = get_slot_context(slot_definition, ctx, $$scope, get_slot_context_fn);\r\n        slot.p(slot_context, slot_changes);\r\n    }\r\n}\r\nfunction get_all_dirty_from_scope($$scope) {\r\n    if ($$scope.ctx.length > 32) {\r\n        const dirty = [];\r\n        const length = $$scope.ctx.length / 32;\r\n        for (let i = 0; i < length; i++) {\r\n            dirty[i] = -1;\r\n        }\r\n        return dirty;\r\n    }\r\n    return -1;\r\n}\r\nfunction exclude_internal_props(props) {\r\n    const result = {};\r\n    for (const k in props)\r\n        if (k[0] !== '$')\r\n            result[k] = props[k];\r\n    return result;\r\n}\r\nfunction compute_rest_props(props, keys) {\r\n    const rest = {};\r\n    keys = new Set(keys);\r\n    for (const k in props)\r\n        if (!keys.has(k) && k[0] !== '$')\r\n            rest[k] = props[k];\r\n    return rest;\r\n}\r\nfunction set_store_value(store, ret, value) {\r\n    store.set(value);\r\n    return ret;\r\n}\r\nfunction action_destroyer(action_result) {\r\n    return action_result && is_function(action_result.destroy) ? action_result.destroy : noop;\r\n}\r\n\r\nconst is_client = typeof window !== 'undefined';\r\nlet now = is_client\r\n    ? () => window.performance.now()\r\n    : () => Date.now();\r\nlet raf = is_client ? cb => requestAnimationFrame(cb) : noop;\r\n\r\nconst tasks = new Set();\r\nfunction run_tasks(now) {\r\n    tasks.forEach(task => {\r\n        if (!task.c(now)) {\r\n            tasks.delete(task);\r\n            task.f();\r\n        }\r\n    });\r\n    if (tasks.size !== 0)\r\n        raf(run_tasks);\r\n}\r\n/**\r\n * Creates a new task that runs on each raf frame\r\n * until it returns a falsy value or is aborted\r\n */\r\nfunction loop(callback) {\r\n    let task;\r\n    if (tasks.size === 0)\r\n        raf(run_tasks);\r\n    return {\r\n        promise: new Promise(fulfill => {\r\n            tasks.add(task = { c: callback, f: fulfill });\r\n        }),\r\n        abort() {\r\n            tasks.delete(task);\r\n        }\r\n    };\r\n}\r\nfunction append(target, node) {\r\n    target.appendChild(node);\r\n}\r\nfunction get_root_for_style(node) {\r\n    if (!node)\r\n        return document;\r\n    const root = node.getRootNode ? node.getRootNode() : node.ownerDocument;\r\n    if (root && root.host) {\r\n        return root;\r\n    }\r\n    return node.ownerDocument;\r\n}\r\nfunction append_empty_stylesheet(node) {\r\n    const style_element = element('style');\r\n    append_stylesheet(get_root_for_style(node), style_element);\r\n    return style_element.sheet;\r\n}\r\nfunction append_stylesheet(node, style) {\r\n    append(node.head || node, style);\r\n    return style.sheet;\r\n}\r\nfunction insert(target, node, anchor) {\r\n    target.insertBefore(node, anchor || null);\r\n}\r\nfunction detach(node) {\r\n    node.parentNode.removeChild(node);\r\n}\r\nfunction element(name) {\r\n    return document.createElement(name);\r\n}\r\nfunction svg_element(name) {\r\n    return document.createElementNS('http://www.w3.org/2000/svg', name);\r\n}\r\nfunction text(data) {\r\n    return document.createTextNode(data);\r\n}\r\nfunction space() {\r\n    return text(' ');\r\n}\r\nfunction empty() {\r\n    return text('');\r\n}\r\nfunction listen(node, event, handler, options) {\r\n    node.addEventListener(event, handler, options);\r\n    return () => node.removeEventListener(event, handler, options);\r\n}\r\nfunction prevent_default(fn) {\r\n    return function (event) {\r\n        event.preventDefault();\r\n        // @ts-ignore\r\n        return fn.call(this, event);\r\n    };\r\n}\r\nfunction stop_propagation(fn) {\r\n    return function (event) {\r\n        event.stopPropagation();\r\n        // @ts-ignore\r\n        return fn.call(this, event);\r\n    };\r\n}\r\nfunction attr(node, attribute, value) {\r\n    if (value == null)\r\n        node.removeAttribute(attribute);\r\n    else if (node.getAttribute(attribute) !== value)\r\n        node.setAttribute(attribute, value);\r\n}\r\nfunction set_attributes(node, attributes) {\r\n    // @ts-ignore\r\n    const descriptors = Object.getOwnPropertyDescriptors(node.__proto__);\r\n    for (const key in attributes) {\r\n        if (attributes[key] == null) {\r\n            node.removeAttribute(key);\r\n        }\r\n        else if (key === 'style') {\r\n            node.style.cssText = attributes[key];\r\n        }\r\n        else if (key === '__value') {\r\n            node.value = node[key] = attributes[key];\r\n        }\r\n        else if (descriptors[key] && descriptors[key].set) {\r\n            node[key] = attributes[key];\r\n        }\r\n        else {\r\n            attr(node, key, attributes[key]);\r\n        }\r\n    }\r\n}\r\nfunction children(element) {\r\n    return Array.from(element.childNodes);\r\n}\r\nfunction set_data(text, data) {\r\n    data = '' + data;\r\n    if (text.wholeText !== data)\r\n        text.data = data;\r\n}\r\nfunction set_input_value(input, value) {\r\n    input.value = value == null ? '' : value;\r\n}\r\nfunction custom_event(type, detail, { bubbles = false, cancelable = false } = {}) {\r\n    const e = document.createEvent('CustomEvent');\r\n    e.initCustomEvent(type, bubbles, cancelable, detail);\r\n    return e;\r\n}\r\nclass HtmlTag {\r\n    constructor(is_svg = false) {\r\n        this.is_svg = false;\r\n        this.is_svg = is_svg;\r\n        this.e = this.n = null;\r\n    }\r\n    c(html) {\r\n        this.h(html);\r\n    }\r\n    m(html, target, anchor = null) {\r\n        if (!this.e) {\r\n            if (this.is_svg)\r\n                this.e = svg_element(target.nodeName);\r\n            else\r\n                this.e = element(target.nodeName);\r\n            this.t = target;\r\n            this.c(html);\r\n        }\r\n        this.i(anchor);\r\n    }\r\n    h(html) {\r\n        this.e.innerHTML = html;\r\n        this.n = Array.from(this.e.childNodes);\r\n    }\r\n    i(anchor) {\r\n        for (let i = 0; i < this.n.length; i += 1) {\r\n            insert(this.t, this.n[i], anchor);\r\n        }\r\n    }\r\n    p(html) {\r\n        this.d();\r\n        this.h(html);\r\n        this.i(this.a);\r\n    }\r\n    d() {\r\n        this.n.forEach(detach);\r\n    }\r\n}\r\n\r\n// we need to store the information for multiple documents because a Svelte application could also contain iframes\r\n// https://github.com/sveltejs/svelte/issues/3624\r\nconst managed_styles = new Map();\r\nlet active = 0;\r\n// https://github.com/darkskyapp/string-hash/blob/master/index.js\r\nfunction hash(str) {\r\n    let hash = 5381;\r\n    let i = str.length;\r\n    while (i--)\r\n        hash = ((hash << 5) - hash) ^ str.charCodeAt(i);\r\n    return hash >>> 0;\r\n}\r\nfunction create_style_information(doc, node) {\r\n    const info = { stylesheet: append_empty_stylesheet(node), rules: {} };\r\n    managed_styles.set(doc, info);\r\n    return info;\r\n}\r\nfunction create_rule(node, a, b, duration, delay, ease, fn, uid = 0) {\r\n    const step = 16.666 / duration;\r\n    let keyframes = '{\\n';\r\n    for (let p = 0; p <= 1; p += step) {\r\n        const t = a + (b - a) * ease(p);\r\n        keyframes += p * 100 + `%{${fn(t, 1 - t)}}\\n`;\r\n    }\r\n    const rule = keyframes + `100% {${fn(b, 1 - b)}}\\n}`;\r\n    const name = `__svelte_${hash(rule)}_${uid}`;\r\n    const doc = get_root_for_style(node);\r\n    const { stylesheet, rules } = managed_styles.get(doc) || create_style_information(doc, node);\r\n    if (!rules[name]) {\r\n        rules[name] = true;\r\n        stylesheet.insertRule(`@keyframes ${name} ${rule}`, stylesheet.cssRules.length);\r\n    }\r\n    const animation = node.style.animation || '';\r\n    node.style.animation = `${animation ? `${animation}, ` : ''}${name} ${duration}ms linear ${delay}ms 1 both`;\r\n    active += 1;\r\n    return name;\r\n}\r\nfunction delete_rule(node, name) {\r\n    const previous = (node.style.animation || '').split(', ');\r\n    const next = previous.filter(name\r\n        ? anim => anim.indexOf(name) < 0 // remove specific animation\r\n        : anim => anim.indexOf('__svelte') === -1 // remove all Svelte animations\r\n    );\r\n    const deleted = previous.length - next.length;\r\n    if (deleted) {\r\n        node.style.animation = next.join(', ');\r\n        active -= deleted;\r\n        if (!active)\r\n            clear_rules();\r\n    }\r\n}\r\nfunction clear_rules() {\r\n    raf(() => {\r\n        if (active)\r\n            return;\r\n        managed_styles.forEach(info => {\r\n            const { ownerNode } = info.stylesheet;\r\n            // there is no ownerNode if it runs on jsdom.\r\n            if (ownerNode)\r\n                detach(ownerNode);\r\n        });\r\n        managed_styles.clear();\r\n    });\r\n}\r\n\r\nlet current_component;\r\nfunction set_current_component(component) {\r\n    current_component = component;\r\n}\r\nfunction get_current_component() {\r\n    if (!current_component)\r\n        throw new Error('Function called outside component initialization');\r\n    return current_component;\r\n}\r\nfunction onMount(fn) {\r\n    get_current_component().$$.on_mount.push(fn);\r\n}\r\nfunction afterUpdate(fn) {\r\n    get_current_component().$$.after_update.push(fn);\r\n}\r\nfunction onDestroy(fn) {\r\n    get_current_component().$$.on_destroy.push(fn);\r\n}\r\nfunction createEventDispatcher() {\r\n    const component = get_current_component();\r\n    return (type, detail, { cancelable = false } = {}) => {\r\n        const callbacks = component.$$.callbacks[type];\r\n        if (callbacks) {\r\n            // TODO are there situations where events could be dispatched\r\n            // in a server (non-DOM) environment?\r\n            const event = custom_event(type, detail, { cancelable });\r\n            callbacks.slice().forEach(fn => {\r\n                fn.call(component, event);\r\n            });\r\n            return !event.defaultPrevented;\r\n        }\r\n        return true;\r\n    };\r\n}\r\nfunction setContext(key, context) {\r\n    get_current_component().$$.context.set(key, context);\r\n    return context;\r\n}\r\nfunction getContext(key) {\r\n    return get_current_component().$$.context.get(key);\r\n}\r\n// TODO figure out if we still want to support\r\n// shorthand events, or if we want to implement\r\n// a real bubbling mechanism\r\nfunction bubble(component, event) {\r\n    const callbacks = component.$$.callbacks[event.type];\r\n    if (callbacks) {\r\n        // @ts-ignore\r\n        callbacks.slice().forEach(fn => fn.call(this, event));\r\n    }\r\n}\r\n\r\nconst dirty_components = [];\r\nconst binding_callbacks = [];\r\nconst render_callbacks = [];\r\nconst flush_callbacks = [];\r\nconst resolved_promise = Promise.resolve();\r\nlet update_scheduled = false;\r\nfunction schedule_update() {\r\n    if (!update_scheduled) {\r\n        update_scheduled = true;\r\n        resolved_promise.then(flush);\r\n    }\r\n}\r\nfunction tick$1() {\r\n    schedule_update();\r\n    return resolved_promise;\r\n}\r\nfunction add_render_callback(fn) {\r\n    render_callbacks.push(fn);\r\n}\r\nfunction add_flush_callback(fn) {\r\n    flush_callbacks.push(fn);\r\n}\r\n// flush() calls callbacks in this order:\r\n// 1. All beforeUpdate callbacks, in order: parents before children\r\n// 2. All bind:this callbacks, in reverse order: children before parents.\r\n// 3. All afterUpdate callbacks, in order: parents before children. EXCEPT\r\n//    for afterUpdates called during the initial onMount, which are called in\r\n//    reverse order: children before parents.\r\n// Since callbacks might update component values, which could trigger another\r\n// call to flush(), the following steps guard against this:\r\n// 1. During beforeUpdate, any updated components will be added to the\r\n//    dirty_components array and will cause a reentrant call to flush(). Because\r\n//    the flush index is kept outside the function, the reentrant call will pick\r\n//    up where the earlier call left off and go through all dirty components. The\r\n//    current_component value is saved and restored so that the reentrant call will\r\n//    not interfere with the \"parent\" flush() call.\r\n// 2. bind:this callbacks cannot trigger new flush() calls.\r\n// 3. During afterUpdate, any updated components will NOT have their afterUpdate\r\n//    callback called a second time; the seen_callbacks set, outside the flush()\r\n//    function, guarantees this behavior.\r\nconst seen_callbacks = new Set();\r\nlet flushidx = 0; // Do *not* move this inside the flush() function\r\nfunction flush() {\r\n    const saved_component = current_component;\r\n    do {\r\n        // first, call beforeUpdate functions\r\n        // and update components\r\n        while (flushidx < dirty_components.length) {\r\n            const component = dirty_components[flushidx];\r\n            flushidx++;\r\n            set_current_component(component);\r\n            update(component.$$);\r\n        }\r\n        set_current_component(null);\r\n        dirty_components.length = 0;\r\n        flushidx = 0;\r\n        while (binding_callbacks.length)\r\n            binding_callbacks.pop()();\r\n        // then, once components are updated, call\r\n        // afterUpdate functions. This may cause\r\n        // subsequent updates...\r\n        for (let i = 0; i < render_callbacks.length; i += 1) {\r\n            const callback = render_callbacks[i];\r\n            if (!seen_callbacks.has(callback)) {\r\n                // ...so guard against infinite loops\r\n                seen_callbacks.add(callback);\r\n                callback();\r\n            }\r\n        }\r\n        render_callbacks.length = 0;\r\n    } while (dirty_components.length);\r\n    while (flush_callbacks.length) {\r\n        flush_callbacks.pop()();\r\n    }\r\n    update_scheduled = false;\r\n    seen_callbacks.clear();\r\n    set_current_component(saved_component);\r\n}\r\nfunction update($$) {\r\n    if ($$.fragment !== null) {\r\n        $$.update();\r\n        run_all($$.before_update);\r\n        const dirty = $$.dirty;\r\n        $$.dirty = [-1];\r\n        $$.fragment && $$.fragment.p($$.ctx, dirty);\r\n        $$.after_update.forEach(add_render_callback);\r\n    }\r\n}\r\n\r\nlet promise;\r\nfunction wait() {\r\n    if (!promise) {\r\n        promise = Promise.resolve();\r\n        promise.then(() => {\r\n            promise = null;\r\n        });\r\n    }\r\n    return promise;\r\n}\r\nfunction dispatch(node, direction, kind) {\r\n    node.dispatchEvent(custom_event(`${direction ? 'intro' : 'outro'}${kind}`));\r\n}\r\nconst outroing = new Set();\r\nlet outros;\r\nfunction group_outros() {\r\n    outros = {\r\n        r: 0,\r\n        c: [],\r\n        p: outros // parent group\r\n    };\r\n}\r\nfunction check_outros() {\r\n    if (!outros.r) {\r\n        run_all(outros.c);\r\n    }\r\n    outros = outros.p;\r\n}\r\nfunction transition_in(block, local) {\r\n    if (block && block.i) {\r\n        outroing.delete(block);\r\n        block.i(local);\r\n    }\r\n}\r\nfunction transition_out(block, local, detach, callback) {\r\n    if (block && block.o) {\r\n        if (outroing.has(block))\r\n            return;\r\n        outroing.add(block);\r\n        outros.c.push(() => {\r\n            outroing.delete(block);\r\n            if (callback) {\r\n                if (detach)\r\n                    block.d(1);\r\n                callback();\r\n            }\r\n        });\r\n        block.o(local);\r\n    }\r\n    else if (callback) {\r\n        callback();\r\n    }\r\n}\r\nconst null_transition = { duration: 0 };\r\nfunction create_bidirectional_transition(node, fn, params, intro) {\r\n    let config = fn(node, params);\r\n    let t = intro ? 0 : 1;\r\n    let running_program = null;\r\n    let pending_program = null;\r\n    let animation_name = null;\r\n    function clear_animation() {\r\n        if (animation_name)\r\n            delete_rule(node, animation_name);\r\n    }\r\n    function init(program, duration) {\r\n        const d = (program.b - t);\r\n        duration *= Math.abs(d);\r\n        return {\r\n            a: t,\r\n            b: program.b,\r\n            d,\r\n            duration,\r\n            start: program.start,\r\n            end: program.start + duration,\r\n            group: program.group\r\n        };\r\n    }\r\n    function go(b) {\r\n        const { delay = 0, duration = 300, easing = identity, tick = noop, css } = config || null_transition;\r\n        const program = {\r\n            start: now() + delay,\r\n            b\r\n        };\r\n        if (!b) {\r\n            // @ts-ignore todo: improve typings\r\n            program.group = outros;\r\n            outros.r += 1;\r\n        }\r\n        if (running_program || pending_program) {\r\n            pending_program = program;\r\n        }\r\n        else {\r\n            // if this is an intro, and there's a delay, we need to do\r\n            // an initial tick and/or apply CSS animation immediately\r\n            if (css) {\r\n                clear_animation();\r\n                animation_name = create_rule(node, t, b, duration, delay, easing, css);\r\n            }\r\n            if (b)\r\n                tick(0, 1);\r\n            running_program = init(program, duration);\r\n            add_render_callback(() => dispatch(node, b, 'start'));\r\n            loop(now => {\r\n                if (pending_program && now > pending_program.start) {\r\n                    running_program = init(pending_program, duration);\r\n                    pending_program = null;\r\n                    dispatch(node, running_program.b, 'start');\r\n                    if (css) {\r\n                        clear_animation();\r\n                        animation_name = create_rule(node, t, running_program.b, running_program.duration, 0, easing, config.css);\r\n                    }\r\n                }\r\n                if (running_program) {\r\n                    if (now >= running_program.end) {\r\n                        tick(t = running_program.b, 1 - t);\r\n                        dispatch(node, running_program.b, 'end');\r\n                        if (!pending_program) {\r\n                            // we're done\r\n                            if (running_program.b) {\r\n                                // intro — we can tidy up immediately\r\n                                clear_animation();\r\n                            }\r\n                            else {\r\n                                // outro — needs to be coordinated\r\n                                if (!--running_program.group.r)\r\n                                    run_all(running_program.group.c);\r\n                            }\r\n                        }\r\n                        running_program = null;\r\n                    }\r\n                    else if (now >= running_program.start) {\r\n                        const p = now - running_program.start;\r\n                        t = running_program.a + running_program.d * easing(p / running_program.duration);\r\n                        tick(t, 1 - t);\r\n                    }\r\n                }\r\n                return !!(running_program || pending_program);\r\n            });\r\n        }\r\n    }\r\n    return {\r\n        run(b) {\r\n            if (is_function(config)) {\r\n                wait().then(() => {\r\n                    // @ts-ignore\r\n                    config = config();\r\n                    go(b);\r\n                });\r\n            }\r\n            else {\r\n                go(b);\r\n            }\r\n        },\r\n        end() {\r\n            clear_animation();\r\n            running_program = pending_program = null;\r\n        }\r\n    };\r\n}\r\n\r\nconst globals = (typeof window !== 'undefined'\r\n    ? window\r\n    : typeof globalThis !== 'undefined'\r\n        ? globalThis\r\n        : global);\r\n\r\nfunction destroy_block(block, lookup) {\r\n    block.d(1);\r\n    lookup.delete(block.key);\r\n}\r\nfunction outro_and_destroy_block(block, lookup) {\r\n    transition_out(block, 1, 1, () => {\r\n        lookup.delete(block.key);\r\n    });\r\n}\r\nfunction update_keyed_each(old_blocks, dirty, get_key, dynamic, ctx, list, lookup, node, destroy, create_each_block, next, get_context) {\r\n    let o = old_blocks.length;\r\n    let n = list.length;\r\n    let i = o;\r\n    const old_indexes = {};\r\n    while (i--)\r\n        old_indexes[old_blocks[i].key] = i;\r\n    const new_blocks = [];\r\n    const new_lookup = new Map();\r\n    const deltas = new Map();\r\n    i = n;\r\n    while (i--) {\r\n        const child_ctx = get_context(ctx, list, i);\r\n        const key = get_key(child_ctx);\r\n        let block = lookup.get(key);\r\n        if (!block) {\r\n            block = create_each_block(key, child_ctx);\r\n            block.c();\r\n        }\r\n        else if (dynamic) {\r\n            block.p(child_ctx, dirty);\r\n        }\r\n        new_lookup.set(key, new_blocks[i] = block);\r\n        if (key in old_indexes)\r\n            deltas.set(key, Math.abs(i - old_indexes[key]));\r\n    }\r\n    const will_move = new Set();\r\n    const did_move = new Set();\r\n    function insert(block) {\r\n        transition_in(block, 1);\r\n        block.m(node, next);\r\n        lookup.set(block.key, block);\r\n        next = block.first;\r\n        n--;\r\n    }\r\n    while (o && n) {\r\n        const new_block = new_blocks[n - 1];\r\n        const old_block = old_blocks[o - 1];\r\n        const new_key = new_block.key;\r\n        const old_key = old_block.key;\r\n        if (new_block === old_block) {\r\n            // do nothing\r\n            next = new_block.first;\r\n            o--;\r\n            n--;\r\n        }\r\n        else if (!new_lookup.has(old_key)) {\r\n            // remove old block\r\n            destroy(old_block, lookup);\r\n            o--;\r\n        }\r\n        else if (!lookup.has(new_key) || will_move.has(new_key)) {\r\n            insert(new_block);\r\n        }\r\n        else if (did_move.has(old_key)) {\r\n            o--;\r\n        }\r\n        else if (deltas.get(new_key) > deltas.get(old_key)) {\r\n            did_move.add(new_key);\r\n            insert(new_block);\r\n        }\r\n        else {\r\n            will_move.add(old_key);\r\n            o--;\r\n        }\r\n    }\r\n    while (o--) {\r\n        const old_block = old_blocks[o];\r\n        if (!new_lookup.has(old_block.key))\r\n            destroy(old_block, lookup);\r\n    }\r\n    while (n)\r\n        insert(new_blocks[n - 1]);\r\n    return new_blocks;\r\n}\r\n\r\nfunction get_spread_update(levels, updates) {\r\n    const update = {};\r\n    const to_null_out = {};\r\n    const accounted_for = { $$scope: 1 };\r\n    let i = levels.length;\r\n    while (i--) {\r\n        const o = levels[i];\r\n        const n = updates[i];\r\n        if (n) {\r\n            for (const key in o) {\r\n                if (!(key in n))\r\n                    to_null_out[key] = 1;\r\n            }\r\n            for (const key in n) {\r\n                if (!accounted_for[key]) {\r\n                    update[key] = n[key];\r\n                    accounted_for[key] = 1;\r\n                }\r\n            }\r\n            levels[i] = n;\r\n        }\r\n        else {\r\n            for (const key in o) {\r\n                accounted_for[key] = 1;\r\n            }\r\n        }\r\n    }\r\n    for (const key in to_null_out) {\r\n        if (!(key in update))\r\n            update[key] = undefined;\r\n    }\r\n    return update;\r\n}\r\nfunction get_spread_object(spread_props) {\r\n    return typeof spread_props === 'object' && spread_props !== null ? spread_props : {};\r\n}\r\n\r\nfunction bind(component, name, callback) {\r\n    const index = component.$$.props[name];\r\n    if (index !== undefined) {\r\n        component.$$.bound[index] = callback;\r\n        callback(component.$$.ctx[index]);\r\n    }\r\n}\r\nfunction create_component(block) {\r\n    block && block.c();\r\n}\r\nfunction mount_component(component, target, anchor, customElement) {\r\n    const { fragment, on_mount, on_destroy, after_update } = component.$$;\r\n    fragment && fragment.m(target, anchor);\r\n    if (!customElement) {\r\n        // onMount happens before the initial afterUpdate\r\n        add_render_callback(() => {\r\n            const new_on_destroy = on_mount.map(run).filter(is_function);\r\n            if (on_destroy) {\r\n                on_destroy.push(...new_on_destroy);\r\n            }\r\n            else {\r\n                // Edge case - component was destroyed immediately,\r\n                // most likely as a result of a binding initialising\r\n                run_all(new_on_destroy);\r\n            }\r\n            component.$$.on_mount = [];\r\n        });\r\n    }\r\n    after_update.forEach(add_render_callback);\r\n}\r\nfunction destroy_component(component, detaching) {\r\n    const $$ = component.$$;\r\n    if ($$.fragment !== null) {\r\n        run_all($$.on_destroy);\r\n        $$.fragment && $$.fragment.d(detaching);\r\n        // TODO null out other refs, including component.$$ (but need to\r\n        // preserve final state?)\r\n        $$.on_destroy = $$.fragment = null;\r\n        $$.ctx = [];\r\n    }\r\n}\r\nfunction make_dirty(component, i) {\r\n    if (component.$$.dirty[0] === -1) {\r\n        dirty_components.push(component);\r\n        schedule_update();\r\n        component.$$.dirty.fill(0);\r\n    }\r\n    component.$$.dirty[(i / 31) | 0] |= (1 << (i % 31));\r\n}\r\nfunction init(component, options, instance, create_fragment, not_equal, props, append_styles, dirty = [-1]) {\r\n    const parent_component = current_component;\r\n    set_current_component(component);\r\n    const $$ = component.$$ = {\r\n        fragment: null,\r\n        ctx: null,\r\n        // state\r\n        props,\r\n        update: noop,\r\n        not_equal,\r\n        bound: blank_object(),\r\n        // lifecycle\r\n        on_mount: [],\r\n        on_destroy: [],\r\n        on_disconnect: [],\r\n        before_update: [],\r\n        after_update: [],\r\n        context: new Map(options.context || (parent_component ? parent_component.$$.context : [])),\r\n        // everything else\r\n        callbacks: blank_object(),\r\n        dirty,\r\n        skip_bound: false,\r\n        root: options.target || parent_component.$$.root\r\n    };\r\n    append_styles && append_styles($$.root);\r\n    let ready = false;\r\n    $$.ctx = instance\r\n        ? instance(component, options.props || {}, (i, ret, ...rest) => {\r\n            const value = rest.length ? rest[0] : ret;\r\n            if ($$.ctx && not_equal($$.ctx[i], $$.ctx[i] = value)) {\r\n                if (!$$.skip_bound && $$.bound[i])\r\n                    $$.bound[i](value);\r\n                if (ready)\r\n                    make_dirty(component, i);\r\n            }\r\n            return ret;\r\n        })\r\n        : [];\r\n    $$.update();\r\n    ready = true;\r\n    run_all($$.before_update);\r\n    // `false` as a special case of no DOM component\r\n    $$.fragment = create_fragment ? create_fragment($$.ctx) : false;\r\n    if (options.target) {\r\n        if (options.hydrate) {\r\n            const nodes = children(options.target);\r\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n            $$.fragment && $$.fragment.l(nodes);\r\n            nodes.forEach(detach);\r\n        }\r\n        else {\r\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n            $$.fragment && $$.fragment.c();\r\n        }\r\n        if (options.intro)\r\n            transition_in(component.$$.fragment);\r\n        mount_component(component, options.target, options.anchor, options.customElement);\r\n        flush();\r\n    }\r\n    set_current_component(parent_component);\r\n}\r\n/**\r\n * Base class for Svelte components. Used when dev=false.\r\n */\r\nclass SvelteComponent {\r\n    $destroy() {\r\n        destroy_component(this, 1);\r\n        this.$destroy = noop;\r\n    }\r\n    $on(type, callback) {\r\n        const callbacks = (this.$$.callbacks[type] || (this.$$.callbacks[type] = []));\r\n        callbacks.push(callback);\r\n        return () => {\r\n            const index = callbacks.indexOf(callback);\r\n            if (index !== -1)\r\n                callbacks.splice(index, 1);\r\n        };\r\n    }\r\n    $set($$props) {\r\n        if (this.$$set && !is_empty($$props)) {\r\n            this.$$.skip_bound = true;\r\n            this.$$set($$props);\r\n            this.$$.skip_bound = false;\r\n        }\r\n    }\r\n}\r\n\r\nconst subscriber_queue = [];\r\n/**\r\n * Creates a `Readable` store that allows reading by subscription.\r\n * @param value initial value\r\n * @param {StartStopNotifier}start start and stop notifications for subscriptions\r\n */\r\nfunction readable(value, start) {\r\n    return {\r\n        subscribe: writable(value, start).subscribe\r\n    };\r\n}\r\n/**\r\n * Create a `Writable` store that allows both updating and reading by subscription.\r\n * @param {*=}value initial value\r\n * @param {StartStopNotifier=}start start and stop notifications for subscriptions\r\n */\r\nfunction writable(value, start = noop) {\r\n    let stop;\r\n    const subscribers = new Set();\r\n    function set(new_value) {\r\n        if (safe_not_equal(value, new_value)) {\r\n            value = new_value;\r\n            if (stop) { // store is ready\r\n                const run_queue = !subscriber_queue.length;\r\n                for (const subscriber of subscribers) {\r\n                    subscriber[1]();\r\n                    subscriber_queue.push(subscriber, value);\r\n                }\r\n                if (run_queue) {\r\n                    for (let i = 0; i < subscriber_queue.length; i += 2) {\r\n                        subscriber_queue[i][0](subscriber_queue[i + 1]);\r\n                    }\r\n                    subscriber_queue.length = 0;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    function update(fn) {\r\n        set(fn(value));\r\n    }\r\n    function subscribe(run, invalidate = noop) {\r\n        const subscriber = [run, invalidate];\r\n        subscribers.add(subscriber);\r\n        if (subscribers.size === 1) {\r\n            stop = start(set) || noop;\r\n        }\r\n        run(value);\r\n        return () => {\r\n            subscribers.delete(subscriber);\r\n            if (subscribers.size === 0) {\r\n                stop();\r\n                stop = null;\r\n            }\r\n        };\r\n    }\r\n    return { set, update, subscribe };\r\n}\r\nfunction derived(stores, fn, initial_value) {\r\n    const single = !Array.isArray(stores);\r\n    const stores_array = single\r\n        ? [stores]\r\n        : stores;\r\n    const auto = fn.length < 2;\r\n    return readable(initial_value, (set) => {\r\n        let inited = false;\r\n        const values = [];\r\n        let pending = 0;\r\n        let cleanup = noop;\r\n        const sync = () => {\r\n            if (pending) {\r\n                return;\r\n            }\r\n            cleanup();\r\n            const result = fn(single ? values[0] : values, set);\r\n            if (auto) {\r\n                set(result);\r\n            }\r\n            else {\r\n                cleanup = is_function(result) ? result : noop;\r\n            }\r\n        };\r\n        const unsubscribers = stores_array.map((store, i) => subscribe(store, (value) => {\r\n            values[i] = value;\r\n            pending &= ~(1 << i);\r\n            if (inited) {\r\n                sync();\r\n            }\r\n        }, () => {\r\n            pending |= (1 << i);\r\n        }));\r\n        inited = true;\r\n        sync();\r\n        return function stop() {\r\n            run_all(unsubscribers);\r\n            cleanup();\r\n        };\r\n    });\r\n}\r\n\r\nvar mergeObjects = (objects) => objects.reduce((prev, curr) => Object.assign(prev, curr), {});\r\n\r\n// @ts-ignore\r\nconst UPDATE_VALUE = (updateValue) => ({ updateValue });\r\nconst DEFAULT_VALUE = (defaultValue) => ({ defaultValue });\r\nconst CUSTOM_STORE = (fn) => ({ store: fn });\r\n// @ts-ignore (fixes error thrown in karma typescript)\r\nconst DERIVED_STORE = (fn) => ({ store: (defaultValue, stores) => derived(...fn(stores)) });\r\nconst UNIQUE_DERIVED_STORE = (fn) => ({\r\n    store: (defaultValue, stores) => {\r\n        const [selectedStores, update, isEqual = () => false] = fn(stores);\r\n        let isFirst = true;\r\n        let currentValue;\r\n        return derived(selectedStores, (storeValues, set) => {\r\n            update(storeValues, (value) => {\r\n                if (!isFirst && isEqual(currentValue, value))\r\n                    return;\r\n                currentValue = value;\r\n                isFirst = false;\r\n                set(value);\r\n            });\r\n        });\r\n    },\r\n});\r\nconst MAP_STORE = (fn) => ({\r\n    store: (defaultValue, stores) => {\r\n        const [valueMapper, observedStores = {}, sorter = undefined] = fn(stores);\r\n        let storedItems = [];\r\n        const $observedStores = {};\r\n        const mapValue = (item) => valueMapper(item, $observedStores);\r\n        // set default properties for each item\r\n        const setValue = (items) => {\r\n            // was empty, still empty\r\n            if (!storedItems.length && !items.length)\r\n                return;\r\n            // update value\r\n            storedItems = items;\r\n            updateValue();\r\n        };\r\n        const updateValue = () => {\r\n            const mappedItems = storedItems.map(mapValue);\r\n            if (sorter)\r\n                mappedItems.sort(sorter);\r\n            storedItems = [...mappedItems];\r\n            set(mappedItems);\r\n        };\r\n        // TODO: need to at some point unsub from these stores\r\n        Object.entries(observedStores).map(([name, store]) => {\r\n            return store.subscribe((value) => {\r\n                $observedStores[name] = value;\r\n                if (!value)\r\n                    return;\r\n                updateValue();\r\n            });\r\n        });\r\n        const { subscribe, set } = writable(defaultValue || []);\r\n        return {\r\n            set: setValue,\r\n            update: (fn) => setValue(fn(storedItems)),\r\n            subscribe,\r\n        };\r\n    },\r\n});\r\nconst createStore$1 = (accessors, stores, options) => {\r\n    const { store = (defaultValue) => writable(defaultValue), defaultValue = noop$1, // should be a function returning the default value\r\n    updateValue = undefined, } = options;\r\n    // create our private store\r\n    const storeInstance = store(defaultValue(), stores, accessors);\r\n    const { subscribe, update = noop$1 } = storeInstance; // update = noop because not all stores can be updated\r\n    // on update private store\r\n    let unsub;\r\n    const onUpdate = (cb) => {\r\n        let ignoreFirstCallback = true;\r\n        if (unsub)\r\n            unsub();\r\n        unsub = subscribe((value) => {\r\n            // need to ignore first callback because that returns current value\r\n            if (ignoreFirstCallback)\r\n                return (ignoreFirstCallback = false);\r\n            // now we have the newly assigned value\r\n            cb(value);\r\n            unsub();\r\n            unsub = undefined;\r\n        });\r\n    };\r\n    // create the value updater function, needs access to stores so can read all store values\r\n    const updateStoreValue = updateValue ? updateValue(accessors) : passthrough;\r\n    // set and validate value\r\n    storeInstance.set = (nextValue) => update((previousValue) => updateStoreValue(nextValue, previousValue, onUpdate));\r\n    // set default value for external reference\r\n    storeInstance.defaultValue = defaultValue;\r\n    // expose store api\r\n    return storeInstance;\r\n};\r\nvar createStores = (props) => {\r\n    const stores = {};\r\n    const accessors = {};\r\n    props.forEach(([name, ...options]) => {\r\n        const opts = mergeObjects(options);\r\n        const store = (stores[name] = createStore$1(accessors, stores, opts));\r\n        const property = {\r\n            get: () => get_store_value(store),\r\n            set: store.set,\r\n        };\r\n        Object.defineProperty(accessors, name, property);\r\n    });\r\n    return {\r\n        stores,\r\n        accessors,\r\n    };\r\n};\r\n\r\n// custom source store so we only trigger update when src changes\r\nconst sourceStore = () => {\r\n    // inner value\r\n    let value;\r\n    const { subscribe, set } = writable();\r\n    const _set = (newValue) => {\r\n        // is equal, bounce!\r\n        if (value === newValue)\r\n            return;\r\n        value = newValue;\r\n        set(value);\r\n    };\r\n    const _update = (fn) => _set(fn(value));\r\n    return {\r\n        set: _set,\r\n        subscribe,\r\n        update: _update,\r\n    };\r\n};\r\nvar props = [\r\n    // io\r\n    ['src', CUSTOM_STORE(sourceStore)],\r\n    ['imageReader'],\r\n    ['imageWriter'],\r\n    // will scramble image data for use with image redaction logic\r\n    ['imageScrambler'],\r\n    // current images\r\n    ['images', DEFAULT_VALUE(() => [])],\r\n    // will process markup items before rendering, used by arrows and frames\r\n    ['shapePreprocessor'],\r\n    // will be called when requesting a resource, return false to prevent loading, receives URL and XHR\r\n    ['willRequestResource'] /* deprecated */,\r\n    // will be called when requesting a resource, receives URL and requestType\r\n    // return false to prevent loading\r\n    // return object with options to update request\r\n    // return undefined to continue as normal\r\n    ['willRequest'],\r\n];\r\n\r\nvar capitalizeFirstLetter = (str) => str.charAt(0).toUpperCase() + str.slice(1);\r\n\r\nvar defineMethods = (object, api) => {\r\n    Object.keys(api).forEach((name) => {\r\n        const descriptor = isFunction(api[name])\r\n            ? {\r\n                value: api[name],\r\n                writable: false,\r\n            }\r\n            : api[name];\r\n        Object.defineProperty(object, name, descriptor);\r\n    });\r\n};\r\n\r\n// TODO: replace with pointInPoly from geom, this function works correctly with \"offsetRectToFitPolygon\" but doesn't always work correctly, the pointInPoly from geom does work correctly but causes offsetRectToFitPolygon to sometimes work incorrectly, needs to be cleaned up in the future\r\nconst pointInPoly = (point, vertices) => {\r\n    let i;\r\n    let a;\r\n    let b;\r\n    let aX;\r\n    let aY;\r\n    let bX;\r\n    let bY;\r\n    let edgeX;\r\n    let edgeY;\r\n    let d;\r\n    const l = vertices.length;\r\n    for (i = 0; i < l; i++) {\r\n        // current vertex\r\n        a = vertices[i];\r\n        // next vertex\r\n        b = vertices[i + 1 > l - 1 ? 0 : i + 1];\r\n        // translate so that point is the origin of the calculation\r\n        aX = a.x - point.x;\r\n        aY = a.y - point.y;\r\n        bX = b.x - point.x;\r\n        bY = b.y - point.y;\r\n        edgeX = aX - bX;\r\n        edgeY = aY - bY;\r\n        d = edgeX * aY - edgeY * aX;\r\n        // 0 is ON the edge, but we check for -0.00001 to fix floating point errors\r\n        if (d < -0.00001)\r\n            return false;\r\n    }\r\n    return true;\r\n};\r\nconst scalar = 10000;\r\nvar offsetRectToFitPolygon = (rect, poly) => {\r\n    const polyLines = quadLines(poly);\r\n    const offset = vectorCreateEmpty();\r\n    const rectVertexes = rectGetCorners(rect);\r\n    // we can fit it\r\n    rectVertexes.forEach((vertex) => {\r\n        // we update each corner by adding the current offset\r\n        vectorAdd(vertex, offset);\r\n        // test if point lies in polygon, if so, all is fine and we can exit\r\n        if (pointInPoly(vertex, poly))\r\n            return;\r\n        polyLines.forEach((line) => {\r\n            // get angle of edge and draw a ray from the corner perpendicular to the edge\r\n            const a = Math.atan2(line.start.y - line.end.y, line.start.x - line.end.x);\r\n            const x = Math.sin(Math.PI - a) * scalar;\r\n            const y = Math.cos(Math.PI - a) * scalar;\r\n            const ray = vectorCreate(vertex.x + x, vertex.y + y);\r\n            // extend the poly line so even if we overshoot the polygon we hit it\r\n            const lineExtended = lineExtend(lineClone(line), scalar);\r\n            // get the resulting intersection (there's always an intersection)\r\n            const intersection = lineLineIntersection(lineCreate(vertex, ray), lineExtended);\r\n            // no intersection, no need to do anything\r\n            if (!intersection)\r\n                return;\r\n            // update offset to move towards image\r\n            vectorAdd(offset, vectorSubtract(vectorClone(intersection), vertex));\r\n        });\r\n    });\r\n    // test if any vertexes still fall outside of poly, if so, we can't fit the rect\r\n    const rectOffset = rectClone$1(rect);\r\n    vectorAdd(rectOffset, offset);\r\n    const rectOffsetVertices = rectGetCorners(rectOffset);\r\n    const fits = rectOffsetVertices.every((vertex) => pointInPoly(vertex, poly));\r\n    if (fits) {\r\n        rectUpdateWithRect(rect, rectOffset);\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\n\r\nvar limitCropRectToImage = (rect, poly) => {\r\n    // get crop rect polygon vertexes\r\n    const rectVertexes = rectGetCorners(rect);\r\n    // if we end up here it doesn't fit, we might need to adjust\r\n    const polyLines = quadToLines(poly, 5);\r\n    const rectCenterPosition = rectCenter(rect);\r\n    const intersections = [];\r\n    rectVertexes.forEach((rectVertex) => {\r\n        const ray = lineMultiply(lineCreate(vectorClone(rectCenterPosition), vectorClone(rectVertex)), 1000000);\r\n        let intersectionFound = false;\r\n        polyLines.map(lineClone).forEach((line) => {\r\n            const intersection = lineLineIntersection(ray, line);\r\n            if (!intersection || intersectionFound)\r\n                return;\r\n            intersections.push(intersection);\r\n            intersectionFound = true;\r\n        });\r\n    });\r\n    // top left -> bottom right\r\n    const tlbr = vectorDistance(intersections[0], intersections[2]);\r\n    // top right -> bottom left\r\n    const trbl = vectorDistance(intersections[1], intersections[3]);\r\n    // calculate smallest rectangle we can make, use that\r\n    const rectLimitedVertices = tlbr < trbl ? [intersections[0], intersections[2]] : [intersections[1], intersections[3]];\r\n    const rectLimitedToPolygon = rectCreateFromPoints(rectLimitedVertices);\r\n    // only use our fitted crop rectangle if it's smaller than our current rectangle,\r\n    // this would mean that our current rectangle couldn't be moved to make it fit\r\n    if (rectLimitedToPolygon.width < rect.width) {\r\n        // need to center on previous rect\r\n        rectUpdateWithRect(rect, rectLimitedToPolygon);\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\n\r\nvar getImagePolygon = (image, imageRotation, imagePerspective = { x: 0, y: 0 }) => {\r\n    const imageRect = rectCreateFromSize(image);\r\n    const imageCenter = rectCenter(imageRect);\r\n    const imagePoly = rectApplyPerspective(imageRect, imagePerspective, imageCenter).map((imageVertex) => vectorRotate(imageVertex, imageRotation, imageCenter));\r\n    // get image poly bounds, we need this to offset the poly vertices from 0,0\r\n    const imagePolyBounds = rectCreateFromPoints(imagePoly);\r\n    // get image polygon vertexes\r\n    return imagePoly.map((imageVertex) => vectorSubtract(imageVertex, imagePolyBounds));\r\n};\r\n\r\nvar getMaxSizeInRect = (size, rotation = 0, aspectRatio = rectAspectRatio(size)) => {\r\n    let width;\r\n    let height;\r\n    if (rotation !== 0) {\r\n        const innerAngle = Math.atan2(1, aspectRatio);\r\n        const rotationSigned = Math.sign(rotation) * rotation;\r\n        const rotationSignedMod = rotationSigned % Math.PI;\r\n        const rotationSignedModHalf = rotationSigned % HALF_PI;\r\n        // determine if is turned on side\r\n        let r;\r\n        if (rotationSignedMod > QUART_PI && rotationSignedMod < HALF_PI + QUART_PI) {\r\n            r = rotationSignedModHalf > QUART_PI ? rotationSigned : HALF_PI - rotationSignedModHalf;\r\n        }\r\n        else {\r\n            r = rotationSignedModHalf > QUART_PI ? HALF_PI - rotationSignedModHalf : rotationSigned;\r\n        }\r\n        const hyp = Math.min(Math.abs(size.height / Math.sin(innerAngle + r)), Math.abs(size.width / Math.cos(innerAngle - r)));\r\n        width = Math.cos(innerAngle) * hyp;\r\n        height = width / aspectRatio;\r\n    }\r\n    else {\r\n        width = size.width;\r\n        height = width / aspectRatio;\r\n        if (height > size.height) {\r\n            height = size.height;\r\n            width = height * aspectRatio;\r\n        }\r\n    }\r\n    return sizeCreate(width, height);\r\n};\r\n\r\nvar limitRectToImage = (rect, imageSize, imageRotation = 0, imagePerspective = vectorCreateEmpty(), minSize) => {\r\n    // rotation and/or perspective, let's use the \"advanced\" collision detection method\r\n    if ((isNumber(imageRotation) && imageRotation !== 0) ||\r\n        imagePerspective.x ||\r\n        imagePerspective.y) {\r\n        const inputAspectRatio = rectAspectRatio(rect);\r\n        // test if crop can fit image, if it can, offset the crop so it fits\r\n        const imagePolygon = getImagePolygon(imageSize, imageRotation, imagePerspective);\r\n        const maxSizeInRect = getMaxSizeInRect(imageSize, imageRotation, inputAspectRatio);\r\n        const canFit = rect.width < maxSizeInRect.width && rect.height < maxSizeInRect.height;\r\n        if (!canFit) {\r\n            const dx = rect.width * 0.5 - maxSizeInRect.width * 0.5;\r\n            const dy = rect.height * 0.5 - maxSizeInRect.height * 0.5;\r\n            // adjust crop rect to max size\r\n            if (rect.width > maxSizeInRect.width) {\r\n                rect.width = maxSizeInRect.width;\r\n                rect.x += dx;\r\n            }\r\n            if (rect.height > maxSizeInRect.height) {\r\n                rect.height = maxSizeInRect.height;\r\n                rect.y += dy;\r\n            }\r\n            // test if has exceeded min size, if so we need to limit the size and recalculate the other edge\r\n            /*\r\n                        -\\\r\n                       /  ---\\\r\n                      h2      ---\\\r\n                     /            ---\\\r\n                    +--------w---------+\\\r\n                   /|                  | ---\\\r\n                  / |                  |     ---\\\r\n                 /  |                  |         ---\\\r\n                /   |                  |             --\r\n               h1   |                  |             /\r\n              /     |                  |            /\r\n             /      |                  |           /\r\n            -\\      |                  |          /\r\n              ---\\  |                  |         /\r\n                  --+------------------+        /\r\n                      ---\\                     /\r\n                          --\\                 /\r\n                             ---\\            /\r\n                                 ---\\       /\r\n                                     ---\\  /\r\n                                         --\r\n            */\r\n        }\r\n        offsetRectToFitPolygon(rect, imagePolygon);\r\n        const wasLimited = limitCropRectToImage(rect, imagePolygon);\r\n        // this makes sure that after limiting the size, the crop rect is moved to a position that is inside the image\r\n        if (wasLimited)\r\n            offsetRectToFitPolygon(rect, imagePolygon);\r\n    }\r\n    // no rotation, no perspective, use simple bounds method\r\n    else {\r\n        // remember intended aspect ratio so we can try and recreate it\r\n        const intendedAspectRatio = rectAspectRatio(rect);\r\n        // limit to image size first, can never exceed that\r\n        rect.width = Math.min(rect.width, imageSize.width);\r\n        rect.height = Math.min(rect.height, imageSize.height);\r\n        // reposition rect so it's always inside image bounds\r\n        rect.x = Math.max(rect.x, 0);\r\n        if (rect.x + rect.width > imageSize.width) {\r\n            rect.x -= rect.x + rect.width - imageSize.width;\r\n        }\r\n        rect.y = Math.max(rect.y, 0);\r\n        if (rect.y + rect.height > imageSize.height) {\r\n            rect.y -= rect.y + rect.height - imageSize.height;\r\n        }\r\n        // we get the center of the current rect so we can center the contained rect to it\r\n        const intendedCenter = rectCenter(rect);\r\n        // make sure still adheres to aspect ratio\r\n        const containedRect = rectContainRect(rect, intendedAspectRatio);\r\n        containedRect.width = Math.max(minSize.width, containedRect.width);\r\n        containedRect.height = Math.max(minSize.height, containedRect.height);\r\n        containedRect.x = intendedCenter.x - containedRect.width * 0.5;\r\n        containedRect.y = intendedCenter.y - containedRect.height * 0.5;\r\n        rectUpdateWithRect(rect, containedRect);\r\n    }\r\n};\r\n\r\nvar applyCropRectAction = (cropRectPrevious, cropRectNext, imageSize, imageRotation, imagePerspective, cropLimitToImageBounds, cropMinSize, cropMaxSize) => {\r\n    // clone\r\n    const minSize = sizeClone(cropMinSize);\r\n    // set upper bounds to crop max size\r\n    const maxSize = sizeClone(cropMaxSize);\r\n    // limit max size (more important that min size is respected so first limit max size)\r\n    const maxScalar = fixPrecision(Math.max(cropRectNext.width / maxSize.width, cropRectNext.height / maxSize.height));\r\n    const minScalar = fixPrecision(Math.min(cropRectNext.width / minSize.width, cropRectNext.height / minSize.height));\r\n    // clone for resulting crop rect\r\n    const cropRectOut = rectClone$1(cropRectNext);\r\n    //\r\n    // if exceeds min or max scale correct next crop rectangle to conform to bounds\r\n    //\r\n    if (minScalar < 1 || maxScalar > 1) {\r\n        // center of both previous and next crop rects\r\n        const previousCropRectCenter = rectCenter(cropRectPrevious);\r\n        const nextCropRectCenter = rectCenter(cropRectNext);\r\n        // calculate scales\r\n        const scalar = minScalar < 1 ? minScalar : maxScalar;\r\n        const cx = (nextCropRectCenter.x + previousCropRectCenter.x) / 2;\r\n        const cy = (nextCropRectCenter.y + previousCropRectCenter.y) / 2;\r\n        const cw = cropRectOut.width / scalar;\r\n        const ch = cropRectOut.height / scalar;\r\n        rectUpdate(cropRectOut, cx - cw * 0.5, cy - ch * 0.5, cw, ch);\r\n    }\r\n    // no need to limit to bounds, let's go!\r\n    if (!cropLimitToImageBounds)\r\n        return {\r\n            crop: cropRectOut,\r\n        };\r\n    //\r\n    // make sure the crop is made inside the bounds of the image\r\n    //\r\n    limitRectToImage(cropRectOut, imageSize, imageRotation, imagePerspective, minSize);\r\n    return {\r\n        crop: cropRectOut,\r\n    };\r\n};\r\n\r\nvar getBaseCropRect = (imageSize, transformedCropRect, imageRotation) => {\r\n    const imageRect = rectCreateFromSize(imageSize);\r\n    const imageCenter = rectCenter(imageRect);\r\n    const imageTransformedVertices = rectRotate(imageRect, imageRotation, imageCenter);\r\n    // get the rotated image bounds center (offset isn't relevant as crop is relative to top left image position)\r\n    const imageRotatedBoundsCenter = rectCenter(rectNormalizeOffset(rectCreateFromPoints(imageTransformedVertices)));\r\n    // get the center of the crop inside the rotated image\r\n    const cropCenterInTransformedImage = rectCenter(transformedCropRect);\r\n    // invert the rotation of the crop center around the rotated image center\r\n    const deRotatedCropCenter = vectorRotate(cropCenterInTransformedImage, -imageRotation, imageRotatedBoundsCenter);\r\n    // calculate crop distance from rotated image center\r\n    const cropFromCenterOfTransformedImage = vectorSubtract(deRotatedCropCenter, imageRotatedBoundsCenter);\r\n    // calculate original crop offset (from untransformed image)\r\n    const originalCropCenterOffset = vectorApply(vectorAdd(imageCenter, cropFromCenterOfTransformedImage), fixPrecision);\r\n    return rectCreate(originalCropCenterOffset.x - transformedCropRect.width * 0.5, originalCropCenterOffset.y - transformedCropRect.height * 0.5, transformedCropRect.width, transformedCropRect.height);\r\n};\r\n\r\nvar clamp = (value, min, max) => Math.max(min, Math.min(value, max));\r\n\r\nvar applyRotationAction = (imageRotationPrevious, imageRotation, imageRotationRange, cropRect, imageSize, imagePerspective, cropLimitToImageBounds, cropRectOrigin, cropMinSize, cropMaxSize) => {\r\n    // clone\r\n    const minSize = sizeClone(cropMinSize);\r\n    // set upper bounds to crop max size if image is bigger than max size,\r\n    // else if should limit to image bounds use image size as limit\r\n    const maxSize = sizeClone(cropMaxSize);\r\n    if (cropLimitToImageBounds) {\r\n        maxSize.width = Math.min(cropMaxSize.width, imageSize.width);\r\n        maxSize.height = Math.min(cropMaxSize.height, imageSize.height);\r\n    }\r\n    let didAttemptDoubleTurn = false;\r\n    const rotate = (rotationPrevious, rotation) => {\r\n        // get the base crop rect (position of crop rect in untransformed image)\r\n        // if we have the base crop rect we can apply the new rotation to it\r\n        const cropRectBase = getBaseCropRect(imageSize, cropRect, rotationPrevious);\r\n        // calculate transforms based on new rotation and base crop rect\r\n        const imageRect = rectCreateFromSize(imageSize);\r\n        const imageCenter = rectCenter(imageRect);\r\n        const imageTransformedCorners = rectApplyPerspective(imageRect, imagePerspective, imageCenter);\r\n        // need this to correct for perspective centroid displacement\r\n        const perspectiveOffset = vectorSubtract(vectorClone(imageCenter), convexPolyCentroid(imageTransformedCorners));\r\n        // rotate around center of image\r\n        const cropCenter = vectorRotate(rectCenter(cropRectBase), rotation, imageCenter);\r\n        const rotateCropOffset = vectorSubtract(vectorClone(imageCenter), cropCenter);\r\n        // get center of image bounds and move to correct position\r\n        imageTransformedCorners.forEach((imageVertex) => vectorRotate(imageVertex, rotation, imageCenter));\r\n        const imageBoundsRect = rectCreateFromPoints(imageTransformedCorners);\r\n        const imageCentroid = convexPolyCentroid(imageTransformedCorners);\r\n        const cropOffset = vectorAdd(vectorSubtract(vectorSubtract(imageCentroid, rotateCropOffset), imageBoundsRect), perspectiveOffset);\r\n        // create output cropRect\r\n        const cropRectOut = rectCreate(cropOffset.x - cropRectBase.width * 0.5, cropOffset.y - cropRectBase.height * 0.5, cropRectBase.width, cropRectBase.height);\r\n        // if has size target, scale croprect to target size\r\n        if (cropRectOrigin) {\r\n            rectScale$1(cropRectOut, cropRectOrigin.width / cropRectOut.width);\r\n        }\r\n        // if should limit to image bounds\r\n        if (cropLimitToImageBounds) {\r\n            const imagePoly = getImagePolygon(imageSize, rotation, imagePerspective);\r\n            // offsetRectToFitPolygon(cropRectOut, imagePoly);\r\n            // commenting this fixes poly sliding problem when adjusting rotation\r\n            limitCropRectToImage(cropRectOut, imagePoly);\r\n        }\r\n        //#region if exceeds min or max adjust rotation to conform to bounds\r\n        const minScalar = fixPrecision(Math.min(cropRectOut.width / minSize.width, cropRectOut.height / minSize.height), 8);\r\n        const maxScalar = fixPrecision(Math.max(cropRectOut.width / maxSize.width, cropRectOut.height / maxSize.height), 8);\r\n        if (minScalar < 1 || maxScalar > 1) {\r\n            // determine if is full image turn\r\n            const isTurn = fixPrecision(Math.abs(rotation - rotationPrevious)) === fixPrecision(Math.PI / 2);\r\n            // try another turn if is turning image\r\n            if (isTurn && !didAttemptDoubleTurn) {\r\n                didAttemptDoubleTurn = true;\r\n                return rotate(imageRotationPrevious, imageRotationPrevious + Math.sign(rotation - rotationPrevious) * Math.PI);\r\n            }\r\n        }\r\n        //#endregion\r\n        return {\r\n            rotation,\r\n            crop: rectApply(cropRectOut, (v) => fixPrecision(v, 8)),\r\n        };\r\n    };\r\n    // amount of turns applied, we need this to correctly determine the allowed rotation range\r\n    const imageTurns = Math.sign(imageRotation) * Math.round(Math.abs(imageRotation) / HALF_PI) * HALF_PI;\r\n    const imageRotationClamped = clamp(imageRotation, imageTurns + imageRotationRange[0], imageTurns + imageRotationRange[1]);\r\n    // set new crop position\r\n    return rotate(imageRotationPrevious, imageRotationClamped);\r\n};\r\n\r\n// @ts-ignore\r\nconst ORDERED_STATE_PROPS = [\r\n    // requirements\r\n    'cropLimitToImage',\r\n    'cropMinSize',\r\n    'cropMaxSize',\r\n    'cropAspectRatio',\r\n    // selection -> flip -> rotate -> (perspective ->) crop\r\n    'flipX',\r\n    'flipY',\r\n    'rotation',\r\n    'crop',\r\n    // effects\r\n    'colorMatrix',\r\n    'convolutionMatrix',\r\n    'gamma',\r\n    'vignette',\r\n    // 'noise',\r\n    // shapes\r\n    'redaction',\r\n    'annotation',\r\n    'decoration',\r\n    'frame',\r\n    // other\r\n    'backgroundColor',\r\n    'backgroundImage',\r\n    'targetSize',\r\n    'metadata',\r\n    // video\r\n    'trim',\r\n];\r\nconst clone = (value) => {\r\n    if (isArray(value)) {\r\n        return value.map(clone);\r\n    }\r\n    else if (isBlob(value) || isFile(value)) {\r\n        return value;\r\n    }\r\n    else if (isObject(value)) {\r\n        return { ...value };\r\n    }\r\n    return value;\r\n};\r\nconst filterShapeState = (shapes) => shapes.map((shape) => Object.entries(shape).reduce((copy, [key, value]) => {\r\n    if (key.startsWith('_'))\r\n        return copy;\r\n    copy[key] = value;\r\n    return copy;\r\n}, {}));\r\nvar stateStore = (_, stores, accessors) => {\r\n    const observedStores = ORDERED_STATE_PROPS.map((key) => stores[key]);\r\n    // used to wait with deriving state until new state is fully assigned\r\n    let isAssigningState = false;\r\n    const forceState = writable({});\r\n    // can only subscribe, setting is done directly through store accessors\r\n    // @ts-ignore (fixes error thrown in karma typescript)\r\n    const { subscribe } = derived([...observedStores, forceState], (values, set) => {\r\n        // is setting state\r\n        if (isAssigningState)\r\n            return;\r\n        // create new state by looping over props in certain order\r\n        const state = ORDERED_STATE_PROPS.reduce((prev, curr, i) => {\r\n            prev[curr] = clone(values[i]);\r\n            return prev;\r\n        }, {});\r\n        // round crop if defined\r\n        state.crop && rectApply(state.crop, Math.round);\r\n        // remove internal state props from decoration and annotation\r\n        state.redaction = state.redaction && filterShapeState(state.redaction);\r\n        state.annotation = state.annotation && filterShapeState(state.annotation);\r\n        state.decoration = state.decoration && filterShapeState(state.decoration);\r\n        // set new state\r\n        set(state);\r\n    });\r\n    const setState = (state) => {\r\n        // requires at least some state to be supplied\r\n        if (!state)\r\n            return;\r\n        // now assigning state so don't derive state object untill done\r\n        isAssigningState = true;\r\n        // make sure crop origin is reset\r\n        accessors.cropOrigin = undefined;\r\n        // apply new values\r\n        ORDERED_STATE_PROPS\r\n            // remove keys that weren't set\r\n            .filter((key) => hasProp(state, key))\r\n            // apply each key in order\r\n            .forEach((key) => {\r\n            const value = state[key];\r\n            accessors[key] = value === null ? undefined : clone(value);\r\n        });\r\n        // now refresh state\r\n        isAssigningState = false;\r\n        forceState.set({});\r\n    };\r\n    return {\r\n        set: setState,\r\n        update: (fn) => setState(fn(null)),\r\n        subscribe,\r\n    };\r\n};\r\n\r\nvar toNumericAspectRatio = (v) => {\r\n    if (!v)\r\n        return undefined;\r\n    if (/:/.test(v)) {\r\n        const [w, h] = v.split(':');\r\n        return w / h;\r\n    }\r\n    return parseFloat(v);\r\n};\r\n\r\nvar arrayEqual = (a, b) => {\r\n    if (a.length !== b.length)\r\n        return false;\r\n    for (let i = 0; i < a.length; i++) {\r\n        if (a[i] !== b[i])\r\n            return false;\r\n    }\r\n    return true;\r\n};\r\n\r\nvar padColorArray = (color = [0, 0, 0, 0], opacity = 1.0) => color.length === 4 ? color : [...color, opacity];\r\n\r\n//\r\n// helper methods\r\n//\r\nconst isCropCentered = (crop, imageSize, imageRotation) => {\r\n    const cropCenter = vectorApply(rectCenter(crop), (v) => fixPrecision(v, 8));\r\n    const imageRect = rectCreateFromSize(imageSize);\r\n    const imageCenter = rectCenter(imageRect);\r\n    const imageRotatedVertices = rectRotate(imageRect, imageRotation, imageCenter);\r\n    const imageBoundsCenter = vectorApply(sizeCenter(rectCreateFromPoints(imageRotatedVertices)), (v) => fixPrecision(v, 8));\r\n    const dx = Math.abs(imageBoundsCenter.x - cropCenter.x);\r\n    const dy = Math.abs(imageBoundsCenter.y - cropCenter.y);\r\n    return dx < 1 && dy < 1;\r\n};\r\nconst isCropMaxSize = (cropRect, imageSize, rotation) => {\r\n    const maxSize = getMaxSizeInRect(imageSize, rotation, rectAspectRatio(cropRect));\r\n    return sizeEqual(sizeApply(maxSize, Math.round), sizeApply(sizeClone(cropRect), Math.round));\r\n};\r\n//\r\n// updater methods\r\n//\r\nconst updateCropRect = (props) => (cropNext, cropPrevious = cropNext) => {\r\n    // wait for image to load\r\n    const { loadState, size, cropMinSize, cropMaxSize, cropLimitToImage, cropAspectRatio, rotation, perspective, } = props;\r\n    // image hasn't loaded yet, use supplied crop rect\r\n    if ((!cropNext && !cropPrevious) || !loadState || !loadState.beforeComplete)\r\n        return cropNext;\r\n    // crop previous set, crop next set to undefined, set crop to fit image\r\n    if (!cropNext)\r\n        cropNext = rectCreateFromSize(getMaxSizeInRect(size, rotation, cropAspectRatio || rectAspectRatio(size)));\r\n    // apply the action\r\n    const res = applyCropRectAction(cropPrevious, cropNext, size, rotation, perspective, cropLimitToImage, cropMinSize, cropMaxSize);\r\n    const cropOut = rectApply(res.crop, (v) => fixPrecision(v, 8));\r\n    if (rectEqual(cropPrevious, cropOut))\r\n        return cropPrevious;\r\n    return cropOut;\r\n};\r\nconst updateCropAspectRatio = (props) => (aspectRatioNext, aspectRatioPrevious) => {\r\n    const { loadState, crop, size, rotation, cropLimitToImage } = props;\r\n    const aspectRatio = toNumericAspectRatio(aspectRatioNext);\r\n    // no aspect ratio means custom aspect ratio so set to undefined\r\n    if (!aspectRatio)\r\n        return undefined;\r\n    // can't update crop if not defined yet\r\n    if (!crop || !loadState || !loadState.beforeComplete)\r\n        return aspectRatio;\r\n    // calculate difference between aspect ratios, if big difference, re-align in image\r\n    const aspectRatioDist = aspectRatioPrevious\r\n        ? Math.abs(aspectRatioNext - aspectRatioPrevious)\r\n        : 1;\r\n    // if crop centered scale up\r\n    if (isCropCentered(crop, size, rotation) && cropLimitToImage && aspectRatioDist >= 0.1) {\r\n        const imageSize = sizeTurn(sizeClone(size), rotation);\r\n        props.crop = rectApply(rectContainRect(rectCreateFromSize(imageSize), aspectRatioNext), fixPrecision);\r\n    }\r\n    else {\r\n        const cropSize = {\r\n            width: crop.height * aspectRatio,\r\n            height: crop.height,\r\n        };\r\n        const tx = (crop.width - cropSize.width) * 0.5;\r\n        const ty = (crop.height - cropSize.height) * 0.5;\r\n        props.crop = rectApply(rectCreate(crop.x + tx, crop.y + ty, cropSize.width, cropSize.height), fixPrecision);\r\n    }\r\n    return aspectRatio;\r\n};\r\nconst updateCropLimitToImage = (props) => (limitToImageNext, limitToImagePrevious, onUpdate) => {\r\n    // skip if no crop defined\r\n    const { crop } = props;\r\n    if (!crop)\r\n        return limitToImageNext;\r\n    // if was not limiting previously and now set limiting make sure crop fits bounds\r\n    if (!limitToImagePrevious && limitToImageNext) {\r\n        onUpdate(() => (props.crop = rectClone$1(props.crop)));\r\n    }\r\n    return limitToImageNext;\r\n};\r\nconst updateRotation = (props) => (rotationNext, rotationPrevious, onUpdate) => {\r\n    // when image rotation is updated we need to adjust the\r\n    // cropRect offset so rotation happens from cropRect center\r\n    // no change\r\n    if (rotationNext === rotationPrevious)\r\n        return rotationNext;\r\n    // get relevant data from store state\r\n    const { loadState, size, rotationRange, cropMinSize, cropMaxSize, crop, perspective, cropLimitToImage, cropOrigin, } = props;\r\n    // image not ready, exit!\r\n    if (!crop || !loadState || !loadState.beforeComplete)\r\n        return rotationNext;\r\n    // remember if current crop was at max size and centered, if so, resulting crop should also be at max size\r\n    const cropWasAtMaxSize = cropLimitToImage && isCropMaxSize(crop, size, rotationPrevious);\r\n    const cropWasCentered = cropLimitToImage && isCropCentered(crop, size, rotationPrevious);\r\n    // get new state\r\n    const res = applyRotationAction(rotationPrevious, rotationNext, rotationRange, crop, size, perspective, cropLimitToImage, cropOrigin, cropMinSize, cropMaxSize);\r\n    // if is centered, and initial crop was at max size expand crop to max size\r\n    if (cropWasAtMaxSize && cropWasCentered) {\r\n        const rect = getMaxSizeInRect(size, rotationNext, rectAspectRatio(res.crop));\r\n        // move top left corner\r\n        res.crop.x += res.crop.width * 0.5;\r\n        res.crop.y += res.crop.height * 0.5;\r\n        res.crop.x -= rect.width * 0.5;\r\n        res.crop.y -= rect.height * 0.5;\r\n        // update size to max size\r\n        res.crop.width = rect.width;\r\n        res.crop.height = rect.height;\r\n    }\r\n    // return validated rotation value, then, after we assign that value, we update the crop rect\r\n    // we may only call onUpdate if a change was made\r\n    onUpdate(() => {\r\n        props.crop = rectApply(res.crop, (v) => fixPrecision(v, 8));\r\n    });\r\n    // return result rotation (might have been rotated twice to fit crop rectangle)\r\n    return res.rotation;\r\n};\r\n// updates the range of valid rotation input\r\nconst updateRotationRange = (imageSize, imageIsRotatedSideways, cropMinSize, cropSize, cropLimitToImage) => {\r\n    if (!cropLimitToImage)\r\n        return [-Infinity, Infinity];\r\n    /*\r\n    - 'a' is angle between diagonal and image height\r\n    - 'b' is angle between diagonal and crop height\r\n    - 'c' is angle between diagonal and image width\r\n    - resulting range is then a - b\r\n    +----------/\\------------------------+\r\n    |         / \\ \\                      |\r\n    |        /   \\  \\                    |\r\n    |       /     \\   \\                  |\r\n    |       \\      \\    \\                |\r\n    |         \\     \\     \\              |\r\n    |           \\    \\      \\            |\r\n    |             \\   \\       /          |\r\n    |               \\  \\     /           |\r\n    |                 \\ \\   /            |\r\n    |                   \\\\a/b            |\r\n    +---------------------\\--------------+\r\n    */\r\n    const scalar = Math.max(cropMinSize.width / cropSize.width, cropMinSize.height / cropSize.height);\r\n    const minSize = sizeCreate(cropSize.width * scalar, cropSize.height * scalar);\r\n    // the hypotenus is the length of the diagonal of the min crop size\r\n    const requiredSpace = sizeHypotenuse(minSize);\r\n    // minimum space available in horizontal / vertical direction\r\n    const availableSpace = Math.min(imageSize.width, imageSize.height);\r\n    // if there's enough space available, we can return the max range\r\n    if (requiredSpace < availableSpace)\r\n        return [-Infinity, Infinity];\r\n    // if the image is turned we need to swap the width and height\r\n    const imageWidth = imageIsRotatedSideways ? imageSize.height : imageSize.width;\r\n    const imageHeight = imageIsRotatedSideways ? imageSize.width : imageSize.height;\r\n    // subtracting the angle between the hypotenuse and the crop itself\r\n    const a = Math.acos(minSize.height / requiredSpace);\r\n    const b = Math.acos(imageHeight / requiredSpace);\r\n    const c = Math.asin(imageWidth / requiredSpace);\r\n    const rangeHorizontal = a - b;\r\n    const rangeVertical = c - a;\r\n    // range is not a number, it means we can rotate as much as we want\r\n    if (Number.isNaN(rangeHorizontal) && Number.isNaN(rangeVertical))\r\n        return [-Infinity, Infinity];\r\n    // get minimum range\r\n    const range = Number.isNaN(rangeHorizontal)\r\n        ? rangeVertical\r\n        : Number.isNaN(rangeVertical)\r\n            ? rangeHorizontal\r\n            : Math.min(rangeHorizontal, rangeVertical);\r\n    // if not, limit range to min and max rotation\r\n    return [-range, range];\r\n};\r\n// updates the range of valid crop rectangle input\r\nconst updateCropRange = (imageSize, rotation, cropAspectRatio, cropMinSize, cropMaxSize, cropLimitToImage) => {\r\n    // ! rotation doesn't affect min size, only max size\r\n    // set lower bounds to crop min size\r\n    const minSize = sizeClone(cropMinSize);\r\n    // set upper bounds to crop max size\r\n    const maxSize = sizeClone(cropMaxSize);\r\n    // now we got basic bounds, let's see if we should limit to the image bounds, else we done\r\n    if (!cropLimitToImage)\r\n        return [minSize, maxSize];\r\n    return [minSize, sizeApply(getMaxSizeInRect(imageSize, rotation, cropAspectRatio), Math.round)];\r\n};\r\nconst formatShape = (shape, options) => {\r\n    const { context, props } = options;\r\n    // only auto-format once\r\n    if (!shape._isFormatted) {\r\n        shape = shapeFormat(shape);\r\n        shape._isFormatted = true;\r\n        Object.assign(shape, props);\r\n    }\r\n    // we need to make sure shape is still correctly positioned relative to parent context\r\n    // draft cannot be relative\r\n    // if context changed\r\n    // if has left top right or bottom\r\n    if (!shape._isDraft &&\r\n        shapeHasRelativeSize(shape) &&\r\n        (!shape._context || !rectEqual(context, shape._context))) {\r\n        shapeComputeRect(shape, context);\r\n        shape._context = { ...context };\r\n    }\r\n    return shape;\r\n};\r\nconst updateFrame = () => (frameShapeNext) => {\r\n    if (!frameShapeNext)\r\n        return;\r\n    const shape = {\r\n        frameStyle: undefined,\r\n        x: 0,\r\n        y: 0,\r\n        width: '100%',\r\n        height: '100%',\r\n        disableStyle: ['backgroundColor', 'strokeColor', 'strokeWidth'],\r\n    };\r\n    if (isString(frameShapeNext)) {\r\n        shape.frameStyle = frameShapeNext;\r\n    }\r\n    else {\r\n        Object.assign(shape, frameShapeNext);\r\n    }\r\n    return shape;\r\n};\r\nvar ImageStorePropDescriptors = [\r\n    // media info received from read\r\n    ['file'],\r\n    ['size'],\r\n    // loading and processing state\r\n    ['loadState'],\r\n    ['processState'],\r\n    // derived info\r\n    [\r\n        'aspectRatio',\r\n        DERIVED_STORE(({ size }) => [\r\n            size,\r\n            ($size) => ($size ? rectAspectRatio($size) : undefined),\r\n        ]),\r\n    ],\r\n    // image modifications\r\n    ['perspectiveX', DEFAULT_VALUE(() => 0)],\r\n    ['perspectiveY', DEFAULT_VALUE(() => 0)],\r\n    [\r\n        'perspective',\r\n        DERIVED_STORE(({ perspectiveX, perspectiveY }) => [\r\n            [perspectiveX, perspectiveY],\r\n            ([x, y]) => ({ x, y }),\r\n        ]),\r\n    ],\r\n    ['rotation', DEFAULT_VALUE(() => 0), UPDATE_VALUE(updateRotation)],\r\n    ['flipX', DEFAULT_VALUE(() => false)],\r\n    ['flipY', DEFAULT_VALUE(() => false)],\r\n    ['flip', DERIVED_STORE(({ flipX, flipY }) => [[flipX, flipY], ([x, y]) => ({ x, y })])],\r\n    [\r\n        'isRotatedSideways',\r\n        UNIQUE_DERIVED_STORE(({ rotation }) => [\r\n            [rotation],\r\n            ([$rotation], set) => set(isRotatedSideways($rotation)),\r\n            (prevValue, nextValue) => prevValue !== nextValue,\r\n        ]),\r\n    ],\r\n    ['crop', UPDATE_VALUE(updateCropRect)],\r\n    ['cropAspectRatio', UPDATE_VALUE(updateCropAspectRatio)],\r\n    ['cropOrigin'],\r\n    ['cropMinSize', DEFAULT_VALUE(() => ({ width: 1, height: 1 }))],\r\n    ['cropMaxSize', DEFAULT_VALUE(() => ({ width: 32768, height: 32768 }))],\r\n    ['cropLimitToImage', DEFAULT_VALUE(() => true), UPDATE_VALUE(updateCropLimitToImage)],\r\n    [\r\n        'cropSize',\r\n        UNIQUE_DERIVED_STORE(({ crop }) => [\r\n            [crop],\r\n            ([$crop], set) => {\r\n                if (!$crop)\r\n                    return;\r\n                set(sizeCreate($crop.width, $crop.height));\r\n            },\r\n            // if is same as previous size, don't trigger update (happens when updating only the crop offset)\r\n            (prevValue, nextValue) => sizeEqual(prevValue, nextValue),\r\n        ]),\r\n    ],\r\n    [\r\n        'cropRectAspectRatio',\r\n        DERIVED_STORE(({ cropSize }) => [\r\n            [cropSize],\r\n            ([$cropSize], set) => {\r\n                if (!$cropSize)\r\n                    return;\r\n                set(fixPrecision(rectAspectRatio($cropSize), 5));\r\n            },\r\n        ]),\r\n    ],\r\n    [\r\n        'cropRange',\r\n        UNIQUE_DERIVED_STORE(({ size, rotation, cropRectAspectRatio, cropMinSize, cropMaxSize, cropLimitToImage, }) => [\r\n            [size, rotation, cropRectAspectRatio, cropMinSize, cropMaxSize, cropLimitToImage],\r\n            ([$size, $rotation, $cropRectAspectRatio, $cropMinSize, $cropMaxSize, $cropLimitToImage,], set) => {\r\n                // wait for image size\r\n                if (!$size)\r\n                    return;\r\n                const range = updateCropRange($size, $rotation, $cropRectAspectRatio, $cropMinSize, $cropMaxSize, $cropLimitToImage);\r\n                set(range);\r\n            },\r\n            // if is same range as previous range, don't trigger update\r\n            (prevRange, nextRange) => arrayEqual(prevRange, nextRange),\r\n        ]),\r\n    ],\r\n    [\r\n        'rotationRange',\r\n        UNIQUE_DERIVED_STORE(({ size, isRotatedSideways, cropMinSize, cropSize, cropLimitToImage }) => [\r\n            [size, isRotatedSideways, cropMinSize, cropSize, cropLimitToImage],\r\n            ([$size, $isRotatedSideways, $cropMinSize, $cropSize, $cropLimitToImage], set) => {\r\n                // wait for image size\r\n                if (!$size || !$cropSize)\r\n                    return;\r\n                const range = updateRotationRange($size, $isRotatedSideways, $cropMinSize, $cropSize, $cropLimitToImage);\r\n                set(range);\r\n            },\r\n            // if is same range as previous range, don't trigger update\r\n            (prevRange, nextRange) => arrayEqual(prevRange, nextRange),\r\n        ]),\r\n    ],\r\n    // canvas\r\n    ['backgroundColor', UPDATE_VALUE(() => (color) => padColorArray(color))],\r\n    ['backgroundImage'],\r\n    // size\r\n    ['targetSize'],\r\n    // effects\r\n    ['colorMatrix'],\r\n    ['convolutionMatrix'],\r\n    ['gamma'],\r\n    ['noise'],\r\n    ['vignette'],\r\n    // media\r\n    ['duration'],\r\n    ['trim'],\r\n    // ['speed'], // undefined | 1\r\n    // ['audio'], // undefined | false to remove\r\n    // redaction lives in image space\r\n    ['redaction', MAP_STORE(({ size }) => [formatShape, { context: size }])],\r\n    // annotation lives in image space\r\n    ['annotation', MAP_STORE(({ size }) => [formatShape, { context: size }])],\r\n    // decoration lives in crop space\r\n    ['decoration', MAP_STORE(({ crop }) => [formatShape, { context: crop }])],\r\n    // frame to render on top of the image (or outside)\r\n    ['frame', UPDATE_VALUE(updateFrame)],\r\n    // custom metadata\r\n    ['metadata'],\r\n    // state of image, used to restore a previous state or request the current state\r\n    ['state', CUSTOM_STORE(stateStore)],\r\n];\r\n\r\nvar process = async (value, chainTasks, chainOptions = {}, processOptions) => {\r\n    // options relevant to the process method itself\r\n    const { ontaskstart, ontaskprogress, ontaskend, token } = processOptions;\r\n    // has been cancelled\r\n    let cancelled = false;\r\n    // set cancel handler method\r\n    token.cancel = () => {\r\n        // cancel called from outside of the process method\r\n        cancelled = true;\r\n    };\r\n    // step through chain\r\n    for (const [index, task] of chainTasks.entries()) {\r\n        // exit when cancelled\r\n        if (cancelled)\r\n            return;\r\n        // get the task function and the id so we can notify the callee of the task that is being started\r\n        const [fn, id] = task;\r\n        // start task\r\n        ontaskstart(index, id);\r\n        try {\r\n            value = await fn(value, { ...chainOptions }, (event) => ontaskprogress(index, id, event));\r\n        }\r\n        catch (err) {\r\n            // stop processing more items in the chain\r\n            cancelled = true;\r\n            // pass error back to parent\r\n            throw err;\r\n        }\r\n        ontaskend(index, id);\r\n    }\r\n    return value;\r\n};\r\n\r\n// TODO: find better location for minSize / file load validation\r\nvar createImageCore = ({ minSize = { width: 1, height: 1 } } = {}) => {\r\n    // create default store\r\n    const { stores, accessors } = createStores(ImageStorePropDescriptors);\r\n    // pub/sub\r\n    const { pub, sub } = pubsub();\r\n    // processing handler\r\n    const createProcessingHandler = (stateProp, eventKey) => {\r\n        const getStore = () => accessors[stateProp] || {};\r\n        const setStore = (obj) => (accessors[stateProp] = {\r\n            ...getStore(),\r\n            ...obj,\r\n            timeStamp: Date.now(),\r\n        });\r\n        const hasError = () => getStore().error;\r\n        const handleError = (error) => {\r\n            if (hasError())\r\n                return;\r\n            setStore({\r\n                error: error,\r\n            });\r\n            pub(`${eventKey}error`, { ...getStore() });\r\n        };\r\n        return {\r\n            start() {\r\n                pub(`${eventKey}start`);\r\n            },\r\n            onabort() {\r\n                setStore({\r\n                    abort: true,\r\n                });\r\n                pub(`${eventKey}abort`, { ...getStore() });\r\n            },\r\n            ontaskstart(index, id) {\r\n                if (hasError())\r\n                    return;\r\n                setStore({\r\n                    index,\r\n                    task: id,\r\n                    taskProgress: undefined,\r\n                    taskLengthComputable: undefined,\r\n                });\r\n                pub(`${eventKey}taskstart`, { ...getStore() });\r\n            },\r\n            ontaskprogress(index, id, event) {\r\n                if (hasError())\r\n                    return;\r\n                setStore({\r\n                    index,\r\n                    task: id,\r\n                    taskProgress: event.loaded / event.total,\r\n                    taskLengthComputable: event.lengthComputable,\r\n                });\r\n                pub(`${eventKey}taskprogress`, { ...getStore() });\r\n                pub(`${eventKey}progress`, { ...getStore() });\r\n            },\r\n            ontaskend(index, id) {\r\n                if (hasError())\r\n                    return;\r\n                setStore({\r\n                    index,\r\n                    task: id,\r\n                });\r\n                pub(`${eventKey}taskend`, { ...getStore() });\r\n            },\r\n            ontaskerror(error) {\r\n                handleError(error);\r\n            },\r\n            error(error) {\r\n                handleError(error);\r\n            },\r\n            beforeComplete(data) {\r\n                if (hasError())\r\n                    return;\r\n                setStore({ beforeComplete: true });\r\n                pub(`before${eventKey}`, data);\r\n            },\r\n            complete(data) {\r\n                if (hasError())\r\n                    return;\r\n                setStore({ complete: true });\r\n                pub(eventKey, data);\r\n            },\r\n        };\r\n    };\r\n    //#region read image\r\n    const read = (src, { reader }, readerOptions = {}) => {\r\n        // exit if no reader supplied\r\n        if (!reader)\r\n            return;\r\n        // reset file data to undefined as we're loading a new image\r\n        Object.assign(accessors, {\r\n            file: undefined,\r\n            size: undefined,\r\n            loadState: undefined,\r\n        });\r\n        // our cancel token so we can abort load if needed, cancel will be set by process\r\n        let imageReadToken = { cancel: noop$1 };\r\n        let imageReadCancelled = false;\r\n        const imageReadHandler = createProcessingHandler('loadState', 'load');\r\n        const processOptions = {\r\n            token: imageReadToken,\r\n            ...imageReadHandler,\r\n        };\r\n        const readerState = {\r\n            src,\r\n            size: undefined,\r\n            dest: undefined,\r\n            duration: undefined,\r\n        };\r\n        // wait a tick before starting image read so the read can be cancelled in loadstart\r\n        Promise.resolve().then(async () => {\r\n            try {\r\n                imageReadHandler.start();\r\n                if (imageReadCancelled)\r\n                    return imageReadHandler.onabort();\r\n                const output = (await process(readerState, reader, readerOptions, processOptions));\r\n                // was cancelled\r\n                if (imageReadCancelled)\r\n                    return imageReadHandler.onabort();\r\n                // get shortcuts for validation\r\n                const { size, duration, dest } = output || {};\r\n                // if we don't have a size\r\n                if (!size || !size.width || !size.height)\r\n                    throw new EditorError('Image size missing', 'IMAGE_SIZE_MISSING', output);\r\n                // size of image is too small\r\n                if (size.width < minSize.width || size.height < minSize.height)\r\n                    throw new EditorError('Image too small', 'IMAGE_TOO_SMALL', {\r\n                        ...output,\r\n                        minWidth: minSize.width,\r\n                        minHeight: minSize.height,\r\n                    });\r\n                // update internal data\r\n                Object.assign(accessors, {\r\n                    file: dest,\r\n                    size,\r\n                    duration,\r\n                });\r\n                // before load complete\r\n                imageReadHandler.beforeComplete(output);\r\n                // done loading image\r\n                imageReadHandler.complete(output);\r\n            }\r\n            catch (err) {\r\n                imageReadHandler.error(err);\r\n            }\r\n            finally {\r\n                imageReadToken = undefined;\r\n            }\r\n        });\r\n        // call to abort load\r\n        return () => {\r\n            imageReadCancelled = true;\r\n            imageReadToken && imageReadToken.cancel();\r\n            imageReadHandler.onabort();\r\n        };\r\n    };\r\n    //#endregion\r\n    //#region write image\r\n    const write = (writer, options) => {\r\n        // not ready to start processing\r\n        if (!accessors.loadState.complete)\r\n            return;\r\n        // reset process state to undefined\r\n        accessors.processState = undefined;\r\n        const imageWriteHandler = createProcessingHandler('processState', 'process');\r\n        const writerState = {\r\n            src: accessors.file,\r\n            imageState: accessors.state,\r\n            dest: undefined,\r\n        };\r\n        // writer is function, let's get the actual writer\r\n        if (isFunction(writer))\r\n            writer = writer(accessors.file, accessors.state);\r\n        // willProcessImageState\r\n        if (!writer) {\r\n            imageWriteHandler.start();\r\n            imageWriteHandler.complete(writerState);\r\n            return;\r\n        }\r\n        // we need this token to be a blet to cancel the processing operation\r\n        let imageWriteToken = { cancel: noop$1 };\r\n        let imageWriteCancelled = false;\r\n        const writerOptions = options;\r\n        const processOptions = {\r\n            token: imageWriteToken,\r\n            ...imageWriteHandler,\r\n        };\r\n        // wait a tick before starting image write so the write can be cancelled in processtart\r\n        Promise.resolve().then(async () => {\r\n            try {\r\n                imageWriteHandler.start();\r\n                if (imageWriteCancelled)\r\n                    return imageWriteHandler.onabort();\r\n                const output = (await process(writerState, writer, writerOptions, processOptions));\r\n                imageWriteHandler.complete(output);\r\n            }\r\n            catch (err) {\r\n                imageWriteHandler.error(err);\r\n            }\r\n            finally {\r\n                imageWriteToken = undefined;\r\n            }\r\n        });\r\n        // call to abort processing\r\n        return () => {\r\n            imageWriteCancelled = true;\r\n            imageWriteToken && imageWriteToken.cancel();\r\n        };\r\n    };\r\n    //#endregion\r\n    //#region api\r\n    defineMethods(accessors, {\r\n        read,\r\n        write,\r\n        on: sub,\r\n    });\r\n    //#endregion\r\n    // expose store API\r\n    return {\r\n        accessors,\r\n        stores,\r\n    };\r\n};\r\n\r\n// @ts-ignore\r\nconst editorEventsToBubble = [\r\n    'loadstart',\r\n    'loadabort',\r\n    'loaderror',\r\n    'loadprogress',\r\n    'load',\r\n    'processstart',\r\n    'processabort',\r\n    'processerror',\r\n    'processprogress',\r\n    'process',\r\n];\r\nconst imagePrivateProps = [\r\n    'flip',\r\n    'cropOrigin',\r\n    'isRotatedSideways',\r\n    'perspective',\r\n    'perspectiveX',\r\n    'perspectiveY',\r\n    'cropRange',\r\n];\r\nconst editorPrivateProps = ['images'];\r\nconst imagePublicProps = ImageStorePropDescriptors\r\n    .map(([prop]) => prop)\r\n    .filter((prop) => !imagePrivateProps.includes(prop));\r\nconst getImagePropGroupedName = (prop) => `image${capitalizeFirstLetter(prop)}`;\r\nconst getEditorProps$1 = () => {\r\n    const imageProperties = imagePublicProps.map(getImagePropGroupedName);\r\n    const editorProperties = props\r\n        .map(([prop]) => prop)\r\n        .filter((prop) => !editorPrivateProps.includes(prop));\r\n    return imageProperties.concat(editorProperties);\r\n};\r\nconst isImageSource = (src) => isString(src) || isBinary(src) || isElement(src);\r\nconst isImageState = (obj) => hasProp(obj, 'crop');\r\nvar createImageEditor = () => {\r\n    // create default stores\r\n    const { stores, accessors } = createStores(props);\r\n    // set up pub/sub for the app layer\r\n    const { sub, pub } = pubsub();\r\n    const bubble = (name) => (value) => pub(name, value);\r\n    // helper method\r\n    const getImageObjSafe = () => (accessors.images ? accessors.images[0] : {});\r\n    // initialImageProps is the list of transforms to apply when the image loads\r\n    let initialImageProps = {};\r\n    const initialImagePropsBackup = {};\r\n    // create shortcuts to image props : `crop` -> `imageCrop`\r\n    imagePublicProps.forEach((prop) => {\r\n        Object.defineProperty(accessors, getImagePropGroupedName(prop), {\r\n            get: () => {\r\n                // no image, can't get\r\n                const image = getImageObjSafe();\r\n                if (!image)\r\n                    return;\r\n                // return from image state\r\n                return image.accessors[prop];\r\n            },\r\n            set: (value) => {\r\n                // always use as initial prop when loading a new image without reset\r\n                initialImageProps[getImagePropGroupedName(prop)] = value;\r\n                // set to props backup so we can read it later when loading a new image\r\n                initialImagePropsBackup[getImagePropGroupedName(prop)] = value;\r\n                // no image, we can't update\r\n                const image = getImageObjSafe();\r\n                if (!image)\r\n                    return;\r\n                // update the image immidiately\r\n                image.accessors[prop] = value;\r\n            },\r\n        });\r\n    });\r\n    // internal helper method to get active image\r\n    const getImage = () => accessors.images && accessors.images[0];\r\n    // handling loading an image if a src is set\r\n    const unsubSrc = stores.src.subscribe((src) => {\r\n        // no image set, means clear active image\r\n        if (!src)\r\n            return (accessors.images = []);\r\n        // exit here if we don't have an imageReader we'll wait for an imageReader to be defined\r\n        if (!accessors.imageReader)\r\n            return;\r\n        // reset initial image props if an image is already loaded, so props applied to previous image aren't applied to the new one\r\n        if (accessors.images.length)\r\n            initialImageProps = {};\r\n        // load image in src prop\r\n        loadSrc(src);\r\n    });\r\n    const unsubReader = stores.imageReader.subscribe((reader) => {\r\n        // can't do anything without an image reader\r\n        if (!reader)\r\n            return;\r\n        // an image has already been loaded no need to load images that were set earlier\r\n        if (accessors.images.length)\r\n            return;\r\n        // no image to load, we'll wait for images to be set to the `src` prop\r\n        if (!accessors.src)\r\n            return;\r\n        // src is waiting to be loaded so let's pick it up,\r\n        loadSrc(accessors.src);\r\n    });\r\n    const loadSrc = (src) => {\r\n        // push it back a tick so we know initialImageProps are set\r\n        Promise.resolve()\r\n            .then(() => {\r\n            // load with initial props\r\n            return loadImage(src, initialImageProps);\r\n        })\r\n            .catch(() => {\r\n            // fail silently, any errors are handled with 'loaderror' event\r\n        });\r\n    };\r\n    //#endregion\r\n    //#region public method (note that these are also called from UI, name of method is name of dispatched event in UI)\r\n    const applyImageOptionsOrState = (image, options) => {\r\n        // test if options is image state, if so, apply and exit\r\n        if (isImageState(options)) {\r\n            accessors.imageState = options;\r\n            return;\r\n        }\r\n        // create an initial crop rect if no crop supplied\r\n        if (!options.imageCrop) {\r\n            const imageSize = image.accessors.size;\r\n            const imageRotation = options.imageRotation || 0;\r\n            const imageRotatedSize = sizeRotate(sizeClone(imageSize), imageRotation);\r\n            const cropRect = rectCreateFromSize(imageRotatedSize);\r\n            // prevent negative width/height\r\n            cropRect.width = fixPrecision(Math.abs(cropRect.width), 6);\r\n            cropRect.height = fixPrecision(Math.abs(cropRect.height), 6);\r\n            const aspectRatio = options.imageCropAspectRatio ||\r\n                (options.imageCropLimitToImage\r\n                    ? rectAspectRatio(imageSize) // use image size if should limit to image\r\n                    : rectAspectRatio(cropRect)); // use rotated crop rect bounds if no limit\r\n            let crop;\r\n            if (options.imageCropLimitToImage) {\r\n                crop = rectContainRect(cropRect, aspectRatio);\r\n            }\r\n            else {\r\n                crop = rectCoverRect(cropRect, aspectRatio);\r\n                // center the image in the crop rectangle\r\n                crop.x = (imageSize.width - crop.width) / 2;\r\n                crop.y = (imageSize.height - crop.height) / 2;\r\n            }\r\n            options.imageCrop = crop;\r\n        }\r\n        // we need to apply these props in the correct order\r\n        const propKeys = [\r\n            'imageCropLimitToImage',\r\n            'imageCrop',\r\n            'imageCropAspectRatio',\r\n            'imageRotation',\r\n        ];\r\n        propKeys\r\n            .filter((prop) => hasProp(options, prop))\r\n            .forEach((prop) => {\r\n            // assign to `image`\r\n            accessors[prop] = options[prop];\r\n            // remove from normalizedOptions so it's not set twice\r\n            delete options[prop];\r\n        });\r\n        // don't set the above options for a second time\r\n        const filteredOptions = Object.keys(options)\r\n            .filter((key) => !propKeys.includes(key))\r\n            .reduce((filtered, prop) => {\r\n            filtered[prop] = options[prop];\r\n            return filtered;\r\n        }, {});\r\n        // trigger setState\r\n        Object.assign(accessors, filteredOptions);\r\n    };\r\n    // load image, resolve when image is loaded\r\n    let imageLoadAbort;\r\n    const loadImage = (src, options = {}) => new Promise((resolve, reject) => {\r\n        // get current image\r\n        let image = getImage();\r\n        // determine min defined image size (is crop min size)\r\n        const cropLimitedToImage = !(options.cropLimitToImage === false ||\r\n            options.imageCropLimitToImage === false ||\r\n            initialImagePropsBackup.imageCropLmitedToImage === false);\r\n        const cropMinSize = options.cropMinSize ||\r\n            options.imageCropMinSize ||\r\n            initialImagePropsBackup.imageCropMinSize;\r\n        const minImageSize = cropLimitedToImage\r\n            ? cropMinSize\r\n            : image && image.accessors.cropMinSize;\r\n        // if already has image, remove existing image\r\n        if (image)\r\n            removeImage();\r\n        // access image props and stores\r\n        image = createImageCore({ minSize: minImageSize });\r\n        editorEventsToBubble.map((event) => image.accessors.on(event, bubble(event)));\r\n        // done, clean up listeners\r\n        const fin = () => {\r\n            // reset initial props (as now applied)\r\n            initialImageProps = {};\r\n            unsubs.forEach((unsub) => unsub());\r\n        };\r\n        const unsubs = [];\r\n        unsubs.push(image.accessors.on('loaderror', (error) => {\r\n            fin();\r\n            reject(error);\r\n        }));\r\n        unsubs.push(image.accessors.on('loadabort', () => {\r\n            fin();\r\n            reject({ name: 'AbortError' });\r\n        }));\r\n        unsubs.push(image.accessors.on('load', (output) => {\r\n            imageLoadAbort = undefined;\r\n            fin();\r\n            resolve(output);\r\n        }));\r\n        unsubs.push(image.accessors.on('beforeload', () => applyImageOptionsOrState(image, options)));\r\n        // set new image\r\n        accessors.images = [image];\r\n        // assign passed options to editor accessors, we ignore 'src'\r\n        if (options.imageReader)\r\n            accessors.imageReader = options.imageReader;\r\n        if (options.imageWriter)\r\n            accessors.imageWriter = options.imageWriter;\r\n        // start reading image\r\n        imageLoadAbort = image.accessors.read(src, {\r\n            reader: accessors.imageReader,\r\n        }, {\r\n            willRequest: accessors.willRequest,\r\n        });\r\n    });\r\n    // start processing a loaded image, resolve when image is processed\r\n    let imageProcessAbort;\r\n    const processImage = (src, options) => new Promise((resolve, reject) => {\r\n        try {\r\n            const unsubs = [];\r\n            // done, clean up listeners\r\n            const fin = () => {\r\n                imageProcessAbort = undefined;\r\n                unsubs.forEach((unsub) => unsub());\r\n            };\r\n            (async () => {\r\n                // if src supplied, first load src, then process\r\n                if (isImageSource(src)) {\r\n                    await loadImage(src, options);\r\n                }\r\n                // if first argument is not `src` but is set it's an options object, so we'll update the options before generating the image\r\n                else if (src) {\r\n                    if (isImageState(src)) {\r\n                        accessors.imageState = src;\r\n                    }\r\n                    else {\r\n                        Object.assign(accessors, src);\r\n                    }\r\n                }\r\n                // get current active image\r\n                const image = getImage();\r\n                // needs image for processing\r\n                if (!image)\r\n                    return reject('no image');\r\n                unsubs.push(image.accessors.on('processerror', (error) => {\r\n                    fin();\r\n                    reject(error);\r\n                }));\r\n                unsubs.push(image.accessors.on('processabort', () => {\r\n                    fin();\r\n                    reject({ name: 'AbortError' });\r\n                }));\r\n                unsubs.push(image.accessors.on('process', (output) => {\r\n                    fin();\r\n                    resolve(output);\r\n                }));\r\n                imageProcessAbort = image.accessors.write(accessors.imageWriter, {\r\n                    shapePreprocessor: accessors.shapePreprocessor || passthrough,\r\n                    imageScrambler: accessors.imageScrambler,\r\n                    willRequest: accessors.willRequest,\r\n                    willRequestResource: accessors.willRequestResource, // deprecated\r\n                });\r\n            })();\r\n        }\r\n        catch (err) {\r\n            reject(err);\r\n        }\r\n    });\r\n    const abortProcessImage = () => {\r\n        const image = getImage();\r\n        if (!image)\r\n            return;\r\n        if (imageProcessAbort)\r\n            imageProcessAbort();\r\n        image.accessors.processState = undefined;\r\n    };\r\n    // used internally (triggered by 'x' button when error loading image in UI)\r\n    const abortLoadImage = () => {\r\n        if (imageLoadAbort)\r\n            imageLoadAbort();\r\n        accessors.images = [];\r\n    };\r\n    // edit image, loads an image and resolve when image is processed\r\n    const editImage = (src, options) => new Promise((resolve, reject) => {\r\n        loadImage(src, options)\r\n            .then(() => {\r\n            // access image props and stores\r\n            const { images } = accessors;\r\n            const image = images[0];\r\n            // done, clean up listeners\r\n            const done = () => {\r\n                unsubReject();\r\n                unsubResolve();\r\n            };\r\n            const unsubReject = image.accessors.on('processerror', (error) => {\r\n                done();\r\n                reject(error);\r\n            });\r\n            const unsubResolve = image.accessors.on('process', (output) => {\r\n                done();\r\n                resolve(output);\r\n            });\r\n        })\r\n            .catch(reject);\r\n    });\r\n    const removeImage = () => {\r\n        // no images, nothing to remove\r\n        const image = getImage();\r\n        if (!image)\r\n            return;\r\n        // try to abort image load\r\n        if (imageLoadAbort)\r\n            imageLoadAbort();\r\n        image.accessors.loadState = undefined;\r\n        // clear images\r\n        accessors.images = [];\r\n    };\r\n    //#endregion\r\n    Object.defineProperty(accessors, 'stores', {\r\n        get: () => stores,\r\n    });\r\n    //#region API\r\n    defineMethods(accessors, {\r\n        on: sub,\r\n        loadImage,\r\n        abortLoadImage,\r\n        editImage,\r\n        removeImage,\r\n        processImage,\r\n        abortProcessImage,\r\n        destroy: () => {\r\n            unsubSrc && unsubSrc();\r\n            unsubReader && unsubReader();\r\n        },\r\n    });\r\n    return accessors;\r\n    //#endregion\r\n};\r\n\r\nconst processImage = (src, options) => {\r\n    const { processImage } = createImageEditor();\r\n    return processImage(src, options);\r\n};\r\n\r\nvar getCanvasMemoryLimit = () => {\r\n    if (!isSafari())\r\n        return Infinity;\r\n    const isSafari15 = /15_/.test(navigator.userAgent);\r\n    if (isIOS()) {\r\n        // limit resolution a little bit further to prevent drawing issues\r\n        if (isSafari15)\r\n            return 3840 * 3840;\r\n        // old iOS can deal with 4096 * 4096 without issues\r\n        return 4096 * 4096;\r\n    }\r\n    return isSafari15 ? 4096 * 4096 : Infinity;\r\n};\r\n\r\nvar filterObjectProperties = (obj, props) => Object.keys(obj)\r\n    .filter((key) => !props.includes(key))\r\n    .reduce((prev, curr) => {\r\n    prev[curr] = obj[curr];\r\n    return prev;\r\n}, {});\r\n\r\nvar getVideoElementDuration = (element) => new Promise((resolve, reject) => {\r\n    const done = () => resolve(element.duration);\r\n    if (element.readyState >= 1)\r\n        return done();\r\n    element.onloadedmetadata = done;\r\n    element.onerror = reject;\r\n});\r\n\r\nvar arrayFlatten = (arr) => arr.reduce((flat, item) => {\r\n    const arr = Array.isArray(item) ? [...item] : [item];\r\n    return [...flat, ...arr];\r\n}, []);\r\n\r\n// custom method to draw images\r\nconst createCanvasImageDrawer = ({ imageDataResizer, canvasMemoryLimit } = {}) => async (ctx, image, srcRect, destRect) => {\r\n    // min size of src is 1x1\r\n    srcRect.width = Math.max(srcRect.width, 1);\r\n    srcRect.height = Math.max(srcRect.height, 1);\r\n    // min size of dest is 1x1\r\n    destRect.width = Math.max(destRect.width, 1);\r\n    destRect.height = Math.max(destRect.height, 1);\r\n    // get resized image\r\n    const { dest } = await processImage(image, {\r\n        imageReader: createDefaultImageReader$1(),\r\n        imageWriter: createDefaultImageWriter$1({\r\n            format: 'canvas',\r\n            targetSize: {\r\n                ...destRect,\r\n                upscale: true,\r\n            },\r\n            imageDataResizer,\r\n            canvasMemoryLimit,\r\n        }),\r\n        imageCrop: srcRect,\r\n    });\r\n    // draw processed image\r\n    ctx.drawImage(dest, destRect.x, destRect.y, destRect.width, destRect.height);\r\n    // release image canvas to free up memory\r\n    releaseCanvas(dest);\r\n};\r\n// connect function in process chain\r\nconst connect = (fn, getter = (...args) => args, setter) => async (state, options, onprogress) => {\r\n    // will hold function result\r\n    // at this point we don't know if the length of this task can be computed\r\n    onprogress(createProgressEvent(0, false));\r\n    // try to run the function\r\n    let progressUpdated = false;\r\n    const res = await fn(...getter(state, options, (event) => {\r\n        progressUpdated = true;\r\n        onprogress(event);\r\n    }));\r\n    // a setter isn't required\r\n    setter && setter(state, res);\r\n    // if progress was updated, we expect the connected function to fire the 1/1 event, else we fire it here\r\n    if (!progressUpdated)\r\n        onprogress(createProgressEvent(1, false));\r\n    return state;\r\n};\r\n//\r\n// Reader/Writer Presets\r\n//\r\nconst AnyToFile = ({ willRequest = undefined, srcProp = 'src', destProp = 'dest' } = {}) => [\r\n    connect(srcToFile, (state, options, onprogress) => [\r\n        state[srcProp],\r\n        onprogress,\r\n        { ...options, willRequest },\r\n    ], (state, file) => (state[destProp] = file)),\r\n    'any-to-file',\r\n];\r\nconst BlobReadImageSize = ({ srcProp = 'src', destProp = 'size' } = {}) => [\r\n    connect(getImageSize, (state) => [state[srcProp]], (state, size) => (state[destProp] = size)),\r\n    'read-image-size',\r\n];\r\nconst getMediaDuration = async (src) => {\r\n    const mediaElement = await getAsVideoOrImageElement(src);\r\n    if (isVideoElement(mediaElement))\r\n        return await getVideoElementDuration(mediaElement);\r\n    return undefined;\r\n};\r\nconst BlobReadMediaDuration = ({ srcProp = 'src', destProp = 'duration' } = {}) => [\r\n    connect(getMediaDuration, (state) => [state[srcProp]], (state, duration) => (state[destProp] = duration)),\r\n    'read-image-size',\r\n];\r\nconst ImageSizeMatchOrientation = ({ srcSize = 'size', srcOrientation = 'orientation', destSize = 'size', } = {}) => [\r\n    connect(orientImageSize, (state) => [state[srcSize], state[srcOrientation]], (state, size) => (state[destSize] = size)),\r\n    'image-size-match-orientation',\r\n];\r\nconst BlobReadImageHead = ({ srcProp = 'src', destProp = 'head' } = {}) => [\r\n    connect((blob, slice) => (isJPEG(blob) ? blobReadSection(blob, slice) : undefined), \r\n    // 64 * 2048 should be plenty to find extract header\r\n    // Exif metadata are restricted in size to 64 kB in JPEG images because\r\n    // according to the specification this information must be contained within a single JPEG APP1 segment.\r\n    (state) => [state[srcProp], [0, 64 * 2048], onprogress], (state, head) => (state[destProp] = head)),\r\n    'read-image-head',\r\n];\r\nconst ImageHeadReadExifOrientationTag = ({ srcProp = 'head', destProp = 'orientation', } = {}) => [\r\n    connect(arrayBufferImageExif, (state) => [state[srcProp], ORIENTATION_TAG], (state, orientation = 1) => (state[destProp] = orientation)),\r\n    'read-exif-orientation-tag',\r\n];\r\nconst ImageHeadClearExifOrientationTag = ({ srcProp = 'head' } = {}) => [\r\n    connect(arrayBufferImageExif, (state) => [state[srcProp], ORIENTATION_TAG, 1]),\r\n    'clear-exif-orientation-tag',\r\n];\r\nconst CalculateCanvasScalar = ({ srcImageSize = 'size', srcCanvasSize = 'imageData', srcImageState = 'imageState', destImageSize = 'size', destScalar = 'scalar', } = {}) => [\r\n    connect((naturalSize, canvasSize) => {\r\n        return [\r\n            Math.min(canvasSize.width / naturalSize.width, canvasSize.height / naturalSize.height),\r\n            sizeCreateFromAny(canvasSize),\r\n        ];\r\n    }, (state) => [state[srcImageSize], state[srcCanvasSize], state[srcImageState]], (state, [scalar, imageSize]) => {\r\n        state[destScalar] = scalar;\r\n        state[destImageSize] = imageSize;\r\n    }),\r\n    'calculate-canvas-scalar',\r\n];\r\nconst BlobToImageData = ({ srcProp = 'src', destProp = 'imageData', canvasMemoryLimit = undefined, }) => [\r\n    connect(blobToImageData, (state) => [state[srcProp], canvasMemoryLimit], (state, imageData) => (state[destProp] = imageData)),\r\n    'blob-to-image-data',\r\n];\r\nconst ImageDataMatchOrientation = ({ srcImageData = 'imageData', srcOrientation = 'orientation', } = {}) => [\r\n    connect(orientImageData, (state) => [state[srcImageData], state[srcOrientation]], (state, imageData) => (state.imageData = imageData)),\r\n    'image-data-match-orientation',\r\n];\r\nconst ImageDataFill = ({ srcImageData = 'imageData', srcImageState = 'imageState' } = {}) => [\r\n    connect(fillImageData, (state) => [\r\n        state[srcImageData],\r\n        {\r\n            backgroundColor: state[srcImageState].backgroundColor,\r\n            backgroundImage: state[srcImageState].backgroundImage,\r\n        },\r\n    ], (state, imageData) => (state.imageData = imageData)),\r\n    'image-data-fill',\r\n];\r\nconst ImageDataCrop = ({ srcImageData = 'imageData', srcImageState = 'imageState', destScalar = 'scalar', } = {}) => [\r\n    connect(cropImageData, (state) => {\r\n        // scale crop if needed\r\n        const scalar = state[destScalar];\r\n        let { crop } = state[srcImageState];\r\n        if (crop && scalar !== 1) {\r\n            crop = rectScale$1(rectClone$1(crop), scalar, vectorCreateEmpty());\r\n        }\r\n        // apply crop\r\n        return [\r\n            state[srcImageData],\r\n            {\r\n                crop,\r\n                rotation: state[srcImageState].rotation,\r\n                flipX: state[srcImageState].flipX,\r\n                flipY: state[srcImageState].flipY,\r\n            },\r\n        ];\r\n    }, (state, imageData) => (state.imageData = imageData)),\r\n    'image-data-crop',\r\n];\r\nconst hasTargetSize = (imageState) => !!((imageState.targetSize && imageState.targetSize.width) ||\r\n    (imageState.targetSize && imageState.targetSize.height));\r\nconst ImageDataResize = ({ targetSize = {\r\n    width: undefined,\r\n    height: undefined,\r\n    fit: undefined,\r\n    upscale: undefined,\r\n}, imageDataResizer = undefined, srcProp = 'imageData', srcImageState = 'imageState', destImageScaledSize = 'imageScaledSize', }) => [\r\n    connect(resizeImageData, (state) => {\r\n        const width = Math.min(targetSize.width || Number.MAX_SAFE_INTEGER, (state[srcImageState].targetSize && state[srcImageState].targetSize.width) ||\r\n            Number.MAX_SAFE_INTEGER);\r\n        const height = Math.min(targetSize.height || Number.MAX_SAFE_INTEGER, (state[srcImageState].targetSize && state[srcImageState].targetSize.height) ||\r\n            Number.MAX_SAFE_INTEGER);\r\n        return [\r\n            state[srcProp],\r\n            {\r\n                width,\r\n                height,\r\n                fit: targetSize.fit || 'contain',\r\n                upscale: hasTargetSize(state[srcImageState])\r\n                    ? true\r\n                    : targetSize.upscale || false,\r\n            },\r\n            imageDataResizer,\r\n        ];\r\n    }, (state, imageData) => {\r\n        if (!sizeEqual(state.imageData, imageData))\r\n            state[destImageScaledSize] = sizeCreateFromAny(imageData);\r\n        state.imageData = imageData;\r\n    }),\r\n    'image-data-resize',\r\n];\r\nconst ImageDataFilter = ({ srcImageData = 'imageData', srcImageState = 'imageState', destImageData = 'imageData', } = {}) => [\r\n    connect(filterImageData, (state) => {\r\n        const { colorMatrix } = state[srcImageState];\r\n        const colorMatrices = colorMatrix &&\r\n            Object.keys(colorMatrix)\r\n                .map((name) => colorMatrix[name])\r\n                .filter(Boolean);\r\n        return [\r\n            state[srcImageData],\r\n            {\r\n                colorMatrix: colorMatrices && getColorMatrixFromColorMatrices(colorMatrices),\r\n                convolutionMatrix: state[srcImageState].convolutionMatrix,\r\n                gamma: state[srcImageState].gamma,\r\n                noise: state[srcImageState].noise,\r\n                vignette: state[srcImageState].vignette,\r\n            },\r\n        ];\r\n    }, (state, imageData) => (state[destImageData] = imageData)),\r\n    'image-data-filter',\r\n];\r\nconst ImageDataRedact = ({ srcImageData = 'imageData', srcImageState = 'imageState', destImageData = 'imageData', destScalar = 'scalar', } = {}) => [\r\n    connect(async (imageData, imageScrambler, imageBackgroundColor, shapes, scalar) => {\r\n        // skip!\r\n        if (!imageScrambler)\r\n            return imageData;\r\n        // create scrambled texture version\r\n        let scrambledCanvas;\r\n        try {\r\n            const options = {\r\n                dataSizeScalar: getImageRedactionScaleFactor(imageData, shapes),\r\n            };\r\n            if (imageBackgroundColor && imageBackgroundColor[3] > 0) {\r\n                options.backgroundColor = [...imageBackgroundColor];\r\n            }\r\n            scrambledCanvas = await imageScrambler(imageData, options);\r\n        }\r\n        catch (err) {\r\n            // log to console for debugging purposes\r\n        }\r\n        // create drawing context\r\n        const canvas = h('canvas');\r\n        canvas.width = imageData.width;\r\n        canvas.height = imageData.height;\r\n        const ctx = canvas.getContext('2d');\r\n        ctx.putImageData(imageData, 0, 0);\r\n        // set up a clip path so we only draw scrambled image within path\r\n        const path = new Path2D();\r\n        shapes.forEach((shape) => {\r\n            const rect = rectCreate(shape.x, shape.y, shape.width, shape.height);\r\n            rectMultiply(rect, scalar);\r\n            const corners = rectRotate(rectClone$1(rect), shape.rotation);\r\n            const poly = new Path2D();\r\n            corners.forEach((corner, i) => {\r\n                if (i === 0)\r\n                    return poly.moveTo(corner.x, corner.y);\r\n                poly.lineTo(corner.x, corner.y);\r\n            });\r\n            path.addPath(poly);\r\n        });\r\n        ctx.clip(path, 'nonzero');\r\n        ctx.imageSmoothingEnabled = false;\r\n        ctx.drawImage(scrambledCanvas, 0, 0, canvas.width, canvas.height);\r\n        releaseCanvas(scrambledCanvas);\r\n        // done\r\n        const imageDataOut = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n        // clean up memory usage\r\n        releaseCanvas(canvas);\r\n        return imageDataOut;\r\n    }, (state, { imageScrambler }) => [\r\n        state[srcImageData],\r\n        imageScrambler,\r\n        state[srcImageState].backgroundColor,\r\n        state[srcImageState].redaction,\r\n        state[destScalar],\r\n    ], (state, imageData) => (state[destImageData] = imageData)),\r\n    'image-data-redact',\r\n];\r\nconst ImageDataAnnotate = ({ srcImageData = 'imageData', srcSize = 'size', srcImageState = 'imageState', destImageData = 'imageData', destImageScaledSize = 'imageScaledSize', destScalar = 'scalar', imageDataResizer = undefined, canvasMemoryLimit = undefined, } = {}) => [\r\n    connect(drawImageData, (state, { shapePreprocessor, willRequestResource, willRequest }) => {\r\n        // scale annotations if needed\r\n        const { annotation } = state[srcImageState];\r\n        // skip if no annotations\r\n        if (!annotation.length)\r\n            return [state[srcImageData]];\r\n        const canvasScalar = state[destScalar];\r\n        const { crop } = state[srcImageState];\r\n        const imageSize = state[srcSize];\r\n        // image is scaled\r\n        let imageSizeScalar = canvasScalar;\r\n        const imageTargetSize = state[destImageScaledSize];\r\n        if (imageTargetSize) {\r\n            // calculate annotation scalar\r\n            imageSizeScalar = Math.min(imageTargetSize.width / crop.width, imageTargetSize.height / crop.height);\r\n        }\r\n        const imageSizeScaled = {\r\n            width: imageSize.width / canvasScalar,\r\n            height: imageSize.height / canvasScalar,\r\n        };\r\n        // go\r\n        return [\r\n            state[srcImageData],\r\n            {\r\n                shapes: annotation,\r\n                computeShape: (shape) => {\r\n                    shape = shapeComputeDisplay(shape, imageSizeScaled);\r\n                    shape = filterObjectProperties(shape, ['left', 'right', 'top', 'bottom']);\r\n                    shape = shapeScale(shape, imageSizeScalar);\r\n                    return shape;\r\n                },\r\n                transform: (ctx) => {\r\n                    const imageSize = state[srcSize];\r\n                    const { rotation = 0, flipX, flipY, cropLimitToImage, } = state[srcImageState];\r\n                    // scale crop\r\n                    const canvasScalar = state[destScalar];\r\n                    // scale crop if needed\r\n                    const { crop = rectCreateFromSize(imageSize) } = state[srcImageState];\r\n                    // calculate image scalar so we can scale annotations accordingly\r\n                    const scaledSize = state[destImageScaledSize];\r\n                    const scalar = scaledSize\r\n                        ? Math.min(scaledSize.width / crop.width, scaledSize.height / crop.height)\r\n                        : 1;\r\n                    const imageScaledSize = {\r\n                        width: (imageSize.width / canvasScalar) * scalar,\r\n                        height: (imageSize.height / canvasScalar) * scalar,\r\n                    };\r\n                    const rotatedRect = getImageTransformedRect(imageScaledSize, rotation);\r\n                    const rotatedSize = {\r\n                        width: rotatedRect.width,\r\n                        height: rotatedRect.height,\r\n                    };\r\n                    // calculate center\r\n                    const dx = imageScaledSize.width * 0.5 - rotatedSize.width * 0.5;\r\n                    const dy = imageScaledSize.height * 0.5 - rotatedSize.height * 0.5;\r\n                    const center = sizeCenter(imageScaledSize);\r\n                    // offset\r\n                    ctx.translate(-dx, -dy);\r\n                    ctx.translate(-crop.x * scalar, -crop.y * scalar);\r\n                    // rotation\r\n                    ctx.translate(center.x, center.y);\r\n                    ctx.rotate(rotation);\r\n                    ctx.translate(-center.x, -center.y);\r\n                    // flipping\r\n                    ctx.scale(flipX ? -1 : 1, flipY ? -1 : 1);\r\n                    ctx.translate(flipX ? -imageScaledSize.width : 0, flipY ? -imageScaledSize.height : 0);\r\n                    // annotations are clipped to image\r\n                    if (cropLimitToImage) {\r\n                        ctx.rect(0, 0, imageScaledSize.width, imageScaledSize.height);\r\n                        ctx.clip();\r\n                    }\r\n                },\r\n                drawImage: createCanvasImageDrawer({ imageDataResizer, canvasMemoryLimit }),\r\n                preprocessShape: (shape) => shapePreprocessor(shape, { isPreview: false, ...state[srcImageState] }),\r\n                canvasMemoryLimit,\r\n                willRequest: willRequest || willRequestResource,\r\n            },\r\n        ];\r\n    }, (state, imageData) => (state[destImageData] = imageData)),\r\n    'image-data-annotate',\r\n];\r\nconst ImageDataDecorate = ({ srcImageData = 'imageData', srcImageState = 'imageState', destImageData = 'imageData', destImageScaledSize = 'imageScaledSize', imageDataResizer = undefined, canvasMemoryLimit = undefined, destScalar = 'scalar', } = {}) => [\r\n    connect(drawImageData, (state, { shapePreprocessor, willRequestResource, willRequest }) => {\r\n        // scale annotations if needed\r\n        const { decoration } = state[srcImageState];\r\n        // skip if no annotations\r\n        if (!decoration.length)\r\n            return [state[srcImageData]];\r\n        // scale decoration and crop if needed\r\n        let scalar = state[destScalar];\r\n        const { crop } = state[srcImageState];\r\n        // image is scaled\r\n        const imageTargetSize = state[destImageScaledSize];\r\n        if (imageTargetSize) {\r\n            const imageSizeScalar = Math.min(imageTargetSize.width / crop.width, imageTargetSize.height / crop.height);\r\n            scalar = imageSizeScalar;\r\n        }\r\n        // go\r\n        return [\r\n            state[srcImageData],\r\n            {\r\n                shapes: decoration,\r\n                drawImage: createCanvasImageDrawer({ imageDataResizer, canvasMemoryLimit }),\r\n                computeShape: (shape) => {\r\n                    shape = shapeComputeDisplay(shape, crop);\r\n                    shape = filterObjectProperties(shape, ['left', 'right', 'top', 'bottom']);\r\n                    shape = shapeScale(shape, scalar);\r\n                    return shape;\r\n                },\r\n                preprocessShape: (shape) => shapePreprocessor(shape, { isPreview: false, ...state[srcImageState] }),\r\n                canvasMemoryLimit,\r\n                willRequest: willRequest || willRequestResource,\r\n            },\r\n        ];\r\n    }, (state, imageData) => (state[destImageData] = imageData)),\r\n    'image-data-decorate',\r\n];\r\nconst ImageDataFrame = ({ srcImageData = 'imageData', srcImageState = 'imageState', destImageData = 'imageData', destImageScaledSize = 'imageScaledSize', imageDataResizer = undefined, canvasMemoryLimit = undefined, destScalar = 'scalar', } = {}) => [\r\n    connect(drawImageData, (state, { shapePreprocessor, willRequestResource, willRequest }) => {\r\n        const frame = state[srcImageState].frame;\r\n        if (!frame)\r\n            return [state[srcImageData]];\r\n        // scale crop if needed\r\n        const scalar = state[destScalar];\r\n        let { crop } = state[srcImageState];\r\n        if (crop && scalar !== 1) {\r\n            crop = rectScale$1(rectClone$1(crop), scalar, vectorCreateEmpty());\r\n        }\r\n        const context = { ...crop };\r\n        const bounds = shapesBounds(shapesFromCompositShape(frame, context, shapePreprocessor), context);\r\n        context.x = Math.abs(bounds.left);\r\n        context.y = Math.abs(bounds.top);\r\n        context.width += Math.abs(bounds.left) + Math.abs(bounds.right);\r\n        context.height += Math.abs(bounds.top) + Math.abs(bounds.bottom);\r\n        const scaledSize = state[destImageScaledSize];\r\n        const contaxtScalar = scaledSize\r\n            ? Math.min(scaledSize.width / crop.width, scaledSize.height / crop.height)\r\n            : 1;\r\n        rectMultiply(context, contaxtScalar);\r\n        // use floor because we can't fill up half pixels\r\n        context.x = Math.floor(context.x);\r\n        context.y = Math.floor(context.y);\r\n        context.width = Math.floor(context.width);\r\n        context.height = Math.floor(context.height);\r\n        return [\r\n            state[srcImageData],\r\n            {\r\n                shapes: [frame],\r\n                contextBounds: context,\r\n                computeShape: (shape) => shapeComputeDisplay(shape, state[srcImageData]),\r\n                transform: (ctx) => {\r\n                    ctx.translate(context.x, context.y);\r\n                },\r\n                drawImage: createCanvasImageDrawer({ imageDataResizer, canvasMemoryLimit }),\r\n                preprocessShape: (shape) => shapePreprocessor(shape, { isPreview: false, ...state[srcImageState] }),\r\n                canvasMemoryLimit,\r\n                willRequest: willRequest || willRequestResource,\r\n            },\r\n        ];\r\n    }, (state, imageData) => (state[destImageData] = imageData)),\r\n    'image-data-frame',\r\n];\r\nconst ImageDataToBlob = ({ mimeType = undefined, quality = undefined, srcImageData = 'imageData', srcFile = 'src', destBlob = 'blob', } = {}) => [\r\n    connect(imageDataToBlob, (state) => [\r\n        state[srcImageData],\r\n        mimeType || getMimeTypeFromFilename(state[srcFile].name) || state[srcFile].type,\r\n        quality,\r\n    ], (state, blob) => (state[destBlob] = blob)),\r\n    'image-data-to-blob',\r\n];\r\nconst ImageDataToCanvas = ({ srcImageData = 'imageData', srcOrientation = 'orientation', destCanvas = 'dest', } = {}) => [\r\n    connect(imageDataToCanvas, (state) => [state[srcImageData], state[srcOrientation]], (state, canvas) => (state[destCanvas] = canvas)),\r\n    'image-data-to-canvas',\r\n];\r\nconst writeImageHead = async (blob, head) => {\r\n    if (!isJPEG(blob) || !head)\r\n        return blob;\r\n    // get exif section\r\n    const view = new DataView(head);\r\n    const markers = dataViewGetApplicationMarkers(view);\r\n    // no markers found\r\n    if (!markers || !markers.exif)\r\n        return blob;\r\n    const headEnd = ['exif', 'mpf', 'xmp'].reduce((max, key) => {\r\n        return markers[key] ? Math.max(max, markers[key].offset + markers[key].size) : max;\r\n    }, 0);\r\n    // from byte 0 to end of exif header\r\n    const headBuffer = head.slice(0, headEnd + 2);\r\n    return blobWriteSection(blob, \r\n    // insert head buffer into blob\r\n    headBuffer, \r\n    // current blob doesn't have exif header (as outputted by canvas), so we insert ours in\r\n    // (jpeg header 2) + (jfif size 16) + (app1 header 2)\r\n    [20]);\r\n};\r\nconst BlobWriteImageHead = (srcBlob = 'blob', srcHead = 'head', destBlob = 'blob') => [\r\n    connect(writeImageHead, (state) => [state[srcBlob], state[srcHead]], (state, blob) => (state[destBlob] = blob)),\r\n    'blob-write-image-head',\r\n];\r\nconst BlobToFile = ({ renameFile = undefined, srcBlob = 'blob', srcFile = 'src', destFile = 'dest', defaultFilename = undefined, } = {}) => [\r\n    connect(blobToFile, (state) => [\r\n        state[srcBlob],\r\n        renameFile\r\n            ? renameFile(state[srcFile])\r\n            : state[srcFile].name ||\r\n                `${defaultFilename}.${getExtensionFromMimeType(state[srcBlob].type)}`,\r\n    ], (state, file) => (state[destFile] = file)),\r\n    'blob-to-file',\r\n];\r\nconst Store = ({ url = './', dataset = (state) => [\r\n    ['dest', state.dest, state.dest.name],\r\n    ['imageState', state.imageState],\r\n], destStore = 'store', credentials, headers = {}, }) => [\r\n    connect(\r\n    // upload function\r\n    async (dataset, onprogress) => await post(url, dataset, {\r\n        onprogress,\r\n        beforeSend: (xhr) => configureXHR(xhr, { headers, credentials }),\r\n    }), \r\n    // get state values\r\n    (state, options, onprogress) => [\r\n        dataset(state),\r\n        onprogress,\r\n    ], \r\n    // set state values\r\n    (state, xhr) => (state[destStore] = xhr) // logs XHR request returned by `post`\r\n    ),\r\n    'store',\r\n];\r\nconst PropFilter = (allowlist) => [\r\n    connect((state) => {\r\n        // if no allowlist suppleid or is empty array we don't filter\r\n        if (!allowlist || !allowlist.length)\r\n            return state;\r\n        // else we only allow the props defined in the list and delete non matching props\r\n        Object.keys(state).forEach((key) => {\r\n            if (allowlist.includes(key))\r\n                return;\r\n            delete state[key];\r\n        });\r\n        return state;\r\n    }),\r\n    'prop-filter',\r\n];\r\n// Generic image reader, suitable for most use cases\r\nconst createDefaultImageReader$1 = (options = {}) => {\r\n    const { \r\n    // add xhr Promise intercept here\r\n    orientImage = true, outputProps = ['src', 'dest', 'size', 'duration'], preprocessImageFile, request = {}, } = options;\r\n    return [\r\n        // can read most source files and turn them into blobs\r\n        AnyToFile({ willRequest: () => request }),\r\n        // TODO: test if supported mime/type\r\n        // called when file created, can be used to read unrecognized files\r\n        preprocessImageFile && [\r\n            connect(preprocessImageFile, (state, options, onprogress) => [\r\n                state.dest,\r\n                options,\r\n                onprogress,\r\n            ], (state, file) => (state.dest = file)),\r\n            'preprocess-image-file',\r\n        ],\r\n        // quickly read size (only reads first part of image)\r\n        BlobReadImageSize({ srcProp: 'dest' }),\r\n        // quickly read duration\r\n        BlobReadMediaDuration({ srcProp: 'dest' }),\r\n        // fix image orientation\r\n        orientImage && BlobReadImageHead({ srcProp: 'dest' }),\r\n        orientImage && ImageHeadReadExifOrientationTag(),\r\n        orientImage && ImageSizeMatchOrientation(),\r\n        // remove unwanted props\r\n        PropFilter(outputProps),\r\n    ].filter(Boolean);\r\n};\r\nconst createStore = (store) => store &&\r\n    (isString(store)\r\n        ? // a basic store to post to\r\n            Store({ url: store })\r\n        : // see if is fully custom or store config\r\n            isFunction(store)\r\n                ? // fully custom store function\r\n                    [store, 'store']\r\n                : // a store configuration object\r\n                    Store(store));\r\nconst createDefaultImageWriter$1 = (options = {}) => (src, imageState, genericOptions = {}) => {\r\n    // not a video, skip\r\n    if (!isImage(src))\r\n        return;\r\n    // let's go!\r\n    const { canvasMemoryLimit = getCanvasMemoryLimit(), orientImage = true, copyImageHead = true, mimeType = undefined, quality = undefined, renameFile = undefined, targetSize = undefined, imageDataResizer = undefined, store = undefined, format = 'file', outputProps = ['src', 'dest', 'imageState', 'store'], preprocessImageSource = undefined, preprocessImageState = undefined, postprocessImageData = undefined, postprocessImageBlob = undefined, } = { ...options, ...genericOptions };\r\n    return [\r\n        // allow preprocessing of image blob, should return a new blob, for example to automatically make image background transparent\r\n        preprocessImageSource && [\r\n            connect(preprocessImageSource, (state, options, onprogress) => [state.src, options, onprogress, state.imageState], (state, src) => (state.src = src)),\r\n            'preprocess-image-source',\r\n        ],\r\n        // get orientation info (if is jpeg)\r\n        (orientImage || copyImageHead) && BlobReadImageHead(),\r\n        orientImage && ImageHeadReadExifOrientationTag(),\r\n        // get image size\r\n        BlobReadImageSize(),\r\n        // allow preproccesing of image state for example to replace placeholders\r\n        preprocessImageState && [\r\n            connect(preprocessImageState, (state, options, onprogress) => [state.imageState, options, onprogress], (state, imageState) => (state.imageState = imageState)),\r\n            'preprocess-image-state',\r\n        ],\r\n        // get image data\r\n        BlobToImageData({ canvasMemoryLimit }),\r\n        // fix image orientation\r\n        orientImage && ImageSizeMatchOrientation(),\r\n        orientImage && ImageDataMatchOrientation(),\r\n        // apply canvas scalar to data\r\n        CalculateCanvasScalar(),\r\n        // apply image state\r\n        ImageDataRedact(),\r\n        ImageDataCrop(),\r\n        ImageDataResize({ imageDataResizer, targetSize }),\r\n        ImageDataFilter(),\r\n        ImageDataFill(),\r\n        ImageDataAnnotate({ imageDataResizer, canvasMemoryLimit }),\r\n        ImageDataDecorate({ imageDataResizer, canvasMemoryLimit }),\r\n        ImageDataFrame({ imageDataResizer, canvasMemoryLimit }),\r\n        // run post processing on image data, for example to apply circular crop\r\n        postprocessImageData && [\r\n            connect(postprocessImageData, (state, options, onprogress) => [state.imageData, options, onprogress], (state, imageData) => (state.imageData = imageData)),\r\n            'postprocess-image-data',\r\n        ],\r\n        // convert to correct output format\r\n        format === 'file'\r\n            ? ImageDataToBlob({ mimeType, quality })\r\n            : format === 'canvas'\r\n                ? ImageDataToCanvas()\r\n                : [\r\n                    (state) => {\r\n                        state.dest = state.imageData;\r\n                        return state;\r\n                    },\r\n                ],\r\n        // we overwite the exif orientation tag so the image is oriented correctly\r\n        format === 'file' && orientImage && ImageHeadClearExifOrientationTag(),\r\n        // we write the new image head to the target blob\r\n        format === 'file' && copyImageHead && BlobWriteImageHead(),\r\n        // allow converting the blob to a different format\r\n        postprocessImageBlob && [\r\n            connect(postprocessImageBlob, ({ blob, imageData, src }, options, onprogress) => [{ blob, imageData, src }, options, onprogress], (state, blob) => (state.blob = blob)),\r\n            'postprocess-image-file',\r\n        ],\r\n        // turn the image blob into a file, will also rename the file\r\n        format === 'file' && BlobToFile({ defaultFilename: 'image', renameFile }),\r\n        // upload or process data if is a file\r\n        format === 'file'\r\n            ? // used for file output formats\r\n                createStore(store)\r\n            : // used for imageData and canvas output formats\r\n                isFunction(store) && [store, 'store'],\r\n        // remove unwanted props\r\n        PropFilter(outputProps),\r\n    ].filter(Boolean);\r\n};\r\nconst isWriter = (param) => Array.isArray(param) || isFunction(param);\r\nconst createDefaultMediaWriter$1 = (genericWriterOptions, ...writers) => (src, imageState) => {\r\n    // no generic options passed\r\n    if (isWriter(genericWriterOptions))\r\n        writers = [genericWriterOptions, ...writers];\r\n    const genericOptions = isObject(genericWriterOptions) ? genericWriterOptions : {};\r\n    // currently assigned writers\r\n    writers = Array.isArray(writers) ? arrayFlatten(writers) : writers;\r\n    // loop over writers and return first that is a match\r\n    for (let i = 0; i < writers.length; i++) {\r\n        const res = writers[i](src, imageState, genericOptions);\r\n        if (Array.isArray(res))\r\n            return res;\r\n    }\r\n};\r\n\r\nvar calculateImageTransforms = (stageRect, rootRect, imageSize, cropRect, imageSelectionRect, imageSelectionRectScalar, imageSelectionRectTranslation, imageScale, imageRotation, imageFlipX, imageFlipY) => {\r\n    if (!stageRect || !rootRect || !imageSize || !cropRect || !imageScale)\r\n        return undefined;\r\n    // scale presentation\r\n    imageScale *= imageSelectionRectScalar;\r\n    const viewRect = rectNormalizeOffset(rectClone$1(rootRect));\r\n    const viewCenter = rectCenter(viewRect);\r\n    const stageCenter = rectCenter(stageRect);\r\n    const imageRect = rectCreateFromSize(imageSize);\r\n    const imageCenter = rectCenter(imageRect);\r\n    // get base crop rect so we can correctly apply transforms\r\n    const cropRectBase = getBaseCropRect(imageSize, cropRect, imageRotation);\r\n    const cropRectBaseCenter = rectCenter(cropRectBase);\r\n    const imageTranslation = vectorSubtract(vectorClone(imageCenter), cropRectBaseCenter);\r\n    // calculate stage center offset from view center\r\n    const imageOffset = vectorSubtract(vectorClone(stageCenter), viewCenter);\r\n    // correct for stage offset\r\n    imageTranslation.x += imageOffset.x;\r\n    imageTranslation.y += imageOffset.y;\r\n    // set origin of translation (so rotates around center of selection)\r\n    const imageOrigin = vectorInvert(vectorClone(imageTranslation));\r\n    // correct for stage offset\r\n    imageOrigin.x += imageOffset.x;\r\n    imageOrigin.y += imageOffset.y;\r\n    // correct for image selection offset relative to view\r\n    const imageSelectionCenter = rectCenter(rectTranslate$1(rectTranslate$1(rectClone$1(imageSelectionRect), imageSelectionRectTranslation), stageRect));\r\n    const imageSelectionOffset = vectorSubtract(imageSelectionCenter, stageCenter);\r\n    vectorAdd(imageTranslation, imageSelectionOffset);\r\n    return {\r\n        origin: imageOrigin,\r\n        translation: imageTranslation,\r\n        rotation: {\r\n            x: imageFlipY ? Math.PI : 0,\r\n            y: imageFlipX ? Math.PI : 0,\r\n            z: imageRotation,\r\n        },\r\n        scale: imageScale,\r\n    };\r\n};\r\n\r\nlet result$7 = null;\r\nvar supportsWebGL2 = () => {\r\n    if (result$7 === null) {\r\n        if ('WebGL2RenderingContext' in window) {\r\n            let canvas;\r\n            try {\r\n                canvas = h('canvas');\r\n                result$7 = !!canvas.getContext('webgl2');\r\n            }\r\n            catch (err) {\r\n                result$7 = false;\r\n            }\r\n            canvas && releaseCanvas(canvas);\r\n            canvas = undefined;\r\n        }\r\n        else {\r\n            result$7 = false;\r\n        }\r\n    }\r\n    return result$7;\r\n};\r\n\r\nvar isPowerOf2 = (value) => (value & (value - 1)) === 0;\r\n\r\nvar stringReplace = (str, entries = {}, prefix = '', postfix = '') => {\r\n    return Object.keys(entries)\r\n        .filter((key) => !isObject(entries[key]))\r\n        .reduce((prev, curr) => {\r\n        return prev.replace(new RegExp(prefix + curr + postfix), entries[curr]);\r\n    }, str);\r\n};\r\n\r\nvar SHADER_FRAG_HEAD = \"#version 300 es\\nprecision highp float;\\n\\nout vec4 fragColor;\"; // eslint-disable-line\r\n\r\nvar SHADER_FRAG_INIT = \"\\nfloat a=1.0;vec4 fillColor=uColor;vec4 textureColor=texture(uTexture,vTexCoord);textureColor*=(1.0-step(1.0,vTexCoord.y))*step(0.0,vTexCoord.y)*(1.0-step(1.0,vTexCoord.x))*step(0.0,vTexCoord.x);\"; // eslint-disable-line\r\n\r\nvar SHADER_FRAG_MASK = \"\\nuniform float uMaskFeather[8];uniform float uMaskBounds[4];uniform float uMaskOpacity;float mask(float x,float y,float bounds[4],float opacity){return 1.0-(1.0-(smoothstep(bounds[3],bounds[3]+1.0,x)*(1.0-smoothstep(bounds[1]-1.0,bounds[1],x))*(1.0-step(bounds[0],y))*step(bounds[2],y)))*(1.0-opacity);}\"; // eslint-disable-line\r\n\r\nvar SHADER_FRAG_MASK_APPLY = \"\\nfloat m=mask(gl_FragCoord.x,gl_FragCoord.y,uMaskBounds,uMaskOpacity);\"; // eslint-disable-line\r\n\r\nvar SHADER_FRAG_MASK_FEATHER_APPLY = \"\\nfloat leftFeatherOpacity=step(uMaskFeather[1],gl_FragCoord.x)*uMaskFeather[0]+((1.0-uMaskFeather[0])*smoothstep(uMaskFeather[1],uMaskFeather[3],gl_FragCoord.x));float rightFeatherOpacity=(1.0-step(uMaskFeather[7],gl_FragCoord.x))*uMaskFeather[4]+((1.0-uMaskFeather[4])*smoothstep(uMaskFeather[7],uMaskFeather[5],gl_FragCoord.x));a*=leftFeatherOpacity*rightFeatherOpacity;\"; // eslint-disable-line\r\n\r\nvar SHADER_FRAG_RECT_AA = \"\\nvec2 scaledPoint=vec2(vRectCoord.x*uSize.x,vRectCoord.y*uSize.y);a*=smoothstep(0.0,1.0,uSize.x-scaledPoint.x);a*=smoothstep(0.0,1.0,uSize.y-scaledPoint.y);a*=smoothstep(0.0,1.0,scaledPoint.x);a*=smoothstep(0.0,1.0,scaledPoint.y);\"; // eslint-disable-line\r\n\r\nvar SHADER_FRAG_CORNER_RADIUS = \"\\nvec2 s=(uSize-2.0)*.5;vec2 r=(vRectCoord*uSize);vec2 p=r-(uSize*.5);float cornerRadius=uCornerRadius[0];bool left=r.x<s.x;bool top=r.y<s.x;if(!left&&top){cornerRadius=uCornerRadius[1];}if(!left&&!top){cornerRadius=uCornerRadius[3];}if(left&&!top){cornerRadius=uCornerRadius[2];}a*=1.0-clamp(length(max(abs(p)-(s-cornerRadius),0.0))-cornerRadius,0.0,1.0);\"; // eslint-disable-line\r\n\r\nvar SHADER_FRAG_SHAPE_BLEND_COLOR = \"\\nif(m<=0.0)discard;fillColor.a*=a;fillColor.rgb*=fillColor.a;fillColor.rgb*=m;fillColor.rgb+=(1.0-m)*(uCanvasColor.rgb*fillColor.a);textureColor*=uTextureOpacity;textureColor.a*=a;textureColor.rgb*=m*a;textureColor.rgb+=(1.0-m)*(uCanvasColor.rgb*textureColor.a);fragColor=textureColor+(fillColor*(1.0-textureColor.a));\"; // eslint-disable-line\r\n\r\nvar SHADER_FRAG_TEXTURE_COLORIZE = \"\\nif(uTextureColor.a!=0.0&&textureColor.a>0.0){vec3 colorFlattened=textureColor.rgb/textureColor.a;if(colorFlattened.r>=.9999&&colorFlattened.g==0.0&&colorFlattened.b>=.9999){textureColor.rgb=uTextureColor.rgb*textureColor.a;}textureColor*=uTextureColor.a;}\"; // eslint-disable-line\r\n\r\nvar SHADER_VERT_HEAD = \"#version 300 es\\n\\nin vec4 aPosition;uniform mat4 uMatrix;\"; // eslint-disable-line\r\n\r\nvar SHADER_VERT_MULTIPLY_MATRUX = \"\\ngl_Position=uMatrix*vec4(aPosition.x,aPosition.y,0,1);\"; // eslint-disable-line\r\n\r\nvar SHADER_VERT_TEXTURE = \"\\nin vec2 aTexCoord;out vec2 vTexCoord;\"; // eslint-disable-line\r\n\r\nconst SHADER_VERT_SNIPPETS = {\r\n    head: SHADER_VERT_HEAD,\r\n    text: SHADER_VERT_TEXTURE,\r\n    matrix: SHADER_VERT_MULTIPLY_MATRUX,\r\n};\r\nconst SHADER_FRAG_SNIPPETS = {\r\n    head: SHADER_FRAG_HEAD,\r\n    mask: SHADER_FRAG_MASK,\r\n    init: SHADER_FRAG_INIT,\r\n    colorize: SHADER_FRAG_TEXTURE_COLORIZE,\r\n    maskapply: SHADER_FRAG_MASK_APPLY,\r\n    maskfeatherapply: SHADER_FRAG_MASK_FEATHER_APPLY,\r\n    edgeaa: SHADER_FRAG_RECT_AA,\r\n    cornerradius: SHADER_FRAG_CORNER_RADIUS,\r\n    fragcolor: SHADER_FRAG_SHAPE_BLEND_COLOR,\r\n};\r\nconst transpileShader = (gl, src, type) => {\r\n    src = stringReplace(src, type === gl.VERTEX_SHADER ? SHADER_VERT_SNIPPETS : SHADER_FRAG_SNIPPETS, '##').trim();\r\n    // ready if supports webgl\r\n    if (supportsWebGL2())\r\n        return src;\r\n    src = src.replace(/#version.+/gm, '').trim();\r\n    src = src.replace(/^\\/\\/\\#/gm, '#');\r\n    if (type === gl.VERTEX_SHADER) {\r\n        src = src.replace(/in /gm, 'attribute ').replace(/out /g, 'varying ');\r\n    }\r\n    if (type === gl.FRAGMENT_SHADER) {\r\n        src = src\r\n            .replace(/in /gm, 'varying ')\r\n            .replace(/out.*?;/gm, '')\r\n            .replace(/texture\\(/g, 'texture2D(')\r\n            .replace(/fragColor/g, 'gl_FragColor');\r\n    }\r\n    return `${src}`;\r\n};\r\nconst compileShader = (gl, src, type) => {\r\n    const shader = gl.createShader(type);\r\n    const transpiledSrc = transpileShader(gl, src, type);\r\n    gl.shaderSource(shader, transpiledSrc);\r\n    gl.compileShader(shader);\r\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n        console.error(gl.getShaderInfoLog(shader));\r\n    }\r\n    return shader;\r\n};\r\nconst createShader = (gl, vertexShaderCode, fragmentShaderCode, attribs, uniforms) => {\r\n    const vertexShader = compileShader(gl, vertexShaderCode, gl.VERTEX_SHADER);\r\n    const fragmentShader = compileShader(gl, fragmentShaderCode, gl.FRAGMENT_SHADER);\r\n    const program = gl.createProgram();\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n    gl.linkProgram(program);\r\n    const locations = {};\r\n    attribs.forEach((name) => {\r\n        locations[name] = gl.getAttribLocation(program, name);\r\n    });\r\n    uniforms.forEach((name) => {\r\n        locations[name] = gl.getUniformLocation(program, name);\r\n    });\r\n    return {\r\n        program,\r\n        locations,\r\n        destroy() {\r\n            gl.detachShader(program, vertexShader);\r\n            gl.detachShader(program, fragmentShader);\r\n            gl.deleteShader(vertexShader);\r\n            gl.deleteShader(fragmentShader);\r\n            gl.deleteProgram(program);\r\n        },\r\n    };\r\n};\r\nconst canMipMap = (source) => {\r\n    if (source['nodeName'] === 'VIDEO')\r\n        return false;\r\n    if (supportsWebGL2())\r\n        return true;\r\n    return isPowerOf2(source.width) && isPowerOf2(source.height);\r\n};\r\nconst applyTextureProperties = (gl, source, options) => {\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, canMipMap(source) ? gl.LINEAR_MIPMAP_LINEAR : gl.LINEAR);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, options.filter);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    if (canMipMap(source))\r\n        gl.generateMipmap(gl.TEXTURE_2D);\r\n};\r\nconst updateTexture = (gl, texture, source, options) => {\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\r\n    applyTextureProperties(gl, source, options);\r\n    gl.bindTexture(gl.TEXTURE_2D, null);\r\n    return texture;\r\n};\r\nconst applyOpacity = (color, opacity = 1) => color\r\n    ? [color[0], color[1], color[2], isNumber(color[3]) ? opacity * color[3] : opacity]\r\n    : [0, 0, 0, 0];\r\n\r\nconst mat4Create = () => {\r\n    const mat = new Float32Array(16);\r\n    mat[0] = 1;\r\n    mat[5] = 1;\r\n    mat[10] = 1;\r\n    mat[15] = 1;\r\n    return mat;\r\n};\r\nconst mat4Perspective = (mat, fovy, aspect, near, far) => {\r\n    const f = 1.0 / Math.tan(fovy / 2);\r\n    const nf = 1 / (near - far);\r\n    mat[0] = f / aspect;\r\n    mat[1] = 0;\r\n    mat[2] = 0;\r\n    mat[3] = 0;\r\n    mat[4] = 0;\r\n    mat[5] = f;\r\n    mat[6] = 0;\r\n    mat[7] = 0;\r\n    mat[8] = 0;\r\n    mat[9] = 0;\r\n    mat[10] = (far + near) * nf;\r\n    mat[11] = -1;\r\n    mat[12] = 0;\r\n    mat[13] = 0;\r\n    mat[14] = 2 * far * near * nf;\r\n    mat[15] = 0;\r\n};\r\nconst mat4Ortho = (mat, left, right, bottom, top, near, far) => {\r\n    const lr = 1 / (left - right);\r\n    const bt = 1 / (bottom - top);\r\n    const nf = 1 / (near - far);\r\n    mat[0] = -2 * lr;\r\n    mat[1] = 0;\r\n    mat[2] = 0;\r\n    mat[3] = 0;\r\n    mat[4] = 0;\r\n    mat[5] = -2 * bt;\r\n    mat[6] = 0;\r\n    mat[7] = 0;\r\n    mat[8] = 0;\r\n    mat[9] = 0;\r\n    mat[10] = 2 * nf;\r\n    mat[11] = 0;\r\n    mat[12] = (left + right) * lr;\r\n    mat[13] = (top + bottom) * bt;\r\n    mat[14] = (far + near) * nf;\r\n    mat[15] = 1;\r\n};\r\nconst mat4Translate = (mat, x, y, z) => {\r\n    mat[12] = mat[0] * x + mat[4] * y + mat[8] * z + mat[12];\r\n    mat[13] = mat[1] * x + mat[5] * y + mat[9] * z + mat[13];\r\n    mat[14] = mat[2] * x + mat[6] * y + mat[10] * z + mat[14];\r\n    mat[15] = mat[3] * x + mat[7] * y + mat[11] * z + mat[15];\r\n};\r\nconst mat4Scale = (mat, s) => {\r\n    mat[0] *= s;\r\n    mat[1] *= s;\r\n    mat[2] *= s;\r\n    mat[3] *= s;\r\n    mat[4] *= s;\r\n    mat[5] *= s;\r\n    mat[6] *= s;\r\n    mat[7] *= s;\r\n    mat[8] *= s;\r\n    mat[9] *= s;\r\n    mat[10] *= s;\r\n    mat[11] *= s;\r\n};\r\nconst mat4ScaleX = (mat, s) => {\r\n    mat[0] *= s;\r\n    mat[1] *= s;\r\n    mat[2] *= s;\r\n    mat[3] *= s;\r\n};\r\nconst mat4ScaleY = (mat, s) => {\r\n    mat[4] *= s;\r\n    mat[5] *= s;\r\n    mat[6] *= s;\r\n    mat[7] *= s;\r\n};\r\nconst mat4RotateX = (mat, rad) => {\r\n    const s = Math.sin(rad);\r\n    const c = Math.cos(rad);\r\n    const a10 = mat[4];\r\n    const a11 = mat[5];\r\n    const a12 = mat[6];\r\n    const a13 = mat[7];\r\n    const a20 = mat[8];\r\n    const a21 = mat[9];\r\n    const a22 = mat[10];\r\n    const a23 = mat[11];\r\n    mat[4] = a10 * c + a20 * s;\r\n    mat[5] = a11 * c + a21 * s;\r\n    mat[6] = a12 * c + a22 * s;\r\n    mat[7] = a13 * c + a23 * s;\r\n    mat[8] = a20 * c - a10 * s;\r\n    mat[9] = a21 * c - a11 * s;\r\n    mat[10] = a22 * c - a12 * s;\r\n    mat[11] = a23 * c - a13 * s;\r\n};\r\nconst mat4RotateY = (mat, rad) => {\r\n    const s = Math.sin(rad);\r\n    const c = Math.cos(rad);\r\n    const a00 = mat[0];\r\n    const a01 = mat[1];\r\n    const a02 = mat[2];\r\n    const a03 = mat[3];\r\n    const a20 = mat[8];\r\n    const a21 = mat[9];\r\n    const a22 = mat[10];\r\n    const a23 = mat[11];\r\n    mat[0] = a00 * c - a20 * s;\r\n    mat[1] = a01 * c - a21 * s;\r\n    mat[2] = a02 * c - a22 * s;\r\n    mat[3] = a03 * c - a23 * s;\r\n    mat[8] = a00 * s + a20 * c;\r\n    mat[9] = a01 * s + a21 * c;\r\n    mat[10] = a02 * s + a22 * c;\r\n    mat[11] = a03 * s + a23 * c;\r\n};\r\nconst mat4RotateZ = (mat, rad) => {\r\n    const s = Math.sin(rad);\r\n    const c = Math.cos(rad);\r\n    const a00 = mat[0];\r\n    const a01 = mat[1];\r\n    const a02 = mat[2];\r\n    const a03 = mat[3];\r\n    const a10 = mat[4];\r\n    const a11 = mat[5];\r\n    const a12 = mat[6];\r\n    const a13 = mat[7];\r\n    mat[0] = a00 * c + a10 * s;\r\n    mat[1] = a01 * c + a11 * s;\r\n    mat[2] = a02 * c + a12 * s;\r\n    mat[3] = a03 * c + a13 * s;\r\n    mat[4] = a10 * c - a00 * s;\r\n    mat[5] = a11 * c - a01 * s;\r\n    mat[6] = a12 * c - a02 * s;\r\n    mat[7] = a13 * c - a03 * s;\r\n};\r\n\r\nvar degToRad = (degrees) => degrees * Math.PI / 180;\r\n\r\nvar getWebGLContext = (canvas, attrs) => {\r\n    if (supportsWebGL2())\r\n        return canvas.getContext('webgl2', attrs);\r\n    return (canvas.getContext('webgl', attrs) ||\r\n        canvas.getContext('experimental-webgl', attrs));\r\n};\r\n\r\nvar imageFragmentShader = \"\\n##head\\nin vec2 vTexCoord;uniform sampler2D uTexture;uniform sampler2D uTextureOverlay;uniform sampler2D uTextureBlend;uniform vec2 uTextureSize;uniform float uOpacity;uniform int uAntialias;uniform vec4 uOverlayColor;uniform mat4 uColorMatrix;uniform vec4 uColorOffset;uniform float uClarityKernel[9];uniform float uClarityKernelWeight;uniform float uColorGamma;uniform float uColorVignette;uniform float uMaskClip;uniform float uMaskOpacity;uniform float uMaskBounds[4];uniform float uMaskCornerRadius[4];uniform float uMaskFeather[8];vec4 applyGamma(vec4 c,float g){c.r=pow(c.r,g);c.g=pow(c.g,g);c.b=pow(c.b,g);return c;}vec4 applyColorMatrix(vec4 c,mat4 m,vec4 o){return(c*m)+(o*c.a);}vec4 applyConvolutionMatrix(vec4 c,float k0,float k1,float k2,float k3,float k4,float k5,float k6,float k7,float k8,float w){vec2 pixel=vec2(1)/uTextureSize;vec4 colorSum=texture(uTexture,vTexCoord-pixel)*k0+texture(uTexture,vTexCoord+pixel*vec2(0.0,-1.0))*k1+texture(uTexture,vTexCoord+pixel*vec2(1.0,-1.0))*k2+texture(uTexture,vTexCoord+pixel*vec2(-1.0,0.0))*k3+texture(uTexture,vTexCoord)*k4+texture(uTexture,vTexCoord+pixel*vec2(1.0,0.0))*k5+texture(uTexture,vTexCoord+pixel*vec2(-1.0,1.0))*k6+texture(uTexture,vTexCoord+pixel*vec2(0.0,1.0))*k7+texture(uTexture,vTexCoord+pixel)*k8;vec4 color=vec4(clamp((colorSum/w),0.0,1.0).rgb,c.a);return color;}vec4 applyVignette(vec4 c,vec2 pos,vec2 center,float v){float d=distance(pos,center)/length(center);float f=1.0-(d*abs(v));if(v>0.0){c.rgb*=f;}else if(v<0.0){c.rgb+=(1.0-f)*(1.0-c.rgb);}return c;}vec4 blendPremultipliedAlpha(vec4 back,vec4 front){return front+(back*(1.0-front.a));}void main(){float x=gl_FragCoord.x;float y=gl_FragCoord.y;float a=1.0;float maskTop=uMaskBounds[0];float maskRight=uMaskBounds[1];float maskBottom=uMaskBounds[2];float maskLeft=uMaskBounds[3];float leftFeatherOpacity=step(uMaskFeather[1],x)*uMaskFeather[0]+((1.0-uMaskFeather[0])*smoothstep(uMaskFeather[1],uMaskFeather[3],x));float rightFeatherOpacity=(1.0-step(uMaskFeather[7],x))*uMaskFeather[4]+((1.0-uMaskFeather[4])*smoothstep(uMaskFeather[7],uMaskFeather[5],x));a*=leftFeatherOpacity*rightFeatherOpacity;float overlayColorAlpha=(smoothstep(maskLeft,maskLeft+1.0,x)*(1.0-smoothstep(maskRight-1.0,maskRight,x))*(1.0-step(maskTop,y))*step(maskBottom,y));if(uOverlayColor.a==0.0){a*=overlayColorAlpha;}vec2 offset=vec2(maskLeft,maskBottom);vec2 size=vec2(maskRight-maskLeft,maskTop-maskBottom)*.5;vec2 center=offset.xy+size.xy;int pixelX=int(step(center.x,x));int pixelY=int(step(y,center.y));float cornerRadius=0.0;if(pixelX==0&&pixelY==0)cornerRadius=uMaskCornerRadius[0];if(pixelX==1&&pixelY==0)cornerRadius=uMaskCornerRadius[1];if(pixelX==0&&pixelY==1)cornerRadius=uMaskCornerRadius[2];if(pixelX==1&&pixelY==1)cornerRadius=uMaskCornerRadius[3];float cornerOffset=sign(cornerRadius)*length(max(abs(gl_FragCoord.xy-size-offset)-size+cornerRadius,0.0))-cornerRadius;float cornerOpacity=1.0-smoothstep(0.0,1.0,cornerOffset);a*=cornerOpacity;if(uAntialias==1){vec2 scaledPoint=vec2(vTexCoord.x*uTextureSize.x,vTexCoord.y*uTextureSize.y);a*=smoothstep(0.0,1.0,uTextureSize.x-scaledPoint.x);a*=smoothstep(0.0,1.0,uTextureSize.y-scaledPoint.y);a*=smoothstep(0.0,1.0,scaledPoint.x);a*=smoothstep(0.0,1.0,scaledPoint.y);}vec4 color=texture(uTexture,vTexCoord);if(uClarityKernelWeight!=-1.0){color=applyConvolutionMatrix(color,uClarityKernel[0],uClarityKernel[1],uClarityKernel[2],uClarityKernel[3],uClarityKernel[4],uClarityKernel[5],uClarityKernel[6],uClarityKernel[7],uClarityKernel[8],uClarityKernelWeight);}color=blendPremultipliedAlpha(color,texture(uTextureBlend,vTexCoord));color=applyGamma(color,uColorGamma);color=applyColorMatrix(color,uColorMatrix,uColorOffset);color*=a;if(uColorVignette!=0.0){vec2 pos=gl_FragCoord.xy-offset;color=applyVignette(color,pos,center-offset,uColorVignette);}color=blendPremultipliedAlpha(color,texture(uTextureOverlay,vTexCoord));if(overlayColorAlpha<=0.0){color*=1.0-uOverlayColor.a;}color*=uOpacity;fragColor=color;}\"; // eslint-disable-line\r\n\r\nvar imageVertexShader = \"\\n##head\\n##text\\nvoid main(){vTexCoord=aTexCoord;gl_Position=uMatrix*aPosition;}\"; // eslint-disable-line\r\n\r\nvar pathVertexShader = \"#version 300 es\\n\\nin vec4 aPosition;in vec2 aNormal;in float aMiter;out vec2 vNormal;out float vMiter;out float vWidth;uniform float uWidth;uniform float uSharpness;uniform mat4 uMatrix;void main(){vMiter=aMiter;vNormal=aNormal;vWidth=(uWidth*.5)+uSharpness;gl_Position=uMatrix*vec4(aPosition.x+(aNormal.x*vWidth*aMiter),aPosition.y+(aNormal.y*vWidth*aMiter),0,1);}\"; // eslint-disable-line\r\n\r\nvar pathFragmentShader = \"\\n##head\\n##mask\\nin vec2 vNormal;in float vMiter;in float vWidth;uniform float uWidth;uniform vec4 uColor;uniform vec4 uCanvasColor;void main(){vec4 fillColor=uColor;float m=mask(gl_FragCoord.x,gl_FragCoord.y,uMaskBounds,uMaskOpacity);if(m<=0.0)discard;fillColor.a*=clamp(smoothstep(vWidth-.5,vWidth-1.0,abs(vMiter)*vWidth),0.0,1.0);fillColor.rgb*=fillColor.a;fillColor.rgb*=m;fillColor.rgb+=(1.0-m)*(uCanvasColor.rgb*fillColor.a);fragColor=fillColor;}\"; // eslint-disable-line\r\n\r\nvar rectVertexShader = \"\\n##head\\n##text\\nin vec2 aRectCoord;out vec2 vRectCoord;void main(){vTexCoord=aTexCoord;vRectCoord=aRectCoord;\\n##matrix\\n}\"; // eslint-disable-line\r\n\r\nvar rectFragmentShader = \"\\n##head\\n##mask\\nin vec2 vTexCoord;in vec2 vRectCoord;uniform sampler2D uTexture;uniform vec4 uTextureColor;uniform float uTextureOpacity;uniform vec4 uColor;uniform float uCornerRadius[4];uniform vec2 uSize;uniform vec2 uPosition;uniform vec4 uCanvasColor;uniform int uInverted;void main(){\\n##init\\n##colorize\\n##edgeaa\\n##cornerradius\\n##maskfeatherapply\\nif(uInverted==1)a=1.0-a;\\n##maskapply\\n##fragcolor\\n}\"; // eslint-disable-line\r\n\r\nvar ellipseVertexShader = \"\\n##head\\n##text\\nout vec2 vTexCoordDouble;void main(){vTexCoordDouble=vec2(aTexCoord.x*2.0-1.0,aTexCoord.y*2.0-1.0);vTexCoord=aTexCoord;\\n##matrix\\n}\"; // eslint-disable-line\r\n\r\nvar ellipseFragmentShader = \"\\n##head\\n##mask\\nin vec2 vTexCoord;in vec2 vTexCoordDouble;uniform sampler2D uTexture;uniform float uTextureOpacity;uniform vec2 uRadius;uniform vec4 uColor;uniform int uInverted;uniform vec4 uCanvasColor;void main(){\\n##init\\nfloat ar=uRadius.x/uRadius.y;vec2 rAA=vec2(uRadius.x-1.0,uRadius.y-(1.0/ar));vec2 scaledPointSq=vec2((vTexCoordDouble.x*uRadius.x)*(vTexCoordDouble.x*uRadius.x),(vTexCoordDouble.y*uRadius.y)*(vTexCoordDouble.y*uRadius.y));float p=(scaledPointSq.x/(uRadius.x*uRadius.x))+(scaledPointSq.y/(uRadius.y*uRadius.y));float pAA=(scaledPointSq.x/(rAA.x*rAA.x))+(scaledPointSq.y/(rAA.y*rAA.y));a=smoothstep(1.0,p/pAA,p);if(uInverted==1)a=1.0-a;\\n##maskapply\\n##fragcolor\\n}\"; // eslint-disable-line\r\n\r\nvar triangleVertexShader = \"\\n##head\\nvoid main(){\\n##matrix\\n}\"; // eslint-disable-line\r\n\r\nvar triangleFragmentShader = \"\\n##head\\n##mask\\nuniform vec4 uColor;uniform vec4 uCanvasColor;void main(){vec4 fillColor=uColor;\\n##maskapply\\nfillColor.rgb*=fillColor.a;fillColor.rgb*=m;fillColor.rgb+=(1.0-m)*(uCanvasColor.rgb*fillColor.a);fragColor=fillColor;}\"; // eslint-disable-line\r\n\r\nconst getIndex = (arr, index) => {\r\n    const l = arr.length;\r\n    if (index >= l)\r\n        return arr[index % l];\r\n    if (index < 0)\r\n        return arr[(index % l) + l];\r\n    return arr[index];\r\n};\r\nconst getPolygonArea = (vertices) => {\r\n    let area = 0, i, va, vb, w, h;\r\n    const l = vertices.length;\r\n    for (i = 0; i < l; i++) {\r\n        va = vertices[i];\r\n        vb = vertices[(i + 1) % l];\r\n        w = vb.x - va.x;\r\n        h = (vb.y + va.y) / 2;\r\n        area += w * h;\r\n    }\r\n    return area;\r\n};\r\nconst isPointInTriangle = (p, a, b, c) => {\r\n    const ab = vectorCreate(b.x - a.x, b.y - a.y);\r\n    const bc = vectorCreate(c.x - b.x, c.y - b.y);\r\n    const ca = vectorCreate(a.x - c.x, a.y - c.y);\r\n    const ap = vectorCreate(p.x - a.x, p.y - a.y);\r\n    const bp = vectorCreate(p.x - b.x, p.y - b.y);\r\n    const cp = vectorCreate(p.x - c.x, p.y - c.y);\r\n    const c1 = vectorCross(ab, ap);\r\n    const c2 = vectorCross(bc, bp);\r\n    const c3 = vectorCross(ca, cp);\r\n    return c1 <= 0 && c2 <= 0 && c3 <= 0;\r\n};\r\nconst isIntersectingSelf = (vertices) => {\r\n    // test if lines intersect\r\n    const l = vertices.length;\r\n    for (let i = 0; i < l; i++) {\r\n        const line = lineCreate(vertices[i], getIndex(vertices, i + 1));\r\n        const intersections = linePointsIntersection(line, vertices, {\r\n            ignoreIdenticalLines: true,\r\n            breakOnIntersection: true,\r\n        });\r\n        // is intersecting\r\n        if (intersections)\r\n            return true;\r\n    }\r\n    return false;\r\n};\r\nconst triangulate = (vertices) => {\r\n    // not enough vertices\r\n    if (vertices.length < 3)\r\n        return [];\r\n    // test if is simple polygon\r\n    if (isIntersectingSelf(vertices))\r\n        return [];\r\n    // if vertices aren't clockwise, reverse\r\n    if (getPolygonArea(vertices) < 0)\r\n        vertices.reverse();\r\n    // TODO: remove 180 degree corners, vertices should either be convex (< 180) or reflex (> 180), this happens when three vertices are in the same line\r\n    // triangulate\r\n    const totalVertices = vertices.length;\r\n    const indexList = [...Array(totalVertices).keys()];\r\n    const triangles = [];\r\n    // faster to declare vars out of loop\r\n    let i, j, a, b, c, va, vb, vc, vaToVb, vaToVc, isEar, p;\r\n    let safe = 128;\r\n    while (indexList.length > 3) {\r\n        // safeguard against infinite loops\r\n        if (safe <= 0)\r\n            return [];\r\n        // lower safeguard\r\n        safe--;\r\n        // start calculating triangles\r\n        for (i = 0; i < indexList.length; i++) {\r\n            a = indexList[i];\r\n            b = getIndex(indexList, i - 1);\r\n            c = getIndex(indexList, i + 1);\r\n            va = vertices[a];\r\n            vb = vertices[b];\r\n            vc = vertices[c];\r\n            vaToVb = vectorCreate(vb.x - va.x, vb.y - va.y);\r\n            vaToVc = vectorCreate(vc.x - va.x, vc.y - va.y);\r\n            // is not an ear if is reflex corner (angle > 180)\r\n            if (vectorCross(vaToVb, vaToVc) < 0)\r\n                continue;\r\n            isEar = true;\r\n            for (j = 0; j < totalVertices; j++) {\r\n                // skip as is me\r\n                if (j === a || j === b || j === c)\r\n                    continue;\r\n                // is not an ear if another vertex falls in this triangle\r\n                p = vertices[j];\r\n                if (isPointInTriangle(p, vb, va, vc)) {\r\n                    isEar = false;\r\n                    break;\r\n                }\r\n            }\r\n            // skip\r\n            if (!isEar)\r\n                continue;\r\n            // found ear\r\n            triangles.push([vb, va, vc]);\r\n            // no longer interested in this index\r\n            indexList.splice(i, 1);\r\n            break;\r\n        }\r\n    }\r\n    // finale triangle\r\n    triangles.push([vertices[indexList[0]], vertices[indexList[1]], vertices[indexList[2]]]);\r\n    return triangles;\r\n};\r\nconst createPathSegment = (vertices, index, a, b, c) => {\r\n    const ab = vectorNormalize(vectorCreate(b.x - a.x, b.y - a.y));\r\n    const bc = vectorNormalize(vectorCreate(c.x - b.x, c.y - b.y));\r\n    const tangent = vectorNormalize(vectorCreate(ab.x + bc.x, ab.y + bc.y));\r\n    const miter = vectorCreate(-tangent.y, tangent.x);\r\n    const normal = vectorCreate(-ab.y, ab.x);\r\n    // limit miter length (TEMP fix to prevent spikes, should eventually add caps)\r\n    const miterLength = Math.min(1 / vectorDot(miter, normal), 5);\r\n    vertices[index] = b.x;\r\n    vertices[index + 1] = b.y;\r\n    vertices[index + 2] = miter.x * miterLength;\r\n    vertices[index + 3] = miter.y * miterLength;\r\n    vertices[index + 4] = -1;\r\n    vertices[index + 5] = b.x;\r\n    vertices[index + 6] = b.y;\r\n    vertices[index + 7] = miter.x * miterLength;\r\n    vertices[index + 8] = miter.y * miterLength;\r\n    vertices[index + 9] = 1;\r\n};\r\nconst createPathVertices = (points, close) => {\r\n    let a, b, c, i = 0;\r\n    const l = points.length;\r\n    const stride = 10;\r\n    const vertices = new Float32Array((close ? l + 1 : l) * stride);\r\n    const first = points[0];\r\n    const last = points[l - 1];\r\n    for (i = 0; i < l; i++) {\r\n        a = points[i - 1];\r\n        b = points[i];\r\n        c = points[i + 1];\r\n        // if previous point not available use inverse vector to next point\r\n        if (!a)\r\n            a = close ? last : vectorCreate(b.x + (b.x - c.x), b.y + (b.y - c.y));\r\n        // if next point not available use inverse vector from previous point\r\n        if (!c)\r\n            c = close ? first : vectorCreate(b.x + (b.x - a.x), b.y + (b.y - a.y));\r\n        createPathSegment(vertices, i * stride, a, b, c);\r\n    }\r\n    if (close)\r\n        createPathSegment(vertices, l * stride, last, first, points[1]);\r\n    return vertices;\r\n};\r\nconst rectPointsToVertices = (points) => {\r\n    // [tl, tr, br, bl]\r\n    // B   D\r\n    // | \\ |\r\n    // A  C\r\n    const vertices = new Float32Array(8);\r\n    vertices[0] = points[3].x;\r\n    vertices[1] = points[3].y;\r\n    vertices[2] = points[0].x;\r\n    vertices[3] = points[0].y;\r\n    vertices[4] = points[2].x;\r\n    vertices[5] = points[2].y;\r\n    vertices[6] = points[1].x;\r\n    vertices[7] = points[1].y;\r\n    return vertices;\r\n};\r\nconst createRectPoints = (rect, rotation = 0, flipX, flipY) => {\r\n    const corners = rectGetCorners(rect);\r\n    const cx = rect.x + rect.width * 0.5;\r\n    const cy = rect.y + rect.height * 0.5;\r\n    if (flipX || flipY)\r\n        vectorsFlip(corners, flipX, flipY, cx, cy);\r\n    if (rotation !== 0)\r\n        vectorsRotate(corners, rotation, cx, cy);\r\n    return corners;\r\n};\r\nconst createEllipseOutline = (x, y, width, height, rotation, flipX, flipY) => {\r\n    const rx = Math.abs(width) * 0.5;\r\n    const ry = Math.abs(height) * 0.5;\r\n    const size = Math.abs(width) + Math.abs(height);\r\n    const precision = Math.max(20, Math.round(size / 6));\r\n    return ellipseToPolygon(vectorCreate(x + rx, y + ry), rx, ry, rotation, flipX, flipY, precision);\r\n};\r\nconst createRectOutline = (x, y, width, height, rotation, cornerRadius, flipX, flipY) => {\r\n    const points = [];\r\n    if (cornerRadius.every((v) => v === 0)) {\r\n        points.push(vectorCreate(x, y), // top left corner\r\n        vectorCreate(x + width, y), // top right corner\r\n        vectorCreate(x + width, y + height), // bottom right corner\r\n        vectorCreate(x, y + height) // bottom left corner\r\n        );\r\n    }\r\n    else {\r\n        const [tl, tr, bl, br] = cornerRadius;\r\n        const l = x;\r\n        const r = x + width;\r\n        const t = y;\r\n        const b = y + height;\r\n        // start at end of top left corner\r\n        points.push(vectorCreate(l + tl, t));\r\n        pushRectCornerPoints(points, r - tr, t + tr, tr, -1);\r\n        // move to bottom right corner\r\n        points.push(vectorCreate(r, t + tr));\r\n        pushRectCornerPoints(points, r - br, b - br, br, 0);\r\n        // move to bottom left corner\r\n        points.push(vectorCreate(r - br, b));\r\n        pushRectCornerPoints(points, l + bl, b - bl, bl, 1);\r\n        // move to top left corner\r\n        points.push(vectorCreate(l, b - bl));\r\n        pushRectCornerPoints(points, l + tl, t + tl, tl, 2);\r\n    }\r\n    if (flipX || flipY)\r\n        vectorsFlip(points, flipX, flipY, x + width * 0.5, y + height * 0.5);\r\n    if (rotation)\r\n        vectorsRotate(points, rotation, x + width * 0.5, y + height * 0.5);\r\n    return points;\r\n};\r\nconst pushRectCornerPoints = (points, x, y, radius, offset) => {\r\n    const precision = Math.min(20, Math.max(4, Math.round(radius / 2)));\r\n    let p = 0;\r\n    let s = 0;\r\n    let rx = 0;\r\n    let ry = 0;\r\n    let i = 0;\r\n    for (; i < precision; i++) {\r\n        p = i / precision;\r\n        s = offset * HALF_PI + p * HALF_PI;\r\n        rx = radius * Math.cos(s);\r\n        ry = radius * Math.sin(s);\r\n        points.push(vectorCreate(x + rx, y + ry));\r\n    }\r\n};\r\n\r\nlet limit = null;\r\nvar getWebGLTextureSizeLimit = () => {\r\n    if (limit !== null)\r\n        return limit;\r\n    let canvas = h('canvas');\r\n    const gl = getWebGLContext(canvas);\r\n    limit = gl ? gl.getParameter(gl.MAX_TEXTURE_SIZE) : undefined;\r\n    releaseCanvas(canvas);\r\n    canvas = undefined;\r\n    return limit;\r\n};\r\n\r\nlet result$6 = null;\r\nvar isFirefox = () => {\r\n    if (result$6 === null)\r\n        result$6 = isUserAgent(/Firefox/);\r\n    return result$6;\r\n};\r\n\r\n// prettier-ignore\r\n// B   D\r\n// | \\ |\r\n// A  C\r\nconst RECT_UV = new Float32Array([\r\n    0.0, 1.0,\r\n    0.0, 0.0,\r\n    1.0, 1.0,\r\n    1.0, 0.0, // D\r\n]);\r\n// prettier-ignore\r\n// BROWSER BUG FIX: Here to fix Firefox video texture rotation issue\r\nconst RECT_UV_ROTATED = new Float32Array([\r\n    1.0, 0.0,\r\n    0.0, 0.0,\r\n    1.0, 1.0,\r\n    0.0, 1.0, // D\r\n]);\r\nconst SHOULD_APPLY_ROTATED_UV_TO_VIDEO_TEXTURES = isBrowser() && isFirefox();\r\nconst CLARITY_IDENTITY = [0, 0, 0, 0, 1, 0, 0, 0, 0];\r\nconst COLOR_MATRIX_IDENTITY$1 = [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0];\r\nconst TEXTURE_TRANSPARENT_INDEX = 0;\r\nconst TEXTURE_PREVIEW_BLEND_INDEX = 1;\r\nconst TEXTURE_PREVIEW_OVERLAY_INDEX = 2;\r\nconst TEXTURE_PREVIEW_INDEX = 3;\r\nconst TEXTURE_SHAPE_INDEX = 4;\r\nconst COLOR_TRANSPARENT = [0, 0, 0, 0];\r\nconst NO_CORNERS = [0, 0, 0, 0];\r\nconst calculateBackgroundUVMap = (width, height, backgroundSize, backgroundPosition, viewPixelDensity) => {\r\n    if (!backgroundSize || !backgroundPosition)\r\n        return RECT_UV;\r\n    const x = backgroundPosition.x / backgroundSize.width;\r\n    const y = backgroundPosition.y / backgroundSize.height;\r\n    let w = width / backgroundSize.width / viewPixelDensity;\r\n    let h = height / backgroundSize.height / viewPixelDensity;\r\n    w -= x;\r\n    h -= y;\r\n    // prettier-ignore\r\n    // B   D\r\n    // | \\ |\r\n    // A  C\r\n    // bottom left\r\n    const ax = -x;\r\n    const ay = h;\r\n    // top left\r\n    const bx = -x;\r\n    const by = -y;\r\n    // bottom right\r\n    const cx = w;\r\n    const cy = h;\r\n    // top right\r\n    const dx = w;\r\n    const dy = -y;\r\n    return new Float32Array([\r\n        ax,\r\n        ay,\r\n        bx,\r\n        by,\r\n        cx,\r\n        cy,\r\n        dx,\r\n        dy, // D\r\n    ]);\r\n};\r\nconst limitCornerRadius = (r, size) => {\r\n    return Math.floor(clamp(r, 0, Math.min((size.width - 1) * 0.5, (size.height - 1) * 0.5)));\r\n};\r\nvar createWebGLCanvas = (canvas, options = {}) => {\r\n    // defaults\r\n    const { alpha = false } = options;\r\n    // go\r\n    const viewSize = { width: 0, height: 0 };\r\n    const viewSizeVisual = { width: 0, height: 0 };\r\n    const textureSizeLimit = getWebGLTextureSizeLimit() || 1024;\r\n    let viewAspectRatio;\r\n    let viewPixelDensity;\r\n    let pathSharpness;\r\n    const overlayMatrixCanvas = mat4Create();\r\n    const imageFrameBuffer = mat4Create();\r\n    let overlayMatrix;\r\n    let maskTop;\r\n    let maskRight;\r\n    let maskBottom;\r\n    let maskLeft;\r\n    let maskOpacity;\r\n    let maskBounds;\r\n    let IMAGE_MASK_FEATHER; // updated when viewport is resized\r\n    let RECT_MASK_FEATHER;\r\n    let CANVAS_COLOR_R = 0;\r\n    let CANVAS_COLOR_G = 0;\r\n    let CANVAS_COLOR_B = 0;\r\n    let CANVAS_COLOR_A = 1;\r\n    const indexTextureMap = new Map([]);\r\n    // resize view\r\n    const resize = (width, height, pixelDensity) => {\r\n        // density\r\n        viewPixelDensity = pixelDensity;\r\n        // set path sharpness factor so paths look a little nicer on low res displays\r\n        pathSharpness = viewPixelDensity === 1 ? 0.75 : 1;\r\n        // visual size\r\n        viewSizeVisual.width = width;\r\n        viewSizeVisual.height = height;\r\n        // size\r\n        viewSize.width = width * viewPixelDensity;\r\n        viewSize.height = height * viewPixelDensity;\r\n        // calculate the aspect ratio, we use this to determine quad size\r\n        viewAspectRatio = getAspectRatio(viewSize.width, viewSize.height);\r\n        // sync dimensions with image data\r\n        canvas.width = viewSize.width;\r\n        canvas.height = viewSize.height;\r\n        // update canvas markup matrix\r\n        mat4Ortho(overlayMatrixCanvas, 0, viewSize.width, viewSize.height, 0, -1, 1);\r\n        IMAGE_MASK_FEATHER = [1, 0, 1, 0, 1, viewSizeVisual.width, 1, viewSizeVisual.width];\r\n    };\r\n    const enablePreviewStencil = () => {\r\n        gl.stencilOp(gl.KEEP, gl.KEEP, gl.REPLACE);\r\n        gl.stencilFunc(gl.ALWAYS, 1, 0xff);\r\n        gl.stencilMask(0xff);\r\n    };\r\n    const applyPreviewStencil = () => {\r\n        gl.stencilFunc(gl.EQUAL, 1, 0xff);\r\n        gl.stencilMask(0x00);\r\n    };\r\n    const disablePreviewStencil = () => {\r\n        gl.stencilOp(gl.KEEP, gl.KEEP, gl.KEEP);\r\n        gl.stencilFunc(gl.ALWAYS, 1, 0xff);\r\n        gl.stencilMask(0xff);\r\n    };\r\n    // fov is fixed\r\n    const FOV = degToRad(30);\r\n    const FOV_TAN_HALF = Math.tan(FOV / 2);\r\n    // get gl drawing context\r\n    const gl = getWebGLContext(canvas, {\r\n        alpha,\r\n        antialias: false,\r\n        premultipliedAlpha: true,\r\n        stencil: true,\r\n    });\r\n    // no drawing context received, exit\r\n    if (!gl)\r\n        return;\r\n    // enable derivatives\r\n    gl.getExtension('OES_standard_derivatives');\r\n    // toggle gl settings\r\n    gl.disable(gl.DEPTH_TEST);\r\n    // need stencil to draw overlay on preview only\r\n    gl.enable(gl.STENCIL_TEST);\r\n    // set blend mode, we need it for alpha blending\r\n    gl.enable(gl.BLEND);\r\n    /*\r\n    https://webglfundamentals.org/webgl/lessons/webgl-and-alpha.html\r\n    most if not all Canvas 2D implementations work with pre-multiplied alpha.\r\n    That means when you transfer them to WebGL and UNPACK_PREMULTIPLY_ALPHA_WEBGL\r\n    is false WebGL will convert them back to un-premultipiled.\r\n    With pre-multiplied alpha on, [1, .5, .5, 0] does not exist, it's always [0, 0, 0, 0]\r\n    */\r\n    gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n    gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, isFirefox() ? false : true);\r\n    // something to look into:\r\n    // gl.UNPACK_COLORSPACE_CONVERSION_WEBGL\r\n    // stencil test always passes\r\n    disablePreviewStencil();\r\n    // let's create textures\r\n    const transparentTexture = gl.createTexture();\r\n    gl.bindTexture(gl.TEXTURE_2D, transparentTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, // width\r\n    1, // height\r\n    0, gl.RGBA, gl.UNSIGNED_BYTE, new Uint8Array(COLOR_TRANSPARENT) // transparent background\r\n    );\r\n    indexTextureMap.set(TEXTURE_TRANSPARENT_INDEX, transparentTexture);\r\n    // create image markup texture and framebuffer\r\n    const imageOverlayTexture = gl.createTexture();\r\n    indexTextureMap.set(TEXTURE_PREVIEW_OVERLAY_INDEX, imageOverlayTexture);\r\n    const overlayFramebuffer = gl.createFramebuffer();\r\n    // create image blend texture and framebuffer\r\n    const imageBlendTexture = gl.createTexture();\r\n    indexTextureMap.set(TEXTURE_PREVIEW_BLEND_INDEX, imageBlendTexture);\r\n    const blendFramebuffer = gl.createFramebuffer();\r\n    // #region image\r\n    // create default pixel drawing program, supports what we need\r\n    const imageShader = createShader(gl, imageVertexShader, imageFragmentShader, ['aPosition', 'aTexCoord'], [\r\n        'uMatrix',\r\n        'uTexture',\r\n        'uTextureBlend',\r\n        'uTextureOverlay',\r\n        'uTextureSize',\r\n        'uColorGamma',\r\n        'uColorVignette',\r\n        'uColorOffset',\r\n        'uColorMatrix',\r\n        'uClarityKernel',\r\n        'uClarityKernelWeight',\r\n        'uOpacity',\r\n        'uMaskOpacity',\r\n        'uMaskBounds',\r\n        'uMaskCornerRadius',\r\n        'uMaskFeather',\r\n        'uOverlayColor',\r\n        'uAntialias',\r\n    ]);\r\n    // create image buffers\r\n    const imagePositionsBuffer = gl.createBuffer();\r\n    const texturePositionsBuffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, texturePositionsBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, RECT_UV, gl.STATIC_DRAW);\r\n    // BROWSER BUG FIX: here to fix firefox video texture rotation issue\r\n    const texturePositionsRotatedBuffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, texturePositionsRotatedBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, RECT_UV_ROTATED, gl.STATIC_DRAW);\r\n    const drawImage = (texture, textureSize, originX, originY, translateX, translateY, rotateX, rotateY, rotateZ, scale, colorMatrix = COLOR_MATRIX_IDENTITY$1, opacity = 1, clarity, gamma = 1, vignette = 0, maskFeather = IMAGE_MASK_FEATHER, maskCornerRadius = NO_CORNERS, imageOverlayColor = COLOR_TRANSPARENT, enableOverlay = false, enableBlend = false, enableAntialiasing = true) => {\r\n        // update image texture\r\n        const imageWidth = textureSize.width * viewPixelDensity;\r\n        const imageHeight = textureSize.height * viewPixelDensity;\r\n        const l = imageWidth * -0.5;\r\n        const t = imageHeight * 0.5;\r\n        const r = imageWidth * 0.5;\r\n        const b = imageHeight * -0.5;\r\n        // prettier-ignore\r\n        // B   D\r\n        // | \\ |\r\n        // A  C\r\n        const imagePositions = new Float32Array([\r\n            l, b, 0,\r\n            l, t, 0,\r\n            r, b, 0,\r\n            r, t, 0, // D\r\n        ]);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, imagePositionsBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, imagePositions, gl.STATIC_DRAW);\r\n        // move image backwards so it's presented in actual pixel size\r\n        const viewZ = // 1. we calculate the z offset required to have the\r\n         \r\n        //    image height match the view height\r\n        /*        /|\r\n                 / |\r\n                /  | height / 2\r\n               /   |\r\n        f / 2 /__z_|\r\n              \\    |\r\n               \\   |\r\n                \\  |\r\n                 \\ |\r\n                  \\|\r\n        */\r\n        (textureSize.height / 2 / FOV_TAN_HALF) *\r\n            // 2. we want to render the image at the actual height, viewsize / height gets us results in a 1:1 presentation\r\n            (viewSize.height / textureSize.height) *\r\n            // 3. z has to be negative, therefor multiply by -1\r\n            -1;\r\n        // convert to pixel density\r\n        translateX *= viewPixelDensity;\r\n        translateY *= viewPixelDensity;\r\n        originX *= viewPixelDensity;\r\n        originY *= viewPixelDensity;\r\n        // get shader params\r\n        const { program, locations } = imageShader;\r\n        // apply\r\n        const matrix = mat4Create();\r\n        mat4Perspective(matrix, FOV, viewAspectRatio, 1, -viewZ * 2);\r\n        // move image\r\n        mat4Translate(matrix, translateX, -translateY, viewZ);\r\n        // set rotation origin in view\r\n        mat4Translate(matrix, originX, -originY, 0);\r\n        // rotate image\r\n        mat4RotateZ(matrix, -rotateZ);\r\n        // resize\r\n        mat4Scale(matrix, scale);\r\n        // reset rotation origin\r\n        mat4Translate(matrix, -originX, originY, 0);\r\n        // flip\r\n        mat4RotateY(matrix, rotateY);\r\n        mat4RotateX(matrix, rotateX);\r\n        //\r\n        // tell context to draw preview\r\n        //\r\n        gl.useProgram(program);\r\n        gl.enableVertexAttribArray(locations.aPosition);\r\n        gl.enableVertexAttribArray(locations.aTexCoord);\r\n        // set up texture\r\n        gl.uniform1i(locations.uTexture, TEXTURE_PREVIEW_INDEX);\r\n        gl.uniform2f(locations.uTextureSize, textureSize.width, textureSize.height);\r\n        gl.activeTexture(gl.TEXTURE0 + TEXTURE_PREVIEW_INDEX);\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        // set up blend texture\r\n        const blendTextureIndex = enableBlend\r\n            ? TEXTURE_PREVIEW_BLEND_INDEX\r\n            : TEXTURE_TRANSPARENT_INDEX;\r\n        const blendTexture = indexTextureMap.get(blendTextureIndex);\r\n        gl.uniform1i(locations.uTextureBlend, blendTextureIndex);\r\n        gl.activeTexture(gl.TEXTURE0 + blendTextureIndex);\r\n        gl.bindTexture(gl.TEXTURE_2D, blendTexture);\r\n        // set up markup texture\r\n        const overlayTextureIndex = enableOverlay\r\n            ? TEXTURE_PREVIEW_OVERLAY_INDEX\r\n            : TEXTURE_TRANSPARENT_INDEX;\r\n        const overlayTexture = indexTextureMap.get(overlayTextureIndex);\r\n        gl.uniform1i(locations.uTextureOverlay, overlayTextureIndex);\r\n        gl.activeTexture(gl.TEXTURE0 + overlayTextureIndex);\r\n        gl.bindTexture(gl.TEXTURE_2D, overlayTexture);\r\n        // set up buffers\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, imagePositionsBuffer);\r\n        gl.vertexAttribPointer(locations.aPosition, 3, gl.FLOAT, false, 0, 0);\r\n        // BROWSER BUG FIX: Here to fix Firefox bug with rotated video textures\r\n        const rotateUV = SHOULD_APPLY_ROTATED_UV_TO_VIDEO_TEXTURES && textureIsRotatedVideo(texture);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, rotateUV ? texturePositionsRotatedBuffer : texturePositionsBuffer);\r\n        gl.vertexAttribPointer(locations.aTexCoord, 2, gl.FLOAT, false, 0, 0);\r\n        // update matrix\r\n        gl.uniformMatrix4fv(locations.uMatrix, false, matrix);\r\n        // overlay color\r\n        gl.uniform4fv(locations.uOverlayColor, imageOverlayColor);\r\n        // convolution\r\n        let clarityWeight;\r\n        if (!clarity || arrayEqual(clarity, CLARITY_IDENTITY)) {\r\n            clarity = CLARITY_IDENTITY;\r\n            clarityWeight = -1;\r\n        }\r\n        else {\r\n            clarityWeight = clarity.reduce((prev, curr) => prev + curr, 0);\r\n            clarityWeight = clarityWeight <= 0 ? 1 : clarityWeight;\r\n        }\r\n        gl.uniform1fv(locations.uClarityKernel, clarity);\r\n        gl.uniform1f(locations.uClarityKernelWeight, clarityWeight);\r\n        gl.uniform1f(locations.uColorGamma, 1.0 / gamma);\r\n        gl.uniform1f(locations.uColorVignette, vignette);\r\n        gl.uniform1i(locations.uAntialias, enableAntialiasing ? 1 : 0);\r\n        // set color matrix values\r\n        gl.uniform4f(locations.uColorOffset, colorMatrix[4], colorMatrix[9], colorMatrix[14], colorMatrix[19]);\r\n        gl.uniformMatrix4fv(locations.uColorMatrix, false, [\r\n            colorMatrix[0],\r\n            colorMatrix[1],\r\n            colorMatrix[2],\r\n            colorMatrix[3],\r\n            colorMatrix[5],\r\n            colorMatrix[6],\r\n            colorMatrix[7],\r\n            colorMatrix[8],\r\n            colorMatrix[10],\r\n            colorMatrix[11],\r\n            colorMatrix[12],\r\n            colorMatrix[13],\r\n            colorMatrix[15],\r\n            colorMatrix[16],\r\n            colorMatrix[17],\r\n            colorMatrix[18],\r\n        ]);\r\n        // opacity level\r\n        gl.uniform1f(locations.uOpacity, opacity);\r\n        // mask\r\n        gl.uniform1f(locations.uMaskOpacity, maskOpacity);\r\n        gl.uniform1fv(locations.uMaskBounds, maskBounds);\r\n        gl.uniform1fv(locations.uMaskCornerRadius, maskCornerRadius.map((v) => v * viewPixelDensity));\r\n        gl.uniform1fv(locations.uMaskFeather, maskFeather.map((v, i) => (i % 2 === 0 ? v : v * viewPixelDensity)));\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n        gl.disableVertexAttribArray(locations.aPosition);\r\n        gl.disableVertexAttribArray(locations.aTexCoord);\r\n    };\r\n    //#endregion\r\n    // #region path\r\n    const pathShader = createShader(gl, pathVertexShader, pathFragmentShader, ['aPosition', 'aNormal', 'aMiter'], ['uColor', 'uCanvasColor', 'uMatrix', 'uWidth', 'uSharpness', 'uMaskBounds', 'uMaskOpacity']);\r\n    const pathBuffer = gl.createBuffer();\r\n    const strokePath = (points, width, color, close = false) => {\r\n        const { program, locations } = pathShader;\r\n        gl.useProgram(program);\r\n        gl.enableVertexAttribArray(locations.aPosition);\r\n        gl.enableVertexAttribArray(locations.aNormal);\r\n        gl.enableVertexAttribArray(locations.aMiter);\r\n        const vertices = createPathVertices(points, close);\r\n        const stride = Float32Array.BYTES_PER_ELEMENT * 5;\r\n        const normalOffset = Float32Array.BYTES_PER_ELEMENT * 2; // at position 2\r\n        const miterOffset = Float32Array.BYTES_PER_ELEMENT * 4; // at position 4\r\n        gl.uniform1f(locations.uWidth, width);\r\n        gl.uniform1f(locations.uSharpness, pathSharpness);\r\n        gl.uniform4fv(locations.uColor, color);\r\n        gl.uniformMatrix4fv(locations.uMatrix, false, overlayMatrix);\r\n        gl.uniform4f(locations.uCanvasColor, CANVAS_COLOR_R, CANVAS_COLOR_G, CANVAS_COLOR_B, CANVAS_COLOR_A);\r\n        gl.uniform1fv(locations.uMaskBounds, maskBounds);\r\n        gl.uniform1f(locations.uMaskOpacity, maskOpacity);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, pathBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\r\n        gl.vertexAttribPointer(locations.aPosition, 2, gl.FLOAT, false, stride, 0);\r\n        gl.vertexAttribPointer(locations.aNormal, 2, gl.FLOAT, false, stride, normalOffset);\r\n        gl.vertexAttribPointer(locations.aMiter, 1, gl.FLOAT, false, stride, miterOffset);\r\n        // gl.stencilMask(0xee);\r\n        // gl.stencilFunc(\r\n        //     gl.EQUAL, // the test\r\n        //     0, // reference value\r\n        //     0xee // mask\r\n        // );\r\n        // gl.stencilOp(\r\n        //     gl.KEEP, // what to do if the stencil test fails\r\n        //     gl.KEEP, // what to do if the depth test fails\r\n        //     gl.INCR // what to do if both tests pass\r\n        // );\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, vertices.length / 5);\r\n        // gl.clear(gl.STENCIL_BUFFER_BIT);\r\n        // gl.stencilMask(0xff);\r\n        gl.disableVertexAttribArray(locations.aPosition);\r\n        gl.disableVertexAttribArray(locations.aNormal);\r\n        gl.disableVertexAttribArray(locations.aMiter);\r\n    };\r\n    //#endregion\r\n    // #region triangle\r\n    const triangleShader = createShader(gl, triangleVertexShader, triangleFragmentShader, ['aPosition'], ['uColor', 'uCanvasColor', 'uMatrix', 'uMaskBounds', 'uMaskOpacity']);\r\n    const trianglesBuffer = gl.createBuffer();\r\n    const fillTriangles = (vertices, backgroundColor) => {\r\n        const { program, locations } = triangleShader;\r\n        gl.useProgram(program);\r\n        gl.enableVertexAttribArray(locations.aPosition);\r\n        gl.uniform4fv(locations.uColor, backgroundColor);\r\n        gl.uniformMatrix4fv(locations.uMatrix, false, overlayMatrix);\r\n        gl.uniform1fv(locations.uMaskBounds, maskBounds);\r\n        gl.uniform1f(locations.uMaskOpacity, maskOpacity);\r\n        gl.uniform4f(locations.uCanvasColor, CANVAS_COLOR_R, CANVAS_COLOR_G, CANVAS_COLOR_B, CANVAS_COLOR_A);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, trianglesBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\r\n        gl.vertexAttribPointer(locations.aPosition, 2, gl.FLOAT, false, 0, 0);\r\n        gl.drawArrays(gl.TRIANGLES, 0, vertices.length / 2);\r\n        gl.disableVertexAttribArray(locations.aPosition);\r\n        return vertices;\r\n    };\r\n    // const fillTriangles: (vertices: Float32Array, backgroundColor: number[]) => {};\r\n    //#endregion\r\n    // #region rect\r\n    const rectShaderAttributes = ['aPosition', 'aTexCoord', 'aRectCoord'];\r\n    const rectShaderUniforms = [\r\n        'uTexture',\r\n        'uColor',\r\n        'uMatrix',\r\n        'uCanvasColor',\r\n        'uTextureColor',\r\n        'uTextureOpacity',\r\n        'uPosition',\r\n        'uSize',\r\n        'uMaskBounds',\r\n        'uMaskOpacity',\r\n        'uMaskFeather',\r\n        'uCornerRadius',\r\n        'uInverted',\r\n    ];\r\n    const rectShader = createShader(gl, rectVertexShader, rectFragmentShader, rectShaderAttributes, rectShaderUniforms);\r\n    const rectBuffer = gl.createBuffer();\r\n    const rectTextureBuffer = gl.createBuffer();\r\n    const rectCornerBuffer = gl.createBuffer();\r\n    const fillRect = (vertices, width, height, cornerRadius, backgroundColor, backgroundImage = transparentTexture, opacity = 1.0, colorFilter = COLOR_TRANSPARENT, uv = RECT_UV, maskFeather = RECT_MASK_FEATHER, inverted) => {\r\n        const { program, locations } = rectShader;\r\n        gl.useProgram(program);\r\n        gl.enableVertexAttribArray(locations.aPosition);\r\n        gl.enableVertexAttribArray(locations.aTexCoord);\r\n        gl.enableVertexAttribArray(locations.aRectCoord);\r\n        gl.uniform4fv(locations.uColor, backgroundColor);\r\n        gl.uniform2fv(locations.uSize, [width, height]);\r\n        gl.uniform2fv(locations.uPosition, [vertices[2], vertices[3]]);\r\n        gl.uniform1i(locations.uInverted, inverted ? 1 : 0);\r\n        gl.uniform1fv(locations.uCornerRadius, cornerRadius);\r\n        gl.uniform4f(locations.uCanvasColor, CANVAS_COLOR_R, CANVAS_COLOR_G, CANVAS_COLOR_B, CANVAS_COLOR_A);\r\n        // mask\r\n        gl.uniform1fv(locations.uMaskFeather, maskFeather.map((v, i) => (i % 2 === 0 ? v : v * viewPixelDensity)));\r\n        gl.uniform1fv(locations.uMaskBounds, maskBounds);\r\n        gl.uniform1f(locations.uMaskOpacity, maskOpacity);\r\n        gl.uniformMatrix4fv(locations.uMatrix, false, overlayMatrix);\r\n        gl.uniform1i(locations.uTexture, TEXTURE_SHAPE_INDEX);\r\n        gl.uniform4fv(locations.uTextureColor, colorFilter);\r\n        gl.uniform1f(locations.uTextureOpacity, opacity);\r\n        gl.activeTexture(gl.TEXTURE0 + TEXTURE_SHAPE_INDEX);\r\n        gl.bindTexture(gl.TEXTURE_2D, backgroundImage);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, rectTextureBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, uv, gl.STATIC_DRAW);\r\n        gl.vertexAttribPointer(locations.aTexCoord, 2, gl.FLOAT, false, 0, 0);\r\n        // we use these coordinates combined with the size of the rect to interpolate and alias edges\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, rectCornerBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, RECT_UV, gl.STATIC_DRAW);\r\n        gl.vertexAttribPointer(locations.aRectCoord, 2, gl.FLOAT, false, 0, 0);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, rectBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\r\n        gl.vertexAttribPointer(locations.aPosition, 2, gl.FLOAT, false, 0, 0);\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, vertices.length / 2);\r\n        gl.disableVertexAttribArray(locations.aPosition);\r\n        gl.disableVertexAttribArray(locations.aTexCoord);\r\n        gl.disableVertexAttribArray(locations.aRectCoord);\r\n        return vertices;\r\n    };\r\n    //#endregion\r\n    // #region ellipse\r\n    const ellipseShader = createShader(gl, ellipseVertexShader, ellipseFragmentShader, ['aPosition', 'aTexCoord'], [\r\n        'uTexture',\r\n        'uTextureOpacity',\r\n        'uColor',\r\n        'uCanvasColor',\r\n        'uMatrix',\r\n        'uRadius',\r\n        'uInverted',\r\n        'uMaskBounds',\r\n        'uMaskOpacity',\r\n    ]);\r\n    const ellipseBuffer = gl.createBuffer();\r\n    const ellipseTextureBuffer = gl.createBuffer();\r\n    const fillEllipse = (vertices, width, height, backgroundColor, backgroundImage = transparentTexture, uv = RECT_UV, opacity = 1.0, inverted = false) => {\r\n        const { program, locations } = ellipseShader;\r\n        gl.useProgram(program);\r\n        gl.enableVertexAttribArray(locations.aPosition);\r\n        gl.enableVertexAttribArray(locations.aTexCoord);\r\n        gl.uniformMatrix4fv(locations.uMatrix, false, overlayMatrix);\r\n        gl.uniform2fv(locations.uRadius, [width * 0.5, height * 0.5]);\r\n        gl.uniform1i(locations.uInverted, inverted ? 1 : 0);\r\n        gl.uniform4fv(locations.uColor, backgroundColor);\r\n        gl.uniform4f(locations.uCanvasColor, CANVAS_COLOR_R, CANVAS_COLOR_G, CANVAS_COLOR_B, CANVAS_COLOR_A);\r\n        gl.uniform1fv(locations.uMaskBounds, maskBounds);\r\n        gl.uniform1f(locations.uMaskOpacity, maskOpacity);\r\n        gl.uniform1i(locations.uTexture, TEXTURE_SHAPE_INDEX);\r\n        gl.uniform1f(locations.uTextureOpacity, opacity);\r\n        gl.activeTexture(gl.TEXTURE0 + TEXTURE_SHAPE_INDEX);\r\n        gl.bindTexture(gl.TEXTURE_2D, backgroundImage);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, ellipseTextureBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, uv, gl.STATIC_DRAW);\r\n        gl.vertexAttribPointer(locations.aTexCoord, 2, gl.FLOAT, false, 0, 0);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, ellipseBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\r\n        gl.vertexAttribPointer(locations.aPosition, 2, gl.FLOAT, false, 0, 0);\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, vertices.length / 2);\r\n        gl.disableVertexAttribArray(locations.aPosition);\r\n        gl.disableVertexAttribArray(locations.aTexCoord);\r\n    };\r\n    //#endregion\r\n    //\r\n    // draw calls\r\n    //\r\n    const drawPath = (points, rotation = 0, // not implemented yet\r\n    flipX = false, // not implemented yet\r\n    flipY = false, // not implemented yet\r\n    strokeWidth, strokeColor, strokeClose, backgroundColor, opacity) => {\r\n        // is no line\r\n        if (points.length < 2)\r\n            return;\r\n        // manipulate points\r\n        const computedPoints = points.map((p) => ({\r\n            x: p.x * viewPixelDensity,\r\n            y: p.y * viewPixelDensity,\r\n        }));\r\n        // const center = convexPolyCentroid(clonedPoints);\r\n        // if (flipX || flipY) vectorsFlip(clonedPoints, flipX, flipY, center.x, center.y);\r\n        // if (rotation !== 0) vectorsRotate(clonedPoints, rotation, center.x, center.y);\r\n        const computedStrokeWidth = strokeWidth * viewPixelDensity;\r\n        // stroke\r\n        if (computedStrokeWidth > 0)\r\n            strokePath(computedPoints, computedStrokeWidth, applyOpacity(strokeColor, opacity), strokeClose);\r\n        // need to fill polygon?\r\n        if (computedPoints.length < 3 ||\r\n            !backgroundColor ||\r\n            backgroundColor[3] === 0 ||\r\n            !strokeClose)\r\n            return;\r\n        const triangles = triangulate(computedPoints);\r\n        const vertices = new Float32Array(triangles.length * 6);\r\n        triangles.forEach(([a, b, c], i) => {\r\n            const index = i * 6;\r\n            vertices[index + 0] = a.x;\r\n            vertices[index + 1] = a.y;\r\n            vertices[index + 2] = b.x;\r\n            vertices[index + 3] = b.y;\r\n            vertices[index + 4] = c.x;\r\n            vertices[index + 5] = c.y;\r\n        });\r\n        fillTriangles(vertices, applyOpacity(backgroundColor, opacity));\r\n    };\r\n    const drawRect = (rect, rotation = 0, flipX = false, flipY = false, cornerRadius, backgroundColor, backgroundImage, backgroundSize = undefined, backgroundPosition = undefined, backgroundUVMap = undefined, strokeWidth, strokeColor, opacity, maskFeather = undefined, colorize, inverted) => {\r\n        // clone first\r\n        const rectOut = rectMultiply(rectClone$1(rect), viewPixelDensity);\r\n        // has radius, doesn't matter for coordinates\r\n        const cornerRadiusOut = cornerRadius\r\n            .map((r) => limitCornerRadius(r || 0, rect))\r\n            .map((r) => r * viewPixelDensity);\r\n        // should fill\r\n        if (backgroundColor || backgroundImage) {\r\n            // adjust for edge anti-aliasing, if we don't do this the\r\n            // visible rectangle will be 1 pixel smaller than the actual rectangle\r\n            const rectFill = rectClone$1(rectOut);\r\n            rectFill.x -= 0.5;\r\n            rectFill.y -= 0.5;\r\n            rectFill.width += 1;\r\n            rectFill.height += 1;\r\n            const points = createRectPoints(rectFill, rotation, flipX, flipY);\r\n            const vertices = rectPointsToVertices(points);\r\n            let color;\r\n            if (colorize) {\r\n                color = applyOpacity(colorize);\r\n                // as 0 transparancy is used to test if the colorize filter should be applied we set it to 0.001\r\n                if (color[3] === 0)\r\n                    color[3] = 0.001;\r\n            }\r\n            fillRect(vertices, rectFill.width, rectFill.height, cornerRadiusOut, applyOpacity(backgroundColor, opacity), backgroundImage, opacity, color, backgroundUVMap\r\n                ? new Float32Array(backgroundUVMap)\r\n                : calculateBackgroundUVMap(rectFill.width, rectFill.height, backgroundSize, backgroundPosition, viewPixelDensity), maskFeather, inverted);\r\n        }\r\n        // should draw outline\r\n        if (strokeWidth) {\r\n            // fixes issue where stroke would render weirdly\r\n            strokeWidth = Math.min(strokeWidth, rectOut.width, rectOut.height);\r\n            strokePath(\r\n            // rect out is already multiplied by pixel density\r\n            createRectOutline(rectOut.x, rectOut.y, rectOut.width, rectOut.height, rotation, cornerRadiusOut, flipX, flipY), strokeWidth * viewPixelDensity, applyOpacity(strokeColor, opacity), true);\r\n        }\r\n    };\r\n    const drawEllipse = (center, rx, ry, rotation, flipX, flipY, backgroundColor, backgroundImage, backgroundSize = undefined, backgroundPosition = undefined, backgroundUVMap = undefined, strokeWidth, strokeColor, opacity, inverted) => {\r\n        const rectOut = rectMultiply(rectCreate(center.x - rx, center.y - ry, rx * 2, ry * 2), viewPixelDensity);\r\n        if (backgroundColor || backgroundImage) {\r\n            // adjust for edge anti-aliasing, if we don't do this the\r\n            // visible rectangle will be 1 pixel smaller than the actual rectangle\r\n            const rectFill = rectClone$1(rectOut);\r\n            rectFill.x -= 0.5;\r\n            rectFill.y -= 0.5;\r\n            rectFill.width += 1.0;\r\n            rectFill.height += 1.0;\r\n            const points = createRectPoints(rectFill, rotation, flipX, flipY);\r\n            const vertices = rectPointsToVertices(points);\r\n            fillEllipse(vertices, rectFill.width, rectFill.height, applyOpacity(backgroundColor, opacity), backgroundImage, backgroundUVMap\r\n                ? new Float32Array(backgroundUVMap)\r\n                : calculateBackgroundUVMap(rectFill.width, rectFill.height, backgroundSize, backgroundPosition, viewPixelDensity), opacity, inverted);\r\n        }\r\n        if (strokeWidth)\r\n            strokePath(\r\n            // rect out is already multiplied by pixeldensity\r\n            createEllipseOutline(rectOut.x, rectOut.y, rectOut.width, rectOut.height, rotation, flipX, flipY), strokeWidth * viewPixelDensity, applyOpacity(strokeColor, opacity), true);\r\n    };\r\n    //#endregion\r\n    const glTextures = new Map();\r\n    const imageFramebufferSize = {};\r\n    imageFramebufferSize[TEXTURE_PREVIEW_OVERLAY_INDEX] = { width: 0, height: 0 };\r\n    imageFramebufferSize[TEXTURE_PREVIEW_BLEND_INDEX] = { width: 0, height: 0 };\r\n    const imageFrameBufferMaxSize = 4096;\r\n    const drawToImageFramebuffer = (index, buffer, imageSize, pixelDensity = 1) => {\r\n        const textureScalar = Math.min(Math.min(imageFrameBufferMaxSize, textureSizeLimit) / imageSize.width, Math.min(imageFrameBufferMaxSize, textureSizeLimit) / imageSize.height, pixelDensity);\r\n        const textureWidth = Math.floor(textureScalar * imageSize.width);\r\n        const textureHeight = Math.floor(textureScalar * imageSize.height);\r\n        if (!sizeEqual(imageSize, imageFramebufferSize[index])) {\r\n            // update preview markup texture\r\n            gl.bindTexture(gl.TEXTURE_2D, indexTextureMap.get(index));\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, textureWidth, textureHeight, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n            // set the filtering, we don't need mips\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, buffer);\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, indexTextureMap.get(index), 0);\r\n            // remember so we know when to update the framebuffer\r\n            imageFramebufferSize[index] = imageSize;\r\n        }\r\n        else {\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, buffer);\r\n        }\r\n        // switch transformMatrix\r\n        const w = imageSize.width * viewPixelDensity;\r\n        const h = imageSize.height * viewPixelDensity;\r\n        mat4Ortho(imageFrameBuffer, 0, w, h, 0, -1, 1);\r\n        mat4Translate(imageFrameBuffer, 0, h, 0);\r\n        mat4ScaleX(imageFrameBuffer, 1);\r\n        mat4ScaleY(imageFrameBuffer, -1);\r\n        overlayMatrix = imageFrameBuffer;\r\n        // framebuffer lives in image space\r\n        gl.viewport(0, 0, textureWidth, textureHeight);\r\n        // always transparent\r\n        gl.colorMask(true, true, true, true);\r\n        gl.clearColor(0, 0, 0, 0);\r\n        gl.clear(gl.COLOR_BUFFER_BIT);\r\n        // update rect mask\r\n        RECT_MASK_FEATHER = [\r\n            1,\r\n            0,\r\n            1,\r\n            0,\r\n            1,\r\n            Math.max(viewSize.width, imageSize.width),\r\n            1,\r\n            Math.max(viewSize.width, imageSize.width),\r\n        ];\r\n    };\r\n    const textureDelete = (texture, forceRelease = false) => {\r\n        const { src } = glTextures.get(texture);\r\n        if (src instanceof HTMLCanvasElement) {\r\n            if (!forceRelease && !src.dataset.retain) {\r\n                releaseCanvas(src);\r\n            }\r\n        }\r\n        glTextures.delete(texture);\r\n        gl.deleteTexture(texture);\r\n    };\r\n    const resetCanvasMatrix = () => {\r\n        mat4Ortho(overlayMatrixCanvas, 0, viewSize.width, viewSize.height, 0, -1, 1);\r\n    };\r\n    const textureIsRotatedVideo = (texture) => glTextures.get(texture).isRotatedVideo;\r\n    return {\r\n        // draw api\r\n        drawPath,\r\n        drawRect,\r\n        drawEllipse,\r\n        drawImage,\r\n        // texture filters\r\n        textureFilterNearest: gl.NEAREST,\r\n        textureFilterLinear: gl.LINEAR,\r\n        //#region texture management\r\n        textureCreate: () => {\r\n            return gl.createTexture();\r\n        },\r\n        textureUpdate: (texture, source, options) => {\r\n            glTextures.set(texture, {\r\n                src: source,\r\n                options,\r\n                isRotatedVideo: source.nodeName === 'VIDEO' &&\r\n                    ((source.dataset && source.dataset.rotation == 90) ||\r\n                        source.dataset.rotation == 270),\r\n            });\r\n            return updateTexture(gl, texture, source, options);\r\n        },\r\n        textureGetSize: (texture) => {\r\n            const { src, options } = glTextures.get(texture);\r\n            const size = sizeCreateFromAny(src);\r\n            if (options.scalar)\r\n                return sizeApply(size, (v) => v / options.scalar);\r\n            return size;\r\n        },\r\n        textureDelete,\r\n        //#endregion\r\n        enablePreviewStencil,\r\n        applyPreviewStencil,\r\n        disablePreviewStencil,\r\n        setCanvasColor(color) {\r\n            CANVAS_COLOR_R = color[0];\r\n            CANVAS_COLOR_G = color[1];\r\n            CANVAS_COLOR_B = color[2];\r\n            CANVAS_COLOR_A = alpha ? color[3] : 1;\r\n            gl.clear(gl.COLOR_BUFFER_BIT);\r\n        },\r\n        resetCanvasMatrix,\r\n        updateCanvasMatrix(imageSize, origin, translation, scale, rotate) {\r\n            const imageWidth = imageSize.width;\r\n            const imageHeight = imageSize.height;\r\n            const originX = viewSize.width * (0.5 / viewPixelDensity);\r\n            const originY = viewSize.height * (0.5 / viewPixelDensity);\r\n            const imageOrigin = {\r\n                x: originX + (translation.x + origin.x),\r\n                y: originY + (translation.y + origin.y),\r\n            };\r\n            const imageVisualCenter = {\r\n                x: imageOrigin.x - origin.x,\r\n                y: imageOrigin.y - origin.y,\r\n            };\r\n            const imageAbsoluteCenter = {\r\n                x: imageWidth * 0.5,\r\n                y: imageHeight * 0.5,\r\n            };\r\n            vectorRotate(imageVisualCenter, rotate.z, imageOrigin);\r\n            vectorScale(imageVisualCenter, scale, imageOrigin);\r\n            const imageTranslation = {\r\n                x: imageVisualCenter.x - imageAbsoluteCenter.x,\r\n                y: imageVisualCenter.y - imageAbsoluteCenter.y,\r\n            };\r\n            mat4Translate(overlayMatrixCanvas, imageTranslation.x * viewPixelDensity, imageTranslation.y * viewPixelDensity, 0);\r\n            // we apply transforms from center of image\r\n            mat4Translate(overlayMatrixCanvas, imageAbsoluteCenter.x * viewPixelDensity, imageAbsoluteCenter.y * viewPixelDensity, 0);\r\n            mat4RotateZ(overlayMatrixCanvas, rotate.z);\r\n            const flipX = rotate.x > Math.PI / 2;\r\n            mat4RotateX(overlayMatrixCanvas, flipX ? Math.PI : 0);\r\n            const flipY = rotate.y > Math.PI / 2;\r\n            mat4RotateY(overlayMatrixCanvas, flipY ? Math.PI : 0);\r\n            mat4Scale(overlayMatrixCanvas, scale);\r\n            mat4Translate(overlayMatrixCanvas, -imageAbsoluteCenter.x * viewPixelDensity, -imageAbsoluteCenter.y * viewPixelDensity, 0);\r\n        },\r\n        drawToCanvas() {\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n            // switch transformMatrix\r\n            overlayMatrix = overlayMatrixCanvas;\r\n            // tell webgl about the viewport\r\n            gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\r\n            // black (or other color depending on background)\r\n            gl.colorMask(true, true, true, true);\r\n            gl.clearColor(CANVAS_COLOR_R, CANVAS_COLOR_G, CANVAS_COLOR_B, CANVAS_COLOR_A);\r\n            // gl.clearColor(0.25, 0.25, 0.25, 1); // for debugging\r\n            gl.clear(gl.COLOR_BUFFER_BIT);\r\n            // update rect mask\r\n            RECT_MASK_FEATHER = [1, 0, 1, 0, 1, viewSize.width, 1, viewSize.width];\r\n        },\r\n        drawToImageBlendBuffer(imageSize, pixelDensity) {\r\n            drawToImageFramebuffer(TEXTURE_PREVIEW_BLEND_INDEX, blendFramebuffer, imageSize, pixelDensity);\r\n        },\r\n        drawToImageOverlayBuffer(imageSize, pixelDensity) {\r\n            drawToImageFramebuffer(TEXTURE_PREVIEW_OVERLAY_INDEX, overlayFramebuffer, imageSize, pixelDensity);\r\n        },\r\n        // set mask\r\n        enableMask(rect, opacity) {\r\n            const maskX = rect.x * viewPixelDensity;\r\n            const maskY = rect.y * viewPixelDensity;\r\n            const maskWidth = rect.width * viewPixelDensity;\r\n            const maskHeight = rect.height * viewPixelDensity;\r\n            maskLeft = maskX;\r\n            maskRight = maskLeft + maskWidth;\r\n            maskTop = viewSize.height - maskY;\r\n            maskBottom = viewSize.height - (maskY + maskHeight);\r\n            maskOpacity = 1.0 - opacity;\r\n            maskBounds = [maskTop, maskRight, maskBottom, maskLeft];\r\n        },\r\n        disableMask() {\r\n            maskLeft = 0;\r\n            maskRight = viewSize.width;\r\n            maskTop = viewSize.height;\r\n            maskBottom = 0;\r\n            maskOpacity = 1;\r\n            maskBounds = [maskTop, maskRight, maskBottom, maskLeft];\r\n        },\r\n        // canvas\r\n        resize,\r\n        release() {\r\n            // remove all stored textures\r\n            const textures = Array.from(glTextures.keys());\r\n            textures.forEach((texture) => textureDelete(texture, true));\r\n            glTextures.clear();\r\n            // remove indexed textures\r\n            indexTextureMap.forEach((texture) => {\r\n                gl.deleteTexture(texture);\r\n            });\r\n            indexTextureMap.clear();\r\n            // clean up shaders\r\n            imageShader.destroy();\r\n            pathShader.destroy();\r\n            triangleShader.destroy();\r\n            rectShader.destroy();\r\n            ellipseShader.destroy();\r\n            // clear canvas\r\n            canvas.width = 1;\r\n            canvas.height = 1;\r\n            canvas = undefined;\r\n        },\r\n    };\r\n};\r\n\r\nvar numberToEven = (n) => (n % 2 == 0 ? n : n + 1);\r\n\r\nvar imageStateToCanvas = (src, imageState, options) => {\r\n    const { targetCanvas, targetSize, disableDraw = false } = options || {};\r\n    const canvas = targetCanvas || document.createElement('canvas');\r\n    const { crop, colorMatrix, convolutionMatrix } = imageState;\r\n    const isVideoSrc = isVideoElement(src);\r\n    const srcSize = {\r\n        width: isVideoSrc ? src.videoWidth : src.width,\r\n        height: isVideoSrc ? src.videoHeight : src.height,\r\n    };\r\n    // calculate target bounds dimensions\r\n    const { upscale = false, fit = 'contain', width: targetWidth, height: targetHeight, } = targetSize || {};\r\n    // scale canvas\r\n    let canvasScalar = 1;\r\n    if (fit === 'contain') {\r\n        canvasScalar = Math.min((targetWidth || Number.MAX_SAFE_INTEGER) / crop.width, (targetHeight || Number.MAX_SAFE_INTEGER) / crop.height);\r\n    }\r\n    else if (fit === 'cover') {\r\n        canvasScalar = Math.max((targetWidth || crop.width) / crop.width, (targetHeight || crop.height) / crop.height);\r\n    }\r\n    // can't upscale, let's limit scalar to 1\r\n    if (!upscale)\r\n        canvasScalar = Math.min(canvasScalar, 1);\r\n    const canvasScaledWidth = Math.floor(crop.width * canvasScalar);\r\n    const canvasScaledHeight = Math.floor(crop.height * canvasScalar);\r\n    const canvasWidth = isVideoSrc ? numberToEven(canvasScaledWidth) : canvasScaledWidth;\r\n    const canvasHeight = isVideoSrc ? numberToEven(canvasScaledHeight) : canvasScaledHeight;\r\n    const glCanvas = createWebGLCanvas(canvas);\r\n    glCanvas.resize(canvasWidth, canvasHeight, 1);\r\n    const glTexture = glCanvas.textureCreate();\r\n    glCanvas.drawToCanvas();\r\n    glCanvas.disableMask();\r\n    glCanvas.disablePreviewStencil();\r\n    // color matrix\r\n    let computedColorMatrix;\r\n    {\r\n        const colorMatrices = Object.values(colorMatrix || {}).filter(Boolean);\r\n        if (colorMatrices.length)\r\n            computedColorMatrix = getColorMatrixFromColorMatrices(colorMatrices);\r\n    }\r\n    const canvasRect = { x: 0, y: 0, width: canvasWidth, height: canvasHeight };\r\n    const { origin, translation, rotation, scale } = calculateImageTransforms(canvasRect, canvasRect, srcSize, crop, {\r\n        x: 0,\r\n        y: 0,\r\n        width: canvasWidth,\r\n        height: canvasHeight,\r\n    }, canvasScalar, { x: 0, y: 0 }, 1, imageState.rotation, imageState.flipX, imageState.flipY);\r\n    const glTransforms = [\r\n        srcSize,\r\n        origin.x,\r\n        origin.y,\r\n        translation.x,\r\n        translation.y,\r\n        rotation.x,\r\n        rotation.y,\r\n        rotation.z,\r\n        scale,\r\n        computedColorMatrix,\r\n        1,\r\n        // @ts-ignore\r\n        convolutionMatrix && convolutionMatrix.clarity,\r\n        isNumber(imageState.gamma) ? imageState.gamma : 1,\r\n        imageState.vignette || 0,\r\n        [1, 0, 1, 0, 1, canvasHeight, 1, canvasWidth],\r\n        undefined,\r\n        undefined,\r\n        undefined,\r\n        undefined,\r\n        false,\r\n    ];\r\n    const updateTexture = () => {\r\n        glCanvas.textureUpdate(glTexture, src, {\r\n            filter: glCanvas.textureFilterLinear,\r\n        });\r\n    };\r\n    const draw = () => {\r\n        // make sure texture is at the correct frame when it's a video\r\n        updateTexture();\r\n        // draw to the canvas\r\n        glCanvas.drawImage(glTexture, ...glTransforms);\r\n    };\r\n    // load texture\r\n    updateTexture();\r\n    // first draw\r\n    !disableDraw && draw();\r\n    return {\r\n        canvas,\r\n        redraw: draw,\r\n    };\r\n};\r\n\r\nvar scrambleEffect = (options, done) => {\r\n    const { imageData, amount = 1 } = options;\r\n    const intensity = Math.round(Math.max(1, amount) * 2);\r\n    const range = Math.round(intensity * 0.5);\r\n    const inputWidth = imageData.width;\r\n    const inputHeight = imageData.height;\r\n    const outputData = new Uint8ClampedArray(inputWidth * inputHeight * 4);\r\n    const inputData = imageData.data;\r\n    let randomData;\r\n    let i = 0, x, y, r;\r\n    let xoffset = 0;\r\n    let yoffset = 0;\r\n    let index;\r\n    const l = inputWidth * inputHeight * 4 - 4;\r\n    for (y = 0; y < inputHeight; y++) {\r\n        randomData = crypto.getRandomValues(new Uint8ClampedArray(inputHeight));\r\n        for (x = 0; x < inputWidth; x++) {\r\n            r = randomData[y] / 255;\r\n            xoffset = 0;\r\n            yoffset = 0;\r\n            if (r < 0.5) {\r\n                xoffset = (-range + Math.round(Math.random() * intensity)) * 4;\r\n            }\r\n            if (r > 0.5) {\r\n                yoffset = (-range + Math.round(Math.random() * intensity)) * (inputWidth * 4);\r\n            }\r\n            // limit to image data\r\n            index = Math.min(Math.max(0, i + xoffset + yoffset), l);\r\n            outputData[i] = inputData[index];\r\n            outputData[i + 1] = inputData[index + 1];\r\n            outputData[i + 2] = inputData[index + 2];\r\n            outputData[i + 3] = inputData[index + 3];\r\n            i += 4;\r\n        }\r\n    }\r\n    // @ts-ignore\r\n    done(null, {\r\n        data: outputData,\r\n        width: imageData.width,\r\n        height: imageData.height,\r\n    });\r\n};\r\n\r\n// basic blur covolution matrix\r\nconst BLUR_MATRIX = [0.0625, 0.125, 0.0625, 0.125, 0.25, 0.125, 0.0625, 0.125, 0.0625];\r\nvar imageDataScramble = async (inputData, options = {}) => {\r\n    if (!inputData)\r\n        return;\r\n    const { width, height } = inputData;\r\n    const { dataSize = 96, dataSizeScalar = 1, scrambleAmount = 4, blurAmount = 6, outputFormat = 'canvas', backgroundColor = [0, 0, 0], } = options;\r\n    const size = Math.round(dataSize * dataSizeScalar);\r\n    const scalar = Math.min(size / width, size / height);\r\n    const outputWidth = Math.floor(width * scalar);\r\n    const outputHeight = Math.floor(height * scalar);\r\n    // draw low res preview, add margin so blur isn't transparent\r\n    const scaledOutputCanvas = (h('canvas', { width: outputWidth, height: outputHeight }));\r\n    const ctx = scaledOutputCanvas.getContext('2d');\r\n    // fill background on transparent images\r\n    backgroundColor.length = 3; // prevent transparent colors\r\n    ctx.fillStyle = colorArrayToRGBA(backgroundColor);\r\n    ctx.fillRect(0, 0, outputWidth, outputHeight);\r\n    if (isImageData(inputData)) {\r\n        // temporarily draw to canvas so we can draw image data to scaled context\r\n        const transferCanvas = h('canvas', { width, height });\r\n        transferCanvas.getContext('2d').putImageData(inputData, 0, 0);\r\n        // draw to scaled context\r\n        ctx.drawImage(transferCanvas, 0, 0, outputWidth, outputHeight);\r\n        // release memory\r\n        releaseCanvas(transferCanvas);\r\n    }\r\n    else {\r\n        // bitmap data\r\n        ctx.drawImage(inputData, 0, 0, outputWidth, outputHeight);\r\n    }\r\n    // get scaled image data for scrambling\r\n    const imageData = ctx.getImageData(0, 0, outputWidth, outputHeight);\r\n    // filters to apply\r\n    const filters = [];\r\n    // add scramble filter\r\n    if (scrambleAmount > 0)\r\n        filters.push([scrambleEffect, { amount: scrambleAmount }]);\r\n    // add blur filters\r\n    if (blurAmount > 0)\r\n        for (let i = 0; i < blurAmount; i++) {\r\n            filters.push([convolutionEffect, { matrix: BLUR_MATRIX }]);\r\n        }\r\n    let imageDataScrambled;\r\n    if (filters.length) {\r\n        // builds effect chain\r\n        const chain = (transforms, i) => `(err, imageData) => {\r\n                (${transforms[i][0].toString()})(Object.assign({ imageData: imageData }, filterInstructions[${i}]), \r\n                    ${transforms[i + 1] ? chain(transforms, i + 1) : 'done'})\r\n            }`;\r\n        const filterChain = `function (options, done) {\r\n            const filterInstructions = options.filterInstructions;\r\n            const imageData = options.imageData;\r\n            (${chain(filters, 0)})(null, imageData)\r\n        }`;\r\n        // scramble image data in separate thread\r\n        const imageDataObjectScrambled = await thread(filterChain, [\r\n            {\r\n                imageData: imageData,\r\n                filterInstructions: filters.map((t) => t[1]),\r\n            },\r\n        ], [imageData.data.buffer]);\r\n        imageDataScrambled = imageDataObjectToImageData(imageDataObjectScrambled);\r\n    }\r\n    else {\r\n        imageDataScrambled = imageData;\r\n    }\r\n    if (outputFormat === 'canvas') {\r\n        // put back scrambled data\r\n        ctx.putImageData(imageDataScrambled, 0, 0);\r\n        // return canvas\r\n        return scaledOutputCanvas;\r\n    }\r\n    return imageDataScrambled;\r\n};\r\n\r\nfunction circOut(t) {\r\n    return Math.sqrt(1 - --t * t);\r\n}\r\n\r\nfunction is_date(obj) {\r\n    return Object.prototype.toString.call(obj) === '[object Date]';\r\n}\r\n\r\nfunction get_interpolator(a, b) {\r\n    if (a === b || a !== a)\r\n        return () => a;\r\n    const type = typeof a;\r\n    if (type !== typeof b || Array.isArray(a) !== Array.isArray(b)) {\r\n        throw new Error('Cannot interpolate values of different type');\r\n    }\r\n    if (Array.isArray(a)) {\r\n        const arr = b.map((bi, i) => {\r\n            return get_interpolator(a[i], bi);\r\n        });\r\n        return t => arr.map(fn => fn(t));\r\n    }\r\n    if (type === 'object') {\r\n        if (!a || !b)\r\n            throw new Error('Object cannot be null');\r\n        if (is_date(a) && is_date(b)) {\r\n            a = a.getTime();\r\n            b = b.getTime();\r\n            const delta = b - a;\r\n            return t => new Date(a + t * delta);\r\n        }\r\n        const keys = Object.keys(b);\r\n        const interpolators = {};\r\n        keys.forEach(key => {\r\n            interpolators[key] = get_interpolator(a[key], b[key]);\r\n        });\r\n        return t => {\r\n            const result = {};\r\n            keys.forEach(key => {\r\n                result[key] = interpolators[key](t);\r\n            });\r\n            return result;\r\n        };\r\n    }\r\n    if (type === 'number') {\r\n        const delta = b - a;\r\n        return t => a + t * delta;\r\n    }\r\n    throw new Error(`Cannot interpolate ${type} values`);\r\n}\r\nfunction tweened(value, defaults = {}) {\r\n    const store = writable(value);\r\n    let task;\r\n    let target_value = value;\r\n    function set(new_value, opts) {\r\n        if (value == null) {\r\n            store.set(value = new_value);\r\n            return Promise.resolve();\r\n        }\r\n        target_value = new_value;\r\n        let previous_task = task;\r\n        let started = false;\r\n        let { delay = 0, duration = 400, easing = identity, interpolate = get_interpolator } = assign(assign({}, defaults), opts);\r\n        if (duration === 0) {\r\n            if (previous_task) {\r\n                previous_task.abort();\r\n                previous_task = null;\r\n            }\r\n            store.set(value = target_value);\r\n            return Promise.resolve();\r\n        }\r\n        const start = now() + delay;\r\n        let fn;\r\n        task = loop(now => {\r\n            if (now < start)\r\n                return true;\r\n            if (!started) {\r\n                fn = interpolate(value, new_value);\r\n                if (typeof duration === 'function')\r\n                    duration = duration(value, new_value);\r\n                started = true;\r\n            }\r\n            if (previous_task) {\r\n                previous_task.abort();\r\n                previous_task = null;\r\n            }\r\n            const elapsed = now - start;\r\n            if (elapsed > duration) {\r\n                store.set(value = new_value);\r\n                return false;\r\n            }\r\n            // @ts-ignore\r\n            store.set(value = fn(easing(elapsed / duration)));\r\n            return true;\r\n        });\r\n        return task.promise;\r\n    }\r\n    return {\r\n        set,\r\n        update: (fn, opts) => set(fn(target_value, value), opts),\r\n        subscribe: store.subscribe\r\n    };\r\n}\r\n\r\n// @ts-ignore\r\nfunction tick_spring(ctx, last_value, current_value, target_value) {\r\n    if (typeof current_value === 'number') {\r\n        // @ts-ignore\r\n        const delta = target_value - current_value;\r\n        // @ts-ignore\r\n        const velocity = (current_value - last_value) / (ctx.dt || 1 / 60); // guard div by 0\r\n        const spring = ctx.opts.stiffness * delta;\r\n        const damper = ctx.opts.damping * velocity;\r\n        const acceleration = (spring - damper) * ctx.inv_mass;\r\n        const d = (velocity + acceleration) * ctx.dt;\r\n        if (Math.abs(d) < ctx.opts.precision && Math.abs(delta) < ctx.opts.precision) {\r\n            return target_value; // settled\r\n        }\r\n        else {\r\n            ctx.settled = false; // signal loop to keep ticking\r\n            // @ts-ignore\r\n            return current_value + d;\r\n        }\r\n    }\r\n    else if (isArray(current_value)) {\r\n        // @ts-ignore\r\n        return current_value.map((_, i) => tick_spring(ctx, last_value[i], current_value[i], target_value[i]));\r\n    }\r\n    else if (typeof current_value === 'object') {\r\n        const next_value = {};\r\n        // @ts-ignore\r\n        for (const k in current_value) {\r\n            // @ts-ignore\r\n            next_value[k] = tick_spring(ctx, last_value[k], current_value[k], target_value[k]);\r\n        }\r\n        // @ts-ignore\r\n        return next_value;\r\n    }\r\n    else {\r\n        throw new Error(`Cannot spring ${typeof current_value} values`);\r\n    }\r\n}\r\n// export interface Spring {\r\n//     set: (new_value: any, opts?: SpringUpdateOpts) => Promise<void>;\r\n//     update: (fn: Function, opts?: SpringUpdateOpts) => Promise<void>;\r\n//     subscribe: Function;\r\n//     precision: number;\r\n//     damping: number;\r\n//     stiffness: number;\r\n// }\r\nfunction spring(value, opts = {}) {\r\n    const store = writable(value);\r\n    const { stiffness = 0.15, damping = 0.8, precision = 0.01 } = opts;\r\n    let last_time;\r\n    let task;\r\n    let current_token;\r\n    let last_value = value;\r\n    let target_value = value;\r\n    let inv_mass = 1;\r\n    let inv_mass_recovery_rate = 0;\r\n    let cancel_task = false;\r\n    function set(new_value, opts = {}) {\r\n        target_value = new_value;\r\n        const token = (current_token = {});\r\n        if (value == null || opts.hard || (spring.stiffness >= 1 && spring.damping >= 1)) {\r\n            cancel_task = true; // cancel any running animation\r\n            last_time = null;\r\n            last_value = new_value;\r\n            store.set((value = target_value));\r\n            return Promise.resolve();\r\n        }\r\n        else if (opts.soft) {\r\n            const rate = opts.soft === true ? 0.5 : +opts.soft;\r\n            inv_mass_recovery_rate = 1 / (rate * 60);\r\n            inv_mass = 0; // infinite mass, unaffected by spring forces\r\n        }\r\n        if (!task) {\r\n            last_time = null;\r\n            cancel_task = false;\r\n            const ctx = {\r\n                inv_mass: undefined,\r\n                opts: spring,\r\n                settled: true,\r\n                dt: undefined,\r\n            };\r\n            task = loop((now) => {\r\n                if (last_time === null)\r\n                    last_time = now;\r\n                if (cancel_task) {\r\n                    cancel_task = false;\r\n                    task = null;\r\n                    return false;\r\n                }\r\n                inv_mass = Math.min(inv_mass + inv_mass_recovery_rate, 1);\r\n                // altered so doesn't create a new object\r\n                ctx.inv_mass = inv_mass;\r\n                ctx.opts = spring;\r\n                ctx.settled = true; // tick_spring may signal false\r\n                ctx.dt = ((now - last_time) * 60) / 1000;\r\n                const next_value = tick_spring(ctx, last_value, value, target_value);\r\n                last_time = now;\r\n                last_value = value;\r\n                store.set((value = next_value));\r\n                if (ctx.settled)\r\n                    task = null;\r\n                return !ctx.settled;\r\n            });\r\n        }\r\n        return new Promise((fulfil) => {\r\n            task.promise.then(() => {\r\n                if (token === current_token)\r\n                    fulfil();\r\n            });\r\n        });\r\n    }\r\n    const spring = {\r\n        set,\r\n        update: (fn, opts) => set(fn(target_value, value), opts),\r\n        subscribe: store.subscribe,\r\n        stiffness,\r\n        damping,\r\n        precision,\r\n    };\r\n    return spring;\r\n}\r\n\r\nvar prefersReducedMotion = readable(false, (set) => {\r\n    const mql = window.matchMedia('(prefers-reduced-motion:reduce)');\r\n    const test = () => set(mql.matches);\r\n    test();\r\n    mql.addListener(test);\r\n    return () => mql.removeListener(test);\r\n});\r\n\r\nvar hasResizeObserver = () => 'ResizeObserver' in window;\r\n\r\n//\r\nconst rectNext = rectCreateEmpty();\r\nconst updateNodeRect = (node, x, y, width, height) => {\r\n    if (!node.rect)\r\n        node.rect = rectCreateEmpty();\r\n    const rect = node.rect;\r\n    rectUpdate(rectNext, x, y, width, height);\r\n    if (rectEqual(rect, rectNext))\r\n        return;\r\n    rectUpdateWithRect(rect, rectNext);\r\n    node.dispatchEvent(new CustomEvent('measure', { detail: rect }));\r\n};\r\n// measures the element\r\nconst r = Math.round;\r\nconst measureViewRect = (node) => {\r\n    const clientRect = node.getBoundingClientRect();\r\n    updateNodeRect(node, r(clientRect.x), r(clientRect.y), r(clientRect.width), r(clientRect.height));\r\n};\r\nconst measureOffset = (node) => updateNodeRect(node, node.offsetLeft, node.offsetTop, node.offsetWidth, node.offsetHeight);\r\n// holds all the elements to measure using requestAnimationFrame\r\nconst elements = [];\r\n// draw loop\r\nlet frame = null;\r\nfunction tick() {\r\n    if (!elements.length) {\r\n        frame = null;\r\n        return;\r\n    }\r\n    elements.forEach((node) => node.measure(node));\r\n    frame = requestAnimationFrame(tick);\r\n}\r\nlet observer; // ResizeObserver API not known by TypeScript\r\n// total observed elements so we know when we can unload observer\r\nlet observedNodes = 0;\r\nvar measurable = (node, options = {}) => {\r\n    const { observePosition = false, observeViewRect = false, once = false, disabled = false, } = options;\r\n    // exit\r\n    if (disabled)\r\n        return;\r\n    // use resize observe if available\r\n    if (hasResizeObserver() && !observePosition && !observeViewRect) {\r\n        // we only create one observer, it will observe all registered elements\r\n        if (!observer) {\r\n            // @ts-ignore: [2020-02-20] ResizeObserver API not known by TypeScript\r\n            observer = new ResizeObserver((entries) => {\r\n                // @ts-ignore\r\n                entries.forEach((entry) => measureOffset(entry.target));\r\n            });\r\n        }\r\n        // start observing this node\r\n        observer.observe(node);\r\n        // measure our node for the first time\r\n        measureOffset(node);\r\n        // if should only measure once, remove now\r\n        if (once) {\r\n            observer.unobserve(node);\r\n        }\r\n        else {\r\n            observedNodes++;\r\n        }\r\n        // and we done, need to return a clean up method for when our node is destroyed\r\n        return {\r\n            destroy() {\r\n                // already unobserved this node\r\n                if (once)\r\n                    return;\r\n                // stop observing this node\r\n                observer.unobserve(node);\r\n                // test if all nodes have been removed, if so, remove observer\r\n                observedNodes--;\r\n                if (observedNodes === 0) {\r\n                    observer.disconnect();\r\n                    observer = undefined;\r\n                }\r\n            },\r\n        };\r\n    }\r\n    // set measure function\r\n    node.measure = observeViewRect ? measureViewRect : measureOffset;\r\n    // add so the element is measured\r\n    elements.push(node);\r\n    // start measuring on next frame, we set up a single measure loop,\r\n    // the loop will check if there's still elements that need to be measured,\r\n    // else it will stop running\r\n    if (!frame)\r\n        frame = requestAnimationFrame(tick);\r\n    // measure this element now\r\n    node.measure(node);\r\n    // remove method\r\n    return {\r\n        destroy() {\r\n            const index = elements.indexOf(node);\r\n            elements.splice(index, 1);\r\n            delete node.measure;\r\n        },\r\n    };\r\n};\r\n\r\nvar focusvisible = (element) => {\r\n    let isKeyboardInteraction = false;\r\n    const handlePointerdown = () => {\r\n        isKeyboardInteraction = false;\r\n    };\r\n    const handleKeydown = () => {\r\n        isKeyboardInteraction = true;\r\n    };\r\n    const handleKeyup = () => {\r\n        isKeyboardInteraction = false;\r\n    };\r\n    const handleFocus = (e) => {\r\n        if (!isKeyboardInteraction)\r\n            return;\r\n        e.target.dataset.focusVisible = '';\r\n    };\r\n    const handleBlur = (e) => {\r\n        delete e.target.dataset.focusVisible;\r\n    };\r\n    const map = {\r\n        pointerdown: handlePointerdown,\r\n        keydown: handleKeydown,\r\n        keyup: handleKeyup,\r\n        focus: handleFocus,\r\n        blur: handleBlur,\r\n    };\r\n    Object.keys(map).forEach((event) => element.addEventListener(event, map[event], true));\r\n    return {\r\n        destroy() {\r\n            Object.keys(map).forEach((event) => element.removeEventListener(event, map[event], true));\r\n        },\r\n    };\r\n};\r\n\r\nconst getResourceFromItem = async (item) => new Promise((resolve) => {\r\n    if (item.kind === 'file')\r\n        return resolve(item.getAsFile());\r\n    item.getAsString(resolve);\r\n});\r\nconst getResourcesFromEvent = (e) => new Promise((resolve, reject) => {\r\n    const { items } = e.dataTransfer;\r\n    if (!items)\r\n        return resolve([]);\r\n    Promise.all(Array.from(items).map(getResourceFromItem))\r\n        .then((res) => {\r\n        resolve(res.filter((item) => (isBinary(item) && isImage(item)) || /^http/.test(item)));\r\n    })\r\n        .catch(reject);\r\n});\r\nvar dropable = (node, options = {}) => {\r\n    const handleDragOver = (e) => {\r\n        // need to be prevent default to allow drop\r\n        e.preventDefault();\r\n    };\r\n    const handleDrop = async (e) => {\r\n        e.preventDefault();\r\n        e.stopPropagation(); // prevents parents from catching this drop\r\n        try {\r\n            const resources = await getResourcesFromEvent(e);\r\n            node.dispatchEvent(new CustomEvent('dropfiles', {\r\n                detail: {\r\n                    event: e,\r\n                    resources,\r\n                },\r\n                ...options,\r\n            }));\r\n        }\r\n        catch (err) {\r\n            // silent, wasn't able to catch\r\n        }\r\n    };\r\n    node.addEventListener('drop', handleDrop);\r\n    node.addEventListener('dragover', handleDragOver);\r\n    // remove method\r\n    return {\r\n        destroy() {\r\n            node.removeEventListener('drop', handleDrop);\r\n            node.removeEventListener('dragover', handleDragOver);\r\n        },\r\n    };\r\n};\r\n\r\nlet result$5 = null;\r\nvar isSoftwareRendering = () => {\r\n    if (result$5 === null) {\r\n        if (isBrowser()) {\r\n            const canvas = h('canvas');\r\n            result$5 = !getWebGLContext(canvas, {\r\n                failIfMajorPerformanceCaveat: true,\r\n            });\r\n            releaseCanvas(canvas);\r\n        }\r\n        else {\r\n            result$5 = false;\r\n        }\r\n    }\r\n    return result$5;\r\n};\r\n\r\n/* src/core/ui/components/Canvas.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$P(ctx) {\r\n\tlet div;\r\n\tlet canvas_1;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tcanvas_1 = element(\"canvas\");\r\n\t\t\tattr(div, \"class\", \"PinturaCanvas\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tappend(div, canvas_1);\r\n\t\t\t/*canvas_1_binding*/ ctx[31](canvas_1);\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(canvas_1, \"measure\", /*measure_handler*/ ctx[32]),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, canvas_1))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp: noop,\r\n\t\ti: noop,\r\n\t\to: noop,\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\t/*canvas_1_binding*/ ctx[31](null);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$Q($$self, $$props, $$invalidate) {\r\n\tlet canDraw;\r\n\tlet drawUpdate;\r\n\tlet $maskFrameOpacityStore;\r\n\tlet $background;\r\n\tlet $imageOverlayColor;\r\n\tlet $maskOpacityStore;\r\n\tlet $mask;\r\n\r\n\tconst blendWithCanvasBackground = (back, front) => {\r\n\t\tconst [bR, bG, bB] = back;\r\n\t\tconst [fR, fG, fB, fA] = front;\r\n\r\n\t\treturn [\r\n\t\t\tfR * fA + bR * (1.0 - fA),\r\n\t\t\tfG * fA + bG * (1.0 - fA),\r\n\t\t\tfB * fA + bB * (1.0 - fA),\r\n\t\t\t1.0\r\n\t\t];\r\n\t};\r\n\r\n\t// used to dispatch the 'measure' event\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\tlet { isAnimated } = $$props;\r\n\tlet { isTransparent } = $$props;\r\n\tlet { maskRect } = $$props;\r\n\tlet { maskOpacity = 1 } = $$props;\r\n\tlet { maskFrameOpacity = 0.95 } = $$props;\r\n\tlet { maskMarkupOpacity = 1 } = $$props;\r\n\tlet { clipAnnotationsToImage = true } = $$props;\r\n\tlet { pixelRatio = 1 } = $$props;\r\n\tlet { textPixelRatio = pixelRatio } = $$props;\r\n\tlet { backgroundColor } = $$props;\r\n\tlet { willRender = passthrough } = $$props;\r\n\tlet { didRender = passthrough } = $$props;\r\n\tlet { willRequest = undefined } = $$props;\r\n\tlet { loadImageData = passthrough } = $$props;\r\n\tlet { images = [] } = $$props;\r\n\tlet { interfaceImages = [] } = $$props;\r\n\r\n\t// internal props\r\n\tlet canvas;\r\n\r\n\tlet canvasGL = null;\r\n\tlet width = null;\r\n\tlet height = null;\r\n\r\n\t//\r\n\t// springyness for main preview\r\n\t//\r\n\tconst updateSpring = (spring, value) => spring.set(value, { hard: !isAnimated });\r\n\r\n\tconst SPRING_PROPS = { precision: 0.0001 };\r\n\tconst SPRING_PROPS_FRACTION = { precision: SPRING_PROPS.precision * 0.01 };\r\n\r\n\t// Editor UI\r\n\tconst durationToMilliseconds = duration => {\r\n\t\tlet f = parseFloat(duration);\r\n\t\tif ((/^[0-9]+s$/).test(duration)) return f * 1000;\r\n\t\treturn f;\r\n\t};\r\n\r\n\tlet backgroundColorAnimationDuration = 0;\r\n\tconst background = tweened(undefined, { duration: 0 });\r\n\tcomponent_subscribe($$self, background, value => $$invalidate(29, $background = value));\r\n\tconst maskOpacityStore = spring(1, SPRING_PROPS_FRACTION);\r\n\tcomponent_subscribe($$self, maskOpacityStore, value => $$invalidate(30, $maskOpacityStore = value));\r\n\tconst maskFrameOpacityStore = spring(1, SPRING_PROPS_FRACTION);\r\n\tcomponent_subscribe($$self, maskFrameOpacityStore, value => $$invalidate(40, $maskFrameOpacityStore = value));\r\n\tconst mask = writable();\r\n\tcomponent_subscribe($$self, mask, value => $$invalidate(42, $mask = value));\r\n\tconst imageOverlayColor = writable();\r\n\tcomponent_subscribe($$self, imageOverlayColor, value => $$invalidate(41, $imageOverlayColor = value));\r\n\r\n\t//#region texture loading and binding\r\n\tconst requestRedraw = () => requestAnimationFrame(() => {\r\n\t\t// this triggers redraw of items marked as non-dirty\r\n\t\tredrawForce = true;\r\n\r\n\t\t// draw the update\r\n\t\tdrawUpdate();\r\n\t});\r\n\r\n\tconst Textures = new Map([]);\r\n\tconst PlaceholderTextures = new Map([]);\r\n\r\n\tconst getImageTexture = (image, imageRendering) => {\r\n\t\t// no texture yet for this source\r\n\t\tif (!Textures.has(image)) {\r\n\t\t\t// is in loading state when is same as source\r\n\t\t\tTextures.set(image, image);\r\n\r\n\t\t\t// get texture filter mode\r\n\t\t\tconst filter = imageRendering === 'pixelated'\r\n\t\t\t? canvasGL.textureFilterNearest\r\n\t\t\t: canvasGL.textureFilterLinear;\r\n\r\n\t\t\t// already loaded\r\n\t\t\tif (!isString(image) && (isImageBitmap(image) || isImageData(image) || isCanvas(image) || isVideoElement(image))) {\r\n\t\t\t\t// create texture\r\n\t\t\t\tconst texture = canvasGL.textureCreate();\r\n\r\n\t\t\t\t// udpate texture in gl canvas\r\n\t\t\t\tcanvasGL.textureUpdate(texture, image, { filter });\r\n\r\n\t\t\t\t// update state we now have a texture\r\n\t\t\t\tTextures.set(image, texture);\r\n\t\t\t} else // need to load the image\r\n\t\t\t{\r\n\t\t\t\tloadImageData(image).then(data => {\r\n\t\t\t\t\t// canvas destroyed while loading texture data, or no data returned\r\n\t\t\t\t\tif (!canvasGL || !data) return;\r\n\r\n\t\t\t\t\t// create texture\r\n\t\t\t\t\tconst texture = canvasGL.textureCreate();\r\n\r\n\t\t\t\t\t// udpate texture in gl canvas\r\n\t\t\t\t\tcanvasGL.textureUpdate(texture, data, { filter });\r\n\r\n\t\t\t\t\t// update state we now have a texture\r\n\t\t\t\t\tTextures.set(image, texture);\r\n\r\n\t\t\t\t\t// need to redraw because texture is now available\r\n\t\t\t\t\trequestRedraw();\r\n\t\t\t\t}).catch(err => {\r\n\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} else if (isVideoElement(image)) {\r\n\t\t\tconst texture = Textures.get(image);\r\n\r\n\t\t\t// get texture filter mode\r\n\t\t\tconst filter = imageRendering === 'pixelated'\r\n\t\t\t? canvasGL.textureFilterNearest\r\n\t\t\t: canvasGL.textureFilterLinear;\r\n\r\n\t\t\t// udpate texture in gl canvas\r\n\t\t\tcanvasGL.textureUpdate(texture, image, { filter });\r\n\t\t}\r\n\r\n\t\treturn Textures.get(image);\r\n\t};\r\n\r\n\tconst getTextTexture = shape => {\r\n\t\t// no text, texture not necessary\r\n\t\tif (!shape.text.length) {\r\n\t\t\tPlaceholderTextures.delete(shape.id);\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\tlet { text, textAlign, fontFamily, fontSize, fontWeight, fontVariant, fontStyle, lineHeight, width, height } = shape;\r\n\t\tconst { lastCharPosition, textSize } = textMeasure(text, shape);\r\n\r\n\t\tconst textUID = objectUID({\r\n\t\t\ttext,\r\n\t\t\ttextAlign,\r\n\t\t\tfontFamily,\r\n\t\t\tfontSize,\r\n\t\t\tfontWeight,\r\n\t\t\tfontVariant,\r\n\t\t\tfontStyle,\r\n\t\t\tlineHeight,\r\n\t\t\theight: height\r\n\t\t\t? Math.min(lastCharPosition.y, Math.ceil(height / lineHeight) * lineHeight)\r\n\t\t\t: 'auto',\r\n\t\t\txOffset: lastCharPosition.x,\r\n\t\t\tyOffset: lastCharPosition.y\r\n\t\t});\r\n\r\n\t\t// get texture unit assigned to this specific text shape\r\n\t\tif (!Textures.has(textUID)) {\r\n\t\t\t// is in loading state when is same as source\r\n\t\t\tTextures.set(textUID, text);\r\n\r\n\t\t\t// defined size of text box\r\n\t\t\t// - line: undefined, undefined\r\n\t\t\t// - auto: width, undefined\r\n\t\t\t// - box:  width, height\r\n\t\t\tconst widthRounded = width && Math.round(width);\r\n\r\n\t\t\tconst heightRounded = height && Math.round(height);\r\n\t\t\tconst imageWidth = Math.ceil(textSize.width);\r\n\t\t\tconst imageHeight = Math.ceil(textSize.height / lineHeight) * lineHeight; // so lines at end of text box are not cut of\r\n\r\n\t\t\t// skip\r\n\t\t\tif (imageWidth === 0 || imageHeight === 0) return;\r\n\r\n\t\t\t// check if needs to scale texture\r\n\t\t\tconst textureSizeLimit = getWebGLTextureSizeLimit();\r\n\r\n\t\t\tconst textureSizeScalar = Math.min(1, (textureSizeLimit - TextPadding * textPixelRatio * 2) / (imageWidth * textPixelRatio), textureSizeLimit / (imageHeight * textPixelRatio));\r\n\r\n\t\t\t// create texture\r\n\t\t\ttextToImage(text, {\r\n\t\t\t\tfontSize,\r\n\t\t\t\tfontFamily,\r\n\t\t\t\tfontWeight,\r\n\t\t\t\tfontVariant,\r\n\t\t\t\tfontStyle,\r\n\t\t\t\ttextAlign,\r\n\t\t\t\tlineHeight,\r\n\t\t\t\twidth: widthRounded,\r\n\t\t\t\theight: heightRounded,\r\n\t\t\t\timageWidth,\r\n\t\t\t\timageHeight,\r\n\t\t\t\tpixelRatio: textPixelRatio * textureSizeScalar,\r\n\t\t\t\twillRequest,\r\n\t\t\t\tcolor: [1, 0, 1], // purple will be replaced in render method\r\n\t\t\t\t\r\n\t\t\t}).then(image => {\r\n\t\t\t\t// canvas destroyed while loading texture data\r\n\t\t\t\tif (!canvasGL) return;\r\n\r\n\t\t\t\t// create texture\r\n\t\t\t\tconst texture = canvasGL.textureCreate();\r\n\r\n\t\t\t\t// update texture in gl canvas\r\n\t\t\t\tcanvasGL.textureUpdate(texture, image, {\r\n\t\t\t\t\tfilter: canvasGL.textureFilterLinear,\r\n\t\t\t\t\tscalar: textureSizeScalar\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// update state we now have a texture\r\n\t\t\t\tTextures.set(textUID, texture);\r\n\r\n\t\t\t\t// use as fallback texture for next update\r\n\t\t\t\tPlaceholderTextures.set(shape.id, texture);\r\n\r\n\t\t\t\t// need to redraw because texture is now available\r\n\t\t\t\trequestRedraw();\r\n\t\t\t}).catch(console.error);\r\n\t\t}\r\n\r\n\t\tconst texture = Textures.get(textUID);\r\n\r\n\t\treturn isTexture(texture)\r\n\t\t? texture\r\n\t\t: PlaceholderTextures.get(shape.id);\r\n\t};\r\n\r\n\tconst getShapeTexture = shape => {\r\n\t\tlet texture;\r\n\r\n\t\t// let's create textures for backgrounds and texts\r\n\t\tif (shape.backgroundImage) {\r\n\t\t\ttexture = getImageTexture(shape.backgroundImage, shape.backgroundImageRendering);\r\n\t\t} else // is text texture\r\n\t\tif (isString(shape.text)) {\r\n\t\t\tif (shape.width && shape.width < 1 || shape.height && shape.height < 1) return undefined;\r\n\t\t\ttexture = getTextTexture(shape);\r\n\t\t}\r\n\r\n\t\treturn texture;\r\n\t};\r\n\r\n\tconst isTexture = texture => texture instanceof WebGLTexture;\r\n\r\n\tconst releaseUnusedTextures = usedTextures => {\r\n\t\tTextures.forEach((registeredTexture, key) => {\r\n\t\t\tconst isUsed = !!usedTextures.find(usedTexture => usedTexture === registeredTexture);\r\n\r\n\t\t\t// stil used, no need to release\r\n\t\t\tif (isUsed || !isTexture(registeredTexture)) return;\r\n\r\n\t\t\t// skip if used as placeholder texture\r\n\t\t\tif (Array.from(PlaceholderTextures.values()).includes(registeredTexture)) return;\r\n\r\n\t\t\t// remove this texture\r\n\t\t\tTextures.delete(key);\r\n\r\n\t\t\tcanvasGL.textureDelete(registeredTexture);\r\n\t\t});\r\n\t};\r\n\r\n\t//#endregion\r\n\t//#region drawing\r\n\tconst drawImageHelper = ({ data, size, origin, translation, rotation, scale, colorMatrix, opacity, convolutionMatrix, gamma, vignette, maskFeather, maskCornerRadius, overlayColor, enableOverlay, enableBlend, enableAntialiasing }) => {\r\n\t\t// gets texture to use for this image\r\n\t\tconst texture = getImageTexture(data);\r\n\r\n\t\t// this makes sure the image renders extra crisp on low res screens\r\n\t\tlet sharpenOffsetX = 0;\r\n\r\n\t\tlet sharpenOffsetY = 0;\r\n\r\n\t\tif (pixelRatio === 1) {\r\n\t\t\tconst atActualSize = Math.abs(1 - scale) < Number.EPSILON;\r\n\t\t\tsharpenOffsetX = atActualSize && width % 2 !== 0 ? 0.5 : 0;\r\n\t\t\tsharpenOffsetY = atActualSize && height % 2 !== 0 ? 0.5 : 0;\r\n\t\t}\r\n\r\n\t\t// draw the image\r\n\t\tcanvasGL.drawImage(texture, size, origin.x, origin.y, translation.x + sharpenOffsetX, translation.y + sharpenOffsetY, rotation.x, rotation.y, rotation.z, scale, colorMatrix, clamp(opacity, 0, 1), convolutionMatrix, gamma, vignette, maskFeather, maskCornerRadius, overlayColor, enableOverlay, enableBlend, enableAntialiasing);\r\n\r\n\t\treturn texture;\r\n\t};\r\n\r\n\tconst backgroundCornersToUVMap = ([tl, tr, br, bl]) => {\r\n\t\t// tl, tr, br, bl -> bl, tl, br, tr\r\n\t\t// prettier-ignore\r\n\t\t// B   D\r\n\t\t// | \\ |\r\n\t\t// A  C\r\n\t\treturn [bl.x, bl.y, tl.x, tl.y, br.x, br.y, tr.x, tr.y];\r\n\t};\r\n\r\n\tconst EmptyVector = vectorCreateEmpty();\r\n\r\n\tconst drawShapes = (shapes = [], maxSize) => {\r\n\t\treturn shapes.map(shape => {\r\n\t\t\t// only show texture if shape is finished loading\r\n\t\t\tlet shapeTexture = !shape._isLoading && getShapeTexture(shape);\r\n\r\n\t\t\t// get the webgl texture\r\n\t\t\tlet texture = isTexture(shapeTexture) ? shapeTexture : undefined;\r\n\r\n\t\t\t// transforms\r\n\t\t\tconst scalar = shape._scale || 1;\r\n\r\n\t\t\tconst translation = shape._translate || EmptyVector;\r\n\r\n\t\t\t// scale stroke width\r\n\t\t\tconst strokeWidth = shape.strokeWidth && shape.strokeWidth * scalar;\r\n\r\n\t\t\tif (isArray(shape.points)) {\r\n\t\t\t\t// transform points\r\n\t\t\t\tconst points = shape.points.map(point => vectorCreate(point.x * scalar + translation.x, point.y * scalar + translation.y));\r\n\r\n\t\t\t\tcanvasGL.drawPath(points, shape.rotation, shape.flipX, shape.flipY, strokeWidth, shape.strokeColor, shape.pathClose, shape.backgroundColor, shape.opacity);\r\n\t\t\t} else // is ellipse\r\n\t\t\tif (isNumber(shape.rx) && isNumber(shape.ry)) {\r\n\t\t\t\tlet x = shape.x;\r\n\t\t\t\tlet y = shape.y;\r\n\t\t\t\tx *= scalar;\r\n\t\t\t\ty *= scalar;\r\n\t\t\t\tx += translation.x;\r\n\t\t\t\ty += translation.y;\r\n\t\t\t\tcanvasGL.drawEllipse(vectorCreate(x, y), shape.rx * scalar, shape.ry * scalar, shape.rotation, shape.flipX, shape.flipY, shape.backgroundColor, texture, undefined, undefined, shape.backgroundCorners && backgroundCornersToUVMap(shape.backgroundCorners), strokeWidth, shape.strokeColor, shape.opacity, shape.inverted);\r\n\t\t\t} else // is rect\r\n\t\t\tif (isString(shape.text) && texture || shape.width) {\r\n\t\t\t\tconst textureSize = texture && canvasGL.textureGetSize(texture);\r\n\t\t\t\tlet colorize = undefined;\r\n\t\t\t\tlet shapeBackgroundColor = shape.backgroundColor;\r\n\t\t\t\tlet shapeStrokeColor = shape.strokeColor;\r\n\t\t\t\tlet shapeRect;\r\n\r\n\t\t\t\tlet shapeCornerRadius = [\r\n\t\t\t\t\tshape.cornerRadius,\r\n\t\t\t\t\tshape.cornerRadius,\r\n\t\t\t\t\tshape.cornerRadius,\r\n\t\t\t\t\tshape.cornerRadius\r\n\t\t\t\t].map(v => v * scalar);\r\n\r\n\t\t\t\tif (shape.width) {\r\n\t\t\t\t\tshapeRect = rectCreateFromAny(shape);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tshapeRect = { x: shape.x, y: shape.y, ...textureSize };\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// apply shape transforms\r\n\t\t\t\tif (scalar && translation) {\r\n\t\t\t\t\tshapeRect.x *= scalar;\r\n\t\t\t\t\tshapeRect.y *= scalar;\r\n\t\t\t\t\tshapeRect.x += translation.x;\r\n\t\t\t\t\tshapeRect.y += translation.y;\r\n\t\t\t\t\tshapeRect.width *= scalar;\r\n\t\t\t\t\tshapeRect.height *= scalar;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// get texture\r\n\t\t\t\tlet backgroundSize;\r\n\r\n\t\t\t\tlet backgroundPosition;\r\n\r\n\t\t\t\tif (textureSize) {\r\n\t\t\t\t\t// background should be scaled\r\n\t\t\t\t\tif (shape.backgroundImage && shape.backgroundSize) {\r\n\t\t\t\t\t\t// always respect texture aspect ratio\r\n\t\t\t\t\t\tconst textureAspectRatio = getAspectRatio(textureSize.width, textureSize.height);\r\n\r\n\t\t\t\t\t\t// adjust position of background\r\n\t\t\t\t\t\tif (shape.backgroundSize === 'contain') {\r\n\t\t\t\t\t\t\tconst rect = rectContainRect(shapeRect, textureAspectRatio, shapeRect);\r\n\t\t\t\t\t\t\tbackgroundSize = sizeCreateFromRect(rect);\r\n\t\t\t\t\t\t\tbackgroundPosition = vectorCreate((shapeRect.width - backgroundSize.width) * 0.5, (shapeRect.height - backgroundSize.height) * 0.5);\r\n\t\t\t\t\t\t} else if (shape.backgroundSize === 'cover') {\r\n\t\t\t\t\t\t\tconst rect = rectCoverRect(shapeRect, textureAspectRatio, shapeRect);\r\n\t\t\t\t\t\t\tbackgroundSize = sizeCreateFromRect(rect);\r\n\t\t\t\t\t\t\tbackgroundPosition = vectorCreate(rect.x, rect.y);\r\n\t\t\t\t\t\t\tbackgroundPosition = vectorCreate((shapeRect.width - backgroundSize.width) * 0.5, (shapeRect.height - backgroundSize.height) * 0.5);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbackgroundSize = shape.backgroundSize;\r\n\t\t\t\t\t\t\tbackgroundPosition = shape.backgroundPosition;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else // is text, \"background\" should be texture size and be positioned based on alignment\r\n\t\t\t\t\tif (shape.text) {\r\n\t\t\t\t\t\tconst pixelTextureSize = {\r\n\t\t\t\t\t\t\twidth: textureSize.width / textPixelRatio,\r\n\t\t\t\t\t\t\theight: textureSize.height / textPixelRatio\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t// position texture based on text alignment\r\n\t\t\t\t\t\tbackgroundPosition = vectorCreate(0, 0);\r\n\r\n\t\t\t\t\t\tbackgroundSize = {\r\n\t\t\t\t\t\t\twidth: pixelTextureSize.width * scalar,\r\n\t\t\t\t\t\t\theight: pixelTextureSize.height * scalar\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t// draw background\r\n\t\t\t\t\t\tif (shape.backgroundColor || shape.strokeColor) {\r\n\t\t\t\t\t\t\t// remove background for text rendering draw call\r\n\t\t\t\t\t\t\tshapeBackgroundColor = undefined;\r\n\r\n\t\t\t\t\t\t\tshapeStrokeColor = undefined;\r\n\r\n\t\t\t\t\t\t\t// get width and height of shape\r\n\t\t\t\t\t\t\tlet width = (shape.width || pixelTextureSize.width - TextPadding * 2) * scalar;\r\n\r\n\t\t\t\t\t\t\tlet height = (shape.height || pixelTextureSize.height) * scalar;\r\n\t\t\t\t\t\t\tcanvasGL.drawRect({ ...shapeRect, width, height }, shape.rotation, shape.flipX, shape.flipY, shapeCornerRadius, shape.backgroundColor, undefined, undefined, undefined, undefined, strokeWidth, shape.strokeColor, shape.opacity, undefined, undefined, shape.inverted);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Apply TextPadding so text doesn't clip on left and right edges\r\n\t\t\t\t\t\tshapeRect.x -= TextPadding * scalar;\r\n\r\n\t\t\t\t\t\t// The text texture needs to be colorized\r\n\t\t\t\t\t\tcolorize = shape.color;\r\n\r\n\t\t\t\t\t\t// adjust width\r\n\t\t\t\t\t\tif (shape.width) {\r\n\t\t\t\t\t\t\t// auto scale height if is auto-height field\r\n\t\t\t\t\t\t\tshapeRect.height = shapeRect.height || pixelTextureSize.height * scalar;\r\n\r\n\t\t\t\t\t\t\t// adjust width so we can still render characters outside of box\r\n\t\t\t\t\t\t\tshapeRect.width += TextPadding * 2 * scalar;\r\n\r\n\t\t\t\t\t\t\t// adjust when text alignment is different\r\n\t\t\t\t\t\t\tif (shape.textAlign === 'center') {\r\n\t\t\t\t\t\t\t\tbackgroundPosition.x = (shapeRect.width - backgroundSize.width) * 0.5;\r\n\t\t\t\t\t\t\t} else if (shape.textAlign === 'right') {\r\n\t\t\t\t\t\t\t\tbackgroundPosition.x = shapeRect.width - backgroundSize.width;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tshapeRect.width = pixelTextureSize.width * scalar;\r\n\t\t\t\t\t\t\tshapeRect.height = pixelTextureSize.height * scalar;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// make color transparent\r\n\t\t\t\t\t\tif (shape._prerender) colorize[3] = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcanvasGL.drawRect(shapeRect, shape.rotation, shape.flipX, shape.flipY, shapeCornerRadius, shapeBackgroundColor, texture, backgroundSize, backgroundPosition, shape.backgroundCorners && backgroundCornersToUVMap(shape.backgroundCorners), strokeWidth, shapeStrokeColor, shape.opacity, undefined, colorize, shape.inverted);\r\n\t\t\t}\r\n\r\n\t\t\treturn shapeTexture;\r\n\t\t}).filter(Boolean);\r\n\t};\r\n\r\n\t// redraws state\r\n\tlet redrawForce = false;\r\n\r\n\tlet isFirstDraw = true;\r\n\tlet wasFlipping = false;\r\n\tconst usedBlendTextures = [];\r\n\tconst usedAnnotationTextures = [];\r\n\tconst usedTextures = [];\r\n\r\n\tconst redraw = () => {\r\n\t\t// reset array of textures used in this draw call\r\n\t\tusedTextures.length = 0;\r\n\r\n\t\t// get top image shortcut\r\n\t\tconst imagesTop = images[0];\r\n\r\n\t\t// allow dev to inject more shapes\r\n\t\tconst { blendShapes, blendShapesDirty, annotationShapes, annotationShapesDirty, interfaceShapes, decorationShapes, frameShapes } = willRender({\r\n\t\t\t// top image state shortcut\r\n\t\t\topacity: imagesTop.opacity,\r\n\t\t\trotation: imagesTop.rotation,\r\n\t\t\tscale: imagesTop.scale,\r\n\t\t\t// active images\r\n\t\t\timages,\r\n\t\t\t// canvas size\r\n\t\t\tsize: sizeCreate(width, height),\r\n\t\t\t// canvas background\r\n\t\t\tbackgroundColor: [...$background],\r\n\t\t\t// preview selection rect\r\n\t\t\tselectionRect: $mask\r\n\t\t});\r\n\r\n\t\tconst canvasBackgroundColor = [...$background];\r\n\r\n\t\t// adjust mask a bit so bacckground color doesn't bleed through\r\n\t\tconst imagesMask = $mask;\r\n\r\n\t\tconst imagesMaskOpacity = clamp($maskOpacityStore, 0, 1);\r\n\t\tconst imagesOverlayColor = $imageOverlayColor;\r\n\t\tconst xFlipProgress = Math.abs(-1 + imagesTop.rotation.x / Math.PI * 2);\r\n\t\tconst yFlipProgress = Math.abs(-1 + imagesTop.rotation.y / Math.PI * 2);\r\n\t\tconst isFlipping = xFlipProgress < 0.99 || yFlipProgress < 0.99;\r\n\t\tconst imagesSize = { ...imagesTop.size };\r\n\t\tconst imagesBackgroundColor = imagesTop.backgroundColor;\r\n\t\tconst imagesBackgroundImage = imagesTop.backgroundImage;\r\n\r\n\t\t// no need to draw to blend framebuffer if no redactions\r\n\t\tconst hasBlendShapes = blendShapes.length > 0;\r\n\r\n\t\t// no need to draw to markup framebuffer if no annotations\r\n\t\tconst hasAnnotations = annotationShapes.length > 0;\r\n\r\n\t\t// if image has background color\r\n\t\tconst hasImageBackgroundColor = imagesBackgroundColor[3] > 0.0;\r\n\r\n\t\t// if the overlay is transparent so we can see the canvas\r\n\t\tconst hasTransparentOverlay = imagesMaskOpacity < 1.0;\r\n\r\n\t\t// should mask annotations outside of preview\r\n\t\tconst hasPreviewStencil = clipAnnotationsToImage ? maskMarkupOpacity >= 1 : false; //clipAnnotationsToImage || maskMarkupOpacity >= 1;\r\n\r\n\t\t// set canvas background color to image background color if is defined\r\n\t\tif (hasTransparentOverlay && hasImageBackgroundColor) {\r\n\t\t\tconst backR = canvasBackgroundColor[0];\r\n\t\t\tconst backG = canvasBackgroundColor[1];\r\n\t\t\tconst backB = canvasBackgroundColor[2];\r\n\t\t\tconst frontA = 1.0 - imagesMaskOpacity;\r\n\t\t\tconst frontR = imagesBackgroundColor[0] * frontA;\r\n\t\t\tconst frontG = imagesBackgroundColor[1] * frontA;\r\n\t\t\tconst frontB = imagesBackgroundColor[2] * frontA;\r\n\t\t\tconst fA = 1.0 - frontA;\r\n\t\t\tcanvasBackgroundColor[0] = frontR + backR * fA;\r\n\t\t\tcanvasBackgroundColor[1] = frontG + backG * fA;\r\n\t\t\tcanvasBackgroundColor[2] = frontB + backB * fA;\r\n\t\t\tcanvasBackgroundColor[3] = 1;\r\n\t\t}\r\n\r\n\t\t// make background transparent\r\n\t\tcanvasGL.setCanvasColor(isTransparent ? [0, 0, 0, 0] : canvasBackgroundColor);\r\n\r\n\t\t// if has blend shapes draw blend shapes to framebuffer\r\n\t\tif (hasBlendShapes && blendShapesDirty) {\r\n\t\t\tcanvasGL.disableMask();\r\n\t\t\tcanvasGL.drawToImageBlendBuffer(imagesSize);\r\n\t\t\tusedBlendTextures.length = 0;\r\n\t\t\tusedBlendTextures.push(...drawShapes(blendShapes));\r\n\t\t} else if (!hasBlendShapes) {\r\n\t\t\tusedBlendTextures.length = 0;\r\n\t\t}\r\n\r\n\t\tusedTextures.push(...usedBlendTextures);\r\n\r\n\t\t// prepare overlay frame buffer\r\n\t\tif (isFirstDraw) {\r\n\t\t\tcanvasGL.drawToImageOverlayBuffer(imagesSize, textPixelRatio);\r\n\t\t\tisFirstDraw = false;\r\n\t\t}\r\n\r\n\t\t// if has annotations draw annotation shapes to framebuffer\r\n\t\tconst shouldDrawAnnotations = hasAnnotations && (annotationShapesDirty || redrawForce);\r\n\r\n\t\tif (isFlipping) {\r\n\t\t\tif (shouldDrawAnnotations || !wasFlipping) {\r\n\t\t\t\tcanvasGL.disableMask();\r\n\t\t\t\tcanvasGL.drawToImageOverlayBuffer(imagesSize, textPixelRatio);\r\n\t\t\t\tusedAnnotationTextures.length = 0;\r\n\t\t\t\tusedAnnotationTextures.push(...drawShapes(annotationShapes));\r\n\t\t\t} else if (!hasAnnotations) {\r\n\t\t\t\tusedAnnotationTextures.length = 0;\r\n\t\t\t}\r\n\r\n\t\t\t// we use wasFlipping so we know when we should redraw the overlay framebuffer\r\n\t\t\twasFlipping = true;\r\n\t\t} else {\r\n\t\t\twasFlipping = false;\r\n\t\t}\r\n\r\n\t\t// switch to canvas drawing for other elements\r\n\t\tcanvasGL.drawToCanvas();\r\n\r\n\t\tcanvasGL.enableMask(imagesMask, imagesMaskOpacity);\r\n\r\n\t\t// draw a colored rectangle behind main preview image\r\n\t\tif (hasImageBackgroundColor) {\r\n\t\t\tcanvasGL.drawRect(imagesMask, 0, false, false, [0, 0, 0, 0], blendWithCanvasBackground($background, imagesBackgroundColor));\r\n\t\t}\r\n\r\n\t\tif (imagesBackgroundImage) {\r\n\t\t\t// hide background image outside of crop area\r\n\t\t\tcanvasGL.enableMask(imagesMask, 1.0);\r\n\r\n\t\t\tconst scalar = Math.max(maskRect.width / imagesBackgroundImage.width, maskRect.height / imagesBackgroundImage.height);\r\n\t\t\tconst width = imagesBackgroundImage.width * scalar;\r\n\t\t\tconst height = imagesBackgroundImage.height * scalar;\r\n\r\n\t\t\tconst rect = {\r\n\t\t\t\tx: maskRect.x + maskRect.width * 0.5 - width * 0.5,\r\n\t\t\t\ty: maskRect.y + maskRect.height * 0.5 - height * 0.5,\r\n\t\t\t\twidth,\r\n\t\t\t\theight\r\n\t\t\t};\r\n\r\n\t\t\tcanvasGL.drawRect(rect, 0, false, false, [0, 0, 0, 0], [0, 0, 0, 0], getImageTexture(imagesBackgroundImage, 'linear'));\r\n\t\t\tcanvasGL.enableMask(imagesMask, imagesMaskOpacity);\r\n\t\t}\r\n\r\n\t\thasPreviewStencil && canvasGL.enablePreviewStencil();\r\n\r\n\t\tusedTextures.push(...[...images].reverse().map(image => {\r\n\t\t\treturn drawImageHelper({\r\n\t\t\t\t...image,\r\n\t\t\t\t// enable drawing markup if defined\r\n\t\t\t\tenableOverlay: isFlipping && hasAnnotations,\r\n\t\t\t\t// enable drawing redactions if defined\r\n\t\t\t\tenableBlend: hasBlendShapes,\r\n\t\t\t\t// antialias image edges\r\n\t\t\t\tenableAntialiasing: true,\r\n\t\t\t\t// mask and overlay positions\r\n\t\t\t\tmask: imagesMask,\r\n\t\t\t\tmaskOpacity: imagesMaskOpacity,\r\n\t\t\t\t// overlay\r\n\t\t\t\toverlayColor: imagesOverlayColor\r\n\t\t\t});\r\n\t\t}));\r\n\r\n\t\t// TODO: move vignette here (draw with colorized circular gradient texture instead of in shader)\r\n\t\t// set markup mask\r\n\t\tcanvasGL.enableMask(imagesMask, maskMarkupOpacity);\r\n\r\n\t\t// draw shapes in UI instead of framebuffer\r\n\t\tif (!isFlipping) {\r\n\t\t\t// only draw in image area\r\n\t\t\thasPreviewStencil && canvasGL.applyPreviewStencil();\r\n\r\n\t\t\t// draw shapes\r\n\t\t\tcanvasGL.resetCanvasMatrix();\r\n\r\n\t\t\tcanvasGL.updateCanvasMatrix(imagesSize, imagesTop.origin, imagesTop.translation, imagesTop.scale, imagesTop.rotation);\r\n\r\n\t\t\t// draw shapes\r\n\t\t\tusedAnnotationTextures.length = 0;\r\n\r\n\t\t\tusedAnnotationTextures.push(...drawShapes(annotationShapes));\r\n\r\n\t\t\t// stencil no longer needed\r\n\t\t\thasPreviewStencil && canvasGL.disablePreviewStencil();\r\n\t\t}\r\n\r\n\t\tusedTextures.push(...usedAnnotationTextures);\r\n\r\n\t\t// draw decorations shapes relative to crop\r\n\t\tcanvasGL.resetCanvasMatrix();\r\n\r\n\t\tcanvasGL.enableMask(imagesMask, maskMarkupOpacity);\r\n\t\tusedTextures.push(...drawShapes(decorationShapes));\r\n\r\n\t\t// draw frames\r\n\t\tif (frameShapes.length) {\r\n\t\t\t// set frame mask\r\n\t\t\tcanvasGL.enableMask(imagesMask, 1);\r\n\r\n\t\t\tconst shapesInside = frameShapes.filter(shape => !shape.expandsCanvas);\r\n\t\t\tconst shapesOutside = frameShapes.filter(shape => shape.expandsCanvas);\r\n\r\n\t\t\tif (shapesInside.length) {\r\n\t\t\t\tusedTextures.push(...drawShapes(shapesInside));\r\n\t\t\t}\r\n\r\n\t\t\tif (shapesOutside.length) {\r\n\t\t\t\t// the half pixel helps mask the outside shapes at the correct position\r\n\t\t\t\tcanvasGL.enableMask(\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tx: imagesMask.x + 0.5,\r\n\t\t\t\t\t\ty: imagesMask.y + 0.5,\r\n\t\t\t\t\t\twidth: imagesMask.width - 1,\r\n\t\t\t\t\t\theight: imagesMask.height - 1\r\n\t\t\t\t\t},\r\n\t\t\t\t\t$maskFrameOpacityStore\r\n\t\t\t\t);\r\n\r\n\t\t\t\tusedTextures.push(...drawShapes(shapesOutside));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// crop mask not used for interface\r\n\t\tcanvasGL.disableMask();\r\n\r\n\t\t// frames rendered on the outside\r\n\t\t// draw custom interface shapes\r\n\t\tusedTextures.push(...drawShapes(interfaceShapes));\r\n\r\n\t\tinterfaceImages.forEach(image => {\r\n\t\t\tcanvasGL.enableMask(image.mask, image.maskOpacity);\r\n\r\n\t\t\t// draw background fill\r\n\t\t\tif (image.backgroundColor) {\r\n\t\t\t\t// calculate background image cover rect\r\n\t\t\t\tconst backgroundRect = imagesBackgroundImage && rectCoverRect({ ...image.mask }, imagesBackgroundImage.width / imagesBackgroundImage.height);\r\n\r\n\t\t\t\tconst backgroundImage = imagesBackgroundImage && getImageTexture(imagesBackgroundImage, 'linear');\r\n\t\t\t\tcanvasGL.drawRect(image.mask, 0, false, false, image.maskCornerRadius, image.backgroundColor, backgroundImage, backgroundRect, backgroundRect, undefined, undefined, undefined, image.opacity, image.maskFeather);\r\n\t\t\t}\r\n\r\n\t\t\t// draw image\r\n\t\t\tdrawImageHelper({\r\n\t\t\t\t...image,\r\n\t\t\t\t// antialias edges\r\n\t\t\t\tenableAntialiasing: false,\r\n\t\t\t\t// update translation to apply `offset` from top left\r\n\t\t\t\ttranslation: {\r\n\t\t\t\t\tx: image.translation.x + image.offset.x - width * 0.5,\r\n\t\t\t\t\ty: image.translation.y + image.offset.y - height * 0.5\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tcanvasGL.disableMask();\r\n\r\n\t\t// determine which textures can be dropped\r\n\t\treleaseUnusedTextures(usedTextures);\r\n\r\n\t\t// done rendering\r\n\t\tdidRender();\r\n\r\n\t\t// redraw force flag\r\n\t\tredrawForce = false;\r\n\t};\r\n\r\n\t//#endregion\r\n\t//#region set up\r\n\t// throttled redrawer\r\n\tlet lastDraw = Date.now();\r\n\r\n\tconst redrawThrottled = () => {\r\n\t\tconst now = Date.now();\r\n\t\tconst dist = now - lastDraw;\r\n\t\tif (dist < 48) return;\r\n\t\tlastDraw = now;\r\n\t\tredraw();\r\n\t};\r\n\r\n\t// returns the render function to use for this browser context\r\n\tconst selectFittingRenderFunction = () => isSoftwareRendering() ? redrawThrottled : redraw;\r\n\r\n\t// after DOM has been altered, redraw to canvas\r\n\tafterUpdate(() => drawUpdate());\r\n\r\n\t// hook up canvas to WebGL drawer\r\n\tonMount(() => $$invalidate(25, canvasGL = createWebGLCanvas(canvas, { alpha: isTransparent })));\r\n\r\n\t// clean up canvas\r\n\tonDestroy(() => {\r\n\t\t// if canvas wasn't created we don't need to release it\r\n\t\tif (!canvasGL) return;\r\n\r\n\t\t// done drawing\r\n\t\tcanvasGL.release();\r\n\r\n\t\t// remove reference\r\n\t\t$$invalidate(25, canvasGL = undefined);\r\n\r\n\t\t$$invalidate(0, canvas = undefined);\r\n\t});\r\n\r\n\tfunction canvas_1_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\tcanvas = $$value;\r\n\t\t\t$$invalidate(0, canvas);\r\n\t\t});\r\n\t}\r\n\r\n\tconst measure_handler = e => {\r\n\t\t$$invalidate(1, width = e.detail.width);\r\n\t\t$$invalidate(2, height = e.detail.height);\r\n\t\tdispatch('measure', { width, height });\r\n\t};\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('isAnimated' in $$props) $$invalidate(9, isAnimated = $$props.isAnimated);\r\n\t\tif ('isTransparent' in $$props) $$invalidate(10, isTransparent = $$props.isTransparent);\r\n\t\tif ('maskRect' in $$props) $$invalidate(11, maskRect = $$props.maskRect);\r\n\t\tif ('maskOpacity' in $$props) $$invalidate(12, maskOpacity = $$props.maskOpacity);\r\n\t\tif ('maskFrameOpacity' in $$props) $$invalidate(13, maskFrameOpacity = $$props.maskFrameOpacity);\r\n\t\tif ('maskMarkupOpacity' in $$props) $$invalidate(14, maskMarkupOpacity = $$props.maskMarkupOpacity);\r\n\t\tif ('clipAnnotationsToImage' in $$props) $$invalidate(15, clipAnnotationsToImage = $$props.clipAnnotationsToImage);\r\n\t\tif ('pixelRatio' in $$props) $$invalidate(16, pixelRatio = $$props.pixelRatio);\r\n\t\tif ('textPixelRatio' in $$props) $$invalidate(17, textPixelRatio = $$props.textPixelRatio);\r\n\t\tif ('backgroundColor' in $$props) $$invalidate(18, backgroundColor = $$props.backgroundColor);\r\n\t\tif ('willRender' in $$props) $$invalidate(19, willRender = $$props.willRender);\r\n\t\tif ('didRender' in $$props) $$invalidate(20, didRender = $$props.didRender);\r\n\t\tif ('willRequest' in $$props) $$invalidate(21, willRequest = $$props.willRequest);\r\n\t\tif ('loadImageData' in $$props) $$invalidate(22, loadImageData = $$props.loadImageData);\r\n\t\tif ('images' in $$props) $$invalidate(23, images = $$props.images);\r\n\t\tif ('interfaceImages' in $$props) $$invalidate(24, interfaceImages = $$props.interfaceImages);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*canvas*/ 1) {\r\n\t\t\tif (canvas) {\r\n\t\t\t\tconst propertyValue = getComputedStyle(canvas).getPropertyValue('--color-transition-duration');\r\n\t\t\t\t$$invalidate(26, backgroundColorAnimationDuration = durationToMilliseconds(propertyValue));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*backgroundColor, isAnimated, backgroundColorAnimationDuration*/ 67371520) {\r\n\t\t\tbackgroundColor && background.set(backgroundColor, {\r\n\t\t\t\tduration: isAnimated ? backgroundColorAnimationDuration : 0\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*maskOpacity*/ 4096) {\r\n\t\t\tupdateSpring(maskOpacityStore, isNumber(maskOpacity) ? maskOpacity : 1);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*maskFrameOpacity*/ 8192) {\r\n\t\t\tupdateSpring(maskFrameOpacityStore, isNumber(maskFrameOpacity) ? maskFrameOpacity : 1);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*maskRect*/ 2048) {\r\n\t\t\tmaskRect && mask.set(maskRect);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$background, $maskOpacityStore*/ 1610612736) {\r\n\t\t\t$background && imageOverlayColor.set([\r\n\t\t\t\t$background[0],\r\n\t\t\t\t$background[1],\r\n\t\t\t\t$background[2],\r\n\t\t\t\tclamp($maskOpacityStore, 0, 1)\r\n\t\t\t]);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*canvasGL, width, height, images*/ 41943046) {\r\n\t\t\t// can draw view\r\n\t\t\t$$invalidate(28, canDraw = !!(canvasGL && width && height && images.length));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*width, height, canvasGL, pixelRatio*/ 33619974) {\r\n\t\t\t// observe width and height changes and resize the canvas proportionally\r\n\t\t\twidth && height && canvasGL && canvasGL.resize(width, height, pixelRatio);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*canDraw*/ 268435456) {\r\n\t\t\t// switch to draw method when can draw\r\n\t\t\t$$invalidate(27, drawUpdate = canDraw ? selectFittingRenderFunction() : noop$1);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*canDraw, drawUpdate*/ 402653184) {\r\n\t\t\t// if can draw state is updated and we have a draw update function, time to redraw\r\n\t\t\tcanDraw && drawUpdate && drawUpdate();\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tcanvas,\r\n\t\twidth,\r\n\t\theight,\r\n\t\tdispatch,\r\n\t\tbackground,\r\n\t\tmaskOpacityStore,\r\n\t\tmaskFrameOpacityStore,\r\n\t\tmask,\r\n\t\timageOverlayColor,\r\n\t\tisAnimated,\r\n\t\tisTransparent,\r\n\t\tmaskRect,\r\n\t\tmaskOpacity,\r\n\t\tmaskFrameOpacity,\r\n\t\tmaskMarkupOpacity,\r\n\t\tclipAnnotationsToImage,\r\n\t\tpixelRatio,\r\n\t\ttextPixelRatio,\r\n\t\tbackgroundColor,\r\n\t\twillRender,\r\n\t\tdidRender,\r\n\t\twillRequest,\r\n\t\tloadImageData,\r\n\t\timages,\r\n\t\tinterfaceImages,\r\n\t\tcanvasGL,\r\n\t\tbackgroundColorAnimationDuration,\r\n\t\tdrawUpdate,\r\n\t\tcanDraw,\r\n\t\t$background,\r\n\t\t$maskOpacityStore,\r\n\t\tcanvas_1_binding,\r\n\t\tmeasure_handler\r\n\t];\r\n}\r\n\r\nclass Canvas extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$Q,\r\n\t\t\tcreate_fragment$P,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tisAnimated: 9,\r\n\t\t\t\tisTransparent: 10,\r\n\t\t\t\tmaskRect: 11,\r\n\t\t\t\tmaskOpacity: 12,\r\n\t\t\t\tmaskFrameOpacity: 13,\r\n\t\t\t\tmaskMarkupOpacity: 14,\r\n\t\t\t\tclipAnnotationsToImage: 15,\r\n\t\t\t\tpixelRatio: 16,\r\n\t\t\t\ttextPixelRatio: 17,\r\n\t\t\t\tbackgroundColor: 18,\r\n\t\t\t\twillRender: 19,\r\n\t\t\t\tdidRender: 20,\r\n\t\t\t\twillRequest: 21,\r\n\t\t\t\tloadImageData: 22,\r\n\t\t\t\timages: 23,\r\n\t\t\t\tinterfaceImages: 24\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1, -1]\r\n\t\t);\r\n\t}\r\n}\r\n\r\nvar arrayJoin = (arr, filter = Boolean, str = ' ') => arr.filter(filter).join(str);\r\n\r\n/* src/core/ui/components/TabList.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction get_each_context$9(ctx, list, i) {\r\n\tconst child_ctx = ctx.slice();\r\n\tchild_ctx[17] = list[i];\r\n\treturn child_ctx;\r\n}\r\n\r\nconst get_default_slot_changes$1 = dirty => ({ tab: dirty & /*tabNodes*/ 4 });\r\nconst get_default_slot_context$1 = ctx => ({ tab: /*tab*/ ctx[17] });\r\n\r\n// (52:0) {#if shouldRender}\r\nfunction create_if_block$g(ctx) {\r\n\tlet ul;\r\n\tlet each_blocks = [];\r\n\tlet each_1_lookup = new Map();\r\n\tlet ul_class_value;\r\n\tlet current;\r\n\tlet each_value = /*tabNodes*/ ctx[2];\r\n\tconst get_key = ctx => /*tab*/ ctx[17].id;\r\n\r\n\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\tlet child_ctx = get_each_context$9(ctx, each_value, i);\r\n\t\tlet key = get_key(child_ctx);\r\n\t\teach_1_lookup.set(key, each_blocks[i] = create_each_block$9(key, child_ctx));\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tul = element(\"ul\");\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].c();\r\n\t\t\t}\r\n\r\n\t\t\tattr(ul, \"class\", ul_class_value = arrayJoin(['PinturaTabList', /*klass*/ ctx[0]]));\r\n\t\t\tattr(ul, \"role\", \"tablist\");\r\n\t\t\tattr(ul, \"data-layout\", /*layout*/ ctx[1]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, ul, anchor);\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].m(ul, null);\r\n\t\t\t}\r\n\r\n\t\t\t/*ul_binding*/ ctx[14](ul);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty & /*tabNodes, handleKeyTab, handleClickTab, $$scope*/ 1124) {\r\n\t\t\t\teach_value = /*tabNodes*/ ctx[2];\r\n\t\t\t\tgroup_outros();\r\n\t\t\t\teach_blocks = update_keyed_each(each_blocks, dirty, get_key, 1, ctx, each_value, each_1_lookup, ul, outro_and_destroy_block, create_each_block$9, null, get_each_context$9);\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*klass*/ 1 && ul_class_value !== (ul_class_value = arrayJoin(['PinturaTabList', /*klass*/ ctx[0]]))) {\r\n\t\t\t\tattr(ul, \"class\", ul_class_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*layout*/ 2) {\r\n\t\t\t\tattr(ul, \"data-layout\", /*layout*/ ctx[1]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\r\n\t\t\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\t\t\ttransition_in(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\ttransition_out(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(ul);\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].d();\r\n\t\t\t}\r\n\r\n\t\t\t/*ul_binding*/ ctx[14](null);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (59:8) {#each tabNodes as tab (tab.id)}\r\nfunction create_each_block$9(key_1, ctx) {\r\n\tlet li;\r\n\tlet button;\r\n\tlet button_disabled_value;\r\n\tlet t;\r\n\tlet li_aria_controls_value;\r\n\tlet li_id_value;\r\n\tlet li_aria_selected_value;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tconst default_slot_template = /*#slots*/ ctx[11].default;\r\n\tconst default_slot = create_slot(default_slot_template, ctx, /*$$scope*/ ctx[10], get_default_slot_context$1);\r\n\r\n\tfunction keydown_handler(...args) {\r\n\t\treturn /*keydown_handler*/ ctx[12](/*tab*/ ctx[17], ...args);\r\n\t}\r\n\r\n\tfunction click_handler(...args) {\r\n\t\treturn /*click_handler*/ ctx[13](/*tab*/ ctx[17], ...args);\r\n\t}\r\n\r\n\treturn {\r\n\t\tkey: key_1,\r\n\t\tfirst: null,\r\n\t\tc() {\r\n\t\t\tli = element(\"li\");\r\n\t\t\tbutton = element(\"button\");\r\n\t\t\tif (default_slot) default_slot.c();\r\n\t\t\tt = space();\r\n\t\t\tattr(button, \"type\", \"button\");\r\n\t\t\tbutton.disabled = button_disabled_value = /*tab*/ ctx[17].disabled;\r\n\t\t\tattr(li, \"role\", \"tab\");\r\n\t\t\tattr(li, \"aria-controls\", li_aria_controls_value = /*tab*/ ctx[17].href.substr(1));\r\n\t\t\tattr(li, \"id\", li_id_value = /*tab*/ ctx[17].tabId);\r\n\t\t\tattr(li, \"aria-selected\", li_aria_selected_value = /*tab*/ ctx[17].selected);\r\n\t\t\tthis.first = li;\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, li, anchor);\r\n\t\t\tappend(li, button);\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tdefault_slot.m(button, null);\r\n\t\t\t}\r\n\r\n\t\t\tappend(li, t);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(button, \"keydown\", keydown_handler),\r\n\t\t\t\t\tlisten(button, \"click\", click_handler)\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tif (default_slot.p && (!current || dirty & /*$$scope, tabNodes*/ 1028)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tdefault_slot,\r\n\t\t\t\t\t\tdefault_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[10],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[10])\r\n\t\t\t\t\t\t: get_slot_changes(default_slot_template, /*$$scope*/ ctx[10], dirty, get_default_slot_changes$1),\r\n\t\t\t\t\t\tget_default_slot_context$1\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*tabNodes*/ 4 && button_disabled_value !== (button_disabled_value = /*tab*/ ctx[17].disabled)) {\r\n\t\t\t\tbutton.disabled = button_disabled_value;\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*tabNodes*/ 4 && li_aria_controls_value !== (li_aria_controls_value = /*tab*/ ctx[17].href.substr(1))) {\r\n\t\t\t\tattr(li, \"aria-controls\", li_aria_controls_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*tabNodes*/ 4 && li_id_value !== (li_id_value = /*tab*/ ctx[17].tabId)) {\r\n\t\t\t\tattr(li, \"id\", li_id_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*tabNodes*/ 4 && li_aria_selected_value !== (li_aria_selected_value = /*tab*/ ctx[17].selected)) {\r\n\t\t\t\tattr(li, \"aria-selected\", li_aria_selected_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(default_slot, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(default_slot, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(li);\r\n\t\t\tif (default_slot) default_slot.d(detaching);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$O(ctx) {\r\n\tlet if_block_anchor;\r\n\tlet current;\r\n\tlet if_block = /*shouldRender*/ ctx[4] && create_if_block$g(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tif_block_anchor = empty();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (if_block) if_block.m(target, anchor);\r\n\t\t\tinsert(target, if_block_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tif (/*shouldRender*/ ctx[4]) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty & /*shouldRender*/ 16) {\r\n\t\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block$g(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(if_block_anchor.parentNode, if_block_anchor);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block, 1, 1, () => {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (if_block) if_block.d(detaching);\r\n\t\t\tif (detaching) detach(if_block_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$P($$self, $$props, $$invalidate) {\r\n\tlet tabNodes;\r\n\tlet shouldRender;\r\n\tlet { $$slots: slots = {}, $$scope } = $$props;\r\n\tlet root;\r\n\tlet { class: klass = undefined } = $$props;\r\n\tlet { name } = $$props;\r\n\tlet { selected } = $$props;\r\n\tlet { tabs = [] } = $$props;\r\n\tlet { layout = undefined } = $$props;\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\tconst focusTab = index => {\r\n\t\tconst tab = root.querySelectorAll('[role=\"tab\"] button')[index];\r\n\t\tif (!tab) return;\r\n\t\ttab.focus();\r\n\t};\r\n\r\n\tconst handleClickTab = (e, id) => {\r\n\t\te.preventDefault();\r\n\t\te.stopPropagation();\r\n\t\tdispatch('select', id);\r\n\t};\r\n\r\n\tconst handleKeyTab = ({ key }, id) => {\r\n\t\tif (!(/arrow/i).test(key)) return;\r\n\t\tconst index = tabs.findIndex(tab => tab.id === id);\r\n\r\n\t\t// next\r\n\t\tif ((/right|down/i).test(key)) return focusTab(index < tabs.length - 1 ? index + 1 : 0);\r\n\r\n\t\t// prev\r\n\t\tif ((/left|up/i).test(key)) return focusTab(index > 0 ? index - 1 : tabs.length - 1);\r\n\t};\r\n\r\n\tconst keydown_handler = (tab, e) => handleKeyTab(e, tab.id);\r\n\tconst click_handler = (tab, e) => handleClickTab(e, tab.id);\r\n\r\n\tfunction ul_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\troot = $$value;\r\n\t\t\t$$invalidate(3, root);\r\n\t\t});\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('class' in $$props) $$invalidate(0, klass = $$props.class);\r\n\t\tif ('name' in $$props) $$invalidate(7, name = $$props.name);\r\n\t\tif ('selected' in $$props) $$invalidate(8, selected = $$props.selected);\r\n\t\tif ('tabs' in $$props) $$invalidate(9, tabs = $$props.tabs);\r\n\t\tif ('layout' in $$props) $$invalidate(1, layout = $$props.layout);\r\n\t\tif ('$$scope' in $$props) $$invalidate(10, $$scope = $$props.$$scope);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*tabs, selected, name*/ 896) {\r\n\t\t\t$$invalidate(2, tabNodes = tabs.map(tab => {\r\n\t\t\t\tconst isActive = tab.id === selected;\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...tab,\r\n\t\t\t\t\ttabId: `tab-${name}-${tab.id}`,\r\n\t\t\t\t\thref: `#panel-${name}-${tab.id}`,\r\n\t\t\t\t\tselected: isActive\r\n\t\t\t\t};\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*tabNodes*/ 4) {\r\n\t\t\t$$invalidate(4, shouldRender = tabNodes.length > 1);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tklass,\r\n\t\tlayout,\r\n\t\ttabNodes,\r\n\t\troot,\r\n\t\tshouldRender,\r\n\t\thandleClickTab,\r\n\t\thandleKeyTab,\r\n\t\tname,\r\n\t\tselected,\r\n\t\ttabs,\r\n\t\t$$scope,\r\n\t\tslots,\r\n\t\tkeydown_handler,\r\n\t\tclick_handler,\r\n\t\tul_binding\r\n\t];\r\n}\r\n\r\nclass TabList extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$P, create_fragment$O, safe_not_equal, {\r\n\t\t\tclass: 0,\r\n\t\t\tname: 7,\r\n\t\t\tselected: 8,\r\n\t\t\ttabs: 9,\r\n\t\t\tlayout: 1\r\n\t\t});\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/TabPanels.svelte generated by Svelte v3.50.1 */\r\nconst get_default_slot_changes_1 = dirty => ({ panel: dirty & /*panelNodes*/ 16 });\r\n\r\nconst get_default_slot_context_1 = ctx => ({\r\n\tpanel: /*panelNodes*/ ctx[4][0].id,\r\n\tpanelIsActive: true\r\n});\r\n\r\nfunction get_each_context$8(ctx, list, i) {\r\n\tconst child_ctx = ctx.slice();\r\n\tchild_ctx[14] = list[i].id;\r\n\tchild_ctx[15] = list[i].shouldDraw;\r\n\tchild_ctx[16] = list[i].panelId;\r\n\tchild_ctx[17] = list[i].tabindex;\r\n\tchild_ctx[18] = list[i].labelledBy;\r\n\tchild_ctx[19] = list[i].isActive;\r\n\tchild_ctx[20] = list[i].hidden;\r\n\tchild_ctx[3] = list[i].visible;\r\n\treturn child_ctx;\r\n}\r\n\r\nconst get_default_slot_changes = dirty => ({\r\n\tpanel: dirty & /*panelNodes*/ 16,\r\n\tpanelIsActive: dirty & /*panelNodes*/ 16\r\n});\r\n\r\nconst get_default_slot_context = ctx => ({\r\n\tpanel: /*id*/ ctx[14],\r\n\tpanelIsActive: /*isActive*/ ctx[19]\r\n});\r\n\r\n// (60:0) {:else}\r\nfunction create_else_block$6(ctx) {\r\n\tlet div1;\r\n\tlet div0;\r\n\tlet div0_class_value;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tconst default_slot_template = /*#slots*/ ctx[11].default;\r\n\tconst default_slot = create_slot(default_slot_template, ctx, /*$$scope*/ ctx[10], get_default_slot_context_1);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv1 = element(\"div\");\r\n\t\t\tdiv0 = element(\"div\");\r\n\t\t\tif (default_slot) default_slot.c();\r\n\t\t\tattr(div0, \"class\", div0_class_value = arrayJoin([/*panelClass*/ ctx[1]]));\r\n\t\t\tattr(div1, \"class\", /*klass*/ ctx[0]);\r\n\t\t\tattr(div1, \"style\", /*style*/ ctx[2]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div1, anchor);\r\n\t\t\tappend(div1, div0);\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tdefault_slot.m(div0, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(div1, \"measure\", /*measure_handler_1*/ ctx[13]),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div1))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tif (default_slot.p && (!current || dirty & /*$$scope, panelNodes*/ 1040)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tdefault_slot,\r\n\t\t\t\t\t\tdefault_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[10],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[10])\r\n\t\t\t\t\t\t: get_slot_changes(default_slot_template, /*$$scope*/ ctx[10], dirty, get_default_slot_changes_1),\r\n\t\t\t\t\t\tget_default_slot_context_1\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*panelClass*/ 2 && div0_class_value !== (div0_class_value = arrayJoin([/*panelClass*/ ctx[1]]))) {\r\n\t\t\t\tattr(div0, \"class\", div0_class_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*klass*/ 1) {\r\n\t\t\t\tattr(div1, \"class\", /*klass*/ ctx[0]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*style*/ 4) {\r\n\t\t\t\tattr(div1, \"style\", /*style*/ ctx[2]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(default_slot, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(default_slot, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div1);\r\n\t\t\tif (default_slot) default_slot.d(detaching);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (39:0) {#if shouldRender}\r\nfunction create_if_block$f(ctx) {\r\n\tlet div;\r\n\tlet each_blocks = [];\r\n\tlet each_1_lookup = new Map();\r\n\tlet div_class_value;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tlet each_value = /*panelNodes*/ ctx[4];\r\n\tconst get_key = ctx => /*id*/ ctx[14];\r\n\r\n\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\tlet child_ctx = get_each_context$8(ctx, each_value, i);\r\n\t\tlet key = get_key(child_ctx);\r\n\t\teach_1_lookup.set(key, each_blocks[i] = create_each_block$8(key, child_ctx));\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].c();\r\n\t\t\t}\r\n\r\n\t\t\tattr(div, \"class\", div_class_value = arrayJoin(['PinturaTabPanels', /*klass*/ ctx[0]]));\r\n\t\t\tattr(div, \"style\", /*style*/ ctx[2]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].m(div, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(div, \"measure\", /*measure_handler*/ ctx[12]),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div, { observePosition: true }))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty & /*arrayJoin, panelClass, panelNodes, $$scope*/ 1042) {\r\n\t\t\t\teach_value = /*panelNodes*/ ctx[4];\r\n\t\t\t\tgroup_outros();\r\n\t\t\t\teach_blocks = update_keyed_each(each_blocks, dirty, get_key, 1, ctx, each_value, each_1_lookup, div, outro_and_destroy_block, create_each_block$8, null, get_each_context$8);\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*klass*/ 1 && div_class_value !== (div_class_value = arrayJoin(['PinturaTabPanels', /*klass*/ ctx[0]]))) {\r\n\t\t\t\tattr(div, \"class\", div_class_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*style*/ 4) {\r\n\t\t\t\tattr(div, \"style\", /*style*/ ctx[2]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\r\n\t\t\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\t\t\ttransition_in(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\ttransition_out(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].d();\r\n\t\t\t}\r\n\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (56:16) {#if shouldDraw}\r\nfunction create_if_block_1$e(ctx) {\r\n\tlet current;\r\n\tconst default_slot_template = /*#slots*/ ctx[11].default;\r\n\tconst default_slot = create_slot(default_slot_template, ctx, /*$$scope*/ ctx[10], get_default_slot_context);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (default_slot) default_slot.c();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tdefault_slot.m(target, anchor);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tif (default_slot.p && (!current || dirty & /*$$scope, panelNodes*/ 1040)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tdefault_slot,\r\n\t\t\t\t\t\tdefault_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[10],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[10])\r\n\t\t\t\t\t\t: get_slot_changes(default_slot_template, /*$$scope*/ ctx[10], dirty, get_default_slot_changes),\r\n\t\t\t\t\t\tget_default_slot_context\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(default_slot, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(default_slot, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (default_slot) default_slot.d(detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (47:8) {#each panelNodes as { id, shouldDraw, panelId, tabindex, labelledBy, isActive, hidden, visible }\r\nfunction create_each_block$8(key_1, ctx) {\r\n\tlet div;\r\n\tlet t;\r\n\tlet div_class_value;\r\n\tlet div_hidden_value;\r\n\tlet div_id_value;\r\n\tlet div_tabindex_value;\r\n\tlet div_aria_labelledby_value;\r\n\tlet div_data_inert_value;\r\n\tlet current;\r\n\tlet if_block = /*shouldDraw*/ ctx[15] && create_if_block_1$e(ctx);\r\n\r\n\treturn {\r\n\t\tkey: key_1,\r\n\t\tfirst: null,\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tt = space();\r\n\t\t\tattr(div, \"class\", div_class_value = arrayJoin(['PinturaTabPanel', /*panelClass*/ ctx[1]]));\r\n\t\t\tdiv.hidden = div_hidden_value = /*hidden*/ ctx[20];\r\n\t\t\tattr(div, \"id\", div_id_value = /*panelId*/ ctx[16]);\r\n\t\t\tattr(div, \"tabindex\", div_tabindex_value = /*tabindex*/ ctx[17]);\r\n\t\t\tattr(div, \"aria-labelledby\", div_aria_labelledby_value = /*labelledBy*/ ctx[18]);\r\n\t\t\tattr(div, \"data-inert\", div_data_inert_value = !/*visible*/ ctx[3]);\r\n\t\t\tthis.first = div;\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tif (if_block) if_block.m(div, null);\r\n\t\t\tappend(div, t);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\r\n\t\t\tif (/*shouldDraw*/ ctx[15]) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty & /*panelNodes*/ 16) {\r\n\t\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block_1$e(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(div, t);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block, 1, 1, () => {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*panelClass*/ 2 && div_class_value !== (div_class_value = arrayJoin(['PinturaTabPanel', /*panelClass*/ ctx[1]]))) {\r\n\t\t\t\tattr(div, \"class\", div_class_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*panelNodes*/ 16 && div_hidden_value !== (div_hidden_value = /*hidden*/ ctx[20])) {\r\n\t\t\t\tdiv.hidden = div_hidden_value;\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*panelNodes*/ 16 && div_id_value !== (div_id_value = /*panelId*/ ctx[16])) {\r\n\t\t\t\tattr(div, \"id\", div_id_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*panelNodes*/ 16 && div_tabindex_value !== (div_tabindex_value = /*tabindex*/ ctx[17])) {\r\n\t\t\t\tattr(div, \"tabindex\", div_tabindex_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*panelNodes*/ 16 && div_aria_labelledby_value !== (div_aria_labelledby_value = /*labelledBy*/ ctx[18])) {\r\n\t\t\t\tattr(div, \"aria-labelledby\", div_aria_labelledby_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*panelNodes*/ 16 && div_data_inert_value !== (div_data_inert_value = !/*visible*/ ctx[3])) {\r\n\t\t\t\tattr(div, \"data-inert\", div_data_inert_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif (if_block) if_block.d();\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$N(ctx) {\r\n\tlet current_block_type_index;\r\n\tlet if_block;\r\n\tlet if_block_anchor;\r\n\tlet current;\r\n\tconst if_block_creators = [create_if_block$f, create_else_block$6];\r\n\tconst if_blocks = [];\r\n\r\n\tfunction select_block_type(ctx, dirty) {\r\n\t\tif (/*shouldRender*/ ctx[5]) return 0;\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tcurrent_block_type_index = select_block_type(ctx);\r\n\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif_block.c();\r\n\t\t\tif_block_anchor = empty();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif_blocks[current_block_type_index].m(target, anchor);\r\n\t\t\tinsert(target, if_block_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tlet previous_block_index = current_block_type_index;\r\n\t\t\tcurrent_block_type_index = select_block_type(ctx);\r\n\r\n\t\t\tif (current_block_type_index === previous_block_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].p(ctx, dirty);\r\n\t\t\t} else {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_blocks[previous_block_index], 1, 1, () => {\r\n\t\t\t\t\tif_blocks[previous_block_index] = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t\tif_block = if_blocks[current_block_type_index];\r\n\r\n\t\t\t\tif (!if_block) {\r\n\t\t\t\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\tif_block.m(if_block_anchor.parentNode, if_block_anchor);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif_blocks[current_block_type_index].d(detaching);\r\n\t\t\tif (detaching) detach(if_block_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$O($$self, $$props, $$invalidate) {\r\n\tlet panelNodes;\r\n\tlet shouldRender;\r\n\tlet { $$slots: slots = {}, $$scope } = $$props;\r\n\tlet { class: klass = undefined } = $$props;\r\n\tlet { name } = $$props;\r\n\tlet { selected } = $$props;\r\n\tlet { panelClass = undefined } = $$props;\r\n\tlet { panels = [] } = $$props;\r\n\tlet { visible = undefined } = $$props;\r\n\tlet { style = undefined } = $$props;\r\n\tconst drawCache = {};\r\n\r\n\tfunction measure_handler(event) {\r\n\t\tbubble.call(this, $$self, event);\r\n\t}\r\n\r\n\tfunction measure_handler_1(event) {\r\n\t\tbubble.call(this, $$self, event);\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('class' in $$props) $$invalidate(0, klass = $$props.class);\r\n\t\tif ('name' in $$props) $$invalidate(6, name = $$props.name);\r\n\t\tif ('selected' in $$props) $$invalidate(7, selected = $$props.selected);\r\n\t\tif ('panelClass' in $$props) $$invalidate(1, panelClass = $$props.panelClass);\r\n\t\tif ('panels' in $$props) $$invalidate(8, panels = $$props.panels);\r\n\t\tif ('visible' in $$props) $$invalidate(3, visible = $$props.visible);\r\n\t\tif ('style' in $$props) $$invalidate(2, style = $$props.style);\r\n\t\tif ('$$scope' in $$props) $$invalidate(10, $$scope = $$props.$$scope);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*panels, selected, visible, name, drawCache*/ 968) {\r\n\t\t\t$$invalidate(4, panelNodes = panels.map(id => {\r\n\t\t\t\tconst isActive = id === selected;\r\n\r\n\t\t\t\t// remember that this tab was active so we keep drawing it even when it's inactive, speeds up page rendering\r\n\t\t\t\tif (isActive) $$invalidate(9, drawCache[id] = true, drawCache);\r\n\r\n\t\t\t\tconst isVisible = visible ? visible.indexOf(id) !== -1 : isActive;\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid,\r\n\t\t\t\t\tpanelId: `panel-${name}-${id}`,\r\n\t\t\t\t\tlabelledBy: `tab-${name}-${id}`,\r\n\t\t\t\t\tisActive,\r\n\t\t\t\t\thidden: !isActive,\r\n\t\t\t\t\tvisible: isVisible,\r\n\t\t\t\t\ttabindex: isActive ? 0 : -1,\r\n\t\t\t\t\tshouldDraw: isActive || drawCache[id]\r\n\t\t\t\t};\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*panelNodes*/ 16) {\r\n\t\t\t$$invalidate(5, shouldRender = panelNodes.length > 1);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tklass,\r\n\t\tpanelClass,\r\n\t\tstyle,\r\n\t\tvisible,\r\n\t\tpanelNodes,\r\n\t\tshouldRender,\r\n\t\tname,\r\n\t\tselected,\r\n\t\tpanels,\r\n\t\tdrawCache,\r\n\t\t$$scope,\r\n\t\tslots,\r\n\t\tmeasure_handler,\r\n\t\tmeasure_handler_1\r\n\t];\r\n}\r\n\r\nclass TabPanels extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$O, create_fragment$N, safe_not_equal, {\r\n\t\t\tclass: 0,\r\n\t\t\tname: 6,\r\n\t\t\tselected: 7,\r\n\t\t\tpanelClass: 1,\r\n\t\t\tpanels: 8,\r\n\t\t\tvisible: 3,\r\n\t\t\tstyle: 2\r\n\t\t});\r\n\t}\r\n}\r\n\r\nvar getComponentExportedProps = (Component) => {\r\n    const descriptors = Object.getOwnPropertyDescriptors(Component.prototype);\r\n    return Object.keys(descriptors).filter((key) => !!descriptors[key]['get']);\r\n};\r\n\r\n/* src/core/ui/components/Icon.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$M(ctx) {\r\n\tlet svg;\r\n\tlet svg_viewBox_value;\r\n\tlet current;\r\n\tconst default_slot_template = /*#slots*/ ctx[5].default;\r\n\tconst default_slot = create_slot(default_slot_template, ctx, /*$$scope*/ ctx[4], null);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tsvg = svg_element(\"svg\");\r\n\t\t\tif (default_slot) default_slot.c();\r\n\t\t\tattr(svg, \"class\", /*klass*/ ctx[3]);\r\n\t\t\tattr(svg, \"style\", /*style*/ ctx[2]);\r\n\t\t\tattr(svg, \"width\", /*width*/ ctx[0]);\r\n\t\t\tattr(svg, \"height\", /*height*/ ctx[1]);\r\n\t\t\tattr(svg, \"viewBox\", svg_viewBox_value = \"0 0 \" + /*width*/ ctx[0] + \"\\n    \" + /*height*/ ctx[1]);\r\n\t\t\tattr(svg, \"xmlns\", \"http://www.w3.org/2000/svg\");\r\n\t\t\tattr(svg, \"aria-hidden\", \"true\");\r\n\t\t\tattr(svg, \"focusable\", \"false\");\r\n\t\t\tattr(svg, \"stroke-linecap\", \"round\");\r\n\t\t\tattr(svg, \"stroke-linejoin\", \"round\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, svg, anchor);\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tdefault_slot.m(svg, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tif (default_slot.p && (!current || dirty & /*$$scope*/ 16)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tdefault_slot,\r\n\t\t\t\t\t\tdefault_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[4],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[4])\r\n\t\t\t\t\t\t: get_slot_changes(default_slot_template, /*$$scope*/ ctx[4], dirty, null),\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*klass*/ 8) {\r\n\t\t\t\tattr(svg, \"class\", /*klass*/ ctx[3]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*style*/ 4) {\r\n\t\t\t\tattr(svg, \"style\", /*style*/ ctx[2]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*width*/ 1) {\r\n\t\t\t\tattr(svg, \"width\", /*width*/ ctx[0]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*height*/ 2) {\r\n\t\t\t\tattr(svg, \"height\", /*height*/ ctx[1]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*width, height*/ 3 && svg_viewBox_value !== (svg_viewBox_value = \"0 0 \" + /*width*/ ctx[0] + \"\\n    \" + /*height*/ ctx[1])) {\r\n\t\t\t\tattr(svg, \"viewBox\", svg_viewBox_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(default_slot, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(default_slot, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(svg);\r\n\t\t\tif (default_slot) default_slot.d(detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$N($$self, $$props, $$invalidate) {\r\n\tlet { $$slots: slots = {}, $$scope } = $$props;\r\n\tlet { width = 24 } = $$props;\r\n\tlet { height = 24 } = $$props;\r\n\tlet { style = undefined } = $$props;\r\n\tlet { class: klass = undefined } = $$props;\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('width' in $$props) $$invalidate(0, width = $$props.width);\r\n\t\tif ('height' in $$props) $$invalidate(1, height = $$props.height);\r\n\t\tif ('style' in $$props) $$invalidate(2, style = $$props.style);\r\n\t\tif ('class' in $$props) $$invalidate(3, klass = $$props.class);\r\n\t\tif ('$$scope' in $$props) $$invalidate(4, $$scope = $$props.$$scope);\r\n\t};\r\n\r\n\treturn [width, height, style, klass, $$scope, slots];\r\n}\r\n\r\nclass Icon extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\t\tinit(this, options, instance$N, create_fragment$M, safe_not_equal, { width: 0, height: 1, style: 2, class: 3 });\r\n\t}\r\n}\r\n\r\nvar nudgeable = (element, options = {}) => {\r\n    // if added as action on non focusable element you should add tabindex=0 attribute\r\n    const { direction = undefined, shiftMultiplier = 10, bubbles = false, preventDefault = false, stopKeydownPropagation = true, } = options;\r\n    const isHorizontalDirection = direction === 'horizontal';\r\n    const isVerticalDirection = direction === 'vertical';\r\n    const handleKeydown = (e) => {\r\n        const { key } = e;\r\n        const isShift = e.shiftKey;\r\n        const isVerticalAction = /up|down/i.test(key);\r\n        const isHorizontalAction = /left|right/i.test(key);\r\n        // no directional key\r\n        if (!isHorizontalAction && !isVerticalAction)\r\n            return;\r\n        // is horizontal but up or down pressed\r\n        if (isHorizontalDirection && isVerticalAction)\r\n            return;\r\n        // is vertical but left or right pressed\r\n        if (isVerticalDirection && isHorizontalAction)\r\n            return;\r\n        // if holding shift move by a factor 10\r\n        const multiplier = isShift ? shiftMultiplier : 1;\r\n        if (stopKeydownPropagation)\r\n            e.stopPropagation();\r\n        if (preventDefault)\r\n            e.preventDefault();\r\n        element.dispatchEvent(new CustomEvent('nudge', {\r\n            bubbles,\r\n            detail: vectorCreate((/left/i.test(key) ? -1 : /right/i.test(key) ? 1 : 0) * multiplier, (/up/i.test(key) ? -1 : /down/i.test(key) ? 1 : 0) * multiplier),\r\n        }));\r\n    };\r\n    element.addEventListener('keydown', handleKeydown);\r\n    return {\r\n        destroy() {\r\n            element.removeEventListener('keydown', handleKeydown);\r\n        },\r\n    };\r\n};\r\n\r\nvar numberRoundTo = (value, fraction) => {\r\n    fraction = 1 / fraction;\r\n    return Math.round(value * fraction) / fraction;\r\n};\r\n\r\nvar toFraction = (value, min, max) => (value - min) / (max - min);\r\n\r\n/* src/core/ui/components/Slider.svelte generated by Svelte v3.50.1 */\r\nconst get_knob_slot_changes = dirty => ({});\r\nconst get_knob_slot_context = ctx => ({});\r\n\r\n// (237:4) {#if enableSpinButtons}\r\nfunction create_if_block$e(ctx) {\r\n\tlet button0;\r\n\tlet icon0;\r\n\tlet t;\r\n\tlet button1;\r\n\tlet icon1;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\ticon0 = new Icon({\r\n\t\t\tprops: {\r\n\t\t\t\t$$slots: { default: [create_default_slot_1$7] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\ticon1 = new Icon({\r\n\t\t\tprops: {\r\n\t\t\t\t$$slots: { default: [create_default_slot$h] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tbutton0 = element(\"button\");\r\n\t\t\tcreate_component(icon0.$$.fragment);\r\n\t\t\tt = space();\r\n\t\t\tbutton1 = element(\"button\");\r\n\t\t\tcreate_component(icon1.$$.fragment);\r\n\t\t\tattr(button0, \"type\", \"button\");\r\n\t\t\tattr(button0, \"aria-label\", \"Increase\");\r\n\t\t\tattr(button1, \"type\", \"button\");\r\n\t\t\tattr(button1, \"aria-label\", \"Decrease\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, button0, anchor);\r\n\t\t\tmount_component(icon0, button0, null);\r\n\t\t\tinsert(target, t, anchor);\r\n\t\t\tinsert(target, button1, anchor);\r\n\t\t\tmount_component(icon1, button1, null);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(button0, \"pointerdown\", /*handleUpdaterDown*/ ctx[20](1)),\r\n\t\t\t\t\tlisten(button1, \"pointerdown\", /*handleUpdaterDown*/ ctx[20](-1))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst icon0_changes = {};\r\n\r\n\t\t\tif (dirty[1] & /*$$scope*/ 128) {\r\n\t\t\t\ticon0_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ticon0.$set(icon0_changes);\r\n\t\t\tconst icon1_changes = {};\r\n\r\n\t\t\tif (dirty[1] & /*$$scope*/ 128) {\r\n\t\t\t\ticon1_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ticon1.$set(icon1_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(icon0.$$.fragment, local);\r\n\t\t\ttransition_in(icon1.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(icon0.$$.fragment, local);\r\n\t\t\ttransition_out(icon1.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(button0);\r\n\t\t\tdestroy_component(icon0);\r\n\t\t\tif (detaching) detach(t);\r\n\t\t\tif (detaching) detach(button1);\r\n\t\t\tdestroy_component(icon1);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (239:12) <Icon>\r\nfunction create_default_slot_1$7(ctx) {\r\n\tlet path;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tpath = svg_element(\"path\");\r\n\t\t\tattr(path, \"d\", \"M8 12 h8 M12 8 v8\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, path, anchor);\r\n\t\t},\r\n\t\tp: noop,\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(path);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (242:12) <Icon>\r\nfunction create_default_slot$h(ctx) {\r\n\tlet path;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tpath = svg_element(\"path\");\r\n\t\t\tattr(path, \"d\", \"M9 12 h6\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, path, anchor);\r\n\t\t},\r\n\t\tp: noop,\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(path);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$L(ctx) {\r\n\tlet div4;\r\n\tlet div3;\r\n\tlet input_1;\r\n\tlet input_1_style_value;\r\n\tlet t0;\r\n\tlet div0;\r\n\tlet div0_class_value;\r\n\tlet t1;\r\n\tlet div2;\r\n\tlet div1;\r\n\tlet div1_class_value;\r\n\tlet div3_style_value;\r\n\tlet t2;\r\n\tlet div4_class_value;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tconst default_slot_template = /*#slots*/ ctx[36].default;\r\n\tconst default_slot = create_slot(default_slot_template, ctx, /*$$scope*/ ctx[38], null);\r\n\tconst knob_slot_template = /*#slots*/ ctx[36].knob;\r\n\tconst knob_slot = create_slot(knob_slot_template, ctx, /*$$scope*/ ctx[38], get_knob_slot_context);\r\n\tlet if_block = /*enableSpinButtons*/ ctx[9] && create_if_block$e(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv4 = element(\"div\");\r\n\t\t\tdiv3 = element(\"div\");\r\n\t\t\tinput_1 = element(\"input\");\r\n\t\t\tt0 = space();\r\n\t\t\tdiv0 = element(\"div\");\r\n\t\t\tif (default_slot) default_slot.c();\r\n\t\t\tt1 = space();\r\n\t\t\tdiv2 = element(\"div\");\r\n\t\t\tdiv1 = element(\"div\");\r\n\t\t\tif (knob_slot) knob_slot.c();\r\n\t\t\tt2 = space();\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tattr(input_1, \"type\", \"range\");\r\n\t\t\tattr(input_1, \"id\", /*id*/ ctx[3]);\r\n\t\t\tattr(input_1, \"min\", /*min*/ ctx[0]);\r\n\t\t\tattr(input_1, \"max\", /*max*/ ctx[1]);\r\n\t\t\tattr(input_1, \"step\", /*step*/ ctx[2]);\r\n\t\t\tinput_1.value = /*numberValue*/ ctx[14];\r\n\r\n\t\t\tattr(input_1, \"style\", input_1_style_value = /*enableForceUseKnob*/ ctx[10]\r\n\t\t\t? 'pointer-events:none'\r\n\t\t\t: '');\r\n\r\n\t\t\tattr(div0, \"class\", div0_class_value = arrayJoin(['PinturaSliderTrack', /*trackClass*/ ctx[5]]));\r\n\t\t\tattr(div0, \"style\", /*trackStyle*/ ctx[4]);\r\n\t\t\tattr(div1, \"class\", div1_class_value = arrayJoin(['PinturaSliderKnob', /*knobClass*/ ctx[7]]));\r\n\t\t\tattr(div1, \"style\", /*knobStyle*/ ctx[6]);\r\n\t\t\tattr(div2, \"class\", \"PinturaSliderKnobController\");\r\n\t\t\tattr(div2, \"style\", /*knobControllerStyle*/ ctx[17]);\r\n\t\t\tattr(div3, \"class\", \"PinturaSliderControl\");\r\n\t\t\tattr(div3, \"style\", div3_style_value = `--slider-position:${Math.round(/*position*/ ctx[15])}`);\r\n\t\t\tattr(div4, \"class\", div4_class_value = arrayJoin(['PinturaSlider', /*klass*/ ctx[12]]));\r\n\t\t\tattr(div4, \"data-direction\", /*direction*/ ctx[8]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div4, anchor);\r\n\t\t\tappend(div4, div3);\r\n\t\t\tappend(div3, input_1);\r\n\t\t\t/*input_1_binding*/ ctx[37](input_1);\r\n\t\t\tappend(div3, t0);\r\n\t\t\tappend(div3, div0);\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tdefault_slot.m(div0, null);\r\n\t\t\t}\r\n\r\n\t\t\tappend(div3, t1);\r\n\t\t\tappend(div3, div2);\r\n\t\t\tappend(div2, div1);\r\n\r\n\t\t\tif (knob_slot) {\r\n\t\t\t\tknob_slot.m(div1, null);\r\n\t\t\t}\r\n\r\n\t\t\tappend(div4, t2);\r\n\t\t\tif (if_block) if_block.m(div4, null);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(input_1, \"input\", /*handleInput*/ ctx[18]),\r\n\t\t\t\t\tlisten(input_1, \"nudge\", /*handleNudge*/ ctx[19]),\r\n\t\t\t\t\taction_destroyer(nudgeable.call(null, input_1)),\r\n\t\t\t\t\tlisten(div3, \"pointerdown\", function () {\r\n\t\t\t\t\t\tif (is_function(/*enablePointerdownListener*/ ctx[11] && /*handlePointerDown*/ ctx[13])) (/*enablePointerdownListener*/ ctx[11] && /*handlePointerDown*/ ctx[13]).apply(this, arguments);\r\n\t\t\t\t\t})\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\r\n\t\t\tif (!current || dirty[0] & /*id*/ 8) {\r\n\t\t\t\tattr(input_1, \"id\", /*id*/ ctx[3]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*min*/ 1) {\r\n\t\t\t\tattr(input_1, \"min\", /*min*/ ctx[0]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*max*/ 2) {\r\n\t\t\t\tattr(input_1, \"max\", /*max*/ ctx[1]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*step*/ 4) {\r\n\t\t\t\tattr(input_1, \"step\", /*step*/ ctx[2]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*numberValue*/ 16384) {\r\n\t\t\t\tinput_1.value = /*numberValue*/ ctx[14];\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*enableForceUseKnob*/ 1024 && input_1_style_value !== (input_1_style_value = /*enableForceUseKnob*/ ctx[10]\r\n\t\t\t? 'pointer-events:none'\r\n\t\t\t: '')) {\r\n\t\t\t\tattr(input_1, \"style\", input_1_style_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tif (default_slot.p && (!current || dirty[1] & /*$$scope*/ 128)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tdefault_slot,\r\n\t\t\t\t\t\tdefault_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[38],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[38])\r\n\t\t\t\t\t\t: get_slot_changes(default_slot_template, /*$$scope*/ ctx[38], dirty, null),\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*trackClass*/ 32 && div0_class_value !== (div0_class_value = arrayJoin(['PinturaSliderTrack', /*trackClass*/ ctx[5]]))) {\r\n\t\t\t\tattr(div0, \"class\", div0_class_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*trackStyle*/ 16) {\r\n\t\t\t\tattr(div0, \"style\", /*trackStyle*/ ctx[4]);\r\n\t\t\t}\r\n\r\n\t\t\tif (knob_slot) {\r\n\t\t\t\tif (knob_slot.p && (!current || dirty[1] & /*$$scope*/ 128)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tknob_slot,\r\n\t\t\t\t\t\tknob_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[38],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[38])\r\n\t\t\t\t\t\t: get_slot_changes(knob_slot_template, /*$$scope*/ ctx[38], dirty, get_knob_slot_changes),\r\n\t\t\t\t\t\tget_knob_slot_context\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*knobClass*/ 128 && div1_class_value !== (div1_class_value = arrayJoin(['PinturaSliderKnob', /*knobClass*/ ctx[7]]))) {\r\n\t\t\t\tattr(div1, \"class\", div1_class_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*knobStyle*/ 64) {\r\n\t\t\t\tattr(div1, \"style\", /*knobStyle*/ ctx[6]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*knobControllerStyle*/ 131072) {\r\n\t\t\t\tattr(div2, \"style\", /*knobControllerStyle*/ ctx[17]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*position*/ 32768 && div3_style_value !== (div3_style_value = `--slider-position:${Math.round(/*position*/ ctx[15])}`)) {\r\n\t\t\t\tattr(div3, \"style\", div3_style_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (/*enableSpinButtons*/ ctx[9]) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[0] & /*enableSpinButtons*/ 512) {\r\n\t\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block$e(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(div4, null);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block, 1, 1, () => {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*klass*/ 4096 && div4_class_value !== (div4_class_value = arrayJoin(['PinturaSlider', /*klass*/ ctx[12]]))) {\r\n\t\t\t\tattr(div4, \"class\", div4_class_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*direction*/ 256) {\r\n\t\t\t\tattr(div4, \"data-direction\", /*direction*/ ctx[8]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(default_slot, local);\r\n\t\t\ttransition_in(knob_slot, local);\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(default_slot, local);\r\n\t\t\ttransition_out(knob_slot, local);\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div4);\r\n\t\t\t/*input_1_binding*/ ctx[37](null);\r\n\t\t\tif (default_slot) default_slot.d(detaching);\r\n\t\t\tif (knob_slot) knob_slot.d(detaching);\r\n\t\t\tif (if_block) if_block.d();\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$M($$self, $$props, $$invalidate) {\r\n\tlet numberValue;\r\n\tlet range;\r\n\tlet fraction;\r\n\tlet position;\r\n\tlet axis;\r\n\tlet dimension;\r\n\tlet offsetSizeProp;\r\n\tlet pageAxisProp;\r\n\tlet knobControllerStyle;\r\n\tlet { $$slots: slots = {}, $$scope } = $$props;\r\n\tlet { min = 0 } = $$props;\r\n\tlet { max = 100 } = $$props;\r\n\tlet { step = 1 } = $$props;\r\n\tlet { id = undefined } = $$props;\r\n\tlet { value = 0 } = $$props;\r\n\tlet { valueMin = undefined } = $$props;\r\n\tlet { valueMax = undefined } = $$props;\r\n\tlet { trackStyle = undefined } = $$props;\r\n\tlet { trackClass = undefined } = $$props;\r\n\tlet { knobStyle = undefined } = $$props;\r\n\tlet { knobClass = undefined } = $$props;\r\n\tlet { ongrab = noop$1 } = $$props;\r\n\tlet { onchange = noop$1 } = $$props;\r\n\tlet { onrelease = noop$1 } = $$props;\r\n\tlet { onexceed = noop$1 } = $$props;\r\n\tlet { direction = 'x' } = $$props;\r\n\tlet { getValue = passthrough } = $$props;\r\n\tlet { setValue = passthrough } = $$props;\r\n\tlet { enableSpinButtons = true } = $$props;\r\n\tlet { enableForceUseKnob = false } = $$props;\r\n\tlet { enableStopPropagation = true } = $$props;\r\n\tlet { enablePointerdownListener = true } = $$props;\r\n\tlet { maxInteractionDistance = 6 } = $$props;\r\n\tlet { class: klass = undefined } = $$props;\r\n\tlet input;\r\n\tlet inputSize;\r\n\tlet inputOffset;\r\n\tlet pageOffset;\r\n\tlet valuePrev;\r\n\tlet valuePrevIntended;\r\n\tconst formatValue = value => setValue(numberRoundTo(clamp(value, min, max), step));\r\n\r\n\tconst setValueByOffset = (offset, size, options = {}) => {\r\n\t\tconst { grabbed = false, released = false } = options;\r\n\t\tconst intendedValue = formatValue(min + offset / size * range);\r\n\t\tconst minValue = valueMin || min;\r\n\t\tconst maxValue = valueMax || max;\r\n\r\n\t\t$$invalidate(21, value = isString(intendedValue)\r\n\t\t? intendedValue\r\n\t\t: clamp(intendedValue, minValue, maxValue));\r\n\r\n\t\t// skip\r\n\t\tif (valuePrevIntended === intendedValue) return;\r\n\r\n\t\tvaluePrevIntended = intendedValue;\r\n\r\n\t\tif (!isString(intendedValue) && (intendedValue < minValue || intendedValue > maxValue)) {\r\n\t\t\tonexceed(value, intendedValue);\r\n\t\t}\r\n\r\n\t\tif (value === valuePrev) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvaluePrev = value;\r\n\t\tif (grabbed) ongrab(value);\r\n\t\tonchange(value);\r\n\t\tif (released) onrelease(value);\r\n\t};\r\n\r\n\tconst handleInput = e => {\r\n\t\t// already handled by pointer events\r\n\t\tif (inputSize) return;\r\n\r\n\t\t$$invalidate(21, value = setValue(parseFloat(e.target.value)));\r\n\t\tif (value === valuePrev) return;\r\n\t\tvaluePrev = value;\r\n\t\tonchange(value);\r\n\t};\r\n\r\n\tlet nudgeTimer;\r\n\r\n\tconst handleNudge = e => {\r\n\t\tconst size = input[offsetSizeProp];\r\n\t\tconst offset = numberValue / range * size;\r\n\t\tsetValueByOffset(offset + e.detail[direction], size);\r\n\t\tclearTimeout(nudgeTimer);\r\n\r\n\t\tnudgeTimer = setTimeout(\r\n\t\t\t() => {\r\n\t\t\t\tonrelease(value);\r\n\t\t\t},\r\n\t\t\t250\r\n\t\t);\r\n\t};\r\n\r\n\tconst eventDistanceToKnob = e => {\r\n\t\tconst clientRect = input.getBoundingClientRect();\r\n\t\tconst pageOffset = e[pageAxisProp];\r\n\t\tconst inputOffset = pageOffset - clientRect[direction];\r\n\t\tconst inputSize = input[offsetSizeProp];\r\n\t\treturn Math.abs(inputOffset - fraction * inputSize);\r\n\t};\r\n\r\n\tconst handlePointerDown = e => {\r\n\t\tlet stopPropagation = false;\r\n\t\tenableStopPropagation && e.stopPropagation();\r\n\t\tclearTimeout(nudgeTimer);\r\n\t\tconst clientRect = input.getBoundingClientRect();\r\n\t\tinputSize = input[offsetSizeProp];\r\n\t\tpageOffset = e[pageAxisProp];\r\n\t\tinputOffset = pageOffset - clientRect[direction];\r\n\r\n\t\tif (enableForceUseKnob) {\r\n\t\t\tconst dist = Math.abs(inputOffset - fraction * inputSize);\r\n\t\t\tif (dist > maxInteractionDistance) return;\r\n\t\t\tstopPropagation = true;\r\n\t\t\te.stopPropagation();\r\n\t\t}\r\n\r\n\t\tif (document.activeElement !== input) input.focus();\r\n\t\tsetValueByOffset(inputOffset, inputSize, { grabbed: true });\r\n\t\tdocument.documentElement.addEventListener('pointermove', handlePointerMove);\r\n\t\tdocument.documentElement.addEventListener('pointerup', handlePointerUp);\r\n\t\treturn stopPropagation;\r\n\t};\r\n\r\n\tconst handlePointerMove = e => {\r\n\t\tconst d = e[pageAxisProp] - pageOffset;\r\n\t\tsetValueByOffset(inputOffset + d, inputSize);\r\n\t};\r\n\r\n\tconst handlePointerUp = e => {\r\n\t\tinputSize = undefined;\r\n\t\tdocument.documentElement.removeEventListener('pointermove', handlePointerMove);\r\n\t\tdocument.documentElement.removeEventListener('pointerup', handlePointerUp);\r\n\t\tonchange(value);\r\n\t\tonrelease(value);\r\n\t};\r\n\r\n\tconst update = () => {\r\n\t\t$$invalidate(21, value = formatValue(numberValue + updateDir * step));\r\n\t\tonchange(value);\r\n\t};\r\n\r\n\tlet updateTimer;\r\n\tlet updateDir = 1;\r\n\tlet didUpdate = false;\r\n\r\n\tconst handleUpdaterDown = dir => e => {\r\n\t\tclearTimeout(nudgeTimer);\r\n\t\tupdateDir = dir;\r\n\t\tdidUpdate = false;\r\n\r\n\t\tupdateTimer = setInterval(\r\n\t\t\t() => {\r\n\t\t\t\tdidUpdate = true;\r\n\t\t\t\tupdate();\r\n\t\t\t},\r\n\t\t\t100\r\n\t\t);\r\n\r\n\t\tdocument.addEventListener('pointercancel', handleUpdaterUp);\r\n\t\tdocument.addEventListener('pointerup', handleUpdaterUp);\r\n\t};\r\n\r\n\tconst handleUpdaterUp = e => {\r\n\t\tclearTimeout(updateTimer);\r\n\t\tif (!didUpdate) update();\r\n\t\tonrelease(value);\r\n\t\tdocument.removeEventListener('pointerup', handleUpdaterUp);\r\n\t};\r\n\r\n\tfunction input_1_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\tinput = $$value;\r\n\t\t\t$$invalidate(16, input);\r\n\t\t});\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('min' in $$props) $$invalidate(0, min = $$props.min);\r\n\t\tif ('max' in $$props) $$invalidate(1, max = $$props.max);\r\n\t\tif ('step' in $$props) $$invalidate(2, step = $$props.step);\r\n\t\tif ('id' in $$props) $$invalidate(3, id = $$props.id);\r\n\t\tif ('value' in $$props) $$invalidate(21, value = $$props.value);\r\n\t\tif ('valueMin' in $$props) $$invalidate(22, valueMin = $$props.valueMin);\r\n\t\tif ('valueMax' in $$props) $$invalidate(23, valueMax = $$props.valueMax);\r\n\t\tif ('trackStyle' in $$props) $$invalidate(4, trackStyle = $$props.trackStyle);\r\n\t\tif ('trackClass' in $$props) $$invalidate(5, trackClass = $$props.trackClass);\r\n\t\tif ('knobStyle' in $$props) $$invalidate(6, knobStyle = $$props.knobStyle);\r\n\t\tif ('knobClass' in $$props) $$invalidate(7, knobClass = $$props.knobClass);\r\n\t\tif ('ongrab' in $$props) $$invalidate(24, ongrab = $$props.ongrab);\r\n\t\tif ('onchange' in $$props) $$invalidate(25, onchange = $$props.onchange);\r\n\t\tif ('onrelease' in $$props) $$invalidate(26, onrelease = $$props.onrelease);\r\n\t\tif ('onexceed' in $$props) $$invalidate(27, onexceed = $$props.onexceed);\r\n\t\tif ('direction' in $$props) $$invalidate(8, direction = $$props.direction);\r\n\t\tif ('getValue' in $$props) $$invalidate(28, getValue = $$props.getValue);\r\n\t\tif ('setValue' in $$props) $$invalidate(29, setValue = $$props.setValue);\r\n\t\tif ('enableSpinButtons' in $$props) $$invalidate(9, enableSpinButtons = $$props.enableSpinButtons);\r\n\t\tif ('enableForceUseKnob' in $$props) $$invalidate(10, enableForceUseKnob = $$props.enableForceUseKnob);\r\n\t\tif ('enableStopPropagation' in $$props) $$invalidate(30, enableStopPropagation = $$props.enableStopPropagation);\r\n\t\tif ('enablePointerdownListener' in $$props) $$invalidate(11, enablePointerdownListener = $$props.enablePointerdownListener);\r\n\t\tif ('maxInteractionDistance' in $$props) $$invalidate(31, maxInteractionDistance = $$props.maxInteractionDistance);\r\n\t\tif ('class' in $$props) $$invalidate(12, klass = $$props.class);\r\n\t\tif ('$$scope' in $$props) $$invalidate(38, $$scope = $$props.$$scope);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*value, getValue*/ 270532608) {\r\n\t\t\t$$invalidate(14, numberValue = value !== undefined ? getValue(value) : 0);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*max, min*/ 3) {\r\n\t\t\trange = max - min;\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*numberValue, min, max*/ 16387) {\r\n\t\t\t$$invalidate(33, fraction = toFraction(numberValue, min, max));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*fraction*/ 4) {\r\n\t\t\t$$invalidate(15, position = fraction * 100);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*direction*/ 256) {\r\n\t\t\t$$invalidate(34, axis = direction.toUpperCase());\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*direction*/ 256) {\r\n\t\t\t$$invalidate(35, dimension = direction === 'x' ? 'Width' : 'Height');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*dimension*/ 16) {\r\n\t\t\toffsetSizeProp = `offset${dimension}`;\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*axis*/ 8) ;\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*axis*/ 8) {\r\n\t\t\tpageAxisProp = `page${axis}`;\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*position*/ 32768 | $$self.$$.dirty[1] & /*axis*/ 8) {\r\n\t\t\t$$invalidate(17, knobControllerStyle = `transform: translate${axis}(${position}%)`);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tmin,\r\n\t\tmax,\r\n\t\tstep,\r\n\t\tid,\r\n\t\ttrackStyle,\r\n\t\ttrackClass,\r\n\t\tknobStyle,\r\n\t\tknobClass,\r\n\t\tdirection,\r\n\t\tenableSpinButtons,\r\n\t\tenableForceUseKnob,\r\n\t\tenablePointerdownListener,\r\n\t\tklass,\r\n\t\thandlePointerDown,\r\n\t\tnumberValue,\r\n\t\tposition,\r\n\t\tinput,\r\n\t\tknobControllerStyle,\r\n\t\thandleInput,\r\n\t\thandleNudge,\r\n\t\thandleUpdaterDown,\r\n\t\tvalue,\r\n\t\tvalueMin,\r\n\t\tvalueMax,\r\n\t\tongrab,\r\n\t\tonchange,\r\n\t\tonrelease,\r\n\t\tonexceed,\r\n\t\tgetValue,\r\n\t\tsetValue,\r\n\t\tenableStopPropagation,\r\n\t\tmaxInteractionDistance,\r\n\t\teventDistanceToKnob,\r\n\t\tfraction,\r\n\t\taxis,\r\n\t\tdimension,\r\n\t\tslots,\r\n\t\tinput_1_binding,\r\n\t\t$$scope\r\n\t];\r\n}\r\n\r\nclass Slider extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$M,\r\n\t\t\tcreate_fragment$L,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tmin: 0,\r\n\t\t\t\tmax: 1,\r\n\t\t\t\tstep: 2,\r\n\t\t\t\tid: 3,\r\n\t\t\t\tvalue: 21,\r\n\t\t\t\tvalueMin: 22,\r\n\t\t\t\tvalueMax: 23,\r\n\t\t\t\ttrackStyle: 4,\r\n\t\t\t\ttrackClass: 5,\r\n\t\t\t\tknobStyle: 6,\r\n\t\t\t\tknobClass: 7,\r\n\t\t\t\tongrab: 24,\r\n\t\t\t\tonchange: 25,\r\n\t\t\t\tonrelease: 26,\r\n\t\t\t\tonexceed: 27,\r\n\t\t\t\tdirection: 8,\r\n\t\t\t\tgetValue: 28,\r\n\t\t\t\tsetValue: 29,\r\n\t\t\t\tenableSpinButtons: 9,\r\n\t\t\t\tenableForceUseKnob: 10,\r\n\t\t\t\tenableStopPropagation: 30,\r\n\t\t\t\tenablePointerdownListener: 11,\r\n\t\t\t\tmaxInteractionDistance: 31,\r\n\t\t\t\tclass: 12,\r\n\t\t\t\teventDistanceToKnob: 32,\r\n\t\t\t\thandlePointerDown: 13\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1]\r\n\t\t);\r\n\t}\r\n\r\n\tget eventDistanceToKnob() {\r\n\t\treturn this.$$.ctx[32];\r\n\t}\r\n\r\n\tget handlePointerDown() {\r\n\t\treturn this.$$.ctx[13];\r\n\t}\r\n}\r\n\r\nvar isEventTarget = (e, element) => element === e.target || element.contains(e.target);\r\n\r\n/* src/core/ui/components/Button.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_if_block_1$d(ctx) {\r\n\tlet icon_1;\r\n\tlet current;\r\n\r\n\ticon_1 = new Icon({\r\n\t\t\tprops: {\r\n\t\t\t\tclass: \"PinturaButtonIcon\",\r\n\t\t\t\t$$slots: { default: [create_default_slot$g] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(icon_1.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(icon_1, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst icon_1_changes = {};\r\n\r\n\t\t\tif (dirty & /*$$scope, icon*/ 134217730) {\r\n\t\t\t\ticon_1_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ticon_1.$set(icon_1_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(icon_1.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(icon_1.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(icon_1, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (79:16) <Icon class=\"PinturaButtonIcon\">\r\nfunction create_default_slot$g(ctx) {\r\n\tlet g;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tg = svg_element(\"g\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, g, anchor);\r\n\t\t\tg.innerHTML = /*icon*/ ctx[1];\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty & /*icon*/ 2) g.innerHTML = /*icon*/ ctx[1];\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(g);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (85:12) {#if label}\r\nfunction create_if_block$d(ctx) {\r\n\tlet span;\r\n\tlet t;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt = text(/*label*/ ctx[0]);\r\n\t\t\tattr(span, \"class\", /*elLabelClass*/ ctx[9]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t\tappend(span, t);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty & /*label*/ 1) set_data(t, /*label*/ ctx[0]);\r\n\r\n\t\t\tif (dirty & /*elLabelClass*/ 512) {\r\n\t\t\t\tattr(span, \"class\", /*elLabelClass*/ ctx[9]);\r\n\t\t\t}\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (76:10)          \r\nfunction fallback_block$2(ctx) {\r\n\tlet span;\r\n\tlet t;\r\n\tlet current;\r\n\tlet if_block0 = /*icon*/ ctx[1] && create_if_block_1$d(ctx);\r\n\tlet if_block1 = /*label*/ ctx[0] && create_if_block$d(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tif (if_block0) if_block0.c();\r\n\t\t\tt = space();\r\n\t\t\tif (if_block1) if_block1.c();\r\n\t\t\tattr(span, \"class\", /*elButtonInnerClass*/ ctx[11]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t\tif (if_block0) if_block0.m(span, null);\r\n\t\t\tappend(span, t);\r\n\t\t\tif (if_block1) if_block1.m(span, null);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (/*icon*/ ctx[1]) {\r\n\t\t\t\tif (if_block0) {\r\n\t\t\t\t\tif_block0.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty & /*icon*/ 2) {\r\n\t\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block0 = create_if_block_1$d(ctx);\r\n\t\t\t\t\tif_block0.c();\r\n\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\tif_block0.m(span, t);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block0) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block0, 1, 1, () => {\r\n\t\t\t\t\tif_block0 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (/*label*/ ctx[0]) {\r\n\t\t\t\tif (if_block1) {\r\n\t\t\t\t\tif_block1.p(ctx, dirty);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block1 = create_if_block$d(ctx);\r\n\t\t\t\t\tif_block1.c();\r\n\t\t\t\t\tif_block1.m(span, null);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block1) {\r\n\t\t\t\tif_block1.d(1);\r\n\t\t\t\tif_block1 = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*elButtonInnerClass*/ 2048) {\r\n\t\t\t\tattr(span, \"class\", /*elButtonInnerClass*/ ctx[11]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block0);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block0);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t\tif (if_block0) if_block0.d();\r\n\t\t\tif (if_block1) if_block1.d();\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$K(ctx) {\r\n\tlet button;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tconst default_slot_template = /*#slots*/ ctx[25].default;\r\n\tconst default_slot = create_slot(default_slot_template, ctx, /*$$scope*/ ctx[27], null);\r\n\tconst default_slot_or_fallback = default_slot || fallback_block$2(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tbutton = element(\"button\");\r\n\t\t\tif (default_slot_or_fallback) default_slot_or_fallback.c();\r\n\t\t\tattr(button, \"type\", /*type*/ ctx[4]);\r\n\t\t\tattr(button, \"style\", /*style*/ ctx[2]);\r\n\t\t\tbutton.disabled = /*disabled*/ ctx[3];\r\n\t\t\tattr(button, \"class\", /*elButtonClass*/ ctx[10]);\r\n\t\t\tattr(button, \"title\", /*label*/ ctx[0]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, button, anchor);\r\n\r\n\t\t\tif (default_slot_or_fallback) {\r\n\t\t\t\tdefault_slot_or_fallback.m(button, null);\r\n\t\t\t}\r\n\r\n\t\t\t/*button_binding*/ ctx[26](button);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(button, \"keydown\", function () {\r\n\t\t\t\t\t\tif (is_function(/*onkeydown*/ ctx[6])) /*onkeydown*/ ctx[6].apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(button, \"click\", function () {\r\n\t\t\t\t\t\tif (is_function(/*onclick*/ ctx[5])) /*onclick*/ ctx[5].apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(button, \"pointerdown\", function () {\r\n\t\t\t\t\t\tif (is_function(/*handleDown*/ ctx[12])) /*handleDown*/ ctx[12].apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\taction_destroyer(/*action*/ ctx[7].call(null, button))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(new_ctx, [dirty]) {\r\n\t\t\tctx = new_ctx;\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tif (default_slot.p && (!current || dirty & /*$$scope*/ 134217728)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tdefault_slot,\r\n\t\t\t\t\t\tdefault_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[27],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[27])\r\n\t\t\t\t\t\t: get_slot_changes(default_slot_template, /*$$scope*/ ctx[27], dirty, null),\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (default_slot_or_fallback && default_slot_or_fallback.p && (!current || dirty & /*elButtonInnerClass, elLabelClass, label, icon*/ 2563)) {\r\n\t\t\t\t\tdefault_slot_or_fallback.p(ctx, !current ? -1 : dirty);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*type*/ 16) {\r\n\t\t\t\tattr(button, \"type\", /*type*/ ctx[4]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*style*/ 4) {\r\n\t\t\t\tattr(button, \"style\", /*style*/ ctx[2]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*disabled*/ 8) {\r\n\t\t\t\tbutton.disabled = /*disabled*/ ctx[3];\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*elButtonClass*/ 1024) {\r\n\t\t\t\tattr(button, \"class\", /*elButtonClass*/ ctx[10]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*label*/ 1) {\r\n\t\t\t\tattr(button, \"title\", /*label*/ ctx[0]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(default_slot_or_fallback, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(default_slot_or_fallback, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(button);\r\n\t\t\tif (default_slot_or_fallback) default_slot_or_fallback.d(detaching);\r\n\t\t\t/*button_binding*/ ctx[26](null);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$L($$self, $$props, $$invalidate) {\r\n\tlet handleDown;\r\n\tlet handleUp;\r\n\tlet elButtonInnerClass;\r\n\tlet elButtonClass;\r\n\tlet elLabelClass;\r\n\tlet { $$slots: slots = {}, $$scope } = $$props;\r\n\tlet { class: klass = undefined } = $$props;\r\n\tlet { label = undefined } = $$props;\r\n\tlet { labelClass = undefined } = $$props;\r\n\tlet { innerClass = undefined } = $$props;\r\n\tlet { hideLabel = false } = $$props;\r\n\tlet { icon = undefined } = $$props;\r\n\tlet { style = undefined } = $$props;\r\n\tlet { disabled = undefined } = $$props;\r\n\tlet { type = 'button' } = $$props;\r\n\tlet { onclick = undefined } = $$props;\r\n\tlet { onkeydown = undefined } = $$props;\r\n\tlet { onhold = undefined } = $$props;\r\n\r\n\tlet { action = () => {\r\n\t\t\r\n\t} } = $$props;\r\n\r\n\tlet { holdThreshold = 500 } = $$props;\r\n\tlet { holdSpeedUpFactor = 0.5 } = $$props;\r\n\tlet { holdSpeedMin = 20 } = $$props;\r\n\tlet holdTimer;\r\n\r\n\tconst hold = holdStep => {\r\n\t\t$$invalidate(23, holdTimer = setTimeout(\r\n\t\t\t() => {\r\n\t\t\t\tonhold();\r\n\t\t\t\thold(Math.max(holdStep * holdSpeedUpFactor, holdSpeedMin));\r\n\t\t\t},\r\n\t\t\tholdStep\r\n\t\t));\r\n\t};\r\n\r\n\tlet root;\r\n\tconst isEventTarget$1 = e => isEventTarget(e, root);\r\n\tconst getElement = () => root;\r\n\r\n\tfunction button_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\troot = $$value;\r\n\t\t\t$$invalidate(8, root);\r\n\t\t});\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('class' in $$props) $$invalidate(13, klass = $$props.class);\r\n\t\tif ('label' in $$props) $$invalidate(0, label = $$props.label);\r\n\t\tif ('labelClass' in $$props) $$invalidate(14, labelClass = $$props.labelClass);\r\n\t\tif ('innerClass' in $$props) $$invalidate(15, innerClass = $$props.innerClass);\r\n\t\tif ('hideLabel' in $$props) $$invalidate(16, hideLabel = $$props.hideLabel);\r\n\t\tif ('icon' in $$props) $$invalidate(1, icon = $$props.icon);\r\n\t\tif ('style' in $$props) $$invalidate(2, style = $$props.style);\r\n\t\tif ('disabled' in $$props) $$invalidate(3, disabled = $$props.disabled);\r\n\t\tif ('type' in $$props) $$invalidate(4, type = $$props.type);\r\n\t\tif ('onclick' in $$props) $$invalidate(5, onclick = $$props.onclick);\r\n\t\tif ('onkeydown' in $$props) $$invalidate(6, onkeydown = $$props.onkeydown);\r\n\t\tif ('onhold' in $$props) $$invalidate(17, onhold = $$props.onhold);\r\n\t\tif ('action' in $$props) $$invalidate(7, action = $$props.action);\r\n\t\tif ('holdThreshold' in $$props) $$invalidate(18, holdThreshold = $$props.holdThreshold);\r\n\t\tif ('holdSpeedUpFactor' in $$props) $$invalidate(19, holdSpeedUpFactor = $$props.holdSpeedUpFactor);\r\n\t\tif ('holdSpeedMin' in $$props) $$invalidate(20, holdSpeedMin = $$props.holdSpeedMin);\r\n\t\tif ('$$scope' in $$props) $$invalidate(27, $$scope = $$props.$$scope);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*onhold, holdTimer, handleUp*/ 25296896) {\r\n\t\t\t$$invalidate(24, handleUp = onhold\r\n\t\t\t? () => {\r\n\t\t\t\t\tif (!holdTimer) return;\r\n\r\n\t\t\t\t\t// clean up\r\n\t\t\t\t\tclearTimeout(holdTimer);\r\n\r\n\t\t\t\t\t$$invalidate(23, holdTimer = undefined);\r\n\r\n\t\t\t\t\t// no longer holder\r\n\t\t\t\t\tdocument.documentElement.removeEventListener('pointerup', handleUp);\r\n\t\t\t\t}\r\n\t\t\t: noop);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*onhold, handleUp, holdThreshold*/ 17170432) {\r\n\t\t\t$$invalidate(12, handleDown = onhold\r\n\t\t\t? () => {\r\n\t\t\t\t\tdocument.documentElement.addEventListener('pointerup', handleUp);\r\n\t\t\t\t\thold(holdThreshold);\r\n\t\t\t\t}\r\n\t\t\t: noop);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*innerClass*/ 32768) {\r\n\t\t\t$$invalidate(11, elButtonInnerClass = arrayJoin(['PinturaButtonInner', innerClass]));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*hideLabel, klass*/ 73728) {\r\n\t\t\t$$invalidate(10, elButtonClass = arrayJoin(['PinturaButton', hideLabel && 'PinturaButtonIconOnly', klass]));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*hideLabel, labelClass*/ 81920) {\r\n\t\t\t$$invalidate(9, elLabelClass = arrayJoin([hideLabel ? 'implicit' : 'PinturaButtonLabel', labelClass]));\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tlabel,\r\n\t\ticon,\r\n\t\tstyle,\r\n\t\tdisabled,\r\n\t\ttype,\r\n\t\tonclick,\r\n\t\tonkeydown,\r\n\t\taction,\r\n\t\troot,\r\n\t\telLabelClass,\r\n\t\telButtonClass,\r\n\t\telButtonInnerClass,\r\n\t\thandleDown,\r\n\t\tklass,\r\n\t\tlabelClass,\r\n\t\tinnerClass,\r\n\t\thideLabel,\r\n\t\tonhold,\r\n\t\tholdThreshold,\r\n\t\tholdSpeedUpFactor,\r\n\t\tholdSpeedMin,\r\n\t\tisEventTarget$1,\r\n\t\tgetElement,\r\n\t\tholdTimer,\r\n\t\thandleUp,\r\n\t\tslots,\r\n\t\tbutton_binding,\r\n\t\t$$scope\r\n\t];\r\n}\r\n\r\nclass Button extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$L, create_fragment$K, safe_not_equal, {\r\n\t\t\tclass: 13,\r\n\t\t\tlabel: 0,\r\n\t\t\tlabelClass: 14,\r\n\t\t\tinnerClass: 15,\r\n\t\t\thideLabel: 16,\r\n\t\t\ticon: 1,\r\n\t\t\tstyle: 2,\r\n\t\t\tdisabled: 3,\r\n\t\t\ttype: 4,\r\n\t\t\tonclick: 5,\r\n\t\t\tonkeydown: 6,\r\n\t\t\tonhold: 17,\r\n\t\t\taction: 7,\r\n\t\t\tholdThreshold: 18,\r\n\t\t\tholdSpeedUpFactor: 19,\r\n\t\t\tholdSpeedMin: 20,\r\n\t\t\tisEventTarget: 21,\r\n\t\t\tgetElement: 22\r\n\t\t});\r\n\t}\r\n\r\n\tget isEventTarget() {\r\n\t\treturn this.$$.ctx[21];\r\n\t}\r\n\r\n\tget getElement() {\r\n\t\treturn this.$$.ctx[22];\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/UtilPanel.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_if_block$c(ctx) {\r\n\tlet switch_instance;\r\n\tlet updating_name;\r\n\tlet switch_instance_anchor;\r\n\tlet current;\r\n\tconst switch_instance_spread_levels = [/*componentProps*/ ctx[4]];\r\n\r\n\tfunction switch_instance_name_binding(value) {\r\n\t\t/*switch_instance_name_binding*/ ctx[22](value);\r\n\t}\r\n\r\n\tvar switch_value = /*ComponentView*/ ctx[10];\r\n\r\n\tfunction switch_props(ctx) {\r\n\t\tlet switch_instance_props = {};\r\n\r\n\t\tfor (let i = 0; i < switch_instance_spread_levels.length; i += 1) {\r\n\t\t\tswitch_instance_props = assign(switch_instance_props, switch_instance_spread_levels[i]);\r\n\t\t}\r\n\r\n\t\tif (/*panelName*/ ctx[2] !== void 0) {\r\n\t\t\tswitch_instance_props.name = /*panelName*/ ctx[2];\r\n\t\t}\r\n\r\n\t\treturn { props: switch_instance_props };\r\n\t}\r\n\r\n\tif (switch_value) {\r\n\t\tswitch_instance = new switch_value(switch_props(ctx));\r\n\t\tbinding_callbacks.push(() => bind(switch_instance, 'name', switch_instance_name_binding));\r\n\t\t/*switch_instance_binding*/ ctx[23](switch_instance);\r\n\t\tswitch_instance.$on(\"measure\", /*handleMeasure*/ ctx[11]);\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (switch_instance) create_component(switch_instance.$$.fragment);\r\n\t\t\tswitch_instance_anchor = empty();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (switch_instance) {\r\n\t\t\t\tmount_component(switch_instance, target, anchor);\r\n\t\t\t}\r\n\r\n\t\t\tinsert(target, switch_instance_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst switch_instance_changes = (dirty & /*componentProps*/ 16)\r\n\t\t\t? get_spread_update(switch_instance_spread_levels, [get_spread_object(/*componentProps*/ ctx[4])])\r\n\t\t\t: {};\r\n\r\n\t\t\tif (!updating_name && dirty & /*panelName*/ 4) {\r\n\t\t\t\tupdating_name = true;\r\n\t\t\t\tswitch_instance_changes.name = /*panelName*/ ctx[2];\r\n\t\t\t\tadd_flush_callback(() => updating_name = false);\r\n\t\t\t}\r\n\r\n\t\t\tif (switch_value !== (switch_value = /*ComponentView*/ ctx[10])) {\r\n\t\t\t\tif (switch_instance) {\r\n\t\t\t\t\tgroup_outros();\r\n\t\t\t\t\tconst old_component = switch_instance;\r\n\r\n\t\t\t\t\ttransition_out(old_component.$$.fragment, 1, 0, () => {\r\n\t\t\t\t\t\tdestroy_component(old_component, 1);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tcheck_outros();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (switch_value) {\r\n\t\t\t\t\tswitch_instance = new switch_value(switch_props(ctx));\r\n\t\t\t\t\tbinding_callbacks.push(() => bind(switch_instance, 'name', switch_instance_name_binding));\r\n\t\t\t\t\t/*switch_instance_binding*/ ctx[23](switch_instance);\r\n\t\t\t\t\tswitch_instance.$on(\"measure\", /*handleMeasure*/ ctx[11]);\r\n\t\t\t\t\tcreate_component(switch_instance.$$.fragment);\r\n\t\t\t\t\ttransition_in(switch_instance.$$.fragment, 1);\r\n\t\t\t\t\tmount_component(switch_instance, switch_instance_anchor.parentNode, switch_instance_anchor);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tswitch_instance = null;\r\n\t\t\t\t}\r\n\t\t\t} else if (switch_value) {\r\n\t\t\t\tswitch_instance.$set(switch_instance_changes);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\tif (switch_instance) transition_in(switch_instance.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\tif (switch_instance) transition_out(switch_instance.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\t/*switch_instance_binding*/ ctx[23](null);\r\n\t\t\tif (detaching) detach(switch_instance_anchor);\r\n\t\t\tif (switch_instance) destroy_component(switch_instance, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$J(ctx) {\r\n\tlet div;\r\n\tlet div_class_value;\r\n\tlet current;\r\n\tlet if_block = /*isLocal*/ ctx[5] && create_if_block$c(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tattr(div, \"data-util\", /*panelName*/ ctx[2]);\r\n\t\t\tattr(div, \"class\", div_class_value = arrayJoin(['PinturaUtilPanel', /*klass*/ ctx[1]]));\r\n\t\t\tattr(div, \"style\", /*style*/ ctx[6]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tif (if_block) if_block.m(div, null);\r\n\t\t\t/*div_binding*/ ctx[24](div);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tif (/*isLocal*/ ctx[5]) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty & /*isLocal*/ 32) {\r\n\t\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block$c(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(div, null);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block, 1, 1, () => {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*panelName*/ 4) {\r\n\t\t\t\tattr(div, \"data-util\", /*panelName*/ ctx[2]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*klass*/ 2 && div_class_value !== (div_class_value = arrayJoin(['PinturaUtilPanel', /*klass*/ ctx[1]]))) {\r\n\t\t\t\tattr(div, \"class\", div_class_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*style*/ 64) {\r\n\t\t\t\tattr(div, \"style\", /*style*/ ctx[6]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif (if_block) if_block.d();\r\n\t\t\t/*div_binding*/ ctx[24](null);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$K($$self, $$props, $$invalidate) {\r\n\tlet style;\r\n\tlet componentProps;\r\n\tlet isLocal;\r\n\tlet $isActivePrivateStore;\r\n\tlet $opacityClamped;\r\n\tlet $isAnimated;\r\n\tconst dispatch = createEventDispatcher();\r\n\tlet { isActive = true } = $$props;\r\n\tlet { stores } = $$props;\r\n\tlet { content } = $$props;\r\n\tlet { component } = $$props;\r\n\tlet { locale } = $$props;\r\n\tlet { class: klass = undefined } = $$props;\r\n\r\n\t// context\r\n\tconst isAnimated = getContext('isAnimated');\r\n\r\n\tcomponent_subscribe($$self, isAnimated, value => $$invalidate(21, $isAnimated = value));\r\n\r\n\t// we remember the view rect in this variable\r\n\tlet rect;\r\n\r\n\tconst opacity = spring(0);\r\n\tconst opacityClamped = derived(opacity, $opacity => clamp($opacity, 0, 1));\r\n\tcomponent_subscribe($$self, opacityClamped, value => $$invalidate(20, $opacityClamped = value));\r\n\r\n\t// throw hide / show events\r\n\tlet isHidden = !isActive;\r\n\r\n\t// create active store so can be used in derived stores\r\n\tconst isActivePrivateStore = writable(isActive);\r\n\r\n\tcomponent_subscribe($$self, isActivePrivateStore, value => $$invalidate(25, $isActivePrivateStore = value));\r\n\r\n\tconst stateProps = {\r\n\t\t// derived store to make isActive private\r\n\t\tisActive: derived(isActivePrivateStore, async ($isActivePrivateStore, set) => {\r\n\t\t\t// set to false immidiately\r\n\t\t\tif (!$isActivePrivateStore) return set($isActivePrivateStore);\r\n\r\n\t\t\t// wait for next tick when setting to true, this helps deactivating\r\n\t\t\t// current panel before activing next one\r\n\t\t\tawait tick$1();\r\n\r\n\t\t\tset($isActivePrivateStore);\r\n\t\t}),\r\n\t\tisActiveFraction: derived(opacityClamped, $opacityClamped => $opacityClamped),\r\n\t\tisVisible: derived(opacityClamped, $opacityClamped => $opacityClamped > 0)\r\n\t};\r\n\r\n\t// build the component props\r\n\tconst ComponentView = content.view;\r\n\r\n\tconst componentExportedProps = getComponentExportedProps(ComponentView);\r\n\r\n\tconst componentComputedProps = Object.keys(content.props || {}).reduce(\r\n\t\t(computedProps, key) => {\r\n\t\t\tif (!componentExportedProps.includes(key)) return computedProps;\r\n\t\t\tcomputedProps[key] = content.props[key];\r\n\t\t\treturn computedProps;\r\n\t\t},\r\n\t\t{}\r\n\t);\r\n\r\n\tconst componentComputedStateProps = Object.keys(stateProps).reduce(\r\n\t\t(computedStateProps, key) => {\r\n\t\t\tif (!componentExportedProps.includes(key)) return computedStateProps;\r\n\t\t\tcomputedStateProps[key] = stateProps[key];\r\n\t\t\treturn computedStateProps;\r\n\t\t},\r\n\t\t{}\r\n\t);\r\n\r\n\t// class used on panel element\r\n\tlet panelName;\r\n\r\n\t// used when loading external plugin\r\n\tlet rootElement;\r\n\r\n\tconst handleMeasure = e => {\r\n\t\t// not fully hidden, so store rect for next render\r\n\t\t$$invalidate(17, rect = { ...e.detail });\r\n\r\n\t\tif (!hasBeenMounted || !isActive) return;\r\n\t\tdispatch('measure', { ...rect });\r\n\t};\r\n\r\n\t// we use the `hasBeenMounted` bool to block rect updates until the entire panel is ready\r\n\tlet hasBeenMounted = false;\r\n\r\n\tonMount(() => {\r\n\t\t$$invalidate(19, hasBeenMounted = true);\r\n\t\tif (isLocal) return;\r\n\r\n\t\t$$invalidate(0, component = new ComponentView({\r\n\t\t\t\ttarget: rootElement,\r\n\t\t\t\tprops: {\r\n\t\t\t\t\t// pass custom props to plugin instance\r\n\t\t\t\t\t...componentProps\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\r\n\t\t$$invalidate(2, panelName = component.name);\r\n\t\tconst unsub = component.$on('measure', handleMeasure);\r\n\r\n\t\treturn () => {\r\n\t\t\tunsub();\r\n\t\t\tcomponent.$destroy();\r\n\t\t};\r\n\t});\r\n\r\n\tfunction switch_instance_name_binding(value) {\r\n\t\tpanelName = value;\r\n\t\t$$invalidate(2, panelName);\r\n\t}\r\n\r\n\tfunction switch_instance_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\tcomponent = $$value;\r\n\t\t\t$$invalidate(0, component);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction div_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\trootElement = $$value;\r\n\t\t\t$$invalidate(3, rootElement);\r\n\t\t});\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('isActive' in $$props) $$invalidate(12, isActive = $$props.isActive);\r\n\t\tif ('stores' in $$props) $$invalidate(13, stores = $$props.stores);\r\n\t\tif ('content' in $$props) $$invalidate(14, content = $$props.content);\r\n\t\tif ('component' in $$props) $$invalidate(0, component = $$props.component);\r\n\t\tif ('locale' in $$props) $$invalidate(15, locale = $$props.locale);\r\n\t\tif ('class' in $$props) $$invalidate(1, klass = $$props.class);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*rect, isActive, component*/ 135169) {\r\n\t\t\t// when the view rect changes and the panel is in active state or became active, dispatch measure event\r\n\t\t\tif (rect && isActive && component) dispatch('measure', rect);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*isActive, $isAnimated*/ 2101248) {\r\n\t\t\topacity.set(isActive ? 1 : 0, { hard: $isAnimated === false });\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*$opacityClamped, isHidden*/ 1310720) {\r\n\t\t\tif ($opacityClamped <= 0 && !isHidden) {\r\n\t\t\t\t$$invalidate(18, isHidden = true);\r\n\t\t\t} else if ($opacityClamped > 0 && isHidden) {\r\n\t\t\t\t$$invalidate(18, isHidden = false);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*hasBeenMounted, isHidden*/ 786432) {\r\n\t\t\thasBeenMounted && dispatch(isHidden ? 'hide' : 'show');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*$opacityClamped*/ 1048576) {\r\n\t\t\tdispatch('fade', $opacityClamped);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*$opacityClamped*/ 1048576) {\r\n\t\t\t// only set opacity prop if is below 0\r\n\t\t\t$$invalidate(6, style = $opacityClamped < 1\r\n\t\t\t? `opacity: ${$opacityClamped}`\r\n\t\t\t: undefined);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*isActive*/ 4096) {\r\n\t\t\tset_store_value(isActivePrivateStore, $isActivePrivateStore = isActive, $isActivePrivateStore);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*stores, locale*/ 40960) {\r\n\t\t\t$$invalidate(4, componentProps = {\r\n\t\t\t\t...componentComputedProps,\r\n\t\t\t\t...componentComputedStateProps,\r\n\t\t\t\tstores,\r\n\t\t\t\tlocale\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\t$$invalidate(5, isLocal = !componentExportedProps.includes('external'));\r\n\r\n\treturn [\r\n\t\tcomponent,\r\n\t\tklass,\r\n\t\tpanelName,\r\n\t\trootElement,\r\n\t\tcomponentProps,\r\n\t\tisLocal,\r\n\t\tstyle,\r\n\t\tisAnimated,\r\n\t\topacityClamped,\r\n\t\tisActivePrivateStore,\r\n\t\tComponentView,\r\n\t\thandleMeasure,\r\n\t\tisActive,\r\n\t\tstores,\r\n\t\tcontent,\r\n\t\tlocale,\r\n\t\topacity,\r\n\t\trect,\r\n\t\tisHidden,\r\n\t\thasBeenMounted,\r\n\t\t$opacityClamped,\r\n\t\t$isAnimated,\r\n\t\tswitch_instance_name_binding,\r\n\t\tswitch_instance_binding,\r\n\t\tdiv_binding\r\n\t];\r\n}\r\n\r\nclass UtilPanel extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$K, create_fragment$J, safe_not_equal, {\r\n\t\t\tisActive: 12,\r\n\t\t\tstores: 13,\r\n\t\t\tcontent: 14,\r\n\t\t\tcomponent: 0,\r\n\t\t\tlocale: 15,\r\n\t\t\tclass: 1,\r\n\t\t\topacity: 16\r\n\t\t});\r\n\t}\r\n\r\n\tget opacity() {\r\n\t\treturn this.$$.ctx[16];\r\n\t}\r\n}\r\n\r\nvar arrayRemove = (array, predicate) => {\r\n    const index = array.findIndex(predicate);\r\n    if (index >= 0)\r\n        return array.splice(index, 1);\r\n    return undefined;\r\n};\r\n\r\n// svelte\r\n// constants\r\nconst INERTIA_THRESHOLD = 0.25; // when force of velocity exceeds this value we drift\r\nconst INERTIA_DISTANCE_MULTIPLIER = 50;\r\nconst INERTIA_DURATION_MULTIPLIER = 80;\r\nconst TAP_DURATION_MAX = 300;\r\nconst TAP_DISTANCE_MAX = 64;\r\nconst DOUBLE_TAP_DURATION_MAX = 700;\r\nconst DOUBLE_TAP_DISTANCE_MAX = 128;\r\nconst isContextMenuAction = (e) => isNumber(e.button) && e.button !== 0;\r\nvar interactable = (node, options = {}) => {\r\n    // set defaults\r\n    const { inertia = false, inertiaDurationMultiplier = INERTIA_DURATION_MULTIPLIER, shouldStartInteraction = () => true, pinch = false, multiTouch = undefined, getEventPosition = (e) => vectorCreate(e.clientX, e.clientY), } = options;\r\n    //\r\n    // helpers\r\n    //\r\n    function dispatch(type, detail) {\r\n        node.dispatchEvent(new CustomEvent(type, { detail }));\r\n    }\r\n    function resetInertia() {\r\n        if (inertiaTweenUnsubscribe)\r\n            inertiaTweenUnsubscribe();\r\n        inertiaTweenUnsubscribe = undefined;\r\n    }\r\n    //#region pointer registry\r\n    const pointers = [];\r\n    const getPointerTimestamp = (e) => {\r\n        return e.timeStamp === 0 ? Date.now() : e.timeStamp;\r\n    };\r\n    const addPointer = (e) => {\r\n        const timeStamp = getPointerTimestamp(e);\r\n        const pointer = {\r\n            timeStamp,\r\n            timeStampInitial: timeStamp,\r\n            position: getEventPosition(e),\r\n            origin: getEventPosition(e),\r\n            velocity: vectorCreateEmpty(),\r\n            velocityHistory: [],\r\n            velocityAverage: vectorCreateEmpty(),\r\n            translation: vectorCreateEmpty(),\r\n            interactionState: undefined,\r\n            event: e,\r\n        };\r\n        pointers.push(pointer);\r\n        pointer.interactionState = getInteractionState(pointers);\r\n    };\r\n    const removePointer = (e) => {\r\n        const pointer = arrayRemove(pointers, (pointer) => pointer.event.pointerId === e.pointerId);\r\n        if (pointer)\r\n            return pointer[0];\r\n    };\r\n    const removePointers = () => {\r\n        pointers.length = 0;\r\n    };\r\n    const getPointerIndex = (e) => pointers.findIndex((pointer) => pointer.event.pointerId === e.pointerId);\r\n    const getPointersCenter = () => {\r\n        const position = vectorClone(pointers[0].position);\r\n        if (pointers[1]) {\r\n            const dx = (pointers[1].position.x - position.x) * 0.5;\r\n            const dy = (pointers[1].position.y - position.y) * 0.5;\r\n            position.x += dx;\r\n            position.y += dy;\r\n        }\r\n        return position;\r\n    };\r\n    const flattenPointerOrigin = (pointer) => {\r\n        pointer.origin.x = pointer.position.x;\r\n        pointer.origin.y = pointer.position.y;\r\n        pointer.translation.x = 0;\r\n        pointer.translation.y = 0;\r\n    };\r\n    const updatePointer = (e) => {\r\n        const pointer = getPointer(e);\r\n        if (!pointer)\r\n            return;\r\n        const timeStamp = getPointerTimestamp(e);\r\n        // position\r\n        const eventPosition = getEventPosition(e);\r\n        // duration between previous interaction and new interaction, an interaction duration cannot be faster than 1 millisecond\r\n        const interactionDuration = Math.max(1, timeStamp - pointer.timeStamp);\r\n        // calculate velocity\r\n        pointer.velocity.x = (eventPosition.x - pointer.position.x) / interactionDuration;\r\n        pointer.velocity.y = (eventPosition.y - pointer.position.y) / interactionDuration;\r\n        pointer.velocityHistory.push(vectorClone(pointer.velocity));\r\n        pointer.velocityHistory = pointer.velocityHistory.slice(-3);\r\n        pointer.velocityAverage = pointer.velocityHistory.reduce((v, c, index, arr) => {\r\n            v.x += c.x / arr.length;\r\n            v.y += c.y / arr.length;\r\n            return v;\r\n        }, vectorCreateEmpty());\r\n        // update the translation\r\n        pointer.translation.x = eventPosition.x - pointer.origin.x;\r\n        pointer.translation.y = eventPosition.y - pointer.origin.y;\r\n        // set new state\r\n        pointer.timeStamp = timeStamp;\r\n        pointer.position.x = eventPosition.x;\r\n        pointer.position.y = eventPosition.y;\r\n        pointer.event = e;\r\n    };\r\n    const getPointer = (e) => {\r\n        const i = getPointerIndex(e);\r\n        if (i < 0)\r\n            return;\r\n        return pointers[i];\r\n    };\r\n    const isSingleTouching = () => pointers.length === 1;\r\n    const isMultiTouching = () => pointers.length === 2;\r\n    const getDistance = (pointers, position) => {\r\n        const distanceTotal = pointers.reduce((prev, curr) => {\r\n            prev += vectorDistance(position, curr.position);\r\n            return prev;\r\n        }, 0);\r\n        return distanceTotal / pointers.length;\r\n    };\r\n    const getInteractionState = (pointers) => {\r\n        const center = vectorCenter(pointers.map((pointer) => pointer.position));\r\n        const distance = getDistance(pointers, center);\r\n        return {\r\n            center,\r\n            distance,\r\n            velocity: vectorCenter(pointers.map((pointer) => pointer.velocity)),\r\n            translation: vectorCenter(pointers.map((pointer) => pointer.translation)),\r\n        };\r\n    };\r\n    //#endregion\r\n    let inertiaTween;\r\n    let inertiaOrigin;\r\n    let inertiaTranslation;\r\n    let inertiaTweenUnsubscribe;\r\n    let pinchOffsetDistance;\r\n    let currentTranslation;\r\n    let currentScale;\r\n    let isGesture;\r\n    let lastTapTimeStamp = 0;\r\n    let lastTapPosition = undefined;\r\n    // start handling interactions\r\n    node.addEventListener('pointerdown', handlePointerdown);\r\n    function handlePointerdown(e) {\r\n        // ignore more than two pointers for now\r\n        if (isMultiTouching())\r\n            return;\r\n        // not interested in context menu\r\n        if (isContextMenuAction(e))\r\n            return;\r\n        // target should equal node, if it doesn't user might have clicked one of the nodes children\r\n        if (!shouldStartInteraction(e, node))\r\n            return;\r\n        // stop any previous inertia tweens\r\n        resetInertia();\r\n        // register this pointer\r\n        addPointer(e);\r\n        // if is first pointer we need to init the drag gesture\r\n        if (isSingleTouching()) {\r\n            // handle pointer events\r\n            document.documentElement.addEventListener('pointermove', handlePointermove);\r\n            document.documentElement.addEventListener('pointerup', handlePointerup);\r\n            document.documentElement.addEventListener('pointercancel', handlePointerup);\r\n            // clear vars\r\n            isGesture = false;\r\n            currentScale = 1;\r\n            currentTranslation = vectorCreateEmpty();\r\n            pinchOffsetDistance = undefined;\r\n            dispatch('interactionstart', {\r\n                origin: vectorClone(getPointer(e).origin),\r\n            });\r\n        }\r\n        // is pinch\r\n        else if (pinch) {\r\n            isGesture = true;\r\n            pinchOffsetDistance = vectorDistance(pointers[0].position, pointers[1].position);\r\n            currentTranslation.x += pointers[0].translation.x;\r\n            currentTranslation.y += pointers[0].translation.y;\r\n            flattenPointerOrigin(pointers[0]);\r\n        }\r\n        // is multitouch and we're not allowed to multitouch\r\n        else if (multiTouch === false) {\r\n            // remove all pointers\r\n            removePointers();\r\n            // clean up\r\n            document.documentElement.removeEventListener('pointermove', handlePointermove);\r\n            document.documentElement.removeEventListener('pointerup', handlePointerup);\r\n            document.documentElement.removeEventListener('pointercancel', handlePointerup);\r\n            // cancelled\r\n            return dispatch('interactioncancel');\r\n        }\r\n    }\r\n    //\r\n    // pointer move can only be a primary event (other pointers are not handled)\r\n    //\r\n    let moveLast = Date.now();\r\n    function handlePointermove(e) {\r\n        // prevent selection of text (Safari)\r\n        e.preventDefault();\r\n        // update pointer state\r\n        updatePointer(e);\r\n        const translation = vectorClone(pointers[0].translation);\r\n        let scalar = currentScale;\r\n        if (pinch && isMultiTouching()) {\r\n            // current pinch distance\r\n            const pinchCurrentDistance = vectorDistance(pointers[0].position, pointers[1].position);\r\n            // to find out scalar we calculate the difference between the pinch offset and the new pinch\r\n            const pinchScalar = pinchCurrentDistance / pinchOffsetDistance;\r\n            // add to existing scalar\r\n            scalar *= pinchScalar;\r\n            // current offset\r\n            vectorAdd(translation, pointers[1].translation);\r\n        }\r\n        vectorAdd(translation, currentTranslation);\r\n        // skip update event if last interaction was less than 16 ms ago\r\n        const now = Date.now();\r\n        const dist = now - moveLast;\r\n        if (dist < 16)\r\n            return;\r\n        moveLast = now;\r\n        dispatch('interactionupdate', {\r\n            position: getPointersCenter(),\r\n            translation: translation,\r\n            scalar: pinch ? scalar : undefined,\r\n            isMultiTouching: isMultiTouching(),\r\n        });\r\n    }\r\n    //\r\n    // pointer up can only be a primary event (other pointers are not handled)\r\n    //\r\n    function handlePointerup(e) {\r\n        // test if is my pointer that was released, as we're listining on document it could be other pointers\r\n        if (!getPointer(e))\r\n            return;\r\n        // calculate center between active pointers\r\n        const centerBetweenPointers = getPointersCenter();\r\n        // remove pointer from active pointers array\r\n        const removedPointer = removePointer(e);\r\n        // store current size\r\n        if (pinch && isSingleTouching()) {\r\n            // calculate current scale\r\n            const pinchCurrentDistance = vectorDistance(pointers[0].position, removedPointer.position);\r\n            currentScale *= pinchCurrentDistance / pinchOffsetDistance;\r\n            currentTranslation.x += pointers[0].translation.x + removedPointer.translation.x;\r\n            currentTranslation.y += pointers[0].translation.y + removedPointer.translation.y;\r\n            flattenPointerOrigin(pointers[0]);\r\n        }\r\n        // check if this was a tap\r\n        let isTap = false;\r\n        let isDoubleTap = false;\r\n        if (!isGesture && removedPointer) {\r\n            const interactionEnd = performance.now();\r\n            const interactionDuration = interactionEnd - removedPointer.timeStampInitial;\r\n            const interactionDistanceSquared = vectorDistanceSquared(removedPointer.translation);\r\n            isTap =\r\n                interactionDistanceSquared < TAP_DISTANCE_MAX &&\r\n                    interactionDuration < TAP_DURATION_MAX;\r\n            isDoubleTap = !!(lastTapPosition &&\r\n                isTap &&\r\n                interactionEnd - lastTapTimeStamp < DOUBLE_TAP_DURATION_MAX &&\r\n                vectorDistanceSquared(lastTapPosition, removedPointer.position) <\r\n                    DOUBLE_TAP_DISTANCE_MAX);\r\n            if (isTap) {\r\n                lastTapPosition = vectorClone(removedPointer.position);\r\n                lastTapTimeStamp = interactionEnd;\r\n            }\r\n        }\r\n        // we wait till last multi-touch interaction is finished, all pointers need to be de-registered before proceeding\r\n        if (pointers.length > 0)\r\n            return;\r\n        // stop listening\r\n        document.documentElement.removeEventListener('pointermove', handlePointermove);\r\n        document.documentElement.removeEventListener('pointerup', handlePointerup);\r\n        document.documentElement.removeEventListener('pointercancel', handlePointerup);\r\n        const translation = vectorClone(removedPointer.translation);\r\n        const velocity = vectorClone(removedPointer.velocityAverage);\r\n        // allows cancelling inertia from release handler\r\n        let inertiaPrevented = false;\r\n        // user has released interaction\r\n        dispatch('interactionrelease', {\r\n            isTap,\r\n            isDoubleTap,\r\n            position: centerBetweenPointers,\r\n            translation,\r\n            scalar: currentScale,\r\n            preventInertia: () => (inertiaPrevented = true),\r\n        });\r\n        // stop intantly if not a lot of force applied\r\n        const force = vectorDistance(velocity);\r\n        if (inertiaPrevented || !inertia || force < INERTIA_THRESHOLD) {\r\n            return handleEnd(translation, { isTap, isDoubleTap });\r\n        }\r\n        // drift\r\n        inertiaOrigin = vectorClone(centerBetweenPointers);\r\n        inertiaTranslation = vectorClone(translation);\r\n        inertiaTween = tweened(vectorClone(translation), {\r\n            easing: circOut,\r\n            duration: force * inertiaDurationMultiplier,\r\n        });\r\n        inertiaTween\r\n            .set({\r\n            x: translation.x + velocity.x * INERTIA_DISTANCE_MULTIPLIER,\r\n            y: translation.y + velocity.y * INERTIA_DISTANCE_MULTIPLIER,\r\n        })\r\n            .then(() => {\r\n            // if has unsubscribed (tween was reset)\r\n            if (!inertiaTweenUnsubscribe)\r\n                return;\r\n            // go!\r\n            handleEnd(get_store_value(inertiaTween), { isTap, isDoubleTap });\r\n        });\r\n        inertiaTweenUnsubscribe = inertiaTween.subscribe(handleInertiaUpdate);\r\n    }\r\n    function handleInertiaUpdate(translation) {\r\n        // if is same as previous position, ignore\r\n        if (!translation)\r\n            return;\r\n        // this will handle drift interactions\r\n        dispatch('interactionupdate', {\r\n            position: vectorCreate(inertiaOrigin.x + (translation.x - inertiaTranslation.x), inertiaOrigin.y + (translation.y - inertiaTranslation.y)),\r\n            translation: translation,\r\n            scalar: pinch ? currentScale : undefined,\r\n        });\r\n    }\r\n    function handleEnd(translation, tapState) {\r\n        resetInertia();\r\n        dispatch('interactionend', {\r\n            ...tapState,\r\n            translation,\r\n            scalar: pinch ? currentScale : undefined,\r\n        });\r\n    }\r\n    return {\r\n        destroy() {\r\n            resetInertia();\r\n            node.removeEventListener('pointerdown', handlePointerdown);\r\n        },\r\n    };\r\n};\r\n\r\nfunction elastify(translation, dist) {\r\n    return dist\r\n        ? dist * Math.sign(translation) * Math.log10(1 + Math.abs(translation) / dist)\r\n        : translation;\r\n}\r\nconst elastifyRects = (a, b, dist) => {\r\n    if (!b || !dist)\r\n        return { ...a };\r\n    const left = a.x + elastify(b.x - a.x, dist);\r\n    const right = a.x + a.width + elastify(b.x + b.width - (a.x + a.width), dist);\r\n    const top = a.y + elastify(b.y - a.y, dist);\r\n    const bottom = a.y + a.height + elastify(b.y + b.height - (a.y + a.height), dist);\r\n    return {\r\n        x: left,\r\n        y: top,\r\n        width: right - left,\r\n        height: bottom - top,\r\n    };\r\n};\r\nconst elastifyVectors = (a, b, dist) => {\r\n    if (!b || !dist)\r\n        return { ...a };\r\n    return vectorCreate(a.x + elastify(b.x - a.x, dist), a.y + elastify(b.y - a.y, dist));\r\n};\r\n\r\nvar unitToPixels = (value, element) => {\r\n    if (!value)\r\n        return;\r\n    if (/em/.test(value))\r\n        return parseInt(value, 10) * 16;\r\n    if (/px/.test(value))\r\n        return parseInt(value, 10);\r\n};\r\n\r\nvar getWheelDelta = (e) => {\r\n    let d = e.detail || 0;\r\n    const { deltaX, deltaY, wheelDelta, wheelDeltaX, wheelDeltaY } = e;\r\n    // \"detect\" x axis interaction for MacOS trackpad\r\n    if (isNumber(wheelDeltaX) && Math.abs(wheelDeltaX) > Math.abs(wheelDeltaY)) {\r\n        // blink & webkit\r\n        d = wheelDeltaX / -120;\r\n    }\r\n    else if (isNumber(deltaX) && Math.abs(deltaX) > Math.abs(deltaY)) {\r\n        // quantum\r\n        d = deltaX / 20;\r\n    }\r\n    else if (wheelDelta || wheelDeltaY) {\r\n        // blink & webkit\r\n        d = (wheelDelta || wheelDeltaY) / -120;\r\n    }\r\n    if (!d) {\r\n        // quantum\r\n        d = deltaY / 20;\r\n    }\r\n    // speed up wheel/touch interactions on firefox and safari as chrome is more snappy\r\n    if (isFirefox() || isSafari()) {\r\n        d *= 2;\r\n    }\r\n    return d;\r\n};\r\n\r\nvar ArrowKeys = {\r\n    Up: 38,\r\n    Down: 40,\r\n    Left: 37,\r\n    Right: 39,\r\n};\r\n\r\n/* src/core/ui/components/Scrollable.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$I(ctx) {\r\n\tlet div1;\r\n\tlet div0;\r\n\tlet div1_class_value;\r\n\tlet nudgeable_action;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tconst default_slot_template = /*#slots*/ ctx[36].default;\r\n\tconst default_slot = create_slot(default_slot_template, ctx, /*$$scope*/ ctx[35], null);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv1 = element(\"div\");\r\n\t\t\tdiv0 = element(\"div\");\r\n\t\t\tif (default_slot) default_slot.c();\r\n\t\t\tattr(div0, \"style\", /*childStyle*/ ctx[5]);\r\n\t\t\tattr(div1, \"class\", div1_class_value = arrayJoin(['PinturaScrollable', /*klass*/ ctx[0]]));\r\n\t\t\tattr(div1, \"style\", /*overflowStyle*/ ctx[4]);\r\n\t\t\tattr(div1, \"data-direction\", /*scrollDirection*/ ctx[1]);\r\n\t\t\tattr(div1, \"data-state\", /*containerState*/ ctx[6]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div1, anchor);\r\n\t\t\tappend(div1, div0);\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tdefault_slot.m(div0, null);\r\n\t\t\t}\r\n\r\n\t\t\t/*div1_binding*/ ctx[38](div1);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(div0, \"interactionstart\", /*handleDragStart*/ ctx[8]),\r\n\t\t\t\t\tlisten(div0, \"interactionupdate\", /*handleDragMove*/ ctx[10]),\r\n\t\t\t\t\tlisten(div0, \"interactionend\", /*handleDragEnd*/ ctx[11]),\r\n\t\t\t\t\tlisten(div0, \"interactionrelease\", /*handleDragRelease*/ ctx[9]),\r\n\t\t\t\t\taction_destroyer(interactable.call(null, div0, { inertia: true })),\r\n\t\t\t\t\tlisten(div0, \"measure\", /*measure_handler*/ ctx[37]),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div0)),\r\n\t\t\t\t\tlisten(div1, \"wheel\", /*handleWheel*/ ctx[13], { passive: false }),\r\n\t\t\t\t\tlisten(div1, \"scroll\", /*handleScroll*/ ctx[15]),\r\n\t\t\t\t\tlisten(div1, \"focusin\", /*handleFocus*/ ctx[14]),\r\n\t\t\t\t\tlisten(div1, \"nudge\", /*handleNudge*/ ctx[16]),\r\n\t\t\t\t\tlisten(div1, \"measure\", /*handleResizeScrollContainer*/ ctx[12]),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div1, { observePosition: true })),\r\n\t\t\t\t\taction_destroyer(nudgeable_action = nudgeable.call(null, div1, {\r\n\t\t\t\t\t\tdirection: /*scrollDirection*/ ctx[1] === 'x'\r\n\t\t\t\t\t\t? 'horizontal'\r\n\t\t\t\t\t\t: 'vertical',\r\n\t\t\t\t\t\tstopKeydownPropagation: false\r\n\t\t\t\t\t}))\r\n\t\t\t\t]; // preventDefault is not enabled as keyboard interaction is needed to select nodes\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tif (default_slot.p && (!current || dirty[1] & /*$$scope*/ 16)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tdefault_slot,\r\n\t\t\t\t\t\tdefault_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[35],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[35])\r\n\t\t\t\t\t\t: get_slot_changes(default_slot_template, /*$$scope*/ ctx[35], dirty, null),\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*childStyle*/ 32) {\r\n\t\t\t\tattr(div0, \"style\", /*childStyle*/ ctx[5]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*klass*/ 1 && div1_class_value !== (div1_class_value = arrayJoin(['PinturaScrollable', /*klass*/ ctx[0]]))) {\r\n\t\t\t\tattr(div1, \"class\", div1_class_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*overflowStyle*/ 16) {\r\n\t\t\t\tattr(div1, \"style\", /*overflowStyle*/ ctx[4]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*scrollDirection*/ 2) {\r\n\t\t\t\tattr(div1, \"data-direction\", /*scrollDirection*/ ctx[1]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*containerState*/ 64) {\r\n\t\t\t\tattr(div1, \"data-state\", /*containerState*/ ctx[6]);\r\n\t\t\t}\r\n\r\n\t\t\tif (nudgeable_action && is_function(nudgeable_action.update) && dirty[0] & /*scrollDirection*/ 2) nudgeable_action.update.call(null, {\r\n\t\t\t\tdirection: /*scrollDirection*/ ctx[1] === 'x'\r\n\t\t\t\t? 'horizontal'\r\n\t\t\t\t: 'vertical',\r\n\t\t\t\tstopKeydownPropagation: false\r\n\t\t\t}); // preventDefault is not enabled as keyboard interaction is needed to select nodes\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(default_slot, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(default_slot, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div1);\r\n\t\t\tif (default_slot) default_slot.d(detaching);\r\n\t\t\t/*div1_binding*/ ctx[38](null);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$J($$self, $$props, $$invalidate) {\r\n\tlet size;\r\n\tlet axis;\r\n\tlet containerStyle;\r\n\tlet containerFeatherSize;\r\n\tlet overflows;\r\n\tlet containerState;\r\n\tlet childStyle;\r\n\tlet $scrollOffset;\r\n\tlet { $$slots: slots = {}, $$scope } = $$props;\r\n\tconst dispatch = createEventDispatcher();\r\n\tObject.values(ArrowKeys);\r\n\tgetContext('keysPressed');\r\n\tlet scrollState = 'idle';\r\n\tlet scrollOrigin;\r\n\tlet scrollRect;\r\n\tlet scrollContainerRect;\r\n\tlet scrollReleased;\r\n\tlet scrollOffset = spring(0);\r\n\tcomponent_subscribe($$self, scrollOffset, value => $$invalidate(34, $scrollOffset = value));\r\n\tlet { class: klass = undefined } = $$props;\r\n\tlet { scrollBlockInteractionDist = 5 } = $$props;\r\n\tlet { scrollStep = 10 } = $$props;\r\n\tlet { scrollFocusMargin = 64 } = $$props;\r\n\tlet { scrollDirection = 'x' } = $$props;\r\n\tlet { scrollAutoCancel = false } = $$props;\r\n\tlet { elasticity = 0 } = $$props;\r\n\tlet { onscroll = noop$1 } = $$props;\r\n\tlet { maskFeatherSize = undefined } = $$props;\r\n\tlet { maskFeatherStartOpacity = undefined } = $$props;\r\n\tlet { maskFeatherEndOpacity = undefined } = $$props;\r\n\tlet { scroll = undefined } = $$props;\r\n\r\n\t// logic\r\n\tlet container;\r\n\r\n\tlet overflowStyle = '';\r\n\r\n\t// is scroll in reset state\r\n\tlet scrollAtRest = true;\r\n\r\n\t// triggers onscroll callback\r\n\tconst scrollOffsetUnsub = scrollOffset.subscribe(value => {\r\n\t\tconst pos = vectorCreateEmpty();\r\n\t\tpos[scrollDirection] = value;\r\n\t\tonscroll(pos);\r\n\t});\r\n\r\n\tconst limitOffsetToContainer = offset => Math.max(Math.min(0, offset), scrollContainerRect[size] - scrollRect[size]);\r\n\tlet scrollFirstMove;\r\n\tlet scrollCancelled;\r\n\tlet scrollTranslationPrev;\r\n\r\n\tconst isHorizontalTranslation = translation => {\r\n\t\tconst velocity = vectorApply(vectorCreate(translation.x - scrollTranslationPrev.x, translation.y - scrollTranslationPrev.y), Math.abs);\r\n\t\tscrollTranslationPrev = vectorClone(translation);\r\n\t\tconst speed = vectorDistanceSquared(velocity);\r\n\t\tconst diff = velocity.x - velocity.y;\r\n\t\treturn !(speed > 1 && diff < -0.5);\r\n\t};\r\n\r\n\tconst handleDragStart = () => {\r\n\t\t// not overflowing so no need to handle\r\n\t\tif (!overflows) return;\r\n\r\n\t\tscrollCancelled = false;\r\n\t\tscrollFirstMove = true;\r\n\t\tscrollTranslationPrev = vectorCreate(0, 0);\r\n\t\tscrollReleased = false;\r\n\t\t$$invalidate(27, scrollState = 'idle');\r\n\t\tscrollOrigin = get_store_value(scrollOffset);\r\n\t};\r\n\r\n\tconst handleDragRelease = ({ detail }) => {\r\n\t\tif (!overflows) return;\r\n\t\tscrollReleased = true;\r\n\t\t$$invalidate(27, scrollState = 'idle');\r\n\t};\r\n\r\n\tconst handleDragMove = ({ detail }) => {\r\n\t\tif (!overflows) return;\r\n\t\tif (scrollCancelled) return;\r\n\r\n\t\t// fixes problem with single move event fired when clicking\r\n\t\tif (scrollFirstMove) {\r\n\t\t\tscrollFirstMove = false;\r\n\t\t\tif (vectorDistanceSquared(detail.translation) < 0.1) return;\r\n\t\t}\r\n\r\n\t\tif (scrollAutoCancel && scrollDirection === 'x' && !isHorizontalTranslation(detail.translation)) {\r\n\t\t\tscrollCancelled = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetScrollOffset(scrollOrigin + detail.translation[scrollDirection], { elastic: true });\r\n\t};\r\n\r\n\tconst handleDragEnd = ({ detail }) => {\r\n\t\tif (!overflows) return;\r\n\t\tif (scrollCancelled) return;\r\n\t\tconst offset = scrollOrigin + detail.translation[scrollDirection];\r\n\t\tconst offsetLimited = limitOffsetToContainer(offset);\r\n\t\tscrollAtRest = false;\r\n\r\n\t\tscrollOffset.set(offsetLimited).then(res => {\r\n\t\t\tif (!scrollReleased) return;\r\n\t\t\tscrollAtRest = true;\r\n\t\t});\r\n\t};\r\n\r\n\tconst handleResizeScrollContainer = ({ detail }) => {\r\n\t\t$$invalidate(28, scrollContainerRect = detail);\r\n\r\n\t\tdispatch('measure', {\r\n\t\t\tx: detail.x,\r\n\t\t\ty: detail.y,\r\n\t\t\twidth: detail.width,\r\n\t\t\theight: detail.height\r\n\t\t});\r\n\t};\r\n\r\n\tconst setScrollOffset = (offset, options = {}) => {\r\n\t\tconst { elastic = false, animate = false, preventScrollState = false } = options;\r\n\r\n\t\t// prevents clicks on child elements if the container is being scrolled\r\n\t\tif (Math.abs(offset) > scrollBlockInteractionDist && scrollState === 'idle' && !scrollReleased && !preventScrollState) {\r\n\t\t\t$$invalidate(27, scrollState = 'scrolling');\r\n\t\t}\r\n\r\n\t\tconst offsetLimited = limitOffsetToContainer(offset);\r\n\r\n\t\tconst offsetVisual = elastic && elasticity && !scrollReleased\r\n\t\t? offsetLimited + elastify(offset - offsetLimited, elasticity)\r\n\t\t: offsetLimited;\r\n\r\n\t\tlet snapToPosition = true;\r\n\r\n\t\tif (animate) {\r\n\t\t\tsnapToPosition = false;\r\n\t\t} else if (!scrollAtRest) {\r\n\t\t\tsnapToPosition = !scrollReleased;\r\n\t\t}\r\n\r\n\t\tscrollAtRest = false;\r\n\r\n\t\tscrollOffset.set(offsetVisual, { hard: snapToPosition }).then(res => {\r\n\t\t\tif (!scrollReleased) return;\r\n\t\t\tscrollAtRest = true;\r\n\t\t});\r\n\t};\r\n\r\n\tconst handleWheel = e => {\r\n\t\t// don't do anything if isn't overflowing\r\n\t\tif (!overflows) return;\r\n\r\n\t\t// hold shift scroll up -> move to begin\r\n\t\t// hold shift scroll down -> move to end\r\n\t\t// scroll down -> move to right/down\r\n\t\t// scroll up -> move to left/up\r\n\t\t// don't run default actions, prevent other actions from running\r\n\t\te.preventDefault();\r\n\r\n\t\te.stopPropagation();\r\n\r\n\t\t// detect if is holding shift\r\n\t\tconst isHoldingShift = e.shiftKey;\r\n\r\n\t\t// apply wheel delta to offset\r\n\t\tconst delta = getWheelDelta(e) * (isHoldingShift ? -1 : 1);\r\n\r\n\t\tconst offset = get_store_value(scrollOffset);\r\n\t\tsetScrollOffset(offset + delta * scrollStep, { animate: true });\r\n\t};\r\n\r\n\tconst handleFocus = e => {\r\n\t\t// don't do anything if isn't overflowing\r\n\t\tif (!overflows) return;\r\n\r\n\t\t// ignore this handler if is dragging\r\n\t\tif (!scrollReleased) return;\r\n\r\n\t\t// ignore this handler if is pressing arrow key\r\n\t\t// disabled for now as prevents scrolling filter list\r\n\t\t// if ($keysPressedStore.some((key) => ArrowKeyCodes.includes(key))) return;\r\n\t\tlet target = e.target;\r\n\r\n\t\t// when a target is marked as implicit we use its parent elemetn\r\n\t\tif (e.target.classList.contains('implicit')) target = target.parentNode;\r\n\r\n\t\t// get bounds\r\n\t\tconst start = target[scrollDirection === 'x' ? 'offsetLeft' : 'offsetTop']; //.offsetLeft;\r\n\r\n\t\tconst space = target[scrollDirection === 'x' ? 'offsetWidth' : 'offsetHeight']; //.offsetWidth;\r\n\t\tconst end = start + space;\r\n\r\n\t\t// we need to know the current offset of the scroll so we can determine if the target is in view\r\n\t\tconst currentScrollOffset = get_store_value(scrollOffset);\r\n\r\n\t\t// the margin around elements to keep in mind when focussing items\r\n\t\tconst margin = scrollFocusMargin + maskFeatherSize;\r\n\r\n\t\tif (currentScrollOffset + start < margin) {\r\n\t\t\tsetScrollOffset(-start + margin);\r\n\t\t} else if (currentScrollOffset + end > scrollContainerRect[size] - margin) {\r\n\t\t\tsetScrollOffset(scrollContainerRect[size] - end - margin, { animate: true });\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleScroll = () => {\r\n\t\t// the scroll handler corrects auto browser scroll,\r\n\t\t// is triggered when browser tries to focus an\r\n\t\t// element outside of the scrollcontiner\r\n\t\t$$invalidate(3, container[scrollDirection === 'x' ? 'scrollLeft' : 'scrollTop'] = 0, container);\r\n\t};\r\n\r\n\tconst handleNudge = ({ detail }) => {\r\n\t\t// no nudging if arrows are used to switch between buttons\r\n\t\tif (container.querySelector('[data-focus-visible]')) return;\r\n\r\n\t\t// apply nudge\r\n\t\tconst delta = -2 * detail[scrollDirection];\r\n\r\n\t\tconst offset = get_store_value(scrollOffset);\r\n\t\tsetScrollOffset(offset + delta * scrollStep, { animate: true, preventScrollState: true });\r\n\t};\r\n\r\n\tonDestroy(() => {\r\n\t\tscrollOffsetUnsub();\r\n\t});\r\n\r\n\tconst measure_handler = e => $$invalidate(2, scrollRect = e.detail);\r\n\r\n\tfunction div1_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\tcontainer = $$value;\r\n\t\t\t$$invalidate(3, container);\r\n\t\t});\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('class' in $$props) $$invalidate(0, klass = $$props.class);\r\n\t\tif ('scrollBlockInteractionDist' in $$props) $$invalidate(20, scrollBlockInteractionDist = $$props.scrollBlockInteractionDist);\r\n\t\tif ('scrollStep' in $$props) $$invalidate(21, scrollStep = $$props.scrollStep);\r\n\t\tif ('scrollFocusMargin' in $$props) $$invalidate(22, scrollFocusMargin = $$props.scrollFocusMargin);\r\n\t\tif ('scrollDirection' in $$props) $$invalidate(1, scrollDirection = $$props.scrollDirection);\r\n\t\tif ('scrollAutoCancel' in $$props) $$invalidate(23, scrollAutoCancel = $$props.scrollAutoCancel);\r\n\t\tif ('elasticity' in $$props) $$invalidate(24, elasticity = $$props.elasticity);\r\n\t\tif ('onscroll' in $$props) $$invalidate(25, onscroll = $$props.onscroll);\r\n\t\tif ('maskFeatherSize' in $$props) $$invalidate(19, maskFeatherSize = $$props.maskFeatherSize);\r\n\t\tif ('maskFeatherStartOpacity' in $$props) $$invalidate(17, maskFeatherStartOpacity = $$props.maskFeatherStartOpacity);\r\n\t\tif ('maskFeatherEndOpacity' in $$props) $$invalidate(18, maskFeatherEndOpacity = $$props.maskFeatherEndOpacity);\r\n\t\tif ('scroll' in $$props) $$invalidate(26, scroll = $$props.scroll);\r\n\t\tif ('$$scope' in $$props) $$invalidate(35, $$scope = $$props.$$scope);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*scrollDirection*/ 2) {\r\n\t\t\t$$invalidate(31, size = scrollDirection === 'x' ? 'width' : 'height');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*scrollDirection*/ 2) {\r\n\t\t\t$$invalidate(29, axis = scrollDirection.toUpperCase());\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*container*/ 8) {\r\n\t\t\t$$invalidate(33, containerStyle = container && getComputedStyle(container));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*container*/ 8 | $$self.$$.dirty[1] & /*containerStyle*/ 4) {\r\n\t\t\t$$invalidate(32, containerFeatherSize = containerStyle && unitToPixels(containerStyle.getPropertyValue('--scrollable-feather-size')));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*scrollContainerRect, scrollRect, maskFeatherStartOpacity, maskFeatherEndOpacity*/ 268828676 | $$self.$$.dirty[1] & /*$scrollOffset, containerFeatherSize, size*/ 11) {\r\n\t\t\tif ($scrollOffset != null && scrollContainerRect && containerFeatherSize != null && scrollRect) {\r\n\t\t\t\tconst startOffset = -1 * $scrollOffset / containerFeatherSize;\r\n\t\t\t\tconst endOffset = -(scrollContainerRect[size] - scrollRect[size] - $scrollOffset) / containerFeatherSize;\r\n\t\t\t\t$$invalidate(17, maskFeatherStartOpacity = clamp(1 - startOffset, 0, 1));\r\n\t\t\t\t$$invalidate(18, maskFeatherEndOpacity = clamp(1 - endOffset, 0, 1));\r\n\t\t\t\t$$invalidate(19, maskFeatherSize = containerFeatherSize);\r\n\t\t\t\t$$invalidate(4, overflowStyle = `--scrollable-feather-start-opacity: ${maskFeatherStartOpacity};--scrollable-feather-end-opacity: ${maskFeatherEndOpacity}`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*container, scroll*/ 67108872) {\r\n\t\t\t// update scroll position\r\n\t\t\tif (container && scroll !== undefined) {\r\n\t\t\t\tif (isNumber(scroll)) setScrollOffset(scroll); else setScrollOffset(scroll.scrollOffset, scroll);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*scrollContainerRect, scrollRect*/ 268435460 | $$self.$$.dirty[1] & /*size*/ 1) {\r\n\t\t\t$$invalidate(30, overflows = scrollContainerRect && scrollRect\r\n\t\t\t? scrollRect[size] > scrollContainerRect[size]\r\n\t\t\t: undefined);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*scrollState, overflows*/ 1207959552) {\r\n\t\t\t$$invalidate(6, containerState = arrayJoin([scrollState, overflows ? 'overflows' : undefined]));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*overflows, axis*/ 1610612736 | $$self.$$.dirty[1] & /*$scrollOffset*/ 8) {\r\n\t\t\t$$invalidate(5, childStyle = overflows\r\n\t\t\t? `transform: translate${axis}(${$scrollOffset}px)`\r\n\t\t\t: undefined);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tklass,\r\n\t\tscrollDirection,\r\n\t\tscrollRect,\r\n\t\tcontainer,\r\n\t\toverflowStyle,\r\n\t\tchildStyle,\r\n\t\tcontainerState,\r\n\t\tscrollOffset,\r\n\t\thandleDragStart,\r\n\t\thandleDragRelease,\r\n\t\thandleDragMove,\r\n\t\thandleDragEnd,\r\n\t\thandleResizeScrollContainer,\r\n\t\thandleWheel,\r\n\t\thandleFocus,\r\n\t\thandleScroll,\r\n\t\thandleNudge,\r\n\t\tmaskFeatherStartOpacity,\r\n\t\tmaskFeatherEndOpacity,\r\n\t\tmaskFeatherSize,\r\n\t\tscrollBlockInteractionDist,\r\n\t\tscrollStep,\r\n\t\tscrollFocusMargin,\r\n\t\tscrollAutoCancel,\r\n\t\telasticity,\r\n\t\tonscroll,\r\n\t\tscroll,\r\n\t\tscrollState,\r\n\t\tscrollContainerRect,\r\n\t\taxis,\r\n\t\toverflows,\r\n\t\tsize,\r\n\t\tcontainerFeatherSize,\r\n\t\tcontainerStyle,\r\n\t\t$scrollOffset,\r\n\t\t$$scope,\r\n\t\tslots,\r\n\t\tmeasure_handler,\r\n\t\tdiv1_binding\r\n\t];\r\n}\r\n\r\nclass Scrollable extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$J,\r\n\t\t\tcreate_fragment$I,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tclass: 0,\r\n\t\t\t\tscrollBlockInteractionDist: 20,\r\n\t\t\t\tscrollStep: 21,\r\n\t\t\t\tscrollFocusMargin: 22,\r\n\t\t\t\tscrollDirection: 1,\r\n\t\t\t\tscrollAutoCancel: 23,\r\n\t\t\t\telasticity: 24,\r\n\t\t\t\tonscroll: 25,\r\n\t\t\t\tmaskFeatherSize: 19,\r\n\t\t\t\tmaskFeatherStartOpacity: 17,\r\n\t\t\t\tmaskFeatherEndOpacity: 18,\r\n\t\t\t\tscroll: 26\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1]\r\n\t\t);\r\n\t}\r\n}\r\n\r\nfunction fade$1(node, { delay = 0, duration = 400, easing = identity } = {}) {\r\n    const o = +getComputedStyle(node).opacity;\r\n    return {\r\n        delay,\r\n        duration,\r\n        easing,\r\n        css: t => `opacity: ${t * o}`\r\n    };\r\n}\r\n\r\n/* src/core/ui/components/StatusMessage.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$H(ctx) {\r\n\tlet span;\r\n\tlet span_transition;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tattr(span, \"class\", \"PinturaStatusMessage\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t\tspan.innerHTML = /*text*/ ctx[0];\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(span, \"measure\", function () {\r\n\t\t\t\t\t\tif (is_function(/*onmeasure*/ ctx[1])) /*onmeasure*/ ctx[1].apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, span))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(new_ctx, [dirty]) {\r\n\t\t\tctx = new_ctx;\r\n\t\t\tif (!current || dirty & /*text*/ 1) span.innerHTML = /*text*/ ctx[0];\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\r\n\t\t\tadd_render_callback(() => {\r\n\t\t\t\tif (!span_transition) span_transition = create_bidirectional_transition(span, fade$1, { duration: 500 }, true);\r\n\t\t\t\tspan_transition.run(1);\r\n\t\t\t});\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\tif (!span_transition) span_transition = create_bidirectional_transition(span, fade$1, { duration: 500 }, false);\r\n\t\t\tspan_transition.run(0);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t\tif (detaching && span_transition) span_transition.end();\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$I($$self, $$props, $$invalidate) {\r\n\tlet { text } = $$props;\r\n\tlet { onmeasure = noop$1 } = $$props;\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('text' in $$props) $$invalidate(0, text = $$props.text);\r\n\t\tif ('onmeasure' in $$props) $$invalidate(1, onmeasure = $$props.onmeasure);\r\n\t};\r\n\r\n\treturn [text, onmeasure];\r\n}\r\n\r\nclass StatusMessage extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\t\tinit(this, options, instance$I, create_fragment$H, safe_not_equal, { text: 0, onmeasure: 1 });\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/ProgressIndicator.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$G(ctx) {\r\n\tlet span1;\r\n\tlet svg;\r\n\tlet g;\r\n\tlet circle0;\r\n\tlet circle1;\r\n\tlet t0;\r\n\tlet span0;\r\n\tlet t1;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan1 = element(\"span\");\r\n\t\t\tsvg = svg_element(\"svg\");\r\n\t\t\tg = svg_element(\"g\");\r\n\t\t\tcircle0 = svg_element(\"circle\");\r\n\t\t\tcircle1 = svg_element(\"circle\");\r\n\t\t\tt0 = space();\r\n\t\t\tspan0 = element(\"span\");\r\n\t\t\tt1 = text(/*formattedValue*/ ctx[3]);\r\n\t\t\tattr(circle0, \"class\", \"PinturaProgressIndicatorBar\");\r\n\t\t\tattr(circle0, \"r\", \"8.5\");\r\n\t\t\tattr(circle0, \"cx\", \"10\");\r\n\t\t\tattr(circle0, \"cy\", \"10\");\r\n\t\t\tattr(circle0, \"stroke-linecap\", \"round\");\r\n\t\t\tattr(circle0, \"opacity\", \".25\");\r\n\t\t\tattr(circle1, \"class\", \"PinturaProgressIndicatorFill\");\r\n\t\t\tattr(circle1, \"r\", \"8.5\");\r\n\t\t\tattr(circle1, \"stroke-dasharray\", /*circleValue*/ ctx[2]);\r\n\t\t\tattr(circle1, \"cx\", \"10\");\r\n\t\t\tattr(circle1, \"cy\", \"10\");\r\n\t\t\tattr(circle1, \"transform\", \"rotate(-90) translate(-20)\");\r\n\t\t\tattr(g, \"fill\", \"none\");\r\n\t\t\tattr(g, \"stroke\", \"currentColor\");\r\n\t\t\tattr(g, \"stroke-width\", \"2.5\");\r\n\t\t\tattr(g, \"stroke-linecap\", \"round\");\r\n\t\t\tattr(g, \"opacity\", /*circleOpacity*/ ctx[1]);\r\n\t\t\tattr(svg, \"width\", \"20\");\r\n\t\t\tattr(svg, \"height\", \"20\");\r\n\t\t\tattr(svg, \"viewBox\", \"0 0 20 20\");\r\n\t\t\tattr(svg, \"xmlns\", \"http://www.w3.org/2000/svg\");\r\n\t\t\tattr(svg, \"aria-hidden\", \"true\");\r\n\t\t\tattr(svg, \"focusable\", \"false\");\r\n\t\t\tattr(span0, \"class\", \"implicit\");\r\n\t\t\tattr(span1, \"class\", \"PinturaProgressIndicator\");\r\n\t\t\tattr(span1, \"data-status\", /*status*/ ctx[0]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span1, anchor);\r\n\t\t\tappend(span1, svg);\r\n\t\t\tappend(svg, g);\r\n\t\t\tappend(g, circle0);\r\n\t\t\tappend(g, circle1);\r\n\t\t\tappend(span1, t0);\r\n\t\t\tappend(span1, span0);\r\n\t\t\tappend(span0, t1);\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tif (dirty & /*circleValue*/ 4) {\r\n\t\t\t\tattr(circle1, \"stroke-dasharray\", /*circleValue*/ ctx[2]);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty & /*circleOpacity*/ 2) {\r\n\t\t\t\tattr(g, \"opacity\", /*circleOpacity*/ ctx[1]);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty & /*formattedValue*/ 8) set_data(t1, /*formattedValue*/ ctx[3]);\r\n\r\n\t\t\tif (dirty & /*status*/ 1) {\r\n\t\t\t\tattr(span1, \"data-status\", /*status*/ ctx[0]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti: noop,\r\n\t\to: noop,\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span1);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$H($$self, $$props, $$invalidate) {\r\n\tlet formattedValue;\r\n\tlet circleValue;\r\n\tlet circleOpacity;\r\n\tlet status;\r\n\tlet $animatedOpacity;\r\n\tlet $animatedProgressClamped;\r\n\tconst dispatch = createEventDispatcher();\r\n\tlet { progress } = $$props;\r\n\tlet { min = 0 } = $$props;\r\n\tlet { max = 100 } = $$props;\r\n\tlet { labelBusy = 'Busy' } = $$props;\r\n\tconst animatedValue = spring(0, { precision: 0.01 });\r\n\tconst animatedOpacity = spring(0, { precision: 0.01 });\r\n\tcomponent_subscribe($$self, animatedOpacity, value => $$invalidate(10, $animatedOpacity = value));\r\n\tconst animatedProgressClamped = derived([animatedValue], $animatedValue => clamp($animatedValue, min, max));\r\n\tcomponent_subscribe($$self, animatedProgressClamped, value => $$invalidate(11, $animatedProgressClamped = value));\r\n\r\n\tconst animatedProgressClampedUnsub = animatedProgressClamped.subscribe(value => {\r\n\t\tif (progress === 1 && Math.round(value) >= 100) dispatch('complete');\r\n\t});\r\n\r\n\tonMount(() => {\r\n\t\tanimatedOpacity.set(1);\r\n\t});\r\n\r\n\tonDestroy(() => {\r\n\t\tanimatedProgressClampedUnsub();\r\n\t});\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('progress' in $$props) $$invalidate(6, progress = $$props.progress);\r\n\t\tif ('min' in $$props) $$invalidate(7, min = $$props.min);\r\n\t\tif ('max' in $$props) $$invalidate(8, max = $$props.max);\r\n\t\tif ('labelBusy' in $$props) $$invalidate(9, labelBusy = $$props.labelBusy);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*progress*/ 64) {\r\n\t\t\tprogress && progress !== Infinity && animatedValue.set(progress * 100);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*progress, labelBusy, $animatedProgressClamped*/ 2624) {\r\n\t\t\t$$invalidate(3, formattedValue = progress === Infinity\r\n\t\t\t? labelBusy\r\n\t\t\t: `${Math.round($animatedProgressClamped)}%`);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*progress, $animatedProgressClamped*/ 2112) {\r\n\t\t\t$$invalidate(2, circleValue = progress === Infinity\r\n\t\t\t? '26.5 53'\r\n\t\t\t: `${$animatedProgressClamped / 100 * 53} 53`);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*$animatedOpacity*/ 1024) {\r\n\t\t\t$$invalidate(1, circleOpacity = $animatedOpacity); // Math.min(1, progress === Infinity ? 1 : $animatedProgressClamped / 10);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*progress*/ 64) {\r\n\t\t\t$$invalidate(0, status = progress === Infinity ? 'busy' : 'loading');\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tstatus,\r\n\t\tcircleOpacity,\r\n\t\tcircleValue,\r\n\t\tformattedValue,\r\n\t\tanimatedOpacity,\r\n\t\tanimatedProgressClamped,\r\n\t\tprogress,\r\n\t\tmin,\r\n\t\tmax,\r\n\t\tlabelBusy,\r\n\t\t$animatedOpacity,\r\n\t\t$animatedProgressClamped\r\n\t];\r\n}\r\n\r\nclass ProgressIndicator extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$H, create_fragment$G, safe_not_equal, {\r\n\t\t\tprogress: 6,\r\n\t\t\tmin: 7,\r\n\t\t\tmax: 8,\r\n\t\t\tlabelBusy: 9\r\n\t\t});\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/StatusAside.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$F(ctx) {\r\n\tlet span;\r\n\tlet span_class_value;\r\n\tlet current;\r\n\tconst default_slot_template = /*#slots*/ ctx[5].default;\r\n\tconst default_slot = create_slot(default_slot_template, ctx, /*$$scope*/ ctx[4], null);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tif (default_slot) default_slot.c();\r\n\t\t\tattr(span, \"class\", span_class_value = `PinturaStatusAside ${/*klass*/ ctx[0]}`);\r\n\t\t\tattr(span, \"style\", /*style*/ ctx[1]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tdefault_slot.m(span, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tif (default_slot.p && (!current || dirty & /*$$scope*/ 16)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tdefault_slot,\r\n\t\t\t\t\t\tdefault_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[4],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[4])\r\n\t\t\t\t\t\t: get_slot_changes(default_slot_template, /*$$scope*/ ctx[4], dirty, null),\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*klass*/ 1 && span_class_value !== (span_class_value = `PinturaStatusAside ${/*klass*/ ctx[0]}`)) {\r\n\t\t\t\tattr(span, \"class\", span_class_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*style*/ 2) {\r\n\t\t\t\tattr(span, \"style\", /*style*/ ctx[1]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(default_slot, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(default_slot, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t\tif (default_slot) default_slot.d(detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$G($$self, $$props, $$invalidate) {\r\n\tlet style;\r\n\tlet { $$slots: slots = {}, $$scope } = $$props;\r\n\tlet { offset = 0 } = $$props;\r\n\tlet { opacity = 0 } = $$props;\r\n\tlet { class: klass = undefined } = $$props;\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('offset' in $$props) $$invalidate(2, offset = $$props.offset);\r\n\t\tif ('opacity' in $$props) $$invalidate(3, opacity = $$props.opacity);\r\n\t\tif ('class' in $$props) $$invalidate(0, klass = $$props.class);\r\n\t\tif ('$$scope' in $$props) $$invalidate(4, $$scope = $$props.$$scope);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*offset, opacity*/ 12) {\r\n\t\t\t$$invalidate(1, style = `transform:translateX(${offset}px);opacity:${opacity}`);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [klass, style, offset, opacity, $$scope, slots];\r\n}\r\n\r\nclass StatusAside extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\t\tinit(this, options, instance$G, create_fragment$F, safe_not_equal, { offset: 2, opacity: 3, class: 0 });\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/Tag.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_if_block_2$b(ctx) {\r\n\tlet label;\r\n\tlet label_for_value;\r\n\tlet current;\r\n\tconst default_slot_template = /*#slots*/ ctx[3].default;\r\n\tconst default_slot = create_slot(default_slot_template, ctx, /*$$scope*/ ctx[2], null);\r\n\tlet label_levels = [{ for: label_for_value = '_' }, /*attributes*/ ctx[1]];\r\n\tlet label_data = {};\r\n\r\n\tfor (let i = 0; i < label_levels.length; i += 1) {\r\n\t\tlabel_data = assign(label_data, label_levels[i]);\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tlabel = element(\"label\");\r\n\t\t\tif (default_slot) default_slot.c();\r\n\t\t\tset_attributes(label, label_data);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, label, anchor);\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tdefault_slot.m(label, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tif (default_slot.p && (!current || dirty & /*$$scope*/ 4)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tdefault_slot,\r\n\t\t\t\t\t\tdefault_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[2],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[2])\r\n\t\t\t\t\t\t: get_slot_changes(default_slot_template, /*$$scope*/ ctx[2], dirty, null),\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tset_attributes(label, label_data = get_spread_update(label_levels, [\r\n\t\t\t\t{ for: label_for_value },\r\n\t\t\t\tdirty & /*attributes*/ 2 && /*attributes*/ ctx[1]\r\n\t\t\t]));\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(default_slot, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(default_slot, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(label);\r\n\t\t\tif (default_slot) default_slot.d(detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (12:26) \r\nfunction create_if_block_1$c(ctx) {\r\n\tlet div;\r\n\tlet current;\r\n\tconst default_slot_template = /*#slots*/ ctx[3].default;\r\n\tconst default_slot = create_slot(default_slot_template, ctx, /*$$scope*/ ctx[2], null);\r\n\tlet div_levels = [/*attributes*/ ctx[1]];\r\n\tlet div_data = {};\r\n\r\n\tfor (let i = 0; i < div_levels.length; i += 1) {\r\n\t\tdiv_data = assign(div_data, div_levels[i]);\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (default_slot) default_slot.c();\r\n\t\t\tset_attributes(div, div_data);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tdefault_slot.m(div, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tif (default_slot.p && (!current || dirty & /*$$scope*/ 4)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tdefault_slot,\r\n\t\t\t\t\t\tdefault_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[2],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[2])\r\n\t\t\t\t\t\t: get_slot_changes(default_slot_template, /*$$scope*/ ctx[2], dirty, null),\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tset_attributes(div, div_data = get_spread_update(div_levels, [dirty & /*attributes*/ 2 && /*attributes*/ ctx[1]]));\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(default_slot, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(default_slot, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif (default_slot) default_slot.d(detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (8:0) {#if name === 'div'}\r\nfunction create_if_block$b(ctx) {\r\n\tlet div;\r\n\tlet current;\r\n\tconst default_slot_template = /*#slots*/ ctx[3].default;\r\n\tconst default_slot = create_slot(default_slot_template, ctx, /*$$scope*/ ctx[2], null);\r\n\tlet div_levels = [/*attributes*/ ctx[1]];\r\n\tlet div_data = {};\r\n\r\n\tfor (let i = 0; i < div_levels.length; i += 1) {\r\n\t\tdiv_data = assign(div_data, div_levels[i]);\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (default_slot) default_slot.c();\r\n\t\t\tset_attributes(div, div_data);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tdefault_slot.m(div, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tif (default_slot.p && (!current || dirty & /*$$scope*/ 4)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tdefault_slot,\r\n\t\t\t\t\t\tdefault_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[2],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[2])\r\n\t\t\t\t\t\t: get_slot_changes(default_slot_template, /*$$scope*/ ctx[2], dirty, null),\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tset_attributes(div, div_data = get_spread_update(div_levels, [dirty & /*attributes*/ 2 && /*attributes*/ ctx[1]]));\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(default_slot, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(default_slot, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif (default_slot) default_slot.d(detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$E(ctx) {\r\n\tlet current_block_type_index;\r\n\tlet if_block;\r\n\tlet if_block_anchor;\r\n\tlet current;\r\n\tconst if_block_creators = [create_if_block$b, create_if_block_1$c, create_if_block_2$b];\r\n\tconst if_blocks = [];\r\n\r\n\tfunction select_block_type(ctx, dirty) {\r\n\t\tif (/*name*/ ctx[0] === 'div') return 0;\r\n\t\tif (/*name*/ ctx[0] === 'span') return 1;\r\n\t\tif (/*name*/ ctx[0] === 'label') return 2;\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tif (~(current_block_type_index = select_block_type(ctx))) {\r\n\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tif_block_anchor = empty();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (~current_block_type_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].m(target, anchor);\r\n\t\t\t}\r\n\r\n\t\t\tinsert(target, if_block_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tlet previous_block_index = current_block_type_index;\r\n\t\t\tcurrent_block_type_index = select_block_type(ctx);\r\n\r\n\t\t\tif (current_block_type_index === previous_block_index) {\r\n\t\t\t\tif (~current_block_type_index) {\r\n\t\t\t\t\tif_blocks[current_block_type_index].p(ctx, dirty);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\t\ttransition_out(if_blocks[previous_block_index], 1, 1, () => {\r\n\t\t\t\t\t\tif_blocks[previous_block_index] = null;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tcheck_outros();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (~current_block_type_index) {\r\n\t\t\t\t\tif_block = if_blocks[current_block_type_index];\r\n\r\n\t\t\t\t\tif (!if_block) {\r\n\t\t\t\t\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t\t\t\t\t\tif_block.c();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif_block.p(ctx, dirty);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(if_block_anchor.parentNode, if_block_anchor);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (~current_block_type_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].d(detaching);\r\n\t\t\t}\r\n\r\n\t\t\tif (detaching) detach(if_block_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$F($$self, $$props, $$invalidate) {\r\n\tlet { $$slots: slots = {}, $$scope } = $$props;\r\n\tlet { name = 'div' } = $$props;\r\n\tlet { attributes = {} } = $$props;\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('name' in $$props) $$invalidate(0, name = $$props.name);\r\n\t\tif ('attributes' in $$props) $$invalidate(1, attributes = $$props.attributes);\r\n\t\tif ('$$scope' in $$props) $$invalidate(2, $$scope = $$props.$$scope);\r\n\t};\r\n\r\n\treturn [name, attributes, $$scope, slots];\r\n}\r\n\r\nclass Tag extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\t\tinit(this, options, instance$F, create_fragment$E, safe_not_equal, { name: 0, attributes: 1 });\r\n\t}\r\n}\r\n\r\nvar getDevicePixelRatio = () => (isBrowser() && window.devicePixelRatio) || 1;\r\n\r\n// if this is a non retina display snap to pixel\r\nlet fn = null;\r\nvar snapToPixel = (v) => {\r\n    if (fn === null)\r\n        fn = getDevicePixelRatio() === 1 ? Math.round : (v) => v;\r\n    return fn(v);\r\n};\r\n\r\nvar focus = (element, options = {}) => {\r\n    if (!element)\r\n        return;\r\n    if (options.preventScroll && isSafari()) {\r\n        const scrollTop = document.body.scrollTop;\r\n        element.focus();\r\n        document.body.scrollTop = scrollTop;\r\n        return;\r\n    }\r\n    element.focus(options);\r\n};\r\n\r\n/* src/core/ui/components/Panel.svelte generated by Svelte v3.50.1 */\r\nconst get_details_slot_changes = dirty => ({});\r\nconst get_details_slot_context = ctx => ({});\r\nconst get_label_slot_changes = dirty => ({});\r\nconst get_label_slot_context = ctx => ({});\r\n\r\n// (216:0) {:else}\r\nfunction create_else_block$5(ctx) {\r\n\tlet button;\r\n\tlet current;\r\n\tconst button_spread_levels = [/*buttonProps*/ ctx[7]];\r\n\r\n\tlet button_props = {\r\n\t\t$$slots: { default: [create_default_slot$f] },\r\n\t\t$$scope: { ctx }\r\n\t};\r\n\r\n\tfor (let i = 0; i < button_spread_levels.length; i += 1) {\r\n\t\tbutton_props = assign(button_props, button_spread_levels[i]);\r\n\t}\r\n\r\n\tbutton = new Button({ props: button_props });\r\n\t/*button_binding_1*/ ctx[40](button);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(button.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(button, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst button_changes = (dirty[0] & /*buttonProps*/ 128)\r\n\t\t\t? get_spread_update(button_spread_levels, [get_spread_object(/*buttonProps*/ ctx[7])])\r\n\t\t\t: {};\r\n\r\n\t\t\tif (dirty[1] & /*$$scope*/ 8192) {\r\n\t\t\t\tbutton_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tbutton.$set(button_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(button.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(button.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\t/*button_binding_1*/ ctx[40](null);\r\n\t\t\tdestroy_component(button, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (214:0) {#if buttonLabel}\r\nfunction create_if_block_2$a(ctx) {\r\n\tlet button;\r\n\tlet current;\r\n\tconst button_spread_levels = [/*buttonProps*/ ctx[7]];\r\n\tlet button_props = {};\r\n\r\n\tfor (let i = 0; i < button_spread_levels.length; i += 1) {\r\n\t\tbutton_props = assign(button_props, button_spread_levels[i]);\r\n\t}\r\n\r\n\tbutton = new Button({ props: button_props });\r\n\t/*button_binding*/ ctx[39](button);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(button.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(button, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst button_changes = (dirty[0] & /*buttonProps*/ 128)\r\n\t\t\t? get_spread_update(button_spread_levels, [get_spread_object(/*buttonProps*/ ctx[7])])\r\n\t\t\t: {};\r\n\r\n\t\t\tbutton.$set(button_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(button.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(button.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\t/*button_binding*/ ctx[39](null);\r\n\t\t\tdestroy_component(button, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (217:4) <Button bind:this={buttonComponent} {...buttonProps}>\r\nfunction create_default_slot$f(ctx) {\r\n\tlet current;\r\n\tconst label_slot_template = /*#slots*/ ctx[38].label;\r\n\tconst label_slot = create_slot(label_slot_template, ctx, /*$$scope*/ ctx[44], get_label_slot_context);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (label_slot) label_slot.c();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (label_slot) {\r\n\t\t\t\tlabel_slot.m(target, anchor);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (label_slot) {\r\n\t\t\t\tif (label_slot.p && (!current || dirty[1] & /*$$scope*/ 8192)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tlabel_slot,\r\n\t\t\t\t\t\tlabel_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[44],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[44])\r\n\t\t\t\t\t\t: get_slot_changes(label_slot_template, /*$$scope*/ ctx[44], dirty, get_label_slot_changes),\r\n\t\t\t\t\t\tget_label_slot_context\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(label_slot, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(label_slot, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (label_slot) label_slot.d(detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (222:0) {#if isVisible}\r\nfunction create_if_block_1$b(ctx) {\r\n\tlet div;\r\n\tlet t;\r\n\tlet span;\r\n\tlet div_class_value;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tconst details_slot_template = /*#slots*/ ctx[38].details;\r\n\tconst details_slot = create_slot(details_slot_template, ctx, /*$$scope*/ ctx[44], get_details_slot_context);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (details_slot) details_slot.c();\r\n\t\t\tt = space();\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tattr(span, \"class\", \"PinturaPanelTip\");\r\n\t\t\tattr(span, \"style\", /*tipStyle*/ ctx[10]);\r\n\t\t\tattr(div, \"class\", div_class_value = arrayJoin(['PinturaPanel', 'pintura-editor-panel', /*panelClass*/ ctx[2]]));\r\n\t\t\tattr(div, \"tabindex\", \"-1\");\r\n\t\t\tattr(div, \"style\", /*style*/ ctx[11]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\r\n\t\t\tif (details_slot) {\r\n\t\t\t\tdetails_slot.m(div, null);\r\n\t\t\t}\r\n\r\n\t\t\tappend(div, t);\r\n\t\t\tappend(div, span);\r\n\t\t\t/*div_binding*/ ctx[41](div);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(div, \"close\", /*close_handler*/ ctx[42]),\r\n\t\t\t\t\tlisten(div, \"keydown\", /*handlePanelKeydown*/ ctx[18]),\r\n\t\t\t\t\tlisten(div, \"measure\", /*measure_handler*/ ctx[43]),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (details_slot) {\r\n\t\t\t\tif (details_slot.p && (!current || dirty[1] & /*$$scope*/ 8192)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tdetails_slot,\r\n\t\t\t\t\t\tdetails_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[44],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[44])\r\n\t\t\t\t\t\t: get_slot_changes(details_slot_template, /*$$scope*/ ctx[44], dirty, get_details_slot_changes),\r\n\t\t\t\t\t\tget_details_slot_context\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*tipStyle*/ 1024) {\r\n\t\t\t\tattr(span, \"style\", /*tipStyle*/ ctx[10]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*panelClass*/ 4 && div_class_value !== (div_class_value = arrayJoin(['PinturaPanel', 'pintura-editor-panel', /*panelClass*/ ctx[2]]))) {\r\n\t\t\t\tattr(div, \"class\", div_class_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*style*/ 2048) {\r\n\t\t\t\tattr(div, \"style\", /*style*/ ctx[11]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(details_slot, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(details_slot, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif (details_slot) details_slot.d(detaching);\r\n\t\t\t/*div_binding*/ ctx[41](null);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$D(ctx) {\r\n\tlet t0;\r\n\tlet current_block_type_index;\r\n\tlet if_block0;\r\n\tlet t1;\r\n\tlet t2;\r\n\tlet if_block2_anchor;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tconst if_block_creators = [create_if_block_2$a, create_else_block$5];\r\n\tconst if_blocks = [];\r\n\r\n\tfunction select_block_type(ctx, dirty) {\r\n\t\tif (/*buttonLabel*/ ctx[1]) return 0;\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tcurrent_block_type_index = select_block_type(ctx);\r\n\tif_block0 = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\tlet if_block1 = /*isVisible*/ ctx[6] && create_if_block_1$b(ctx);\r\n\tlet if_block2 = false ;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tt0 = space();\r\n\t\t\tif_block0.c();\r\n\t\t\tt1 = space();\r\n\t\t\tif (if_block1) if_block1.c();\r\n\t\t\tt2 = space();\r\n\t\t\tif_block2_anchor = empty();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, t0, anchor);\r\n\t\t\tif_blocks[current_block_type_index].m(target, anchor);\r\n\t\t\tinsert(target, t1, anchor);\r\n\t\t\tif (if_block1) if_block1.m(target, anchor);\r\n\t\t\tinsert(target, t2, anchor);\r\n\t\t\tinsert(target, if_block2_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(document.body, \"pointerdown\", function () {\r\n\t\t\t\t\t\tif (is_function(/*handleDown*/ ctx[9])) /*handleDown*/ ctx[9].apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(document.body, \"pointerup\", function () {\r\n\t\t\t\t\t\tif (is_function(/*handleUp*/ ctx[8])) /*handleUp*/ ctx[8].apply(this, arguments);\r\n\t\t\t\t\t})\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\t\t\tlet previous_block_index = current_block_type_index;\r\n\t\t\tcurrent_block_type_index = select_block_type(ctx);\r\n\r\n\t\t\tif (current_block_type_index === previous_block_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].p(ctx, dirty);\r\n\t\t\t} else {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_blocks[previous_block_index], 1, 1, () => {\r\n\t\t\t\t\tif_blocks[previous_block_index] = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t\tif_block0 = if_blocks[current_block_type_index];\r\n\r\n\t\t\t\tif (!if_block0) {\r\n\t\t\t\t\tif_block0 = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t\t\t\t\tif_block0.c();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block0.p(ctx, dirty);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\tif_block0.m(t1.parentNode, t1);\r\n\t\t\t}\r\n\r\n\t\t\tif (/*isVisible*/ ctx[6]) {\r\n\t\t\t\tif (if_block1) {\r\n\t\t\t\t\tif_block1.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[0] & /*isVisible*/ 64) {\r\n\t\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block1 = create_if_block_1$b(ctx);\r\n\t\t\t\t\tif_block1.c();\r\n\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\tif_block1.m(t2.parentNode, t2);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block1) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block1, 1, 1, () => {\r\n\t\t\t\t\tif_block1 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block0);\r\n\t\t\ttransition_in(if_block1);\r\n\t\t\ttransition_in(if_block2);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block0);\r\n\t\t\ttransition_out(if_block1);\r\n\t\t\ttransition_out(if_block2);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(t0);\r\n\t\t\tif_blocks[current_block_type_index].d(detaching);\r\n\t\t\tif (detaching) detach(t1);\r\n\t\t\tif (if_block1) if_block1.d(detaching);\r\n\t\t\tif (detaching) detach(t2);\r\n\t\t\tif (detaching) detach(if_block2_anchor);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nlet panelMargin = 12;\r\n\r\nfunction instance$E($$self, $$props, $$invalidate) {\r\n\tlet buttonElement;\r\n\tlet offsetProgress;\r\n\tlet isVisible;\r\n\tlet isAnimating;\r\n\tlet transform;\r\n\tlet style;\r\n\tlet tipScale;\r\n\tlet tipOpacity;\r\n\tlet tipStyle;\r\n\tlet handleDown;\r\n\tlet handleUp;\r\n\tlet buttonProps;\r\n\tlet $portal;\r\n\tlet $position;\r\n\tlet $opacity;\r\n\tlet $offset;\r\n\tlet $portalRootRect;\r\n\tlet $isAnimated;\r\n\tlet { $$slots: slots = {}, $$scope } = $$props;\r\n\tlet { buttonClass = undefined } = $$props;\r\n\tlet { buttonLabel = undefined } = $$props;\r\n\tlet { panelClass = undefined } = $$props;\r\n\tlet { isActive = false } = $$props;\r\n\tlet { onshow = ({ panel }) => focus(panel, { preventScroll: true }) } = $$props;\r\n\tlet { onhide = noop$1 } = $$props;\r\n\tconst isAnimated = getContext('isAnimated');\r\n\tcomponent_subscribe($$self, isAnimated, value => $$invalidate(37, $isAnimated = value));\r\n\tconst portal = getContext('rootPortal');\r\n\tcomponent_subscribe($$self, portal, value => $$invalidate(32, $portal = value));\r\n\tconst portalRootRect = getContext('rootRect');\r\n\tcomponent_subscribe($$self, portalRootRect, value => $$invalidate(36, $portalRootRect = value));\r\n\tlet panelSize;\r\n\tlet buttonComponent;\r\n\tlet buttonRect;\r\n\tconst syncButtonRect = () => $$invalidate(22, buttonRect = buttonElement && buttonElement.getBoundingClientRect());\r\n\tlet dir = vectorCreateEmpty();\r\n\tlet opacity = spring(0);\r\n\tcomponent_subscribe($$self, opacity, value => $$invalidate(34, $opacity = value));\r\n\tlet shift = vectorCreateEmpty();\r\n\tconst position = writable({ x: 0, y: 0 });\r\n\tcomponent_subscribe($$self, position, value => $$invalidate(33, $position = value));\r\n\r\n\tconst offset = spring(-5, {\r\n\t\tstiffness: 0.1,\r\n\t\tdamping: 0.35,\r\n\t\tprecision: 0.001\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, offset, value => $$invalidate(35, $offset = value));\r\n\tconst isTargetSelf = e => isEventTarget(e, $portal) || buttonComponent.isEventTarget(e);\r\n\tlet downOutsidePanel = false;\r\n\r\n\t// move detail panel to portal\r\n\tlet detailPanel;\r\n\r\n\tlet trigger;\r\n\r\n\t// test keydown press to open\r\n\tconst handleClick = e => {\r\n\t\tif (!isActive) syncButtonRect();\r\n\t\t$$invalidate(26, trigger = e);\r\n\t\t$$invalidate(0, isActive = !isActive);\r\n\t};\r\n\r\n\tconst handleButtonKeydown = e => {\r\n\t\tif (!(/down/i).test(e.key)) return;\r\n\t\t$$invalidate(0, isActive = true);\r\n\t\t$$invalidate(26, trigger = e);\r\n\t};\r\n\r\n\tconst handlePanelKeydown = e => {\r\n\t\tif (!(/esc/i).test(e.key)) return;\r\n\t\t$$invalidate(0, isActive = false);\r\n\t\tbuttonElement.focus();\r\n\t};\r\n\r\n\t// clean up panel if it was appended to a portal\r\n\tonDestroy(() => {\r\n\t\t// no panel or portal, exit\r\n\t\tif (!$portal) return;\r\n\r\n\t\tif (!detailPanel) return;\r\n\r\n\t\t// store a ref\r\n\t\tconst detailPanelRef = detailPanel;\r\n\r\n\t\t// clean up \"manually\" if svelte failed to detach, this sometimes happens if parent element is removed from DOM\r\n\t\ttick$1().then(() => {\r\n\t\t\tif (!detailPanelRef.parentNode) return;\r\n\t\t\tdetailPanelRef.remove();\r\n\t\t});\r\n\t});\r\n\r\n\tfunction button_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\tbuttonComponent = $$value;\r\n\t\t\t$$invalidate(4, buttonComponent);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction button_binding_1($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\tbuttonComponent = $$value;\r\n\t\t\t$$invalidate(4, buttonComponent);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction div_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\tdetailPanel = $$value;\r\n\t\t\t$$invalidate(5, detailPanel);\r\n\t\t});\r\n\t}\r\n\r\n\tconst close_handler = e => {\r\n\t\te.stopPropagation();\r\n\t\t$$invalidate(0, isActive = false);\r\n\t};\r\n\r\n\tconst measure_handler = e => $$invalidate(3, panelSize = sizeCreateFromAny(e.detail));\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('buttonClass' in $$props) $$invalidate(19, buttonClass = $$props.buttonClass);\r\n\t\tif ('buttonLabel' in $$props) $$invalidate(1, buttonLabel = $$props.buttonLabel);\r\n\t\tif ('panelClass' in $$props) $$invalidate(2, panelClass = $$props.panelClass);\r\n\t\tif ('isActive' in $$props) $$invalidate(0, isActive = $$props.isActive);\r\n\t\tif ('onshow' in $$props) $$invalidate(20, onshow = $$props.onshow);\r\n\t\tif ('onhide' in $$props) $$invalidate(21, onhide = $$props.onhide);\r\n\t\tif ('$$scope' in $$props) $$invalidate(44, $$scope = $$props.$$scope);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*buttonComponent*/ 16) {\r\n\t\t\tbuttonElement = buttonComponent && buttonComponent.getElement();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*isActive, downOutsidePanel*/ 33554433) {\r\n\t\t\t$$invalidate(8, handleUp = isActive\r\n\t\t\t? e => {\r\n\t\t\t\t\tif (!downOutsidePanel) return;\r\n\t\t\t\t\t$$invalidate(25, downOutsidePanel = false);\r\n\t\t\t\t\tif (isTargetSelf(e)) return;\r\n\t\t\t\t\t$$invalidate(0, isActive = false);\r\n\t\t\t\t}\r\n\t\t\t: undefined);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*isActive*/ 1 | $$self.$$.dirty[1] & /*$isAnimated*/ 64) {\r\n\t\t\topacity.set(isActive ? 1 : 0, { hard: $isAnimated === false });\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*isActive*/ 1 | $$self.$$.dirty[1] & /*$isAnimated*/ 64) {\r\n\t\t\toffset.set(isActive ? 0 : -5, { hard: $isAnimated === false });\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$offset*/ 16) {\r\n\t\t\t$$invalidate(29, offsetProgress = 1 - $offset / -5);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*isActive*/ 1 | $$self.$$.dirty[1] & /*$portalRootRect*/ 32) {\r\n\t\t\tif ($portalRootRect && isActive) syncButtonRect();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*panelSize, buttonRect, isActive*/ 4194313 | $$self.$$.dirty[1] & /*$portalRootRect*/ 32) {\r\n\t\t\tif ($portalRootRect && panelSize && buttonRect && isActive) {\r\n\t\t\t\t// as a starting point we'll align panel to center of button and position below\r\n\t\t\t\tlet x = buttonRect.x - $portalRootRect.x + buttonRect.width * 0.5 - panelSize.width * 0.5;\r\n\r\n\t\t\t\tlet y = buttonRect.y - $portalRootRect.y + buttonRect.height;\r\n\t\t\t\tconst parentLeft = panelMargin;\r\n\t\t\t\tconst parentTop = panelMargin;\r\n\t\t\t\tconst parentRight = $portalRootRect.width - panelMargin;\r\n\t\t\t\tconst parentBottom = $portalRootRect.height - panelMargin;\r\n\t\t\t\tconst panelLeft = x;\r\n\t\t\t\tconst panelTop = y;\r\n\t\t\t\tconst panelRight = panelLeft + panelSize.width;\r\n\t\t\t\tconst panelBottom = panelTop + panelSize.height;\r\n\r\n\t\t\t\t// move to right\r\n\t\t\t\tif (panelLeft < parentLeft) {\r\n\t\t\t\t\t$$invalidate(24, shift.x = panelLeft - parentLeft, shift);\r\n\t\t\t\t\tx = parentLeft;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// move to left\r\n\t\t\t\tif (panelRight > parentRight) {\r\n\t\t\t\t\t$$invalidate(24, shift.x = panelRight - parentRight, shift);\r\n\t\t\t\t\tx = parentRight - panelSize.width;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (panelBottom > parentBottom) {\r\n\t\t\t\t\t// doesn't fit vertically, push up\r\n\t\t\t\t\t$$invalidate(23, dir.y = -1, dir);\r\n\r\n\t\t\t\t\tconst positionedAboveButtonY = y - panelSize.height - buttonRect.height;\r\n\t\t\t\t\tconst panelFitsAboveButton = parentTop < positionedAboveButtonY;\r\n\r\n\t\t\t\t\tif (panelFitsAboveButton) {\r\n\t\t\t\t\t\t$$invalidate(24, shift.y = 0, shift);\r\n\t\t\t\t\t\ty -= panelSize.height + buttonRect.height;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// overlap with button\r\n\t\t\t\t\t\t$$invalidate(24, shift.y = y - (panelBottom - parentBottom), shift);\r\n\r\n\t\t\t\t\t\ty -= panelBottom - parentBottom;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// all is fine\r\n\t\t\t\t\t$$invalidate(23, dir.y = 1, dir);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tset_store_value(position, $position = vectorApply(vectorCreate(x, y), snapToPixel), $position);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$opacity*/ 8) {\r\n\t\t\t$$invalidate(6, isVisible = $opacity > 0);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$opacity*/ 8) {\r\n\t\t\t$$invalidate(31, isAnimating = $opacity < 1);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*dir*/ 8388608 | $$self.$$.dirty[1] & /*$position, $offset*/ 20) {\r\n\t\t\t$$invalidate(30, transform = `translateX(${Math.round($position.x) + dir.x * panelMargin}px) translateY(${Math.round($position.y) + dir.y * panelMargin + dir.y * $offset}px)`);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*transform*/ 1073741824 | $$self.$$.dirty[1] & /*isAnimating, $opacity*/ 9) {\r\n\t\t\t$$invalidate(11, style = isAnimating\r\n\t\t\t? `opacity: ${$opacity}; pointer-events: ${$opacity < 1 ? 'none' : 'all'}; transform: ${transform};`\r\n\t\t\t: `transform: ${transform}`);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*offsetProgress*/ 536870912) {\r\n\t\t\t$$invalidate(27, tipScale = 0.5 + offsetProgress * 0.5);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*offsetProgress*/ 536870912) {\r\n\t\t\t$$invalidate(28, tipOpacity = offsetProgress);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*panelSize, tipOpacity, tipScale, dir, shift*/ 427819016 | $$self.$$.dirty[1] & /*$position*/ 4) {\r\n\t\t\t$$invalidate(10, tipStyle = $position && panelSize && `opacity:${tipOpacity};transform:scaleX(${tipScale})rotate(45deg);top:${dir.y < 0 ? shift.y + panelSize.height : 0}px;left:${shift.x + panelSize.width * 0.5}px`);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*isActive*/ 1) {\r\n\t\t\t$$invalidate(9, handleDown = isActive\r\n\t\t\t? e => {\r\n\t\t\t\t\tif (isTargetSelf(e)) return;\r\n\t\t\t\t\t$$invalidate(25, downOutsidePanel = true);\r\n\t\t\t\t}\r\n\t\t\t: undefined);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*isVisible, detailPanel*/ 96 | $$self.$$.dirty[1] & /*$portal*/ 2) {\r\n\t\t\tif (isVisible && $portal && detailPanel && detailPanel.parentNode !== $portal) $portal.append(detailPanel);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*isActive*/ 1) {\r\n\t\t\tif (!isActive) {\r\n\t\t\t\t$$invalidate(26, trigger = undefined);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*isActive, isVisible, detailPanel, onshow, trigger*/ 68157537) {\r\n\t\t\tif (isActive && isVisible && detailPanel) {\r\n\t\t\t\tonshow({ e: trigger, panel: detailPanel });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*isVisible, isActive, onhide*/ 2097217) {\r\n\t\t\tif (isVisible && !isActive) {\r\n\t\t\t\tonhide();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*buttonLabel, buttonClass*/ 524290) {\r\n\t\t\t// calculate button props for both types of buttons\r\n\t\t\t$$invalidate(7, buttonProps = {\r\n\t\t\t\tlabel: buttonLabel,\r\n\t\t\t\tclass: arrayJoin(['PinturaPanelButton', buttonClass]),\r\n\t\t\t\tonkeydown: handleButtonKeydown,\r\n\t\t\t\tonclick: handleClick\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tisActive,\r\n\t\tbuttonLabel,\r\n\t\tpanelClass,\r\n\t\tpanelSize,\r\n\t\tbuttonComponent,\r\n\t\tdetailPanel,\r\n\t\tisVisible,\r\n\t\tbuttonProps,\r\n\t\thandleUp,\r\n\t\thandleDown,\r\n\t\ttipStyle,\r\n\t\tstyle,\r\n\t\tisAnimated,\r\n\t\tportal,\r\n\t\tportalRootRect,\r\n\t\topacity,\r\n\t\tposition,\r\n\t\toffset,\r\n\t\thandlePanelKeydown,\r\n\t\tbuttonClass,\r\n\t\tonshow,\r\n\t\tonhide,\r\n\t\tbuttonRect,\r\n\t\tdir,\r\n\t\tshift,\r\n\t\tdownOutsidePanel,\r\n\t\ttrigger,\r\n\t\ttipScale,\r\n\t\ttipOpacity,\r\n\t\toffsetProgress,\r\n\t\ttransform,\r\n\t\tisAnimating,\r\n\t\t$portal,\r\n\t\t$position,\r\n\t\t$opacity,\r\n\t\t$offset,\r\n\t\t$portalRootRect,\r\n\t\t$isAnimated,\r\n\t\tslots,\r\n\t\tbutton_binding,\r\n\t\tbutton_binding_1,\r\n\t\tdiv_binding,\r\n\t\tclose_handler,\r\n\t\tmeasure_handler,\r\n\t\t$$scope\r\n\t];\r\n}\r\n\r\nclass Panel extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$E,\r\n\t\t\tcreate_fragment$D,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tbuttonClass: 19,\r\n\t\t\t\tbuttonLabel: 1,\r\n\t\t\t\tpanelClass: 2,\r\n\t\t\t\tisActive: 0,\r\n\t\t\t\tonshow: 20,\r\n\t\t\t\tonhide: 21\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1]\r\n\t\t);\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/RadioItem.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$C(ctx) {\r\n\tlet li;\r\n\tlet input;\r\n\tlet t;\r\n\tlet label_1;\r\n\tlet li_class_value;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tconst default_slot_template = /*#slots*/ ctx[15].default;\r\n\tconst default_slot = create_slot(default_slot_template, ctx, /*$$scope*/ ctx[14], null);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tli = element(\"li\");\r\n\t\t\tinput = element(\"input\");\r\n\t\t\tt = space();\r\n\t\t\tlabel_1 = element(\"label\");\r\n\t\t\tif (default_slot) default_slot.c();\r\n\t\t\tattr(input, \"type\", \"radio\");\r\n\t\t\tattr(input, \"class\", \"implicit\");\r\n\t\t\tattr(input, \"id\", /*inputId*/ ctx[7]);\r\n\t\t\tattr(input, \"name\", /*name*/ ctx[0]);\r\n\t\t\tinput.value = /*value*/ ctx[3];\r\n\t\t\tinput.disabled = /*disabled*/ ctx[6];\r\n\t\t\tinput.hidden = /*hidden*/ ctx[5];\r\n\t\t\tinput.checked = /*checked*/ ctx[4];\r\n\t\t\tattr(label_1, \"for\", /*inputId*/ ctx[7]);\r\n\t\t\tattr(label_1, \"title\", /*label*/ ctx[2]);\r\n\t\t\tattr(li, \"class\", li_class_value = arrayJoin(['PinturaRadioGroupOption', /*klass*/ ctx[1]]));\r\n\t\t\tattr(li, \"data-hidden\", /*hidden*/ ctx[5]);\r\n\t\t\tattr(li, \"data-disabled\", /*disabled*/ ctx[6]);\r\n\t\t\tattr(li, \"data-selected\", /*checked*/ ctx[4]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, li, anchor);\r\n\t\t\tappend(li, input);\r\n\t\t\tappend(li, t);\r\n\t\t\tappend(li, label_1);\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tdefault_slot.m(label_1, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(input, \"change\", stop_propagation(/*change_handler*/ ctx[16])),\r\n\t\t\t\t\tlisten(input, \"keydown\", /*handleKeydown*/ ctx[9]),\r\n\t\t\t\t\tlisten(input, \"click\", /*handleClick*/ ctx[10])\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tif (!current || dirty & /*inputId*/ 128) {\r\n\t\t\t\tattr(input, \"id\", /*inputId*/ ctx[7]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*name*/ 1) {\r\n\t\t\t\tattr(input, \"name\", /*name*/ ctx[0]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*value*/ 8) {\r\n\t\t\t\tinput.value = /*value*/ ctx[3];\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*disabled*/ 64) {\r\n\t\t\t\tinput.disabled = /*disabled*/ ctx[6];\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*hidden*/ 32) {\r\n\t\t\t\tinput.hidden = /*hidden*/ ctx[5];\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*checked*/ 16) {\r\n\t\t\t\tinput.checked = /*checked*/ ctx[4];\r\n\t\t\t}\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tif (default_slot.p && (!current || dirty & /*$$scope*/ 16384)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tdefault_slot,\r\n\t\t\t\t\t\tdefault_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[14],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[14])\r\n\t\t\t\t\t\t: get_slot_changes(default_slot_template, /*$$scope*/ ctx[14], dirty, null),\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*inputId*/ 128) {\r\n\t\t\t\tattr(label_1, \"for\", /*inputId*/ ctx[7]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*label*/ 4) {\r\n\t\t\t\tattr(label_1, \"title\", /*label*/ ctx[2]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*klass*/ 2 && li_class_value !== (li_class_value = arrayJoin(['PinturaRadioGroupOption', /*klass*/ ctx[1]]))) {\r\n\t\t\t\tattr(li, \"class\", li_class_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*hidden*/ 32) {\r\n\t\t\t\tattr(li, \"data-hidden\", /*hidden*/ ctx[5]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*disabled*/ 64) {\r\n\t\t\t\tattr(li, \"data-disabled\", /*disabled*/ ctx[6]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*checked*/ 16) {\r\n\t\t\t\tattr(li, \"data-selected\", /*checked*/ ctx[4]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(default_slot, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(default_slot, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(li);\r\n\t\t\tif (default_slot) default_slot.d(detaching);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$D($$self, $$props, $$invalidate) {\r\n\tlet inputId;\r\n\tlet $keysPressedStored;\r\n\tlet { $$slots: slots = {}, $$scope } = $$props;\r\n\tlet { name } = $$props;\r\n\tlet { class: klass = undefined } = $$props;\r\n\tlet { label } = $$props;\r\n\tlet { id } = $$props;\r\n\tlet { value } = $$props;\r\n\tlet { checked } = $$props;\r\n\tlet { onkeydown } = $$props;\r\n\tlet { onclick } = $$props;\r\n\tlet { hidden = false } = $$props;\r\n\tlet { disabled = false } = $$props;\r\n\tconst ArrowKeyCodes = Object.values(ArrowKeys);\r\n\tconst keysPressedStored = getContext('keysPressed');\r\n\tcomponent_subscribe($$self, keysPressedStored, value => $$invalidate(17, $keysPressedStored = value));\r\n\r\n\tconst handleKeydown = e => {\r\n\t\tonkeydown(e);\r\n\t};\r\n\r\n\tconst handleClick = e => {\r\n\t\t// if pressed arrow key -> ignore so navigation with arrow keys works\r\n\t\tif ($keysPressedStored.some(key => ArrowKeyCodes.includes(key))) return;\r\n\r\n\t\t// just a normal click\r\n\t\tonclick(e);\r\n\t};\r\n\r\n\tfunction change_handler(event) {\r\n\t\tbubble.call(this, $$self, event);\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('name' in $$props) $$invalidate(0, name = $$props.name);\r\n\t\tif ('class' in $$props) $$invalidate(1, klass = $$props.class);\r\n\t\tif ('label' in $$props) $$invalidate(2, label = $$props.label);\r\n\t\tif ('id' in $$props) $$invalidate(11, id = $$props.id);\r\n\t\tif ('value' in $$props) $$invalidate(3, value = $$props.value);\r\n\t\tif ('checked' in $$props) $$invalidate(4, checked = $$props.checked);\r\n\t\tif ('onkeydown' in $$props) $$invalidate(12, onkeydown = $$props.onkeydown);\r\n\t\tif ('onclick' in $$props) $$invalidate(13, onclick = $$props.onclick);\r\n\t\tif ('hidden' in $$props) $$invalidate(5, hidden = $$props.hidden);\r\n\t\tif ('disabled' in $$props) $$invalidate(6, disabled = $$props.disabled);\r\n\t\tif ('$$scope' in $$props) $$invalidate(14, $$scope = $$props.$$scope);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*name, id*/ 2049) {\r\n\t\t\t$$invalidate(7, inputId = `${name}-${id}`);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tname,\r\n\t\tklass,\r\n\t\tlabel,\r\n\t\tvalue,\r\n\t\tchecked,\r\n\t\thidden,\r\n\t\tdisabled,\r\n\t\tinputId,\r\n\t\tkeysPressedStored,\r\n\t\thandleKeydown,\r\n\t\thandleClick,\r\n\t\tid,\r\n\t\tonkeydown,\r\n\t\tonclick,\r\n\t\t$$scope,\r\n\t\tslots,\r\n\t\tchange_handler\r\n\t];\r\n}\r\n\r\nclass RadioItem extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$D, create_fragment$C, safe_not_equal, {\r\n\t\t\tname: 0,\r\n\t\t\tclass: 1,\r\n\t\t\tlabel: 2,\r\n\t\t\tid: 11,\r\n\t\t\tvalue: 3,\r\n\t\t\tchecked: 4,\r\n\t\t\tonkeydown: 12,\r\n\t\t\tonclick: 13,\r\n\t\t\thidden: 5,\r\n\t\t\tdisabled: 6\r\n\t\t});\r\n\t}\r\n}\r\n\r\nvar flattenOptions = (options = []) => options.reduce((prev, current) => {\r\n    const isGroup = isArray(current) ? isArray(current[1]) : !!current.options;\r\n    if (isGroup) {\r\n        return prev.concat(isArray(current) ? current[1] : current.options);\r\n    }\r\n    prev.push(current);\r\n    return prev;\r\n}, []);\r\n\r\nconst mapOption = (option, index, optionMapper) => {\r\n    let mappedOption;\r\n    if (isArray(option)) {\r\n        mappedOption = {\r\n            id: index,\r\n            value: option[0],\r\n            label: option[1],\r\n            ...(option[2] || {}),\r\n        };\r\n    }\r\n    else {\r\n        mappedOption = option;\r\n        mappedOption.id = mappedOption.id != null ? mappedOption.id : index;\r\n    }\r\n    return optionMapper ? optionMapper(mappedOption) : mappedOption;\r\n};\r\nvar mapOptions = (options = [], optionMapper) => {\r\n    let index = 0;\r\n    return options.map((option) => {\r\n        index++;\r\n        if (isArray(option)) {\r\n            // is either [label, options] or [value, label]\r\n            if (isArray(option[1])) {\r\n                return {\r\n                    id: index,\r\n                    label: option[0],\r\n                    options: option[1].map((option) => mapOption(option, ++index, optionMapper)),\r\n                };\r\n            }\r\n            return mapOption(option, index, optionMapper);\r\n        }\r\n        else {\r\n            // is either { id?, label, options } or { id?, value, label }\r\n            if (option.options) {\r\n                return {\r\n                    id: option.id || index,\r\n                    label: option.label,\r\n                    options: option.options.map((option) => mapOption(option, ++index, optionMapper)),\r\n                };\r\n            }\r\n            return mapOption(option, index, optionMapper);\r\n        }\r\n    });\r\n};\r\n\r\nvar opop = (fn, ...args) => fn && fn(...args);\r\n\r\nvar localize = (prop, locale, params) => isFunction(prop) ? prop(locale, params) : prop;\r\n\r\nconst localizeOptions = (options, locale) => options.map(([value, label, props]) => {\r\n    if (isArray(label)) {\r\n        return [localize(value, locale), localizeOptions(label, locale)];\r\n    }\r\n    else {\r\n        const res = [value, localize(label, locale)];\r\n        if (props) {\r\n            let obj = { ...props };\r\n            if (props.icon)\r\n                obj.icon = localize(props.icon, locale);\r\n            res.push(obj);\r\n        }\r\n        return res;\r\n    }\r\n});\r\nvar localizeOptions$1 = (options, locale) => localizeOptions(options, locale);\r\n\r\nvar isConfirmKey = (key) => /enter| /i.test(key);\r\n\r\nvar isDeepEqual = (a, b) => {\r\n    if (Array.isArray(a) && Array.isArray(b))\r\n        return arrayEqual(a, b);\r\n    return a === b;\r\n};\r\n\r\n/* src/core/ui/components/RadioGroup.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction get_each_context$7(ctx, list, i) {\r\n\tconst child_ctx = ctx.slice();\r\n\tchild_ctx[27] = list[i];\r\n\treturn child_ctx;\r\n}\r\n\r\nconst get_option_slot_changes_1 = dirty => ({\r\n\toption: dirty[0] & /*mappedOptions*/ 1024\r\n});\r\n\r\nconst get_option_slot_context_1 = ctx => ({ option: /*option*/ ctx[27] });\r\n\r\nfunction get_each_context_1(ctx, list, i) {\r\n\tconst child_ctx = ctx.slice();\r\n\tchild_ctx[27] = list[i];\r\n\treturn child_ctx;\r\n}\r\n\r\nconst get_option_slot_changes = dirty => ({\r\n\toption: dirty[0] & /*mappedOptions*/ 1024\r\n});\r\n\r\nconst get_option_slot_context = ctx => ({ option: /*option*/ ctx[27] });\r\n\r\nconst get_group_slot_changes = dirty => ({\r\n\toption: dirty[0] & /*mappedOptions*/ 1024\r\n});\r\n\r\nconst get_group_slot_context = ctx => ({ option: /*option*/ ctx[27] });\r\n\r\n// (78:0) {#if localizedOptions.length}\r\nfunction create_if_block_1$a(ctx) {\r\n\tlet fieldset;\r\n\tlet t;\r\n\tlet ul;\r\n\tlet each_blocks = [];\r\n\tlet each_1_lookup = new Map();\r\n\tlet fieldset_class_value;\r\n\tlet current;\r\n\tlet if_block = /*label*/ ctx[1] && create_if_block_7$1(ctx);\r\n\tlet each_value = /*mappedOptions*/ ctx[10];\r\n\tconst get_key = ctx => /*option*/ ctx[27].id;\r\n\r\n\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\tlet child_ctx = get_each_context$7(ctx, each_value, i);\r\n\t\tlet key = get_key(child_ctx);\r\n\t\teach_1_lookup.set(key, each_blocks[i] = create_each_block$7(key, child_ctx));\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tfieldset = element(\"fieldset\");\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tt = space();\r\n\t\t\tul = element(\"ul\");\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].c();\r\n\t\t\t}\r\n\r\n\t\t\tattr(ul, \"class\", \"PinturaRadioGroupOptions\");\r\n\t\t\tattr(fieldset, \"class\", fieldset_class_value = arrayJoin(['PinturaRadioGroup', /*klass*/ ctx[3]]));\r\n\t\t\tattr(fieldset, \"data-layout\", /*layout*/ ctx[5]);\r\n\t\t\tattr(fieldset, \"title\", /*title*/ ctx[7]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, fieldset, anchor);\r\n\t\t\tif (if_block) if_block.m(fieldset, null);\r\n\t\t\tappend(fieldset, t);\r\n\t\t\tappend(fieldset, ul);\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].m(ul, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (/*label*/ ctx[1]) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block_7$1(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\tif_block.m(fieldset, t);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tif_block.d(1);\r\n\t\t\t\tif_block = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty[0] & /*optionGroupClass, mappedOptions, name, optionClass, getOptionIndex, selectedIndex, handleRadioKeydown, handleRadioClick, optionLabelClass, $$scope*/ 8419153) {\r\n\t\t\t\teach_value = /*mappedOptions*/ ctx[10];\r\n\t\t\t\tgroup_outros();\r\n\t\t\t\teach_blocks = update_keyed_each(each_blocks, dirty, get_key, 1, ctx, each_value, each_1_lookup, ul, outro_and_destroy_block, create_each_block$7, null, get_each_context$7);\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*klass*/ 8 && fieldset_class_value !== (fieldset_class_value = arrayJoin(['PinturaRadioGroup', /*klass*/ ctx[3]]))) {\r\n\t\t\t\tattr(fieldset, \"class\", fieldset_class_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*layout*/ 32) {\r\n\t\t\t\tattr(fieldset, \"data-layout\", /*layout*/ ctx[5]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*title*/ 128) {\r\n\t\t\t\tattr(fieldset, \"title\", /*title*/ ctx[7]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\r\n\t\t\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\t\t\ttransition_in(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\ttransition_out(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(fieldset);\r\n\t\t\tif (if_block) if_block.d();\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].d();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (80:8) {#if label}\r\nfunction create_if_block_7$1(ctx) {\r\n\tlet legend;\r\n\tlet t;\r\n\tlet legend_class_value;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tlegend = element(\"legend\");\r\n\t\t\tt = text(/*label*/ ctx[1]);\r\n\t\t\tattr(legend, \"class\", legend_class_value = /*hideLabel*/ ctx[2] && 'implicit');\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, legend, anchor);\r\n\t\t\tappend(legend, t);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[0] & /*label*/ 2) set_data(t, /*label*/ ctx[1]);\r\n\r\n\t\t\tif (dirty[0] & /*hideLabel*/ 4 && legend_class_value !== (legend_class_value = /*hideLabel*/ ctx[2] && 'implicit')) {\r\n\t\t\t\tattr(legend, \"class\", legend_class_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(legend);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (116:16) {:else}\r\nfunction create_else_block$4(ctx) {\r\n\tlet radioitem;\r\n\tlet current;\r\n\r\n\tradioitem = new RadioItem({\r\n\t\t\tprops: {\r\n\t\t\t\tname: /*name*/ ctx[4],\r\n\t\t\t\tlabel: /*option*/ ctx[27].label,\r\n\t\t\t\tid: /*option*/ ctx[27].id,\r\n\t\t\t\tvalue: /*option*/ ctx[27].value,\r\n\t\t\t\tdisabled: /*option*/ ctx[27].disabled,\r\n\t\t\t\thidden: /*option*/ ctx[27].hidden,\r\n\t\t\t\tclass: /*optionClass*/ ctx[8],\r\n\t\t\t\tchecked: /*getOptionIndex*/ ctx[12](/*option*/ ctx[27]) === /*selectedIndex*/ ctx[0],\r\n\t\t\t\tonkeydown: /*handleRadioKeydown*/ ctx[13](/*option*/ ctx[27]),\r\n\t\t\t\tonclick: /*handleRadioClick*/ ctx[14](/*option*/ ctx[27]),\r\n\t\t\t\t$$slots: { default: [create_default_slot_2$4] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(radioitem.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(radioitem, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst radioitem_changes = {};\r\n\t\t\tif (dirty[0] & /*name*/ 16) radioitem_changes.name = /*name*/ ctx[4];\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024) radioitem_changes.label = /*option*/ ctx[27].label;\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024) radioitem_changes.id = /*option*/ ctx[27].id;\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024) radioitem_changes.value = /*option*/ ctx[27].value;\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024) radioitem_changes.disabled = /*option*/ ctx[27].disabled;\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024) radioitem_changes.hidden = /*option*/ ctx[27].hidden;\r\n\t\t\tif (dirty[0] & /*optionClass*/ 256) radioitem_changes.class = /*optionClass*/ ctx[8];\r\n\t\t\tif (dirty[0] & /*mappedOptions, selectedIndex*/ 1025) radioitem_changes.checked = /*getOptionIndex*/ ctx[12](/*option*/ ctx[27]) === /*selectedIndex*/ ctx[0];\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024) radioitem_changes.onkeydown = /*handleRadioKeydown*/ ctx[13](/*option*/ ctx[27]);\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024) radioitem_changes.onclick = /*handleRadioClick*/ ctx[14](/*option*/ ctx[27]);\r\n\r\n\t\t\tif (dirty[0] & /*$$scope, optionLabelClass, mappedOptions*/ 8389696) {\r\n\t\t\t\tradioitem_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tradioitem.$set(radioitem_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(radioitem.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(radioitem.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(radioitem, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (85:16) {#if option.options}\r\nfunction create_if_block_2$9(ctx) {\r\n\tlet li;\r\n\tlet t0;\r\n\tlet ul;\r\n\tlet each_blocks = [];\r\n\tlet each_1_lookup = new Map();\r\n\tlet t1;\r\n\tlet li_class_value;\r\n\tlet current;\r\n\tconst group_slot_template = /*#slots*/ ctx[22].group;\r\n\tconst group_slot = create_slot(group_slot_template, ctx, /*$$scope*/ ctx[23], get_group_slot_context);\r\n\tconst group_slot_or_fallback = group_slot || fallback_block_1(ctx);\r\n\tlet each_value_1 = /*option*/ ctx[27].options;\r\n\tconst get_key = ctx => /*option*/ ctx[27].id;\r\n\r\n\tfor (let i = 0; i < each_value_1.length; i += 1) {\r\n\t\tlet child_ctx = get_each_context_1(ctx, each_value_1, i);\r\n\t\tlet key = get_key(child_ctx);\r\n\t\teach_1_lookup.set(key, each_blocks[i] = create_each_block_1(key, child_ctx));\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tli = element(\"li\");\r\n\t\t\tif (group_slot_or_fallback) group_slot_or_fallback.c();\r\n\t\t\tt0 = space();\r\n\t\t\tul = element(\"ul\");\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].c();\r\n\t\t\t}\r\n\r\n\t\t\tt1 = space();\r\n\t\t\tattr(ul, \"class\", \"PinturaRadioGroupOptions\");\r\n\t\t\tattr(li, \"class\", li_class_value = arrayJoin(['PinturaRadioGroupOptionGroup', /*optionGroupClass*/ ctx[9]]));\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, li, anchor);\r\n\r\n\t\t\tif (group_slot_or_fallback) {\r\n\t\t\t\tgroup_slot_or_fallback.m(li, null);\r\n\t\t\t}\r\n\r\n\t\t\tappend(li, t0);\r\n\t\t\tappend(li, ul);\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].m(ul, null);\r\n\t\t\t}\r\n\r\n\t\t\tappend(li, t1);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (group_slot) {\r\n\t\t\t\tif (group_slot.p && (!current || dirty[0] & /*$$scope, mappedOptions*/ 8389632)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tgroup_slot,\r\n\t\t\t\t\t\tgroup_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[23],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[23])\r\n\t\t\t\t\t\t: get_slot_changes(group_slot_template, /*$$scope*/ ctx[23], dirty, get_group_slot_changes),\r\n\t\t\t\t\t\tget_group_slot_context\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (group_slot_or_fallback && group_slot_or_fallback.p && (!current || dirty[0] & /*mappedOptions*/ 1024)) {\r\n\t\t\t\t\tgroup_slot_or_fallback.p(ctx, !current ? [-1, -1] : dirty);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty[0] & /*name, mappedOptions, optionClass, getOptionIndex, selectedIndex, handleRadioKeydown, handleRadioClick, optionLabelClass, $$scope*/ 8418641) {\r\n\t\t\t\teach_value_1 = /*option*/ ctx[27].options;\r\n\t\t\t\tgroup_outros();\r\n\t\t\t\teach_blocks = update_keyed_each(each_blocks, dirty, get_key, 1, ctx, each_value_1, each_1_lookup, ul, outro_and_destroy_block, create_each_block_1, null, get_each_context_1);\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*optionGroupClass*/ 512 && li_class_value !== (li_class_value = arrayJoin(['PinturaRadioGroupOptionGroup', /*optionGroupClass*/ ctx[9]]))) {\r\n\t\t\t\tattr(li, \"class\", li_class_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(group_slot_or_fallback, local);\r\n\r\n\t\t\tfor (let i = 0; i < each_value_1.length; i += 1) {\r\n\t\t\t\ttransition_in(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(group_slot_or_fallback, local);\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\ttransition_out(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(li);\r\n\t\t\tif (group_slot_or_fallback) group_slot_or_fallback.d(detaching);\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].d();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (129:28) {#if option.icon}\r\nfunction create_if_block_6$2(ctx) {\r\n\tlet icon;\r\n\tlet current;\r\n\r\n\ticon = new Icon({\r\n\t\t\tprops: {\r\n\t\t\t\t$$slots: { default: [create_default_slot_3$2] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(icon.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(icon, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst icon_changes = {};\r\n\r\n\t\t\tif (dirty[0] & /*$$scope, mappedOptions*/ 8389632) {\r\n\t\t\t\ticon_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ticon.$set(icon_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(icon.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(icon.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(icon, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (130:32) <Icon>\r\nfunction create_default_slot_3$2(ctx) {\r\n\tlet g;\r\n\tlet raw_value = /*option*/ ctx[27].icon + \"\";\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tg = svg_element(\"g\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, g, anchor);\r\n\t\t\tg.innerHTML = raw_value;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024 && raw_value !== (raw_value = /*option*/ ctx[27].icon + \"\")) g.innerHTML = raw_value;\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(g);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (132:28) {#if !option.hideLabel}\r\nfunction create_if_block_5$4(ctx) {\r\n\tlet span;\r\n\tlet t_value = /*option*/ ctx[27].label + \"\";\r\n\tlet t;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt = text(t_value);\r\n\t\t\tattr(span, \"class\", /*optionLabelClass*/ ctx[6]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t\tappend(span, t);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024 && t_value !== (t_value = /*option*/ ctx[27].label + \"\")) set_data(t, t_value);\r\n\r\n\t\t\tif (dirty[0] & /*optionLabelClass*/ 64) {\r\n\t\t\t\tattr(span, \"class\", /*optionLabelClass*/ ctx[6]);\r\n\t\t\t}\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (128:54)                              \r\nfunction fallback_block_2(ctx) {\r\n\tlet t0;\r\n\tlet t1;\r\n\tlet current;\r\n\tlet if_block0 = /*option*/ ctx[27].icon && create_if_block_6$2(ctx);\r\n\tlet if_block1 = !/*option*/ ctx[27].hideLabel && create_if_block_5$4(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (if_block0) if_block0.c();\r\n\t\t\tt0 = space();\r\n\t\t\tif (if_block1) if_block1.c();\r\n\t\t\tt1 = space();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (if_block0) if_block0.m(target, anchor);\r\n\t\t\tinsert(target, t0, anchor);\r\n\t\t\tif (if_block1) if_block1.m(target, anchor);\r\n\t\t\tinsert(target, t1, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (/*option*/ ctx[27].icon) {\r\n\t\t\t\tif (if_block0) {\r\n\t\t\t\t\tif_block0.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[0] & /*mappedOptions*/ 1024) {\r\n\t\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block0 = create_if_block_6$2(ctx);\r\n\t\t\t\t\tif_block0.c();\r\n\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\tif_block0.m(t0.parentNode, t0);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block0) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block0, 1, 1, () => {\r\n\t\t\t\t\tif_block0 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (!/*option*/ ctx[27].hideLabel) {\r\n\t\t\t\tif (if_block1) {\r\n\t\t\t\t\tif_block1.p(ctx, dirty);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block1 = create_if_block_5$4(ctx);\r\n\t\t\t\t\tif_block1.c();\r\n\t\t\t\t\tif_block1.m(t1.parentNode, t1);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block1) {\r\n\t\t\t\tif_block1.d(1);\r\n\t\t\t\tif_block1 = null;\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block0);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block0);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (if_block0) if_block0.d(detaching);\r\n\t\t\tif (detaching) detach(t0);\r\n\t\t\tif (if_block1) if_block1.d(detaching);\r\n\t\t\tif (detaching) detach(t1);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (117:20) <RadioItem                         {name}                         label={option.label}                         id={option.id}                         value={option.value}                         disabled={option.disabled}                         hidden={option.hidden}                         class={optionClass}                         checked={getOptionIndex(option) === selectedIndex}                         onkeydown={handleRadioKeydown(option)}                         onclick={handleRadioClick(option)}                         >\r\nfunction create_default_slot_2$4(ctx) {\r\n\tlet current;\r\n\tconst option_slot_template = /*#slots*/ ctx[22].option;\r\n\tconst option_slot = create_slot(option_slot_template, ctx, /*$$scope*/ ctx[23], get_option_slot_context_1);\r\n\tconst option_slot_or_fallback = option_slot || fallback_block_2(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (option_slot_or_fallback) option_slot_or_fallback.c();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (option_slot_or_fallback) {\r\n\t\t\t\toption_slot_or_fallback.m(target, anchor);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (option_slot) {\r\n\t\t\t\tif (option_slot.p && (!current || dirty[0] & /*$$scope, mappedOptions*/ 8389632)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\toption_slot,\r\n\t\t\t\t\t\toption_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[23],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[23])\r\n\t\t\t\t\t\t: get_slot_changes(option_slot_template, /*$$scope*/ ctx[23], dirty, get_option_slot_changes_1),\r\n\t\t\t\t\t\tget_option_slot_context_1\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (option_slot_or_fallback && option_slot_or_fallback.p && (!current || dirty[0] & /*optionLabelClass, mappedOptions*/ 1088)) {\r\n\t\t\t\t\toption_slot_or_fallback.p(ctx, !current ? [-1, -1] : dirty);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(option_slot_or_fallback, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(option_slot_or_fallback, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (option_slot_or_fallback) option_slot_or_fallback.d(detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (88:29) <span class=\"PinturaRadioGroupOptionGroupLabel\">\r\nfunction fallback_block_1(ctx) {\r\n\tlet span;\r\n\tlet t_value = /*option*/ ctx[27].label + \"\";\r\n\tlet t;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt = text(t_value);\r\n\t\t\tattr(span, \"class\", \"PinturaRadioGroupOptionGroupLabel\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t\tappend(span, t);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024 && t_value !== (t_value = /*option*/ ctx[27].label + \"\")) set_data(t, t_value);\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (105:40) {#if option.icon}\r\nfunction create_if_block_4$6(ctx) {\r\n\tlet icon;\r\n\tlet current;\r\n\r\n\ticon = new Icon({\r\n\t\t\tprops: {\r\n\t\t\t\t$$slots: { default: [create_default_slot_1$6] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(icon.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(icon, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst icon_changes = {};\r\n\r\n\t\t\tif (dirty[0] & /*$$scope, mappedOptions*/ 8389632) {\r\n\t\t\t\ticon_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ticon.$set(icon_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(icon.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(icon.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(icon, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (106:44) <Icon>\r\nfunction create_default_slot_1$6(ctx) {\r\n\tlet g;\r\n\tlet raw_value = /*option*/ ctx[27].icon + \"\";\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tg = svg_element(\"g\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, g, anchor);\r\n\t\t\tg.innerHTML = raw_value;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024 && raw_value !== (raw_value = /*option*/ ctx[27].icon + \"\")) g.innerHTML = raw_value;\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(g);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (108:40) {#if !option.hideLabel}\r\nfunction create_if_block_3$7(ctx) {\r\n\tlet span;\r\n\tlet t_value = /*option*/ ctx[27].label + \"\";\r\n\tlet t;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt = text(t_value);\r\n\t\t\tattr(span, \"class\", /*optionLabelClass*/ ctx[6]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t\tappend(span, t);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024 && t_value !== (t_value = /*option*/ ctx[27].label + \"\")) set_data(t, t_value);\r\n\r\n\t\t\tif (dirty[0] & /*optionLabelClass*/ 64) {\r\n\t\t\t\tattr(span, \"class\", /*optionLabelClass*/ ctx[6]);\r\n\t\t\t}\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (104:66)                                          \r\nfunction fallback_block$1(ctx) {\r\n\tlet t0;\r\n\tlet t1;\r\n\tlet current;\r\n\tlet if_block0 = /*option*/ ctx[27].icon && create_if_block_4$6(ctx);\r\n\tlet if_block1 = !/*option*/ ctx[27].hideLabel && create_if_block_3$7(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (if_block0) if_block0.c();\r\n\t\t\tt0 = space();\r\n\t\t\tif (if_block1) if_block1.c();\r\n\t\t\tt1 = space();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (if_block0) if_block0.m(target, anchor);\r\n\t\t\tinsert(target, t0, anchor);\r\n\t\t\tif (if_block1) if_block1.m(target, anchor);\r\n\t\t\tinsert(target, t1, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (/*option*/ ctx[27].icon) {\r\n\t\t\t\tif (if_block0) {\r\n\t\t\t\t\tif_block0.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[0] & /*mappedOptions*/ 1024) {\r\n\t\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block0 = create_if_block_4$6(ctx);\r\n\t\t\t\t\tif_block0.c();\r\n\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\tif_block0.m(t0.parentNode, t0);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block0) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block0, 1, 1, () => {\r\n\t\t\t\t\tif_block0 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (!/*option*/ ctx[27].hideLabel) {\r\n\t\t\t\tif (if_block1) {\r\n\t\t\t\t\tif_block1.p(ctx, dirty);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block1 = create_if_block_3$7(ctx);\r\n\t\t\t\t\tif_block1.c();\r\n\t\t\t\t\tif_block1.m(t1.parentNode, t1);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block1) {\r\n\t\t\t\tif_block1.d(1);\r\n\t\t\t\tif_block1 = null;\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block0);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block0);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (if_block0) if_block0.d(detaching);\r\n\t\t\tif (detaching) detach(t0);\r\n\t\t\tif (if_block1) if_block1.d(detaching);\r\n\t\t\tif (detaching) detach(t1);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (93:32) <RadioItem                                     {name}                                     label={option.label}                                     id={option.id}                                     value={option.value}                                     disabled={option.disabled}                                     hidden={option.hidden}                                     class={optionClass}                                     checked={getOptionIndex(option) === selectedIndex}                                     onkeydown={handleRadioKeydown(option)}                                     onclick={handleRadioClick(option)}                                     >\r\nfunction create_default_slot$e(ctx) {\r\n\tlet current;\r\n\tconst option_slot_template = /*#slots*/ ctx[22].option;\r\n\tconst option_slot = create_slot(option_slot_template, ctx, /*$$scope*/ ctx[23], get_option_slot_context);\r\n\tconst option_slot_or_fallback = option_slot || fallback_block$1(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (option_slot_or_fallback) option_slot_or_fallback.c();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (option_slot_or_fallback) {\r\n\t\t\t\toption_slot_or_fallback.m(target, anchor);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (option_slot) {\r\n\t\t\t\tif (option_slot.p && (!current || dirty[0] & /*$$scope, mappedOptions*/ 8389632)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\toption_slot,\r\n\t\t\t\t\t\toption_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[23],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[23])\r\n\t\t\t\t\t\t: get_slot_changes(option_slot_template, /*$$scope*/ ctx[23], dirty, get_option_slot_changes),\r\n\t\t\t\t\t\tget_option_slot_context\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (option_slot_or_fallback && option_slot_or_fallback.p && (!current || dirty[0] & /*optionLabelClass, mappedOptions*/ 1088)) {\r\n\t\t\t\t\toption_slot_or_fallback.p(ctx, !current ? [-1, -1] : dirty);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(option_slot_or_fallback, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(option_slot_or_fallback, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (option_slot_or_fallback) option_slot_or_fallback.d(detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (92:28) {#each option.options as option (option.id)}\r\nfunction create_each_block_1(key_1, ctx) {\r\n\tlet first;\r\n\tlet radioitem;\r\n\tlet current;\r\n\r\n\tradioitem = new RadioItem({\r\n\t\t\tprops: {\r\n\t\t\t\tname: /*name*/ ctx[4],\r\n\t\t\t\tlabel: /*option*/ ctx[27].label,\r\n\t\t\t\tid: /*option*/ ctx[27].id,\r\n\t\t\t\tvalue: /*option*/ ctx[27].value,\r\n\t\t\t\tdisabled: /*option*/ ctx[27].disabled,\r\n\t\t\t\thidden: /*option*/ ctx[27].hidden,\r\n\t\t\t\tclass: /*optionClass*/ ctx[8],\r\n\t\t\t\tchecked: /*getOptionIndex*/ ctx[12](/*option*/ ctx[27]) === /*selectedIndex*/ ctx[0],\r\n\t\t\t\tonkeydown: /*handleRadioKeydown*/ ctx[13](/*option*/ ctx[27]),\r\n\t\t\t\tonclick: /*handleRadioClick*/ ctx[14](/*option*/ ctx[27]),\r\n\t\t\t\t$$slots: { default: [create_default_slot$e] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tkey: key_1,\r\n\t\tfirst: null,\r\n\t\tc() {\r\n\t\t\tfirst = empty();\r\n\t\t\tcreate_component(radioitem.$$.fragment);\r\n\t\t\tthis.first = first;\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, first, anchor);\r\n\t\t\tmount_component(radioitem, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\t\t\tconst radioitem_changes = {};\r\n\t\t\tif (dirty[0] & /*name*/ 16) radioitem_changes.name = /*name*/ ctx[4];\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024) radioitem_changes.label = /*option*/ ctx[27].label;\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024) radioitem_changes.id = /*option*/ ctx[27].id;\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024) radioitem_changes.value = /*option*/ ctx[27].value;\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024) radioitem_changes.disabled = /*option*/ ctx[27].disabled;\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024) radioitem_changes.hidden = /*option*/ ctx[27].hidden;\r\n\t\t\tif (dirty[0] & /*optionClass*/ 256) radioitem_changes.class = /*optionClass*/ ctx[8];\r\n\t\t\tif (dirty[0] & /*mappedOptions, selectedIndex*/ 1025) radioitem_changes.checked = /*getOptionIndex*/ ctx[12](/*option*/ ctx[27]) === /*selectedIndex*/ ctx[0];\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024) radioitem_changes.onkeydown = /*handleRadioKeydown*/ ctx[13](/*option*/ ctx[27]);\r\n\t\t\tif (dirty[0] & /*mappedOptions*/ 1024) radioitem_changes.onclick = /*handleRadioClick*/ ctx[14](/*option*/ ctx[27]);\r\n\r\n\t\t\tif (dirty[0] & /*$$scope, optionLabelClass, mappedOptions*/ 8389696) {\r\n\t\t\t\tradioitem_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tradioitem.$set(radioitem_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(radioitem.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(radioitem.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(first);\r\n\t\t\tdestroy_component(radioitem, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (84:12) {#each mappedOptions as option (option.id)}\r\nfunction create_each_block$7(key_1, ctx) {\r\n\tlet first;\r\n\tlet current_block_type_index;\r\n\tlet if_block;\r\n\tlet if_block_anchor;\r\n\tlet current;\r\n\tconst if_block_creators = [create_if_block_2$9, create_else_block$4];\r\n\tconst if_blocks = [];\r\n\r\n\tfunction select_block_type(ctx, dirty) {\r\n\t\tif (/*option*/ ctx[27].options) return 0;\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tcurrent_block_type_index = select_block_type(ctx);\r\n\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\r\n\treturn {\r\n\t\tkey: key_1,\r\n\t\tfirst: null,\r\n\t\tc() {\r\n\t\t\tfirst = empty();\r\n\t\t\tif_block.c();\r\n\t\t\tif_block_anchor = empty();\r\n\t\t\tthis.first = first;\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, first, anchor);\r\n\t\t\tif_blocks[current_block_type_index].m(target, anchor);\r\n\t\t\tinsert(target, if_block_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\t\t\tlet previous_block_index = current_block_type_index;\r\n\t\t\tcurrent_block_type_index = select_block_type(ctx);\r\n\r\n\t\t\tif (current_block_type_index === previous_block_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].p(ctx, dirty);\r\n\t\t\t} else {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_blocks[previous_block_index], 1, 1, () => {\r\n\t\t\t\t\tif_blocks[previous_block_index] = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t\tif_block = if_blocks[current_block_type_index];\r\n\r\n\t\t\t\tif (!if_block) {\r\n\t\t\t\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\tif_block.m(if_block_anchor.parentNode, if_block_anchor);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(first);\r\n\t\t\tif_blocks[current_block_type_index].d(detaching);\r\n\t\t\tif (detaching) detach(if_block_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$B(ctx) {\r\n\tlet t;\r\n\tlet if_block1_anchor;\r\n\tlet current;\r\n\tlet if_block0 = /*localizedOptions*/ ctx[11].length && create_if_block_1$a(ctx);\r\n\tlet if_block1 = false ;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (if_block0) if_block0.c();\r\n\t\t\tt = space();\r\n\t\t\tif_block1_anchor = empty();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (if_block0) if_block0.m(target, anchor);\r\n\t\t\tinsert(target, t, anchor);\r\n\t\t\tinsert(target, if_block1_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (/*localizedOptions*/ ctx[11].length) {\r\n\t\t\t\tif (if_block0) {\r\n\t\t\t\t\tif_block0.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[0] & /*localizedOptions*/ 2048) {\r\n\t\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block0 = create_if_block_1$a(ctx);\r\n\t\t\t\t\tif_block0.c();\r\n\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\tif_block0.m(t.parentNode, t);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block0) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block0, 1, 1, () => {\r\n\t\t\t\t\tif_block0 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block0);\r\n\t\t\ttransition_in(if_block1);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block0);\r\n\t\t\ttransition_out(if_block1);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (if_block0) if_block0.d(detaching);\r\n\t\t\tif (detaching) detach(t);\r\n\t\t\tif (detaching) detach(if_block1_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$C($$self, $$props, $$invalidate) {\r\n\tlet localizedOptions;\r\n\tlet mappedOptions;\r\n\tlet flattenedOptions;\r\n\tlet { $$slots: slots = {}, $$scope } = $$props;\r\n\tconst dispatch = createEventDispatcher();\r\n\tlet { label = undefined } = $$props;\r\n\tlet { hideLabel = true } = $$props;\r\n\tlet { class: klass = undefined } = $$props;\r\n\tlet { name = `radio-group-${getUniqueId()}` } = $$props;\r\n\tlet { selectedIndex = -1 } = $$props;\r\n\tlet { options = [] } = $$props;\r\n\tlet { onchange = undefined } = $$props;\r\n\tlet { layout = undefined } = $$props;\r\n\tlet { optionMapper = undefined } = $$props;\r\n\tlet { optionFilter = undefined } = $$props;\r\n\tlet { value = undefined } = $$props;\r\n\tlet { optionLabelClass = undefined } = $$props;\r\n\tlet { title = undefined } = $$props;\r\n\tlet { locale = undefined } = $$props;\r\n\tlet { optionClass = undefined } = $$props;\r\n\tlet { optionGroupClass = undefined } = $$props;\r\n\tconst getUndefinedOptionIndex = options => options.findIndex(option => option[0] === undefined);\r\n\tconst getOptionIndex = option => flattenedOptions.findIndex(flattenedOption => flattenedOption.id === option.id);\r\n\r\n\tconst changeSelection = (option, e) => {\r\n\t\t$$invalidate(0, selectedIndex = getOptionIndex(option));\r\n\t\tconst payload = { index: selectedIndex, ...option };\r\n\t\topop(onchange, payload, e);\r\n\t\tdispatch('change', payload);\r\n\t};\r\n\r\n\tconst handleRadioKeydown = option => e => {\r\n\t\t// is confirm key ([enter] or [space])\r\n\t\tif (!isConfirmKey(e.key)) return;\r\n\r\n\t\tchangeSelection(option, e);\r\n\t};\r\n\r\n\tconst handleRadioClick = option => e => {\r\n\t\tchangeSelection(option, e);\r\n\t};\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('label' in $$props) $$invalidate(1, label = $$props.label);\r\n\t\tif ('hideLabel' in $$props) $$invalidate(2, hideLabel = $$props.hideLabel);\r\n\t\tif ('class' in $$props) $$invalidate(3, klass = $$props.class);\r\n\t\tif ('name' in $$props) $$invalidate(4, name = $$props.name);\r\n\t\tif ('selectedIndex' in $$props) $$invalidate(0, selectedIndex = $$props.selectedIndex);\r\n\t\tif ('options' in $$props) $$invalidate(15, options = $$props.options);\r\n\t\tif ('onchange' in $$props) $$invalidate(16, onchange = $$props.onchange);\r\n\t\tif ('layout' in $$props) $$invalidate(5, layout = $$props.layout);\r\n\t\tif ('optionMapper' in $$props) $$invalidate(17, optionMapper = $$props.optionMapper);\r\n\t\tif ('optionFilter' in $$props) $$invalidate(18, optionFilter = $$props.optionFilter);\r\n\t\tif ('value' in $$props) $$invalidate(19, value = $$props.value);\r\n\t\tif ('optionLabelClass' in $$props) $$invalidate(6, optionLabelClass = $$props.optionLabelClass);\r\n\t\tif ('title' in $$props) $$invalidate(7, title = $$props.title);\r\n\t\tif ('locale' in $$props) $$invalidate(20, locale = $$props.locale);\r\n\t\tif ('optionClass' in $$props) $$invalidate(8, optionClass = $$props.optionClass);\r\n\t\tif ('optionGroupClass' in $$props) $$invalidate(9, optionGroupClass = $$props.optionGroupClass);\r\n\t\tif ('$$scope' in $$props) $$invalidate(23, $$scope = $$props.$$scope);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*optionFilter, options, locale*/ 1343488) {\r\n\t\t\t$$invalidate(11, localizedOptions = localizeOptions$1(optionFilter ? options.filter(optionFilter) : options, locale));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*localizedOptions, optionMapper*/ 133120) {\r\n\t\t\t$$invalidate(10, mappedOptions = mapOptions(localizedOptions, optionMapper));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*mappedOptions*/ 1024) {\r\n\t\t\t$$invalidate(21, flattenedOptions = flattenOptions(mappedOptions));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*selectedIndex, flattenedOptions, value, options*/ 2654209) {\r\n\t\t\t// can optionally pass value to have radio button group try to auto-select the right option\r\n\t\t\tif (selectedIndex < 0) {\r\n\t\t\t\t$$invalidate(0, selectedIndex = flattenedOptions.findIndex(option => isDeepEqual(option.value, value)));\r\n\r\n\t\t\t\tif (selectedIndex < 0) {\r\n\t\t\t\t\t$$invalidate(0, selectedIndex = getUndefinedOptionIndex(options));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tselectedIndex,\r\n\t\tlabel,\r\n\t\thideLabel,\r\n\t\tklass,\r\n\t\tname,\r\n\t\tlayout,\r\n\t\toptionLabelClass,\r\n\t\ttitle,\r\n\t\toptionClass,\r\n\t\toptionGroupClass,\r\n\t\tmappedOptions,\r\n\t\tlocalizedOptions,\r\n\t\tgetOptionIndex,\r\n\t\thandleRadioKeydown,\r\n\t\thandleRadioClick,\r\n\t\toptions,\r\n\t\tonchange,\r\n\t\toptionMapper,\r\n\t\toptionFilter,\r\n\t\tvalue,\r\n\t\tlocale,\r\n\t\tflattenedOptions,\r\n\t\tslots,\r\n\t\t$$scope\r\n\t];\r\n}\r\n\r\nclass RadioGroup extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$C,\r\n\t\t\tcreate_fragment$B,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tlabel: 1,\r\n\t\t\t\thideLabel: 2,\r\n\t\t\t\tclass: 3,\r\n\t\t\t\tname: 4,\r\n\t\t\t\tselectedIndex: 0,\r\n\t\t\t\toptions: 15,\r\n\t\t\t\tonchange: 16,\r\n\t\t\t\tlayout: 5,\r\n\t\t\t\toptionMapper: 17,\r\n\t\t\t\toptionFilter: 18,\r\n\t\t\t\tvalue: 19,\r\n\t\t\t\toptionLabelClass: 6,\r\n\t\t\t\ttitle: 7,\r\n\t\t\t\tlocale: 20,\r\n\t\t\t\toptionClass: 8,\r\n\t\t\t\toptionGroupClass: 9\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1]\r\n\t\t);\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/Dropdown.svelte generated by Svelte v3.50.1 */\r\nconst get_controls_slot_changes = dirty => ({});\r\nconst get_controls_slot_context = ctx => ({});\r\n\r\n// (97:8) {#if icon}\r\nfunction create_if_block_2$8(ctx) {\r\n\tlet icon_1;\r\n\tlet current;\r\n\r\n\ticon_1 = new Icon({\r\n\t\t\tprops: {\r\n\t\t\t\tclass: \"PinturaButtonIcon\",\r\n\t\t\t\t$$slots: { default: [create_default_slot_1$5] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(icon_1.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(icon_1, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst icon_1_changes = {};\r\n\r\n\t\t\tif (dirty & /*$$scope, icon*/ 268435520) {\r\n\t\t\t\ticon_1_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ticon_1.$set(icon_1_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(icon_1.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(icon_1.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(icon_1, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (98:12) <Icon class=\"PinturaButtonIcon\">\r\nfunction create_default_slot_1$5(ctx) {\r\n\tlet g;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tg = svg_element(\"g\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, g, anchor);\r\n\t\t\tg.innerHTML = /*icon*/ ctx[6];\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty & /*icon*/ 64) g.innerHTML = /*icon*/ ctx[6];\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(g);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (92:4) \r\nfunction create_label_slot$2(ctx) {\r\n\tlet span1;\r\n\tlet t;\r\n\tlet span0;\r\n\tlet raw_value = (/*label*/ ctx[2] || /*selectedLabel*/ ctx[18]) + \"\";\r\n\tlet span0_class_value;\r\n\tlet span1_title_value;\r\n\tlet span1_class_value;\r\n\tlet current;\r\n\tlet if_block = /*icon*/ ctx[6] && create_if_block_2$8(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan1 = element(\"span\");\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tt = space();\r\n\t\t\tspan0 = element(\"span\");\r\n\r\n\t\t\tattr(span0, \"class\", span0_class_value = arrayJoin([\r\n\t\t\t\t'PinturaButtonLabel',\r\n\t\t\t\t/*labelClass*/ ctx[3],\r\n\t\t\t\t/*hideLabel*/ ctx[5] && 'implicit'\r\n\t\t\t]));\r\n\r\n\t\t\tattr(span1, \"slot\", \"label\");\r\n\t\t\tattr(span1, \"title\", span1_title_value = localize(/*title*/ ctx[1], /*locale*/ ctx[15]));\r\n\t\t\tattr(span1, \"class\", span1_class_value = arrayJoin(['PinturaButtonInner', /*innerClass*/ ctx[4]]));\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span1, anchor);\r\n\t\t\tif (if_block) if_block.m(span1, null);\r\n\t\t\tappend(span1, t);\r\n\t\t\tappend(span1, span0);\r\n\t\t\tspan0.innerHTML = raw_value;\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (/*icon*/ ctx[6]) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty & /*icon*/ 64) {\r\n\t\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block_2$8(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(span1, t);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block, 1, 1, () => {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif ((!current || dirty & /*label, selectedLabel*/ 262148) && raw_value !== (raw_value = (/*label*/ ctx[2] || /*selectedLabel*/ ctx[18]) + \"\")) span0.innerHTML = raw_value;\r\n\t\t\tif (!current || dirty & /*labelClass, hideLabel*/ 40 && span0_class_value !== (span0_class_value = arrayJoin([\r\n\t\t\t\t'PinturaButtonLabel',\r\n\t\t\t\t/*labelClass*/ ctx[3],\r\n\t\t\t\t/*hideLabel*/ ctx[5] && 'implicit'\r\n\t\t\t]))) {\r\n\t\t\t\tattr(span0, \"class\", span0_class_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*title, locale*/ 32770 && span1_title_value !== (span1_title_value = localize(/*title*/ ctx[1], /*locale*/ ctx[15]))) {\r\n\t\t\t\tattr(span1, \"title\", span1_title_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*innerClass*/ 16 && span1_class_value !== (span1_class_value = arrayJoin(['PinturaButtonInner', /*innerClass*/ ctx[4]]))) {\r\n\t\t\t\tattr(span1, \"class\", span1_class_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span1);\r\n\t\t\tif (if_block) if_block.d();\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (121:12) \r\nfunction create_group_slot$1(ctx) {\r\n\tlet span;\r\n\tlet t_value = /*option*/ ctx[30].label + \"\";\r\n\tlet t;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt = text(t_value);\r\n\t\t\tattr(span, \"slot\", \"group\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t\tappend(span, t);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty & /*option*/ 1073741824 && t_value !== (t_value = /*option*/ ctx[30].label + \"\")) set_data(t, t_value);\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (123:16) {#if option.icon}\r\nfunction create_if_block_1$9(ctx) {\r\n\tlet icon_1;\r\n\tlet current;\r\n\r\n\ticon_1 = new Icon({\r\n\t\t\tprops: {\r\n\t\t\t\tstyle: isFunction(/*optionIconStyle*/ ctx[13])\r\n\t\t\t\t? /*optionIconStyle*/ ctx[13](/*option*/ ctx[30].value)\r\n\t\t\t\t: /*optionIconStyle*/ ctx[13],\r\n\t\t\t\t$$slots: { default: [create_default_slot$d] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(icon_1.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(icon_1, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst icon_1_changes = {};\r\n\r\n\t\t\tif (dirty & /*optionIconStyle, option*/ 1073750016) icon_1_changes.style = isFunction(/*optionIconStyle*/ ctx[13])\r\n\t\t\t? /*optionIconStyle*/ ctx[13](/*option*/ ctx[30].value)\r\n\t\t\t: /*optionIconStyle*/ ctx[13];\r\n\r\n\t\t\tif (dirty & /*$$scope, option*/ 1342177280) {\r\n\t\t\t\ticon_1_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ticon_1.$set(icon_1_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(icon_1.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(icon_1.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(icon_1, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (124:20) <Icon                         style={isFunction(optionIconStyle)                             ? optionIconStyle(option.value)                             : optionIconStyle}>\r\nfunction create_default_slot$d(ctx) {\r\n\tlet g;\r\n\tlet raw_value = /*option*/ ctx[30].icon + \"\";\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tg = svg_element(\"g\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, g, anchor);\r\n\t\t\tg.innerHTML = raw_value;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty & /*option*/ 1073741824 && raw_value !== (raw_value = /*option*/ ctx[30].icon + \"\")) g.innerHTML = raw_value;\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(g);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (137:20) {#if option.sublabel}\r\nfunction create_if_block$a(ctx) {\r\n\tlet span;\r\n\tlet raw_value = /*option*/ ctx[30].sublabel + \"\";\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tattr(span, \"class\", \"PinturaDropdownOptionSublabel\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t\tspan.innerHTML = raw_value;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty & /*option*/ 1073741824 && raw_value !== (raw_value = /*option*/ ctx[30].sublabel + \"\")) span.innerHTML = raw_value;\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (122:12) \r\nfunction create_option_slot$4(ctx) {\r\n\tlet span1;\r\n\tlet t0;\r\n\tlet span0;\r\n\tlet html_tag;\r\n\tlet raw_value = /*option*/ ctx[30].label + \"\";\r\n\tlet t1;\r\n\tlet span0_style_value;\r\n\tlet span0_class_value;\r\n\tlet current;\r\n\tlet if_block0 = /*option*/ ctx[30].icon && create_if_block_1$9(ctx);\r\n\tlet if_block1 = /*option*/ ctx[30].sublabel && create_if_block$a(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan1 = element(\"span\");\r\n\t\t\tif (if_block0) if_block0.c();\r\n\t\t\tt0 = space();\r\n\t\t\tspan0 = element(\"span\");\r\n\t\t\thtml_tag = new HtmlTag(false);\r\n\t\t\tt1 = space();\r\n\t\t\tif (if_block1) if_block1.c();\r\n\t\t\thtml_tag.a = t1;\r\n\r\n\t\t\tattr(span0, \"style\", span0_style_value = isFunction(/*optionLabelStyle*/ ctx[14])\r\n\t\t\t? /*optionLabelStyle*/ ctx[14](/*option*/ ctx[30].value)\r\n\t\t\t: /*optionLabelStyle*/ ctx[14]);\r\n\r\n\t\t\tattr(span0, \"class\", span0_class_value = arrayJoin(['PinturaDropdownOptionLabel', /*optionLabelClass*/ ctx[10]]));\r\n\t\t\tattr(span1, \"slot\", \"option\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span1, anchor);\r\n\t\t\tif (if_block0) if_block0.m(span1, null);\r\n\t\t\tappend(span1, t0);\r\n\t\t\tappend(span1, span0);\r\n\t\t\thtml_tag.m(raw_value, span0);\r\n\t\t\tappend(span0, t1);\r\n\t\t\tif (if_block1) if_block1.m(span0, null);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (/*option*/ ctx[30].icon) {\r\n\t\t\t\tif (if_block0) {\r\n\t\t\t\t\tif_block0.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty & /*option*/ 1073741824) {\r\n\t\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block0 = create_if_block_1$9(ctx);\r\n\t\t\t\t\tif_block0.c();\r\n\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\tif_block0.m(span1, t0);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block0) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block0, 1, 1, () => {\r\n\t\t\t\t\tif_block0 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif ((!current || dirty & /*option*/ 1073741824) && raw_value !== (raw_value = /*option*/ ctx[30].label + \"\")) html_tag.p(raw_value);\r\n\r\n\t\t\tif (/*option*/ ctx[30].sublabel) {\r\n\t\t\t\tif (if_block1) {\r\n\t\t\t\t\tif_block1.p(ctx, dirty);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block1 = create_if_block$a(ctx);\r\n\t\t\t\t\tif_block1.c();\r\n\t\t\t\t\tif_block1.m(span0, null);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block1) {\r\n\t\t\t\tif_block1.d(1);\r\n\t\t\t\tif_block1 = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*optionLabelStyle, option*/ 1073758208 && span0_style_value !== (span0_style_value = isFunction(/*optionLabelStyle*/ ctx[14])\r\n\t\t\t? /*optionLabelStyle*/ ctx[14](/*option*/ ctx[30].value)\r\n\t\t\t: /*optionLabelStyle*/ ctx[14])) {\r\n\t\t\t\tattr(span0, \"style\", span0_style_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*optionLabelClass*/ 1024 && span0_class_value !== (span0_class_value = arrayJoin(['PinturaDropdownOptionLabel', /*optionLabelClass*/ ctx[10]]))) {\r\n\t\t\t\tattr(span0, \"class\", span0_class_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block0);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block0);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span1);\r\n\t\t\tif (if_block0) if_block0.d();\r\n\t\t\tif (if_block1) if_block1.d();\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (105:4) \r\nfunction create_details_slot$3(ctx) {\r\n\tlet div;\r\n\tlet t;\r\n\tlet radiogroup;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tconst controls_slot_template = /*#slots*/ ctx[26].controls;\r\n\tconst controls_slot = create_slot(controls_slot_template, ctx, /*$$scope*/ ctx[28], get_controls_slot_context);\r\n\r\n\tradiogroup = new RadioGroup({\r\n\t\t\tprops: {\r\n\t\t\t\tclass: \"PinturaOptionsList PinturaScrollableContent\",\r\n\t\t\t\tname: /*name*/ ctx[7],\r\n\t\t\t\tvalue: /*value*/ ctx[9],\r\n\t\t\t\tselectedIndex: /*selectedIndex*/ ctx[8],\r\n\t\t\t\toptionFilter: /*optionFilter*/ ctx[11],\r\n\t\t\t\toptionMapper: /*optionMapper*/ ctx[12],\r\n\t\t\t\toptionLabelClass: arrayJoin(['PinturaDropdownOptionLabel', /*optionLabelClass*/ ctx[10]]),\r\n\t\t\t\toptionGroupClass: \"PinturaListOptionGroup\",\r\n\t\t\t\toptionClass: \"PinturaListOption\",\r\n\t\t\t\toptions: /*localizedOptions*/ ctx[16],\r\n\t\t\t\tonchange: /*handleSelect*/ ctx[19],\r\n\t\t\t\t$$slots: {\r\n\t\t\t\t\toption: [\r\n\t\t\t\t\t\tcreate_option_slot$4,\r\n\t\t\t\t\t\t({ option }) => ({ 30: option }),\r\n\t\t\t\t\t\t({ option }) => option ? 1073741824 : 0\r\n\t\t\t\t\t],\r\n\t\t\t\t\tgroup: [\r\n\t\t\t\t\t\tcreate_group_slot$1,\r\n\t\t\t\t\t\t({ option }) => ({ 30: option }),\r\n\t\t\t\t\t\t({ option }) => option ? 1073741824 : 0\r\n\t\t\t\t\t]\r\n\t\t\t\t},\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (controls_slot) controls_slot.c();\r\n\t\t\tt = space();\r\n\t\t\tcreate_component(radiogroup.$$.fragment);\r\n\t\t\tattr(div, \"slot\", \"details\");\r\n\t\t\tattr(div, \"class\", \"PinturaOptionsListWrapper\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\r\n\t\t\tif (controls_slot) {\r\n\t\t\t\tcontrols_slot.m(div, null);\r\n\t\t\t}\r\n\r\n\t\t\tappend(div, t);\r\n\t\t\tmount_component(radiogroup, div, null);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = listen(div, \"keydown\", /*handleKeydown*/ ctx[21]);\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (controls_slot) {\r\n\t\t\t\tif (controls_slot.p && (!current || dirty & /*$$scope*/ 268435456)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tcontrols_slot,\r\n\t\t\t\t\t\tcontrols_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[28],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[28])\r\n\t\t\t\t\t\t: get_slot_changes(controls_slot_template, /*$$scope*/ ctx[28], dirty, get_controls_slot_changes),\r\n\t\t\t\t\t\tget_controls_slot_context\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst radiogroup_changes = {};\r\n\t\t\tif (dirty & /*name*/ 128) radiogroup_changes.name = /*name*/ ctx[7];\r\n\t\t\tif (dirty & /*value*/ 512) radiogroup_changes.value = /*value*/ ctx[9];\r\n\t\t\tif (dirty & /*selectedIndex*/ 256) radiogroup_changes.selectedIndex = /*selectedIndex*/ ctx[8];\r\n\t\t\tif (dirty & /*optionFilter*/ 2048) radiogroup_changes.optionFilter = /*optionFilter*/ ctx[11];\r\n\t\t\tif (dirty & /*optionMapper*/ 4096) radiogroup_changes.optionMapper = /*optionMapper*/ ctx[12];\r\n\t\t\tif (dirty & /*optionLabelClass*/ 1024) radiogroup_changes.optionLabelClass = arrayJoin(['PinturaDropdownOptionLabel', /*optionLabelClass*/ ctx[10]]);\r\n\t\t\tif (dirty & /*localizedOptions*/ 65536) radiogroup_changes.options = /*localizedOptions*/ ctx[16];\r\n\r\n\t\t\tif (dirty & /*$$scope, optionLabelStyle, option, optionLabelClass, optionIconStyle*/ 1342202880) {\r\n\t\t\t\tradiogroup_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tradiogroup.$set(radiogroup_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(controls_slot, local);\r\n\t\t\ttransition_in(radiogroup.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(controls_slot, local);\r\n\t\t\ttransition_out(radiogroup.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif (controls_slot) controls_slot.d(detaching);\r\n\t\t\tdestroy_component(radiogroup);\r\n\t\t\tmounted = false;\r\n\t\t\tdispose();\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$A(ctx) {\r\n\tlet panel;\r\n\tlet updating_isActive;\r\n\tlet current;\r\n\r\n\tfunction panel_isActive_binding(value) {\r\n\t\t/*panel_isActive_binding*/ ctx[27](value);\r\n\t}\r\n\r\n\tlet panel_props = {\r\n\t\tonshow: /*handleShowPanel*/ ctx[20],\r\n\t\tbuttonClass: arrayJoin([\r\n\t\t\t'PinturaDropdownButton',\r\n\t\t\t/*klass*/ ctx[0],\r\n\t\t\t/*hideLabel*/ ctx[5] && 'PinturaDropdownIconOnly'\r\n\t\t]),\r\n\t\t$$slots: {\r\n\t\t\tdetails: [create_details_slot$3],\r\n\t\t\tlabel: [create_label_slot$2]\r\n\t\t},\r\n\t\t$$scope: { ctx }\r\n\t};\r\n\r\n\tif (/*dropdownVisible*/ ctx[17] !== void 0) {\r\n\t\tpanel_props.isActive = /*dropdownVisible*/ ctx[17];\r\n\t}\r\n\r\n\tpanel = new Panel({ props: panel_props });\r\n\tbinding_callbacks.push(() => bind(panel, 'isActive', panel_isActive_binding));\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(panel.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(panel, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tconst panel_changes = {};\r\n\r\n\t\t\tif (dirty & /*klass, hideLabel*/ 33) panel_changes.buttonClass = arrayJoin([\r\n\t\t\t\t'PinturaDropdownButton',\r\n\t\t\t\t/*klass*/ ctx[0],\r\n\t\t\t\t/*hideLabel*/ ctx[5] && 'PinturaDropdownIconOnly'\r\n\t\t\t]);\r\n\r\n\t\t\tif (dirty & /*$$scope, name, value, selectedIndex, optionFilter, optionMapper, optionLabelClass, localizedOptions, optionLabelStyle, optionIconStyle, title, locale, innerClass, labelClass, hideLabel, label, selectedLabel, icon*/ 268828670) {\r\n\t\t\t\tpanel_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tif (!updating_isActive && dirty & /*dropdownVisible*/ 131072) {\r\n\t\t\t\tupdating_isActive = true;\r\n\t\t\t\tpanel_changes.isActive = /*dropdownVisible*/ ctx[17];\r\n\t\t\t\tadd_flush_callback(() => updating_isActive = false);\r\n\t\t\t}\r\n\r\n\t\t\tpanel.$set(panel_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(panel.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(panel.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(panel, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$B($$self, $$props, $$invalidate) {\r\n\tlet localizedOptions;\r\n\tlet selectedLabel;\r\n\tlet { $$slots: slots = {}, $$scope } = $$props;\r\n\tlet { class: klass = undefined } = $$props;\r\n\tlet { title = undefined } = $$props;\r\n\tlet { label = undefined } = $$props;\r\n\tlet { labelClass = undefined } = $$props;\r\n\tlet { innerClass = undefined } = $$props;\r\n\tlet { hideLabel = false } = $$props;\r\n\tlet { icon = undefined } = $$props;\r\n\tlet { name = undefined } = $$props;\r\n\tlet { options = [] } = $$props;\r\n\tlet { selectedIndex = -1 } = $$props;\r\n\tlet { value = undefined } = $$props;\r\n\tlet { optionLabelClass = undefined } = $$props;\r\n\tlet { optionFilter = undefined } = $$props;\r\n\tlet { optionMapper = undefined } = $$props;\r\n\tlet { optionIconStyle = undefined } = $$props;\r\n\tlet { optionLabelStyle = undefined } = $$props;\r\n\tlet { locale = undefined } = $$props;\r\n\tlet { onchange = noop$1 } = $$props;\r\n\tlet { onload = noop$1 } = $$props;\r\n\tlet { ondestroy = noop$1 } = $$props;\r\n\r\n\tconst getUndefinedOptionLabel = options => {\r\n\t\tconst option = options.find(option => option[0] === undefined);\r\n\t\tif (!option) return undefined;\r\n\t\treturn option[1];\r\n\t};\r\n\r\n\tlet dropdownVisible;\r\n\r\n\tconst handleSelect = detail => {\r\n\t\t// triggers label update\r\n\t\t$$invalidate(18, selectedLabel = detail.value);\r\n\r\n\t\t// update value\r\n\t\tonchange(detail);\r\n\r\n\t\t// hide details\r\n\t\t$$invalidate(17, dropdownVisible = false);\r\n\r\n        if (selectedLabel == undefined) {\r\n            var hiddenButtons = document.getElementsByClassName('PinturaButtonHidden');\r\n            if (hiddenButtons && hiddenButtons.length >= 1) {\r\n                hiddenButtons[0].click();\r\n            } \r\n        }\r\n\t};\r\n\r\n\tconst handleShowPanel = ({ e, panel }) => {\r\n\t\tif (e && e.key && (/up|down/i).test(e.key)) return focus(panel.querySelector('input:not([disabled])'));\r\n\t\tfocus(panel.querySelector('fieldset'));\r\n\t};\r\n\r\n\tconst handleKeydown = e => {\r\n\t\t// don't allow tabbing ([tab] is also blocked in normal <select>)\r\n\t\tif ((/tab/i).test(e.key)) e.preventDefault();\r\n\t};\r\n\r\n\tonMount(() => onload({ options }));\r\n\tonDestroy(() => ondestroy({ options }));\r\n\r\n\tfunction panel_isActive_binding(value) {\r\n\t\tdropdownVisible = value;\r\n\t\t$$invalidate(17, dropdownVisible);\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('class' in $$props) $$invalidate(0, klass = $$props.class);\r\n\t\tif ('title' in $$props) $$invalidate(1, title = $$props.title);\r\n\t\tif ('label' in $$props) $$invalidate(2, label = $$props.label);\r\n\t\tif ('labelClass' in $$props) $$invalidate(3, labelClass = $$props.labelClass);\r\n\t\tif ('innerClass' in $$props) $$invalidate(4, innerClass = $$props.innerClass);\r\n\t\tif ('hideLabel' in $$props) $$invalidate(5, hideLabel = $$props.hideLabel);\r\n\t\tif ('icon' in $$props) $$invalidate(6, icon = $$props.icon);\r\n\t\tif ('name' in $$props) $$invalidate(7, name = $$props.name);\r\n\t\tif ('options' in $$props) $$invalidate(22, options = $$props.options);\r\n\t\tif ('selectedIndex' in $$props) $$invalidate(8, selectedIndex = $$props.selectedIndex);\r\n\t\tif ('value' in $$props) $$invalidate(9, value = $$props.value);\r\n\t\tif ('optionLabelClass' in $$props) $$invalidate(10, optionLabelClass = $$props.optionLabelClass);\r\n\t\tif ('optionFilter' in $$props) $$invalidate(11, optionFilter = $$props.optionFilter);\r\n\t\tif ('optionMapper' in $$props) $$invalidate(12, optionMapper = $$props.optionMapper);\r\n\t\tif ('optionIconStyle' in $$props) $$invalidate(13, optionIconStyle = $$props.optionIconStyle);\r\n\t\tif ('optionLabelStyle' in $$props) $$invalidate(14, optionLabelStyle = $$props.optionLabelStyle);\r\n\t\tif ('locale' in $$props) $$invalidate(15, locale = $$props.locale);\r\n\t\tif ('onchange' in $$props) $$invalidate(23, onchange = $$props.onchange);\r\n\t\tif ('onload' in $$props) $$invalidate(24, onload = $$props.onload);\r\n\t\tif ('ondestroy' in $$props) $$invalidate(25, ondestroy = $$props.ondestroy);\r\n\t\tif ('$$scope' in $$props) $$invalidate(28, $$scope = $$props.$$scope);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*locale, options*/ 4227072) {\r\n\t\t\t$$invalidate(16, localizedOptions = locale ? localizeOptions$1(options, locale) : options);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*localizedOptions, value*/ 66048) {\r\n\t\t\t$$invalidate(18, selectedLabel = localizedOptions.reduce(\r\n\t\t\t\t(prev, curr) => {\r\n\t\t\t\t\tif (prev) return prev;\r\n\t\t\t\t\tconst item = Array.isArray(curr) ? curr : [curr, curr];\r\n\t\t\t\t\tconst [optionValue, optionLabel] = item;\r\n\t\t\t\t\tif (isDeepEqual(optionValue, value)) return optionLabel;\r\n\t\t\t\t},\r\n\t\t\t\tundefined\r\n\t\t\t) || getUndefinedOptionLabel(localizedOptions) || value);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tklass,\r\n\t\ttitle,\r\n\t\tlabel,\r\n\t\tlabelClass,\r\n\t\tinnerClass,\r\n\t\thideLabel,\r\n\t\ticon,\r\n\t\tname,\r\n\t\tselectedIndex,\r\n\t\tvalue,\r\n\t\toptionLabelClass,\r\n\t\toptionFilter,\r\n\t\toptionMapper,\r\n\t\toptionIconStyle,\r\n\t\toptionLabelStyle,\r\n\t\tlocale,\r\n\t\tlocalizedOptions,\r\n\t\tdropdownVisible,\r\n\t\tselectedLabel,\r\n\t\thandleSelect,\r\n\t\thandleShowPanel,\r\n\t\thandleKeydown,\r\n\t\toptions,\r\n\t\tonchange,\r\n\t\tonload,\r\n\t\tondestroy,\r\n\t\tslots,\r\n\t\tpanel_isActive_binding,\r\n\t\t$$scope\r\n\t];\r\n}\r\n\r\nclass Dropdown extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$B, create_fragment$A, safe_not_equal, {\r\n\t\t\tclass: 0,\r\n\t\t\ttitle: 1,\r\n\t\t\tlabel: 2,\r\n\t\t\tlabelClass: 3,\r\n\t\t\tinnerClass: 4,\r\n\t\t\thideLabel: 5,\r\n\t\t\ticon: 6,\r\n\t\t\tname: 7,\r\n\t\t\toptions: 22,\r\n\t\t\tselectedIndex: 8,\r\n\t\t\tvalue: 9,\r\n\t\t\toptionLabelClass: 10,\r\n\t\t\toptionFilter: 11,\r\n\t\t\toptionMapper: 12,\r\n\t\t\toptionIconStyle: 13,\r\n\t\t\toptionLabelStyle: 14,\r\n\t\t\tlocale: 15,\r\n\t\t\tonchange: 23,\r\n\t\t\tonload: 24,\r\n\t\t\tondestroy: 25\r\n\t\t});\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/DynamicPanel.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_details_slot$2(ctx) {\r\n\tlet div;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tattr(div, \"slot\", \"details\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\t/*div_binding*/ ctx[10](div);\r\n\t\t},\r\n\t\tp: noop,\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\t/*div_binding*/ ctx[10](null);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$z(ctx) {\r\n\tlet panel;\r\n\tlet updating_isActive;\r\n\tlet current;\r\n\r\n\tfunction panel_isActive_binding(value) {\r\n\t\t/*panel_isActive_binding*/ ctx[11](value);\r\n\t}\r\n\r\n\tlet panel_props = {\r\n\t\tbuttonLabel: /*buttonLabel*/ ctx[0],\r\n\t\tbuttonClass: /*buttonClass*/ ctx[1],\r\n\t\tonshow: /*onshow*/ ctx[2],\r\n\t\tonhide: /*onhide*/ ctx[3],\r\n\t\t$$slots: { details: [create_details_slot$2] },\r\n\t\t$$scope: { ctx }\r\n\t};\r\n\r\n\tif (/*isActive*/ ctx[5] !== void 0) {\r\n\t\tpanel_props.isActive = /*isActive*/ ctx[5];\r\n\t}\r\n\r\n\tpanel = new Panel({ props: panel_props });\r\n\tbinding_callbacks.push(() => bind(panel, 'isActive', panel_isActive_binding));\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(panel.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(panel, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tconst panel_changes = {};\r\n\t\t\tif (dirty & /*buttonLabel*/ 1) panel_changes.buttonLabel = /*buttonLabel*/ ctx[0];\r\n\t\t\tif (dirty & /*buttonClass*/ 2) panel_changes.buttonClass = /*buttonClass*/ ctx[1];\r\n\t\t\tif (dirty & /*onshow*/ 4) panel_changes.onshow = /*onshow*/ ctx[2];\r\n\t\t\tif (dirty & /*onhide*/ 8) panel_changes.onhide = /*onhide*/ ctx[3];\r\n\r\n\t\t\tif (dirty & /*$$scope, container*/ 4112) {\r\n\t\t\t\tpanel_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tif (!updating_isActive && dirty & /*isActive*/ 32) {\r\n\t\t\t\tupdating_isActive = true;\r\n\t\t\t\tpanel_changes.isActive = /*isActive*/ ctx[5];\r\n\t\t\t\tadd_flush_callback(() => updating_isActive = false);\r\n\t\t\t}\r\n\r\n\t\t\tpanel.$set(panel_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(panel.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(panel.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(panel, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$A($$self, $$props, $$invalidate) {\r\n\tlet { buttonLabel = undefined } = $$props;\r\n\tlet { buttonClass = undefined } = $$props;\r\n\tlet { root = undefined } = $$props;\r\n\tlet { ondestroy = noop$1 } = $$props;\r\n\tlet { onshow = noop$1 } = $$props;\r\n\tlet { onhide = noop$1 } = $$props;\r\n\tconst hide = () => $$invalidate(5, isActive = false);\r\n\tconst show = () => $$invalidate(5, isActive = true);\r\n\tlet container;\r\n\tlet isActive = false;\r\n\tonDestroy(ondestroy);\r\n\r\n\tfunction div_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\tcontainer = $$value;\r\n\t\t\t$$invalidate(4, container);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction panel_isActive_binding(value) {\r\n\t\tisActive = value;\r\n\t\t$$invalidate(5, isActive);\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('buttonLabel' in $$props) $$invalidate(0, buttonLabel = $$props.buttonLabel);\r\n\t\tif ('buttonClass' in $$props) $$invalidate(1, buttonClass = $$props.buttonClass);\r\n\t\tif ('root' in $$props) $$invalidate(6, root = $$props.root);\r\n\t\tif ('ondestroy' in $$props) $$invalidate(7, ondestroy = $$props.ondestroy);\r\n\t\tif ('onshow' in $$props) $$invalidate(2, onshow = $$props.onshow);\r\n\t\tif ('onhide' in $$props) $$invalidate(3, onhide = $$props.onhide);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*container, root*/ 80) {\r\n\t\t\tif (container && root && container.firstChild !== root) {\r\n\t\t\t\tcontainer.hasChildNodes()\r\n\t\t\t\t? container.replaceChild(root, container.firstChild)\r\n\t\t\t\t: container.append(root);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tbuttonLabel,\r\n\t\tbuttonClass,\r\n\t\tonshow,\r\n\t\tonhide,\r\n\t\tcontainer,\r\n\t\tisActive,\r\n\t\troot,\r\n\t\tondestroy,\r\n\t\thide,\r\n\t\tshow,\r\n\t\tdiv_binding,\r\n\t\tpanel_isActive_binding\r\n\t];\r\n}\r\n\r\nclass DynamicPanel extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$A, create_fragment$z, safe_not_equal, {\r\n\t\t\tbuttonLabel: 0,\r\n\t\t\tbuttonClass: 1,\r\n\t\t\troot: 6,\r\n\t\t\tondestroy: 7,\r\n\t\t\tonshow: 2,\r\n\t\t\tonhide: 3,\r\n\t\t\thide: 8,\r\n\t\t\tshow: 9\r\n\t\t});\r\n\t}\r\n\r\n\tget hide() {\r\n\t\treturn this.$$.ctx[8];\r\n\t}\r\n\r\n\tget show() {\r\n\t\treturn this.$$.ctx[9];\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/ToggleSlider.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_if_block$9(ctx) {\r\n\tlet icon_1;\r\n\tlet current;\r\n\r\n\ticon_1 = new Icon({\r\n\t\t\tprops: {\r\n\t\t\t\tclass: \"PinturaButtonIcon\",\r\n\t\t\t\t$$slots: { default: [create_default_slot$c] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(icon_1.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(icon_1, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst icon_1_changes = {};\r\n\r\n\t\t\tif (dirty & /*$$scope, icon*/ 524292) {\r\n\t\t\t\ticon_1_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ticon_1.$set(icon_1_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(icon_1.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(icon_1.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(icon_1, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (56:12) <Icon class=\"PinturaButtonIcon\">\r\nfunction create_default_slot$c(ctx) {\r\n\tlet g;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tg = svg_element(\"g\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, g, anchor);\r\n\t\t\tg.innerHTML = /*icon*/ ctx[2];\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty & /*icon*/ 4) g.innerHTML = /*icon*/ ctx[2];\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(g);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (50:4) \r\nfunction create_label_slot$1(ctx) {\r\n\tlet span1;\r\n\tlet t0;\r\n\tlet span0;\r\n\tlet t1;\r\n\tlet span0_class_value;\r\n\tlet span1_title_value;\r\n\tlet span1_class_value;\r\n\tlet current;\r\n\tlet if_block = /*icon*/ ctx[2] && create_if_block$9(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan1 = element(\"span\");\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tt0 = space();\r\n\t\t\tspan0 = element(\"span\");\r\n\t\t\tt1 = text(/*currentLabel*/ ctx[8]);\r\n\r\n\t\t\tattr(span0, \"class\", span0_class_value = arrayJoin([\r\n\t\t\t\t'PinturaButtonLabel',\r\n\t\t\t\t/*labelClass*/ ctx[3],\r\n\t\t\t\t/*hideLabel*/ ctx[5] && 'implicit'\r\n\t\t\t]));\r\n\r\n\t\t\tattr(span1, \"slot\", \"label\");\r\n\t\t\tattr(span1, \"title\", span1_title_value = localize(/*title*/ ctx[1], /*locale*/ ctx[6]));\r\n\t\t\tattr(span1, \"class\", span1_class_value = arrayJoin(['PinturaButtonInner', /*innerClass*/ ctx[4]]));\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span1, anchor);\r\n\t\t\tif (if_block) if_block.m(span1, null);\r\n\t\t\tappend(span1, t0);\r\n\t\t\tappend(span1, span0);\r\n\t\t\tappend(span0, t1);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (/*icon*/ ctx[2]) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty & /*icon*/ 4) {\r\n\t\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block$9(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(span1, t0);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block, 1, 1, () => {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*currentLabel*/ 256) set_data(t1, /*currentLabel*/ ctx[8]);\r\n\r\n\t\t\tif (!current || dirty & /*labelClass, hideLabel*/ 40 && span0_class_value !== (span0_class_value = arrayJoin([\r\n\t\t\t\t'PinturaButtonLabel',\r\n\t\t\t\t/*labelClass*/ ctx[3],\r\n\t\t\t\t/*hideLabel*/ ctx[5] && 'implicit'\r\n\t\t\t]))) {\r\n\t\t\t\tattr(span0, \"class\", span0_class_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*title, locale*/ 66 && span1_title_value !== (span1_title_value = localize(/*title*/ ctx[1], /*locale*/ ctx[6]))) {\r\n\t\t\t\tattr(span1, \"title\", span1_title_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*innerClass*/ 16 && span1_class_value !== (span1_class_value = arrayJoin(['PinturaButtonInner', /*innerClass*/ ctx[4]]))) {\r\n\t\t\t\tattr(span1, \"class\", span1_class_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span1);\r\n\t\t\tif (if_block) if_block.d();\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (63:4) \r\nfunction create_details_slot$1(ctx) {\r\n\tlet div;\r\n\tlet slider;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\tconst slider_spread_levels = [\r\n\t\t/*$$restProps*/ ctx[11],\r\n\t\t{ value: /*value*/ ctx[7] },\r\n\t\t{ onchange: /*handleChangeValue*/ ctx[10] }\r\n\t];\r\n\r\n\tlet slider_props = {};\r\n\r\n\tfor (let i = 0; i < slider_spread_levels.length; i += 1) {\r\n\t\tslider_props = assign(slider_props, slider_spread_levels[i]);\r\n\t}\r\n\r\n\tslider = new Slider({ props: slider_props });\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tcreate_component(slider.$$.fragment);\r\n\t\t\tattr(div, \"slot\", \"details\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tmount_component(slider, div, null);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = listen(div, \"keydown\", /*handleKeydown*/ ctx[9]);\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst slider_changes = (dirty & /*$$restProps, value, handleChangeValue*/ 3200)\r\n\t\t\t? get_spread_update(slider_spread_levels, [\r\n\t\t\t\t\tdirty & /*$$restProps*/ 2048 && get_spread_object(/*$$restProps*/ ctx[11]),\r\n\t\t\t\t\tdirty & /*value*/ 128 && { value: /*value*/ ctx[7] },\r\n\t\t\t\t\tdirty & /*handleChangeValue*/ 1024 && { onchange: /*handleChangeValue*/ ctx[10] }\r\n\t\t\t\t])\r\n\t\t\t: {};\r\n\r\n\t\t\tslider.$set(slider_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(slider.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(slider.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tdestroy_component(slider);\r\n\t\t\tmounted = false;\r\n\t\t\tdispose();\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$y(ctx) {\r\n\tlet panel;\r\n\tlet current;\r\n\r\n\tpanel = new Panel({\r\n\t\t\tprops: {\r\n\t\t\t\tpanelClass: \"PinturaSliderPanel\",\r\n\t\t\t\tbuttonClass: arrayJoin([\r\n\t\t\t\t\t'PinturaSliderButton',\r\n\t\t\t\t\t/*klass*/ ctx[0],\r\n\t\t\t\t\t/*hideLabel*/ ctx[5] && 'PinturaSliderIconOnly'\r\n\t\t\t\t]),\r\n\t\t\t\t$$slots: {\r\n\t\t\t\t\tdetails: [create_details_slot$1],\r\n\t\t\t\t\tlabel: [create_label_slot$1]\r\n\t\t\t\t},\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(panel.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(panel, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tconst panel_changes = {};\r\n\r\n\t\t\tif (dirty & /*klass, hideLabel*/ 33) panel_changes.buttonClass = arrayJoin([\r\n\t\t\t\t'PinturaSliderButton',\r\n\t\t\t\t/*klass*/ ctx[0],\r\n\t\t\t\t/*hideLabel*/ ctx[5] && 'PinturaSliderIconOnly'\r\n\t\t\t]);\r\n\r\n\t\t\tif (dirty & /*$$scope, $$restProps, value, title, locale, innerClass, labelClass, hideLabel, currentLabel, icon*/ 526846) {\r\n\t\t\t\tpanel_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tpanel.$set(panel_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(panel.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(panel.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(panel, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$z($$self, $$props, $$invalidate) {\r\n\tconst omit_props_names = [\r\n\t\t\"class\",\"title\",\"label\",\"icon\",\"labelClass\",\"innerClass\",\"hideLabel\",\"locale\",\"value\",\"onchange\"\r\n\t];\r\n\r\n\tlet $$restProps = compute_rest_props($$props, omit_props_names);\r\n\tlet { class: klass = undefined } = $$props;\r\n\tlet { title = undefined } = $$props;\r\n\tlet { label = Math.round } = $$props;\r\n\tlet { icon = undefined } = $$props;\r\n\tlet { labelClass = undefined } = $$props;\r\n\tlet { innerClass = undefined } = $$props;\r\n\tlet { hideLabel = false } = $$props;\r\n\tlet { locale = undefined } = $$props;\r\n\tlet { value = undefined } = $$props;\r\n\tlet { onchange = noop$1 } = $$props;\r\n\tconst { min, max, getValue = passthrough } = $$restProps;\r\n\tlet currentLabel;\r\n\r\n\tconst handleKeydown = e => {\r\n\t\t// don't allow tabbing ([tab] is also blocked in normal <select>)\r\n\t\tif ((/tab/i).test(e.key)) e.preventDefault();\r\n\t};\r\n\r\n\tconst getLabel = value => isFunction(label)\r\n\t? label(getValue(value), min, max)\r\n\t: label;\r\n\r\n\tconst handleChangeValue = value => {\r\n\t\tsyncLabel(value);\r\n\t\tonchange(value);\r\n\t};\r\n\r\n\tconst syncLabel = value => $$invalidate(8, currentLabel = getLabel(value));\r\n\r\n\t$$self.$$set = $$new_props => {\r\n\t\t$$props = assign(assign({}, $$props), exclude_internal_props($$new_props));\r\n\t\t$$invalidate(11, $$restProps = compute_rest_props($$props, omit_props_names));\r\n\t\tif ('class' in $$new_props) $$invalidate(0, klass = $$new_props.class);\r\n\t\tif ('title' in $$new_props) $$invalidate(1, title = $$new_props.title);\r\n\t\tif ('label' in $$new_props) $$invalidate(12, label = $$new_props.label);\r\n\t\tif ('icon' in $$new_props) $$invalidate(2, icon = $$new_props.icon);\r\n\t\tif ('labelClass' in $$new_props) $$invalidate(3, labelClass = $$new_props.labelClass);\r\n\t\tif ('innerClass' in $$new_props) $$invalidate(4, innerClass = $$new_props.innerClass);\r\n\t\tif ('hideLabel' in $$new_props) $$invalidate(5, hideLabel = $$new_props.hideLabel);\r\n\t\tif ('locale' in $$new_props) $$invalidate(6, locale = $$new_props.locale);\r\n\t\tif ('value' in $$new_props) $$invalidate(7, value = $$new_props.value);\r\n\t\tif ('onchange' in $$new_props) $$invalidate(13, onchange = $$new_props.onchange);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*value, label*/ 4224) {\r\n\t\t\tsyncLabel(value);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tklass,\r\n\t\ttitle,\r\n\t\ticon,\r\n\t\tlabelClass,\r\n\t\tinnerClass,\r\n\t\thideLabel,\r\n\t\tlocale,\r\n\t\tvalue,\r\n\t\tcurrentLabel,\r\n\t\thandleKeydown,\r\n\t\thandleChangeValue,\r\n\t\t$$restProps,\r\n\t\tlabel,\r\n\t\tonchange\r\n\t];\r\n}\r\n\r\nclass ToggleSlider extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$z, create_fragment$y, safe_not_equal, {\r\n\t\t\tclass: 0,\r\n\t\t\ttitle: 1,\r\n\t\t\tlabel: 12,\r\n\t\t\ticon: 2,\r\n\t\t\tlabelClass: 3,\r\n\t\t\tinnerClass: 4,\r\n\t\t\thideLabel: 5,\r\n\t\t\tlocale: 6,\r\n\t\t\tvalue: 7,\r\n\t\t\tonchange: 13\r\n\t\t});\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/DynamicComponentTree.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction get_each_context$6(ctx, list, i) {\r\n\tconst child_ctx = ctx.slice();\r\n\tchild_ctx[9] = list[i][0];\r\n\tchild_ctx[0] = list[i][1];\r\n\tchild_ctx[10] = list[i][2];\r\n\tchild_ctx[2] = list[i][3];\r\n\treturn child_ctx;\r\n}\r\n\r\n// (59:4) {:else}\r\nfunction create_else_block$3(ctx) {\r\n\tlet switch_instance;\r\n\tlet switch_instance_anchor;\r\n\tlet current;\r\n\tconst switch_instance_spread_levels = [/*props*/ ctx[10]];\r\n\tvar switch_value = /*ComponentMap*/ ctx[3][/*node*/ ctx[9]] || /*node*/ ctx[9];\r\n\r\n\tfunction switch_props(ctx) {\r\n\t\tlet switch_instance_props = {};\r\n\r\n\t\tfor (let i = 0; i < switch_instance_spread_levels.length; i += 1) {\r\n\t\t\tswitch_instance_props = assign(switch_instance_props, switch_instance_spread_levels[i]);\r\n\t\t}\r\n\r\n\t\treturn { props: switch_instance_props };\r\n\t}\r\n\r\n\tif (switch_value) {\r\n\t\tswitch_instance = new switch_value(switch_props());\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (switch_instance) create_component(switch_instance.$$.fragment);\r\n\t\t\tswitch_instance_anchor = empty();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (switch_instance) {\r\n\t\t\t\tmount_component(switch_instance, target, anchor);\r\n\t\t\t}\r\n\r\n\t\t\tinsert(target, switch_instance_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst switch_instance_changes = (dirty & /*children*/ 4)\r\n\t\t\t? get_spread_update(switch_instance_spread_levels, [get_spread_object(/*props*/ ctx[10])])\r\n\t\t\t: {};\r\n\r\n\t\t\tif (switch_value !== (switch_value = /*ComponentMap*/ ctx[3][/*node*/ ctx[9]] || /*node*/ ctx[9])) {\r\n\t\t\t\tif (switch_instance) {\r\n\t\t\t\t\tgroup_outros();\r\n\t\t\t\t\tconst old_component = switch_instance;\r\n\r\n\t\t\t\t\ttransition_out(old_component.$$.fragment, 1, 0, () => {\r\n\t\t\t\t\t\tdestroy_component(old_component, 1);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tcheck_outros();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (switch_value) {\r\n\t\t\t\t\tswitch_instance = new switch_value(switch_props());\r\n\t\t\t\t\tcreate_component(switch_instance.$$.fragment);\r\n\t\t\t\t\ttransition_in(switch_instance.$$.fragment, 1);\r\n\t\t\t\t\tmount_component(switch_instance, switch_instance_anchor.parentNode, switch_instance_anchor);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tswitch_instance = null;\r\n\t\t\t\t}\r\n\t\t\t} else if (switch_value) {\r\n\t\t\t\tswitch_instance.$set(switch_instance_changes);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\tif (switch_instance) transition_in(switch_instance.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\tif (switch_instance) transition_out(switch_instance.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(switch_instance_anchor);\r\n\t\t\tif (switch_instance) destroy_component(switch_instance, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (49:4) {#if !isComponent(node)}\r\nfunction create_if_block$8(ctx) {\r\n\tlet tag;\r\n\tlet current;\r\n\r\n\ttag = new Tag({\r\n\t\t\tprops: {\r\n\t\t\t\tname: /*node*/ ctx[9],\r\n\t\t\t\tattributes: /*getElementAttributes*/ ctx[4](/*props*/ ctx[10]),\r\n\t\t\t\t$$slots: { default: [create_default_slot$b] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(tag.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(tag, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst tag_changes = {};\r\n\t\t\tif (dirty & /*children*/ 4) tag_changes.name = /*node*/ ctx[9];\r\n\t\t\tif (dirty & /*children*/ 4) tag_changes.attributes = /*getElementAttributes*/ ctx[4](/*props*/ ctx[10]);\r\n\r\n\t\t\tif (dirty & /*$$scope, children*/ 8196) {\r\n\t\t\t\ttag_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ttag.$set(tag_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(tag.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(tag.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(tag, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (55:38) \r\nfunction create_if_block_3$6(ctx) {\r\n\tlet html_tag;\r\n\tlet raw_value = /*props*/ ctx[10].innerHTML + \"\";\r\n\tlet html_anchor;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\thtml_tag = new HtmlTag(false);\r\n\t\t\thtml_anchor = empty();\r\n\t\t\thtml_tag.a = html_anchor;\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\thtml_tag.m(raw_value, target, anchor);\r\n\t\t\tinsert(target, html_anchor, anchor);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty & /*children*/ 4 && raw_value !== (raw_value = /*props*/ ctx[10].innerHTML + \"\")) html_tag.p(raw_value);\r\n\t\t},\r\n\t\ti: noop,\r\n\t\to: noop,\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(html_anchor);\r\n\t\t\tif (detaching) html_tag.d();\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (53:40) \r\nfunction create_if_block_2$7(ctx) {\r\n\tlet t_value = /*props*/ ctx[10].textContent + \"\";\r\n\tlet t;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tt = text(t_value);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, t, anchor);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty & /*children*/ 4 && t_value !== (t_value = /*props*/ ctx[10].textContent + \"\")) set_data(t, t_value);\r\n\t\t},\r\n\t\ti: noop,\r\n\t\to: noop,\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(t);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (51:12) {#if children && children.length}\r\nfunction create_if_block_1$8(ctx) {\r\n\tlet dynamiccomponenttree;\r\n\tlet current;\r\n\r\n\tdynamiccomponenttree = new DynamicComponentTree_1({\r\n\t\t\tprops: {\r\n\t\t\t\titems: /*children*/ ctx[2],\r\n\t\t\t\tdiscardEmptyItems: true\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(dynamiccomponenttree.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(dynamiccomponenttree, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst dynamiccomponenttree_changes = {};\r\n\t\t\tif (dirty & /*children*/ 4) dynamiccomponenttree_changes.items = /*children*/ ctx[2];\r\n\t\t\tdynamiccomponenttree.$set(dynamiccomponenttree_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(dynamiccomponenttree.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(dynamiccomponenttree.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(dynamiccomponenttree, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (50:8) <Tag name={node} attributes={getElementAttributes(props)}>\r\nfunction create_default_slot$b(ctx) {\r\n\tlet current_block_type_index;\r\n\tlet if_block;\r\n\tlet t;\r\n\tlet current;\r\n\tconst if_block_creators = [create_if_block_1$8, create_if_block_2$7, create_if_block_3$6];\r\n\tconst if_blocks = [];\r\n\r\n\tfunction select_block_type_1(ctx, dirty) {\r\n\t\tif (/*children*/ ctx[2] && /*children*/ ctx[2].length) return 0;\r\n\t\tif (/*props*/ ctx[10].textContent) return 1;\r\n\t\tif (/*props*/ ctx[10].innerHTML) return 2;\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tif (~(current_block_type_index = select_block_type_1(ctx))) {\r\n\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tt = space();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (~current_block_type_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].m(target, anchor);\r\n\t\t\t}\r\n\r\n\t\t\tinsert(target, t, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tlet previous_block_index = current_block_type_index;\r\n\t\t\tcurrent_block_type_index = select_block_type_1(ctx);\r\n\r\n\t\t\tif (current_block_type_index === previous_block_index) {\r\n\t\t\t\tif (~current_block_type_index) {\r\n\t\t\t\t\tif_blocks[current_block_type_index].p(ctx, dirty);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\t\ttransition_out(if_blocks[previous_block_index], 1, 1, () => {\r\n\t\t\t\t\t\tif_blocks[previous_block_index] = null;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tcheck_outros();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (~current_block_type_index) {\r\n\t\t\t\t\tif_block = if_blocks[current_block_type_index];\r\n\r\n\t\t\t\t\tif (!if_block) {\r\n\t\t\t\t\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t\t\t\t\t\tif_block.c();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif_block.p(ctx, dirty);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(t.parentNode, t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (~current_block_type_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].d(detaching);\r\n\t\t\t}\r\n\r\n\t\t\tif (detaching) detach(t);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (48:0) {#each children as [node, key, props, children] (key + treeUniqueKey)}\r\nfunction create_each_block$6(key_2, ctx) {\r\n\tlet first;\r\n\tlet show_if;\r\n\tlet current_block_type_index;\r\n\tlet if_block;\r\n\tlet if_block_anchor;\r\n\tlet current;\r\n\tconst if_block_creators = [create_if_block$8, create_else_block$3];\r\n\tconst if_blocks = [];\r\n\r\n\tfunction select_block_type(ctx, dirty) {\r\n\t\tif (dirty & /*children*/ 4) show_if = null;\r\n\t\tif (show_if == null) show_if = !!!/*isComponent*/ ctx[5](/*node*/ ctx[9]);\r\n\t\tif (show_if) return 0;\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tcurrent_block_type_index = select_block_type(ctx, -1);\r\n\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\r\n\treturn {\r\n\t\tkey: key_2,\r\n\t\tfirst: null,\r\n\t\tc() {\r\n\t\t\tfirst = empty();\r\n\t\t\tif_block.c();\r\n\t\t\tif_block_anchor = empty();\r\n\t\t\tthis.first = first;\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, first, anchor);\r\n\t\t\tif_blocks[current_block_type_index].m(target, anchor);\r\n\t\t\tinsert(target, if_block_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\t\t\tlet previous_block_index = current_block_type_index;\r\n\t\t\tcurrent_block_type_index = select_block_type(ctx, dirty);\r\n\r\n\t\t\tif (current_block_type_index === previous_block_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].p(ctx, dirty);\r\n\t\t\t} else {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_blocks[previous_block_index], 1, 1, () => {\r\n\t\t\t\t\tif_blocks[previous_block_index] = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t\tif_block = if_blocks[current_block_type_index];\r\n\r\n\t\t\t\tif (!if_block) {\r\n\t\t\t\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\tif_block.m(if_block_anchor.parentNode, if_block_anchor);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(first);\r\n\t\t\tif_blocks[current_block_type_index].d(detaching);\r\n\t\t\tif (detaching) detach(if_block_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$x(ctx) {\r\n\tlet each_blocks = [];\r\n\tlet each_1_lookup = new Map();\r\n\tlet each_1_anchor;\r\n\tlet current;\r\n\tlet each_value = /*children*/ ctx[2];\r\n\tconst get_key = ctx => /*key*/ ctx[0] + /*treeUniqueKey*/ ctx[1];\r\n\r\n\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\tlet child_ctx = get_each_context$6(ctx, each_value, i);\r\n\t\tlet key = get_key(child_ctx);\r\n\t\teach_1_lookup.set(key, each_blocks[i] = create_each_block$6(key, child_ctx));\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].c();\r\n\t\t\t}\r\n\r\n\t\t\teach_1_anchor = empty();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].m(target, anchor);\r\n\t\t\t}\r\n\r\n\t\t\tinsert(target, each_1_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tif (dirty & /*children, getElementAttributes, isComponent, ComponentMap, treeUniqueKey*/ 62) {\r\n\t\t\t\teach_value = /*children*/ ctx[2];\r\n\t\t\t\tgroup_outros();\r\n\t\t\t\teach_blocks = update_keyed_each(each_blocks, dirty, get_key, 1, ctx, each_value, each_1_lookup, each_1_anchor.parentNode, outro_and_destroy_block, create_each_block$6, each_1_anchor, get_each_context$6);\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\r\n\t\t\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\t\t\ttransition_in(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\ttransition_out(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].d(detaching);\r\n\t\t\t}\r\n\r\n\t\t\tif (detaching) detach(each_1_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$y($$self, $$props, $$invalidate) {\r\n\tlet treeUniqueKey;\r\n\tlet children;\r\n\tlet { items } = $$props;\r\n\tlet { discardEmptyItems = true } = $$props;\r\n\tlet { key = '' } = $$props;\r\n\r\n\tconst ComponentMap = {\r\n\t\tButton,\r\n\t\tDropdown,\r\n\t\tPanel: DynamicPanel,\r\n\t\tSlider: ToggleSlider\r\n\t};\r\n\r\n\tconst getElementAttributes = (props = {}) => {\r\n\t\tconst { textContent, innerHTML, ...attributes } = props;\r\n\t\treturn attributes;\r\n\t};\r\n\r\n\tconst isComponent = node => !isString(node) || !!ComponentMap[node];\r\n\r\n\tconst shouldRenderItem = item => {\r\n\t\t// don't render falsy items\r\n\t\tif (!item) return false;\r\n\r\n\t\t// get relevant props\r\n\t\tconst [node, ,props, children = []] = item;\r\n\r\n\t\t// if item is component, we always render it\r\n\t\tif (isComponent(node)) return true;\r\n\r\n\t\t// item is tag, we have to check if it has content\r\n\t\treturn children.some(shouldRenderItem) || props.textContent || props.innerHTML;\r\n\t};\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('items' in $$props) $$invalidate(6, items = $$props.items);\r\n\t\tif ('discardEmptyItems' in $$props) $$invalidate(7, discardEmptyItems = $$props.discardEmptyItems);\r\n\t\tif ('key' in $$props) $$invalidate(0, key = $$props.key);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*key*/ 1) {\r\n\t\t\t$$invalidate(1, treeUniqueKey = key);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*items, discardEmptyItems*/ 192) {\r\n\t\t\t$$invalidate(2, children = (items && discardEmptyItems\r\n\t\t\t? items.filter(shouldRenderItem)\r\n\t\t\t: items) || []);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tkey,\r\n\t\ttreeUniqueKey,\r\n\t\tchildren,\r\n\t\tComponentMap,\r\n\t\tgetElementAttributes,\r\n\t\tisComponent,\r\n\t\titems,\r\n\t\tdiscardEmptyItems\r\n\t];\r\n}\r\n\r\nclass DynamicComponentTree_1 extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\t\tinit(this, options, instance$y, create_fragment$x, safe_not_equal, { items: 6, discardEmptyItems: 7, key: 0 });\r\n\t}\r\n}\r\n\r\nvar canvasClone = (canvas) => {\r\n    const clone = h('canvas', { width: canvas.width, height: canvas.height });\r\n    clone.getContext('2d').drawImage(canvas, 0, 0);\r\n    return clone;\r\n};\r\n\r\n// these are derived stores, we can filter them out\r\nconst ImagePropsDerived = ['aspectRatio', 'isRotatedSideways', 'flip', 'cropSize'];\r\n// map descriptors to props\r\nconst ImageStoreProps = ImageStorePropDescriptors.map(([name]) => name).filter((name) => !ImagePropsDerived.includes(name));\r\nconst proxy = function (get, set, update) {\r\n    let subscribers = [];\r\n    return {\r\n        set,\r\n        update,\r\n        publish: (value) => {\r\n            subscribers.forEach((cb) => cb(value));\r\n        },\r\n        subscribe: (cb) => {\r\n            subscribers.push(cb);\r\n            get(cb);\r\n            return () => {\r\n                subscribers = subscribers.filter((item) => item !== cb);\r\n            };\r\n        },\r\n    };\r\n};\r\nvar createImageProxy = () => {\r\n    let unsubs;\r\n    let image;\r\n    const proxyStores = ImageStoreProps.reduce((prev, curr) => {\r\n        prev[curr] = proxy(\r\n        // getter\r\n        (cb) => {\r\n            // subscribe\r\n            if (!image)\r\n                return cb();\r\n            const unsub = image.stores[curr].subscribe(cb);\r\n            unsub();\r\n        }, \r\n        // setter\r\n        (value) => {\r\n            // set value on actual store if is defined\r\n            if (!image)\r\n                return;\r\n            image.stores[curr].set(value);\r\n        }, \r\n        // updater\r\n        (cb) => {\r\n            if (!image)\r\n                return;\r\n            image.stores[curr].update(cb);\r\n        });\r\n        return prev;\r\n    }, {});\r\n    const update = (newImage) => {\r\n        image = newImage;\r\n        if (unsubs) {\r\n            // remove subscribers\r\n            unsubs.forEach((unsub) => unsub());\r\n            unsubs = undefined;\r\n        }\r\n        if (!newImage) {\r\n            // need to reset load state\r\n            proxyStores['file'].publish(undefined);\r\n            proxyStores['loadState'].publish(undefined);\r\n            return;\r\n        }\r\n        unsubs = ImageStoreProps.map((prop) => newImage.stores[prop].subscribe((value) => {\r\n            proxyStores[prop].publish(value);\r\n        }));\r\n    };\r\n    return {\r\n        update,\r\n        stores: proxyStores,\r\n        destroy: () => {\r\n            if (unsubs)\r\n                unsubs.forEach((unsub) => unsub());\r\n        },\r\n    };\r\n};\r\n\r\nvar createPingRouter = (route, cancel = true) => (e) => {\r\n    if (e.type !== 'ping')\r\n        return;\r\n    if (cancel)\r\n        e.stopPropagation();\r\n    route(e.detail.type, e.detail.data);\r\n};\r\n\r\nvar createPing = (type, data) => new CustomEvent('ping', {\r\n    detail: {\r\n        type,\r\n        data,\r\n    },\r\n    cancelable: true,\r\n    bubbles: true,\r\n});\r\n\r\nvar isTextarea = (element) => /textarea/i.test(element.nodeName);\r\n\r\nvar isTextInput = (node) => /date|email|number|search|text|url/.test(node.type);\r\n\r\nvar isTextField = (node) => isTextarea(node) || isTextInput(node) || node.isContentEditable;\r\n\r\nvar toKebabCase = (str, abbr) => {\r\n    return (abbr ? stringReplace(str, abbr) : str)\r\n        .replace(/([a-z])([A-Z])/g, '$1-$2')\r\n        .replace(/\\s+/g, '-')\r\n        .toLowerCase();\r\n};\r\n\r\nvar matchMedia$1 = (query, cb) => {\r\n    const mql = matchMedia(query);\r\n    mql.addListener(cb);\r\n    cb(mql);\r\n    return {\r\n        get matches() { return mql.matches; },\r\n        destroy: () => mql.removeListener(cb)\r\n    };\r\n};\r\n\r\nvar mediaQueryStore = (query, formatValue = passthrough) => {\r\n    const { subscribe, set } = writable(undefined);\r\n    const mm = matchMedia$1(query, ({ matches }) => set(formatValue(matches)));\r\n    return {\r\n        subscribe,\r\n        destroy: mm.destroy,\r\n    };\r\n};\r\n\r\nvar canPreventNavSwipe = () => {\r\n    // if not iOS we can't prevent swipe because it probably isn't a thing\r\n    if (!isIOS())\r\n        return false;\r\n    // extract version number\r\n    const matches = navigator.userAgent.match(/OS (\\d+)_(\\d+)_?(\\d+)?/i) || [];\r\n    const [, major, minor] = matches.map((v) => parseInt(v, 10) || 0);\r\n    // is atleast version 13.4+\r\n    return major > 13 || (major === 13 && minor >= 4);\r\n};\r\n\r\n// @ts-ignore\r\nvar historyCreate = (getState, setState) => {\r\n    // set up pub/sub for history object\r\n    const { sub, pub } = pubsub();\r\n    // current history state\r\n    //let baseState;//\r\n    const entries = [];\r\n    const index = writable(0);\r\n    const subs = [];\r\n    const updateSubs = () => subs.forEach((cb) => cb({ index: get_store_value(index), length: entries.length }));\r\n    const history = {\r\n        get index() {\r\n            return get_store_value(index);\r\n        },\r\n        set index(i) {\r\n            // validate new index\r\n            i = Number.isInteger(i) ? i : 0;\r\n            i = clamp(i, 0, entries.length - 1);\r\n            // remember\r\n            index.set(i);\r\n            setState(entries[history.index]); // || baseState);\r\n            // update subs\r\n            updateSubs();\r\n        },\r\n        get state() {\r\n            return entries[entries.length - 1]; // || baseState;\r\n        },\r\n        length() {\r\n            return entries.length;\r\n        },\r\n        undo() {\r\n            const newIndex = history.index--;\r\n            pub('undo', newIndex);\r\n            return newIndex;\r\n        },\r\n        redo() {\r\n            const newIndex = history.index++;\r\n            pub('redo', history.index);\r\n            return newIndex;\r\n        },\r\n        revert() {\r\n            entries.length = 1; // retain first state\r\n            history.index = 0;\r\n            pub('revert');\r\n        },\r\n        write(state) {\r\n            // write history entry\r\n            if (state) {\r\n                setState({\r\n                    ...getState(),\r\n                    ...state,\r\n                });\r\n            }\r\n            const newState = getState();\r\n            const lastState = entries[entries.length - 1];\r\n            // don't update if new state isn't different\r\n            if (JSON.stringify(newState) === JSON.stringify(lastState))\r\n                return;\r\n            // reset length to current index\r\n            entries.length = history.index + 1;\r\n            // add new entry\r\n            entries.push(newState);\r\n            // move pointer to last added index\r\n            index.set(entries.length - 1);\r\n            updateSubs();\r\n        },\r\n        set(state = {}) {\r\n            // set clears all entries\r\n            entries.length = 0;\r\n            history.index = 0;\r\n            // set new entries\r\n            const newStateEntries = !Array.isArray(state) ? [state] : state;\r\n            // add new entries\r\n            entries.push(...newStateEntries);\r\n            // move pointer to last added index\r\n            history.index = entries.length - 1;\r\n        },\r\n        get() {\r\n            return [...entries];\r\n        },\r\n        subscribe(cb) {\r\n            subs.push(cb);\r\n            cb({ index: history.index, length: entries.length });\r\n            return () => subs.splice(subs.indexOf(cb), 1);\r\n        },\r\n        on: sub,\r\n    };\r\n    return history;\r\n};\r\n\r\nvar isChrome = () => isBrowser() && !!window['chrome'];\r\n\r\nvar imageBitmapToImageData = async (imageBitmap) => canvasToImageData(await imageDataToCanvas(imageBitmap));\r\n\r\nvar isVideoFile = (blob) => /video/.test(blob.type);\r\n\r\n// TODO: VIDEO cleanup?\r\nconst videoToImageData = (file) => new Promise((resolve, reject) => {\r\n    const video = h('video');\r\n    video.onseeked = () => {\r\n        const frame = h('canvas');\r\n        getVideoElementSize(video).then(({ width, height }) => {\r\n            frame.width = width;\r\n            frame.height = height;\r\n            const ctx = frame.getContext('2d');\r\n            const drawFrame = () => {\r\n                ctx.drawImage(video, 0, 0, frame.width, frame.height);\r\n                const imageData = ctx.getImageData(0, 0, frame.width, frame.height);\r\n                releaseCanvas(frame);\r\n                resolve(imageData);\r\n            };\r\n            // if we don't use setTimeout for safari sometimes it doesn't draw the frame\r\n            isSafari() ? setTimeout(drawFrame, 16) : drawFrame();\r\n        });\r\n    };\r\n    video.onloadeddata = () => {\r\n        // if we use onloadedmetadata safari doesn't render the frame\r\n        video.currentTime = 0;\r\n    };\r\n    video.onerror = (e) => {\r\n        console.error(e);\r\n        reject(e);\r\n    };\r\n    video.src = URL.createObjectURL(file);\r\n    video.load(); // needed to make video show up on iOS\r\n});\r\nvar blobToImageBitmap = (file, ImageOrienter, canvasMemoryLimit) => new Promise((resolve, reject) => {\r\n    (async () => {\r\n        if (isVideoFile(file))\r\n            resolve(await videoToImageData(file));\r\n        // get orientation of image, should return 1 for normal orientation\r\n        const orientation = await ImageOrienter.read(file);\r\n        // helper method to apply orientation fix if needed\r\n        const toImageData = (file) => blobToImageData(file, canvasMemoryLimit)\r\n            .then((imageData) => ImageOrienter.apply(imageData, orientation))\r\n            .then(resolve)\r\n            .catch(reject);\r\n        // if cannot create image bitmaps in worker\r\n        // Safari 15 cannot correctly apply orientation, also it will choke on very big images\r\n        // when trying to createImageBitmap in thread, so lets just do it on the main thread\r\n        // we'll ignore Safari and iOS for now\r\n        if (isSVGFile(file) || !canCreateImageBitmap() || isSafari() || isIOS())\r\n            return toImageData(file);\r\n        // create image bitmap in thread\r\n        let imageBitmap;\r\n        try {\r\n            imageBitmap = await thread((file, done) => createImageBitmap(file)\r\n                .then((bitmap) => done(null, bitmap))\r\n                .catch(done), [file]);\r\n        }\r\n        catch (err) {\r\n            // fails silently on purpose, we'll try to turn the blob into image data in the main thread\r\n            // console.error(err);\r\n        }\r\n        // no bitmap returned, something went wrong in `createImageBitmap` logic\r\n        if (!imageBitmap || !imageBitmap.width)\r\n            return toImageData(file);\r\n        // if the browser can't orient images, we need to correct the orientation now\r\n        if (!(await canOrientImages()))\r\n            return resolve(ImageOrienter.apply(imageBitmap, orientation));\r\n        // need to convert so oriented image can be used as WebGL texture\r\n        // converting ImageBitmap to <canvas> (and then optionally to image data) fixes a Chrome render bug where the\r\n        // ImageBitmap when used in WebGL doesn't render in the correct orientation\r\n        // https://bugs.chromium.org/p/chromium/issues/detail?id=1082451&q=orientation%20imagebitmap&can=2\r\n        if (isChrome() && orientation > 1)\r\n            return resolve(await imageBitmapToImageData(imageBitmap));\r\n        // yay we got our bitmap\r\n        resolve(imageBitmap);\r\n    })();\r\n});\r\n\r\nvar imageDataContain = (imageData, size) => new Promise(async (resolve) => {\r\n    if (imageData.width < size.width && imageData.height < size.height)\r\n        return resolve(imageData);\r\n    const scalar = Math.min(size.width / imageData.width, size.height / imageData.height);\r\n    // scale\r\n    const targetWidth = scalar * imageData.width;\r\n    const targetHeight = scalar * imageData.height;\r\n    const canvas = h('canvas', {\r\n        width: targetWidth,\r\n        height: targetHeight,\r\n    });\r\n    const ctx = canvas.getContext('2d');\r\n    const data = isImageData(imageData)\r\n        ? (await imageDataToCanvas(imageData))\r\n        : imageData;\r\n    ctx.drawImage(data, 0, 0, targetWidth, targetHeight);\r\n    resolve(canvasToImageData(canvas));\r\n});\r\n\r\nvar hexToRGB = (str) => {\r\n    const [, q, w, e] = str.split('');\r\n    str = str.length === 4 ? `#${q}${q}${w}${w}${e}${e}` : str;\r\n    const [, r, g, b] = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(str);\r\n    return [r, g, b].map((v) => parseInt(v, 16) / 255);\r\n};\r\n\r\nvar colorStringToColorArray = (color) => {\r\n    color = color.trim();\r\n    // if rgba(128, 128, 128, .5)\r\n    if (/^rgba/.test(color)) {\r\n        return color\r\n            .substr(5)\r\n            .split(',')\r\n            .map(parseFloat)\r\n            .map((v, i) => v / (i === 3 ? 1 : 255));\r\n    }\r\n    // if rgb(128, 128, 128)\r\n    if (/^rgb/.test(color)) {\r\n        return color\r\n            .substr(4)\r\n            .split(',')\r\n            .map(parseFloat)\r\n            .map((v) => v / 255);\r\n    }\r\n    // if #777\r\n    if (/^#/.test(color)) {\r\n        return hexToRGB(color);\r\n    }\r\n    // is possibly 255, 0, 0\r\n    if (/[0-9]{1,3}\\s?,\\s?[0-9]{1,3}\\s?,\\s?[0-9]{1,3}/.test(color)) {\r\n        return color\r\n            .split(',')\r\n            .map((v) => parseInt(v, 10))\r\n            .map((v) => v / 255);\r\n    }\r\n    // undefined if no idea\r\n};\r\n\r\nlet result$4 = null;\r\nvar supportsWebGL = () => {\r\n    if (result$4 === null) {\r\n        let canvas = h('canvas');\r\n        result$4 = !!getWebGLContext(canvas);\r\n        releaseCanvas(canvas);\r\n        canvas = undefined;\r\n    }\r\n    return result$4;\r\n};\r\n\r\nvar isBitmap = (file) => /^image/.test(file.type) && !/svg/.test(file.type);\r\n\r\n// @ts-ignore\r\nconst COLOR_MATRIX_IDENTITY = [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0];\r\nconst SPRING_PROPS = { precision: 0.0001 };\r\nconst SPRING_PROPS_FRACTION = { precision: SPRING_PROPS.precision * 0.01 };\r\nvar createImage = (data, size, options = {}) => {\r\n    const { resize: resizeInitial = 1, opacity: opacityInitial = 0 } = options;\r\n    const stores = {\r\n        // interface\r\n        opacity: [spring(opacityInitial, { ...SPRING_PROPS, stiffness: 0.1 }), passthrough],\r\n        resize: [spring(resizeInitial, { ...SPRING_PROPS, stiffness: 0.1 }), passthrough],\r\n        // transforms\r\n        translation: [spring(undefined, SPRING_PROPS), passthrough],\r\n        rotation: [spring(undefined, SPRING_PROPS_FRACTION), passthrough],\r\n        origin: [spring(undefined, SPRING_PROPS), passthrough],\r\n        scale: [spring(undefined, SPRING_PROPS_FRACTION), passthrough],\r\n        gamma: [spring(undefined, SPRING_PROPS_FRACTION), (v) => v || 1],\r\n        vignette: [spring(undefined, SPRING_PROPS_FRACTION), (v) => v || 0],\r\n        colorMatrix: [\r\n            spring([...COLOR_MATRIX_IDENTITY], SPRING_PROPS),\r\n            (v) => v || [...COLOR_MATRIX_IDENTITY],\r\n        ],\r\n        convolutionMatrix: [writable(undefined), (v) => (v && v.clarity) || undefined],\r\n        backgroundColor: [spring(undefined, SPRING_PROPS), passthrough],\r\n        backgroundImage: [writable(undefined), passthrough],\r\n    };\r\n    // shortcut to quickly get all stores from the stores object\r\n    const storeEntries = Object.entries(stores).map(([key, value]) => [key, value[0]]);\r\n    const storeArray = storeEntries.map(([, store]) => store);\r\n    // create quick accessors to store value setter functions, best to do ones on creation instead of on each update\r\n    const storeSetters = Object.entries(stores).reduce((prev, [key, value]) => {\r\n        const [store, getValue] = value;\r\n        prev[key] = (value, opts) => store.set(getValue(value), opts);\r\n        return prev;\r\n    }, {});\r\n    // holds current derived state so can be easily read from from the outside\r\n    let stateCache;\r\n    //\r\n    const state = derived(storeArray, (storeValues) => {\r\n        // get new state\r\n        stateCache = storeValues.reduce((calculatedState, value, index) => {\r\n            const key = storeEntries[index][0];\r\n            calculatedState[key] = value;\r\n            return calculatedState;\r\n        }, {});\r\n        // set base image props\r\n        stateCache.data = data;\r\n        stateCache.size = size;\r\n        // apply resize modifier (is at index 1 of storeValues)\r\n        stateCache.scale *= storeValues[1];\r\n        return stateCache;\r\n    });\r\n    state.get = () => stateCache;\r\n    state.set = (props, animate) => {\r\n        const opts = { hard: !animate };\r\n        Object.entries(props).forEach(([key, value]) => {\r\n            if (!storeSetters[key])\r\n                return;\r\n            storeSetters[key](value, opts);\r\n        });\r\n    };\r\n    return state;\r\n};\r\n\r\nvar storeList = () => {\r\n    const stores = [];\r\n    const subscribers = [];\r\n    const state = [];\r\n    const storeDidUpdate = (store, value) => {\r\n        const index = stores.indexOf(store);\r\n        if (index < 0)\r\n            return;\r\n        state[index] = value;\r\n        triggerUpdate();\r\n    };\r\n    const triggerUpdate = () => {\r\n        subscribers.forEach((fn) => fn(state));\r\n    };\r\n    const addStore = (store) => {\r\n        store.unsub = store.subscribe((value) => storeDidUpdate(store, value));\r\n        triggerUpdate();\r\n    };\r\n    const unshift = (store) => {\r\n        stores.unshift(store);\r\n        addStore(store);\r\n    };\r\n    const push = (store) => {\r\n        stores.push(store);\r\n        addStore(store);\r\n    };\r\n    const clear = () => {\r\n        stores.forEach((store) => store.unsub());\r\n        stores.length = 0;\r\n        state.length = 0;\r\n    };\r\n    const remove = (store) => {\r\n        store.unsub();\r\n        const index = stores.indexOf(store);\r\n        stores.splice(index, 1);\r\n        state.splice(index, 1);\r\n    };\r\n    const subscribe = (fn) => {\r\n        subscribers.push(fn);\r\n        fn(state);\r\n        return () => {\r\n            subscribers.splice(subscribers.indexOf(fn), 1);\r\n        };\r\n    };\r\n    const forEach = (fn) => stores.forEach(fn);\r\n    const filter = (fn) => stores.filter(fn);\r\n    const get = (index) => stores[index];\r\n    return {\r\n        get length() {\r\n            return stores.length;\r\n        },\r\n        clear,\r\n        unshift,\r\n        get,\r\n        push,\r\n        remove,\r\n        forEach,\r\n        filter,\r\n        subscribe,\r\n    };\r\n};\r\n\r\nvar isDarkColor = (color) => color[0] < 0.25 && color[1] < 0.25 && color[2] < 0.25;\r\n\r\nvar browse = (options = {}) => new Promise((resolve) => {\r\n    // can now pass options\r\n    const { accept = 'image/*' } = options;\r\n    // create file input box\r\n    const fileInput = h('input', {\r\n        style: 'position:absolute;visibility:hidden;width:0;height:0;',\r\n        type: 'file',\r\n        accept,\r\n    });\r\n    // listen for file changes on input\r\n    const handleFileChange = () => {\r\n        // get file, if one was selected\r\n        const [file] = fileInput.files;\r\n        // clean up\r\n        fileInput.parentNode && fileInput.remove();\r\n        fileInput.removeEventListener('change', handleFileChange);\r\n        // done\r\n        resolve(file);\r\n    };\r\n    // listen for changes\r\n    fileInput.addEventListener('change', handleFileChange);\r\n    // need to attach to DOM for Safari 15+\r\n    isIOS() && document.body.append(fileInput);\r\n    // open browse window\r\n    fileInput.click();\r\n    // there is no way to reliably detect \"cancel\" event on browsers so we'll leave it be for now\r\n});\r\n\r\nvar runSafe = (cb) => {\r\n    try {\r\n        return cb();\r\n    }\r\n    catch (err) {\r\n        console.error(err);\r\n    }\r\n};\r\n\r\nlet result$3 = null;\r\nvar isAndroid = () => {\r\n    if (result$3 === null)\r\n        result$3 = isUserAgent(/Android/);\r\n    return result$3;\r\n};\r\n\r\nvar getRangeCenter = ([min, max]) => min + (max - min) * 0.5;\r\n\r\nvar toPercentageNumber = (v) => Math.round(v * 100);\r\n\r\nvar getEventPositionInViewport = (e) => vectorCreate(e.clientX, e.clientY);\r\n\r\nvar getEventPositionInStage = (e, viewOffset, stageOffset) => {\r\n    const positionInViewport = getEventPositionInViewport(e);\r\n    return vectorSubtract(vectorSubtract(positionInViewport, viewOffset), stageOffset);\r\n};\r\n\r\n/* src/core/ui/components/CanvasPanAndZoom.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction instance$x($$self, $$props, $$invalidate) {\r\n\tlet canZoom;\r\n\tlet canPan;\r\n\tlet imageFitsOnStage;\r\n\tlet zoomLevels;\r\n\tlet zoomMin;\r\n\tlet zoomMax;\r\n\tlet zoomLevelSelectedIndex;\r\n\tlet zoomLevelCurrent;\r\n\tlet zoomLevelLabel;\r\n\tlet $imageSelectionPan;\r\n\tlet $imageSelectionZoom;\r\n\tlet $imageSelectionRect;\r\n\tlet $stageRect;\r\n\tlet $rootRect;\r\n\tlet $imageSelectionStageFitScalar;\r\n\tlet $imagePreviewUpscale;\r\n\tlet $isInteracting;\r\n\tlet $stageScalar;\r\n\tlet $isAnimated;\r\n\tlet $imageSelectionStoredState;\r\n\tlet { root } = $$props;\r\n\tlet { locale } = $$props;\r\n\tlet { stores } = $$props;\r\n\tlet { allowPan = true } = $$props;\r\n\tlet { allowZoom = true } = $$props;\r\n\tlet { enablePan = true } = $$props;\r\n\tlet { enableZoom = true } = $$props;\r\n\tlet { enableZoomControls = enableZoom } = $$props;\r\n\tlet { enableZoomInput = true } = $$props;\r\n\tlet { enablePanInput = true } = $$props;\r\n\tlet { enablePanLimit = true } = $$props;\r\n\tlet { panLimitGutterScalar = 0 } = $$props;\r\n\tlet { zoomOptions = [0.25, 0.5, 1, 1.25, 1.5, 2, 3, 4, 6, 8, 16] } = $$props;\r\n\tlet { zoomAdjustStep = 0.25 } = $$props;\r\n\tlet { zoomAdjustFactor = 0.1 } = $$props;\r\n\tlet { zoomAdjustWheelFactor = 1 } = $$props;\r\n\tlet { elasticity = 5 } = $$props;\r\n\tlet { imageSelectionRectCentered = undefined } = $$props;\r\n\tlet { imageSelectionRectScalar = undefined } = $$props;\r\n\tlet { zoomLevel = null } = $$props;\r\n\tlet { zoomControls } = $$props;\r\n\tlet { zoomMultiTouching = false } = $$props;\r\n\tconst { isAnimated, isInteracting, rootRect, stageRect, stageScalar, imageSelectionPan, imageSelectionZoom, imageSelectionStageFitScalar, imageSelectionRect, imageSelectionStoredState, imagePreviewUpscale } = stores;\r\n\tcomponent_subscribe($$self, isAnimated, value => $$invalidate(64, $isAnimated = value));\r\n\tcomponent_subscribe($$self, isInteracting, value => $$invalidate(63, $isInteracting = value));\r\n\tcomponent_subscribe($$self, rootRect, value => $$invalidate(62, $rootRect = value));\r\n\tcomponent_subscribe($$self, stageRect, value => $$invalidate(61, $stageRect = value));\r\n\tcomponent_subscribe($$self, stageScalar, value => $$invalidate(45, $stageScalar = value));\r\n\tcomponent_subscribe($$self, imageSelectionPan, value => $$invalidate(59, $imageSelectionPan = value));\r\n\tcomponent_subscribe($$self, imageSelectionZoom, value => $$invalidate(42, $imageSelectionZoom = value));\r\n\tcomponent_subscribe($$self, imageSelectionStageFitScalar, value => $$invalidate(43, $imageSelectionStageFitScalar = value));\r\n\tcomponent_subscribe($$self, imageSelectionRect, value => $$invalidate(60, $imageSelectionRect = value));\r\n\tcomponent_subscribe($$self, imageSelectionStoredState, value => $$invalidate(65, $imageSelectionStoredState = value));\r\n\tcomponent_subscribe($$self, imagePreviewUpscale, value => $$invalidate(44, $imagePreviewUpscale = value));\r\n\r\n\t// to toggle mouse cursor\r\n\tlet isPanning = false;\r\n\r\n\tlet panOrigin = undefined;\r\n\tlet zoomOrigin = undefined;\r\n\tlet isPanningToCenter = undefined;\r\n\tlet currentDistanceToCenter = undefined;\r\n\r\n\tconst shouldStartInteraction = e => {\r\n\t\t// currently active stage panel\r\n\t\tconst main = root.querySelector('.PinturaMain > .PinturaUtilMain') || root.querySelector('div[tabindex=\"0\"] .PinturaUtilMain');\r\n\r\n\t\t// somehow main not found\r\n\t\tif (!main) return false;\r\n\r\n\t\t// only handle if is interaction in main stage\r\n\t\tif (!main.contains(e.target)) return false;\r\n\r\n\t\t// never on text fields\r\n\t\tif (isTextField(e.target)) return false;\r\n\r\n\t\treturn true;\r\n\t};\r\n\r\n\tconst storePanAndZoom = (options = {}) => {\r\n\t\tconst { pan = $imageSelectionPan, zoom = $imageSelectionZoom } = options;\r\n\t\tset_store_value(imageSelectionStoredState, $imageSelectionStoredState = { translation: pan, zoom }, $imageSelectionStoredState);\r\n\t};\r\n\r\n\tconst isImageSelectionPanCentered = () => $imageSelectionPan && $imageSelectionPan.x === 0 && $imageSelectionPan.y === 0;\r\n\r\n\tconst resetPanToCenter = () => {\r\n\t\tif (isImageSelectionPanCentered()) return;\r\n\t\tset_store_value(imageSelectionPan, $imageSelectionPan = vectorCreateEmpty(), $imageSelectionPan);\r\n\t};\r\n\r\n\tconst restorePanAndZoom = () => {\r\n\t\tset_store_value(imageSelectionZoom, $imageSelectionZoom = enableZoom ? $imageSelectionStoredState.zoom : undefined, $imageSelectionZoom);\r\n\r\n\t\tset_store_value(\r\n\t\t\timageSelectionPan,\r\n\t\t\t$imageSelectionPan = enablePan\r\n\t\t\t? vectorClone($imageSelectionStoredState.translation)\r\n\t\t\t: isImageSelectionPanCentered()\r\n\t\t\t\t? $imageSelectionPan\r\n\t\t\t\t: vectorCreateEmpty(),\r\n\t\t\t$imageSelectionPan\r\n\t\t);\r\n\r\n\t\tzoomAdjust.set($imageSelectionZoom);\r\n\t};\r\n\r\n\tconst resetPanAndZoom = () => {\r\n\t\tset_store_value(imageSelectionZoom, $imageSelectionZoom = undefined, $imageSelectionZoom);\r\n\t\tresetPanToCenter();\r\n\t\tzoomAdjust.set(undefined, { hard: true });\r\n\t};\r\n\r\n\tconst snapToCenter = () => {\r\n\t\tresetPanAndZoom();\r\n\t\tstorePanAndZoom();\r\n\t};\r\n\r\n\t// this smoothens updates to the zoom level\r\n\tconst zoomAdjust = spring(undefined, { precision: 0.01 });\r\n\r\n\tzoomAdjust.subscribe(newValue => {\r\n\t\t// no value yet, wait\r\n\t\tif (newValue === undefined) {\r\n\t\t\tset_store_value(imageSelectionZoom, $imageSelectionZoom = undefined, $imageSelectionZoom);\r\n\t\t\tif (!isImageSelectionPanCentered()) set_store_value(imageSelectionPan, $imageSelectionPan = vectorCreateEmpty(), $imageSelectionPan);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst currentValue = $imageSelectionZoom;\r\n\r\n\t\tif (newValue <= 1) {\r\n\t\t\tif (!isImageSelectionPanCentered()) set_store_value(imageSelectionPan, $imageSelectionPan = vectorCreateEmpty(), $imageSelectionPan);\r\n\t\t} else if (newValue <= currentValue) {\r\n\t\t\tset_store_value(imageSelectionPan, $imageSelectionPan = vectorMultiply($imageSelectionPan, 0.8), $imageSelectionPan);\r\n\t\t}\r\n\r\n\t\tset_store_value(imageSelectionZoom, $imageSelectionZoom = newValue, $imageSelectionZoom);\r\n\t});\r\n\r\n\tconst updateZoomAdjust = update => {\r\n\t\tzoomAdjust.update(currentValue => {\r\n\t\t\tconst newValue = update(currentValue || $imageSelectionStageFitScalar);\r\n\r\n\t\t\t// remember new value\r\n\t\t\tstorePanAndZoom({ zoom: newValue });\r\n\r\n\t\t\treturn newValue;\r\n\t\t});\r\n\t};\r\n\r\n\tconst setZoomAdjust = newValue => {\r\n\t\tif (!newValue) {\r\n\t\t\tnewValue = undefined;\r\n\t\t\tzoomAdjust.set(undefined, { hard: true });\r\n\t\t} else {\r\n\t\t\tzoomAdjust.set(newValue, { hard: $isAnimated === false });\r\n\t\t}\r\n\r\n\t\t// update zoom\r\n\t\tset_store_value(imageSelectionZoom, $imageSelectionZoom = newValue, $imageSelectionZoom);\r\n\r\n\t\t// remember\r\n\t\tstorePanAndZoom({ zoom: newValue });\r\n\t};\r\n\r\n\tconst getSelectedZoomLevel = (levels, currentScalar) => levels.findIndex(level => level === currentScalar);\r\n\r\n\t//\r\n\t// interaction\r\n\t//\r\n\tconst getPanLimitedTranslation = (pan, zoom) => {\r\n\t\tconst scalar = imageSelectionRectScalar * zoom;\r\n\r\n\t\t// this is the current image centered on the stage which we'll use as drag bounds\r\n\t\tconst safeRect = { ...imageSelectionRectCentered };\r\n\r\n\t\t// apply gutter\r\n\t\tconst gutterScalar = 1.0 - clamp(panLimitGutterScalar, 0.0, 1.0);\r\n\r\n\t\trectScale$1(safeRect, scalar < gutterScalar ? scalar : gutterScalar);\r\n\r\n\t\t// here we need to\r\n\t\tconst nextRect = { ...imageSelectionRectCentered };\r\n\r\n\t\trectScale$1(nextRect, scalar);\r\n\t\trectTranslate$1(nextRect, pan);\r\n\t\tconst nextRectLimited = { ...nextRect };\r\n\t\tif (nextRect.x > safeRect.x) nextRectLimited.x = safeRect.x;\r\n\t\tif (nextRect.y > safeRect.y) nextRectLimited.y = safeRect.y;\r\n\t\tif (nextRect.x + nextRect.width < safeRect.x + safeRect.width) nextRectLimited.x = safeRect.x + safeRect.width - nextRect.width;\r\n\t\tif (nextRect.y + nextRect.height < safeRect.y + safeRect.height) nextRectLimited.y = safeRect.y + safeRect.height - nextRect.height;\r\n\t\treturn vectorSubtract(rectCenter(nextRectLimited), rectCenter(safeRect));\r\n\t};\r\n\r\n\tconst manipulatePan = ({ translation, zoom = 1, elastify = true }) => {\r\n\t\tif (!panOrigin) return;\r\n\t\tlet panTranslation = translation;\r\n\t\tconst nextPan = vectorCreate(panOrigin.x + panTranslation.x, panOrigin.y + panTranslation.y);\r\n\t\tif (!enablePanLimit) return nextPan;\r\n\t\tconst nextPanLimited = getPanLimitedTranslation(nextPan, zoom);\r\n\r\n\t\treturn elastify\r\n\t\t? elastifyVectors(nextPanLimited, nextPan, elasticity)\r\n\t\t: nextPanLimited;\r\n\t};\r\n\r\n\tlet didPan;\r\n\tlet lastDragInteraction;\r\n\r\n\tconst handleDragStart = () => {\r\n\t\tlastDragInteraction = undefined;\r\n\r\n\t\t// set to true so updates aren't animated\r\n\t\tset_store_value(isInteracting, $isInteracting = true, $isInteracting);\r\n\r\n\t\t// set to true so grab cursor is shown\r\n\t\t$$invalidate(33, isPanning = enablePanInput);\r\n\r\n\t\t// did interact with canvas\r\n\t\tdidPan = false;\r\n\r\n\t\t// we need to determine if panning to center so we can snap zoom\r\n\t\tisPanningToCenter = false;\r\n\r\n\t\t// so we can correctly apply drag translation\r\n\t\tpanOrigin = { ...$imageSelectionPan };\r\n\r\n\t\t// so we can correctly apply zoom adjustment\r\n\t\tzoomOrigin = $imagePreviewUpscale\r\n\t\t? $imageSelectionZoom || $imageSelectionStageFitScalar\r\n\t\t: imageFitsOnStage\r\n\t\t\t? $imageSelectionZoom || 1\r\n\t\t\t: $imageSelectionZoom || $imageSelectionStageFitScalar;\r\n\t};\r\n\r\n\tconst handleDrag = e => {\r\n\t\tconst { scalar, translation, isMultiTouching } = e.detail;\r\n\t\tif (!panOrigin || !(isMultiTouching || enablePanInput)) return;\r\n\r\n\t\t// TODO: research why this is needed. this makes movement of image better align with touch,\r\n\t\t// misalignment problem originates in `interactable`\r\n\t\t// this \"fix\" works here because we can only multitouch, it doesn't work in crop util because user can switch between single and multi input\r\n\t\tisMultiTouching && vectorMultiply(translation, 0.5);\r\n\r\n\t\tif (enablePanInput || isMultiTouching) didPan = true;\r\n\r\n\t\t// set to true when multiple fingers detected\r\n\t\tif (!zoomMultiTouching) $$invalidate(12, zoomMultiTouching = isMultiTouching);\r\n\r\n\t\t// next zoom\r\n\t\tconst nextZoom = canZoom\r\n\t\t? clamp(zoomOrigin * scalar, zoomMin, zoomMax)\r\n\t\t: 1;\r\n\r\n\t\t// need this info to determine if we're panning to center\r\n\t\tconst nextPan = manipulatePan({\r\n\t\t\ttranslation,\r\n\t\t\tzoom: nextZoom,\r\n\t\t\telastify: true\r\n\t\t});\r\n\r\n\t\t// calculate if is panning to center, we'll look at the result when user is done interacting with the canvas\r\n\t\tconst nextDistanceToCenter = vectorLength(nextPan);\r\n\r\n\t\tconst currentPan = $imageSelectionPan;\r\n\t\tcurrentDistanceToCenter = vectorLength(currentPan);\r\n\t\tisPanningToCenter = nextDistanceToCenter < currentDistanceToCenter;\r\n\r\n\t\t// assign new pan/zoom values\r\n\t\tif (canZoom) imageSelectionZoom.set(nextZoom);\r\n\r\n\t\timageSelectionPan.set(nextPan);\r\n\r\n\t\tlastDragInteraction = zoomMultiTouching && {\r\n\t\t\ttranslation: e.detail.translation,\r\n\t\t\tscalar\r\n\t\t};\r\n\t};\r\n\r\n\tconst handleDragRelease = e => {\r\n\t\tset_store_value(isInteracting, $isInteracting = false, $isInteracting);\r\n\t\t$$invalidate(33, isPanning = false);\r\n\t\t$$invalidate(12, zoomMultiTouching = false);\r\n\r\n\t\t// if is panning to center snap to center\r\n\t\tif (isPanningToCenter && currentDistanceToCenter < 50) {\r\n\t\t\t// stop drag action\r\n\t\t\tpanOrigin = undefined;\r\n\r\n\t\t\tzoomOrigin = undefined;\r\n\t\t\timageSelectionPan.set(vectorCreateEmpty());\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleDragEnd = e => {\r\n\t\t// done interacting\r\n\t\tset_store_value(isInteracting, $isInteracting = false, $isInteracting);\r\n\r\n\t\t// clean up\r\n\t\t$$invalidate(33, isPanning = false);\r\n\r\n\t\t$$invalidate(12, zoomMultiTouching = false);\r\n\r\n\t\t// to make sure interaction is turned off before pan is updated we set it on next tick\r\n\t\t// this is a bit of a hack.\r\n\t\t// TODO: look into queueing interaction and ui updates so we can reliably disable/enable isInteracting and then run ui updates so they're properly animated\r\n\t\tPromise.resolve().then(() => {\r\n\t\t\tif (didPan && panOrigin) {\r\n\t\t\t\tconst interaction = lastDragInteraction || e.detail;\r\n\r\n\t\t\t\t// next zoom\r\n\t\t\t\tconst nextZoom = canZoom\r\n\t\t\t\t? clamp(zoomOrigin * interaction.scalar, zoomMin, zoomMax)\r\n\t\t\t\t: 1;\r\n\r\n\t\t\t\t// snap back to center if needed\r\n\t\t\t\tconst nextPan = manipulatePan({\r\n\t\t\t\t\telastify: false,\r\n\t\t\t\t\ttranslation: interaction.translation,\r\n\t\t\t\t\tzoom: nextZoom\r\n\t\t\t\t});\r\n\r\n\t\t\t\timageSelectionPan.set(nextPan);\r\n\t\t\t}\r\n\r\n\t\t\tpanOrigin = undefined;\r\n\t\t\tzoomOrigin = undefined;\r\n\r\n\t\t\t// reset zoom\r\n\t\t\tif (enablePanInput && e.detail.isDoubleTap) snapToCenter();\r\n\r\n\t\t\t// store for future\r\n\t\t\tstorePanAndZoom();\r\n\t\t});\r\n\t};\r\n\r\n\t// wheel input\r\n\tlet lastWheelEventTimestamp = Date.now();\r\n\r\n\tlet wheelSnapZoomTimer;\r\n\tlet wheelFastZoomCounter = 0;\r\n\tlet wheelFastZoomShouldHandle = false;\r\n\tlet didSnap = false;\r\n\r\n\tconst handleWheel = e => {\r\n\t\t// determine if wheel position is over image, else ignore\r\n\t\tif (!shouldStartInteraction(e)) return;\r\n\r\n\t\t// don't run default actions, prevent other actions from running\r\n\t\te.preventDefault();\r\n\r\n\t\te.stopPropagation();\r\n\t\tif (didSnap) return;\r\n\t\tclearTimeout(wheelSnapZoomTimer);\r\n\t\tconst newTranslation = vectorCreateEmpty();\r\n\t\tconst currentTranslation = $imageSelectionPan;\r\n\r\n\t\t// for determining if fast zooming\r\n\t\tconst now = Date.now();\r\n\r\n\t\tconst wheelInterval = now - lastWheelEventTimestamp;\r\n\t\tlastWheelEventTimestamp = now;\r\n\t\tconst isZoomingFast = wheelInterval < 24;\r\n\t\twheelFastZoomCounter = isZoomingFast ? wheelFastZoomCounter + 1 : 0;\r\n\r\n\t\t// convert wheel delta to scalar\r\n\t\tconst delta = getWheelDelta(e) * -1 * zoomAdjustWheelFactor;\r\n\r\n\t\tconst scalar = 1 + delta / (isZoomingFast ? 50 : 100);\r\n\r\n\t\t// update zoom\r\n\t\tconst zoomCenter = $imagePreviewUpscale\r\n\t\t? $imageSelectionStageFitScalar\r\n\t\t: imageFitsOnStage ? 1 : $imageSelectionStageFitScalar;\r\n\r\n\t\tconst currentZoom = $imagePreviewUpscale\r\n\t\t? $imageSelectionZoom || $imageSelectionStageFitScalar\r\n\t\t: imageFitsOnStage\r\n\t\t\t? $imageSelectionZoom || 1\r\n\t\t\t: $imageSelectionZoom || $imageSelectionStageFitScalar;\r\n\r\n\t\tconst nextZoom = currentZoom * scalar;\r\n\t\tconst nextZoomDistanceToCenter = Math.abs(nextZoom - zoomCenter);\r\n\r\n\t\t// zoom state\r\n\t\tconst isZoomedIn = currentZoom > zoomCenter;\r\n\r\n\t\tconst isZoomedOut = currentZoom < zoomCenter;\r\n\t\tconst isZoomingIn = nextZoom > currentZoom;\r\n\t\tconst isZoomingOut = nextZoom < currentZoom;\r\n\t\tconst isZoomingToCenter = isZoomedIn && isZoomingOut || isZoomedOut && isZoomingIn;\r\n\t\tconst isZoomingFlick = wheelFastZoomCounter >= 5;\r\n\r\n\t\tif (!isZoomingFast) {\r\n\t\t\twheelFastZoomShouldHandle = false;\r\n\t\t}\r\n\r\n\t\tif (wheelFastZoomCounter > 0 && !wheelFastZoomShouldHandle) {\r\n\t\t\twheelFastZoomShouldHandle = isZoomingToCenter;\r\n\t\t}\r\n\r\n\t\t// quick snap to place\r\n\t\tif (isZoomingFlick && wheelFastZoomShouldHandle) {\r\n\t\t\tsnapToCenter();\r\n\t\t\tdidSnap = true;\r\n\r\n\t\t\tsetTimeout(\r\n\t\t\t\t() => {\r\n\t\t\t\t\tdidSnap = false;\r\n\t\t\t\t},\r\n\t\t\t\t100\r\n\t\t\t);\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// stop here, if flicks wheel we're not going to handle it\r\n\t\tif (isZoomingFlick) return;\r\n\r\n\t\t// snap when positioned very close to center\r\n\t\tif (!isZoomingFast && isZoomingToCenter && nextZoomDistanceToCenter <= 0.05) {\r\n\t\t\twheelSnapZoomTimer = setTimeout(\r\n\t\t\t\t() => {\r\n\t\t\t\t\tsnapToCenter();\r\n\t\t\t\t},\r\n\t\t\t\t250\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// update zoom\r\n\t\tset_store_value(imageSelectionZoom, $imageSelectionZoom = clamp(nextZoom, zoomMin, zoomMax), $imageSelectionZoom);\r\n\r\n\t\t// get wheel position so we can zoom to specific area of image\r\n\t\tconst stageWheelPosition = getEventPositionInStage(e, $rootRect, $stageRect);\r\n\r\n\t\tconst originSelectionRect = rectClone$1($imageSelectionRect);\r\n\t\trectScale$1(originSelectionRect, currentZoom);\r\n\t\trectTranslate$1(originSelectionRect, currentTranslation);\r\n\t\tconst originSelectionRectCenter = rectCenter(originSelectionRect);\r\n\t\tconst zoomedSelectionRect = rectClone$1(originSelectionRect);\r\n\t\trectScale$1(zoomedSelectionRect, 1 + ($imageSelectionZoom - currentZoom), stageWheelPosition);\r\n\t\tconst zoomedSelectionRectCenter = rectCenter(zoomedSelectionRect);\r\n\t\tconst rectTranslation = vectorDivide(vectorSubtract(zoomedSelectionRectCenter, originSelectionRectCenter), currentZoom);\r\n\t\tvectorUpdate(newTranslation, currentTranslation.x + rectTranslation.x, currentTranslation.y + rectTranslation.y);\r\n\r\n\t\t//  if zooming out fast move to center\r\n\t\tif (isZoomingOut && isZoomingFast) {\r\n\t\t\tset_store_value(imageSelectionPan, $imageSelectionPan = vectorMultiply(vectorClone($imageSelectionPan), 0.85), $imageSelectionPan);\r\n\t\t} else {\r\n\t\t\tset_store_value(imageSelectionPan, $imageSelectionPan = getPanLimitedTranslation(newTranslation, currentZoom), $imageSelectionPan);\r\n\t\t}\r\n\r\n\t\t// store for future\r\n\t\tstorePanAndZoom();\r\n\t};\r\n\r\n\t// toggle listeners\r\n\tconst getListenerFunction = enable => {\r\n\t\treturn (enable ? 'add' : 'remove') + 'EventListener';\r\n\t};\r\n\r\n\tconst toggleZoomWheelInput = enable => {\r\n\t\troot[getListenerFunction(enable)]('wheel', handleWheel);\r\n\t};\r\n\r\n\tconst togglePanInput = enable => {\r\n\t\tconst fn = getListenerFunction(enable);\r\n\t\troot[fn]('interactionstart', handleDragStart);\r\n\t\troot[fn]('interactionupdate', handleDrag);\r\n\t\troot[fn]('interactionrelease', handleDragRelease);\r\n\t\troot[fn]('interactionend', handleDragEnd);\r\n\t};\r\n\r\n\t// mount & destroy\r\n\tlet interactableInstance;\r\n\r\n\tonMount(() => {\r\n\t\tinteractableInstance = interactable(root, {\r\n\t\t\tdrag: true,\r\n\t\t\tpinch: true,\r\n\t\t\tinertia: true,\r\n\t\t\tinertiaDurationMultiplier: 10,\r\n\t\t\tshouldStartInteraction\r\n\t\t});\r\n\t});\r\n\r\n\tonDestroy(() => {\r\n\t\ttoggleZoomWheelInput(false);\r\n\t\ttogglePanInput(false);\r\n\t\tinteractableInstance.destroy();\r\n\t\tinteractableInstance = undefined;\r\n\t});\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('root' in $$props) $$invalidate(13, root = $$props.root);\r\n\t\tif ('locale' in $$props) $$invalidate(14, locale = $$props.locale);\r\n\t\tif ('stores' in $$props) $$invalidate(15, stores = $$props.stores);\r\n\t\tif ('allowPan' in $$props) $$invalidate(16, allowPan = $$props.allowPan);\r\n\t\tif ('allowZoom' in $$props) $$invalidate(17, allowZoom = $$props.allowZoom);\r\n\t\tif ('enablePan' in $$props) $$invalidate(18, enablePan = $$props.enablePan);\r\n\t\tif ('enableZoom' in $$props) $$invalidate(19, enableZoom = $$props.enableZoom);\r\n\t\tif ('enableZoomControls' in $$props) $$invalidate(20, enableZoomControls = $$props.enableZoomControls);\r\n\t\tif ('enableZoomInput' in $$props) $$invalidate(21, enableZoomInput = $$props.enableZoomInput);\r\n\t\tif ('enablePanInput' in $$props) $$invalidate(22, enablePanInput = $$props.enablePanInput);\r\n\t\tif ('enablePanLimit' in $$props) $$invalidate(23, enablePanLimit = $$props.enablePanLimit);\r\n\t\tif ('panLimitGutterScalar' in $$props) $$invalidate(24, panLimitGutterScalar = $$props.panLimitGutterScalar);\r\n\t\tif ('zoomOptions' in $$props) $$invalidate(25, zoomOptions = $$props.zoomOptions);\r\n\t\tif ('zoomAdjustStep' in $$props) $$invalidate(26, zoomAdjustStep = $$props.zoomAdjustStep);\r\n\t\tif ('zoomAdjustFactor' in $$props) $$invalidate(27, zoomAdjustFactor = $$props.zoomAdjustFactor);\r\n\t\tif ('zoomAdjustWheelFactor' in $$props) $$invalidate(28, zoomAdjustWheelFactor = $$props.zoomAdjustWheelFactor);\r\n\t\tif ('elasticity' in $$props) $$invalidate(29, elasticity = $$props.elasticity);\r\n\t\tif ('imageSelectionRectCentered' in $$props) $$invalidate(30, imageSelectionRectCentered = $$props.imageSelectionRectCentered);\r\n\t\tif ('imageSelectionRectScalar' in $$props) $$invalidate(31, imageSelectionRectScalar = $$props.imageSelectionRectScalar);\r\n\t\tif ('zoomLevel' in $$props) $$invalidate(32, zoomLevel = $$props.zoomLevel);\r\n\t\tif ('zoomControls' in $$props) $$invalidate(11, zoomControls = $$props.zoomControls);\r\n\t\tif ('zoomMultiTouching' in $$props) $$invalidate(12, zoomMultiTouching = $$props.zoomMultiTouching);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*allowZoom, enableZoom, enableZoomInput*/ 2752512) {\r\n\t\t\t$$invalidate(35, canZoom = allowZoom && enableZoom && enableZoomInput);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*allowPan, enablePan*/ 327680) {\r\n\t\t\t$$invalidate(34, canPan = allowPan && enablePan);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*allowPan, allowZoom*/ 196608) {\r\n\t\t\t// restore when becomes active\r\n\t\t\tallowPan || allowZoom\r\n\t\t\t? restorePanAndZoom()\r\n\t\t\t: resetPanAndZoom();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$stageScalar*/ 16384) {\r\n\t\t\timageFitsOnStage = $stageScalar >= 1;\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*locale, zoomOptions*/ 33570816 | $$self.$$.dirty[1] & /*$imagePreviewUpscale, $stageScalar, $imageSelectionStageFitScalar*/ 28672) {\r\n\t\t\t// the list of zoom levels\r\n\t\t\t$$invalidate(39, zoomLevels = [\r\n\t\t\t\t// zoom level need to fit to view\r\n\t\t\t\t($imagePreviewUpscale || $stageScalar < 1) && [\r\n\t\t\t\t\t$imageSelectionStageFitScalar,\r\n\t\t\t\t\ttoPercentageNumber($imageSelectionStageFitScalar) + '%',\r\n\t\t\t\t\t{ sublabel: locale.labelZoomFit }\r\n\t\t\t\t],\r\n\t\t\t\t// custom zoom levels\r\n\t\t\t\t...zoomOptions.map(value => [value, toPercentageNumber(value) + '%'])\r\n\t\t\t].filter(Boolean).map(level => {\r\n\t\t\t\tif (level[0] === 1) level[2] = { sublabel: locale.labelZoomActual };\r\n\t\t\t\treturn level;\r\n\t\t\t}).sort((a, b) => {\r\n\t\t\t\tconst av = a[0] || $imageSelectionStageFitScalar;\r\n\t\t\t\tconst bv = b[0] || $imageSelectionStageFitScalar;\r\n\t\t\t\tif (av < bv) return -1;\r\n\t\t\t\tif (bv < av) return 1;\r\n\t\t\t\treturn 0;\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*zoomLevels, $imageSelectionStageFitScalar*/ 4352) {\r\n\t\t\t$$invalidate(37, zoomMin = Math.min(zoomLevels.reduce((min, [level]) => level < min ? level : min, Number.MAX_SAFE_INTEGER), $imageSelectionStageFitScalar));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*zoomLevels*/ 256) {\r\n\t\t\t$$invalidate(36, zoomMax = zoomLevels.reduce((max, [level]) => level > max ? level : max, Number.MIN_SAFE_INTEGER));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*zoomLevel*/ 2) {\r\n\t\t\tzoomLevel !== null && setZoomAdjust(zoomLevel);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$imageSelectionZoom, $imagePreviewUpscale, $stageScalar, $imageSelectionStageFitScalar*/ 30720) {\r\n\t\t\t$$invalidate(41, zoomLevelCurrent = $imageSelectionZoom\r\n\t\t\t? $imageSelectionZoom\r\n\t\t\t: $imagePreviewUpscale || $stageScalar < 1\r\n\t\t\t\t? $imageSelectionStageFitScalar\r\n\t\t\t\t: 1);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*zoomLevels, zoomLevelCurrent*/ 1280) {\r\n\t\t\t$$invalidate(38, zoomLevelSelectedIndex = getSelectedZoomLevel(zoomLevels.map(([level]) => level), zoomLevelCurrent));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*zoomLevelCurrent*/ 1024) {\r\n\t\t\t$$invalidate(40, zoomLevelLabel = toPercentageNumber(zoomLevelCurrent) + '%');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*allowZoom, enableZoomControls, locale, zoomAdjustStep, zoomAdjustFactor*/ 202522624 | $$self.$$.dirty[1] & /*$imageSelectionZoom, zoomMin, zoomLevelLabel, zoomLevels, zoomLevelSelectedIndex, zoomMax*/ 3040) {\r\n\t\t\t$$invalidate(11, zoomControls = (allowZoom || allowZoom) && enableZoomControls\r\n\t\t\t? [\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t'zoom-out',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\thideLabel: true,\r\n\t\t\t\t\t\t\tlabel: locale.labelZoomOut,\r\n\t\t\t\t\t\t\ticon: locale.iconZoomOut,\r\n\t\t\t\t\t\t\tdisabled: $imageSelectionZoom === zoomMin,\r\n\t\t\t\t\t\t\tonclick: () => updateZoomAdjust(value => Math.max(zoomMin, value - zoomAdjustStep)),\r\n\t\t\t\t\t\t\tonhold: () => updateZoomAdjust(value => Math.max(zoomMin, value * (1 - zoomAdjustFactor)))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t'Dropdown',\r\n\t\t\t\t\t\t'zoom-level',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlabel: zoomLevelLabel,\r\n\t\t\t\t\t\t\tlabelClass: 'PinturaFixedWidthCharacters',\r\n\t\t\t\t\t\t\toptions: zoomLevels,\r\n\t\t\t\t\t\t\tselectedIndex: zoomLevelSelectedIndex,\r\n\t\t\t\t\t\t\tonchange: item => setZoomAdjust(item.value)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t'zoom-in',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\thideLabel: true,\r\n\t\t\t\t\t\t\tlabel: locale.labelZoomIn,\r\n\t\t\t\t\t\t\ticon: locale.iconZoomIn,\r\n\t\t\t\t\t\t\tdisabled: $imageSelectionZoom === zoomMax,\r\n\t\t\t\t\t\t\tonclick: () => updateZoomAdjust(value => Math.min(zoomMax, value + zoomAdjustStep)),\r\n\t\t\t\t\t\t\tonhold: () => updateZoomAdjust(value => Math.min(zoomMax, value * (1 + zoomAdjustFactor)))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t]\r\n\t\t\t: []);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*root*/ 8192 | $$self.$$.dirty[1] & /*canZoom*/ 16) {\r\n\t\t\troot && toggleZoomWheelInput(canZoom);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*root*/ 8192 | $$self.$$.dirty[1] & /*canPan*/ 8) {\r\n\t\t\troot && togglePanInput(canPan);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*root, enablePanInput*/ 4202496 | $$self.$$.dirty[1] & /*canPan, isPanning*/ 12) {\r\n\t\t\troot && root.style.setProperty('--cursor', canPan && enablePanInput\r\n\t\t\t? isPanning ? 'grabbing' : 'grab'\r\n\t\t\t: '');\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tisAnimated,\r\n\t\tisInteracting,\r\n\t\trootRect,\r\n\t\tstageRect,\r\n\t\tstageScalar,\r\n\t\timageSelectionPan,\r\n\t\timageSelectionZoom,\r\n\t\timageSelectionStageFitScalar,\r\n\t\timageSelectionRect,\r\n\t\timageSelectionStoredState,\r\n\t\timagePreviewUpscale,\r\n\t\tzoomControls,\r\n\t\tzoomMultiTouching,\r\n\t\troot,\r\n\t\tlocale,\r\n\t\tstores,\r\n\t\tallowPan,\r\n\t\tallowZoom,\r\n\t\tenablePan,\r\n\t\tenableZoom,\r\n\t\tenableZoomControls,\r\n\t\tenableZoomInput,\r\n\t\tenablePanInput,\r\n\t\tenablePanLimit,\r\n\t\tpanLimitGutterScalar,\r\n\t\tzoomOptions,\r\n\t\tzoomAdjustStep,\r\n\t\tzoomAdjustFactor,\r\n\t\tzoomAdjustWheelFactor,\r\n\t\telasticity,\r\n\t\timageSelectionRectCentered,\r\n\t\timageSelectionRectScalar,\r\n\t\tzoomLevel,\r\n\t\tisPanning,\r\n\t\tcanPan,\r\n\t\tcanZoom,\r\n\t\tzoomMax,\r\n\t\tzoomMin,\r\n\t\tzoomLevelSelectedIndex,\r\n\t\tzoomLevels,\r\n\t\tzoomLevelLabel,\r\n\t\tzoomLevelCurrent,\r\n\t\t$imageSelectionZoom,\r\n\t\t$imageSelectionStageFitScalar,\r\n\t\t$imagePreviewUpscale,\r\n\t\t$stageScalar\r\n\t];\r\n}\r\n\r\nclass CanvasPanAndZoom extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$x,\r\n\t\t\tnull,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\troot: 13,\r\n\t\t\t\tlocale: 14,\r\n\t\t\t\tstores: 15,\r\n\t\t\t\tallowPan: 16,\r\n\t\t\t\tallowZoom: 17,\r\n\t\t\t\tenablePan: 18,\r\n\t\t\t\tenableZoom: 19,\r\n\t\t\t\tenableZoomControls: 20,\r\n\t\t\t\tenableZoomInput: 21,\r\n\t\t\t\tenablePanInput: 22,\r\n\t\t\t\tenablePanLimit: 23,\r\n\t\t\t\tpanLimitGutterScalar: 24,\r\n\t\t\t\tzoomOptions: 25,\r\n\t\t\t\tzoomAdjustStep: 26,\r\n\t\t\t\tzoomAdjustFactor: 27,\r\n\t\t\t\tzoomAdjustWheelFactor: 28,\r\n\t\t\t\telasticity: 29,\r\n\t\t\t\timageSelectionRectCentered: 30,\r\n\t\t\t\timageSelectionRectScalar: 31,\r\n\t\t\t\tzoomLevel: 32,\r\n\t\t\t\tzoomControls: 11,\r\n\t\t\t\tzoomMultiTouching: 12\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1, -1]\r\n\t\t);\r\n\t}\r\n}\r\n\r\n// Bytes for degree metadata\r\n// 0 degrees\r\n// 00010000 00000000 00000000 00000000\r\n// 00010000 00000000 00000000 00000000\r\n// 40\r\n// 90 degrees\r\n// 00000000 00010000 00000000 FFFF0000\r\n// 00000000 00000000 00000000 00000000\r\n// 40\r\n// 180 degrees\r\n// FFFF0000 00000000 00000000 00000000\r\n// FFFF0000 00000000 00000000 00000000\r\n// 40\r\n// 270 degrees\r\n// 00000000 FFFF0000 00000000 00010000\r\n// 00000000 00000000 00000000 00000000\r\n// 40\r\nvar getVideoFileRotationMetadata = async (file) => {\r\n    const buffer = await blobToArrayBuffer(file);\r\n    const view = new DataView(buffer);\r\n    return getRotationMetadataInDataView(view);\r\n};\r\nconst blobToArrayBuffer = (blob) => new Promise((resolve) => {\r\n    const reader = new FileReader();\r\n    reader.onload = () => resolve(reader.result);\r\n    reader.readAsArrayBuffer(blob);\r\n});\r\nconst getRotationMetadataInDataView = (view, { limit = 1024 } = {}) => {\r\n    const FTYP_MARKER = 0x66747970; // QuickTime Container File Type\r\n    const MP42_MARKER = 0x6d703432; // MP4 format\r\n    const TRAK_MARKER = 0x7472616b; // Video track\r\n    const ROTA_MARKER = 0x40; // Rotation byte\r\n    let offset = 0;\r\n    // const size = view.getUint32(offset);\r\n    offset += 4;\r\n    const container = view.getUint32(offset);\r\n    if (container !== FTYP_MARKER)\r\n        return 0;\r\n    offset += 4;\r\n    const format = view.getUint32(offset);\r\n    if (format !== MP42_MARKER)\r\n        return 0;\r\n    let inTrack = false;\r\n    // rotation marker offset\r\n    let r = -1;\r\n    for (let i = offset; i < limit; i++) {\r\n        // find start of video track\r\n        if (!inTrack && view.getUint32(i) === TRAK_MARKER) {\r\n            inTrack = true;\r\n            i += 4;\r\n        }\r\n        // not found yet, skip to next byte\r\n        if (!inTrack)\r\n            continue;\r\n        // found, let's search rotation marker\r\n        const value = view.getUint8(i);\r\n        // now looking for rotation marker offset\r\n        if (value == ROTA_MARKER) {\r\n            r = i;\r\n            break;\r\n        }\r\n    }\r\n    // rotation marker not found, exit\r\n    if (r < 0)\r\n        return 0;\r\n    // Let's read bytes preceding the rotation marker entry to check rotation value\r\n    const B = view.getUint32(r - 28);\r\n    const D = view.getUint32(r - 20);\r\n    const A = view.getUint32(r - 32);\r\n    const E = view.getUint32(r - 16);\r\n    if (B === 0x00010000 && D === 0xffff0000)\r\n        return 90;\r\n    else if (A === 0xffff0000 && E === 0xffff0000)\r\n        return 180;\r\n    else if (B === 0xffff0000 && D === 0x00010000)\r\n        return 270;\r\n    return 0;\r\n};\r\n\r\n/* src/core/ui/index.svelte generated by Svelte v3.50.1 */\r\n\r\nconst { window: window_1$1 } = globals;\r\n\r\nfunction create_if_block_1$7(ctx) {\r\n\tlet t;\r\n\tlet if_block1_anchor;\r\n\tlet current;\r\n\tlet if_block0 = /*isStatusVisible*/ ctx[39] && create_if_block_6$1(ctx);\r\n\tlet if_block1 = /*isReady*/ ctx[37] && create_if_block_2$6(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (if_block0) if_block0.c();\r\n\t\t\tt = space();\r\n\t\t\tif (if_block1) if_block1.c();\r\n\t\t\tif_block1_anchor = empty();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (if_block0) if_block0.m(target, anchor);\r\n\t\t\tinsert(target, t, anchor);\r\n\t\t\tif (if_block1) if_block1.m(target, anchor);\r\n\t\t\tinsert(target, if_block1_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (/*isStatusVisible*/ ctx[39]) {\r\n\t\t\t\tif (if_block0) {\r\n\t\t\t\t\tif_block0.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[1] & /*isStatusVisible*/ 256) {\r\n\t\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block0 = create_if_block_6$1(ctx);\r\n\t\t\t\t\tif_block0.c();\r\n\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\tif_block0.m(t.parentNode, t);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block0) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block0, 1, 1, () => {\r\n\t\t\t\t\tif_block0 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (/*isReady*/ ctx[37]) {\r\n\t\t\t\tif (if_block1) {\r\n\t\t\t\t\tif_block1.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[1] & /*isReady*/ 64) {\r\n\t\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block1 = create_if_block_2$6(ctx);\r\n\t\t\t\t\tif_block1.c();\r\n\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\tif_block1.m(if_block1_anchor.parentNode, if_block1_anchor);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block1) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block1, 1, 1, () => {\r\n\t\t\t\t\tif_block1 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block0);\r\n\t\t\ttransition_in(if_block1);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block0);\r\n\t\t\ttransition_out(if_block1);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (if_block0) if_block0.d(detaching);\r\n\t\t\tif (detaching) detach(t);\r\n\t\t\tif (if_block1) if_block1.d(detaching);\r\n\t\t\tif (detaching) detach(if_block1_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3187:8) {#if isStatusVisible}\r\nfunction create_if_block_6$1(ctx) {\r\n\tlet div;\r\n\tlet p;\r\n\tlet current_block_type_index;\r\n\tlet if_block;\r\n\tlet div_style_value;\r\n\tlet current;\r\n\tconst if_block_creators = [create_if_block_7, create_if_block_8];\r\n\tconst if_blocks = [];\r\n\r\n\tfunction select_block_type(ctx, dirty) {\r\n\t\tif (/*isSupportsError*/ ctx[38]) return 0;\r\n\t\tif (/*statusState*/ ctx[33]) return 1;\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tif (~(current_block_type_index = select_block_type(ctx))) {\r\n\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tp = element(\"p\");\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tattr(p, \"style\", /*statusTransform*/ ctx[67]);\r\n\t\t\tattr(div, \"class\", \"PinturaStatus\");\r\n\t\t\tattr(div, \"style\", div_style_value = `opacity: ${/*$statusOpacity*/ ctx[51]}`);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tappend(div, p);\r\n\r\n\t\t\tif (~current_block_type_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].m(p, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tlet previous_block_index = current_block_type_index;\r\n\t\t\tcurrent_block_type_index = select_block_type(ctx);\r\n\r\n\t\t\tif (current_block_type_index === previous_block_index) {\r\n\t\t\t\tif (~current_block_type_index) {\r\n\t\t\t\t\tif_blocks[current_block_type_index].p(ctx, dirty);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\t\ttransition_out(if_blocks[previous_block_index], 1, 1, () => {\r\n\t\t\t\t\t\tif_blocks[previous_block_index] = null;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tcheck_outros();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (~current_block_type_index) {\r\n\t\t\t\t\tif_block = if_blocks[current_block_type_index];\r\n\r\n\t\t\t\t\tif (!if_block) {\r\n\t\t\t\t\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t\t\t\t\t\tif_block.c();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif_block.p(ctx, dirty);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(p, null);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[2] & /*statusTransform*/ 32) {\r\n\t\t\t\tattr(p, \"style\", /*statusTransform*/ ctx[67]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[1] & /*$statusOpacity*/ 1048576 && div_style_value !== (div_style_value = `opacity: ${/*$statusOpacity*/ ctx[51]}`)) {\r\n\t\t\t\tattr(div, \"style\", div_style_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\r\n\t\t\tif (~current_block_type_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].d();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3200:42) \r\nfunction create_if_block_8(ctx) {\r\n\tlet statusmessage;\r\n\tlet t;\r\n\tlet if_block_anchor;\r\n\tlet current;\r\n\r\n\tstatusmessage = new StatusMessage({\r\n\t\t\tprops: {\r\n\t\t\t\ttext: /*statusState*/ ctx[33].text || '',\r\n\t\t\t\tonmeasure: /*offsetAside*/ ctx[187]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tlet if_block = /*statusState*/ ctx[33].aside && create_if_block_9(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(statusmessage.$$.fragment);\r\n\t\t\tt = space();\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tif_block_anchor = empty();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(statusmessage, target, anchor);\r\n\t\t\tinsert(target, t, anchor);\r\n\t\t\tif (if_block) if_block.m(target, anchor);\r\n\t\t\tinsert(target, if_block_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst statusmessage_changes = {};\r\n\t\t\tif (dirty[1] & /*statusState*/ 4) statusmessage_changes.text = /*statusState*/ ctx[33].text || '';\r\n\t\t\tstatusmessage.$set(statusmessage_changes);\r\n\r\n\t\t\tif (/*statusState*/ ctx[33].aside) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[1] & /*statusState*/ 4) {\r\n\t\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block_9(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(if_block_anchor.parentNode, if_block_anchor);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block, 1, 1, () => {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(statusmessage.$$.fragment, local);\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(statusmessage.$$.fragment, local);\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(statusmessage, detaching);\r\n\t\t\tif (detaching) detach(t);\r\n\t\t\tif (if_block) if_block.d(detaching);\r\n\t\t\tif (detaching) detach(if_block_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3190:20) {#if isSupportsError}\r\nfunction create_if_block_7(ctx) {\r\n\tlet statusmessage;\r\n\tlet t;\r\n\tlet statusaside;\r\n\tlet current;\r\n\r\n\tstatusmessage = new StatusMessage({\r\n\t\t\tprops: {\r\n\t\t\t\ttext: /*isSupportsError*/ ctx[38],\r\n\t\t\t\tonmeasure: /*offsetAside*/ ctx[187]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tstatusaside = new StatusAside({\r\n\t\t\tprops: {\r\n\t\t\t\tclass: \"PinturaStatusIcon\",\r\n\t\t\t\toffset: /*$asideOffset*/ ctx[77],\r\n\t\t\t\topacity: /*$asideOpacity*/ ctx[78],\r\n\t\t\t\t$$slots: { default: [create_default_slot_4$1] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(statusmessage.$$.fragment);\r\n\t\t\tt = space();\r\n\t\t\tcreate_component(statusaside.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(statusmessage, target, anchor);\r\n\t\t\tinsert(target, t, anchor);\r\n\t\t\tmount_component(statusaside, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst statusmessage_changes = {};\r\n\t\t\tif (dirty[1] & /*isSupportsError*/ 128) statusmessage_changes.text = /*isSupportsError*/ ctx[38];\r\n\t\t\tstatusmessage.$set(statusmessage_changes);\r\n\t\t\tconst statusaside_changes = {};\r\n\t\t\tif (dirty[2] & /*$asideOffset*/ 32768) statusaside_changes.offset = /*$asideOffset*/ ctx[77];\r\n\t\t\tif (dirty[2] & /*$asideOpacity*/ 65536) statusaside_changes.opacity = /*$asideOpacity*/ ctx[78];\r\n\r\n\t\t\tif (dirty[0] & /*locale*/ 8 | dirty[16] & /*$$scope*/ 512) {\r\n\t\t\t\tstatusaside_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tstatusaside.$set(statusaside_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(statusmessage.$$.fragment, local);\r\n\t\t\ttransition_in(statusaside.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(statusmessage.$$.fragment, local);\r\n\t\t\ttransition_out(statusaside.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(statusmessage, detaching);\r\n\t\t\tif (detaching) detach(t);\r\n\t\t\tdestroy_component(statusaside, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3203:24) {#if statusState.aside}\r\nfunction create_if_block_9(ctx) {\r\n\tlet statusaside;\r\n\tlet current;\r\n\r\n\tstatusaside = new StatusAside({\r\n\t\t\tprops: {\r\n\t\t\t\tclass: \"PinturaStatusButton\",\r\n\t\t\t\toffset: /*$asideOffset*/ ctx[77],\r\n\t\t\t\topacity: /*$asideOpacity*/ ctx[78],\r\n\t\t\t\t$$slots: { default: [create_default_slot_6] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(statusaside.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(statusaside, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst statusaside_changes = {};\r\n\t\t\tif (dirty[2] & /*$asideOffset*/ 32768) statusaside_changes.offset = /*$asideOffset*/ ctx[77];\r\n\t\t\tif (dirty[2] & /*$asideOpacity*/ 65536) statusaside_changes.opacity = /*$asideOpacity*/ ctx[78];\r\n\r\n\t\t\tif (dirty[1] & /*statusState*/ 4 | dirty[16] & /*$$scope*/ 512) {\r\n\t\t\t\tstatusaside_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tstatusaside.$set(statusaside_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(statusaside.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(statusaside.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(statusaside, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3209:32) {#if statusState.progressIndicator.visible}\r\nfunction create_if_block_11(ctx) {\r\n\tlet progressindicator;\r\n\tlet current;\r\n\r\n\tprogressindicator = new ProgressIndicator({\r\n\t\t\tprops: {\r\n\t\t\t\tprogress: /*statusState*/ ctx[33].progressIndicator.progress\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(progressindicator.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(progressindicator, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst progressindicator_changes = {};\r\n\t\t\tif (dirty[1] & /*statusState*/ 4) progressindicator_changes.progress = /*statusState*/ ctx[33].progressIndicator.progress;\r\n\t\t\tprogressindicator.$set(progressindicator_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(progressindicator.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(progressindicator.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(progressindicator, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3215:32) {#if statusState.closeButton && statusState.text}\r\nfunction create_if_block_10(ctx) {\r\n\tlet button;\r\n\tlet current;\r\n\tconst button_spread_levels = [/*statusState*/ ctx[33].closeButton, { hideLabel: true }];\r\n\tlet button_props = {};\r\n\r\n\tfor (let i = 0; i < button_spread_levels.length; i += 1) {\r\n\t\tbutton_props = assign(button_props, button_spread_levels[i]);\r\n\t}\r\n\r\n\tbutton = new Button({ props: button_props });\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(button.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(button, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst button_changes = (dirty[1] & /*statusState*/ 4)\r\n\t\t\t? get_spread_update(button_spread_levels, [\r\n\t\t\t\t\tget_spread_object(/*statusState*/ ctx[33].closeButton),\r\n\t\t\t\t\tbutton_spread_levels[1]\r\n\t\t\t\t])\r\n\t\t\t: {};\r\n\r\n\t\t\tbutton.$set(button_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(button.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(button.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(button, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3204:28) <StatusAside                                 class=\"PinturaStatusButton\"                                 offset={$asideOffset}                                 opacity={$asideOpacity}                             >\r\nfunction create_default_slot_6(ctx) {\r\n\tlet t;\r\n\tlet if_block1_anchor;\r\n\tlet current;\r\n\tlet if_block0 = /*statusState*/ ctx[33].progressIndicator.visible && create_if_block_11(ctx);\r\n\tlet if_block1 = /*statusState*/ ctx[33].closeButton && /*statusState*/ ctx[33].text && create_if_block_10(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (if_block0) if_block0.c();\r\n\t\t\tt = space();\r\n\t\t\tif (if_block1) if_block1.c();\r\n\t\t\tif_block1_anchor = empty();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (if_block0) if_block0.m(target, anchor);\r\n\t\t\tinsert(target, t, anchor);\r\n\t\t\tif (if_block1) if_block1.m(target, anchor);\r\n\t\t\tinsert(target, if_block1_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (/*statusState*/ ctx[33].progressIndicator.visible) {\r\n\t\t\t\tif (if_block0) {\r\n\t\t\t\t\tif_block0.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[1] & /*statusState*/ 4) {\r\n\t\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block0 = create_if_block_11(ctx);\r\n\t\t\t\t\tif_block0.c();\r\n\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\tif_block0.m(t.parentNode, t);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block0) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block0, 1, 1, () => {\r\n\t\t\t\t\tif_block0 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (/*statusState*/ ctx[33].closeButton && /*statusState*/ ctx[33].text) {\r\n\t\t\t\tif (if_block1) {\r\n\t\t\t\t\tif_block1.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[1] & /*statusState*/ 4) {\r\n\t\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block1 = create_if_block_10(ctx);\r\n\t\t\t\t\tif_block1.c();\r\n\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\tif_block1.m(if_block1_anchor.parentNode, if_block1_anchor);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block1) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block1, 1, 1, () => {\r\n\t\t\t\t\tif_block1 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block0);\r\n\t\t\ttransition_in(if_block1);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block0);\r\n\t\t\ttransition_out(if_block1);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (if_block0) if_block0.d(detaching);\r\n\t\t\tif (detaching) detach(t);\r\n\t\t\tif (if_block1) if_block1.d(detaching);\r\n\t\t\tif (detaching) detach(if_block1_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3198:28) <Icon>\r\nfunction create_default_slot_5$1(ctx) {\r\n\tlet g;\r\n\tlet raw_value = /*locale*/ ctx[3].iconSupportError + \"\";\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tg = svg_element(\"g\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, g, anchor);\r\n\t\t\tg.innerHTML = raw_value;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[0] & /*locale*/ 8 && raw_value !== (raw_value = /*locale*/ ctx[3].iconSupportError + \"\")) g.innerHTML = raw_value;\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(g);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3193:24) <StatusAside                             class=\"PinturaStatusIcon\"                             offset={$asideOffset}                             opacity={$asideOpacity}                         >\r\nfunction create_default_slot_4$1(ctx) {\r\n\tlet icon;\r\n\tlet current;\r\n\r\n\ticon = new Icon({\r\n\t\t\tprops: {\r\n\t\t\t\t$$slots: { default: [create_default_slot_5$1] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(icon.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(icon, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst icon_changes = {};\r\n\r\n\t\t\tif (dirty[0] & /*locale*/ 8 | dirty[16] & /*$$scope*/ 512) {\r\n\t\t\t\ticon_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ticon.$set(icon_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(icon.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(icon.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(icon, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3225:8) {#if isReady}\r\nfunction create_if_block_2$6(ctx) {\r\n\tlet t0;\r\n\tlet t1;\r\n\tlet current_block_type_index;\r\n\tlet if_block2;\r\n\tlet t2;\r\n\tlet canvas;\r\n\tlet t3;\r\n\tlet div;\r\n\tlet t4;\r\n\tlet canvaspanandzoom;\r\n\tlet updating_zoomLevel;\r\n\tlet updating_zoomControls;\r\n\tlet updating_zoomMultiTouching;\r\n\tlet current;\r\n\tlet if_block0 = /*enableToolbar*/ ctx[9] && create_if_block_5$3(ctx);\r\n\tlet if_block1 = /*shouldRenderTabs*/ ctx[43] && /*showUtils*/ ctx[42] && create_if_block_4$5(ctx);\r\n\tconst if_block_creators = [create_if_block_3$5, create_else_block$2];\r\n\tconst if_blocks = [];\r\n\r\n\tfunction select_block_type_1(ctx, dirty) {\r\n\t\tif (/*shouldRenderTabs*/ ctx[43]) return 0;\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tcurrent_block_type_index = select_block_type_1(ctx);\r\n\tif_block2 = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\r\n\tcanvas = new Canvas({\r\n\t\t\tprops: {\r\n\t\t\t\tisAnimated: /*$isAnimated*/ ctx[50],\r\n\t\t\t\tisTransparent: /*enableCanvasAlpha*/ ctx[18],\r\n\t\t\t\tpixelRatio: /*$pixelRatio*/ ctx[54],\r\n\t\t\t\ttextPixelRatio: /*previewImageTextPixelRatio*/ ctx[10],\r\n\t\t\t\tbackgroundColor: /*$rootBackgroundColor*/ ctx[53],\r\n\t\t\t\tmaskRect: /*$imageSelectionRectPresentation*/ ctx[55],\r\n\t\t\t\tmaskOpacity: /*imageCanvasState*/ ctx[68]\r\n\t\t\t\t? /*imageCanvasState*/ ctx[68].maskOpacity\r\n\t\t\t\t: 1,\r\n\t\t\t\tmaskMarkupOpacity: /*markupMaskOpacity*/ ctx[6],\r\n\t\t\t\tmaskFrameOpacity: /*previewMaskOpacity*/ ctx[5],\r\n\t\t\t\tclipAnnotationsToImage: /*$imageCropLimitToImage*/ ctx[80],\r\n\t\t\t\timages: /*$activeImages*/ ctx[52],\r\n\t\t\t\tinterfaceImages: /*$interfaceImages*/ ctx[81],\r\n\t\t\t\tloadImageData: /*imageSourceToImageData*/ ctx[26],\r\n\t\t\t\twillRequest: /*$willRequest*/ ctx[76] || /*$willRequestResource*/ ctx[82],\r\n\t\t\t\twillRender: /*func_2*/ ctx[363],\r\n\t\t\t\tdidRender: /*func_3*/ ctx[364]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tfunction canvaspanandzoom_zoomLevel_binding(value) {\r\n\t\t/*canvaspanandzoom_zoomLevel_binding*/ ctx[366](value);\r\n\t}\r\n\r\n\tfunction canvaspanandzoom_zoomControls_binding(value) {\r\n\t\t/*canvaspanandzoom_zoomControls_binding*/ ctx[367](value);\r\n\t}\r\n\r\n\tfunction canvaspanandzoom_zoomMultiTouching_binding(value) {\r\n\t\t/*canvaspanandzoom_zoomMultiTouching_binding*/ ctx[368](value);\r\n\t}\r\n\r\n\tlet canvaspanandzoom_props = {\r\n\t\troot: /*root*/ ctx[2],\r\n\t\tlocale: /*locale*/ ctx[3],\r\n\t\tstores: /*utilStores*/ ctx[177],\r\n\t\tallowPan: /*$allowPan*/ ctx[84],\r\n\t\tenablePan: /*enablePan*/ ctx[15],\r\n\t\tenablePanLimit: /*enablePanLimit*/ ctx[19],\r\n\t\tpanLimitGutterScalar: /*panLimitGutterScalar*/ ctx[20],\r\n\t\tenablePanInput: /*$enablePanInputStatus*/ ctx[85],\r\n\t\tallowZoom: /*$allowZoom*/ ctx[86],\r\n\t\tenableZoom: /*enableZoom*/ ctx[16],\r\n\t\tenableZoomInput: /*enableZoomInput*/ ctx[17] !== undefined\r\n\t\t? /*enableZoomInput*/ ctx[17]\r\n\t\t: /*$enableZoomInputStore*/ ctx[87],\r\n\t\tenableZoomControls: /*$enableZoomControlsProp*/ ctx[88],\r\n\t\tzoomOptions: /*markupEditorZoomLevels*/ ctx[11] || /*zoomPresetOptions*/ ctx[21],\r\n\t\tzoomAdjustStep: /*markupEditorZoomAdjustStep*/ ctx[12] || /*zoomAdjustStep*/ ctx[22],\r\n\t\tzoomAdjustFactor: /*markupEditorZoomAdjustFactor*/ ctx[13] || /*zoomAdjustFactor*/ ctx[23],\r\n\t\tzoomAdjustWheelFactor: /*markupEditorZoomAdjustWheelFactor*/ ctx[14] || /*zoomAdjustWheelFactor*/ ctx[24],\r\n\t\timageSelectionRectCentered: /*$imageSelectionRectCentered*/ ctx[89],\r\n\t\timageSelectionRectScalar: /*$imageSelectionRectScalar*/ ctx[90],\r\n\t\telasticity: imageSelectionRectElasticity * /*elasticityMultiplier*/ ctx[7]\r\n\t};\r\n\r\n\tif (/*zoomLevel*/ ctx[0] !== void 0) {\r\n\t\tcanvaspanandzoom_props.zoomLevel = /*zoomLevel*/ ctx[0];\r\n\t}\r\n\r\n\tif (/*zoomControls*/ ctx[31] !== void 0) {\r\n\t\tcanvaspanandzoom_props.zoomControls = /*zoomControls*/ ctx[31];\r\n\t}\r\n\r\n\tif (/*zoomMultiTouching*/ ctx[32] !== void 0) {\r\n\t\tcanvaspanandzoom_props.zoomMultiTouching = /*zoomMultiTouching*/ ctx[32];\r\n\t}\r\n\r\n\tcanvaspanandzoom = new CanvasPanAndZoom({ props: canvaspanandzoom_props });\r\n\tbinding_callbacks.push(() => bind(canvaspanandzoom, 'zoomLevel', canvaspanandzoom_zoomLevel_binding));\r\n\tbinding_callbacks.push(() => bind(canvaspanandzoom, 'zoomControls', canvaspanandzoom_zoomControls_binding));\r\n\tbinding_callbacks.push(() => bind(canvaspanandzoom, 'zoomMultiTouching', canvaspanandzoom_zoomMultiTouching_binding));\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (if_block0) if_block0.c();\r\n\t\t\tt0 = space();\r\n\t\t\tif (if_block1) if_block1.c();\r\n\t\t\tt1 = space();\r\n\t\t\tif_block2.c();\r\n\t\t\tt2 = space();\r\n\t\t\tcreate_component(canvas.$$.fragment);\r\n\t\t\tt3 = space();\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tt4 = space();\r\n\t\t\tcreate_component(canvaspanandzoom.$$.fragment);\r\n\t\t\tattr(div, \"class\", \"PinturaRootPortal\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (if_block0) if_block0.m(target, anchor);\r\n\t\t\tinsert(target, t0, anchor);\r\n\t\t\tif (if_block1) if_block1.m(target, anchor);\r\n\t\t\tinsert(target, t1, anchor);\r\n\t\t\tif_blocks[current_block_type_index].m(target, anchor);\r\n\t\t\tinsert(target, t2, anchor);\r\n\t\t\tmount_component(canvas, target, anchor);\r\n\t\t\tinsert(target, t3, anchor);\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\t/*div_binding*/ ctx[365](div);\r\n\t\t\tinsert(target, t4, anchor);\r\n\t\t\tmount_component(canvaspanandzoom, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (/*enableToolbar*/ ctx[9]) {\r\n\t\t\t\tif (if_block0) {\r\n\t\t\t\t\tif_block0.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[0] & /*enableToolbar*/ 512) {\r\n\t\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block0 = create_if_block_5$3(ctx);\r\n\t\t\t\t\tif_block0.c();\r\n\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\tif_block0.m(t0.parentNode, t0);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block0) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block0, 1, 1, () => {\r\n\t\t\t\t\tif_block0 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (/*shouldRenderTabs*/ ctx[43] && /*showUtils*/ ctx[42]) {\r\n\t\t\t\tif (if_block1) {\r\n\t\t\t\t\tif_block1.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[1] & /*shouldRenderTabs, showUtils*/ 6144) {\r\n\t\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block1 = create_if_block_4$5(ctx);\r\n\t\t\t\t\tif_block1.c();\r\n\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\tif_block1.m(t1.parentNode, t1);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block1) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block1, 1, 1, () => {\r\n\t\t\t\t\tif_block1 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tlet previous_block_index = current_block_type_index;\r\n\t\t\tcurrent_block_type_index = select_block_type_1(ctx);\r\n\r\n\t\t\tif (current_block_type_index === previous_block_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].p(ctx, dirty);\r\n\t\t\t} else {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_blocks[previous_block_index], 1, 1, () => {\r\n\t\t\t\t\tif_blocks[previous_block_index] = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t\tif_block2 = if_blocks[current_block_type_index];\r\n\r\n\t\t\t\tif (!if_block2) {\r\n\t\t\t\t\tif_block2 = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t\t\t\t\tif_block2.c();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block2.p(ctx, dirty);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttransition_in(if_block2, 1);\r\n\t\t\t\tif_block2.m(t2.parentNode, t2);\r\n\t\t\t}\r\n\r\n\t\t\tconst canvas_changes = {};\r\n\t\t\tif (dirty[1] & /*$isAnimated*/ 524288) canvas_changes.isAnimated = /*$isAnimated*/ ctx[50];\r\n\t\t\tif (dirty[0] & /*enableCanvasAlpha*/ 262144) canvas_changes.isTransparent = /*enableCanvasAlpha*/ ctx[18];\r\n\t\t\tif (dirty[1] & /*$pixelRatio*/ 8388608) canvas_changes.pixelRatio = /*$pixelRatio*/ ctx[54];\r\n\t\t\tif (dirty[0] & /*previewImageTextPixelRatio*/ 1024) canvas_changes.textPixelRatio = /*previewImageTextPixelRatio*/ ctx[10];\r\n\t\t\tif (dirty[1] & /*$rootBackgroundColor*/ 4194304) canvas_changes.backgroundColor = /*$rootBackgroundColor*/ ctx[53];\r\n\t\t\tif (dirty[1] & /*$imageSelectionRectPresentation*/ 16777216) canvas_changes.maskRect = /*$imageSelectionRectPresentation*/ ctx[55];\r\n\r\n\t\t\tif (dirty[2] & /*imageCanvasState*/ 64) canvas_changes.maskOpacity = /*imageCanvasState*/ ctx[68]\r\n\t\t\t? /*imageCanvasState*/ ctx[68].maskOpacity\r\n\t\t\t: 1;\r\n\r\n\t\t\tif (dirty[0] & /*markupMaskOpacity*/ 64) canvas_changes.maskMarkupOpacity = /*markupMaskOpacity*/ ctx[6];\r\n\t\t\tif (dirty[0] & /*previewMaskOpacity*/ 32) canvas_changes.maskFrameOpacity = /*previewMaskOpacity*/ ctx[5];\r\n\t\t\tif (dirty[2] & /*$imageCropLimitToImage*/ 262144) canvas_changes.clipAnnotationsToImage = /*$imageCropLimitToImage*/ ctx[80];\r\n\t\t\tif (dirty[1] & /*$activeImages*/ 2097152) canvas_changes.images = /*$activeImages*/ ctx[52];\r\n\t\t\tif (dirty[2] & /*$interfaceImages*/ 524288) canvas_changes.interfaceImages = /*$interfaceImages*/ ctx[81];\r\n\t\t\tif (dirty[0] & /*imageSourceToImageData*/ 67108864) canvas_changes.loadImageData = /*imageSourceToImageData*/ ctx[26];\r\n\t\t\tif (dirty[2] & /*$willRequest, $willRequestResource*/ 1064960) canvas_changes.willRequest = /*$willRequest*/ ctx[76] || /*$willRequestResource*/ ctx[82];\r\n\t\t\tif (dirty[0] & /*willRenderCanvas*/ 256 | dirty[1] & /*$redrawTrigger, $imageAnnotation, $imageDecoration, $imageFrame, blendShapes*/ 376840 | dirty[2] & /*$imageOverlay*/ 2097152) canvas_changes.willRender = /*func_2*/ ctx[363];\r\n\t\t\tif (dirty[1] & /*imageAnnotationShapesDirty, imageAnnotationRequiresPreprocessing, imageDecorationShapesDirty, imageFrameShapesDirty, imageBlendShapesDirty*/ 2080374784) canvas_changes.didRender = /*func_3*/ ctx[364];\r\n\t\t\tcanvas.$set(canvas_changes);\r\n\t\t\tconst canvaspanandzoom_changes = {};\r\n\t\t\tif (dirty[0] & /*root*/ 4) canvaspanandzoom_changes.root = /*root*/ ctx[2];\r\n\t\t\tif (dirty[0] & /*locale*/ 8) canvaspanandzoom_changes.locale = /*locale*/ ctx[3];\r\n\t\t\tif (dirty[2] & /*$allowPan*/ 4194304) canvaspanandzoom_changes.allowPan = /*$allowPan*/ ctx[84];\r\n\t\t\tif (dirty[0] & /*enablePan*/ 32768) canvaspanandzoom_changes.enablePan = /*enablePan*/ ctx[15];\r\n\t\t\tif (dirty[0] & /*enablePanLimit*/ 524288) canvaspanandzoom_changes.enablePanLimit = /*enablePanLimit*/ ctx[19];\r\n\t\t\tif (dirty[0] & /*panLimitGutterScalar*/ 1048576) canvaspanandzoom_changes.panLimitGutterScalar = /*panLimitGutterScalar*/ ctx[20];\r\n\t\t\tif (dirty[2] & /*$enablePanInputStatus*/ 8388608) canvaspanandzoom_changes.enablePanInput = /*$enablePanInputStatus*/ ctx[85];\r\n\t\t\tif (dirty[2] & /*$allowZoom*/ 16777216) canvaspanandzoom_changes.allowZoom = /*$allowZoom*/ ctx[86];\r\n\t\t\tif (dirty[0] & /*enableZoom*/ 65536) canvaspanandzoom_changes.enableZoom = /*enableZoom*/ ctx[16];\r\n\r\n\t\t\tif (dirty[0] & /*enableZoomInput*/ 131072 | dirty[2] & /*$enableZoomInputStore*/ 33554432) canvaspanandzoom_changes.enableZoomInput = /*enableZoomInput*/ ctx[17] !== undefined\r\n\t\t\t? /*enableZoomInput*/ ctx[17]\r\n\t\t\t: /*$enableZoomInputStore*/ ctx[87];\r\n\r\n\t\t\tif (dirty[2] & /*$enableZoomControlsProp*/ 67108864) canvaspanandzoom_changes.enableZoomControls = /*$enableZoomControlsProp*/ ctx[88];\r\n\t\t\tif (dirty[0] & /*markupEditorZoomLevels, zoomPresetOptions*/ 2099200) canvaspanandzoom_changes.zoomOptions = /*markupEditorZoomLevels*/ ctx[11] || /*zoomPresetOptions*/ ctx[21];\r\n\t\t\tif (dirty[0] & /*markupEditorZoomAdjustStep, zoomAdjustStep*/ 4198400) canvaspanandzoom_changes.zoomAdjustStep = /*markupEditorZoomAdjustStep*/ ctx[12] || /*zoomAdjustStep*/ ctx[22];\r\n\t\t\tif (dirty[0] & /*markupEditorZoomAdjustFactor, zoomAdjustFactor*/ 8396800) canvaspanandzoom_changes.zoomAdjustFactor = /*markupEditorZoomAdjustFactor*/ ctx[13] || /*zoomAdjustFactor*/ ctx[23];\r\n\t\t\tif (dirty[0] & /*markupEditorZoomAdjustWheelFactor, zoomAdjustWheelFactor*/ 16793600) canvaspanandzoom_changes.zoomAdjustWheelFactor = /*markupEditorZoomAdjustWheelFactor*/ ctx[14] || /*zoomAdjustWheelFactor*/ ctx[24];\r\n\t\t\tif (dirty[2] & /*$imageSelectionRectCentered*/ 134217728) canvaspanandzoom_changes.imageSelectionRectCentered = /*$imageSelectionRectCentered*/ ctx[89];\r\n\t\t\tif (dirty[2] & /*$imageSelectionRectScalar*/ 268435456) canvaspanandzoom_changes.imageSelectionRectScalar = /*$imageSelectionRectScalar*/ ctx[90];\r\n\t\t\tif (dirty[0] & /*elasticityMultiplier*/ 128) canvaspanandzoom_changes.elasticity = imageSelectionRectElasticity * /*elasticityMultiplier*/ ctx[7];\r\n\r\n\t\t\tif (!updating_zoomLevel && dirty[0] & /*zoomLevel*/ 1) {\r\n\t\t\t\tupdating_zoomLevel = true;\r\n\t\t\t\tcanvaspanandzoom_changes.zoomLevel = /*zoomLevel*/ ctx[0];\r\n\t\t\t\tadd_flush_callback(() => updating_zoomLevel = false);\r\n\t\t\t}\r\n\r\n\t\t\tif (!updating_zoomControls && dirty[1] & /*zoomControls*/ 1) {\r\n\t\t\t\tupdating_zoomControls = true;\r\n\t\t\t\tcanvaspanandzoom_changes.zoomControls = /*zoomControls*/ ctx[31];\r\n\t\t\t\tadd_flush_callback(() => updating_zoomControls = false);\r\n\t\t\t}\r\n\r\n\t\t\tif (!updating_zoomMultiTouching && dirty[1] & /*zoomMultiTouching*/ 2) {\r\n\t\t\t\tupdating_zoomMultiTouching = true;\r\n\t\t\t\tcanvaspanandzoom_changes.zoomMultiTouching = /*zoomMultiTouching*/ ctx[32];\r\n\t\t\t\tadd_flush_callback(() => updating_zoomMultiTouching = false);\r\n\t\t\t}\r\n\r\n\t\t\tcanvaspanandzoom.$set(canvaspanandzoom_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block0);\r\n\t\t\ttransition_in(if_block1);\r\n\t\t\ttransition_in(if_block2);\r\n\t\t\ttransition_in(canvas.$$.fragment, local);\r\n\t\t\ttransition_in(canvaspanandzoom.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block0);\r\n\t\t\ttransition_out(if_block1);\r\n\t\t\ttransition_out(if_block2);\r\n\t\t\ttransition_out(canvas.$$.fragment, local);\r\n\t\t\ttransition_out(canvaspanandzoom.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (if_block0) if_block0.d(detaching);\r\n\t\t\tif (detaching) detach(t0);\r\n\t\t\tif (if_block1) if_block1.d(detaching);\r\n\t\t\tif (detaching) detach(t1);\r\n\t\t\tif_blocks[current_block_type_index].d(detaching);\r\n\t\t\tif (detaching) detach(t2);\r\n\t\t\tdestroy_component(canvas, detaching);\r\n\t\t\tif (detaching) detach(t3);\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\t/*div_binding*/ ctx[365](null);\r\n\t\t\tif (detaching) detach(t4);\r\n\t\t\tdestroy_component(canvaspanandzoom, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3226:12) {#if enableToolbar}\r\nfunction create_if_block_5$3(ctx) {\r\n\tlet div;\r\n\tlet dynamiccomponenttree;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\tdynamiccomponenttree = new DynamicComponentTree_1({\r\n\t\t\tprops: { items: /*toolbarItems*/ ctx[64] }\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tcreate_component(dynamiccomponenttree.$$.fragment);\r\n\t\t\tattr(div, \"class\", \"PinturaNav PinturaNavTools\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tmount_component(dynamiccomponenttree, div, null);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(div, \"measure\", /*measure_handler*/ ctx[350]),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst dynamiccomponenttree_changes = {};\r\n\t\t\tif (dirty[2] & /*toolbarItems*/ 4) dynamiccomponenttree_changes.items = /*toolbarItems*/ ctx[64];\r\n\t\t\tdynamiccomponenttree.$set(dynamiccomponenttree_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(dynamiccomponenttree.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(dynamiccomponenttree.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tdestroy_component(dynamiccomponenttree);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3236:12) {#if shouldRenderTabs && showUtils}\r\nfunction create_if_block_4$5(ctx) {\r\n\tlet div;\r\n\tlet scrollable;\r\n\tlet current;\r\n\r\n\tscrollable = new Scrollable({\r\n\t\t\tprops: {\r\n\t\t\t\telasticity: /*elasticityMultiplier*/ ctx[7] * scrollElasticity,\r\n\t\t\t\tscrollDirection: /*isLandscape*/ ctx[70] ? 'y' : 'x',\r\n\t\t\t\t$$slots: { default: [create_default_slot_1$4] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tcreate_component(scrollable.$$.fragment);\r\n\t\t\tattr(div, \"class\", \"PinturaNav PinturaNavMain\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tmount_component(scrollable, div, null);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst scrollable_changes = {};\r\n\t\t\tif (dirty[0] & /*elasticityMultiplier*/ 128) scrollable_changes.elasticity = /*elasticityMultiplier*/ ctx[7] * scrollElasticity;\r\n\t\t\tif (dirty[2] & /*isLandscape*/ 256) scrollable_changes.scrollDirection = /*isLandscape*/ ctx[70] ? 'y' : 'x';\r\n\r\n\t\t\tif (dirty[1] & /*utilSelected*/ 1024 | dirty[2] & /*tabsConfig, tabs*/ 6144 | dirty[16] & /*$$scope*/ 512) {\r\n\t\t\t\tscrollable_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tscrollable.$set(scrollable_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(scrollable.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(scrollable.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tdestroy_component(scrollable);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3248:28) <Icon>\r\nfunction create_default_slot_3$1(ctx) {\r\n\tlet g;\r\n\tlet raw_value = /*tab*/ ctx[504].icon + \"\";\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tg = svg_element(\"g\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, g, anchor);\r\n\t\t\tg.innerHTML = raw_value;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[16] & /*tab*/ 256 && raw_value !== (raw_value = /*tab*/ ctx[504].icon + \"\")) g.innerHTML = raw_value;\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(g);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3242:24) <TabList                             {...tabsConfig}                             {tabs}                             on:select={({ detail }) => (utilSelected = detail)}                             let:tab                         >\r\nfunction create_default_slot_2$3(ctx) {\r\n\tlet icon;\r\n\tlet t0;\r\n\tlet span;\r\n\tlet t1_value = /*tab*/ ctx[504].label + \"\";\r\n\tlet t1;\r\n\tlet current;\r\n\r\n\ticon = new Icon({\r\n\t\t\tprops: {\r\n\t\t\t\t$$slots: { default: [create_default_slot_3$1] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(icon.$$.fragment);\r\n\t\t\tt0 = space();\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt1 = text(t1_value);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(icon, target, anchor);\r\n\t\t\tinsert(target, t0, anchor);\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t\tappend(span, t1);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst icon_changes = {};\r\n\r\n\t\t\tif (dirty[16] & /*$$scope, tab*/ 768) {\r\n\t\t\t\ticon_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ticon.$set(icon_changes);\r\n\t\t\tif ((!current || dirty[16] & /*tab*/ 256) && t1_value !== (t1_value = /*tab*/ ctx[504].label + \"\")) set_data(t1, t1_value);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(icon.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(icon.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(icon, detaching);\r\n\t\t\tif (detaching) detach(t0);\r\n\t\t\tif (detaching) detach(span);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3238:20) <Scrollable                         elasticity={elasticityMultiplier * scrollElasticity}                         scrollDirection={isLandscape ? 'y' : 'x'}                     >\r\nfunction create_default_slot_1$4(ctx) {\r\n\tlet tablist;\r\n\tlet current;\r\n\tconst tablist_spread_levels = [/*tabsConfig*/ ctx[74], { tabs: /*tabs*/ ctx[73] }];\r\n\r\n\tlet tablist_props = {\r\n\t\t$$slots: {\r\n\t\t\tdefault: [\r\n\t\t\t\tcreate_default_slot_2$3,\r\n\t\t\t\t({ tab }) => ({ 504: tab }),\r\n\t\t\t\t({ tab }) => [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, tab ? 256 : 0]\r\n\t\t\t]\r\n\t\t},\r\n\t\t$$scope: { ctx }\r\n\t};\r\n\r\n\tfor (let i = 0; i < tablist_spread_levels.length; i += 1) {\r\n\t\ttablist_props = assign(tablist_props, tablist_spread_levels[i]);\r\n\t}\r\n\r\n\ttablist = new TabList({ props: tablist_props });\r\n\ttablist.$on(\"select\", /*select_handler*/ ctx[351]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(tablist.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(tablist, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst tablist_changes = (dirty[2] & /*tabsConfig, tabs*/ 6144)\r\n\t\t\t? get_spread_update(tablist_spread_levels, [\r\n\t\t\t\t\tdirty[2] & /*tabsConfig*/ 4096 && get_spread_object(/*tabsConfig*/ ctx[74]),\r\n\t\t\t\t\tdirty[2] & /*tabs*/ 2048 && { tabs: /*tabs*/ ctx[73] }\r\n\t\t\t\t])\r\n\t\t\t: {};\r\n\r\n\t\t\tif (dirty[16] & /*$$scope, tab*/ 768) {\r\n\t\t\t\ttablist_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ttablist.$set(tablist_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(tablist.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(tablist.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(tablist, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3281:12) {:else}\r\nfunction create_else_block$2(ctx) {\r\n\tlet utilpanel;\r\n\tlet updating_component;\r\n\tlet current;\r\n\r\n\tfunction utilpanel_component_binding_1(value) {\r\n\t\t/*utilpanel_component_binding_1*/ ctx[359](value);\r\n\t}\r\n\r\n\tlet utilpanel_props = {\r\n\t\tclass: \"PinturaMain\",\r\n\t\tcontent: {\r\n\t\t\t.../*utilsMerged*/ ctx[44].find(/*func_1*/ ctx[358]),\r\n\t\t\tprops: /*pluginOptions*/ ctx[25][/*utilSelected*/ ctx[41]]\r\n\t\t},\r\n\t\tlocale: /*locale*/ ctx[3],\r\n\t\tstores: /*utilStores*/ ctx[177]\r\n\t};\r\n\r\n\tif (/*pluginInterface*/ ctx[1][/*utilSelected*/ ctx[41]] !== void 0) {\r\n\t\tutilpanel_props.component = /*pluginInterface*/ ctx[1][/*utilSelected*/ ctx[41]];\r\n\t}\r\n\r\n\tutilpanel = new UtilPanel({ props: utilpanel_props });\r\n\tbinding_callbacks.push(() => bind(utilpanel, 'component', utilpanel_component_binding_1));\r\n\tutilpanel.$on(\"measure\", /*handleMeasureUtil*/ ctx[199]);\r\n\tutilpanel.$on(\"show\", /*show_handler_1*/ ctx[360]);\r\n\tutilpanel.$on(\"hide\", /*hide_handler_1*/ ctx[361]);\r\n\tutilpanel.$on(\"fade\", /*fade_handler_1*/ ctx[362]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(utilpanel.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(utilpanel, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst utilpanel_changes = {};\r\n\r\n\t\t\tif (dirty[0] & /*pluginOptions*/ 33554432 | dirty[1] & /*utilsMerged, utilSelected*/ 9216) utilpanel_changes.content = {\r\n\t\t\t\t.../*utilsMerged*/ ctx[44].find(/*func_1*/ ctx[358]),\r\n\t\t\t\tprops: /*pluginOptions*/ ctx[25][/*utilSelected*/ ctx[41]]\r\n\t\t\t};\r\n\r\n\t\t\tif (dirty[0] & /*locale*/ 8) utilpanel_changes.locale = /*locale*/ ctx[3];\r\n\r\n\t\t\tif (!updating_component && dirty[0] & /*pluginInterface*/ 2 | dirty[1] & /*utilSelected*/ 1024) {\r\n\t\t\t\tupdating_component = true;\r\n\t\t\t\tutilpanel_changes.component = /*pluginInterface*/ ctx[1][/*utilSelected*/ ctx[41]];\r\n\t\t\t\tadd_flush_callback(() => updating_component = false);\r\n\t\t\t}\r\n\r\n\t\t\tutilpanel.$set(utilpanel_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(utilpanel.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(utilpanel.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(utilpanel, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3255:12) {#if shouldRenderTabs}\r\nfunction create_if_block_3$5(ctx) {\r\n\tlet tabpanels;\r\n\tlet current;\r\n\r\n\tconst tabpanels_spread_levels = [\r\n\t\t{ class: \"PinturaMain\" },\r\n\t\t{ visible: /*utilsVisible*/ ctx[56] },\r\n\t\t/*tabsConfig*/ ctx[74],\r\n\t\t{ panels: /*panels*/ ctx[72] }\r\n\t];\r\n\r\n\tlet tabpanels_props = {\r\n\t\t$$slots: {\r\n\t\t\tdefault: [\r\n\t\t\t\tcreate_default_slot$a,\r\n\t\t\t\t({ panel, panelIsActive }) => ({ 502: panel, 503: panelIsActive }),\r\n\t\t\t\t({ panel, panelIsActive }) => [\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t(panel ? 64 : 0) | (panelIsActive ? 128 : 0)\r\n\t\t\t\t]\r\n\t\t\t]\r\n\t\t},\r\n\t\t$$scope: { ctx }\r\n\t};\r\n\r\n\tfor (let i = 0; i < tabpanels_spread_levels.length; i += 1) {\r\n\t\ttabpanels_props = assign(tabpanels_props, tabpanels_spread_levels[i]);\r\n\t}\r\n\r\n\ttabpanels = new TabPanels({ props: tabpanels_props });\r\n\ttabpanels.$on(\"measure\", /*measure_handler_1*/ ctx[357]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(tabpanels.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(tabpanels, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst tabpanels_changes = (dirty[1] & /*utilsVisible*/ 33554432 | dirty[2] & /*tabsConfig, panels*/ 5120)\r\n\t\t\t? get_spread_update(tabpanels_spread_levels, [\r\n\t\t\t\t\ttabpanels_spread_levels[0],\r\n\t\t\t\t\tdirty[1] & /*utilsVisible*/ 33554432 && { visible: /*utilsVisible*/ ctx[56] },\r\n\t\t\t\t\tdirty[2] & /*tabsConfig*/ 4096 && get_spread_object(/*tabsConfig*/ ctx[74]),\r\n\t\t\t\t\tdirty[2] & /*panels*/ 1024 && { panels: /*panels*/ ctx[72] }\r\n\t\t\t\t])\r\n\t\t\t: {};\r\n\r\n\t\t\tif (dirty[0] & /*pluginOptions, locale, pluginInterface*/ 33554442 | dirty[1] & /*utilsMerged, utilsVisible, utilsVisibleFraction*/ 33562656 | dirty[16] & /*$$scope, panel, panelIsActive*/ 704) {\r\n\t\t\t\ttabpanels_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ttabpanels.$set(tabpanels_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(tabpanels.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(tabpanels.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(tabpanels, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3256:16) <TabPanels                     class=\"PinturaMain\"                     visible={utilsVisible}                     {...tabsConfig}                     {panels}                     let:panel                     let:panelIsActive                     on:measure={(e) => ($tabRect = e.detail)}                 >\r\nfunction create_default_slot$a(ctx) {\r\n\tlet utilpanel;\r\n\tlet updating_component;\r\n\tlet current;\r\n\r\n\tfunction func(...args) {\r\n\t\treturn /*func*/ ctx[352](/*panel*/ ctx[502], ...args);\r\n\t}\r\n\r\n\tfunction utilpanel_component_binding(value) {\r\n\t\t/*utilpanel_component_binding*/ ctx[353](value, /*panel*/ ctx[502]);\r\n\t}\r\n\r\n\tfunction show_handler() {\r\n\t\treturn /*show_handler*/ ctx[354](/*panel*/ ctx[502]);\r\n\t}\r\n\r\n\tfunction hide_handler() {\r\n\t\treturn /*hide_handler*/ ctx[355](/*panel*/ ctx[502]);\r\n\t}\r\n\r\n\tfunction fade_handler(...args) {\r\n\t\treturn /*fade_handler*/ ctx[356](/*panel*/ ctx[502], ...args);\r\n\t}\r\n\r\n\tlet utilpanel_props = {\r\n\t\tcontent: {\r\n\t\t\t.../*utilsMerged*/ ctx[44].find(func),\r\n\t\t\tprops: /*pluginOptions*/ ctx[25][/*panel*/ ctx[502]]\r\n\t\t},\r\n\t\tlocale: /*locale*/ ctx[3],\r\n\t\tisActive: /*panelIsActive*/ ctx[503],\r\n\t\tstores: /*utilStores*/ ctx[177]\r\n\t};\r\n\r\n\tif (/*pluginInterface*/ ctx[1][/*panel*/ ctx[502]] !== void 0) {\r\n\t\tutilpanel_props.component = /*pluginInterface*/ ctx[1][/*panel*/ ctx[502]];\r\n\t}\r\n\r\n\tutilpanel = new UtilPanel({ props: utilpanel_props });\r\n\tbinding_callbacks.push(() => bind(utilpanel, 'component', utilpanel_component_binding));\r\n\tutilpanel.$on(\"measure\", /*handleMeasureUtil*/ ctx[199]);\r\n\tutilpanel.$on(\"show\", show_handler);\r\n\tutilpanel.$on(\"hide\", hide_handler);\r\n\tutilpanel.$on(\"fade\", fade_handler);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(utilpanel.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(utilpanel, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\t\t\tconst utilpanel_changes = {};\r\n\r\n\t\t\tif (dirty[0] & /*pluginOptions*/ 33554432 | dirty[1] & /*utilsMerged*/ 8192 | dirty[16] & /*panel*/ 64) utilpanel_changes.content = {\r\n\t\t\t\t.../*utilsMerged*/ ctx[44].find(func),\r\n\t\t\t\tprops: /*pluginOptions*/ ctx[25][/*panel*/ ctx[502]]\r\n\t\t\t};\r\n\r\n\t\t\tif (dirty[0] & /*locale*/ 8) utilpanel_changes.locale = /*locale*/ ctx[3];\r\n\t\t\tif (dirty[16] & /*panelIsActive*/ 128) utilpanel_changes.isActive = /*panelIsActive*/ ctx[503];\r\n\r\n\t\t\tif (!updating_component && dirty[0] & /*pluginInterface*/ 2 | dirty[16] & /*panel*/ 64) {\r\n\t\t\t\tupdating_component = true;\r\n\t\t\t\tutilpanel_changes.component = /*pluginInterface*/ ctx[1][/*panel*/ ctx[502]];\r\n\t\t\t\tadd_flush_callback(() => updating_component = false);\r\n\t\t\t}\r\n\r\n\t\t\tutilpanel.$set(utilpanel_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(utilpanel.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(utilpanel.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(utilpanel, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3384:4) {#if $disabledTransition > 0}\r\nfunction create_if_block$7(ctx) {\r\n\tlet span;\r\n\tlet span_style_value;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tattr(span, \"class\", \"PinturaEditorOverlay\");\r\n\t\t\tattr(span, \"style\", span_style_value = `opacity:${/*$disabledTransition*/ ctx[91]}`);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[2] & /*$disabledTransition*/ 536870912 && span_style_value !== (span_style_value = `opacity:${/*$disabledTransition*/ ctx[91]}`)) {\r\n\t\t\t\tattr(span, \"style\", span_style_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$w(ctx) {\r\n\tlet div;\r\n\tlet t;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tadd_render_callback(/*onwindowresize*/ ctx[349]);\r\n\tlet if_block0 = /*canRender*/ ctx[63] && create_if_block_1$7(ctx);\r\n\tlet if_block1 = /*$disabledTransition*/ ctx[91] > 0 && create_if_block$7(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (if_block0) if_block0.c();\r\n\t\t\tt = space();\r\n\t\t\tif (if_block1) if_block1.c();\r\n\t\t\tattr(div, \"id\", /*id*/ ctx[4]);\r\n\t\t\tattr(div, \"class\", /*className*/ ctx[71]);\r\n\t\t\tattr(div, \"data-env\", /*envStr*/ ctx[69]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tif (if_block0) if_block0.m(div, null);\r\n\t\t\tappend(div, t);\r\n\t\t\tif (if_block1) if_block1.m(div, null);\r\n\t\t\t/*div_binding_1*/ ctx[369](div);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(window_1$1, \"keydown\", /*handleKeydown*/ ctx[190]),\r\n\t\t\t\t\tlisten(window_1$1, \"keyup\", /*handleKeyup*/ ctx[191]),\r\n\t\t\t\t\tlisten(window_1$1, \"blur\", /*handleWindowBlur*/ ctx[192]),\r\n\t\t\t\t\tlisten(window_1$1, \"paste\", /*handlePaste*/ ctx[196]),\r\n\t\t\t\t\tlisten(window_1$1, \"resize\", /*onwindowresize*/ ctx[349]),\r\n\t\t\t\t\tlisten(div, \"ping\", function () {\r\n\t\t\t\t\t\tif (is_function(/*routePing*/ ctx[62])) /*routePing*/ ctx[62].apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(div, \"contextmenu\", /*handleContextMenu*/ ctx[193]),\r\n\t\t\t\t\tlisten(div, \"touchstart\", /*handleTouchStart*/ ctx[188], { passive: false }),\r\n\t\t\t\t\tlisten(div, \"touchmove\", function () {\r\n\t\t\t\t\t\tif (is_function(/*handleTouchMove*/ ctx[66])) /*handleTouchMove*/ ctx[66].apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(div, \"pointermove\", function () {\r\n\t\t\t\t\t\tif (is_function(/*handlePointerMove*/ ctx[65])) /*handlePointerMove*/ ctx[65].apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(div, \"transitionend\", /*handleTransitionEnd*/ ctx[178]),\r\n\t\t\t\t\tlisten(div, \"dropfiles\", /*handleDropFiles*/ ctx[194]),\r\n\t\t\t\t\tlisten(div, \"measure\", /*measure_handler_2*/ ctx[370]),\r\n\t\t\t\t\tlisten(div, \"click\", function () {\r\n\t\t\t\t\t\tif (is_function(/*isWaitingForImage*/ ctx[40]\r\n\t\t\t\t\t\t? /*browseFileSystem*/ ctx[195]\r\n\t\t\t\t\t\t: noop$1)) (/*isWaitingForImage*/ ctx[40]\r\n\t\t\t\t\t\t? /*browseFileSystem*/ ctx[195]\r\n\t\t\t\t\t\t: noop$1).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div, { observeViewRect: true })),\r\n\t\t\t\t\taction_destroyer(focusvisible.call(null, div)),\r\n\t\t\t\t\taction_destroyer(dropable.call(null, div))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\r\n\t\t\tif (/*canRender*/ ctx[63]) {\r\n\t\t\t\tif (if_block0) {\r\n\t\t\t\t\tif_block0.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[2] & /*canRender*/ 2) {\r\n\t\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block0 = create_if_block_1$7(ctx);\r\n\t\t\t\t\tif_block0.c();\r\n\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\tif_block0.m(div, t);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block0) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block0, 1, 1, () => {\r\n\t\t\t\t\tif_block0 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (/*$disabledTransition*/ ctx[91] > 0) {\r\n\t\t\t\tif (if_block1) {\r\n\t\t\t\t\tif_block1.p(ctx, dirty);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block1 = create_if_block$7(ctx);\r\n\t\t\t\t\tif_block1.c();\r\n\t\t\t\t\tif_block1.m(div, null);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block1) {\r\n\t\t\t\tif_block1.d(1);\r\n\t\t\t\tif_block1 = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*id*/ 16) {\r\n\t\t\t\tattr(div, \"id\", /*id*/ ctx[4]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[2] & /*className*/ 512) {\r\n\t\t\t\tattr(div, \"class\", /*className*/ ctx[71]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[2] & /*envStr*/ 128) {\r\n\t\t\t\tattr(div, \"data-env\", /*envStr*/ ctx[69]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block0);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block0);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif (if_block0) if_block0.d();\r\n\t\t\tif (if_block1) if_block1.d();\r\n\t\t\t/*div_binding_1*/ ctx[369](null);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nconst imageCropRectElasticity = 5;\r\n\r\n// updating crop selection / the intended selection rect, combined with actual selection rect, used to render elasticity visualisation\r\nconst imageSelectionRectElasticity = 1;\r\n\r\nconst OVERLAY_ID = 'stage-overlay';\r\nconst OVERLAY_OPACITY_MAX = 0.85;\r\nconst OVERLAY_OPACITY_TWEEN_DIST = 64;\r\nconst scrollElasticity = 10;\r\nconst rangeInputElasticity = 5;\r\n\r\nfunction instance$w($$self, $$props, $$invalidate) {\r\n\tlet isOverlayModeEnabled;\r\n\tlet showUtils;\r\n\tlet maxImageDataSize;\r\n\tlet preprocessShape;\r\n\tlet supportsAnimations;\r\n\tlet canAnimate;\r\n\tlet acceptsAnimations;\r\n\tlet overlayMin;\r\n\tlet overlayOverlap;\r\n\tlet overlayLeft;\r\n\tlet overlayTop;\r\n\tlet overlayRight;\r\n\tlet overlayBottom;\r\n\tlet gradientOverlays;\r\n\tlet imageTransformsSnapPixels;\r\n\tlet canUndo;\r\n\tlet canRedo;\r\n\tlet utilsFiltered;\r\n\tlet utilsAvailable;\r\n\tlet utilsDefined;\r\n\tlet utilsMerged;\r\n\tlet utilSelected;\r\n\tlet utilsVisibleFraction;\r\n\tlet tabsConfig;\r\n\tlet tabs;\r\n\tlet panels;\r\n\tlet shouldRenderTabs;\r\n\tlet className;\r\n\tlet horizontalSpace;\r\n\tlet hasLimitedSpace;\r\n\tlet verticalSpace;\r\n\tlet isModal;\r\n\tlet isCenteredHorizontally;\r\n\tlet isCenteredVertically;\r\n\tlet isCentered;\r\n\tlet isTransparent;\r\n\tlet isNarrow;\r\n\tlet orientation;\r\n\tlet isLandscape;\r\n\tlet isCompact;\r\n\tlet hasSwipeNavigation;\r\n\tlet activeUtilTools;\r\n\tlet navigationHorizontalPreference;\r\n\tlet navigationVerticalPreference;\r\n\tlet toolbarVerticalPreference;\r\n\tlet controlGroupsVerticalPreference;\r\n\tlet controlTabsVerticalpreference;\r\n\tlet rootRectDefined;\r\n\tlet rootElementComputedStyle;\r\n\tlet envStr;\r\n\tlet imageCanvasState;\r\n\tlet hasProps;\r\n\tlet missingFeatures;\r\n\tlet isSupportsError;\r\n\tlet isStartLoadingImageSource;\r\n\tlet isImageLoadError;\r\n\tlet isWaitingForImage;\r\n\tlet imageLoadProgress;\r\n\tlet isLoadingImageData;\r\n\tlet isCreatingImagePreview;\r\n\tlet isProcessingImage;\r\n\tlet imageLoadShowProgressIndicator;\r\n\tlet imageLoadStatusLabel;\r\n\tlet imageProcessStatusLabel;\r\n\tlet imageProcessProgress;\r\n\tlet imageProcessShowProgressIndicator;\r\n\tlet isImageProcessingError;\r\n\tlet isCustomStatus;\r\n\tlet isStatusActive;\r\n\tlet isStatusVisible;\r\n\tlet hasAside;\r\n\tlet statusIndent;\r\n\tlet statusTransform;\r\n\tlet needsInteractionLock;\r\n\tlet preventTouchHandler;\r\n\tlet handleTouchMove;\r\n\tlet handlePointerMove;\r\n\tlet toolbarItems;\r\n\tlet hasClientRect;\r\n\tlet canRender;\r\n\tlet hasImageRedaction;\r\n\tlet imageRedactionScalar;\r\n\tlet routePing;\r\n\tlet isReady;\r\n\tlet $utilRect;\r\n\tlet $imageFrame;\r\n\tlet $imageDecoration;\r\n\tlet $imageSize;\r\n\tlet $imageFlipY;\r\n\tlet $imageFlipX;\r\n\tlet $imageRotation;\r\n\tlet $imageAnnotation;\r\n\tlet $stageRect;\r\n\tlet $rootRect;\r\n\tlet $isInteractingFraction;\r\n\tlet $isInteracting;\r\n\tlet $rootLineColor;\r\n\tlet $rootForegroundColor;\r\n\r\n\tlet $imagePreview,\r\n\t\t$$unsubscribe_imagePreview = noop,\r\n\t\t$$subscribe_imagePreview = () => ($$unsubscribe_imagePreview(), $$unsubscribe_imagePreview = subscribe(imagePreview, $$value => $$invalidate(310, $imagePreview = $$value)), imagePreview);\r\n\r\n\tlet $imageRedaction;\r\n\tlet $imageBackgroundColor;\r\n\tlet $imageScrambler;\r\n\tlet $pressedKeysStore;\r\n\tlet $clientRect;\r\n\tlet $env;\r\n\tlet $redrawTrigger;\r\n\tlet $imageProcessingPreparing;\r\n\tlet $isAnimated;\r\n\tlet $statusOffset;\r\n\tlet $asideWidth;\r\n\tlet $statusWidth;\r\n\tlet $statusOpacity;\r\n\tlet $wasProcessingImage;\r\n\tlet $imageVisualLoadComplete;\r\n\tlet $imageProcessState;\r\n\tlet $imageLoadState;\r\n\tlet $imagePreviewSource;\r\n\tlet $activeImages;\r\n\tlet $imageProps;\r\n\tlet $shouldAnimate;\r\n\tlet $imagePreviewModifiers;\r\n\tlet $imageTransforms;\r\n\tlet $pointerHoverable;\r\n\tlet $pointerAccuracy;\r\n\tlet $utilTools;\r\n\tlet $mediaDuration;\r\n\tlet $previewShouldUpscale;\r\n\r\n\tlet $history,\r\n\t\t$$unsubscribe_history = noop,\r\n\t\t$$subscribe_history = () => ($$unsubscribe_history(), $$unsubscribe_history = subscribe(history, $$value => $$invalidate(332, $history = $$value)), history);\r\n\r\n\tlet $imageState;\r\n\tlet $tabRect;\r\n\tlet $imageFile;\r\n\tlet $imageOverlayMarkup;\r\n\tlet $overlayBottomRect;\r\n\tlet $overlayOpacity;\r\n\tlet $rootBackgroundColor;\r\n\tlet $overlayRightRect;\r\n\tlet $overlayTopRect;\r\n\tlet $overlayLeftRect;\r\n\tlet $pixelRatio;\r\n\tlet $imageSelectionRectPresentation;\r\n\tlet $stagePadding;\r\n\tlet $stagePadded;\r\n\tlet $imageSelectionRectStaticScalar;\r\n\tlet $imageSelectionRect;\r\n\tlet $imageCropRect;\r\n\tlet $imageStaticBounds;\r\n\tlet $imageCropRectIntent;\r\n\tlet $imageSelectionRectSnapshot;\r\n\tlet $imageIsStatic;\r\n\tlet $imageCropRectSnapshot;\r\n\tlet $presentationScalar;\r\n\tlet $stageScalar;\r\n\tlet $imageSelectionScalar;\r\n\tlet $imageSelectionPan;\r\n\tlet $imageSelectionRectIntent;\r\n\tlet $imageSelectionRectOffset;\r\n\tlet $imageSelectionZoom;\r\n\tlet $prefersReducedMotion;\r\n\tlet $imageCropAspectRatio;\r\n\tlet $enablePanInputStore;\r\n\tlet $enablePanInputProp;\r\n\tlet $shapePreprocessor;\r\n\tlet $images;\r\n\tlet $mediaTrim;\r\n\tlet $willRequest;\r\n\tlet $elasticityMultiplierStore;\r\n\tlet $asideOffset;\r\n\tlet $asideOpacity;\r\n\tlet $toolRect;\r\n\tlet $imageCropLimitToImage;\r\n\tlet $interfaceImages;\r\n\tlet $willRequestResource;\r\n\tlet $imageOverlay;\r\n\tlet $allowPan;\r\n\tlet $enablePanInputStatus;\r\n\tlet $allowZoom;\r\n\tlet $enableZoomInputStore;\r\n\tlet $enableZoomControlsProp;\r\n\tlet $imageSelectionRectCentered;\r\n\tlet $imageSelectionRectScalar;\r\n\tlet $disabledTransition;\r\n\tcomponent_subscribe($$self, prefersReducedMotion, $$value => $$invalidate(346, $prefersReducedMotion = $$value));\r\n\t$$self.$$.on_destroy.push(() => $$unsubscribe_imagePreview());\r\n\t$$self.$$.on_destroy.push(() => $$unsubscribe_history());\r\n\tconst eventProxy = pubsub();\r\n\tconst dispatch = createEventDispatcher();\r\n\tlet { class: klass = undefined } = $$props;\r\n\tlet { layout: layoutMode = undefined } = $$props;\r\n\tlet { stores } = $$props;\r\n\tlet { locale = undefined } = $$props;\r\n\tlet { id = undefined } = $$props;\r\n\tlet { util = undefined } = $$props;\r\n\tlet { utils = undefined } = $$props;\r\n\tlet { animations = 'auto' } = $$props;\r\n\tlet { disabled = false } = $$props;\r\n\tlet { status = undefined } = $$props;\r\n\tlet { previewUpscale = false } = $$props;\r\n\tlet { previewPad = false } = $$props;\r\n\tlet { previewMaskOpacity = 0.95 } = $$props;\r\n\tlet { markupMaskOpacity = 1 } = $$props;\r\n\tlet { elasticityMultiplier = 10 } = $$props;\r\n\tlet { willRevert = () => Promise.resolve(true) } = $$props;\r\n\tlet { willProcessImage = () => Promise.resolve(true) } = $$props;\r\n\tlet { willRenderCanvas = passthrough } = $$props;\r\n\tlet { willRenderToolbar = passthrough } = $$props;\r\n\tlet { willSetHistoryInitialState = passthrough } = $$props;\r\n\tlet { enableButtonExport = true } = $$props;\r\n\tlet { enableButtonRevert = true } = $$props;\r\n\tlet { enableNavigateHistory = true } = $$props;\r\n\tlet { enableToolbar = true } = $$props;\r\n\tlet { enableUtils = true } = $$props;\r\n\tlet { enableButtonClose = false } = $$props;\r\n\tlet { enableDropImage = true } = $$props;\r\n\tlet { enablePasteImage = false } = $$props;\r\n\tlet { enableBrowseImage = false } = $$props;\r\n\tlet { previewImageDataMaxSize = undefined } = $$props;\r\n\tlet { previewImageTextPixelRatio = undefined } = $$props;\r\n\tlet { layoutDirectionPreference = 'auto' } = $$props;\r\n\tlet { layoutHorizontalUtilsPreference = 'left' } = $$props;\r\n\tlet { layoutVerticalUtilsPreference = 'bottom' } = $$props;\r\n\tlet { layoutVerticalToolbarPreference = 'top' } = $$props;\r\n\tlet { layoutVerticalControlGroupsPreference = 'bottom' } = $$props;\r\n\tlet { layoutVerticalControlTabsPreference = 'bottom' } = $$props;\r\n\tlet { markupEditorZoomLevel = null } = $$props;\r\n\tlet { markupEditorZoomLevels = undefined } = $$props;\r\n\tlet { markupEditorZoomAdjustStep = undefined } = $$props;\r\n\tlet { markupEditorZoomAdjustFactor = undefined } = $$props;\r\n\tlet { markupEditorZoomAdjustWheelFactor = undefined } = $$props;\r\n\tlet { markupEditorInteractionMode = false } = $$props;\r\n\tlet { enablePan = true } = $$props;\r\n\tlet { enableZoom = true } = $$props;\r\n\tlet { enableZoomControls = true } = $$props;\r\n\tlet { enableZoomInput = undefined } = $$props;\r\n\tlet { enablePanInput = undefined } = $$props;\r\n\tlet { enableCanvasAlpha = false } = $$props;\r\n\tlet { enablePanLimit = undefined } = $$props;\r\n\tlet { panLimitGutterScalar = undefined } = $$props;\r\n\tlet { zoomPresetOptions = [0.25, 0.5, 1, 1.25, 1.5, 2, 3, 4, 6, 8, 16] } = $$props;\r\n\tlet { zoomAdjustStep = 0.25 } = $$props;\r\n\tlet { zoomAdjustFactor = 0.1 } = $$props;\r\n\tlet { zoomAdjustWheelFactor = 1 } = $$props;\r\n\tlet { zoomLevel = null } = $$props;\r\n\tlet { imagePreviewSrc = undefined } = $$props;\r\n\tlet { imageOrienter = { read: () => 1, apply: v => v } } = $$props;\r\n\tlet { pluginComponents = undefined } = $$props;\r\n\tlet { pluginOptions = {} } = $$props;\r\n\tconst sub = eventProxy.sub;\r\n\tconst pluginInterface = {};\r\n\tlet { root } = $$props;\r\n\r\n\t// setup redraw store\r\n\tconst redrawTrigger = writable({});\r\n\r\n\tcomponent_subscribe($$self, redrawTrigger, value => $$invalidate(49, $redrawTrigger = value));\r\n\tsetContext('redrawTrigger', redrawTrigger);\r\n\tconst elasticityMultiplierStore = writable(elasticityMultiplier);\r\n\tcomponent_subscribe($$self, elasticityMultiplierStore, value => $$invalidate(410, $elasticityMultiplierStore = value));\r\n\tsetContext('elasticityMultiplier', elasticityMultiplierStore);\r\n\tlet registeredPluginsComponents = [];\r\n\r\n\t// editor disabled spring for animating in and out disabled state\r\n\tconst disabledTransition = spring();\r\n\r\n\tcomponent_subscribe($$self, disabledTransition, value => $$invalidate(91, $disabledTransition = value));\r\n\r\n\t// this method is used to read image resources (preview image / shape images)\r\n\tconst glMaxTextureSize = getWebGLTextureSizeLimit() || 1024;\r\n\r\n\tconst maxTextureSize = sizeCreate(glMaxTextureSize, glMaxTextureSize);\r\n\tconst canvasMemoryLimit = getCanvasMemoryLimit();\r\n\r\n\tconst fetchSrc = src => Promise.resolve($willRequest && $willRequest(src, { resourceType: 'image' })).then(requestInit => {\r\n\t\t// do something with options\r\n\t\tif (requestInit === false) return;\r\n\r\n\t\t// get props\r\n\t\tconst { headers, credentials } = requestInit || {};\r\n\r\n\t\t// fetch\r\n\t\treturn fetch(src, { headers, credentials }).then(res => {\r\n\t\t\tif (res.status !== 200) throw `${res.status} (${res.statusText})`;\r\n\t\t\treturn res.blob();\r\n\t\t}).then(blob => blobToImageBitmap(blob, imageOrienter, canvasMemoryLimit)).then(imageData => imageDataContain(imageData, maxImageDataSize));\r\n\t});\r\n\r\n\tlet { imageSourceToImageData = src => isString(src)\r\n\t? // it's a url src\r\n\t\tfetchSrc(src)\r\n\t: isElement(src)\r\n\t\t? // assume src is a <canvas>\r\n\t\t\tnew Promise(resolve => resolve(canvasToImageData(src)))\r\n\t\t: // assume src is a File or Blob\r\n\t\t\tisBlob(src) || isFile(src)\r\n\t\t\t? blobToImageBitmap(src, imageOrienter, canvasMemoryLimit).then(imageData => imageDataContain(imageData, maxImageDataSize))\r\n\t\t\t: undefined } = $$props;\r\n\r\n\tconst imageProxy = createImageProxy();\r\n\tconst { file: imageFile, size: imageSize, duration: mediaDuration, trim: mediaTrim, loadState: imageLoadState, processState: imageProcessState, cropAspectRatio: imageCropAspectRatio, cropLimitToImage: imageCropLimitToImage, crop: imageCropRect, cropMinSize: imageCropMinSize, cropMaxSize: imageCropMaxSize, cropRange: imageCropRange, cropOrigin: imageCropRectOrigin, cropRectAspectRatio: imageCropRectAspectRatio, rotation: imageRotation, rotationRange: imageRotationRange, targetSize: imageOutputSize, flipX: imageFlipX, flipY: imageFlipY, backgroundColor: imageBackgroundColor, backgroundImage: imageBackgroundImageSrc, colorMatrix: imageColorMatrix, convolutionMatrix: imageConvolutionMatrix, gamma: imageGamma, vignette: imageVignette, noise: imageNoise, decoration: imageDecoration, annotation: imageAnnotation, redaction: imageRedaction, frame: imageFrame, state: imageState } = imageProxy.stores;\r\n\tcomponent_subscribe($$self, imageFile, value => $$invalidate(333, $imageFile = value));\r\n\tcomponent_subscribe($$self, imageSize, value => $$invalidate(303, $imageSize = value));\r\n\tcomponent_subscribe($$self, mediaDuration, value => $$invalidate(330, $mediaDuration = value));\r\n\tcomponent_subscribe($$self, mediaTrim, value => $$invalidate(409, $mediaTrim = value));\r\n\tcomponent_subscribe($$self, imageLoadState, value => $$invalidate(322, $imageLoadState = value));\r\n\tcomponent_subscribe($$self, imageProcessState, value => $$invalidate(321, $imageProcessState = value));\r\n\tcomponent_subscribe($$self, imageCropAspectRatio, value => $$invalidate(406, $imageCropAspectRatio = value));\r\n\tcomponent_subscribe($$self, imageCropLimitToImage, value => $$invalidate(80, $imageCropLimitToImage = value));\r\n\tcomponent_subscribe($$self, imageCropRect, value => $$invalidate(342, $imageCropRect = value));\r\n\tcomponent_subscribe($$self, imageRotation, value => $$invalidate(306, $imageRotation = value));\r\n\tcomponent_subscribe($$self, imageFlipX, value => $$invalidate(305, $imageFlipX = value));\r\n\tcomponent_subscribe($$self, imageFlipY, value => $$invalidate(304, $imageFlipY = value));\r\n\tcomponent_subscribe($$self, imageBackgroundColor, value => $$invalidate(312, $imageBackgroundColor = value));\r\n\tcomponent_subscribe($$self, imageDecoration, value => $$invalidate(46, $imageDecoration = value));\r\n\tcomponent_subscribe($$self, imageAnnotation, value => $$invalidate(47, $imageAnnotation = value));\r\n\tcomponent_subscribe($$self, imageRedaction, value => $$invalidate(311, $imageRedaction = value));\r\n\tcomponent_subscribe($$self, imageFrame, value => $$invalidate(45, $imageFrame = value));\r\n\tcomponent_subscribe($$self, imageState, value => $$invalidate(394, $imageState = value));\r\n\r\n\tconst createImageSrcLoader = (src, token, minDuration = 0) => new Promise((resolve, reject) => {\r\n\t\t\t// is a video\r\n\t\t\tif (isVideoFile(src)) {\r\n\t\t\t\tconst metadataReader = isFirefox()\r\n\t\t\t\t? getVideoFileRotationMetadata(src)\r\n\t\t\t\t: Promise.resolve();\r\n\r\n\t\t\t\tmetadataReader.then(rotation => {\r\n\t\t\t\t\t// let's load this source as a video file\r\n\t\t\t\t\tconst video = document.createElement('video');\r\n\r\n\t\t\t\t\tvideo.playsInline = true;\r\n\t\t\t\t\tvideo.preload = 'auto';\r\n\r\n\t\t\t\t\tvideo.onloadeddata = () => {\r\n\t\t\t\t\t\tvideo.dataset.rotation = rotation;\r\n\t\t\t\t\t\tvideo.currentTime = video.duration * ($mediaTrim ? getRangeCenter($mediaTrim[0]) : 0.5);\r\n\t\t\t\t\t\tresolve(video);\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tvideo.src = URL.createObjectURL(src);\r\n\r\n\t\t\t\t\t// this is needed to trigger load on iOS Safari\r\n\t\t\t\t\tvideo.load();\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet cancelled = false;\r\n\t\t\tlet timer;\r\n\t\t\ttoken.cancel = () => cancelled = true;\r\n\t\t\tconst now = Date.now();\r\n\r\n\t\t\timageSourceToImageData(src).then(imageData => {\r\n\t\t\t\tconst dist = Date.now() - now;\r\n\t\t\t\tclearTimeout(timer);\r\n\r\n\t\t\t\ttimer = setTimeout(\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\tif (cancelled) return;\r\n\t\t\t\t\t\tresolve(imageData);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tMath.max(0, minDuration - dist)\r\n\t\t\t\t);\r\n\t\t\t}).catch(reject);\r\n\t\t});\r\n\r\n\tconst { images, shapePreprocessor, imageScrambler, willRequest, willRequestResource } = stores;\r\n\tcomponent_subscribe($$self, images, value => $$invalidate(348, $images = value));\r\n\tcomponent_subscribe($$self, shapePreprocessor, value => $$invalidate(347, $shapePreprocessor = value));\r\n\tcomponent_subscribe($$self, imageScrambler, value => $$invalidate(313, $imageScrambler = value));\r\n\tcomponent_subscribe($$self, willRequest, value => $$invalidate(76, $willRequest = value));\r\n\tcomponent_subscribe($$self, willRequestResource, value => $$invalidate(82, $willRequestResource = value));\r\n\tlet backgroundImageDataCancelToken;\r\n\r\n\tconst imageBackgroundImageData = derived(imageBackgroundImageSrc, ($backgroundImageSrc, set) => {\r\n\t\tif (!$backgroundImageSrc) return;\r\n\r\n\t\t// cancel existing loader\r\n\t\tif (backgroundImageDataCancelToken) {\r\n\t\t\tbackgroundImageDataCancelToken.cancel();\r\n\t\t\tbackgroundImageDataCancelToken = undefined;\r\n\t\t}\r\n\r\n\t\t// new cancel token\r\n\t\tbackgroundImageDataCancelToken = { cancel: noop$1 };\r\n\r\n\t\tcreateImageSrcLoader($backgroundImageSrc, backgroundImageDataCancelToken).then(set).catch(err => {\r\n\t\t\t// log to console for debugging purposes\r\n\t\t});\r\n\t});\r\n\r\n\t// let the world know about state changes\r\n\tconst imageStateUnsub = imageState.subscribe(state => eventProxy.pub('update', state));\r\n\r\n\t// this will hold the currently selected util\r\n\tconst utilSelectedStore = writable();\r\n\r\n\t// current editor UI state\r\n\tconst uiState = writable({});\r\n\r\n\tsetContext('ui', uiState);\r\n\r\n\t// utils can toggle pan and zoom\r\n\tconst allowPan = writable(true);\r\n\r\n\tcomponent_subscribe($$self, allowPan, value => $$invalidate(84, $allowPan = value));\r\n\tconst allowZoom = writable(true);\r\n\tcomponent_subscribe($$self, allowZoom, value => $$invalidate(86, $allowZoom = value));\r\n\tconst enablePanInputStore = writable(true);\r\n\tcomponent_subscribe($$self, enablePanInputStore, value => $$invalidate(407, $enablePanInputStore = value));\r\n\tconst enableZoomInputStore = writable(true);\r\n\tcomponent_subscribe($$self, enableZoomInputStore, value => $$invalidate(87, $enableZoomInputStore = value));\r\n\r\n\t// so controls can be disabled from other component\r\n\tconst enableZoomControlsProp = writable();\r\n\r\n\tcomponent_subscribe($$self, enableZoomControlsProp, value => $$invalidate(88, $enableZoomControlsProp = value));\r\n\r\n\t// so we can derive pan input status\r\n\tconst enablePanInputProp = writable();\r\n\r\n\tcomponent_subscribe($$self, enablePanInputProp, value => $$invalidate(408, $enablePanInputProp = value));\r\n\r\n\t// current pan input status\r\n\tconst enablePanInputStatus = derived([enablePanInputProp, enablePanInputStore], (() => $enablePanInputProp !== undefined\r\n\t? $enablePanInputProp\r\n\t: $enablePanInputStore));\r\n\r\n\tcomponent_subscribe($$self, enablePanInputStatus, value => $$invalidate(85, $enablePanInputStatus = value));\r\n\r\n\t//\r\n\t// handles the view rect size, makes sure it is offset from the top\r\n\t//\r\n\t// root element reference used to read styles\r\n\tconst rootBackgroundColor = writable([0, 0, 0]);\r\n\r\n\tcomponent_subscribe($$self, rootBackgroundColor, value => $$invalidate(53, $rootBackgroundColor = value));\r\n\tconst rootForegroundColor = writable([1, 1, 1]);\r\n\tcomponent_subscribe($$self, rootForegroundColor, value => $$invalidate(391, $rootForegroundColor = value));\r\n\tconst rootLineColor = spring([1, 1, 1]);\r\n\tcomponent_subscribe($$self, rootLineColor, value => $$invalidate(390, $rootLineColor = value));\r\n\tconst rootColorSecondary = writable();\r\n\r\n\t// client rect is the editor rect excluding scroll offset\r\n\tconst clientRect = writable();\r\n\r\n\tcomponent_subscribe($$self, clientRect, value => $$invalidate(48, $clientRect = value));\r\n\r\n\t// root rect is the editor rect including scroll offset\r\n\tconst rootRect = writable();\r\n\r\n\tcomponent_subscribe($$self, rootRect, value => $$invalidate(308, $rootRect = value));\r\n\r\n\t// when in overlay mode force aspect ratio to aspect ratio of editor root\r\n\tconst syncRootAspectRatio = () => {\r\n\t\t// get current aspect ratio and get next aspect ratio, compare, if different, reset\r\n\t\tconst currentAspectRatio = $imageCropAspectRatio;\r\n\r\n\t\tconst nextAspectRatio = rectAspectRatio($rootRect);\r\n\t\tif (currentAspectRatio && currentAspectRatio === nextAspectRatio) return;\r\n\r\n\t\t// set aspect ratio\r\n\t\timageCropAspectRatio.set(rectAspectRatio($rootRect));\r\n\r\n\t\t// need to set history 0 point to this state\r\n\t\tsetInitialHistoryState();\r\n\t};\r\n\r\n\tconst tabRect = writable(rectCreateEmpty());\r\n\tcomponent_subscribe($$self, tabRect, value => $$invalidate(75, $tabRect = value));\r\n\tconst toolRect = writable(rectCreateEmpty());\r\n\tcomponent_subscribe($$self, toolRect, value => $$invalidate(79, $toolRect = value));\r\n\tconst utilRect = writable(); // is undefined because we wait till util is set before defining stage rect\r\n\tcomponent_subscribe($$self, utilRect, value => $$invalidate(388, $utilRect = value));\r\n\r\n\t//\r\n\t// environment\r\n\t//\r\n\tconst pointerAccuracy = mediaQueryStore('(pointer: fine)', matches => matches ? 'pointer-fine' : 'pointer-coarse');\r\n\r\n\tcomponent_subscribe($$self, pointerAccuracy, value => $$invalidate(328, $pointerAccuracy = value));\r\n\tconst pointerHoverable = mediaQueryStore('(hover: hover)', matches => matches ? 'pointer-hover' : 'pointer-no-hover');\r\n\tcomponent_subscribe($$self, pointerHoverable, value => $$invalidate(327, $pointerHoverable = value));\r\n\r\n\t//\r\n\t// app API\r\n\t//\r\n\tconst isTransformingImage = writable(false);\r\n\r\n\tconst isInteracting = writable(false);\r\n\tcomponent_subscribe($$self, isInteracting, value => $$invalidate(309, $isInteracting = value));\r\n\r\n\tconst isInteractingFraction = readable(undefined, set => {\r\n\t\tconst animator = spring(0);\r\n\r\n\t\tconst updater = value => {\r\n\t\t\tanimator.set(value ? 1 : 0);\r\n\t\t};\r\n\r\n\t\tconst subs = [isInteracting.subscribe(updater), animator.subscribe(set)];\r\n\r\n\t\t// destroy subs\r\n\t\treturn () => subs.forEach(unsub => unsub());\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, isInteractingFraction, value => $$invalidate(389, $isInteractingFraction = value));\r\n\r\n\t// create animation stores\r\n\tconst shouldAnimate = writable();\r\n\r\n\tcomponent_subscribe($$self, shouldAnimate, value => $$invalidate(393, $shouldAnimate = value));\r\n\tconst isAnimated = writable();\r\n\tcomponent_subscribe($$self, isAnimated, value => $$invalidate(50, $isAnimated = value));\r\n\r\n\t// Animations based on prefers-reduced-motion, automatically checks if user prefers reduced animations\r\n\tsetContext('isAnimated', isAnimated);\r\n\r\n\tconst previewShouldUpscale = writable(previewUpscale);\r\n\tcomponent_subscribe($$self, previewShouldUpscale, value => $$invalidate(331, $previewShouldUpscale = value));\r\n\r\n\t//\r\n\t// image related\r\n\t//\r\n\tconst imageIsStatic = writable(false); // if is set to true image is selection is dragged\r\n\r\n\tcomponent_subscribe($$self, imageIsStatic, value => $$invalidate(399, $imageIsStatic = value));\r\n\tsetContext('imageIsStatic', imageIsStatic);\r\n\tconst imageCropRectSnapshot = writable();\r\n\tcomponent_subscribe($$self, imageCropRectSnapshot, value => $$invalidate(400, $imageCropRectSnapshot = value));\r\n\tconst imageCropRectIntent = writable(); // should always be set before setting `imageCropRect`\r\n\tcomponent_subscribe($$self, imageCropRectIntent, value => $$invalidate(397, $imageCropRectIntent = value));\r\n\r\n\tconst imageCropRectPresentation = readable(undefined, set => {\r\n\t\tconst animator = writable(undefined);\r\n\r\n\t\tconst update = () => {\r\n\t\t\tif (!$imageCropRect) return;\r\n\r\n\t\t\t// no elasticity needed when dragging crop selection\r\n\t\t\tif ($imageIsStatic) return animator.set(rectClone$1($imageCropRect));\r\n\r\n\t\t\t// apply elasticity\r\n\t\t\tconst elasticRect = elastifyRects($imageCropRect, $imageCropRectIntent, imageCropRectElasticity * elasticityMultiplier);\r\n\r\n\t\t\tanimator.set(elasticRect);\r\n\t\t};\r\n\r\n\t\tconst subs = [\r\n\t\t\t// need to update presentation rect when crop rect is updated\r\n\t\t\timageCropRect.subscribe(update),\r\n\t\t\t// update parent store\r\n\t\t\tanimator.subscribe(set)\r\n\t\t];\r\n\r\n\t\treturn () => subs.forEach(unsub => unsub());\r\n\t});\r\n\r\n\tconst imageSelectionRect = writable();\r\n\tcomponent_subscribe($$self, imageSelectionRect, value => $$invalidate(396, $imageSelectionRect = value));\r\n\tconst imageSelectionRectSnapshot = writable();\r\n\tcomponent_subscribe($$self, imageSelectionRectSnapshot, value => $$invalidate(398, $imageSelectionRectSnapshot = value));\r\n\tconst imageSelectionRectIntent = writable(undefined); // should always be set before setting `imageSelectionRect`\r\n\tcomponent_subscribe($$self, imageSelectionRectIntent, value => $$invalidate(404, $imageSelectionRectIntent = value));\r\n\tconst imageSelectionRectOffset = writable(vectorCreateEmpty());\r\n\tcomponent_subscribe($$self, imageSelectionRectOffset, value => $$invalidate(405, $imageSelectionRectOffset = value));\r\n\r\n\tconst getFrameOutset = (presentationRect, imageFrame) => {\r\n\t\tif (!imageFrame || !presentationRect) return { top: 0, right: 0, bottom: 0, left: 0 };\r\n\t\tconst shapes = shapesFromCompositShape(imageFrame, presentationRect, preprocessShape);\r\n\t\tconst bounds = shapesBounds(shapes, presentationRect);\r\n\r\n\t\treturn {\r\n\t\t\ttop: Math.abs(bounds.top),\r\n\t\t\tright: Math.abs(bounds.right),\r\n\t\t\tbottom: Math.abs(bounds.bottom),\r\n\t\t\tleft: Math.abs(bounds.left)\r\n\t\t};\r\n\t};\r\n\r\n\t// let stageRecenterPrev;\r\n\tconst stageRecenter = writable({});\r\n\r\n\tconst stageRectBase = derived([utilRect, tabRect, toolRect, stageRecenter], ([$utilRect, $tabRect, $toolRect, $stageRecenter], set) => {\r\n\t\tif (!$utilRect) return set(undefined);\r\n\t\tlet utilOffsetY = 0;\r\n\r\n\t\t// if only one util active, we don't have util tabs, so add additional offset\r\n\t\tif (utilsFiltered.length === 1 && !isOverlayModeEnabled) {\r\n\t\t\tutilOffsetY = $toolRect.y + $toolRect.height;\r\n\t\t}\r\n\r\n\t\tset(rectCreate($utilRect.x + $tabRect.x, $utilRect.y + $tabRect.y + utilOffsetY, $utilRect.width, $utilRect.height));\r\n\t});\r\n\r\n\tlet prevStagePadding = { left: 0, right: 0, top: 0, bottom: 0 };\r\n\tconst shouldPadPreview = writable(false);\r\n\r\n\tconst stagePadding = derived([shouldPadPreview, imageFrame, stageRectBase, isInteracting], ([$shouldPadPreview, $imageFrame, $stageRectBase, $isInteracting], set) => {\r\n\t\tif (!$stageRectBase) {\r\n\t\t\treturn set({ left: 0, right: 0, top: 0, bottom: 0 });\r\n\t\t}\r\n\r\n\t\t// exit\r\n\t\tif (!$shouldPadPreview) return;\r\n\r\n\t\t// a sane default padding around a frame\r\n\t\tconst size = Math.min($stageRectBase.width, $stageRectBase.height);\r\n\r\n\t\t// set frame padding\r\n\t\tconst newStagePadding = getFrameOutset({ width: size, height: size }, $imageFrame);\r\n\r\n\t\t// exit if no value changes\r\n\t\tif (fixPrecision(prevStagePadding.top, 4) === fixPrecision(newStagePadding.top, 4) && fixPrecision(prevStagePadding.bottom, 4) === fixPrecision(newStagePadding.bottom, 4) && fixPrecision(prevStagePadding.right, 4) === fixPrecision(newStagePadding.right, 4) && fixPrecision(prevStagePadding.left, 4) === fixPrecision(newStagePadding.left, 4)) return;\r\n\r\n\t\tprevStagePadding = newStagePadding;\r\n\t\tset(newStagePadding);\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, stagePadding, value => $$invalidate(340, $stagePadding = value));\r\n\r\n\tconst stagePadded = derived([shouldPadPreview, stagePadding], ([$shouldPadPreview, $stagePadding], set) => {\r\n\t\tif (!$shouldPadPreview) return set(false);\r\n\t\tset(Object.values($stagePadding).some(value => value > 0));\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, stagePadded, value => $$invalidate(341, $stagePadded = value));\r\n\r\n\tconst utilRectPadded = derived([shouldPadPreview, utilRect, stagePadded, stagePadding], ([$shouldPadPreview, $utilRect, $stagePadded, $stagePadding], set) => {\r\n\t\tif (!$utilRect) return;\r\n\t\tif (!$shouldPadPreview || !$stagePadded) return set({ ...$utilRect });\r\n\t\tset(rectCreate($utilRect.x + $stagePadding.left, $utilRect.y + $stagePadding.top, $utilRect.width - $stagePadding.left - $stagePadding.right, $utilRect.height - $stagePadding.top - $stagePadding.bottom));\r\n\t});\r\n\r\n\tconst stageRect = derived([stageRectBase, stagePadded, stagePadding], ([$stageRectBase, $stagePadded, $stagePadding], set) => {\r\n\t\tif (!$stageRectBase) return set(undefined);\r\n\t\tif (!$stagePadded) return set($stageRectBase);\r\n\t\tset(rectCreate($stageRectBase.x + $stagePadding.left, $stageRectBase.y + $stagePadding.top, $stageRectBase.width - $stagePadding.left - $stagePadding.right, $stageRectBase.height - $stagePadding.top - $stagePadding.bottom));\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, stageRect, value => $$invalidate(307, $stageRect = value));\r\n\r\n\tconst imageStaticCorners = derived([imageIsStatic, imageSize, imageRotation], ([$imageIsStatic, $imageSize, $imageRotation], set) => {\r\n\t\t// no need for bounds measuring if is not static image\r\n\t\tif (!$imageIsStatic || !$imageSize) return set(undefined);\r\n\r\n\t\tconst rect = rectCreateFromSize($imageSize);\r\n\t\tconst rectRotatedCorners = rectRotate(rect, $imageRotation);\r\n\t\tset(rectRotatedCorners);\r\n\t});\r\n\r\n\tconst imageStaticBounds = derived([imageStaticCorners], ([$imageStaticCorners], set) => {\r\n\t\tif (!$imageStaticCorners) return set(undefined);\r\n\t\tconst rectRotated = rectCreateFromPoints($imageStaticCorners);\r\n\t\tset(rectNormalizeOffset(rectRotated));\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, imageStaticBounds, value => $$invalidate(343, $imageStaticBounds = value));\r\n\r\n\tconst stageScalar = derived([stageRect, imageCropRect, imageStaticBounds, previewShouldUpscale], ([$stageRect, $imageCropRect, $imageStaticBounds, $previewShouldUpscale], set) => {\r\n\t\tconst isManipulatingImageCropRect = !!($imageCropRectSnapshot || $imageCropRectIntent);\r\n\r\n\t\t// update stage scalar, the crop output size relative to the stage, if image fits it's 1\r\n\t\tif (!$stageRect || !$imageCropRect || isManipulatingImageCropRect) return;\r\n\r\n\t\t// use image bounds instead of crop\r\n\t\tconst { width, height } = $imageStaticBounds || $imageCropRect;\r\n\r\n\t\t// calculate scale factor needed to fit crop rect to stage\r\n\t\tconst scalar = Math.min($stageRect.width / width, $stageRect.height / height);\r\n\r\n\t\t// always scaled down to fit stage, if is allowed to upscale, zoom to fit stage\r\n\t\tconst scale = $previewShouldUpscale ? scalar : Math.min(1, scalar);\r\n\r\n\t\tset(scale);\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, stageScalar, value => $$invalidate(402, $stageScalar = value));\r\n\r\n\tconst imageStaticVisualCorners = derived([imageIsStatic, imageSize, imageRotation, stageRect, utilRect, stageScalar], ([\r\n\t\t\t$imageIsStatic,\r\n\t\t\t$imageSize,\r\n\t\t\t$imageRotation,\r\n\t\t\t$stageRect,\r\n\t\t\t$utilRect,\r\n\t\t\t$stageScalar\r\n\t\t], set) => {\r\n\t\t// no need for bounds measuring if is not static image\r\n\t\tif (!$imageIsStatic || !$stageRect || !$utilRect || !$imageSize) return set(undefined);\r\n\r\n\t\tconst rect = rectCreateFromSize($imageSize);\r\n\t\tconst rectScaled = rectNormalizeOffset(rectScale$1(rect, $stageScalar));\r\n\t\tconst rectCentered = rectCenterRect($stageRect, rectScaled);\r\n\t\trectScaled.x = rectCentered.x;\r\n\t\trectScaled.y = rectCentered.y;\r\n\t\tconst rectRotatedCorners = rectRotate(rectScaled, $imageRotation);\r\n\t\tset(rectRotatedCorners);\r\n\t});\r\n\r\n\tsetContext('imageStaticVisualCorners', imageStaticVisualCorners);\r\n\r\n\t//\r\n\t// Image selection\r\n\t//\r\n\tconst imageSelectionZoom = writable(undefined);\r\n\r\n\tcomponent_subscribe($$self, imageSelectionZoom, value => $$invalidate(345, $imageSelectionZoom = value));\r\n\r\n\tconst imageSelectionStageFitScalar = derived([imageCropRect, stageRect], ([$imageCropRect, $stageRect]) => {\r\n\t\t// wait a bit\r\n\t\tif (!$stageRect || !$imageCropRect) return undefined;\r\n\r\n\t\treturn Math.min($stageRect.width / $imageCropRect.width, $stageRect.height / $imageCropRect.height);\r\n\t});\r\n\r\n\tconst imageSelectionRectScalar = derived([imageCropRect, imageSelectionRect], ([$imageCropRect, $imageSelectionRect]) => {\r\n\t\t// wait a bit\r\n\t\tif (!$imageCropRect || !$imageSelectionRect) return 1;\r\n\r\n\t\treturn Math.min($imageCropRect.width / $imageSelectionRect.width, $imageCropRect.height / $imageSelectionRect.height);\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, imageSelectionRectScalar, value => $$invalidate(90, $imageSelectionRectScalar = value));\r\n\r\n\tconst imageSelectionScalar = derived([imageSelectionZoom, imageSelectionRectScalar], ([$imageSelectionZoom, $imageSelectionRectScalar]) => {\r\n\t\t// wait a bit\r\n\t\tif (!$imageSelectionZoom || !$imageSelectionRectScalar) return 1;\r\n\r\n\t\t// calculate scalar  to get actual image size\r\n\t\treturn $imageSelectionRectScalar * $imageSelectionZoom;\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, imageSelectionScalar, value => $$invalidate(403, $imageSelectionScalar = value));\r\n\tconst imageSelectionPan = writable(vectorCreateEmpty());\r\n\tcomponent_subscribe($$self, imageSelectionPan, value => $$invalidate(344, $imageSelectionPan = value));\r\n\r\n\tconst imageSelectionStoredState = writable({\r\n\t\tscalar: $imageSelectionScalar,\r\n\t\ttranslation: $imageSelectionPan\r\n\t});\r\n\r\n\tconst imageSelectionStoredStateReset = () => {\r\n\t\timageSelectionStoredState.set({\r\n\t\t\tscalar: undefined,\r\n\t\t\ttranslation: vectorCreateEmpty()\r\n\t\t});\r\n\t};\r\n\r\n\tconst imageSelectionRectPresentation = readable(undefined, set => {\r\n\t\tconst animator = spring(undefined, { precision: 0.0001 });\r\n\r\n\t\tconst snapPixels = getDevicePixelRatio() === 1\r\n\t\t? rect => rectApply(rect, Math.round)\r\n\t\t: passthrough;\r\n\r\n\t\tconst updater = () => {\r\n\t\t\tif (!$imageSelectionRect) return;\r\n\t\t\tconst instantUpdate = $isInteracting || !$shouldAnimate;\r\n\r\n\t\t\t// no elasticity needed if image is fixed\r\n\t\t\tif ($imageIsStatic) {\r\n\t\t\t\tconst rect = rectClone$1($imageSelectionRect);\r\n\t\t\t\trectTranslate$1(rect, $imageSelectionRectOffset);\r\n\t\t\t\trectTranslate$1(rect, $stageRect);\r\n\t\t\t\treturn animator.set(rect, { hard: instantUpdate });\r\n\t\t\t}\r\n\r\n\t\t\tconst elasticRect = elastifyRects($imageSelectionRect, $imageSelectionRectIntent, imageSelectionRectElasticity * elasticityMultiplier);\r\n\r\n\t\t\t// prevent negative size (can happen because of elastics)\r\n\t\t\tif (elasticRect.width < 0) {\r\n\t\t\t\telasticRect.width = 0;\r\n\t\t\t\telasticRect.x = $imageSelectionRect.x;\r\n\t\t\t}\r\n\r\n\t\t\tif (elasticRect.height < 0) {\r\n\t\t\t\telasticRect.height = 0;\r\n\t\t\t\telasticRect.y = $imageSelectionRect.y;\r\n\t\t\t}\r\n\r\n\t\t\t// translate elastic rect x,y by stage rect x,y\r\n\t\t\trectTranslate$1(elasticRect, $stageRect);\r\n\r\n\t\t\t// translate\r\n\t\t\trectTranslate$1(elasticRect, $imageSelectionPan);\r\n\r\n\t\t\t// scale to zoom in view\r\n\t\t\trectScale$1(elasticRect, $imageSelectionScalar);\r\n\r\n\t\t\t// round to pixels on low res displays\r\n\t\t\t!instantUpdate && snapPixels(elasticRect);\r\n\r\n\t\t\tanimator.set(elasticRect, { hard: instantUpdate });\r\n\t\t};\r\n\r\n\t\tconst subs = [\r\n\t\t\t// need to update selection rect when stage is resized\r\n\t\t\tstageRect.subscribe(updater),\r\n\t\t\t// listen for selection rect changes (as is assigned rect will always trigger, even if assigned same rect, this is needed to also update when intent changes)\r\n\t\t\timageSelectionRect.subscribe(updater),\r\n\t\t\t// if selection scalar changes need to update presentation\r\n\t\t\timageSelectionScalar.subscribe(updater),\r\n\t\t\timageSelectionPan.subscribe(updater),\r\n\t\t\t// need to update if frame exceeds bounds\r\n\t\t\timageFrame.subscribe(updater),\r\n\t\t\t// update parent store\r\n\t\t\tanimator.subscribe(set)\r\n\t\t];\r\n\r\n\t\t// destroy subs\r\n\t\treturn () => subs.forEach(unsub => unsub());\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, imageSelectionRectPresentation, value => $$invalidate(55, $imageSelectionRectPresentation = value));\r\n\tconst imageSelectionRectStaticScalar = writable(1);\r\n\tcomponent_subscribe($$self, imageSelectionRectStaticScalar, value => $$invalidate(395, $imageSelectionRectStaticScalar = value));\r\n\r\n\tconst centerImageStaticBounds = () => {\r\n\t\tif (!$imageCropRect || !$stageRect) return;\r\n\t\tlet rect = rectMultiply(rectClone$1($imageCropRect), $stageScalar || 1);\r\n\t\tconst rectOffset = rectCenterRect($stageRect, rectMultiply(rectClone$1($imageStaticBounds), $stageScalar));\r\n\t\trectTranslate$1(rect, rectOffset);\r\n\t\tconst selectionScaledWidth = $utilRect.width / rect.width;\r\n\t\tconst selectionScaledHeight = $utilRect.height / rect.height;\r\n\t\tconst scalar = Math.min(1, selectionScaledWidth, selectionScaledHeight);\r\n\t\timageSelectionRectStaticScalar.set(scalar);\r\n\t\trectScale$1(rect, scalar);\r\n\r\n\t\t// limit selection rect to util bounds\r\n\t\trectOffsetInRect(rect, { ...$utilRect, x: 0, y: 0 });\r\n\r\n\t\timageSelectionRect.set(rect);\r\n\t};\r\n\r\n\t//\r\n\tconst imageSelectionRectCentered = derived([stageRect, stageScalar, imageCropRect, imageSize], ([$stageRect, $stageScalar, $imageCropRect, $imageSize], set) => {\r\n\t\t// not ready yet\r\n\t\tif (!$stageRect || !$imageCropRect && !$imageSize) return;\r\n\r\n\t\tset(getImageSelectionRectCentered($stageRect, $stageScalar || 1, $imageCropRect || $imageSize));\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, imageSelectionRectCentered, value => $$invalidate(89, $imageSelectionRectCentered = value));\r\n\r\n\tconst getImageSelectionRectCentered = (stageRect, stageScalar, cropRect) => {\r\n\t\tconst imageCropRectFitsStage = cropRect.width <= stageRect.width && cropRect.height <= stageRect.height;\r\n\r\n\t\t// if we have a crop rect and it fits the stage, center it\r\n\t\treturn imageCropRectFitsStage\r\n\t\t? // center the crop rectangle to the stage\r\n\t\t\trectCenterRect(stageRect, rectMultiply(rectClone$1(cropRect), stageScalar))\r\n\t\t: // render a rectangle based on the fixed crop aspect ratio, or the aspect ratio of the current crop rectangle, or as a last resort the input image\r\n\t\t\trectContainRect(stageRect, rectAspectRatio(cropRect));\r\n\t};\r\n\r\n\t// when scaling the stage we need to recenter the image selection\r\n\tlet stageRectPrev;\r\n\r\n\tlet stageScalePrev;\r\n\r\n\tconst calculateImageSelectionRect = stageRectCurrent => {\r\n\t\t// don't recalculate if no change\r\n\t\tif (isOverlayModeEnabled && stageRectPrev && rectEqual(stageRectPrev, stageRectCurrent) && stageScalePrev === $stageScalar) return;\r\n\r\n\t\t// position relative to image itself\r\n\t\tif ($imageIsStatic) return centerImageStaticBounds();\r\n\r\n\t\t// remember so we can compare later on if has changed\r\n\t\tstageRectPrev = stageRectCurrent;\r\n\r\n\t\tstageScalePrev = $stageScalar;\r\n\t\tconst centeredImageSelectionRect = getImageSelectionRectCentered(stageRectCurrent, $stageScalar, $imageCropRect || $imageSize);\r\n\t\timageSelectionRect.set(centeredImageSelectionRect);\r\n\t};\r\n\r\n\t// this runs once so we use the correct scale for the initial image selection rect\r\n\tlet hasSetInitialStageScalar = false;\r\n\r\n\tconst stageScalarUnsub = stageScalar.subscribe(scalar => {\r\n\t\t// can't recalculate without these prosp\r\n\t\tif (hasSetInitialStageScalar || scalar === undefined || !$imageCropRect) return;\r\n\r\n\t\tcalculateImageSelectionRect($stageRect);\r\n\t\thasSetInitialStageScalar = true;\r\n\t});\r\n\r\n\t// this recenters the crop when the window/stage is resized\r\n\tconst stageRectUnsub = stageRect.subscribe(rect => {\r\n\t\t// can't recalculate without these prosp\r\n\t\tif (!rect || $stageScalar === undefined || !$imageCropRect) return;\r\n\r\n\t\tcalculateImageSelectionRect(rect);\r\n\t});\r\n\r\n\tconst imageIsStaticUnsub = imageIsStatic.subscribe(isStatic => {\r\n\t\tif (!isStatic && $stageRect) calculateImageSelectionRect($stageRect);\r\n\t});\r\n\r\n\t// if we've taken a snapshot of the selection, also take a snapshot of the crop rect and the presentationScalar\r\n\t// - cropRect so we can adjust it based on the adjustments to the imageSelectionRect\r\n\t// - presentationScalar so we can use the snapshot for the calculation of the cropRect scale relative to the original imageSelectionRect (if we use the live $presentationScalar small rounding errors of the scalar result in weird glitches)\r\n\tlet presentationScalarSnapshot;\r\n\r\n\tconst imageSelectionRectSnapshotUnsub = imageSelectionRectSnapshot.subscribe(rect => {\r\n\t\tif (!rect) {\r\n\t\t\tpresentationScalarSnapshot = undefined;\r\n\t\t\tset_store_value(imageCropRectSnapshot, $imageCropRectSnapshot = undefined, $imageCropRectSnapshot);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tpresentationScalarSnapshot = $presentationScalar;\r\n\t\tconst cropRectClone = rectClone$1($imageCropRect);\r\n\t\timageCropRectSnapshot.set(cropRectClone);\r\n\t});\r\n\r\n\t// if image selection rect is being manipulated, and imageSelectionRectSnapshot has been defined, we also need to update the crop rect\r\n\tconst imageSelectionRectUnsub = imageSelectionRect.subscribe(rect => {\r\n\t\t// only sync crop rect with image selection rect when no longer manipulating\r\n\t\tif (!rect || !$imageSelectionRectSnapshot) return;\r\n\r\n\t\tconst offset = rectSubtract(rectClone$1(rect), $imageSelectionRectSnapshot);\r\n\t\trectDivide(offset, presentationScalarSnapshot);\r\n\t\tconst crop = rectAdd(rectClone$1($imageCropRectSnapshot), offset);\r\n\t\timageCropRect.set(crop);\r\n\t});\r\n\r\n\tconst updateImageSelectionRect = rect => {\r\n\t\t// if no rect, we can't do anything\r\n\t\t// if no selection rect yet, we wait for a selection rect to be loaded\r\n\t\tif (!rect || !$imageSelectionRect) return;\r\n\r\n\t\t// if image is static we only have to keep centering it\r\n\t\tif ($imageIsStatic) {\r\n\t\t\t// keep centering\r\n\t\t\tif (!$imageSelectionRectSnapshot) centerImageStaticBounds();\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// don't update image selection rect while we're intertacting with the view, this prevents feedback loop from cropRect model updates\r\n\t\tif ($isInteracting || $imageSelectionRectSnapshot || $imageCropRectIntent) return;\r\n\r\n\t\t// only if crop aspect ratio differs from image selection aspect ratio we update image selection rectangle\r\n\t\tconst imageSelectionRectAspectRatio = rectAspectRatio($imageSelectionRect);\r\n\r\n\t\tconst cropRectAspectRatio = rectAspectRatio(rect);\r\n\t\tif (fixPrecision(imageSelectionRectAspectRatio, 6) === fixPrecision(cropRectAspectRatio, 6)) return;\r\n\r\n\t\t// TEMP DUPLICATE OF STAGESCALAR DERIVED STORE TO FIX ZOOM OUT AFTER WHEEL ISSUE\r\n\t\t// reproduce -> crop view => resize selection rect vertically, tap recenter, zoom out with scroll wheel\r\n\t\tconst { width, height } = $imageStaticBounds || $imageCropRect;\r\n\r\n\t\tconst scalar = Math.min($stageRect.width / width, $stageRect.height / height);\r\n\t\tconst size = sizeCreate(rect.width * scalar, rect.height * scalar);\r\n\t\tconst tx = ($imageSelectionRect.width - size.width) * 0.5;\r\n\t\tconst ty = ($imageSelectionRect.height - size.height) * 0.5;\r\n\t\tconst selectionRect = rectCreate($imageSelectionRect.x + tx, $imageSelectionRect.y + ty, size.width, size.height);\r\n\t\timageSelectionRect.set(selectionRect);\r\n\t};\r\n\r\n\tconst imageCropRectUnsub = imageCropRect.subscribe(updateImageSelectionRect);\r\n\r\n\tconst imageScalar = derived([stageScalar, imageCropRect, imageSelectionRect, imageIsStatic], ([$stageScalar, $imageCropRect, $imageSelectionRect, $imageIsStatic], set) => {\r\n\t\t// update the image scalar, the image zoom calculated by the image selection and the actual crop coordinates\r\n\t\tif (!$stageScalar || !$imageCropRect || !$imageSelectionRect) return;\r\n\r\n\t\t// if image static bound set, the image is always centered in view\r\n\t\tif ($imageIsStatic) return set($imageSelectionRectStaticScalar);\r\n\r\n\t\tconst selectionScaledWidth = $imageSelectionRect.width / $imageCropRect.width;\r\n\t\tconst selectionScaledHeight = $imageSelectionRect.height / $imageCropRect.height;\r\n\t\tconst scalar = Math.max(selectionScaledWidth, selectionScaledHeight) / $stageScalar;\r\n\t\tset(scalar);\r\n\t});\r\n\r\n\tconst presentationScalar = derived([stageScalar, imageScalar], ([$stageScalar, $imageScalar], set) => {\r\n\t\t// can't scale presentation if no image scalar defined\r\n\t\tif (!$imageScalar) return;\r\n\r\n\t\tconst scalar = $stageScalar * $imageScalar;\r\n\t\tset(scalar);\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, presentationScalar, value => $$invalidate(401, $presentationScalar = value));\r\n\r\n\t//\r\n\t// UI Elements\r\n\t//\r\n\tlet prevFrameOutset = { left: 0, right: 0, top: 0, bottom: 0 };\r\n\r\n\tconst frameOutset = derived([imageFrame, imageSelectionRect], ([$imageFrame, $imageSelectionRect], set) => {\r\n\t\t// exit\r\n\t\tif (!$imageSelectionRect) return set(prevFrameOutset);\r\n\r\n\t\t// set frame padding\r\n\t\tconst newFrameOutset = getFrameOutset($imageSelectionRect, $imageFrame);\r\n\r\n\t\t// exit if no value changes\r\n\t\tif (fixPrecision(prevFrameOutset.top, 4) === fixPrecision(newFrameOutset.top, 4) && fixPrecision(prevFrameOutset.bottom, 4) === fixPrecision(newFrameOutset.bottom, 4) && fixPrecision(prevFrameOutset.right, 4) === fixPrecision(newFrameOutset.right, 4) && fixPrecision(prevFrameOutset.left, 4) === fixPrecision(newFrameOutset.left, 4)) return;\r\n\r\n\t\tprevFrameOutset = newFrameOutset;\r\n\t\tset(newFrameOutset);\r\n\t});\r\n\r\n\tconst frameHasOutset = derived([frameOutset], ([$frameOutset], set) => {\r\n\t\tset(Object.values($frameOutset).some(value => value > 0));\r\n\t});\r\n\r\n\tconst imageOutlineOpacity = spring(0.075, {\r\n\t\tstiffness: 0.03,\r\n\t\tdamping: 0.4,\r\n\t\tprecision: 0.001\r\n\t});\r\n\r\n\tconst imageOutline = derived(\r\n\t\t[\r\n\t\t\trootLineColor,\r\n\t\t\trootBackgroundColor,\r\n\t\t\timageOutlineOpacity,\r\n\t\t\timageSelectionRectPresentation,\r\n\t\t\timageSelectionScalar,\r\n\t\t\timageFrame,\r\n\t\t\tframeHasOutset,\r\n\t\t\tframeOutset,\r\n\t\t\tstagePadded\r\n\t\t],\r\n\t\t([\r\n\t\t\t\t$rootLineColor,\r\n\t\t\t\t$rootBackgroundColor,\r\n\t\t\t\t$colorOpacity,\r\n\t\t\t\t$rect,\r\n\t\t\t\t$rectScalar,\r\n\t\t\t\t$imageFrame,\r\n\t\t\t\t$frameHasOutset,\r\n\t\t\t\t$frameOutset,\r\n\t\t\t\t$stagePadded\r\n\t\t\t], set) => {\r\n\t\t\tif (!$rect || isOverlayModeEnabled) return set([]);\r\n\t\t\tlet { x, y, width, height } = $rect;\r\n\t\t\tx += 0.5;\r\n\t\t\ty += 0.5;\r\n\t\t\twidth -= 0.5;\r\n\t\t\theight -= 0.5;\r\n\t\t\tconst shapes = [];\r\n\r\n\t\t\tif ($imageFrame) {\r\n\t\t\t\t// draw dark or bright line around frame to make it stand out from background\r\n\t\t\t\tif ($frameHasOutset) {\r\n\t\t\t\t\tlet { left, right, top, bottom } = $frameOutset;\r\n\t\t\t\t\tleft *= $rectScalar;\r\n\t\t\t\t\tright *= $rectScalar;\r\n\t\t\t\t\ttop *= $rectScalar;\r\n\t\t\t\t\tbottom *= $rectScalar;\r\n\t\t\t\t\tconst isDarkBackground = isDarkColor($rootBackgroundColor);\r\n\t\t\t\t\tconst shadeColor = isDarkBackground ? [1, 1, 1, 0.125] : [0, 0, 0, 0.075];\r\n\r\n\t\t\t\t\tshapes.push({\r\n\t\t\t\t\t\tx: x - left - 0.5,\r\n\t\t\t\t\t\ty: y - top - 0.5,\r\n\t\t\t\t\t\twidth: width + left + right + 1,\r\n\t\t\t\t\t\theight: height + top + bottom + 1,\r\n\t\t\t\t\t\tstrokeWidth: 1,\r\n\t\t\t\t\t\tstrokeColor: shadeColor,\r\n\t\t\t\t\t\topacity: $stagePadded ? 1 : 0.5\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// draw extra shading around edge so crop controls are extra visible\r\n\t\t\t\tconst isDarkOutline = isDarkColor($rootLineColor);\r\n\r\n\t\t\t\tconst isDarkFrame = $imageFrame && $imageFrame.frameColor && isDarkColor($imageFrame.frameColor);\r\n\r\n\t\t\t\tif (!isDarkFrame && !isDarkOutline) {\r\n\t\t\t\t\tshapes.push({\r\n\t\t\t\t\t\tx: x - 1,\r\n\t\t\t\t\t\ty: y - 1,\r\n\t\t\t\t\t\twidth: width + 2,\r\n\t\t\t\t\t\theight: height + 2,\r\n\t\t\t\t\t\tstrokeWidth: 2,\r\n\t\t\t\t\t\tstrokeColor: [0, 0, 0, 0.1],\r\n\t\t\t\t\t\topacity: $colorOpacity\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tshapes.push({\r\n\t\t\t\t\t\tx: x + 1,\r\n\t\t\t\t\t\ty: y + 1,\r\n\t\t\t\t\t\twidth: width - 2,\r\n\t\t\t\t\t\theight: height - 2,\r\n\t\t\t\t\t\tstrokeWidth: 2,\r\n\t\t\t\t\t\tstrokeColor: [0, 0, 0, 0.1],\r\n\t\t\t\t\t\topacity: $colorOpacity\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tset([\r\n\t\t\t\t// added shapes\r\n\t\t\t\t...shapes,\r\n\t\t\t\t// default outline\r\n\t\t\t\t{\r\n\t\t\t\t\tx,\r\n\t\t\t\t\ty,\r\n\t\t\t\t\twidth,\r\n\t\t\t\t\theight,\r\n\t\t\t\t\tstrokeWidth: 1,\r\n\t\t\t\t\tstrokeColor: $rootLineColor,\r\n\t\t\t\t\topacity: $colorOpacity\r\n\t\t\t\t}\r\n\t\t\t]);\r\n\t\t}\r\n\t);\r\n\r\n\t// custom markup rendered on top of image\r\n\tconst imageOverlayMarkup = writable([]);\r\n\r\n\tcomponent_subscribe($$self, imageOverlayMarkup, value => $$invalidate(334, $imageOverlayMarkup = value));\r\n\r\n\t// the resulting overlay markup\r\n\tconst imageOverlay = derived([imageOutline, imageOverlayMarkup], ([$imageOutline, $imageOverlayMarkup], set) => {\r\n\t\tset([...$imageOutline, ...$imageOverlayMarkup]);\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, imageOverlay, value => $$invalidate(83, $imageOverlay = value));\r\n\r\n\t//\r\n\t// Stage overlay\r\n\t//\r\n\tconst overlayOpacity = spring(0, { precision: 0.001 });\r\n\r\n\tcomponent_subscribe($$self, overlayOpacity, value => $$invalidate(336, $overlayOpacity = value));\r\n\tconst overlayLeftRect = spring();\r\n\tcomponent_subscribe($$self, overlayLeftRect, value => $$invalidate(339, $overlayLeftRect = value));\r\n\tconst overlayTopRect = spring();\r\n\tcomponent_subscribe($$self, overlayTopRect, value => $$invalidate(338, $overlayTopRect = value));\r\n\tconst overlayRightRect = spring();\r\n\tcomponent_subscribe($$self, overlayRightRect, value => $$invalidate(337, $overlayRightRect = value));\r\n\tconst overlayBottomRect = spring();\r\n\tcomponent_subscribe($$self, overlayBottomRect, value => $$invalidate(335, $overlayBottomRect = value));\r\n\r\n\t//\r\n\t// Loading the preview\r\n\t//\r\n\tconst imageVisualLoadComplete = writable(false);\r\n\r\n\tcomponent_subscribe($$self, imageVisualLoadComplete, value => $$invalidate(320, $imageVisualLoadComplete = value));\r\n\tconst imagePreviewSource = writable();\r\n\tcomponent_subscribe($$self, imagePreviewSource, value => $$invalidate(323, $imagePreviewSource = value));\r\n\tlet imagePreviewLoaderCancelToken;\r\n\r\n\tconst imagePreview = derived([imageVisualLoadComplete, imagePreviewSource], ([$imageVisualLoadComplete, $imagePreviewSource], set) => {\r\n\t\t// no data, reset preview data\r\n\t\tif (!$imageVisualLoadComplete || !$imagePreviewSource) {\r\n\t\t\tset(undefined);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// cancel existing loader\r\n\t\tif (imagePreviewLoaderCancelToken) {\r\n\t\t\timagePreviewLoaderCancelToken.cancel();\r\n\t\t\t$$invalidate(239, imagePreviewLoaderCancelToken = undefined);\r\n\t\t}\r\n\r\n\t\t// if image preview source is a canvas we can update immediately\r\n\t\tif (isCanvas($imagePreviewSource)) {\r\n\t\t\t// update image preview to canvas\r\n\t\t\treturn set(canvasClone($imagePreviewSource));\r\n\t\t}\r\n\r\n\t\t// try not to show preview loader if updating active images array\r\n\t\tconst minPreviewLoaderDuration = activeImages.length ? 0 : $isAnimated ? 250 : 0;\r\n\r\n\t\t// load preview\r\n\t\t$$invalidate(239, imagePreviewLoaderCancelToken = { cancel: noop$1 });\r\n\r\n\t\tcreateImageSrcLoader($imagePreviewSource, imagePreviewLoaderCancelToken, minPreviewLoaderDuration).then(set).catch(err => {\r\n\t\t\t// update load state\r\n\t\t\tset_store_value(imageLoadState, $imageLoadState.error = err, $imageLoadState);\r\n\r\n\t\t\t// log to console for debugging purposes\r\n\t\t}).finally(() => {\r\n\t\t\t// no longer loading\r\n\t\t\t$$invalidate(239, imagePreviewLoaderCancelToken = undefined);\r\n\t\t});\r\n\t});\r\n\r\n\t$$subscribe_imagePreview();\r\n\tlet { imagePreviewCurrent = undefined } = $$props;\r\n\r\n\t//\r\n\t// Calculates the image transforms and effects necessary for the preview\r\n\t//\r\n\tconst imagePreviewModifiers = writable({});\r\n\r\n\tcomponent_subscribe($$self, imagePreviewModifiers, value => $$invalidate(325, $imagePreviewModifiers = value));\r\n\tconst interfaceImages = writable([]);\r\n\tcomponent_subscribe($$self, interfaceImages, value => $$invalidate(81, $interfaceImages = value));\r\n\r\n\t// reset image UI previews when new file is loaded\r\n\tconst resetPreviews = () => {\r\n\t\timageSelectionPan.set(vectorCreateEmpty());\r\n\t\timageSelectionZoom.set(undefined);\r\n\t\timageSelectionStoredStateReset();\r\n\t\tinterfaceImages.set([]);\r\n\t};\r\n\r\n\tconst imageTransforms = derived(\r\n\t\t[\r\n\t\t\tstageRect,\r\n\t\t\trootRect,\r\n\t\t\timageSize,\r\n\t\t\timageCropRectPresentation,\r\n\t\t\timageSelectionRect,\r\n\t\t\tpresentationScalar,\r\n\t\t\timageRotation,\r\n\t\t\timageFlipX,\r\n\t\t\timageFlipY,\r\n\t\t\timageSelectionScalar,\r\n\t\t\timageSelectionPan,\r\n\t\t\tisTransformingImage\r\n\t\t],\r\n\t\t([\r\n\t\t\t\t$stageRect,\r\n\t\t\t\t$rootRect,\r\n\t\t\t\t$imageSize,\r\n\t\t\t\t$imageCropRectPresentation,\r\n\t\t\t\t$imageSelectionRect,\r\n\t\t\t\t$presentationScalar,\r\n\t\t\t\t$imageRotation,\r\n\t\t\t\t$imageFlipX,\r\n\t\t\t\t$imageFlipY,\r\n\t\t\t\t$imageSelectionScalar,\r\n\t\t\t\t$imageSelectionPan,\r\n\t\t\t\t$isTransformingImage\r\n\t\t\t], set) => {\r\n\t\t\tif (!$stageRect || !$imageSelectionRect) return;\r\n\t\t\tconst imageTransforms = calculateImageTransforms($stageRect, $rootRect, $imageSize, $imageCropRectPresentation, $imageSelectionRect, $imageSelectionScalar, $imageSelectionPan, $presentationScalar, $imageRotation, $imageFlipX, $imageFlipY);\r\n\t\t\t!$isTransformingImage && imageTransformsSnapPixels(imageTransforms);\r\n\t\t\tset(imageTransforms);\r\n\t\t}\r\n\t);\r\n\r\n\tcomponent_subscribe($$self, imageTransforms, value => $$invalidate(326, $imageTransforms = value));\r\n\r\n\tconst imageEffects = derived(\r\n\t\t[\r\n\t\t\timageColorMatrix,\r\n\t\t\timageConvolutionMatrix,\r\n\t\t\timageGamma,\r\n\t\t\timageVignette,\r\n\t\t\timageNoise\r\n\t\t],\r\n\t\t([$colorMatrix, $convolutionMatrix, $gamma, $vignette, $noise], set) => {\r\n\t\t\tconst colorMatrices = $colorMatrix && Object.keys($colorMatrix).map(name => $colorMatrix[name]).filter(Boolean);\r\n\r\n\t\t\tconst effects = {\r\n\t\t\t\tgamma: $gamma || undefined,\r\n\t\t\t\tvignette: $vignette || undefined,\r\n\t\t\t\tnoise: $noise || undefined,\r\n\t\t\t\tconvolutionMatrix: $convolutionMatrix || undefined,\r\n\t\t\t\tcolorMatrix: colorMatrices && colorMatrices.length && getColorMatrixFromColorMatrices(colorMatrices)\r\n\t\t\t};\r\n\r\n\t\t\tset(effects);\r\n\t\t}\r\n\t);\r\n\r\n\t//\r\n\t// current environment variables\r\n\t//\r\n\tlet windowWidth;\r\n\r\n\tlet windowHeight;\r\n\tconst shouldPreventSwipe = canPreventNavSwipe();\r\n\tconst env = writable({});\r\n\tcomponent_subscribe($$self, env, value => $$invalidate(314, $env = value));\r\n\tconst initialPixelRatio = getDevicePixelRatio();\r\n\r\n\tconst pixelRatio = readable(initialPixelRatio, set => {\r\n\t\tconst handleResolutionChange = () => set(getDevicePixelRatio());\r\n\t\tconst resolutionObserver = matchMedia(`(resolution: ${initialPixelRatio}dppx)`);\r\n\t\tresolutionObserver.addListener(handleResolutionChange);\r\n\t\treturn () => resolutionObserver.removeListener(handleResolutionChange);\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, pixelRatio, value => $$invalidate(54, $pixelRatio = value));\r\n\r\n\tconst history = historyCreate(\r\n\t\t() => {\r\n\t\t\t// $imageState is always a clone of the current state\r\n\t\t\treturn $imageState;\r\n\t\t},\r\n\t\tstate => {\r\n\t\t\t// set new state from history, $imageState will store a clone of the received state\r\n\t\t\tset_store_value(imageState, $imageState = state, $imageState);\r\n\r\n\t\t\t// trigger recenter of image selection rect\r\n\t\t\ttabRect.set($tabRect);\r\n\t\t}\r\n\t);\r\n\r\n\t$$subscribe_history();\r\n\r\n\tconst setInitialHistoryState = () => {\r\n\t\t// set history state\r\n\t\tconst baseRect = { x: 0, y: 0, ...$imageSize };\r\n\r\n\t\tconst baseCropRect = rectApply(rectContainRect(baseRect, $imageState.cropAspectRatio), Math.round);\r\n\r\n\t\t// note:\r\n\t\t//\r\n\t\t// currently undo doesn't step back to base state,\r\n\t\t// that's why the hook willSetHistoryInitialState below as introduced\r\n\t\t// will be fixed in version next major release of the editor\r\n\t\t//\r\n\t\tconst baseEditorState = willSetHistoryInitialState(\r\n\t\t\t{\r\n\t\t\t\t// the base state is the image state but the `rotation` and `crop` are reset\r\n\t\t\t\t...$imageState, //\r\n\t\t\t\t// should be read from imageInitialProps?\r\n\t\t\t\trotation: 0,\r\n\t\t\t\tcrop: baseCropRect\r\n\t\t\t},\r\n\t\t\t// add other reset values here?\r\n\t\t\t//\r\n\t\t\t// see note above\r\n\t\t\t$imageState\r\n\t\t); //\r\n\r\n\t\t// this will be the base state\r\n\t\tconst editorInitialHistoryState = [baseEditorState];\r\n\r\n\t\t// only add additional entry if base state and current state are different\r\n\t\tif (JSON.stringify(baseEditorState) !== JSON.stringify($imageState)) {\r\n\t\t\teditorInitialHistoryState.push({ ...$imageState });\r\n\t\t}\r\n\r\n\t\t// loading done, set this as base state\r\n\t\thistory.set(editorInitialHistoryState);\r\n\t};\r\n\r\n\tconst imageLoadStateUnsub = imageLoadState.subscribe(state => {\r\n\t\t// no state yet\r\n\t\tif (!state) return;\r\n\r\n\t\t// not ready yet\r\n\t\tif (!state.complete) return;\r\n\r\n\t\t// set initial state after image load has completed\r\n\t\tsetInitialHistoryState();\r\n\t});\r\n\r\n\tconst revert = () => willRevert().then(shouldReset => shouldReset && history.revert());\r\n\r\n\t//\r\n\t// Visual processing of the image\r\n\t//\r\n\tconst imageProcessingPreparing = writable(false);\r\n\r\n\tcomponent_subscribe($$self, imageProcessingPreparing, value => $$invalidate(315, $imageProcessingPreparing = value));\r\n\r\n\tconst handleExport = () => {\r\n\t\twindow.start = Date.now();\r\n\r\n\t\t// this will trigger status overlay fade in\r\n\t\tset_store_value(imageProcessingPreparing, $imageProcessingPreparing = true, $imageProcessingPreparing);\r\n\r\n\t\twillProcessImage().then(shouldProcess => {\r\n\t\t\t// nope, restore hide processing overlay and back to editing\r\n\t\t\tif (!shouldProcess) {\r\n\t\t\t\tset_store_value(imageProcessingPreparing, $imageProcessingPreparing = false, $imageProcessingPreparing);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// wait for status to be done fading in, then requests image writing\r\n\t\t\tlet unsub;\r\n\r\n\t\t\tunsub = statusOpacity.subscribe(value => {\r\n\t\t\t\tif (value !== 1) return;\r\n\r\n\t\t\t\t// stop listening for\r\n\t\t\t\tunsub && unsub();\r\n\r\n\t\t\t\t// request write image\r\n\t\t\t\tdispatch('processImage');\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\tconst imageProcessStateUnsub = imageProcessState.subscribe(state => {\r\n\t\tif (!state) return;\r\n\t\tset_store_value(imageProcessingPreparing, $imageProcessingPreparing = true, $imageProcessingPreparing);\r\n\t\tconst { complete, abort } = state;\r\n\t\tif (complete || abort) set_store_value(imageProcessingPreparing, $imageProcessingPreparing = false, $imageProcessingPreparing);\r\n\t});\r\n\r\n\tconst activeImages = storeList();\r\n\tcomponent_subscribe($$self, activeImages, value => $$invalidate(52, $activeImages = value));\r\n\r\n\tconst imageTransformsInterpolated = derived([activeImages], ([$activeImages], set) => {\r\n\t\tif (!$activeImages.length) return set();\r\n\t\tconst { origin, translation, rotation, scale } = $activeImages[0];\r\n\t\tset({ origin, translation, rotation, scale });\r\n\t});\r\n\r\n\tconst utilTools = writable();\r\n\tcomponent_subscribe($$self, utilTools, value => $$invalidate(329, $utilTools = value));\r\n\r\n\t// bind from pan/zoom control\r\n\tlet zoomControls = [];\r\n\r\n\t// bind from pan/zoom control\r\n\tlet zoomMultiTouching;\r\n\r\n\tconst imageSelectionMultiTouching = writable();\r\n\tconst imagePreviewUpscale = writable();\r\n\r\n\tconst imageSelectionZoomCurrent = derived(\r\n\t\t[\r\n\t\t\timageSelectionZoom,\r\n\t\t\timagePreviewUpscale,\r\n\t\t\tstageScalar,\r\n\t\t\timageSelectionStageFitScalar\r\n\t\t],\r\n\t\t([\r\n\t\t\t\t$imageSelectionZoom,\r\n\t\t\t\t$imagePreviewUpscale,\r\n\t\t\t\t$stageScalar,\r\n\t\t\t\t$imageSelectionStageFitScalar\r\n\t\t\t]) => {\r\n\t\t\treturn $imageSelectionZoom\r\n\t\t\t? $imageSelectionZoom\r\n\t\t\t: $imagePreviewUpscale || $stageScalar < 1\r\n\t\t\t\t? $imageSelectionStageFitScalar\r\n\t\t\t\t: 1;\r\n\t\t}\r\n\t);\r\n\r\n\t//\r\n\t// Configure the available views\r\n\t//\r\n\tconst utilStores = {\r\n\t\t// model stores\r\n\t\t...stores,\r\n\t\t// image\r\n\t\timageFile,\r\n\t\timageSize,\r\n\t\t// video / animated gif\r\n\t\tmediaDuration,\r\n\t\tmediaTrim,\r\n\t\timageBackgroundColor,\r\n\t\timageCropAspectRatio,\r\n\t\timageCropMinSize,\r\n\t\timageCropMaxSize,\r\n\t\timageCropLimitToImage,\r\n\t\timageCropRect,\r\n\t\timageCropRectOrigin,\r\n\t\timageCropRectSnapshot,\r\n\t\timageCropRectAspectRatio,\r\n\t\timageCropRange,\r\n\t\timageRotation,\r\n\t\timageRotationRange,\r\n\t\timageFlipX,\r\n\t\timageFlipY,\r\n\t\timageOutputSize,\r\n\t\t// effects\r\n\t\timageColorMatrix,\r\n\t\timageConvolutionMatrix,\r\n\t\timageGamma,\r\n\t\timageVignette,\r\n\t\timageNoise,\r\n\t\t// markup\r\n\t\timageDecoration,\r\n\t\timageAnnotation,\r\n\t\timageRedaction,\r\n\t\timageFrame,\r\n\t\t// image preview for utils that need access to pixel data\r\n\t\timagePreview,\r\n\t\t// image preview source so utils can update preview\r\n\t\timagePreviewSource,\r\n\t\t// top left position of image preview\r\n\t\timageTransforms,\r\n\t\t// allows utils to control how the preview is presented (for example more opacity for mask)\r\n\t\timagePreviewModifiers,\r\n\t\t// history state and update\r\n\t\thistory,\r\n\t\t// static env info\r\n\t\tanimation: shouldAnimate,\r\n\t\tpixelRatio,\r\n\t\telasticityMultiplier,\r\n\t\tscrollElasticity,\r\n\t\trangeInputElasticity,\r\n\t\tredrawTrigger,\r\n\t\t// dynamic env info\r\n\t\tpointerAccuracy,\r\n\t\tpointerHoverable,\r\n\t\tenv,\r\n\t\trootRect,\r\n\t\tstageRect,\r\n\t\tstageRectBase,\r\n\t\tstageRecenter,\r\n\t\tstageScalar,\r\n\t\tstagePadding,\r\n\t\tstagePadded,\r\n\t\tpresentationScalar,\r\n\t\timagePreviewUpscale,\r\n\t\tutilRect,\r\n\t\tutilRectPadded,\r\n\t\tallowPan,\r\n\t\tallowZoom,\r\n\t\tenableZoomInput: enableZoomInputStore,\r\n\t\tenableZoomControls: enableZoomControlsProp,\r\n\t\tenablePanInput: enablePanInputStore,\r\n\t\tenablePanInputStatus,\r\n\t\timageSelectionMultiTouching,\r\n\t\trootBackgroundColor,\r\n\t\trootForegroundColor,\r\n\t\trootLineColor,\r\n\t\trootColorSecondary,\r\n\t\timageOutlineOpacity,\r\n\t\t// add tools to interface\r\n\t\tutilTools,\r\n\t\t// interaction\r\n\t\timageSelectionPan,\r\n\t\timageSelectionZoom,\r\n\t\timageSelectionZoomCurrent,\r\n\t\timageSelectionStageFitScalar,\r\n\t\timageSelectionStoredState,\r\n\t\t// (write) add guides to ui (for example is used by markup util to add lines for shape manipulator)\r\n\t\timageOverlayMarkup,\r\n\t\t// (write) interface images to render\r\n\t\tinterfaceImages,\r\n\t\t// (write) set to true to disable animations\r\n\t\tisInteracting,\r\n\t\t// (write) set to true when transforming image (move, translate, scale, rotate)\r\n\t\tisTransformingImage,\r\n\t\t// (read) goes from 0 to 1 while interacting\r\n\t\tisInteractingFraction,\r\n\t\t// (write) the current intended crop rect\r\n\t\timageCropRectIntent,\r\n\t\t// (read) the current presented crop rect\r\n\t\timageCropRectPresentation,\r\n\t\t// (write) the current limited size of the image selection rect\r\n\t\timageSelectionRect,\r\n\t\t// (write) the inteded rectangle by the user\r\n\t\timageSelectionRectIntent,\r\n\t\t// (read) the current presentation of the image selection rect, includes elasticity etc.\r\n\t\timageSelectionRectPresentation,\r\n\t\t// (read) a snapshot of the image selection rectangle, use to store the rectangle before modification so alterations to the rectangle can be applied to the snapshot\r\n\t\timageSelectionRectSnapshot,\r\n\t\t// scalar of image in view\r\n\t\timageScalar,\r\n\t\t// current image interpolated state\r\n\t\timageTransformsInterpolated,\r\n\t\t// effects applied to the image\r\n\t\timageEffects\r\n\t};\r\n\r\n\t// don't expose image store\r\n\tdelete utilStores.image;\r\n\r\n\tconst utilsUniqueId = `util-${getUniqueId()}`;\r\n\tlet utilsVisible = [];\r\n\r\n\t// env\r\n\tlet iOS = isIOS();\r\n\r\n\tconst getOrientation = (rect, layoutPreference) => {\r\n\t\tif (!$rootRect) return 'landscape';\r\n\t\tif (layoutPreference === 'auto') return rect.width > rect.height ? 'landscape' : 'portrait';\r\n\t\tif (layoutPreference === 'horizontal') return rect.width < 500 ? 'portrait' : 'landscape';\r\n\t\tif (layoutPreference === 'vertical') return rect.height < 400 ? 'landscape' : 'portrait';\r\n\t};\r\n\r\n\tconst getColorPropertyValue = name => {\r\n\t\tconst colorString = rootElementComputedStyle.getPropertyValue(name);\r\n\t\treturn colorStringToColorArray(colorString);\r\n\t};\r\n\r\n\tconst syncColor = (property, store) => {\r\n\t\tconst colorArray = getColorPropertyValue(property);\r\n\r\n\t\t// hide transparent color\r\n\t\tif (!colorArray || colorArray[3] === 0) return;\r\n\r\n\t\t// limit to opaque colors\r\n\t\tcolorArray.length = 3;\r\n\r\n\t\t// update store\r\n\t\tstore.set(colorArray, { hard: !$isAnimated });\r\n\t};\r\n\r\n\tconst syncColors = () => {\r\n\t\tsyncColor('color', rootForegroundColor);\r\n\r\n\t\tenableCanvasAlpha\r\n\t\t? syncColor('--color-background', rootBackgroundColor)\r\n\t\t: syncColor('background-color', rootBackgroundColor);\r\n\r\n\t\tsyncColor('outline-color', rootLineColor);\r\n\t\tsyncColor('--color-secondary', rootColorSecondary);\r\n\t};\r\n\r\n\tconst handleTransitionEnd = ({ target, propertyName }) => {\r\n\t\tif (target !== root || !(/background|outline/).test(propertyName)) return;\r\n\t\tif (rootElementComputedStyle) syncColors();\r\n\t};\r\n\r\n\tconst imageProps = derived([imageTransforms, imageEffects, imageBackgroundColor, imageBackgroundImageData], ([$imageTransforms, $imageEffects, backgroundColor, backgroundImageData]) => {\r\n\t\treturn $imageTransforms && {\r\n\t\t\t...$imageTransforms,\r\n\t\t\t...$imageEffects,\r\n\t\t\tbackgroundColor,\r\n\t\t\tbackgroundImage: backgroundImageData\r\n\t\t};\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, imageProps, value => $$invalidate(324, $imageProps = value));\r\n\r\n\tconst addImagePreview = () => {\r\n\t\t// if is first image scale up slightly on entrance\r\n\t\tconst imageIntro = activeImages.length ? undefined : { resize: 1.05 };\r\n\r\n\t\t// create the new image\r\n\t\tconst image = createImage($imagePreview, $imageSize, imageIntro);\r\n\r\n\t\t// new image on top\r\n\t\tactiveImages.unshift(image);\r\n\r\n\t\t// update images in activeImages array\r\n\t\tupdateImagePreviews($imageProps);\r\n\t};\r\n\r\n\tconst updateImagePreviews = currentImageProps => {\r\n\t\tactiveImages.forEach((image, index) => {\r\n\t\t\tconst opacity = index === 0 ? 1 : 0;\r\n\t\t\tconst resize = 1;\r\n\t\t\timage.set({ ...currentImageProps, opacity, resize }, $shouldAnimate);\r\n\t\t});\r\n\t};\r\n\r\n\t// if image preview changes, push it on the stack\r\n\tlet lastImagePreview;\r\n\r\n\tconst statusOpacity = tweened(undefined, { duration: 500 });\r\n\tcomponent_subscribe($$self, statusOpacity, value => $$invalidate(51, $statusOpacity = value));\r\n\tlet loadTimer;\r\n\r\n\t// this adds a little delay to the status fade out after an image was processed\r\n\t// needed because when the modal fades out this would otherwise create a weird flash (modal fade out, but status fade out as well showing interface)\r\n\tconst wasProcessingImage = writable(false);\r\n\r\n\tcomponent_subscribe($$self, wasProcessingImage, value => $$invalidate(319, $wasProcessingImage = value));\r\n\tlet statusState;\r\n\r\n\tconst asideOffset = spring(undefined, {\r\n\t\tstiffness: 0.1,\r\n\t\tdamping: 0.7,\r\n\t\tprecision: 0.25\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, asideOffset, value => $$invalidate(77, $asideOffset = value));\r\n\tconst asideOpacity = spring(0, { stiffness: 0.1, precision: 0.05 });\r\n\tcomponent_subscribe($$self, asideOpacity, value => $$invalidate(78, $asideOpacity = value));\r\n\r\n\tconst asideWidth = spring(0, {\r\n\t\tstiffness: 0.02,\r\n\t\tdamping: 0.5,\r\n\t\tprecision: 0.25\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, asideWidth, value => $$invalidate(317, $asideWidth = value));\r\n\r\n\tconst statusWidth = spring(undefined, {\r\n\t\tstiffness: 0.02,\r\n\t\tdamping: 0.5,\r\n\t\tprecision: 0.25\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, statusWidth, value => $$invalidate(318, $statusWidth = value));\r\n\r\n\tconst statusOffset = spring(undefined, {\r\n\t\tstiffness: 0.02,\r\n\t\tdamping: 0.5,\r\n\t\tprecision: 0.25\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, statusOffset, value => $$invalidate(316, $statusOffset = value));\r\n\tlet asideWidthUpdateTimer;\r\n\r\n\tconst offsetAside = e => {\r\n\t\t// if error occured, or not animating, snap in possition\r\n\t\tconst hard = !!(statusState && statusState.closeButton) || !$isAnimated;\r\n\r\n\t\t// where to render the progress indicator or close button\r\n\t\tstatusWidth.set(e.detail.width, { hard });\r\n\r\n\t\t// offsets text so it's better centered to the viewport\r\n\t\tstatusOffset.set(Math.round(-e.detail.width * 0.5), { hard });\r\n\t};\r\n\r\n\tconst handleCloseImageLoadError = () => {\r\n\t\tdispatch('abortLoadImage');\r\n\t};\r\n\r\n\tconst handleCloseImageProcessError = () => {\r\n\t\tdispatch('abortProcessImage');\r\n\t\tset_store_value(imageProcessingPreparing, $imageProcessingPreparing = false, $imageProcessingPreparing);\r\n\t};\r\n\r\n\t// helper to block iOS and Firefox Android events so don't toggle nav\r\n\tconst preventDefault = e => e.preventDefault();\r\n\r\n\t// prevents swipe to navigate back on iOS >= 13.4+\r\n\tconst handleTouchStart = shouldPreventSwipe\r\n\t? e => {\r\n\t\t\t// get touch or event itself (fixes issue with chrome dev tools)\r\n\t\t\tconst event = e.touches ? e.touches[0] : e;\r\n\r\n\t\t\t// if is not an attempt to swipe back or forward\r\n\t\t\tif (event.pageX > 20 && event.pageX < window.innerWidth - 20) return;\r\n\r\n\t\t\t// stop the navigation attempt\r\n\t\t\tpreventDefault(e);\r\n\t\t}\r\n\t: noop$1;\r\n\r\n\t// context for children to know if a key is down\r\n\tconst pressedKeysStore = writable([]);\r\n\r\n\tcomponent_subscribe($$self, pressedKeysStore, value => $$invalidate(392, $pressedKeysStore = value));\r\n\tsetContext('keysPressed', pressedKeysStore);\r\n\r\n\tconst handleKeydown = e => {\r\n\t\tconst { keyCode, metaKey, ctrlKey, shiftKey } = e;\r\n\r\n\t\t// prevent tabbing through fields if editor is disabled\r\n\t\tif (keyCode === 9 && disabled) {\r\n\t\t\te.preventDefault();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// prevent spacebar from scrolling page\r\n\t\tif (e.target && keyCode === 32 && root.contains(e.target) && !isTextField(e.target)) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\r\n\t\t// undo/redo\r\n\t\tif (keyCode === 90 && (metaKey || ctrlKey)) {\r\n\t\t\tif (shiftKey && metaKey) {\r\n\t\t\t\t// redo on MacOS\r\n\t\t\t\thistory.redo();\r\n\t\t\t} else {\r\n\t\t\t\t// undo\r\n\t\t\t\thistory.undo();\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\t\t} else if (keyCode === 89 && ctrlKey) {\r\n\t\t\t// redo on Windows\r\n\t\t\thistory.redo();\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// ignore IME popup keycode, fixes keycode 229 sticking around, as it's not triggered in keyup \"If an Input Method Editor is processing key input and the event is keydown, return 229.\"\r\n\t\t// https://lists.w3.org/Archives/Public/www-dom/2010JulSep/att-0182/keyCode-spec.html\r\n\t\tif (keyCode === 229) return;\r\n\r\n\t\tif (metaKey || ctrlKey) return;\r\n\r\n\t\t// add to set\r\n\t\tconst keySet = new Set([...$pressedKeysStore, keyCode]);\r\n\r\n\t\tpressedKeysStore.set(Array.from(keySet));\r\n\t};\r\n\r\n\tconst handleKeyup = ({ key, keyCode }) => {\r\n\t\t// this prevents holding the command key while panning image from resutling in sticky keys\r\n\t\tif (key === 'Meta') return pressedKeysStore.set([]);\r\n\r\n\t\tpressedKeysStore.set($pressedKeysStore.filter(pressedKey => pressedKey !== keyCode));\r\n\t};\r\n\r\n\t// so no keys get stuck when user cmd-tabs out of the window, or when dev-tools open by key-press\r\n\tconst handleWindowBlur = () => {\r\n\t\tpressedKeysStore.set([]);\r\n\t};\r\n\r\n\t// block context menu on everything but text input fields\r\n\tconst handleContextMenu = e => {\r\n\t\tif (isTextField(e.target)) return;\r\n\t\te.preventDefault();\r\n\t};\r\n\r\n\t// handle files being dropped on the editor\r\n\tconst handleUserFile = file => {\r\n\t\t// no file received, isn't an image file, is not a URL\r\n\t\tif (// no file received\r\n\t\t!file || // if it's a file object it should be a bitmap\r\n\t\tisBinary(file) && !isBitmap(file) || // if it's not a file object it should be a URL\r\n\t\t!isBinary(file) && !(/^http/).test(file)) return;\r\n\r\n\t\t// request load image\r\n\t\tdispatch('loadImage', file);\r\n\t};\r\n\r\n\tconst handleDropFiles = e => {\r\n\t\t// not allowed to drop\r\n\t\tif (!enableDropImage) return;\r\n\r\n\t\thandleUserFile(e.detail.resources[0]);\r\n\t};\r\n\r\n\tconst handleSelectFile = file => {\r\n\t\tif (!file) return;\r\n\t\thandleUserFile(file);\r\n\t};\r\n\r\n\tconst browseFileSystem = () => {\r\n\t\tif (!enableBrowseImage) return;\r\n\t\tbrowse().then(handleSelectFile);\r\n\t};\r\n\r\n\tconst handlePaste = e => {\r\n\t\t// not allowed to paste\r\n\t\tif (!enablePasteImage) return;\r\n\r\n\t\t// calculate percentage of editor that is in view\r\n\t\tconst xPercentage = clamp((window.innerWidth - Math.abs($rootRect.x)) / $rootRect.width, 0, 1);\r\n\r\n\t\tconst yPercentage = clamp((window.innerHeight - Math.abs($rootRect.y)) / $rootRect.height, 0, 1);\r\n\r\n\t\t// editor needs to be in view\r\n\t\tif (xPercentage < 0.75 && yPercentage < 0.75) return;\r\n\r\n\t\t// request load image\r\n\t\thandleUserFile((e.clipboardData || window.clipboardData).files[0]);\r\n\t};\r\n\r\n\t//\r\n\t// canvas drawing\r\n\t//\r\n\tlet scrambledPreviewImage = undefined;\r\n\r\n\tconst updateScrambledPreview = (imagePreviewData, imageScrambler, imageRedactionScalar, imageBackgroundColor) => {\r\n\t\tif (!imageScrambler) return;\r\n\r\n\t\t// remove transparency\r\n\t\tconst editorOptions = { dataSizeScalar: imageRedactionScalar };\r\n\r\n\t\tif (imageBackgroundColor && imageBackgroundColor[3] > 0) {\r\n\t\t\teditorOptions.backgroundColor = [...imageBackgroundColor];\r\n\t\t}\r\n\r\n\t\timageScrambler(imagePreviewData, editorOptions).then(scrambledCanvas => {\r\n\t\t\t// we've created a new scrambled preview so force release memory of old one\r\n\t\t\tif (scrambledPreviewImage) releaseCanvas(scrambledPreviewImage);\r\n\r\n\t\t\t// update scrambled preview with new image\r\n\t\t\t$$invalidate(243, scrambledPreviewImage = scrambledCanvas);\r\n\t\t});\r\n\t};\r\n\r\n\tlet blendShapes = [];\r\n\r\n\t// setup root portal for detail panel dropdown\r\n\tlet rootPortal;\r\n\r\n\tconst rootPortalStore = writable();\r\n\tsetContext('rootPortal', rootPortalStore);\r\n\r\n\t// setup root rect store for global access\r\n\tsetContext('rootRect', rootRect);\r\n\r\n\tconst getStageState = () => ({\r\n\t\t// add foreground color\r\n\t\tforegroundColor: [...$rootForegroundColor],\r\n\t\t// add line color\r\n\t\tlineColor: [...$rootLineColor],\r\n\t\t// add information on which util is active\r\n\t\tutilVisibility: { ...utilsVisibleFraction },\r\n\t\t// used to fade in elements when interacting\r\n\t\tisInteracting: $isInteracting,\r\n\t\tisInteractingFraction: $isInteractingFraction,\r\n\t\t// add the root rectangle so will render can use width/height of root element\r\n\t\trootRect: rectClone$1($rootRect),\r\n\t\t// add the stage rectangle so will render knows where stage starts and ends\r\n\t\tstageRect: rectClone$1($stageRect),\r\n\t\t// allows overriding dirty state\r\n\t\tannotationShapesDirty: imageAnnotationShapesDirty,\r\n\t\tdecorationShapesDirty: imageDecorationShapesDirty,\r\n\t\tframeShapesDirty: imageFrameShapesDirty,\r\n\t\tblendShapesDirty: imageBlendShapesDirty\r\n\t});\r\n\r\n\t// test if some shapes have left/top/bottom/right offsets, if so, convert to crop space\r\n\t// updates original shape (which at this point is a flattened shape (clone))\r\n\tconst positionDecorationShape = (shape, selectionRect, scale) => {\r\n\t\t// need to calculate intermediate sizes so relative shapes are animated when the interface updates\r\n\t\t// this calculation should result in a \"springed\" $imageCropRect\r\n\t\treturn shapeComputeDisplay(shape, sizeCreate(selectionRect.width / scale, selectionRect.height / scale));\r\n\t};\r\n\r\n\t// decoration is drawn relative to view space, so we need to translate relative to crop presentation rect\r\n\tconst transformDecorationShape = (shape, selectionRect, scale) => {\r\n\t\tshape._translate = vectorCreateFromAny(selectionRect);\r\n\t\tshape._scale = scale;\r\n\t\treturn shape;\r\n\t};\r\n\r\n\tconst flattenShapes = shapes => {\r\n\t\tconst flattenedShapes = [];\r\n\t\tshapes.forEach(shape => flattenedShapes.push(flattenShape(shape)));\r\n\t\treturn flattenedShapes.filter(Boolean);\r\n\t};\r\n\r\n\tconst flattenShape = shape => {\r\n\t\t// at this point shape is a copy of the original shape\r\n\t\tif (shapeIsLine(shape)) {\r\n\t\t\tshape.points = [vectorCreate(shape.x1, shape.y1), vectorCreate(shape.x2, shape.y2)];\r\n\t\t\treturn shape;\r\n\t\t}\r\n\r\n\t\t// is empty text\r\n\t\tif (shapeIsTextEmpty(shape) && (!shape.backgroundColor || shape.backgroundColor[3] === 0)) {\r\n\t\t\t// make sure shape is still visible\r\n\t\t\tif (shapeIsTextBlock(shape)) {\r\n\t\t\t\tshape.width = 5;\r\n\t\t\t\tshape.height = shape.lineHeight;\r\n\t\t\t}\r\n\r\n\t\t\t// set to empty text style\r\n\t\t\tshape.strokeWidth = 1;\r\n\r\n\t\t\tshape.strokeColor = [1, 1, 1, 0.5];\r\n\t\t\tshape.backgroundColor = [0, 0, 0, 0.1];\r\n\t\t\treturn shape;\r\n\t\t}\r\n\r\n\t\treturn shape;\r\n\t};\r\n\r\n\t// these hold computes shapes, so we don't have to compute on each frame if no changes\r\n\tlet canvasComputedAnnotationBaseShapes = [];\r\n\r\n\tlet canvasComputedAnnotationShapes = [];\r\n\tlet canvasComputedBlendShapes = [];\r\n\tlet canvasComputedDecorationShapes = [];\r\n\tlet canvasComputedFrameShapes = [];\r\n\tlet canvasComputedScale;\r\n\tlet canvasComputedSelectionRect = {};\r\n\r\n\tconst createCanvasState = (canvasState, blendShapesToDraw, annotationShapesToDraw, decorationShapesToDraw, interfaceShapesToDraw, frameShapesToDraw) => {\r\n\t\tconst { annotationShapesDirty, decorationShapesDirty, frameShapesDirty, blendShapesDirty, selectionRect, scale } = canvasState;\r\n\r\n\t\t// determine if canvas is dirty, if so, we need to recalculate shapes that rely on canvas\r\n\t\tconst canvasScaleChanged = canvasComputedScale !== scale;\r\n\r\n\t\tconst canvasDirty = canvasScaleChanged || !rectEqual(canvasComputedSelectionRect, selectionRect);\r\n\r\n\t\t// remember dirty state so we can compare next draw\r\n\t\tif (canvasDirty) {\r\n\t\t\tcanvasComputedScale = scale;\r\n\t\t\tcanvasComputedSelectionRect = selectionRect;\r\n\t\t}\r\n\r\n\t\t// annotation shapes changed, or user changed annotation shapes in willRenderCanvas hook\r\n\t\tif (annotationShapesDirty || annotationShapesToDraw !== $imageAnnotation) {\r\n\t\t\tcanvasComputedAnnotationBaseShapes = annotationShapesToDraw.filter(shapeIsVisible).map(shapeDeepCopy).sort((a, b) => {\r\n\t\t\t\tif (a.alwaysOnTop) return 1;\r\n\t\t\t\tif (b.alwaysOnTop) return -1;\r\n\t\t\t\treturn 0;\r\n\t\t\t}).map(shape => shapeComputeDisplay(shape, $imageSize));\r\n\t\t}\r\n\r\n\t\tif (canvasScaleChanged || imageAnnotationRequiresPreprocessing || annotationShapesDirty || annotationShapesToDraw !== $imageAnnotation) {\r\n\t\t\tcanvasComputedAnnotationShapes = flattenShapes(canvasComputedAnnotationBaseShapes.map(shape => preprocessShape(shape, {\r\n\t\t\t\tflipX: $imageFlipX,\r\n\t\t\t\tflipY: $imageFlipY,\r\n\t\t\t\trotation: $imageRotation,\r\n\t\t\t\tscale,\r\n\t\t\t\tcontext: rectCreateFromSize($imageSize)\r\n\t\t\t})).flat());\r\n\t\t}\r\n\r\n\t\t// blend shapes changed\r\n\t\tif (blendShapesDirty) {\r\n\t\t\tcanvasComputedBlendShapes = blendShapesToDraw.filter(shapeIsVisible).map(shape => shapeComputeDisplay(shape, $imageSize));\r\n\t\t}\r\n\r\n\t\t// decoration shapes changed, or user changed decoration shapes in willRenderCanvs hook, or canvas updated and decorations need to be recomputed\r\n\t\tif (decorationShapesDirty || decorationShapesToDraw !== $imageDecoration || canvasDirty) {\r\n\t\t\tcanvasComputedDecorationShapes = flattenShapes(decorationShapesToDraw.filter(shapeIsVisible).map(shapeDeepCopy).sort((a, b) => {\r\n\t\t\t\tif (a.alwaysOnTop) return 1;\r\n\t\t\t\tif (b.alwaysOnTop) return -1;\r\n\t\t\t\treturn 0;\r\n\t\t\t}).map(shape => positionDecorationShape(shape, selectionRect, scale)).map(shape => preprocessShape(shape, { context: selectionRect })).flat().map(shape => transformDecorationShape(shape, selectionRect, scale)));\r\n\t\t}\r\n\r\n\t\t// only recompute frame shapes if frame changed or selection rect changed\r\n\t\tif (frameShapesDirty || frameShapesToDraw !== $imageFrame || canvasDirty) {\r\n\t\t\tcanvasComputedFrameShapes = frameShapesToDraw\r\n\t\t\t? flattenShapes([frameShapesToDraw].map(shapeDeepCopy).map(shape => positionDecorationShape(shape, selectionRect, scale)).map(preprocessShape).flat().map(shape => transformDecorationShape(shape, selectionRect, scale)))\r\n\t\t\t: [];\r\n\t\t}\r\n\r\n\t\tconst canvasComputedInterfaceShapes = flattenShapes(interfaceShapesToDraw.filter(shapeIsVisible));\r\n\r\n\t\treturn {\r\n\t\t\t// only redraw if annotations are dirty\r\n\t\t\tblendShapesDirty,\r\n\t\t\tblendShapes: canvasComputedBlendShapes,\r\n\t\t\t// only redraw if annotations are dirty\r\n\t\t\tannotationShapesDirty,\r\n\t\t\tannotationShapes: canvasComputedAnnotationShapes,\r\n\t\t\t// prepare decoration shapes (percentages to absolute values)\r\n\t\t\tdecorationShapesDirty,\r\n\t\t\tdecorationShapes: canvasComputedDecorationShapes,\r\n\t\t\t// prepare frame shapes (percentages to absolute values)\r\n\t\t\tframeShapesDirty,\r\n\t\t\tframeShapes: canvasComputedFrameShapes,\r\n\t\t\t// prepare interface shapes (percentages to absolute values)\r\n\t\t\tinterfaceShapes: canvasComputedInterfaceShapes\r\n\t\t};\r\n\t};\r\n\r\n\t//\r\n\t// for optimizing canvas calls\r\n\t//\r\n\t// mark image annotations as dirrty if the image annotations array is changed\r\n\tlet imageAnnotationShapesDirty = true;\r\n\r\n\tconst markAnnotationShapesAsDirty = () => $$invalidate(57, imageAnnotationShapesDirty = true);\r\n\tlet imageAnnotationRequiresPreprocessing = true;\r\n\tconst markAnnotationRequiresPreprocessing = () => $$invalidate(58, imageAnnotationRequiresPreprocessing = true);\r\n\r\n\t// mark image decorations as dirty if the image decorations array is changed\r\n\tlet imageDecorationShapesDirty = true;\r\n\r\n\tconst markDecorationShapesAsDirty = () => $$invalidate(59, imageDecorationShapesDirty = true);\r\n\r\n\t// mark image frames as dirrty if the image frames array is changed\r\n\tlet imageFrameShapesDirty = true;\r\n\r\n\tconst markFrameShapesAsDirty = () => $$invalidate(60, imageFrameShapesDirty = true);\r\n\r\n\t// mark blend shapes as dirty if the image blend shapes array is changed\r\n\tlet imageBlendShapesDirty = true;\r\n\r\n\tconst markBlendShapesAsDirty = () => $$invalidate(61, imageBlendShapesDirty = true);\r\n\r\n\t// clean up so memory is released correctly\r\n\tonDestroy(() => {\r\n\t\timageStateUnsub();\r\n\t\tstageRectUnsub();\r\n\t\tstageScalarUnsub();\r\n\t\timageIsStaticUnsub();\r\n\t\timageSelectionRectSnapshotUnsub();\r\n\t\timageSelectionRectUnsub();\r\n\t\timageCropRectUnsub();\r\n\t\timageLoadStateUnsub();\r\n\t\timageProcessStateUnsub();\r\n\t\tpointerAccuracy.destroy();\r\n\t\tpointerHoverable.destroy();\r\n\t\timageProxy.destroy();\r\n\t\tactiveImages.clear();\r\n\r\n\t\t// clear shape cache\r\n\t\tcanvasComputedAnnotationBaseShapes.length = 0;\r\n\r\n\t\tcanvasComputedAnnotationShapes.length = 0;\r\n\t\tcanvasComputedBlendShapes.length = 0;\r\n\t\tcanvasComputedDecorationShapes.length = 0;\r\n\t\tcanvasComputedFrameShapes.length = 0;\r\n\r\n\t\ttry {\r\n\t\t\t$$invalidate(201, imagePreviewCurrent = undefined);\r\n\t\t\t$$invalidate(240, lastImagePreview = undefined);\r\n\t\t} catch(err) {\r\n\t\t\t\r\n\t\t} // this sometimes throws a Svelte $$invalidate error, not sure why\r\n\t});\r\n\r\n\tconst handleMeasureUtil = e => {\r\n\t\t// no change\r\n\t\tif ($utilRect && rectEqual(e.detail, $utilRect)) return;\r\n\r\n\t\t// update rect\r\n\t\tset_store_value(utilRect, $utilRect = e.detail, $utilRect);\r\n\t};\r\n\r\n\tfunction onwindowresize() {\r\n\t\t$$invalidate(29, windowWidth = window_1$1.innerWidth);\r\n\t\t$$invalidate(30, windowHeight = window_1$1.innerHeight);\r\n\t}\r\n\r\n\tconst measure_handler = e => set_store_value(toolRect, $toolRect = e.detail, $toolRect);\r\n\tconst select_handler = ({ detail }) => $$invalidate(41, utilSelected = detail);\r\n\tconst func = (panel, util) => util.id === panel;\r\n\r\n\tfunction utilpanel_component_binding(value, panel) {\r\n\t\tif ($$self.$$.not_equal(pluginInterface[panel], value)) {\r\n\t\t\tpluginInterface[panel] = value;\r\n\t\t\t(($$invalidate(1, pluginInterface), $$invalidate(25, pluginOptions)), $$invalidate(236, pluginComponents));\r\n\t\t}\r\n\t}\r\n\r\n\tconst show_handler = panel => $$invalidate(56, utilsVisible = utilsVisible.concat(panel));\r\n\tconst hide_handler = panel => $$invalidate(56, utilsVisible = utilsVisible.filter(util => util !== panel));\r\n\tconst fade_handler = (panel, { detail }) => $$invalidate(36, utilsVisibleFraction[panel] = detail, utilsVisibleFraction);\r\n\tconst measure_handler_1 = e => set_store_value(tabRect, $tabRect = e.detail, $tabRect);\r\n\tconst func_1 = util => util.id === utilSelected;\r\n\r\n\tfunction utilpanel_component_binding_1(value) {\r\n\t\tif ($$self.$$.not_equal(pluginInterface[utilSelected], value)) {\r\n\t\t\tpluginInterface[utilSelected] = value;\r\n\t\t\t(($$invalidate(1, pluginInterface), $$invalidate(25, pluginOptions)), $$invalidate(236, pluginComponents));\r\n\t\t}\r\n\t}\r\n\r\n\tconst show_handler_1 = () => $$invalidate(56, utilsVisible = utilsVisible.concat(utilSelected));\r\n\tconst hide_handler_1 = () => $$invalidate(56, utilsVisible = utilsVisible.filter(util => util !== utilSelected));\r\n\tconst fade_handler_1 = ({ detail }) => $$invalidate(36, utilsVisibleFraction[utilSelected] = detail, utilsVisibleFraction);\r\n\r\n\tconst func_2 = canvasState => {\r\n\r\n\t\t// current draw state\r\n\t\tconst drawState = { ...canvasState, ...getStageState() };\r\n\r\n\t\t// allow devs to add custom overlay to `imageOverlay`\r\n\t\tconst { annotationShapes, decorationShapes, interfaceShapes, frameShapes } = willRenderCanvas(\r\n\t\t\t{\r\n\t\t\t\tannotationShapes: $imageAnnotation,\r\n\t\t\t\tdecorationShapes: $imageDecoration,\r\n\t\t\t\tinterfaceShapes: $imageOverlay,\r\n\t\t\t\tframeShapes: $imageFrame\r\n\t\t\t},\r\n\t\t\tdrawState\r\n\t\t);\r\n\r\n\t\t// need to map shapes\r\n\t\treturn createCanvasState(drawState, blendShapes, annotationShapes, decorationShapes, interfaceShapes, frameShapes);\r\n\t};\r\n\r\n\tconst func_3 = () => {\r\n\t\t// we've just drawn the shapes so mark as clean\r\n\t\t$$invalidate(57, imageAnnotationShapesDirty = false);\r\n\r\n\t\t$$invalidate(58, imageAnnotationRequiresPreprocessing = false);\r\n\t\t$$invalidate(59, imageDecorationShapesDirty = false);\r\n\t\t$$invalidate(60, imageFrameShapesDirty = false);\r\n\t\t$$invalidate(61, imageBlendShapesDirty = false);\r\n\t};\r\n\r\n\tfunction div_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\trootPortal = $$value;\r\n\t\t\t$$invalidate(35, rootPortal);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction canvaspanandzoom_zoomLevel_binding(value) {\r\n\t\tzoomLevel = value;\r\n\t\t($$invalidate(0, zoomLevel), $$invalidate(230, markupEditorZoomLevel));\r\n\t}\r\n\r\n\tfunction canvaspanandzoom_zoomControls_binding(value) {\r\n\t\tzoomControls = value;\r\n\t\t$$invalidate(31, zoomControls);\r\n\t}\r\n\r\n\tfunction canvaspanandzoom_zoomMultiTouching_binding(value) {\r\n\t\tzoomMultiTouching = value;\r\n\t\t$$invalidate(32, zoomMultiTouching);\r\n\t}\r\n\r\n\tfunction div_binding_1($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\troot = $$value;\r\n\t\t\t$$invalidate(2, root);\r\n\t\t});\r\n\t}\r\n\r\n\tconst measure_handler_2 = e => set_store_value(clientRect, $clientRect = e.detail, $clientRect);\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('class' in $$props) $$invalidate(202, klass = $$props.class);\r\n\t\tif ('layout' in $$props) $$invalidate(203, layoutMode = $$props.layout);\r\n\t\tif ('stores' in $$props) $$invalidate(204, stores = $$props.stores);\r\n\t\tif ('locale' in $$props) $$invalidate(3, locale = $$props.locale);\r\n\t\tif ('id' in $$props) $$invalidate(4, id = $$props.id);\r\n\t\tif ('util' in $$props) $$invalidate(205, util = $$props.util);\r\n\t\tif ('utils' in $$props) $$invalidate(206, utils = $$props.utils);\r\n\t\tif ('animations' in $$props) $$invalidate(207, animations = $$props.animations);\r\n\t\tif ('disabled' in $$props) $$invalidate(208, disabled = $$props.disabled);\r\n\t\tif ('status' in $$props) $$invalidate(200, status = $$props.status);\r\n\t\tif ('previewUpscale' in $$props) $$invalidate(209, previewUpscale = $$props.previewUpscale);\r\n\t\tif ('previewPad' in $$props) $$invalidate(210, previewPad = $$props.previewPad);\r\n\t\tif ('previewMaskOpacity' in $$props) $$invalidate(5, previewMaskOpacity = $$props.previewMaskOpacity);\r\n\t\tif ('markupMaskOpacity' in $$props) $$invalidate(6, markupMaskOpacity = $$props.markupMaskOpacity);\r\n\t\tif ('elasticityMultiplier' in $$props) $$invalidate(7, elasticityMultiplier = $$props.elasticityMultiplier);\r\n\t\tif ('willRevert' in $$props) $$invalidate(211, willRevert = $$props.willRevert);\r\n\t\tif ('willProcessImage' in $$props) $$invalidate(212, willProcessImage = $$props.willProcessImage);\r\n\t\tif ('willRenderCanvas' in $$props) $$invalidate(8, willRenderCanvas = $$props.willRenderCanvas);\r\n\t\tif ('willRenderToolbar' in $$props) $$invalidate(213, willRenderToolbar = $$props.willRenderToolbar);\r\n\t\tif ('willSetHistoryInitialState' in $$props) $$invalidate(214, willSetHistoryInitialState = $$props.willSetHistoryInitialState);\r\n\t\tif ('enableButtonExport' in $$props) $$invalidate(215, enableButtonExport = $$props.enableButtonExport);\r\n\t\tif ('enableButtonRevert' in $$props) $$invalidate(216, enableButtonRevert = $$props.enableButtonRevert);\r\n\t\tif ('enableNavigateHistory' in $$props) $$invalidate(217, enableNavigateHistory = $$props.enableNavigateHistory);\r\n\t\tif ('enableToolbar' in $$props) $$invalidate(9, enableToolbar = $$props.enableToolbar);\r\n\t\tif ('enableUtils' in $$props) $$invalidate(218, enableUtils = $$props.enableUtils);\r\n\t\tif ('enableButtonClose' in $$props) $$invalidate(219, enableButtonClose = $$props.enableButtonClose);\r\n\t\tif ('enableDropImage' in $$props) $$invalidate(220, enableDropImage = $$props.enableDropImage);\r\n\t\tif ('enablePasteImage' in $$props) $$invalidate(221, enablePasteImage = $$props.enablePasteImage);\r\n\t\tif ('enableBrowseImage' in $$props) $$invalidate(222, enableBrowseImage = $$props.enableBrowseImage);\r\n\t\tif ('previewImageDataMaxSize' in $$props) $$invalidate(223, previewImageDataMaxSize = $$props.previewImageDataMaxSize);\r\n\t\tif ('previewImageTextPixelRatio' in $$props) $$invalidate(10, previewImageTextPixelRatio = $$props.previewImageTextPixelRatio);\r\n\t\tif ('layoutDirectionPreference' in $$props) $$invalidate(224, layoutDirectionPreference = $$props.layoutDirectionPreference);\r\n\t\tif ('layoutHorizontalUtilsPreference' in $$props) $$invalidate(225, layoutHorizontalUtilsPreference = $$props.layoutHorizontalUtilsPreference);\r\n\t\tif ('layoutVerticalUtilsPreference' in $$props) $$invalidate(226, layoutVerticalUtilsPreference = $$props.layoutVerticalUtilsPreference);\r\n\t\tif ('layoutVerticalToolbarPreference' in $$props) $$invalidate(227, layoutVerticalToolbarPreference = $$props.layoutVerticalToolbarPreference);\r\n\t\tif ('layoutVerticalControlGroupsPreference' in $$props) $$invalidate(228, layoutVerticalControlGroupsPreference = $$props.layoutVerticalControlGroupsPreference);\r\n\t\tif ('layoutVerticalControlTabsPreference' in $$props) $$invalidate(229, layoutVerticalControlTabsPreference = $$props.layoutVerticalControlTabsPreference);\r\n\t\tif ('markupEditorZoomLevel' in $$props) $$invalidate(230, markupEditorZoomLevel = $$props.markupEditorZoomLevel);\r\n\t\tif ('markupEditorZoomLevels' in $$props) $$invalidate(11, markupEditorZoomLevels = $$props.markupEditorZoomLevels);\r\n\t\tif ('markupEditorZoomAdjustStep' in $$props) $$invalidate(12, markupEditorZoomAdjustStep = $$props.markupEditorZoomAdjustStep);\r\n\t\tif ('markupEditorZoomAdjustFactor' in $$props) $$invalidate(13, markupEditorZoomAdjustFactor = $$props.markupEditorZoomAdjustFactor);\r\n\t\tif ('markupEditorZoomAdjustWheelFactor' in $$props) $$invalidate(14, markupEditorZoomAdjustWheelFactor = $$props.markupEditorZoomAdjustWheelFactor);\r\n\t\tif ('markupEditorInteractionMode' in $$props) $$invalidate(231, markupEditorInteractionMode = $$props.markupEditorInteractionMode);\r\n\t\tif ('enablePan' in $$props) $$invalidate(15, enablePan = $$props.enablePan);\r\n\t\tif ('enableZoom' in $$props) $$invalidate(16, enableZoom = $$props.enableZoom);\r\n\t\tif ('enableZoomControls' in $$props) $$invalidate(232, enableZoomControls = $$props.enableZoomControls);\r\n\t\tif ('enableZoomInput' in $$props) $$invalidate(17, enableZoomInput = $$props.enableZoomInput);\r\n\t\tif ('enablePanInput' in $$props) $$invalidate(233, enablePanInput = $$props.enablePanInput);\r\n\t\tif ('enableCanvasAlpha' in $$props) $$invalidate(18, enableCanvasAlpha = $$props.enableCanvasAlpha);\r\n\t\tif ('enablePanLimit' in $$props) $$invalidate(19, enablePanLimit = $$props.enablePanLimit);\r\n\t\tif ('panLimitGutterScalar' in $$props) $$invalidate(20, panLimitGutterScalar = $$props.panLimitGutterScalar);\r\n\t\tif ('zoomPresetOptions' in $$props) $$invalidate(21, zoomPresetOptions = $$props.zoomPresetOptions);\r\n\t\tif ('zoomAdjustStep' in $$props) $$invalidate(22, zoomAdjustStep = $$props.zoomAdjustStep);\r\n\t\tif ('zoomAdjustFactor' in $$props) $$invalidate(23, zoomAdjustFactor = $$props.zoomAdjustFactor);\r\n\t\tif ('zoomAdjustWheelFactor' in $$props) $$invalidate(24, zoomAdjustWheelFactor = $$props.zoomAdjustWheelFactor);\r\n\t\tif ('zoomLevel' in $$props) $$invalidate(0, zoomLevel = $$props.zoomLevel);\r\n\t\tif ('imagePreviewSrc' in $$props) $$invalidate(234, imagePreviewSrc = $$props.imagePreviewSrc);\r\n\t\tif ('imageOrienter' in $$props) $$invalidate(235, imageOrienter = $$props.imageOrienter);\r\n\t\tif ('pluginComponents' in $$props) $$invalidate(236, pluginComponents = $$props.pluginComponents);\r\n\t\tif ('pluginOptions' in $$props) $$invalidate(25, pluginOptions = $$props.pluginOptions);\r\n\t\tif ('root' in $$props) $$invalidate(2, root = $$props.root);\r\n\t\tif ('imageSourceToImageData' in $$props) $$invalidate(26, imageSourceToImageData = $$props.imageSourceToImageData);\r\n\t\tif ('imagePreviewCurrent' in $$props) $$invalidate(201, imagePreviewCurrent = $$props.imagePreviewCurrent);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*zoomLevel*/ 1 | $$self.$$.dirty[7] & /*markupEditorZoomLevel*/ 8192) {\r\n\t\t\t// @deprecated, remove in v9\r\n\t\t\t$$invalidate(0, zoomLevel = zoomLevel === null ? markupEditorZoomLevel : zoomLevel);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*elasticityMultiplier*/ 128) {\r\n\t\t\tset_store_value(elasticityMultiplierStore, $elasticityMultiplierStore = elasticityMultiplier, $elasticityMultiplierStore);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[6] & /*layoutMode*/ 131072) {\r\n\t\t\t// set to new object to force redraw\r\n\t\t\t$$invalidate(299, isOverlayModeEnabled = layoutMode === 'overlay');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[7] & /*enableUtils*/ 2 | $$self.$$.dirty[9] & /*isOverlayModeEnabled*/ 1048576) {\r\n\t\t\t$$invalidate(42, showUtils = enableUtils && !isOverlayModeEnabled);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*pluginOptions, pluginInterface*/ 33554434) {\r\n\t\t\t// map plugin options to plugin interface\r\n\t\t\tif (pluginOptions) {\r\n\t\t\t\t// for every plugin in plugin options\r\n\t\t\t\tObject.entries(pluginOptions).forEach(([name, plugin]) => {\r\n\t\t\t\t\t// for every prop defined for this plugin\r\n\t\t\t\t\tObject.entries(plugin).forEach(([prop, value]) => {\r\n\t\t\t\t\t\t// set value to interface\r\n\t\t\t\t\t\tif (!pluginInterface[name]) return;\r\n\r\n\t\t\t\t\t\t// set prop value\r\n\t\t\t\t\t\t$$invalidate(1, pluginInterface[name][prop] = value, pluginInterface);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*pluginInterface*/ 2 | $$self.$$.dirty[7] & /*pluginComponents*/ 524288) {\r\n\t\t\t{\r\n\t\t\t\tlet changed = false;\r\n\r\n\t\t\t\t// create plugin interfaces\r\n\t\t\t\tpluginComponents.forEach(([key]) => {\r\n\t\t\t\t\tif (pluginInterface[key]) return;\r\n\t\t\t\t\t$$invalidate(1, pluginInterface[key] = {}, pluginInterface);\r\n\t\t\t\t\tchanged = true;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (changed) {\r\n\t\t\t\t\t$$invalidate(238, registeredPluginsComponents = [...pluginComponents]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[6] & /*disabled*/ 4194304) {\r\n\t\t\tdisabledTransition.set(disabled ? 1 : 0);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[7] & /*previewImageDataMaxSize*/ 64) {\r\n\t\t\tmaxImageDataSize = previewImageDataMaxSize\r\n\t\t\t? sizeMin(previewImageDataMaxSize, maxTextureSize)\r\n\t\t\t: maxTextureSize;\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[11] & /*$images*/ 128) {\r\n\t\t\timageProxy.update($images[0]);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[11] & /*$shapePreprocessor*/ 64) {\r\n\t\t\tpreprocessShape = $shapePreprocessor\r\n\t\t\t? (shape, options) => $shapePreprocessor(shape, {\r\n\t\t\t\t\tflipX: undefined,\r\n\t\t\t\t\tflipY: undefined,\r\n\t\t\t\t\trotation: undefined,\r\n\t\t\t\t\t...options,\r\n\t\t\t\t\tisPreview: true\r\n\t\t\t\t})\r\n\t\t\t: passthrough;\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[7] & /*enableZoomControls*/ 32768) {\r\n\t\t\tenableZoomControlsProp.set(enableZoomControls);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[7] & /*markupEditorInteractionMode, enablePanInput*/ 81920) {\r\n\t\t\tenablePanInputProp.set(markupEditorInteractionMode === 'pan'\r\n\t\t\t? true\r\n\t\t\t: enablePanInput);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$clientRect*/ 131072) {\r\n\t\t\t$clientRect && rootRect.set(rectCreate($clientRect.x, $clientRect.y, $clientRect.width, $clientRect.height));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[9] & /*$rootRect, isOverlayModeEnabled*/ 537919488 | $$self.$$.dirty[10] & /*$imageLoadState*/ 4096) {\r\n\t\t\t$rootRect && isOverlayModeEnabled && $imageLoadState && $imageLoadState.complete && syncRootAspectRatio();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*locale*/ 8 | $$self.$$.dirty[6] & /*utils*/ 1048576 | $$self.$$.dirty[7] & /*registeredPluginsComponents*/ 2097152) {\r\n\t\t\t$$invalidate(290, utilsFiltered = locale && registeredPluginsComponents.length\r\n\t\t\t? utils || registeredPluginsComponents.map(([id]) => id)\r\n\t\t\t: []);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[9] & /*utilsFiltered*/ 2048) {\r\n\t\t\t$$invalidate(43, shouldRenderTabs = utilsFiltered.length > 1);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*shouldRenderTabs*/ 4096) {\r\n\t\t\tif (!shouldRenderTabs) tabRect.set(rectCreateEmpty());\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*enableToolbar*/ 512) {\r\n\t\t\tif (!enableToolbar) toolRect.set(rectCreateEmpty());\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[9] & /*$isInteracting, supportsAnimations*/ 1077936128) {\r\n\t\t\t$$invalidate(302, canAnimate = !$isInteracting && supportsAnimations);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[11] & /*$prefersReducedMotion*/ 32) {\r\n\t\t\t$$invalidate(300, acceptsAnimations = !$prefersReducedMotion);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[6] & /*animations*/ 2097152 | $$self.$$.dirty[9] & /*canAnimate, acceptsAnimations*/ 10485760) {\r\n\t\t\t// if the dev wants to run animations\r\n\t\t\tset_store_value(\r\n\t\t\t\tshouldAnimate,\r\n\t\t\t\t$shouldAnimate = animations === 'always'\r\n\t\t\t\t? canAnimate\r\n\t\t\t\t: animations === 'never'\r\n\t\t\t\t\t? false\r\n\t\t\t\t\t: canAnimate && acceptsAnimations,\r\n\t\t\t\t$shouldAnimate\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[6] & /*animations*/ 2097152 | $$self.$$.dirty[9] & /*supportsAnimations, acceptsAnimations*/ 6291456) {\r\n\t\t\t// if the browser _can_ run animations when the dev wants to run animations\r\n\t\t\tset_store_value(\r\n\t\t\t\tisAnimated,\r\n\t\t\t\t$isAnimated = animations === 'always'\r\n\t\t\t\t? supportsAnimations\r\n\t\t\t\t: animations === 'never'\r\n\t\t\t\t\t? false\r\n\t\t\t\t\t: supportsAnimations && acceptsAnimations,\r\n\t\t\t\t$isAnimated\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[6] & /*previewUpscale*/ 8388608 | $$self.$$.dirty[9] & /*isOverlayModeEnabled*/ 1048576) {\r\n\t\t\tpreviewShouldUpscale.set(previewUpscale || isOverlayModeEnabled);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[6] & /*previewPad*/ 16777216) {\r\n\t\t\tshouldPadPreview.set(previewPad);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*root*/ 4 | $$self.$$.dirty[11] & /*$imageSelectionZoom*/ 16) {\r\n\t\t\tif (root) {\r\n\t\t\t\troot.dispatchEvent(createPing('markupzoom', $imageSelectionZoom)); // @deprecated\r\n\t\t\t\troot.dispatchEvent(createPing('zoom', $imageSelectionZoom));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*root*/ 4 | $$self.$$.dirty[11] & /*$imageSelectionPan*/ 8) {\r\n\t\t\tif (root) {\r\n\t\t\t\troot.dispatchEvent(createPing('markuppan', $imageSelectionPan)); // @deprecated\r\n\t\t\t\troot.dispatchEvent(createPing('pan', $imageSelectionPan));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[11] & /*$imageCropRect*/ 2) {\r\n\t\t\t// reset selection stored state when crop rect is updated\r\n\t\t\tif ($imageCropRect) imageSelectionStoredStateReset();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[11] & /*$imageStaticBounds*/ 4) {\r\n\t\t\t$imageStaticBounds && centerImageStaticBounds();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[7] & /*registeredPluginsComponents*/ 2097152 | $$self.$$.dirty[9] & /*utilsFiltered*/ 2048 | $$self.$$.dirty[10] & /*$mediaDuration*/ 1048576) {\r\n\t\t\t$$invalidate(291, utilsAvailable = registeredPluginsComponents.filter(([id]) => utilsFiltered.includes(id)).filter(([,{ isSupported }]) => isSupported({ duration: $mediaDuration })).map(([id, util]) => [id, util.Component]));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[9] & /*utilsAvailable*/ 4096) {\r\n\t\t\t$$invalidate(246, utilsDefined = utilsAvailable.length);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[6] & /*util*/ 524288 | $$self.$$.dirty[7] & /*utilsDefined*/ 536870912 | $$self.$$.dirty[9] & /*utilsAvailable*/ 4096) {\r\n\t\t\t$$invalidate(41, utilSelected = util && typeof util === 'string' && utilsAvailable.find(([id]) => id === util)\r\n\t\t\t? util\r\n\t\t\t: utilsDefined > 0 ? utilsAvailable[0][0] : undefined);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*utilSelected, $isAnimated*/ 525312) {\r\n\t\t\tutilSelected && imageOutlineOpacity.set(0.075, { hard: !$isAnimated });\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$stagePadding*/ 1073741824 | $$self.$$.dirty[11] & /*$stagePadded*/ 1) {\r\n\t\t\t$$invalidate(298, overlayMin = $stagePadded\r\n\t\t\t? -Math.max(...Object.values($stagePadding))\r\n\t\t\t: 0);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$imageSelectionRectPresentation, $isAnimated*/ 17301504 | $$self.$$.dirty[9] & /*$stageRect, overlayMin*/ 268959744) {\r\n\t\t\tif ($imageSelectionRectPresentation) {\r\n\t\t\t\tlet l = $imageSelectionRectPresentation.x - $stageRect.x;\r\n\t\t\t\tlet r = $stageRect.x + $stageRect.width - ($imageSelectionRectPresentation.x + $imageSelectionRectPresentation.width);\r\n\t\t\t\tlet t = $imageSelectionRectPresentation.y - $stageRect.y;\r\n\t\t\t\tlet b = $stageRect.y + $stageRect.height - ($imageSelectionRectPresentation.y + $imageSelectionRectPresentation.height);\r\n\t\t\t\tlet d = Math.min(l, t, r, b);\r\n\r\n\t\t\t\toverlayOpacity.set(\r\n\t\t\t\t\td > overlayMin\r\n\t\t\t\t\t? 0\r\n\t\t\t\t\t: Math.min(OVERLAY_OPACITY_MAX, Math.abs(d / OVERLAY_OPACITY_TWEEN_DIST)),\r\n\t\t\t\t\t{ hard: !$isAnimated }\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$pixelRatio*/ 8388608) {\r\n\t\t\t// this slightly overlaps the overlay parts preventing bright background colors from shining through\r\n\t\t\t$$invalidate(297, overlayOverlap = 0.55 / $pixelRatio);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$isAnimated*/ 524288 | $$self.$$.dirty[9] & /*$stageRect, overlayOverlap*/ 268697600) {\r\n\t\t\t$stageRect && overlayLeftRect.set(\r\n\t\t\t\t{\r\n\t\t\t\t\tx: 0,\r\n\t\t\t\t\ty: $stageRect.y,\r\n\t\t\t\t\twidth: $stageRect.x < OVERLAY_OPACITY_TWEEN_DIST\r\n\t\t\t\t\t? 0\r\n\t\t\t\t\t: $stageRect.x,\r\n\t\t\t\t\theight: $stageRect.height + overlayOverlap\r\n\t\t\t\t},\r\n\t\t\t\t{ hard: !$isAnimated }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$isAnimated*/ 524288 | $$self.$$.dirty[9] & /*$stageRect, $rootRect, overlayOverlap*/ 805568512) {\r\n\t\t\t$stageRect && overlayTopRect.set(\r\n\t\t\t\t{\r\n\t\t\t\t\tx: 0,\r\n\t\t\t\t\ty: 0,\r\n\t\t\t\t\twidth: $rootRect.width,\r\n\t\t\t\t\theight: $stageRect.y + overlayOverlap\r\n\t\t\t\t},\r\n\t\t\t\t{ hard: !$isAnimated }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$isAnimated*/ 524288 | $$self.$$.dirty[9] & /*$stageRect, $rootRect, overlayOverlap*/ 805568512) {\r\n\t\t\tif ($stageRect) {\r\n\t\t\t\tlet x = $stageRect.x + $stageRect.width;\r\n\t\t\t\tlet width = $rootRect.width - ($stageRect.x + $stageRect.width);\r\n\r\n\t\t\t\tif (width < OVERLAY_OPACITY_TWEEN_DIST) {\r\n\t\t\t\t\tx += width;\r\n\t\t\t\t\twidth = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\toverlayRightRect.set(\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tx,\r\n\t\t\t\t\t\ty: $stageRect.y,\r\n\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\theight: $stageRect.height + overlayOverlap\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{ hard: !$isAnimated }\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$isAnimated*/ 524288 | $$self.$$.dirty[9] & /*$stageRect, $rootRect*/ 805306368) {\r\n\t\t\t$stageRect && overlayBottomRect.set(\r\n\t\t\t\t{\r\n\t\t\t\t\tx: 0,\r\n\t\t\t\t\ty: $stageRect.y + $stageRect.height,\r\n\t\t\t\t\twidth: $rootRect.width,\r\n\t\t\t\t\theight: $rootRect.height - ($stageRect.y + $stageRect.height)\r\n\t\t\t\t},\r\n\t\t\t\t{ hard: !$isAnimated }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$rootBackgroundColor*/ 4194304 | $$self.$$.dirty[10] & /*$overlayLeftRect, $overlayOpacity*/ 603979776) {\r\n\t\t\t$$invalidate(293, overlayLeft = $overlayLeftRect && {\r\n\t\t\t\tid: OVERLAY_ID,\r\n\t\t\t\tbackgroundColor: $rootBackgroundColor,\r\n\t\t\t\topacity: $overlayOpacity,\r\n\t\t\t\t...$overlayLeftRect\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$rootBackgroundColor*/ 4194304 | $$self.$$.dirty[10] & /*$overlayTopRect, $overlayOpacity*/ 335544320) {\r\n\t\t\t$$invalidate(296, overlayTop = $overlayTopRect && {\r\n\t\t\t\tid: OVERLAY_ID,\r\n\t\t\t\tbackgroundColor: $rootBackgroundColor,\r\n\t\t\t\topacity: $overlayOpacity,\r\n\t\t\t\t...$overlayTopRect\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$rootBackgroundColor*/ 4194304 | $$self.$$.dirty[10] & /*$overlayRightRect, $overlayOpacity*/ 201326592) {\r\n\t\t\t$$invalidate(295, overlayRight = $overlayRightRect && {\r\n\t\t\t\tid: OVERLAY_ID,\r\n\t\t\t\tbackgroundColor: $rootBackgroundColor,\r\n\t\t\t\topacity: $overlayOpacity,\r\n\t\t\t\t...$overlayRightRect\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$rootBackgroundColor*/ 4194304 | $$self.$$.dirty[10] & /*$overlayBottomRect, $overlayOpacity*/ 100663296) {\r\n\t\t\t$$invalidate(294, overlayBottom = $overlayBottomRect && {\r\n\t\t\t\tid: OVERLAY_ID,\r\n\t\t\t\tbackgroundColor: $rootBackgroundColor,\r\n\t\t\t\topacity: $overlayOpacity,\r\n\t\t\t\t...$overlayBottomRect\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[9] & /*overlayTop, overlayRight, overlayBottom, overlayLeft*/ 245760) {\r\n\t\t\t$$invalidate(292, gradientOverlays = [overlayTop, overlayRight, overlayBottom, overlayLeft].filter(Boolean));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[9] & /*gradientOverlays*/ 8192 | $$self.$$.dirty[10] & /*$imageOverlayMarkup*/ 16777216) {\r\n\t\t\t// if overlay top changes\r\n\t\t\tif (gradientOverlays && $imageOverlayMarkup) {\r\n\t\t\t\t// remove existing resize overlays\r\n\t\t\t\tconst overlayMarkupFiltered = $imageOverlayMarkup.filter(markup => markup.id !== OVERLAY_ID);\r\n\r\n\t\t\t\timageOverlayMarkup.set([...overlayMarkupFiltered, ...gradientOverlays]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[7] & /*imagePreviewSrc*/ 131072 | $$self.$$.dirty[10] & /*$imageFile*/ 8388608) {\r\n\t\t\timagePreviewSource.set(imagePreviewSrc\r\n\t\t\t? imagePreviewSrc\r\n\t\t\t: $imageFile || undefined);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*root*/ 4 | $$self.$$.dirty[6] & /*imagePreviewCurrent*/ 32768 | $$self.$$.dirty[10] & /*$imagePreview*/ 1) {\r\n\t\t\t{\r\n\t\t\t\t$$invalidate(201, imagePreviewCurrent = $imagePreview);\r\n\t\t\t\tif ($imagePreview) root.dispatchEvent(createPing('loadpreview', imagePreviewCurrent));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$imagePreviewSource*/ 8192) {\r\n\t\t\tif ($imagePreviewSource) resetPreviews();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$history*/ 4194304) {\r\n\t\t\t$$invalidate(251, canUndo = $history.index > 0);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$history*/ 4194304) {\r\n\t\t\t$$invalidate(250, canRedo = $history.index < $history.length - 1);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*zoomMultiTouching*/ 2) {\r\n\t\t\timageSelectionMultiTouching.set(zoomMultiTouching);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$previewShouldUpscale*/ 2097152) {\r\n\t\t\timagePreviewUpscale.set($previewShouldUpscale);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*locale*/ 8 | $$self.$$.dirty[9] & /*utilsFiltered, utilsAvailable*/ 6144) {\r\n\t\t\t$$invalidate(44, utilsMerged = utilsFiltered.map(utilId => {\r\n\t\t\t\tconst util = utilsAvailable.find(([id]) => utilId === id); // [id, view]\r\n\t\t\t\tif (!util) return;\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: utilId,\r\n\t\t\t\t\tview: util[1],\r\n\t\t\t\t\ttabIcon: locale[`${utilId}Icon`],\r\n\t\t\t\t\ttabLabel: locale[`${utilId}Label`]\r\n\t\t\t\t};\r\n\t\t\t}).filter(Boolean) || []);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*utilSelected*/ 1024) {\r\n\t\t\tutilSelectedStore.set(utilSelected);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*utilsMerged, utilsVisibleFraction*/ 8224) {\r\n\t\t\t$$invalidate(36, utilsVisibleFraction = utilsMerged.reduce(\r\n\t\t\t\t(prev, curr) => {\r\n\t\t\t\t\tprev[curr.id] = utilsVisibleFraction && utilsVisibleFraction[curr.id] || 0;\r\n\t\t\t\t\treturn prev;\r\n\t\t\t\t},\r\n\t\t\t\t{}\r\n\t\t\t));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*utilSelected*/ 1024) {\r\n\t\t\t$$invalidate(74, tabsConfig = {\r\n\t\t\t\tname: utilsUniqueId,\r\n\t\t\t\tselected: utilSelected\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*utilsMerged*/ 8192) {\r\n\t\t\t$$invalidate(73, tabs = utilsMerged.map(util => ({\r\n\t\t\t\tid: util.id,\r\n\t\t\t\ticon: util.tabIcon,\r\n\t\t\t\tlabel: util.tabLabel\r\n\t\t\t})));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*utilsMerged*/ 8192) {\r\n\t\t\t$$invalidate(72, panels = utilsMerged.map(util => util.id));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[6] & /*klass*/ 65536) {\r\n\t\t\t$$invalidate(71, className = arrayJoin(['PinturaRoot', 'PinturaRootComponent', klass]));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[9] & /*$rootRect*/ 536870912) {\r\n\t\t\t$$invalidate(286, horizontalSpace = $rootRect && ($rootRect.width > 1000\r\n\t\t\t? 'wide'\r\n\t\t\t: $rootRect.width < 600 ? 'narrow' : undefined));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[9] & /*$rootRect*/ 536870912) {\r\n\t\t\t$$invalidate(273, hasLimitedSpace = $rootRect && ($rootRect.width <= 320 || $rootRect.height <= 460));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[9] & /*$rootRect*/ 536870912) {\r\n\t\t\t$$invalidate(285, verticalSpace = $rootRect && ($rootRect.height > 1000\r\n\t\t\t? 'tall'\r\n\t\t\t: $rootRect.height < 600 ? 'short' : undefined));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*root*/ 4) {\r\n\t\t\t$$invalidate(253, isModal = root && root.parentNode && root.parentNode.classList.contains('PinturaModal'));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*windowWidth*/ 536870912 | $$self.$$.dirty[8] & /*isModal*/ 32 | $$self.$$.dirty[9] & /*$rootRect*/ 536870912) {\r\n\t\t\t$$invalidate(278, isCenteredHorizontally = isModal && $rootRect && windowWidth > $rootRect.width);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*windowHeight*/ 1073741824 | $$self.$$.dirty[8] & /*isModal*/ 32 | $$self.$$.dirty[9] & /*$rootRect*/ 536870912) {\r\n\t\t\t$$invalidate(277, isCenteredVertically = isModal && $rootRect && windowHeight > $rootRect.height);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[8] & /*isCenteredHorizontally, isCenteredVertically*/ 1610612736) {\r\n\t\t\t$$invalidate(279, isCentered = isCenteredHorizontally && isCenteredVertically);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*enableCanvasAlpha*/ 262144) {\r\n\t\t\t$$invalidate(276, isTransparent = enableCanvasAlpha);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[9] & /*horizontalSpace*/ 128) {\r\n\t\t\t$$invalidate(248, isNarrow = horizontalSpace === 'narrow');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[7] & /*layoutDirectionPreference*/ 128 | $$self.$$.dirty[9] & /*$rootRect*/ 536870912) {\r\n\t\t\t$$invalidate(287, orientation = getOrientation($rootRect, layoutDirectionPreference));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[9] & /*orientation*/ 256) {\r\n\t\t\t$$invalidate(70, isLandscape = orientation === 'landscape');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[8] & /*isNarrow*/ 1 | $$self.$$.dirty[9] & /*verticalSpace*/ 64) {\r\n\t\t\t$$invalidate(275, isCompact = isNarrow || verticalSpace === 'short');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*windowWidth*/ 536870912 | $$self.$$.dirty[9] & /*$rootRect*/ 536870912) {\r\n\t\t\t$$invalidate(274, hasSwipeNavigation = iOS && $rootRect && windowWidth === $rootRect.width && !shouldPreventSwipe);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*zoomControls*/ 1 | $$self.$$.dirty[10] & /*$utilTools*/ 524288) {\r\n\t\t\t$$invalidate(249, activeUtilTools = [...$utilTools || [], ...zoomControls].filter(Boolean));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[7] & /*layoutHorizontalUtilsPreference*/ 256) {\r\n\t\t\t$$invalidate(284, navigationHorizontalPreference = `has-navigation-preference-${layoutHorizontalUtilsPreference}`);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[7] & /*layoutVerticalUtilsPreference*/ 512) {\r\n\t\t\t$$invalidate(283, navigationVerticalPreference = `has-navigation-preference-${layoutVerticalUtilsPreference}`);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[7] & /*layoutVerticalToolbarPreference*/ 1024) {\r\n\t\t\t$$invalidate(280, toolbarVerticalPreference = `has-toolbar-preference-${layoutVerticalToolbarPreference}`);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[7] & /*layoutVerticalControlGroupsPreference*/ 2048) {\r\n\t\t\t$$invalidate(282, controlGroupsVerticalPreference = `has-controlgroups-preference-${layoutVerticalControlGroupsPreference}`);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[7] & /*layoutVerticalControlTabsPreference*/ 4096) {\r\n\t\t\t$$invalidate(281, controlTabsVerticalpreference = `has-controltabs-preference-${layoutVerticalControlTabsPreference}`);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[9] & /*$rootRect*/ 536870912) {\r\n\t\t\t// will update when root element is available (computed style is live, so is updated when the style is updated)\r\n\t\t\t$$invalidate(289, rootRectDefined = $rootRect !== undefined && $rootRect.width > 0 && $rootRect.height > 0);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*root*/ 4 | $$self.$$.dirty[9] & /*rootRectDefined*/ 1024) {\r\n\t\t\t$$invalidate(288, rootElementComputedStyle = rootRectDefined && root && getComputedStyle(root));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[9] & /*rootElementComputedStyle*/ 512) {\r\n\t\t\t// sync for first time\r\n\t\t\tif (rootElementComputedStyle) syncColors();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*enableToolbar*/ 512 | $$self.$$.dirty[1] & /*$isAnimated, shouldRenderTabs, showUtils*/ 530432 | $$self.$$.dirty[6] & /*layoutMode, disabled*/ 4325376 | $$self.$$.dirty[8] & /*isModal, isCenteredHorizontally, isCenteredVertically, isTransparent, isCompact, hasSwipeNavigation, hasLimitedSpace*/ 2113929248 | $$self.$$.dirty[9] & /*orientation, horizontalSpace, verticalSpace, navigationHorizontalPreference, navigationVerticalPreference, controlGroupsVerticalPreference, controlTabsVerticalpreference, toolbarVerticalPreference, isCentered*/ 511 | $$self.$$.dirty[10] & /*$env, $pointerAccuracy, $pointerHoverable*/ 393232) {\r\n\t\t\tenv.set({\r\n\t\t\t\t...$env,\r\n\t\t\t\tlayoutMode,\r\n\t\t\t\torientation,\r\n\t\t\t\thorizontalSpace,\r\n\t\t\t\tverticalSpace,\r\n\t\t\t\tnavigationHorizontalPreference,\r\n\t\t\t\tnavigationVerticalPreference,\r\n\t\t\t\tcontrolGroupsVerticalPreference,\r\n\t\t\t\tcontrolTabsVerticalpreference,\r\n\t\t\t\ttoolbarVerticalPreference,\r\n\t\t\t\tisModal,\r\n\t\t\t\tisDisabled: disabled,\r\n\t\t\t\tisCentered,\r\n\t\t\t\tisCenteredHorizontally,\r\n\t\t\t\tisCenteredVertically,\r\n\t\t\t\tisAnimated: $isAnimated,\r\n\t\t\t\tisTransparent,\r\n\t\t\t\tpointerAccuracy: $pointerAccuracy,\r\n\t\t\t\tpointerHoverable: $pointerHoverable,\r\n\t\t\t\tisCompact,\r\n\t\t\t\thasSwipeNavigation,\r\n\t\t\t\thasLimitedSpace,\r\n\t\t\t\thasToolbar: enableToolbar,\r\n\t\t\t\thasNavigation: shouldRenderTabs && showUtils,\r\n\t\t\t\tisIOS: iOS\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$env*/ 16) {\r\n\t\t\t$$invalidate(69, envStr = Object.entries($env).map(([key, value]) => {\r\n\t\t\t\t// is true boolean prop, use key\r\n\t\t\t\tif ((/^is|has/).test(key)) {\r\n\t\t\t\t\treturn value ? toKebabCase(key) : undefined;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// use value\r\n\t\t\t\treturn value;\r\n\t\t\t}).filter(Boolean).join(' '));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*utilSelected*/ 1024) {\r\n\t\t\t// clear util tools when selected tool changes, when tool becomes active it will update the tools (if needed)\r\n\t\t\tutilSelected && utilTools.set([]);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$imageTransforms, $imagePreviewModifiers*/ 98304) {\r\n\t\t\t$$invalidate(68, imageCanvasState = $imageTransforms && Object.entries($imagePreviewModifiers).filter(([,value]) => value != null).reduce(\r\n\t\t\t\t(prev, [,value]) => {\r\n\t\t\t\t\tprev = { ...prev, ...value };\r\n\t\t\t\t\treturn prev;\r\n\t\t\t\t},\r\n\t\t\t\t{}\r\n\t\t\t));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$imageLoadState*/ 4096) {\r\n\t\t\t//\r\n\t\t\t// loading status\r\n\t\t\t//\r\n\t\t\t$$invalidate(270, isStartLoadingImageSource = $imageLoadState && $imageLoadState.task === 'any-to-file');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[8] & /*isStartLoadingImageSource*/ 4194304) {\r\n\t\t\t// reset active images when loading a new image source\r\n\t\t\tif (isStartLoadingImageSource && activeImages) {\r\n\t\t\t\tactiveImages.clear();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$imageProps*/ 16384) {\r\n\t\t\t// if image props are ready\r\n\t\t\t$$invalidate(272, hasProps = !!$imageProps && !!$imageProps.translation);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[7] & /*lastImagePreview*/ 8388608 | $$self.$$.dirty[8] & /*hasProps*/ 16777216 | $$self.$$.dirty[10] & /*$imagePreview*/ 1) {\r\n\t\t\tif (hasProps && $imagePreview && $imagePreview !== lastImagePreview) {\r\n\t\t\t\t$$invalidate(240, lastImagePreview = $imagePreview);\r\n\t\t\t\taddImagePreview();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[8] & /*hasProps*/ 16777216 | $$self.$$.dirty[10] & /*$imageProps*/ 16384) {\r\n\t\t\t// update images when image props change\r\n\t\t\thasProps && updateImagePreviews($imageProps);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$activeImages*/ 2097152) {\r\n\t\t\t// clean active images array, removes 'inactive' images when their opacity is 0\r\n\t\t\tif ($activeImages && $activeImages.length > 1) {\r\n\t\t\t\tlet imagesToRemove = [];\r\n\r\n\t\t\t\tactiveImages.forEach((image, index) => {\r\n\t\t\t\t\tif (index === 0) return;\r\n\t\t\t\t\tif (image.get().opacity <= 0) imagesToRemove.push(image);\r\n\t\t\t\t});\r\n\r\n\t\t\t\timagesToRemove.forEach(image => activeImages.remove(image));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*locale*/ 8 | $$self.$$.dirty[8] & /*missingFeatures*/ 8388608) {\r\n\t\t\t$$invalidate(38, isSupportsError = locale && missingFeatures.length && locale.labelSupportError(missingFeatures));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$imageLoadState*/ 4096) {\r\n\t\t\t$$invalidate(262, isImageLoadError = $imageLoadState && !!$imageLoadState.error);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$imageLoadState*/ 4096) {\r\n\t\t\t$$invalidate(40, isWaitingForImage = !$imageLoadState || !$imageLoadState.complete && $imageLoadState.task === undefined);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$imageLoadState*/ 4096) {\r\n\t\t\t$$invalidate(263, imageLoadProgress = $imageLoadState && ($imageLoadState.taskLengthComputable\r\n\t\t\t? $imageLoadState.taskProgress\r\n\t\t\t: Infinity));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[8] & /*isStartLoadingImageSource*/ 4194304) {\r\n\t\t\tif (isStartLoadingImageSource) set_store_value(imageVisualLoadComplete, $imageVisualLoadComplete = false, $imageVisualLoadComplete);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$isAnimated*/ 524288 | $$self.$$.dirty[7] & /*loadTimer*/ 16777216 | $$self.$$.dirty[10] & /*$imageLoadState*/ 4096) {\r\n\t\t\tif ($imageLoadState && $imageLoadState.complete) {\r\n\t\t\t\tconst minLoaderDuration = $isAnimated ? 250 : 0;\r\n\r\n\t\t\t\t// TODO: derive visual load complete from interface rest state instead of arbitrary timer\r\n\t\t\t\tclearTimeout(loadTimer);\r\n\r\n\t\t\t\t$$invalidate(241, loadTimer = setTimeout(\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\tset_store_value(imageVisualLoadComplete, $imageVisualLoadComplete = true, $imageVisualLoadComplete);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tminLoaderDuration\r\n\t\t\t\t));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*isWaitingForImage*/ 512 | $$self.$$.dirty[8] & /*isImageLoadError*/ 16384 | $$self.$$.dirty[10] & /*$imageLoadState, $imageVisualLoadComplete*/ 5120) {\r\n\t\t\t$$invalidate(267, isLoadingImageData = $imageLoadState && !isImageLoadError && !isWaitingForImage && !$imageVisualLoadComplete);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[7] & /*imagePreviewLoaderCancelToken*/ 4194304 | $$self.$$.dirty[10] & /*$imagePreviewSource, $imagePreview*/ 8193) {\r\n\t\t\t// is creating a preview while an image source is set and the preview isn't ready or when a cancel token is found\r\n\t\t\t$$invalidate(266, isCreatingImagePreview = !!$imagePreviewSource && (!$imagePreview || !!imagePreviewLoaderCancelToken));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$imageProcessingPreparing, $imageProcessState*/ 2080) {\r\n\t\t\t//\r\n\t\t\t// processing status\r\n\t\t\t//\r\n\t\t\t$$invalidate(261, isProcessingImage = $imageProcessingPreparing || $imageProcessState && $imageProcessState.progress !== undefined && !$imageProcessState.complete);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*isWaitingForImage*/ 512 | $$self.$$.dirty[10] & /*$imageLoadState*/ 4096) {\r\n\t\t\t$$invalidate(264, imageLoadShowProgressIndicator = $imageLoadState && !($imageLoadState.error || isWaitingForImage));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*locale*/ 8 | $$self.$$.dirty[10] & /*$imageLoadState*/ 4096) {\r\n\t\t\t$$invalidate(265, imageLoadStatusLabel = locale && (!$imageLoadState\r\n\t\t\t? locale.statusLabelLoadImage($imageLoadState)\r\n\t\t\t: !$imageLoadState.complete || $imageLoadState.error\r\n\t\t\t\t? stringReplace(locale.statusLabelLoadImage($imageLoadState), $imageLoadState.error && $imageLoadState.error.metadata, '{', '}')\r\n\t\t\t\t: locale.statusLabelLoadImage({\r\n\t\t\t\t\t\tprogress: Infinity,\r\n\t\t\t\t\t\ttask: 'blob-to-bitmap'\r\n\t\t\t\t\t})));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*locale*/ 8 | $$self.$$.dirty[10] & /*$imageProcessState*/ 2048) {\r\n\t\t\t$$invalidate(260, imageProcessStatusLabel = $imageProcessState && locale && locale.statusLabelProcessImage($imageProcessState));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$imageProcessState*/ 2048) {\r\n\t\t\t$$invalidate(258, imageProcessProgress = $imageProcessState && ($imageProcessState.taskLengthComputable\r\n\t\t\t? $imageProcessState.taskProgress\r\n\t\t\t: Infinity));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$imageProcessState*/ 2048) {\r\n\t\t\t$$invalidate(259, imageProcessShowProgressIndicator = $imageProcessState && !$imageProcessState.error);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$imageProcessState*/ 2048) {\r\n\t\t\t$$invalidate(257, isImageProcessingError = $imageProcessState && $imageProcessState.error);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*locale*/ 8 | $$self.$$.dirty[1] & /*isWaitingForImage*/ 512 | $$self.$$.dirty[6] & /*status*/ 16384 | $$self.$$.dirty[8] & /*isImageLoadError, isLoadingImageData, isCreatingImagePreview, imageLoadStatusLabel, imageLoadShowProgressIndicator, imageLoadProgress, isProcessingImage, imageProcessStatusLabel, isImageProcessingError, imageProcessShowProgressIndicator, imageProcessProgress*/ 1048064) {\r\n\t\t\tif (status) {\r\n\t\t\t\tlet label;\r\n\t\t\t\tlet progress;\r\n\t\t\t\tlet showProgress;\r\n\t\t\t\tlet isError;\r\n\t\t\t\tlet errorCallback;\r\n\t\t\t\tif (isString(status)) label = status;\r\n\r\n\t\t\t\tif (isNumber(status)) progress = status; else if (Array.isArray(status)) {\r\n\t\t\t\t\t[label, progress, errorCallback] = status;\r\n\t\t\t\t\tif (progress === false) isError = true;\r\n\t\t\t\t\tif (isNumber(progress)) showProgress = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$$invalidate(33, statusState = (label || progress) && {\r\n\t\t\t\t\ttext: label,\r\n\t\t\t\t\taside: isError || showProgress,\r\n\t\t\t\t\tprogressIndicator: { visible: showProgress, progress },\r\n\t\t\t\t\tcloseButton: isError && {\r\n\t\t\t\t\t\tlabel: locale.statusLabelButtonClose,\r\n\t\t\t\t\t\ticon: locale.statusIconButtonClose,\r\n\t\t\t\t\t\tonclick: errorCallback || (() => $$invalidate(200, status = undefined))\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else if (locale && isWaitingForImage || isImageLoadError || isLoadingImageData || isCreatingImagePreview) {\r\n\t\t\t\t$$invalidate(33, statusState = {\r\n\t\t\t\t\ttext: imageLoadStatusLabel,\r\n\t\t\t\t\taside: isImageLoadError || imageLoadShowProgressIndicator,\r\n\t\t\t\t\tprogressIndicator: {\r\n\t\t\t\t\t\tvisible: imageLoadShowProgressIndicator,\r\n\t\t\t\t\t\tprogress: imageLoadProgress\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcloseButton: isImageLoadError && {\r\n\t\t\t\t\t\tlabel: locale.statusLabelButtonClose,\r\n\t\t\t\t\t\ticon: locale.statusIconButtonClose,\r\n\t\t\t\t\t\tonclick: handleCloseImageLoadError\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else if (locale && isProcessingImage && imageProcessStatusLabel) {\r\n\t\t\t\t$$invalidate(33, statusState = {\r\n\t\t\t\t\ttext: imageProcessStatusLabel,\r\n\t\t\t\t\taside: isImageProcessingError || imageProcessShowProgressIndicator,\r\n\t\t\t\t\tprogressIndicator: {\r\n\t\t\t\t\t\tvisible: imageProcessShowProgressIndicator,\r\n\t\t\t\t\t\tprogress: imageProcessProgress\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcloseButton: isImageProcessingError && {\r\n\t\t\t\t\t\tlabel: locale.statusLabelButtonClose,\r\n\t\t\t\t\t\ticon: locale.statusIconButtonClose,\r\n\t\t\t\t\t\tonclick: handleCloseImageProcessError\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t$$invalidate(33, statusState = undefined);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[6] & /*status*/ 16384) {\r\n\t\t\t$$invalidate(269, isCustomStatus = status !== undefined);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$isAnimated*/ 524288 | $$self.$$.dirty[8] & /*isModal*/ 32 | $$self.$$.dirty[10] & /*$imageProcessState*/ 2048) {\r\n\t\t\tif (isModal && $imageProcessState && $imageProcessState.complete) {\r\n\t\t\t\twasProcessingImage.set(true);\r\n\t\t\t\tsetTimeout(() => wasProcessingImage.set(false), $isAnimated ? 100 : 0);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*root*/ 4 | $$self.$$.dirty[1] & /*utilSelected*/ 1024 | $$self.$$.dirty[10] & /*$imageVisualLoadComplete*/ 1024) {\r\n\t\t\t$imageVisualLoadComplete && root && root.dispatchEvent(createPing('selectutil', utilSelected));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*isSupportsError, isWaitingForImage*/ 640 | $$self.$$.dirty[8] & /*isImageLoadError, isLoadingImageData, isCreatingImagePreview, isProcessingImage, isCustomStatus*/ 2908160 | $$self.$$.dirty[10] & /*$wasProcessingImage*/ 512) {\r\n\t\t\t$$invalidate(268, isStatusActive = $wasProcessingImage || isSupportsError || isWaitingForImage || isImageLoadError || isLoadingImageData || isCreatingImagePreview || isProcessingImage || isCustomStatus);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[8] & /*isStatusActive*/ 1048576) {\r\n\t\t\tset_store_value(statusOpacity, $statusOpacity = isStatusActive ? 1 : 0, $statusOpacity);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$isAnimated*/ 524288 | $$self.$$.dirty[8] & /*isStatusActive*/ 1048576) {\r\n\t\t\tstatusOpacity.set(isStatusActive ? 1 : 0, { duration: $isAnimated ? 500 : 1 });\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$statusOpacity*/ 1048576) {\r\n\t\t\t$$invalidate(39, isStatusVisible = $statusOpacity > 0);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*statusState*/ 4) {\r\n\t\t\t$$invalidate(256, hasAside = !!(statusState && statusState.aside));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*isStatusVisible, statusState, $isAnimated*/ 524548 | $$self.$$.dirty[7] & /*asideWidthUpdateTimer*/ 33554432 | $$self.$$.dirty[8] & /*hasAside*/ 256 | $$self.$$.dirty[10] & /*$statusWidth*/ 256) {\r\n\t\t\tif (isStatusVisible && statusState) {\r\n\t\t\t\tclearTimeout(asideWidthUpdateTimer);\r\n\t\t\t\tconst springProps = { hard: $isAnimated === false };\r\n\r\n\t\t\t\t// has aside\r\n\t\t\t\tif (hasAside) {\r\n\t\t\t\t\t// if error occured, or not animating, snap in possition\r\n\t\t\t\t\tconst hard = !!statusState.error || !$isAnimated;\r\n\r\n\t\t\t\t\tasideOpacity.set(1, springProps);\r\n\r\n\t\t\t\t\t// update offset of aside\r\n\t\t\t\t\tasideOffset.set($statusWidth, { hard });\r\n\r\n\t\t\t\t\t// update width of aside, this pushes message to left so it stays centered\r\n\t\t\t\t\t$$invalidate(242, asideWidthUpdateTimer = setTimeout(\r\n\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\tasideWidth.set(16, springProps);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t1\r\n\t\t\t\t\t));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tasideOpacity.set(0, springProps);\r\n\r\n\t\t\t\t\t$$invalidate(242, asideWidthUpdateTimer = setTimeout(\r\n\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\tasideWidth.set(0, springProps);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t1\r\n\t\t\t\t\t));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*isStatusVisible*/ 256) {\r\n\t\t\tif (!isStatusVisible) {\r\n\t\t\t\tstatusOffset.set(undefined, { hard: true });\r\n\t\t\t\tasideOffset.set(undefined, { hard: true });\r\n\t\t\t\tasideWidth.set(0, { hard: true });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$asideWidth*/ 128) {\r\n\t\t\t$$invalidate(255, statusIndent = $asideWidth * 0.5);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[8] & /*statusIndent*/ 128 | $$self.$$.dirty[10] & /*$statusOffset*/ 64) {\r\n\t\t\t$$invalidate(67, statusTransform = `transform: translateX(${$statusOffset - statusIndent}px)`);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*isSupportsError*/ 128 | $$self.$$.dirty[10] & /*$imagePreview*/ 1) {\r\n\t\t\t// ready bool\r\n\t\t\t$$invalidate(37, isReady = $imagePreview && !isSupportsError);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*isReady*/ 64 | $$self.$$.dirty[8] & /*needsInteractionLock, isModal*/ 96) {\r\n\t\t\t$$invalidate(252, preventTouchHandler = needsInteractionLock && (isReady || isModal)\r\n\t\t\t? preventDefault\r\n\t\t\t: noop$1);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[8] & /*preventTouchHandler*/ 16) {\r\n\t\t\t$$invalidate(66, handleTouchMove = preventTouchHandler);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[8] & /*preventTouchHandler*/ 16) {\r\n\t\t\t$$invalidate(65, handlePointerMove = preventTouchHandler);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*locale*/ 8 | $$self.$$.dirty[1] & /*$redrawTrigger*/ 262144 | $$self.$$.dirty[6] & /*willRenderToolbar, enableButtonRevert, enableButtonExport*/ 1744830464 | $$self.$$.dirty[7] & /*enableButtonClose, enableNavigateHistory*/ 5 | $$self.$$.dirty[8] & /*canUndo, canRedo, activeUtilTools, isNarrow*/ 15 | $$self.$$.dirty[10] & /*$env*/ 16) {\r\n\t\t\t// dynamic IO menu\r\n\t\t\t$$invalidate(64, toolbarItems = locale && $redrawTrigger && runSafe(() => willRenderToolbar(\r\n\t\t\t\t[\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t'div',\r\n\t\t\t\t\t\t'alpha',\r\n\t\t\t\t\t\t{ class: 'PinturaNavGroup' },\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t'div',\r\n\t\t\t\t\t\t\t\t'alpha-set',\r\n\t\t\t\t\t\t\t\t{ class: 'PinturaNavSet' },\r\n\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\t// button close\r\n\t\t\t\t\t\t\t\t\tenableButtonClose && [\r\n\t\t\t\t\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t\t\t\t\t'close',\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tlabel: locale.labelClose,\r\n\t\t\t\t\t\t\t\t\t\t\ticon: locale.iconButtonClose,\r\n\t\t\t\t\t\t\t\t\t\t\tonclick: () => dispatch('close'),\r\n\t\t\t\t\t\t\t\t\t\t\thideLabel: true\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t\t// button revert\r\n\t\t\t\t\t\t\t\t\tenableButtonRevert && [\r\n\t\t\t\t\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t\t\t\t\t'revert',\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tlabel: locale.labelButtonRevert,\r\n\t\t\t\t\t\t\t\t\t\t\ticon: locale.iconButtonRevert,\r\n\t\t\t\t\t\t\t\t\t\t\tdisabled: !canUndo,\r\n\t\t\t\t\t\t\t\t\t\t\tonclick: revert,\r\n\t\t\t\t\t\t\t\t\t\t\thideLabel: true\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t],\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t'div',\r\n\t\t\t\t\t\t'beta',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tclass: 'PinturaNavGroup PinturaNavGroupFloat'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\tenableNavigateHistory && [\r\n\t\t\t\t\t\t\t\t'div',\r\n\t\t\t\t\t\t\t\t'history',\r\n\t\t\t\t\t\t\t\t{ class: 'PinturaNavSet' },\r\n\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t\t\t\t\t'undo',\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tlabel: locale.labelButtonUndo,\r\n\t\t\t\t\t\t\t\t\t\t\ticon: locale.iconButtonUndo,\r\n\t\t\t\t\t\t\t\t\t\t\tdisabled: !canUndo,\r\n\t\t\t\t\t\t\t\t\t\t\tonclick: history.undo,\r\n\t\t\t\t\t\t\t\t\t\t\thideLabel: true\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t\t\t\t\t'redo',\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tlabel: locale.labelButtonRedo,\r\n\t\t\t\t\t\t\t\t\t\t\ticon: locale.iconButtonRedo,\r\n\t\t\t\t\t\t\t\t\t\t\tdisabled: !canRedo,\r\n\t\t\t\t\t\t\t\t\t\t\tonclick: history.redo,\r\n\t\t\t\t\t\t\t\t\t\t\thideLabel: true\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tactiveUtilTools.length && [\r\n\t\t\t\t\t\t\t\t'div',\r\n\t\t\t\t\t\t\t\t'plugin-tools',\r\n\t\t\t\t\t\t\t\t{ class: 'PinturaNavSet' },\r\n\t\t\t\t\t\t\t\tactiveUtilTools.filter(Boolean).map(// in\r\n\t\t\t\t\t\t\t\t([component, key, props]) => // out\r\n\t\t\t\t\t\t\t\t[component, key, { ...props }])\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t],\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t'div',\r\n\t\t\t\t\t\t'gamma',\r\n\t\t\t\t\t\t{ class: 'PinturaNavGroup' },\r\n\t\t\t\t\t\t[\r\n                            [\r\n\t\t\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t\t\t'select',\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tlabel: 'Select Image',\r\n\t\t\t\t\t\t\t\t\ticon: isNarrow && locale.iconButtonSelectImage,\r\n\t\t\t\t\t\t\t\t\tclass: 'PinturaButtonExport',\r\n\t\t\t\t\t\t\t\t\tonclick: browseFileSystem,\r\n\t\t\t\t\t\t\t\t\thideLabel: isNarrow\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tenableButtonExport && [\r\n\t\t\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t\t\t'export',\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tlabel: 'Download',\r\n\t\t\t\t\t\t\t\t\ticon: isNarrow && locale.iconButtonExport,\r\n\t\t\t\t\t\t\t\t\tclass: 'PinturaButtonExport',\r\n\t\t\t\t\t\t\t\t\tonclick: handleExport,\r\n\t\t\t\t\t\t\t\t\thideLabel: isNarrow\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t]\r\n\t\t\t\t],\r\n\t\t\t\t{ ...$env },\r\n\t\t\t\t() => redrawTrigger.set({})\r\n\t\t\t)));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$clientRect*/ 131072) {\r\n\t\t\t$$invalidate(247, hasClientRect = $clientRect && $clientRect.width > 0 && $clientRect.height > 0);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*locale*/ 8 | $$self.$$.dirty[7] & /*hasClientRect, utilsDefined*/ 1610612736) {\r\n\t\t\t$$invalidate(63, canRender = hasClientRect && locale && utilsDefined);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[10] & /*$imageRedaction*/ 2) {\r\n\t\t\t// toggles on/off depending on active redaction shapes\r\n\t\t\t$$invalidate(245, hasImageRedaction = $imageRedaction && !!$imageRedaction.length);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[7] & /*hasImageRedaction*/ 268435456 | $$self.$$.dirty[9] & /*$imageSize*/ 16777216 | $$self.$$.dirty[10] & /*$imageRedaction*/ 2) {\r\n\t\t\t// scales down resolution of scrambled image if redaction takes up more than half of view\r\n\t\t\t$$invalidate(244, imageRedactionScalar = hasImageRedaction && getImageRedactionScaleFactor($imageSize, $imageRedaction));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[7] & /*hasImageRedaction, imageRedactionScalar*/ 402653184 | $$self.$$.dirty[10] & /*$imagePreview, $imageScrambler, $imageBackgroundColor*/ 13) {\r\n\t\t\t// only update/render preview if image redaction shapes are found\r\n\t\t\thasImageRedaction && updateScrambledPreview($imagePreview, $imageScrambler, imageRedactionScalar, $imageBackgroundColor);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[7] & /*scrambledPreviewImage*/ 67108864 | $$self.$$.dirty[9] & /*$imageSize*/ 16777216 | $$self.$$.dirty[10] & /*$imageRedaction*/ 2) {\r\n\t\t\tif ($imageRedaction && scrambledPreviewImage && $imageSize) {\r\n\t\t\t\t// used to calculate fraction x y coordinates of shape corners\r\n\t\t\t\tconst { width, height } = $imageSize;\r\n\r\n\t\t\t\t// to blended shapes\r\n\t\t\t\t$$invalidate(34, blendShapes = $imageRedaction.map(shape => {\r\n\t\t\t\t\tconst rect = rectCreate(shape.x, shape.y, shape.width, shape.height);\r\n\t\t\t\t\tconst corners = rectRotate(rectClone$1(rect), shape.rotation);\r\n\t\t\t\t\tconst backgroundCorners = corners.map(corner => vectorCreate(corner.x / width, corner.y / height));\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...shape,\r\n\t\t\t\t\t\tid: 'redaction',\r\n\t\t\t\t\t\tflipX: false,\r\n\t\t\t\t\t\tflipY: false,\r\n\t\t\t\t\t\tcornerRadius: 0,\r\n\t\t\t\t\t\tstrokeWidth: 0,\r\n\t\t\t\t\t\tstrokeColor: undefined,\r\n\t\t\t\t\t\tbackgroundColor: [0, 0, 0],\r\n\t\t\t\t\t\tbackgroundImage: scrambledPreviewImage,\r\n\t\t\t\t\t\tbackgroundImageRendering: 'pixelated',\r\n\t\t\t\t\t\tbackgroundCorners\r\n\t\t\t\t\t};\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*rootPortal*/ 16) {\r\n\t\t\trootPortal && rootPortalStore.set(rootPortal);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*root*/ 4 | $$self.$$.dirty[1] & /*isReady*/ 64) {\r\n\t\t\t// now ready for interaction\r\n\t\t\tisReady && root.dispatchEvent(createPing('ready'));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$imageAnnotation*/ 65536) {\r\n\t\t\tmarkAnnotationShapesAsDirty();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[9] & /*$imageRotation, $imageFlipX, $imageFlipY, $imageSize*/ 251658240) {\r\n\t\t\tmarkAnnotationRequiresPreprocessing();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$imageDecoration*/ 32768) {\r\n\t\t\tmarkDecorationShapesAsDirty();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$imageFrame*/ 16384) {\r\n\t\t\tmarkFrameShapesAsDirty();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*blendShapes*/ 8) {\r\n\t\t\tmarkBlendShapesAsDirty();\r\n\t\t}\r\n\t};\r\n\r\n\t$$invalidate(301, supportsAnimations = !isSoftwareRendering());\r\n\r\n\timageTransformsSnapPixels = getDevicePixelRatio() === 1\r\n\t? transforms => {\r\n\t\t\tif (!transforms) return;\r\n\t\t\tvectorApply(transforms.origin, Math.round);\r\n\t\t\tvectorApply(transforms.translation, Math.round);\r\n\t\t}\r\n\t: passthrough;\r\n\r\n\t//\r\n\t// support test status\r\n\t//\r\n\t$$invalidate(271, missingFeatures = [!supportsWebGL() && 'WebGL'].filter(Boolean));\r\n\r\n\t// These are again needed since iOS 15 (was needed for 12 and lower, but  wasn't needed for 13, 14)\r\n\t// Now also needed for Firefox on Android\r\n\t$$invalidate(254, needsInteractionLock = isIOS() || isAndroid() && isFirefox());\r\n\r\n\t// used to route ping events\r\n\t$$invalidate(62, routePing = createPingRouter(eventProxy.pub));\r\n\r\n\treturn [\r\n\t\tzoomLevel,\r\n\t\tpluginInterface,\r\n\t\troot,\r\n\t\tlocale,\r\n\t\tid,\r\n\t\tpreviewMaskOpacity,\r\n\t\tmarkupMaskOpacity,\r\n\t\telasticityMultiplier,\r\n\t\twillRenderCanvas,\r\n\t\tenableToolbar,\r\n\t\tpreviewImageTextPixelRatio,\r\n\t\tmarkupEditorZoomLevels,\r\n\t\tmarkupEditorZoomAdjustStep,\r\n\t\tmarkupEditorZoomAdjustFactor,\r\n\t\tmarkupEditorZoomAdjustWheelFactor,\r\n\t\tenablePan,\r\n\t\tenableZoom,\r\n\t\tenableZoomInput,\r\n\t\tenableCanvasAlpha,\r\n\t\tenablePanLimit,\r\n\t\tpanLimitGutterScalar,\r\n\t\tzoomPresetOptions,\r\n\t\tzoomAdjustStep,\r\n\t\tzoomAdjustFactor,\r\n\t\tzoomAdjustWheelFactor,\r\n\t\tpluginOptions,\r\n\t\timageSourceToImageData,\r\n\t\timagePreview,\r\n\t\thistory,\r\n\t\twindowWidth,\r\n\t\twindowHeight,\r\n\t\tzoomControls,\r\n\t\tzoomMultiTouching,\r\n\t\tstatusState,\r\n\t\tblendShapes,\r\n\t\trootPortal,\r\n\t\tutilsVisibleFraction,\r\n\t\tisReady,\r\n\t\tisSupportsError,\r\n\t\tisStatusVisible,\r\n\t\tisWaitingForImage,\r\n\t\tutilSelected,\r\n\t\tshowUtils,\r\n\t\tshouldRenderTabs,\r\n\t\tutilsMerged,\r\n\t\t$imageFrame,\r\n\t\t$imageDecoration,\r\n\t\t$imageAnnotation,\r\n\t\t$clientRect,\r\n\t\t$redrawTrigger,\r\n\t\t$isAnimated,\r\n\t\t$statusOpacity,\r\n\t\t$activeImages,\r\n\t\t$rootBackgroundColor,\r\n\t\t$pixelRatio,\r\n\t\t$imageSelectionRectPresentation,\r\n\t\tutilsVisible,\r\n\t\timageAnnotationShapesDirty,\r\n\t\timageAnnotationRequiresPreprocessing,\r\n\t\timageDecorationShapesDirty,\r\n\t\timageFrameShapesDirty,\r\n\t\timageBlendShapesDirty,\r\n\t\troutePing,\r\n\t\tcanRender,\r\n\t\ttoolbarItems,\r\n\t\thandlePointerMove,\r\n\t\thandleTouchMove,\r\n\t\tstatusTransform,\r\n\t\timageCanvasState,\r\n\t\tenvStr,\r\n\t\tisLandscape,\r\n\t\tclassName,\r\n\t\tpanels,\r\n\t\ttabs,\r\n\t\ttabsConfig,\r\n\t\t$tabRect,\r\n\t\t$willRequest,\r\n\t\t$asideOffset,\r\n\t\t$asideOpacity,\r\n\t\t$toolRect,\r\n\t\t$imageCropLimitToImage,\r\n\t\t$interfaceImages,\r\n\t\t$willRequestResource,\r\n\t\t$imageOverlay,\r\n\t\t$allowPan,\r\n\t\t$enablePanInputStatus,\r\n\t\t$allowZoom,\r\n\t\t$enableZoomInputStore,\r\n\t\t$enableZoomControlsProp,\r\n\t\t$imageSelectionRectCentered,\r\n\t\t$imageSelectionRectScalar,\r\n\t\t$disabledTransition,\r\n\t\tredrawTrigger,\r\n\t\telasticityMultiplierStore,\r\n\t\tdisabledTransition,\r\n\t\timageFile,\r\n\t\timageSize,\r\n\t\tmediaDuration,\r\n\t\tmediaTrim,\r\n\t\timageLoadState,\r\n\t\timageProcessState,\r\n\t\timageCropAspectRatio,\r\n\t\timageCropLimitToImage,\r\n\t\timageCropRect,\r\n\t\timageRotation,\r\n\t\timageFlipX,\r\n\t\timageFlipY,\r\n\t\timageBackgroundColor,\r\n\t\timageDecoration,\r\n\t\timageAnnotation,\r\n\t\timageRedaction,\r\n\t\timageFrame,\r\n\t\timageState,\r\n\t\timages,\r\n\t\tshapePreprocessor,\r\n\t\timageScrambler,\r\n\t\twillRequest,\r\n\t\twillRequestResource,\r\n\t\tallowPan,\r\n\t\tallowZoom,\r\n\t\tenablePanInputStore,\r\n\t\tenableZoomInputStore,\r\n\t\tenableZoomControlsProp,\r\n\t\tenablePanInputProp,\r\n\t\tenablePanInputStatus,\r\n\t\trootBackgroundColor,\r\n\t\trootForegroundColor,\r\n\t\trootLineColor,\r\n\t\tclientRect,\r\n\t\trootRect,\r\n\t\ttabRect,\r\n\t\ttoolRect,\r\n\t\tutilRect,\r\n\t\tpointerAccuracy,\r\n\t\tpointerHoverable,\r\n\t\tisInteracting,\r\n\t\tisInteractingFraction,\r\n\t\tshouldAnimate,\r\n\t\tisAnimated,\r\n\t\tpreviewShouldUpscale,\r\n\t\timageIsStatic,\r\n\t\timageCropRectSnapshot,\r\n\t\timageCropRectIntent,\r\n\t\timageSelectionRect,\r\n\t\timageSelectionRectSnapshot,\r\n\t\timageSelectionRectIntent,\r\n\t\timageSelectionRectOffset,\r\n\t\tstagePadding,\r\n\t\tstagePadded,\r\n\t\tstageRect,\r\n\t\timageStaticBounds,\r\n\t\tstageScalar,\r\n\t\timageSelectionZoom,\r\n\t\timageSelectionRectScalar,\r\n\t\timageSelectionScalar,\r\n\t\timageSelectionPan,\r\n\t\timageSelectionRectPresentation,\r\n\t\timageSelectionRectStaticScalar,\r\n\t\timageSelectionRectCentered,\r\n\t\tpresentationScalar,\r\n\t\timageOverlayMarkup,\r\n\t\timageOverlay,\r\n\t\toverlayOpacity,\r\n\t\toverlayLeftRect,\r\n\t\toverlayTopRect,\r\n\t\toverlayRightRect,\r\n\t\toverlayBottomRect,\r\n\t\timageVisualLoadComplete,\r\n\t\timagePreviewSource,\r\n\t\timagePreviewModifiers,\r\n\t\tinterfaceImages,\r\n\t\timageTransforms,\r\n\t\tenv,\r\n\t\tpixelRatio,\r\n\t\timageProcessingPreparing,\r\n\t\tactiveImages,\r\n\t\tutilTools,\r\n\t\tutilStores,\r\n\t\thandleTransitionEnd,\r\n\t\timageProps,\r\n\t\tstatusOpacity,\r\n\t\twasProcessingImage,\r\n\t\tasideOffset,\r\n\t\tasideOpacity,\r\n\t\tasideWidth,\r\n\t\tstatusWidth,\r\n\t\tstatusOffset,\r\n\t\toffsetAside,\r\n\t\thandleTouchStart,\r\n\t\tpressedKeysStore,\r\n\t\thandleKeydown,\r\n\t\thandleKeyup,\r\n\t\thandleWindowBlur,\r\n\t\thandleContextMenu,\r\n\t\thandleDropFiles,\r\n\t\tbrowseFileSystem,\r\n\t\thandlePaste,\r\n\t\tgetStageState,\r\n\t\tcreateCanvasState,\r\n\t\thandleMeasureUtil,\r\n\t\tstatus,\r\n\t\timagePreviewCurrent,\r\n\t\tklass,\r\n\t\tlayoutMode,\r\n\t\tstores,\r\n\t\tutil,\r\n\t\tutils,\r\n\t\tanimations,\r\n\t\tdisabled,\r\n\t\tpreviewUpscale,\r\n\t\tpreviewPad,\r\n\t\twillRevert,\r\n\t\twillProcessImage,\r\n\t\twillRenderToolbar,\r\n\t\twillSetHistoryInitialState,\r\n\t\tenableButtonExport,\r\n\t\tenableButtonRevert,\r\n\t\tenableNavigateHistory,\r\n\t\tenableUtils,\r\n\t\tenableButtonClose,\r\n\t\tenableDropImage,\r\n\t\tenablePasteImage,\r\n\t\tenableBrowseImage,\r\n\t\tpreviewImageDataMaxSize,\r\n\t\tlayoutDirectionPreference,\r\n\t\tlayoutHorizontalUtilsPreference,\r\n\t\tlayoutVerticalUtilsPreference,\r\n\t\tlayoutVerticalToolbarPreference,\r\n\t\tlayoutVerticalControlGroupsPreference,\r\n\t\tlayoutVerticalControlTabsPreference,\r\n\t\tmarkupEditorZoomLevel,\r\n\t\tmarkupEditorInteractionMode,\r\n\t\tenableZoomControls,\r\n\t\tenablePanInput,\r\n\t\timagePreviewSrc,\r\n\t\timageOrienter,\r\n\t\tpluginComponents,\r\n\t\tsub,\r\n\t\tregisteredPluginsComponents,\r\n\t\timagePreviewLoaderCancelToken,\r\n\t\tlastImagePreview,\r\n\t\tloadTimer,\r\n\t\tasideWidthUpdateTimer,\r\n\t\tscrambledPreviewImage,\r\n\t\timageRedactionScalar,\r\n\t\thasImageRedaction,\r\n\t\tutilsDefined,\r\n\t\thasClientRect,\r\n\t\tisNarrow,\r\n\t\tactiveUtilTools,\r\n\t\tcanRedo,\r\n\t\tcanUndo,\r\n\t\tpreventTouchHandler,\r\n\t\tisModal,\r\n\t\tneedsInteractionLock,\r\n\t\tstatusIndent,\r\n\t\thasAside,\r\n\t\tisImageProcessingError,\r\n\t\timageProcessProgress,\r\n\t\timageProcessShowProgressIndicator,\r\n\t\timageProcessStatusLabel,\r\n\t\tisProcessingImage,\r\n\t\tisImageLoadError,\r\n\t\timageLoadProgress,\r\n\t\timageLoadShowProgressIndicator,\r\n\t\timageLoadStatusLabel,\r\n\t\tisCreatingImagePreview,\r\n\t\tisLoadingImageData,\r\n\t\tisStatusActive,\r\n\t\tisCustomStatus,\r\n\t\tisStartLoadingImageSource,\r\n\t\tmissingFeatures,\r\n\t\thasProps,\r\n\t\thasLimitedSpace,\r\n\t\thasSwipeNavigation,\r\n\t\tisCompact,\r\n\t\tisTransparent,\r\n\t\tisCenteredVertically,\r\n\t\tisCenteredHorizontally,\r\n\t\tisCentered,\r\n\t\ttoolbarVerticalPreference,\r\n\t\tcontrolTabsVerticalpreference,\r\n\t\tcontrolGroupsVerticalPreference,\r\n\t\tnavigationVerticalPreference,\r\n\t\tnavigationHorizontalPreference,\r\n\t\tverticalSpace,\r\n\t\thorizontalSpace,\r\n\t\torientation,\r\n\t\trootElementComputedStyle,\r\n\t\trootRectDefined,\r\n\t\tutilsFiltered,\r\n\t\tutilsAvailable,\r\n\t\tgradientOverlays,\r\n\t\toverlayLeft,\r\n\t\toverlayBottom,\r\n\t\toverlayRight,\r\n\t\toverlayTop,\r\n\t\toverlayOverlap,\r\n\t\toverlayMin,\r\n\t\tisOverlayModeEnabled,\r\n\t\tacceptsAnimations,\r\n\t\tsupportsAnimations,\r\n\t\tcanAnimate,\r\n\t\t$imageSize,\r\n\t\t$imageFlipY,\r\n\t\t$imageFlipX,\r\n\t\t$imageRotation,\r\n\t\t$stageRect,\r\n\t\t$rootRect,\r\n\t\t$isInteracting,\r\n\t\t$imagePreview,\r\n\t\t$imageRedaction,\r\n\t\t$imageBackgroundColor,\r\n\t\t$imageScrambler,\r\n\t\t$env,\r\n\t\t$imageProcessingPreparing,\r\n\t\t$statusOffset,\r\n\t\t$asideWidth,\r\n\t\t$statusWidth,\r\n\t\t$wasProcessingImage,\r\n\t\t$imageVisualLoadComplete,\r\n\t\t$imageProcessState,\r\n\t\t$imageLoadState,\r\n\t\t$imagePreviewSource,\r\n\t\t$imageProps,\r\n\t\t$imagePreviewModifiers,\r\n\t\t$imageTransforms,\r\n\t\t$pointerHoverable,\r\n\t\t$pointerAccuracy,\r\n\t\t$utilTools,\r\n\t\t$mediaDuration,\r\n\t\t$previewShouldUpscale,\r\n\t\t$history,\r\n\t\t$imageFile,\r\n\t\t$imageOverlayMarkup,\r\n\t\t$overlayBottomRect,\r\n\t\t$overlayOpacity,\r\n\t\t$overlayRightRect,\r\n\t\t$overlayTopRect,\r\n\t\t$overlayLeftRect,\r\n\t\t$stagePadding,\r\n\t\t$stagePadded,\r\n\t\t$imageCropRect,\r\n\t\t$imageStaticBounds,\r\n\t\t$imageSelectionPan,\r\n\t\t$imageSelectionZoom,\r\n\t\t$prefersReducedMotion,\r\n\t\t$shapePreprocessor,\r\n\t\t$images,\r\n\t\tonwindowresize,\r\n\t\tmeasure_handler,\r\n\t\tselect_handler,\r\n\t\tfunc,\r\n\t\tutilpanel_component_binding,\r\n\t\tshow_handler,\r\n\t\thide_handler,\r\n\t\tfade_handler,\r\n\t\tmeasure_handler_1,\r\n\t\tfunc_1,\r\n\t\tutilpanel_component_binding_1,\r\n\t\tshow_handler_1,\r\n\t\thide_handler_1,\r\n\t\tfade_handler_1,\r\n\t\tfunc_2,\r\n\t\tfunc_3,\r\n\t\tdiv_binding,\r\n\t\tcanvaspanandzoom_zoomLevel_binding,\r\n\t\tcanvaspanandzoom_zoomControls_binding,\r\n\t\tcanvaspanandzoom_zoomMultiTouching_binding,\r\n\t\tdiv_binding_1,\r\n\t\tmeasure_handler_2\r\n\t];\r\n}\r\n\r\nclass Ui extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$w,\r\n\t\t\tcreate_fragment$w,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tclass: 202,\r\n\t\t\t\tlayout: 203,\r\n\t\t\t\tstores: 204,\r\n\t\t\t\tlocale: 3,\r\n\t\t\t\tid: 4,\r\n\t\t\t\tutil: 205,\r\n\t\t\t\tutils: 206,\r\n\t\t\t\tanimations: 207,\r\n\t\t\t\tdisabled: 208,\r\n\t\t\t\tstatus: 200,\r\n\t\t\t\tpreviewUpscale: 209,\r\n\t\t\t\tpreviewPad: 210,\r\n\t\t\t\tpreviewMaskOpacity: 5,\r\n\t\t\t\tmarkupMaskOpacity: 6,\r\n\t\t\t\telasticityMultiplier: 7,\r\n\t\t\t\twillRevert: 211,\r\n\t\t\t\twillProcessImage: 212,\r\n\t\t\t\twillRenderCanvas: 8,\r\n\t\t\t\twillRenderToolbar: 213,\r\n\t\t\t\twillSetHistoryInitialState: 214,\r\n\t\t\t\tenableButtonExport: 215,\r\n\t\t\t\tenableButtonRevert: 216,\r\n\t\t\t\tenableNavigateHistory: 217,\r\n\t\t\t\tenableToolbar: 9,\r\n\t\t\t\tenableUtils: 218,\r\n\t\t\t\tenableButtonClose: 219,\r\n\t\t\t\tenableDropImage: 220,\r\n\t\t\t\tenablePasteImage: 221,\r\n\t\t\t\tenableBrowseImage: 222,\r\n\t\t\t\tpreviewImageDataMaxSize: 223,\r\n\t\t\t\tpreviewImageTextPixelRatio: 10,\r\n\t\t\t\tlayoutDirectionPreference: 224,\r\n\t\t\t\tlayoutHorizontalUtilsPreference: 225,\r\n\t\t\t\tlayoutVerticalUtilsPreference: 226,\r\n\t\t\t\tlayoutVerticalToolbarPreference: 227,\r\n\t\t\t\tlayoutVerticalControlGroupsPreference: 228,\r\n\t\t\t\tlayoutVerticalControlTabsPreference: 229,\r\n\t\t\t\tmarkupEditorZoomLevel: 230,\r\n\t\t\t\tmarkupEditorZoomLevels: 11,\r\n\t\t\t\tmarkupEditorZoomAdjustStep: 12,\r\n\t\t\t\tmarkupEditorZoomAdjustFactor: 13,\r\n\t\t\t\tmarkupEditorZoomAdjustWheelFactor: 14,\r\n\t\t\t\tmarkupEditorInteractionMode: 231,\r\n\t\t\t\tenablePan: 15,\r\n\t\t\t\tenableZoom: 16,\r\n\t\t\t\tenableZoomControls: 232,\r\n\t\t\t\tenableZoomInput: 17,\r\n\t\t\t\tenablePanInput: 233,\r\n\t\t\t\tenableCanvasAlpha: 18,\r\n\t\t\t\tenablePanLimit: 19,\r\n\t\t\t\tpanLimitGutterScalar: 20,\r\n\t\t\t\tzoomPresetOptions: 21,\r\n\t\t\t\tzoomAdjustStep: 22,\r\n\t\t\t\tzoomAdjustFactor: 23,\r\n\t\t\t\tzoomAdjustWheelFactor: 24,\r\n\t\t\t\tzoomLevel: 0,\r\n\t\t\t\timagePreviewSrc: 234,\r\n\t\t\t\timageOrienter: 235,\r\n\t\t\t\tpluginComponents: 236,\r\n\t\t\t\tpluginOptions: 25,\r\n\t\t\t\tsub: 237,\r\n\t\t\t\tpluginInterface: 1,\r\n\t\t\t\troot: 2,\r\n\t\t\t\timageSourceToImageData: 26,\r\n\t\t\t\timagePreview: 27,\r\n\t\t\t\timagePreviewCurrent: 201,\r\n\t\t\t\thistory: 28\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1]\r\n\t\t);\r\n\t}\r\n\r\n\tget class() {\r\n\t\treturn this.$$.ctx[202];\r\n\t}\r\n\r\n\tset class(klass) {\r\n\t\tthis.$$set({ class: klass });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget layout() {\r\n\t\treturn this.$$.ctx[203];\r\n\t}\r\n\r\n\tset layout(layoutMode) {\r\n\t\tthis.$$set({ layout: layoutMode });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stores() {\r\n\t\treturn this.$$.ctx[204];\r\n\t}\r\n\r\n\tset stores(stores) {\r\n\t\tthis.$$set({ stores });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget locale() {\r\n\t\treturn this.$$.ctx[3];\r\n\t}\r\n\r\n\tset locale(locale) {\r\n\t\tthis.$$set({ locale });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget id() {\r\n\t\treturn this.$$.ctx[4];\r\n\t}\r\n\r\n\tset id(id) {\r\n\t\tthis.$$set({ id });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget util() {\r\n\t\treturn this.$$.ctx[205];\r\n\t}\r\n\r\n\tset util(util) {\r\n\t\tthis.$$set({ util });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget utils() {\r\n\t\treturn this.$$.ctx[206];\r\n\t}\r\n\r\n\tset utils(utils) {\r\n\t\tthis.$$set({ utils });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget animations() {\r\n\t\treturn this.$$.ctx[207];\r\n\t}\r\n\r\n\tset animations(animations) {\r\n\t\tthis.$$set({ animations });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget disabled() {\r\n\t\treturn this.$$.ctx[208];\r\n\t}\r\n\r\n\tset disabled(disabled) {\r\n\t\tthis.$$set({ disabled });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget status() {\r\n\t\treturn this.$$.ctx[200];\r\n\t}\r\n\r\n\tset status(status) {\r\n\t\tthis.$$set({ status });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget previewUpscale() {\r\n\t\treturn this.$$.ctx[209];\r\n\t}\r\n\r\n\tset previewUpscale(previewUpscale) {\r\n\t\tthis.$$set({ previewUpscale });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget previewPad() {\r\n\t\treturn this.$$.ctx[210];\r\n\t}\r\n\r\n\tset previewPad(previewPad) {\r\n\t\tthis.$$set({ previewPad });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget previewMaskOpacity() {\r\n\t\treturn this.$$.ctx[5];\r\n\t}\r\n\r\n\tset previewMaskOpacity(previewMaskOpacity) {\r\n\t\tthis.$$set({ previewMaskOpacity });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupMaskOpacity() {\r\n\t\treturn this.$$.ctx[6];\r\n\t}\r\n\r\n\tset markupMaskOpacity(markupMaskOpacity) {\r\n\t\tthis.$$set({ markupMaskOpacity });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget elasticityMultiplier() {\r\n\t\treturn this.$$.ctx[7];\r\n\t}\r\n\r\n\tset elasticityMultiplier(elasticityMultiplier) {\r\n\t\tthis.$$set({ elasticityMultiplier });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget willRevert() {\r\n\t\treturn this.$$.ctx[211];\r\n\t}\r\n\r\n\tset willRevert(willRevert) {\r\n\t\tthis.$$set({ willRevert });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget willProcessImage() {\r\n\t\treturn this.$$.ctx[212];\r\n\t}\r\n\r\n\tset willProcessImage(willProcessImage) {\r\n\t\tthis.$$set({ willProcessImage });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget willRenderCanvas() {\r\n\t\treturn this.$$.ctx[8];\r\n\t}\r\n\r\n\tset willRenderCanvas(willRenderCanvas) {\r\n\t\tthis.$$set({ willRenderCanvas });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget willRenderToolbar() {\r\n\t\treturn this.$$.ctx[213];\r\n\t}\r\n\r\n\tset willRenderToolbar(willRenderToolbar) {\r\n\t\tthis.$$set({ willRenderToolbar });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget willSetHistoryInitialState() {\r\n\t\treturn this.$$.ctx[214];\r\n\t}\r\n\r\n\tset willSetHistoryInitialState(willSetHistoryInitialState) {\r\n\t\tthis.$$set({ willSetHistoryInitialState });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableButtonExport() {\r\n\t\treturn this.$$.ctx[215];\r\n\t}\r\n\r\n\tset enableButtonExport(enableButtonExport) {\r\n\t\tthis.$$set({ enableButtonExport });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableButtonRevert() {\r\n\t\treturn this.$$.ctx[216];\r\n\t}\r\n\r\n\tset enableButtonRevert(enableButtonRevert) {\r\n\t\tthis.$$set({ enableButtonRevert });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableNavigateHistory() {\r\n\t\treturn this.$$.ctx[217];\r\n\t}\r\n\r\n\tset enableNavigateHistory(enableNavigateHistory) {\r\n\t\tthis.$$set({ enableNavigateHistory });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableToolbar() {\r\n\t\treturn this.$$.ctx[9];\r\n\t}\r\n\r\n\tset enableToolbar(enableToolbar) {\r\n\t\tthis.$$set({ enableToolbar });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableUtils() {\r\n\t\treturn this.$$.ctx[218];\r\n\t}\r\n\r\n\tset enableUtils(enableUtils) {\r\n\t\tthis.$$set({ enableUtils });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableButtonClose() {\r\n\t\treturn this.$$.ctx[219];\r\n\t}\r\n\r\n\tset enableButtonClose(enableButtonClose) {\r\n\t\tthis.$$set({ enableButtonClose });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableDropImage() {\r\n\t\treturn this.$$.ctx[220];\r\n\t}\r\n\r\n\tset enableDropImage(enableDropImage) {\r\n\t\tthis.$$set({ enableDropImage });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enablePasteImage() {\r\n\t\treturn this.$$.ctx[221];\r\n\t}\r\n\r\n\tset enablePasteImage(enablePasteImage) {\r\n\t\tthis.$$set({ enablePasteImage });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableBrowseImage() {\r\n\t\treturn this.$$.ctx[222];\r\n\t}\r\n\r\n\tset enableBrowseImage(enableBrowseImage) {\r\n\t\tthis.$$set({ enableBrowseImage });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget previewImageDataMaxSize() {\r\n\t\treturn this.$$.ctx[223];\r\n\t}\r\n\r\n\tset previewImageDataMaxSize(previewImageDataMaxSize) {\r\n\t\tthis.$$set({ previewImageDataMaxSize });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget previewImageTextPixelRatio() {\r\n\t\treturn this.$$.ctx[10];\r\n\t}\r\n\r\n\tset previewImageTextPixelRatio(previewImageTextPixelRatio) {\r\n\t\tthis.$$set({ previewImageTextPixelRatio });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget layoutDirectionPreference() {\r\n\t\treturn this.$$.ctx[224];\r\n\t}\r\n\r\n\tset layoutDirectionPreference(layoutDirectionPreference) {\r\n\t\tthis.$$set({ layoutDirectionPreference });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget layoutHorizontalUtilsPreference() {\r\n\t\treturn this.$$.ctx[225];\r\n\t}\r\n\r\n\tset layoutHorizontalUtilsPreference(layoutHorizontalUtilsPreference) {\r\n\t\tthis.$$set({ layoutHorizontalUtilsPreference });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget layoutVerticalUtilsPreference() {\r\n\t\treturn this.$$.ctx[226];\r\n\t}\r\n\r\n\tset layoutVerticalUtilsPreference(layoutVerticalUtilsPreference) {\r\n\t\tthis.$$set({ layoutVerticalUtilsPreference });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget layoutVerticalToolbarPreference() {\r\n\t\treturn this.$$.ctx[227];\r\n\t}\r\n\r\n\tset layoutVerticalToolbarPreference(layoutVerticalToolbarPreference) {\r\n\t\tthis.$$set({ layoutVerticalToolbarPreference });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget layoutVerticalControlGroupsPreference() {\r\n\t\treturn this.$$.ctx[228];\r\n\t}\r\n\r\n\tset layoutVerticalControlGroupsPreference(layoutVerticalControlGroupsPreference) {\r\n\t\tthis.$$set({ layoutVerticalControlGroupsPreference });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget layoutVerticalControlTabsPreference() {\r\n\t\treturn this.$$.ctx[229];\r\n\t}\r\n\r\n\tset layoutVerticalControlTabsPreference(layoutVerticalControlTabsPreference) {\r\n\t\tthis.$$set({ layoutVerticalControlTabsPreference });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorZoomLevel() {\r\n\t\treturn this.$$.ctx[230];\r\n\t}\r\n\r\n\tset markupEditorZoomLevel(markupEditorZoomLevel) {\r\n\t\tthis.$$set({ markupEditorZoomLevel });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorZoomLevels() {\r\n\t\treturn this.$$.ctx[11];\r\n\t}\r\n\r\n\tset markupEditorZoomLevels(markupEditorZoomLevels) {\r\n\t\tthis.$$set({ markupEditorZoomLevels });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorZoomAdjustStep() {\r\n\t\treturn this.$$.ctx[12];\r\n\t}\r\n\r\n\tset markupEditorZoomAdjustStep(markupEditorZoomAdjustStep) {\r\n\t\tthis.$$set({ markupEditorZoomAdjustStep });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorZoomAdjustFactor() {\r\n\t\treturn this.$$.ctx[13];\r\n\t}\r\n\r\n\tset markupEditorZoomAdjustFactor(markupEditorZoomAdjustFactor) {\r\n\t\tthis.$$set({ markupEditorZoomAdjustFactor });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorZoomAdjustWheelFactor() {\r\n\t\treturn this.$$.ctx[14];\r\n\t}\r\n\r\n\tset markupEditorZoomAdjustWheelFactor(markupEditorZoomAdjustWheelFactor) {\r\n\t\tthis.$$set({ markupEditorZoomAdjustWheelFactor });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorInteractionMode() {\r\n\t\treturn this.$$.ctx[231];\r\n\t}\r\n\r\n\tset markupEditorInteractionMode(markupEditorInteractionMode) {\r\n\t\tthis.$$set({ markupEditorInteractionMode });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enablePan() {\r\n\t\treturn this.$$.ctx[15];\r\n\t}\r\n\r\n\tset enablePan(enablePan) {\r\n\t\tthis.$$set({ enablePan });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableZoom() {\r\n\t\treturn this.$$.ctx[16];\r\n\t}\r\n\r\n\tset enableZoom(enableZoom) {\r\n\t\tthis.$$set({ enableZoom });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableZoomControls() {\r\n\t\treturn this.$$.ctx[232];\r\n\t}\r\n\r\n\tset enableZoomControls(enableZoomControls) {\r\n\t\tthis.$$set({ enableZoomControls });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableZoomInput() {\r\n\t\treturn this.$$.ctx[17];\r\n\t}\r\n\r\n\tset enableZoomInput(enableZoomInput) {\r\n\t\tthis.$$set({ enableZoomInput });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enablePanInput() {\r\n\t\treturn this.$$.ctx[233];\r\n\t}\r\n\r\n\tset enablePanInput(enablePanInput) {\r\n\t\tthis.$$set({ enablePanInput });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableCanvasAlpha() {\r\n\t\treturn this.$$.ctx[18];\r\n\t}\r\n\r\n\tset enableCanvasAlpha(enableCanvasAlpha) {\r\n\t\tthis.$$set({ enableCanvasAlpha });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enablePanLimit() {\r\n\t\treturn this.$$.ctx[19];\r\n\t}\r\n\r\n\tset enablePanLimit(enablePanLimit) {\r\n\t\tthis.$$set({ enablePanLimit });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget panLimitGutterScalar() {\r\n\t\treturn this.$$.ctx[20];\r\n\t}\r\n\r\n\tset panLimitGutterScalar(panLimitGutterScalar) {\r\n\t\tthis.$$set({ panLimitGutterScalar });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget zoomPresetOptions() {\r\n\t\treturn this.$$.ctx[21];\r\n\t}\r\n\r\n\tset zoomPresetOptions(zoomPresetOptions) {\r\n\t\tthis.$$set({ zoomPresetOptions });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget zoomAdjustStep() {\r\n\t\treturn this.$$.ctx[22];\r\n\t}\r\n\r\n\tset zoomAdjustStep(zoomAdjustStep) {\r\n\t\tthis.$$set({ zoomAdjustStep });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget zoomAdjustFactor() {\r\n\t\treturn this.$$.ctx[23];\r\n\t}\r\n\r\n\tset zoomAdjustFactor(zoomAdjustFactor) {\r\n\t\tthis.$$set({ zoomAdjustFactor });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget zoomAdjustWheelFactor() {\r\n\t\treturn this.$$.ctx[24];\r\n\t}\r\n\r\n\tset zoomAdjustWheelFactor(zoomAdjustWheelFactor) {\r\n\t\tthis.$$set({ zoomAdjustWheelFactor });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget zoomLevel() {\r\n\t\treturn this.$$.ctx[0];\r\n\t}\r\n\r\n\tset zoomLevel(zoomLevel) {\r\n\t\tthis.$$set({ zoomLevel });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget imagePreviewSrc() {\r\n\t\treturn this.$$.ctx[234];\r\n\t}\r\n\r\n\tset imagePreviewSrc(imagePreviewSrc) {\r\n\t\tthis.$$set({ imagePreviewSrc });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget imageOrienter() {\r\n\t\treturn this.$$.ctx[235];\r\n\t}\r\n\r\n\tset imageOrienter(imageOrienter) {\r\n\t\tthis.$$set({ imageOrienter });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget pluginComponents() {\r\n\t\treturn this.$$.ctx[236];\r\n\t}\r\n\r\n\tset pluginComponents(pluginComponents) {\r\n\t\tthis.$$set({ pluginComponents });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget pluginOptions() {\r\n\t\treturn this.$$.ctx[25];\r\n\t}\r\n\r\n\tset pluginOptions(pluginOptions) {\r\n\t\tthis.$$set({ pluginOptions });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget sub() {\r\n\t\treturn this.$$.ctx[237];\r\n\t}\r\n\r\n\tget pluginInterface() {\r\n\t\treturn this.$$.ctx[1];\r\n\t}\r\n\r\n\tget root() {\r\n\t\treturn this.$$.ctx[2];\r\n\t}\r\n\r\n\tset root(root) {\r\n\t\tthis.$$set({ root });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget imageSourceToImageData() {\r\n\t\treturn this.$$.ctx[26];\r\n\t}\r\n\r\n\tset imageSourceToImageData(imageSourceToImageData) {\r\n\t\tthis.$$set({ imageSourceToImageData });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget imagePreview() {\r\n\t\treturn this.$$.ctx[27];\r\n\t}\r\n\r\n\tget imagePreviewCurrent() {\r\n\t\treturn this.$$.ctx[201];\r\n\t}\r\n\r\n\tset imagePreviewCurrent(imagePreviewCurrent) {\r\n\t\tthis.$$set({ imagePreviewCurrent });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget history() {\r\n\t\treturn this.$$.ctx[28];\r\n\t}\r\n}\r\n\r\n// which props to filter out of exported props\r\nconst utilPrivateProps = ['klass', 'stores', 'isVisible', 'isActive', 'isActiveFraction', 'locale'];\r\nconst viewPrivateProps = [\r\n    // methods\r\n    'history',\r\n    // props\r\n    'klass',\r\n    'stores',\r\n    'navButtons',\r\n    'pluginComponents',\r\n    'pluginInterface',\r\n    'pluginOptions',\r\n    'sub',\r\n    'imagePreviewSrc',\r\n    'imagePreview',\r\n    'imagePreviewCurrent',\r\n];\r\n// properties that should be merged with current value if set\r\nconst mergeProps = ['locale'];\r\n// view options array\r\nlet editorProps;\r\nconst pluginProps = new Set([]);\r\nconst propPluginRef = {};\r\n// loops over plugins and registers all available options so we can define getters/setters\r\nconst pluginComponents = new Map();\r\nconst setEditorViewPlugins = (...args) => {\r\n    args\r\n        // remove invalid plugins\r\n        .filter((plugin) => !!plugin.util)\r\n        // register valid plugins\r\n        .forEach((plugin) => {\r\n        const [id, Component, isSupported = () => true] = plugin.util;\r\n        // already set\r\n        if (pluginComponents.has(id))\r\n            return;\r\n        // store\r\n        pluginComponents.set(id, { Component, isSupported });\r\n        // get props\r\n        getComponentExportedProps(Component)\r\n            .filter((prop) => !utilPrivateProps.includes(prop))\r\n            .forEach((prop) => {\r\n            pluginProps.add(prop);\r\n            if (propPluginRef[prop]) {\r\n                propPluginRef[prop].push(id);\r\n                return;\r\n            }\r\n            propPluginRef[prop] = [id];\r\n        });\r\n    });\r\n};\r\nconst getEditorViewProps = () => {\r\n    editorProps = new Set(getComponentExportedProps(Ui).filter((prop) => !viewPrivateProps.includes(prop)));\r\n    return [...editorProps, ...pluginProps];\r\n};\r\nconst attachEditorView = (target, stores) => {\r\n    const accessors = {};\r\n    // creates the editor component instance\r\n    const editor = new Ui({\r\n        target,\r\n        props: {\r\n            stores,\r\n            pluginComponents: Array.from(pluginComponents),\r\n        },\r\n    });\r\n    // destroys the editor component instance\r\n    let isDestroyed = false;\r\n    const destroy = () => {\r\n        if (isDestroyed)\r\n            return;\r\n        if (isBrowser())\r\n            window.removeEventListener('pagehide', destroy);\r\n        if (!editor)\r\n            return;\r\n        isDestroyed = true;\r\n        editor.$destroy();\r\n    };\r\n    // set up accessors for editor props\r\n    if (!editorProps)\r\n        editorProps = new Set(getComponentExportedProps(Ui).filter((prop) => !viewPrivateProps.includes(prop)));\r\n    editorProps.forEach((prop) => {\r\n        Object.defineProperty(accessors, prop, {\r\n            get: () => editor[prop],\r\n            set: mergeProps.includes(prop)\r\n                ? // merge new value with existing value\r\n                    (value) => {\r\n                        editor[prop] = {\r\n                            ...editor[prop],\r\n                            ...value,\r\n                        };\r\n                    }\r\n                : // overwrite current value\r\n                    (value) => (editor[prop] = value),\r\n        });\r\n    });\r\n    // this reads the imagePreview store so third parties can interact with image data\r\n    Object.defineProperty(accessors, 'previewImageData', {\r\n        get: () => editor.imagePreviewCurrent,\r\n    });\r\n    // set up accessors for plugin props\r\n    pluginProps.forEach((prop) => {\r\n        const plugins = propPluginRef[prop];\r\n        const plugin = plugins[0]; // will always get value from first plugin, when plugins share a property the value will be in sync when set\r\n        Object.defineProperty(accessors, prop, {\r\n            get: () => editor.pluginInterface[plugin][prop],\r\n            set: (value) => {\r\n                const opts = plugins.reduce((prev, plugin) => {\r\n                    prev[plugin] = {\r\n                        ...editor.pluginOptions[plugin],\r\n                        [prop]: value,\r\n                    };\r\n                    return prev;\r\n                }, {});\r\n                editor.pluginOptions = {\r\n                    ...editor.pluginOptions,\r\n                    ...opts,\r\n                };\r\n            },\r\n        });\r\n    });\r\n    // add `element` root query\r\n    Object.defineProperty(accessors, 'element', {\r\n        get: () => editor.root,\r\n        set: () => undefined,\r\n    });\r\n    // history shortcut\r\n    const history = editor.history;\r\n    defineMethods(accessors, {\r\n        on: (event, cb) => {\r\n            // exit if editor was destroyed, will return stub function so unsubs can be called without issues\r\n            if (isDestroyed)\r\n                return () => {\r\n                    // Do nothing\r\n                };\r\n            // catch history events and route to history object\r\n            if (/undo|redo|revert/.test(event))\r\n                return history.on(event, cb);\r\n            // gather unsub methods\r\n            const unsubs = [\r\n                editor.sub(event, cb),\r\n                editor.$on(event, (e) => cb(e instanceof CustomEvent && !e.detail ? undefined : e)),\r\n            ].filter(Boolean);\r\n            // set up unsubscribe group\r\n            return () => unsubs.forEach((unsub) => unsub());\r\n        },\r\n        updateImagePreview: (src) => {\r\n            editor.imagePreviewSrc = src;\r\n        },\r\n        close: () => !isDestroyed && editor.pub('close'),\r\n        destroy,\r\n    });\r\n    Object.defineProperty(accessors, 'history', {\r\n        get: () => ({\r\n            undo: () => history.undo(),\r\n            redo: () => history.redo(),\r\n            revert: () => history.revert(),\r\n            get: () => history.get(),\r\n            getCollapsed: () => {\r\n                const entries = history.get();\r\n                return entries.splice(0, history.index + 1);\r\n            },\r\n            set: (entries) => history.set(entries),\r\n            write: (state) => history.write(state),\r\n            get length() {\r\n                return history.length();\r\n            },\r\n            get index() {\r\n                return history.index;\r\n            },\r\n        }),\r\n    });\r\n    // clean up on window unload\r\n    if (isBrowser())\r\n        window.addEventListener('pagehide', destroy);\r\n    return accessors;\r\n};\r\n\r\nvar editorEvents = [\r\n    // core editor events that should be re-dispatched\r\n    ...editorEventsToBubble,\r\n    // ui editor events\r\n    'init',\r\n    'undo',\r\n    'redo',\r\n    'update',\r\n    'revert',\r\n    'destroy',\r\n    'show',\r\n    'hide',\r\n    'close',\r\n    'ready',\r\n    'zoom',\r\n    'pan',\r\n    'loadpreview',\r\n    'selectshape',\r\n    'updateshape',\r\n    'addshape',\r\n    'removeshape',\r\n    'selectstyle',\r\n    'markuptap',\r\n    'markupzoom',\r\n    'markuppan',\r\n    'selectutil',\r\n    'selectcontrol',\r\n];\r\n\r\nconst dispatchElementEvent = (target, event, detail) => target.dispatchEvent(new CustomEvent(event, { detail, bubbles: true, cancelable: true }));\r\nvar dispatchEditorEvents = (editor, handler, options = {}) => {\r\n    const { prefix = 'pintura:' } = options;\r\n    return editorEvents.map((event) => editor.on(event, (value) => isElement(handler)\r\n        ? dispatchElementEvent(handler, `${prefix}${event}`, value)\r\n        : handler(event, value)));\r\n};\r\n\r\nvar naturalAspectRatioToNumber = (value) => {\r\n    // already valid value\r\n    if (value === undefined || isNumber(value))\r\n        return value;\r\n    // invalid\r\n    if (!isString(value))\r\n        return false;\r\n    // convert string to aspect ratio fraction\r\n    const str = value;\r\n    // we interpret empty string as undefined\r\n    if (!str.length)\r\n        return undefined;\r\n    // get numbers\r\n    const [w, h] = str\r\n        .split(/\\/|:/g)\r\n        .map((value) => parseFloat(value.replace(/,/, '.')))\r\n        .filter(Boolean);\r\n    // invalid\r\n    if (!w)\r\n        return false;\r\n    // single value received\r\n    if (!h)\r\n        return w;\r\n    // lets convert to fraction\r\n    return Math.abs(w / h);\r\n};\r\n\r\nvar arrayInsert = (array, index, item) => {\r\n    array.splice(index, 0, item);\r\n    return array;\r\n};\r\n\r\n// first index is always id, so if is string, it's a node\r\nconst isNode = (item) => isString(item[0]);\r\n// if it's not a node, it's a nodelist\r\nconst isNodeList = (item) => !isNode(item);\r\nconst getNodeId = (node) => node[1];\r\nconst getNodeChildren = (node) => node[3] || [];\r\nfunction createNode(instance, id, props, children) {\r\n    // if three arguments received, props can be children\r\n    if (Array.isArray(props)) {\r\n        children = props;\r\n        props = {};\r\n    }\r\n    // node is always array of four entries\r\n    return [instance, id, props || {}, children || []];\r\n}\r\nconst insertNode = (node, needle, haystack, getIndex = (index) => index) => {\r\n    const nodeList = findNodeList(needle, haystack);\r\n    const targetIndex = nodeList.findIndex((item) => getNodeId(item) === needle);\r\n    arrayInsert(nodeList, getIndex(targetIndex), node);\r\n};\r\nconst insertNodeBefore = (node, needle, haystack) => insertNode(node, needle, haystack);\r\nconst insertNodeAfter = (node, needle, haystack) => insertNode(node, needle, haystack, (index) => index + 1);\r\nconst appendNode = (node, haystack) => {\r\n    // if is list, add to list\r\n    if (isNodeList(haystack))\r\n        return haystack.push(node);\r\n    // else it's a node, add to node children\r\n    haystack[3] = [...getNodeChildren(haystack), node];\r\n};\r\nconst removeNode = (needle, haystack) => {\r\n    const nodeList = findNodeList(needle, haystack);\r\n    arrayRemove(nodeList, (item) => getNodeId(item) === needle);\r\n    return nodeList;\r\n};\r\nconst findNode = (needle, haystack) => {\r\n    if (!haystack)\r\n        return;\r\n    return isNode(haystack)\r\n        ? // haystack is a node, maybe node is a match or one of children is a match\r\n            getNodeId(haystack) === needle\r\n                ? haystack\r\n                : findNode(needle, getNodeChildren(haystack))\r\n        : // haystack is a list of nodes\r\n            Array.isArray(haystack)\r\n                ? haystack.find((item) => findNode(needle, item))\r\n                : undefined;\r\n};\r\nconst findNodeList = (needle, haystack) => {\r\n    // haystack is node list\r\n    if (isNodeList(haystack)) {\r\n        // lets search nodes in this haystack\r\n        if (haystack.find((item) => getNodeId(item) === needle))\r\n            return haystack;\r\n        // not found, lets move the search to the childnodes\r\n        return haystack.find((item) => findNodeList(needle, getNodeChildren(item)));\r\n    }\r\n    // is node, lets find in children\r\n    return findNodeList(needle, getNodeChildren(haystack));\r\n};\r\n\r\n//#region markup\r\nconst propertyMap = {\r\n    borderColor: 'strokeColor',\r\n    borderWidth: 'strokeWidth',\r\n    lineWidth: 'strokeWidth',\r\n    fontColor: 'color',\r\n    lineColor: 'strokeColor',\r\n    src: 'backgroundImage',\r\n    fit: 'backgroundSize',\r\n};\r\nconst convertValue = (value) => {\r\n    if (value === 0)\r\n        return 0;\r\n    if (value === '0%')\r\n        return 0;\r\n    if (value === '0px')\r\n        return 0;\r\n    if (/px$/.test(value))\r\n        return parseInt(value, 10);\r\n    if (/\\%$/.test(value))\r\n        return value;\r\n    if (value <= 1)\r\n        return `${value * 100}%`;\r\n};\r\nconst addValues = (a, b) => {\r\n    let _a, _b;\r\n    if (/%$/.test(a)) {\r\n        _a = parseFloat(a);\r\n        _b = parseFloat(b);\r\n        return `${_a + _b}%`;\r\n    }\r\n    if (/px$/.test(a)) {\r\n        _a = parseInt(a, 10);\r\n        _b = parseInt(b, 10);\r\n        return `${_a + _b}px`;\r\n    }\r\n};\r\nconst shapeFromLegacyMarkup = (crop, type, style) => {\r\n    const shape = Object.keys(style).reduce((res, prop) => {\r\n        let value = style[prop];\r\n        // rename prop\r\n        prop = propertyMap[prop] || prop;\r\n        // if is px value\r\n        if (/px$/.test(value)) {\r\n            value = convertValue(value);\r\n        }\r\n        // if is number convert to percentage\r\n        else if (/^(?:x|y|left|right|top|bottom|width|height|fontSize|strokeWidth)$/.test(prop) &&\r\n            typeof value === 'number') {\r\n            if (/strokeWidth/.test(prop))\r\n                value *= 2;\r\n            value = convertValue(value);\r\n        }\r\n        // if is color value\r\n        if (/color/i.test(prop)) {\r\n            value = colorStringToColorArray(value);\r\n        }\r\n        if (value === null)\r\n            value = undefined;\r\n        res[prop] = value;\r\n        return res;\r\n    }, {});\r\n    if (type === 'line') {\r\n        if (shape.lineDecoration.length === 1)\r\n            shape.lineEnd = 'arrow';\r\n        if (shape.lineDecoration.length === 2)\r\n            shape.lineStart = 'arrow';\r\n        shape.x1 = shape.x;\r\n        shape.y1 = shape.y;\r\n        shape.x2 = addValues(shape.x, shape.width);\r\n        shape.y2 = addValues(shape.y, shape.height);\r\n        delete shape.x;\r\n        delete shape.y;\r\n        delete shape.width;\r\n        delete shape.height;\r\n        delete shape.lineDecoration;\r\n        delete shape.lineStyle;\r\n    }\r\n    if (type === 'text') {\r\n        shape.y = addValues(shape.y, '-' + shape.fontSize);\r\n        delete shape.width;\r\n        delete shape.height;\r\n        delete shape.borderStyle;\r\n    }\r\n    if (type === 'ellipse') {\r\n        let w, h;\r\n        // calculate `rx` and `ry` based on `width` and `h`eight`\r\n        if (/%$/.test(shape.width)) {\r\n            w = parseFloat(shape.width) / 100;\r\n            h = parseFloat(shape.height) / 100;\r\n            const widthAbsolute = w * crop.width;\r\n            const heightAbsolute = h * crop.height;\r\n            w = (widthAbsolute / crop.width) * 100;\r\n            h = (heightAbsolute / crop.height) * 100;\r\n        }\r\n        else {\r\n            w = shape.width;\r\n            h = shape.height;\r\n        }\r\n        shape.rx = w * 0.5;\r\n        shape.ry = h * 0.5;\r\n        if (/%$/.test(shape.width)) {\r\n            shape.rx += '%';\r\n            shape.ry += '%';\r\n        }\r\n        shape.x = addValues(shape.x, shape.rx);\r\n        shape.y = addValues(shape.y, shape.ry);\r\n        delete shape.width;\r\n        delete shape.height;\r\n        delete shape.borderStyle;\r\n    }\r\n    if (type === 'rect') {\r\n        delete shape.borderStyle;\r\n    }\r\n    if (type === 'path') {\r\n        shape.points = shape.points.map((point) => {\r\n            return {\r\n                x: convertValue(point.x),\r\n                y: convertValue(point.y),\r\n            };\r\n        });\r\n    }\r\n    return shape;\r\n};\r\n//#endregion\r\n//#region crop\r\nconst getOffsetPointOnEdge = (length, rotation) => {\r\n    const a = length;\r\n    const A = 1.5707963267948966;\r\n    const B = rotation;\r\n    const C = 1.5707963267948966 - rotation;\r\n    const sinA = Math.sin(A);\r\n    const sinB = Math.sin(B);\r\n    const sinC = Math.sin(C);\r\n    const cosC = Math.cos(C);\r\n    const ratio = a / sinA;\r\n    const b = ratio * sinB;\r\n    const c = ratio * sinC;\r\n    return vectorCreate(cosC * b, cosC * c);\r\n};\r\nconst getRotatedRectSize = (rect, rotation) => {\r\n    const w = rect.width;\r\n    const h = rect.height;\r\n    const hor = getOffsetPointOnEdge(w, rotation);\r\n    const ver = getOffsetPointOnEdge(h, rotation);\r\n    const tl = vectorCreate(rect.x + Math.abs(hor.x), rect.y - Math.abs(hor.y));\r\n    const tr = vectorCreate(rect.x + rect.width + Math.abs(ver.y), rect.y + Math.abs(ver.x));\r\n    const bl = vectorCreate(rect.x - Math.abs(ver.y), rect.y + rect.height - Math.abs(ver.x));\r\n    return {\r\n        width: vectorDistance(tl, tr),\r\n        height: vectorDistance(tl, bl),\r\n    };\r\n};\r\nconst getBoundsAroundCenter = (imageSize, center) => {\r\n    const cx = center.x > 0.5 ? 1 - center.x : center.x;\r\n    const cy = center.y > 0.5 ? 1 - center.y : center.y;\r\n    return sizeCreate(cx * 2 * imageSize.width, cy * 2 * imageSize.height);\r\n};\r\nconst getCanvasSize = (imageSize, canvasAspectRatio, zoom = 1) => {\r\n    const imageAspectRatio = imageSize.height / imageSize.width;\r\n    // determine actual pixels on x and y axis\r\n    const canvasWidth = 1;\r\n    const canvasHeight = canvasAspectRatio;\r\n    let imgWidth = 1;\r\n    let imgHeight = imageAspectRatio;\r\n    if (imgHeight > canvasHeight) {\r\n        imgHeight = canvasHeight;\r\n        imgWidth = imgHeight / imageAspectRatio;\r\n    }\r\n    const scalar = Math.max(canvasWidth / imgWidth, canvasHeight / imgHeight);\r\n    const width = imageSize.width / (zoom * scalar * imgWidth);\r\n    const height = width * canvasAspectRatio;\r\n    return {\r\n        width: width,\r\n        height: height,\r\n    };\r\n};\r\nconst getCenteredCropRect = (imageSize, aspectRatio) => {\r\n    let width = imageSize.width;\r\n    let height = width * aspectRatio;\r\n    if (height > imageSize.height) {\r\n        height = imageSize.height;\r\n        width = height / aspectRatio;\r\n    }\r\n    const x = (imageSize.width - width) * 0.5;\r\n    const y = (imageSize.height - height) * 0.5;\r\n    return rectCreate(x, y, width, height);\r\n};\r\nconst getCorrectedLegacyAspectRatio = (imageSize, aspectRatio) => aspectRatio != null\r\n    ? // fox the aspect ratio\r\n        1 / aspectRatio\r\n    : // set image aspect ratio\r\n        imageSize.width / imageSize.height;\r\nconst imagePropertiesFromLegacyCrop = (imageSize, { flip, aspectRatio, rotation, center, zoom, scaleToFit }) => {\r\n    const res = {};\r\n    // is centered crop\r\n    const isCenteredCrop = !center || (center && center.x === 0.5 && center.y === 0.5);\r\n    // handle basic props\r\n    if (flip && flip.horizontal)\r\n        res.flipHorizontal = flip.horizontal;\r\n    if (flip && flip.vertical)\r\n        res.flipVertical = flip.vertical;\r\n    // fix aspect ratio, in FilePond and editor v6 it's height/width instead of width/height\r\n    const correctedAspectRatio = getCorrectedLegacyAspectRatio(imageSize, aspectRatio);\r\n    // image bounds\r\n    const cropLimit = !(scaleToFit === false);\r\n    const canvasSize = getCanvasSize(imageSize, aspectRatio, zoom);\r\n    const cropSize = isCenteredCrop\r\n        ? imageSize\r\n        : getBoundsAroundCenter(imageSize, cropLimit ? center : { x: 0.5, y: 0.5 });\r\n    const cropCentered = getCenteredCropRect(imageSize, aspectRatio);\r\n    // has different aspect ratio than image\r\n    if (aspectRatio || !isCenteredCrop || zoom) {\r\n        res.crop = rectContainRect(rectCreateFromSize(cropSize), correctedAspectRatio);\r\n    }\r\n    if (typeof rotation === 'number' && rotation !== null) {\r\n        if (rotation != null)\r\n            res.rotation = rotation;\r\n        const rotatedCropSize = getRotatedRectSize(cropCentered, rotation);\r\n        const scalar = Math.max(rotatedCropSize.width / cropSize.width, rotatedCropSize.height / cropSize.height);\r\n        // crop position in non-rotated image\r\n        const cropCenter = vectorCreate(center.x * imageSize.width, center.y * imageSize.height);\r\n        // get rotated image center\r\n        const rotatedImageSize = getImageTransformedRect(imageSize, rotation);\r\n        const rotatedImageCenter = sizeCenter(rotatedImageSize);\r\n        const rotatedImageOffset = vectorCreate((rotatedImageSize.width - imageSize.width) * 0.5, (rotatedImageSize.height - imageSize.height) * 0.5);\r\n        const cropPoints = rectRotate({\r\n            x: rotatedImageOffset.x + cropCenter.x - (canvasSize.width / scalar) * 0.5,\r\n            y: rotatedImageOffset.y + cropCenter.y - (canvasSize.height / scalar) * 0.5,\r\n            width: canvasSize.width / scalar,\r\n            height: canvasSize.height / scalar,\r\n        }, rotation);\r\n        const cropBoundsPoints = vectorsRotate(cropPoints.map(vectorClone), rotation, rotatedImageCenter.x, rotatedImageCenter.y);\r\n        const cropBoundsPointsCenter = rectCenter(rectCreateFromPoints(cropBoundsPoints));\r\n        const deRotatedCropBoundsPoints = vectorsRotate(cropBoundsPoints.map(vectorClone), -(rotation * 2), cropBoundsPointsCenter.x, cropBoundsPointsCenter.y);\r\n        res.crop = rectCreateFromPoints(deRotatedCropBoundsPoints);\r\n    }\r\n    else if (zoom != null) {\r\n        rectScale$1(res.crop, 1 / zoom);\r\n    }\r\n    if (!cropLimit) {\r\n        res.cropLimitToImage = false;\r\n    }\r\n    return res;\r\n};\r\n//#endregion\r\nconst isLegacyData = (data = {}) => {\r\n    if ('markup' in data || 'color' in data || 'filter' in data)\r\n        return true;\r\n    const { crop } = data;\r\n    if (crop && ('flip' in crop || 'center' in crop || 'aspectRatio' in crop || 'rotation' in crop))\r\n        return true;\r\n    return false;\r\n};\r\nvar legacyDataToImageState = (editor, imageSize, data = {}) => {\r\n    const res = {};\r\n    // test if isn't legacy data\r\n    if (!isLegacyData(data))\r\n        return data;\r\n    if (data.crop) {\r\n        Object.assign(res, imagePropertiesFromLegacyCrop(imageSize, data.crop));\r\n    }\r\n    if (data.markup) {\r\n        const markup = Array.isArray(data.markup) ? data.markup : Object.values(data.markup);\r\n        res.decoration = markup.map((markup) => shapeFromLegacyMarkup(res.crop || imageSize, markup[0], markup[1]));\r\n    }\r\n    if (data.color) {\r\n        Object.keys(data.color)\r\n            .filter((key) => data.color[key])\r\n            .map((key) => [\r\n            key,\r\n            Array.isArray(data.color[key].matrix)\r\n                ? data.color[key].matrix\r\n                : Object.values(data.color[key].matrix),\r\n        ])\r\n            .forEach(([key, value]) => {\r\n            if (!res.colorMatrix)\r\n                res.colorMatrix = {};\r\n            res.colorMatrix[key] = value;\r\n        });\r\n    }\r\n    if (data.filter) {\r\n        if (!res.colorMatrix)\r\n            res.colorMatrix = {};\r\n        res.colorMatrix.filter =\r\n            typeof data.filter === 'string' && editor['filterFunctions'][data.filter]\r\n                ? editor['filterFunctions'][data.filter]()\r\n                : data.filter.matrix;\r\n    }\r\n    return res;\r\n};\r\n\r\nconst isOperaMini = () => Object.prototype.toString.call(window['operamini']) === '[object OperaMini]';\r\nconst hasPromises = () => 'Promise' in window;\r\nconst hasCreateObjectURL = () => 'URL' in window && 'createObjectURL' in window.URL;\r\nconst hasVisibility = () => 'visibilityState' in document;\r\nconst hasTiming = () => 'performance' in window; // iOS 8.x\r\nconst hasFileConstructor = () => 'File' in window; // excludes IE11\r\nlet result$2 = null;\r\nvar isModernBrowser = () => {\r\n    if (result$2 === null)\r\n        result$2 =\r\n            isBrowser() &&\r\n                // Can't run on Opera Mini due to lack of everything\r\n                !isOperaMini() &&\r\n                // Require these APIs to feature detect a modern browser\r\n                hasVisibility() &&\r\n                hasPromises() &&\r\n                hasFileConstructor() &&\r\n                hasCreateObjectURL() &&\r\n                hasTiming();\r\n    return result$2;\r\n};\r\n\r\nconst brightness = {\r\n    base: 0,\r\n    min: -0.25,\r\n    max: 0.25,\r\n    getLabel: (value) => toPercentageNumber(value / 0.25),\r\n    getStore: ({ imageColorMatrix }) => imageColorMatrix,\r\n    getValue: (store) => {\r\n        if (!store.brightness)\r\n            return;\r\n        return store.brightness[4];\r\n    },\r\n    setValue: (store, v) => store.update((matrices) => ({\r\n        // clone existing matrices\r\n        ...matrices,\r\n        // prettier-ignore\r\n        brightness: [\r\n            1, 0, 0, 0, v,\r\n            0, 1, 0, 0, v,\r\n            0, 0, 1, 0, v,\r\n            0, 0, 0, 1, 0\r\n        ],\r\n    })),\r\n};\r\nconst contrast = {\r\n    base: 1,\r\n    min: 0.5,\r\n    max: 1.5,\r\n    getLabel: (value) => toPercentageNumber(-1 + (value - 0.5) * 2),\r\n    getStore: ({ imageColorMatrix }) => imageColorMatrix,\r\n    getValue: (store) => {\r\n        if (!store.contrast)\r\n            return;\r\n        return store.contrast[0];\r\n    },\r\n    setValue: (store, v) => store.update((matrices) => ({\r\n        // clone existing matrices\r\n        ...matrices,\r\n        // prettier-ignore\r\n        contrast: [\r\n            v, 0, 0, 0, .5 * (1 - v),\r\n            0, v, 0, 0, .5 * (1 - v),\r\n            0, 0, v, 0, .5 * (1 - v),\r\n            0, 0, 0, 1, 0\r\n        ],\r\n    })),\r\n};\r\nconst saturation = {\r\n    base: 1,\r\n    min: 0,\r\n    max: 2,\r\n    getLabel: (value) => toPercentageNumber(value - 1),\r\n    getStore: ({ imageColorMatrix }) => imageColorMatrix,\r\n    getValue: (store) => {\r\n        if (!store.saturation)\r\n            return;\r\n        return (store.saturation[0] - 0.213) / 0.787;\r\n    },\r\n    setValue: (store, v) => store.update((matrices) => ({\r\n        ...matrices,\r\n        // prettier-ignore\r\n        saturation: [\r\n            .213 + .787 * v, .715 - .715 * v, .072 - .072 * v, 0, 0,\r\n            .213 - .213 * v, .715 + .285 * v, .072 - .072 * v, 0, 0,\r\n            .213 - .213 * v, .715 - .715 * v, .072 + .928 * v, 0, 0,\r\n            0, 0, 0, 1, 0\r\n        ],\r\n    })),\r\n};\r\nconst exposure = {\r\n    base: 1,\r\n    min: 0.5,\r\n    max: 1.5,\r\n    getLabel: (value) => toPercentageNumber(-1 + (value - 0.5) * 2),\r\n    getStore: ({ imageColorMatrix }) => imageColorMatrix,\r\n    getValue: (store) => {\r\n        if (!store.exposure)\r\n            return;\r\n        return store.exposure[0];\r\n    },\r\n    setValue: (store, v) => store.update((matrices) => ({\r\n        ...matrices,\r\n        // prettier-ignore\r\n        exposure: [\r\n            v, 0, 0, 0, 0,\r\n            0, v, 0, 0, 0,\r\n            0, 0, v, 0, 0,\r\n            0, 0, 0, 1, 0\r\n        ],\r\n    })),\r\n};\r\nconst gamma = {\r\n    base: 1,\r\n    min: 0.15,\r\n    max: 4,\r\n    getLabel: (value) => {\r\n        if (value < 1) {\r\n            return toPercentageNumber((value - 0.15) / 0.85 - 1);\r\n        }\r\n        return toPercentageNumber((value - 1) / 3);\r\n    },\r\n    getStore: ({ imageGamma }) => imageGamma,\r\n};\r\nconst vignette = {\r\n    base: 0,\r\n    min: -1,\r\n    max: 1,\r\n    getStore: ({ imageVignette }) => imageVignette,\r\n};\r\nconst clarity = {\r\n    base: 0,\r\n    min: -1,\r\n    max: 1,\r\n    getStore: ({ imageConvolutionMatrix }) => imageConvolutionMatrix,\r\n    getValue: (store) => {\r\n        if (!store.clarity)\r\n            return;\r\n        if (store.clarity[0] === 0) {\r\n            return store.clarity[1] / -1;\r\n        }\r\n        else {\r\n            return store.clarity[1] / -2;\r\n        }\r\n    },\r\n    setValue: (store, v) => {\r\n        store.update((matrices) => ({\r\n            ...matrices,\r\n            // prettier-ignore\r\n            clarity: v >= 0\r\n                ? [0, -1 * v, 0,\r\n                    -1 * v, 1 + 4 * v, -1 * v,\r\n                    0, -1 * v, 0\r\n                ]\r\n                : [-1 * v, -2 * v, -1 * v,\r\n                    -2 * v, 1 + -3 * v, -2 * v,\r\n                    -1 * v, -2 * v, -1 * v\r\n                ],\r\n        }));\r\n    },\r\n};\r\nconst temperature = {\r\n    base: 0,\r\n    min: -1,\r\n    max: 1,\r\n    getStore: ({ imageColorMatrix }) => imageColorMatrix,\r\n    getValue: (store) => {\r\n        if (!store.temperature)\r\n            return;\r\n        const v = store.temperature[0];\r\n        if (v >= 1) {\r\n            return (v - 1) / 0.1;\r\n        }\r\n        return (1 - v) / -0.15;\r\n    },\r\n    setValue: (store, v) => store.update((matrices) => ({\r\n        ...matrices,\r\n        // prettier-ignore\r\n        temperature: v > 0 ? [\r\n            1 + (v * .1), 0, 0, 0, 0,\r\n            0, 1, 0, 0, 0,\r\n            0, 0, 1 + (-v * .1), 0, 0,\r\n            0, 0, 0, 1, 0\r\n        ] : [\r\n            1 + (v * .15), 0, 0, 0, 0,\r\n            0, 1 + (v * .05), 0, 0, 0,\r\n            0, 0, 1 + (-v * .15), 0, 0,\r\n            0, 0, 0, 1, 0\r\n        ],\r\n    })),\r\n};\r\nconst finetuneControlConfigurationDefault = {\r\n    gamma,\r\n    brightness,\r\n    contrast,\r\n    saturation,\r\n    exposure,\r\n    temperature,\r\n    clarity,\r\n    vignette,\r\n};\r\nconst finetuneOptionsDefault = [\r\n    ['brightness', (locale) => locale.finetuneLabelBrightness],\r\n    ['contrast', (locale) => locale.finetuneLabelContrast],\r\n    ['saturation', (locale) => locale.finetuneLabelSaturation],\r\n    ['exposure', (locale) => locale.finetuneLabelExposure],\r\n    ['temperature', (locale) => locale.finetuneLabelTemperature],\r\n    ['gamma', (locale) => locale.finetuneLabelGamma],\r\n    !isSoftwareRendering() && ['clarity', (locale) => locale.finetuneLabelClarity],\r\n    ['vignette', (locale) => locale.finetuneLabelVignette],\r\n].filter(Boolean);\r\nvar _plugin_finetune_defaults = {\r\n    finetuneControlConfiguration: finetuneControlConfigurationDefault,\r\n    finetuneOptions: finetuneOptionsDefault,\r\n};\r\n/*\r\nTODO: fix inverse fn in getValue\r\nexport const hue = {\r\n    base: 0,\r\n    min: 0,\r\n    max: Math.PI,\r\n    getStore: ({ imageColorMatrix }) => imageColorMatrix,\r\n    getValue: (store) => {\r\n        if (!store.hue) return;\r\n\r\n        const v = store.hue[1];\r\n\r\n        const o = -(Math.acos((0.715 - v) / Math.sqrt(2) / 0.715) - Math.PI / 4);\r\n\r\n        return o;\r\n    },\r\n    setValue: (store, v: number) => {\r\n        store.update((matrices) => {\r\n            // const value = v * (Math.PI);\r\n\r\n            const cos = Math.cos(v);\r\n            const sin = Math.sin(v);\r\n\r\n            const a00 = 0.213 + cos * 0.787 - sin * 0.213;\r\n            const a01 = 0.715 - cos * 0.715 - sin * 0.715;\r\n            const a02 = 0.072 - cos * 0.072 + sin * 0.928;\r\n            const a10 = 0.213 - cos * 0.213 + sin * 0.143;\r\n            const a11 = 0.715 + cos * 0.285 + sin * 0.14;\r\n            const a12 = 0.072 - cos * 0.072 - sin * 0.283;\r\n            const a20 = 0.213 - cos * 0.213 - sin * 0.787;\r\n            const a21 = 0.715 - cos * 0.715 + sin * 0.715;\r\n            const a22 = 0.072 + cos * 0.928 + sin * 0.072;\r\n\r\n            return {\r\n                ...matrices,\r\n\r\n                // prettier-ignore\r\n                hue: [\r\n                    a00, a01, a02, 0, 0,\r\n                    a10, a11, a12, 0, 0,\r\n                    a20, a21, a22, 0, 0,\r\n                      0,   0,   0, 1, 0,\r\n                ]\r\n            };\r\n        });\r\n    },\r\n};\r\n*/\r\n\r\nconst pastel = () => \r\n// prettier-ignore\r\n[\r\n    0.75, 0.25, 0.25, 0, 0,\r\n    0.25, 0.75, 0.25, 0, 0,\r\n    0.25, 0.25, 0.75, 0, 0,\r\n    0, 0, 0, 1, 0\r\n];\r\nconst chrome = () => \r\n// prettier-ignore\r\n[\r\n    1.398, -0.316, 0.065, -0.273, 0.201,\r\n    -0.051, 1.278, -0.080, -0.273, 0.201,\r\n    -0.051, 0.119, 1.151, -0.290, 0.215,\r\n    0, 0, 0, 1, 0\r\n];\r\nconst fade = () => \r\n// prettier-ignore\r\n[\r\n    1.073, -0.015, 0.092, -0.115, -0.017,\r\n    0.107, 0.859, 0.184, -0.115, -0.017,\r\n    0.015, 0.077, 1.104, -0.115, -0.017,\r\n    0, 0, 0, 1, 0\r\n];\r\nconst warm = () => \r\n// prettier-ignore\r\n[\r\n    1.06, 0, 0, 0, 0,\r\n    0, 1.01, 0, 0, 0,\r\n    0, 0, 0.93, 0, 0,\r\n    0, 0, 0, 1, 0,\r\n];\r\nconst cold = () => \r\n// prettier-ignore\r\n[\r\n    1.1, 0, 0, 0, -.1,\r\n    0, 1.1, 0, 0, -.1,\r\n    0, 0, 1.2, 0, -.1,\r\n    0, 0, 0, 1, 0,\r\n];\r\nconst invert = () => \r\n// prettier-ignore\r\n[\r\n    -1, 0, 0, 1, 0,\r\n    0, -1, 0, 1, 0,\r\n    0, 0, -1, 1, 0,\r\n    0, 0, 0, 1, 0,\r\n];\r\nconst monoDefault = () => \r\n// prettier-ignore\r\n[\r\n    0.212, 0.715, 0.114, 0, 0,\r\n    0.212, 0.715, 0.114, 0, 0,\r\n    0.212, 0.715, 0.114, 0, 0,\r\n    0, 0, 0, 1, 0\r\n];\r\nconst monoNoir = () => \r\n// prettier-ignore\r\n[\r\n    0.15, 1.3, -0.25, 0.1, -0.2,\r\n    0.15, 1.3, -0.25, 0.1, -0.2,\r\n    0.15, 1.3, -0.25, 0.1, -0.2,\r\n    0, 0, 0, 1, 0\r\n];\r\nconst monoWash = () => \r\n// prettier-ignore\r\n[\r\n    0.163, 0.518, 0.084, -0.010, 0.208,\r\n    0.163, 0.529, 0.082, -0.020, 0.210,\r\n    0.171, 0.529, 0.084, 0.000, 0.214,\r\n    0.000, 0.000, 0.000, 1.000, 0.000,\r\n];\r\nconst monoStark = () => \r\n// prettier-ignore\r\n[\r\n    0.338, 0.991, 0.117, 0.093, -0.196,\r\n    0.302, 1.049, 0.096, 0.078, -0.196,\r\n    0.286, 1.016, 0.146, 0.101, -0.196,\r\n    0.000, 0.000, 0.000, 1.000, 0.000,\r\n];\r\nconst sepiaDefault = () => \r\n// prettier-ignore\r\n[\r\n    0.393, 0.768, 0.188, 0, 0,\r\n    0.349, 0.685, 0.167, 0, 0,\r\n    0.272, 0.533, 0.130, 0, 0,\r\n    0, 0, 0, 1, 0,\r\n];\r\nconst sepiaBlues = () => \r\n// prettier-ignore\r\n[\r\n    0.289, 0.620, 0.185, 0.000, 0.077,\r\n    0.257, 0.566, 0.163, 0.000, 0.115,\r\n    0.200, 0.430, 0.128, 0.000, 0.188,\r\n    0.000, 0.000, 0.000, 1.000, 0.000,\r\n];\r\nconst sepiaRust = () => \r\n// prettier-ignore\r\n[\r\n    0.269, 0.764, 0.172, 0.050, 0.100,\r\n    0.239, 0.527, 0.152, 0.000, 0.176,\r\n    0.186, 0.400, 0.119, 0.000, 0.159,\r\n    0.000, 0.000, 0.000, 1.000, 0.000,\r\n];\r\nconst sepiaColor = () => \r\n// prettier-ignore\r\n[\r\n    0.547, 0.764, 0.134, 0.000, -0.147,\r\n    0.281, 0.925, 0.120, 0.000, -0.135,\r\n    0.225, 0.558, 0.330, 0.000, -0.113,\r\n    0.000, 0.000, 0.000, 1.000, 0.000,\r\n];\r\n//\r\n// default filter set\r\n//\r\nconst filterFunctionsDefault = {\r\n    chrome,\r\n    fade,\r\n    pastel,\r\n    cold,\r\n    warm,\r\n    monoDefault,\r\n    monoWash,\r\n    monoNoir,\r\n    monoStark,\r\n    sepiaDefault,\r\n    sepiaRust,\r\n    sepiaBlues,\r\n    sepiaColor,\r\n};\r\nconst filterOptionsDefault = [\r\n    ['Default', [[undefined, (locale) => locale.labelDefault]]],\r\n    [\r\n        'Classic',\r\n        [\r\n            ['chrome', (locale) => locale.filterLabelChrome],\r\n            ['fade', (locale) => locale.filterLabelFade],\r\n            ['cold', (locale) => locale.filterLabelCold],\r\n            ['warm', (locale) => locale.filterLabelWarm],\r\n            ['pastel', (locale) => locale.filterLabelPastel],\r\n        ],\r\n    ],\r\n    [\r\n        'Monochrome',\r\n        [\r\n            ['monoDefault', (locale) => locale.filterLabelMonoDefault],\r\n            ['monoNoir', (locale) => locale.filterLabelMonoNoir],\r\n            ['monoStark', (locale) => locale.filterLabelMonoStark],\r\n            ['monoWash', (locale) => locale.filterLabelMonoWash],\r\n        ],\r\n    ],\r\n    [\r\n        'Sepia',\r\n        [\r\n            ['sepiaDefault', (locale) => locale.filterLabelSepiaDefault],\r\n            ['sepiaRust', (locale) => locale.filterLabelSepiaRust],\r\n            ['sepiaBlues', (locale) => locale.filterLabelSepiaBlues],\r\n            ['sepiaColor', (locale) => locale.filterLabelSepiaColor],\r\n        ],\r\n    ],\r\n];\r\nvar _plugin_filter_defaults = {\r\n    filterFunctions: filterFunctionsDefault,\r\n    filterOptions: filterOptionsDefault,\r\n};\r\n\r\nconst solidSharp = {\r\n    shape: {\r\n        frameColor: [1, 1, 1],\r\n        frameStyle: 'solid',\r\n        frameSize: '2.5%',\r\n    },\r\n    thumb: '<rect stroke-width=\"5\" x=\"0\" y=\"0\" width=\"100%\" height=\"100%\"/>',\r\n};\r\nconst solidRound = {\r\n    shape: {\r\n        frameColor: [1, 1, 1],\r\n        frameStyle: 'solid',\r\n        frameSize: '2.5%',\r\n        frameRound: true,\r\n    },\r\n    thumb: '<rect stroke-width=\"5\" x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" rx=\"12%\"/>',\r\n};\r\nconst lineSingle = {\r\n    shape: {\r\n        frameColor: [1, 1, 1],\r\n        frameStyle: 'line',\r\n        frameInset: '2.5%',\r\n        frameSize: '.3125%',\r\n        frameRadius: 0,\r\n    },\r\n    thumb: '<div style=\"top:.5em;left:.5em;right:.5em;bottom:.5em;box-shadow:inset 0 0 0 1px currentColor\"></div>',\r\n};\r\nconst lineMultiple = {\r\n    shape: {\r\n        frameColor: [1, 1, 1],\r\n        frameStyle: 'line',\r\n        frameAmount: 2,\r\n        frameInset: '2.5%',\r\n        frameSize: '.3125%',\r\n        frameOffset: '1.25%',\r\n        frameRadius: 0,\r\n    },\r\n    thumb: '<div style=\"top:.75em;left:.75em;right:.75em;bottom:.75em; outline: 3px double\"></div>',\r\n};\r\nconst edgeSeparate = {\r\n    shape: {\r\n        frameColor: [1, 1, 1],\r\n        frameStyle: 'edge',\r\n        frameInset: '2.5%',\r\n        frameOffset: '5%',\r\n        frameSize: '.3125%',\r\n    },\r\n    thumb: '<div style=\"top:.75em;left:.5em;bottom:.75em;border-left:1px solid\"></div><div style=\"top:.75em;right:.5em;bottom:.75em;border-right:1px solid\"></div><div style=\"top:.5em;left:.75em;right:.75em;border-top:1px solid\"></div><div style=\"bottom:.5em;left:.75em;right:.75em;border-bottom:1px solid\"></div>',\r\n};\r\nconst edgeCross = {\r\n    shape: {\r\n        frameColor: [1, 1, 1],\r\n        frameStyle: 'edge',\r\n        frameInset: '2.5%',\r\n        frameSize: '.3125%',\r\n    },\r\n    thumb: '<div style=\"top:-.5em;left:.5em;right:.5em;bottom:-.5em; box-shadow: inset 0 0 0 1px currentColor\"></div><div style=\"top:.5em;left:-.5em;right:-.5em;bottom:.5em;box-shadow:inset 0 0 0 1px currentColor\"></div>',\r\n};\r\nconst edgeOverlap = {\r\n    shape: {\r\n        frameColor: [1, 1, 1],\r\n        frameStyle: 'edge',\r\n        frameOffset: '1.5%',\r\n        frameSize: '.3125%',\r\n    },\r\n    thumb: '<div style=\"top:.3125em;left:.5em;bottom:.3125em;border-left:1px solid\"></div><div style=\"top:.3125em;right:.5em;bottom:.3125em;border-right:1px solid\"></div><div style=\"top:.5em;left:.3125em;right:.3125em;border-top:1px solid\"></div><div style=\"bottom:.5em;left:.3125em;right:.3125em;border-bottom:1px solid\"></div>',\r\n};\r\nconst hook = {\r\n    shape: {\r\n        frameColor: [1, 1, 1],\r\n        frameStyle: 'hook',\r\n        frameInset: '2.5%',\r\n        frameSize: '.3125%',\r\n        frameLength: '5%',\r\n    },\r\n    thumb: '<div style=\"top:.5em;left:.5em;width:.75em;height:.75em; border-left: 1px solid;border-top: 1px solid;\"></div><div style=\"top:.5em;right:.5em;width:.75em;height:.75em; border-right: 1px solid;border-top: 1px solid;\"></div><div style=\"bottom:.5em;left:.5em;width:.75em;height:.75em; border-left: 1px solid;border-bottom: 1px solid;\"></div><div style=\"bottom:.5em;right:.5em;width:.75em;height:.75em; border-right: 1px solid;border-bottom: 1px solid;\"></div>',\r\n};\r\nconst polaroid = {\r\n    shape: {\r\n        frameColor: [1, 1, 1],\r\n        frameStyle: 'polaroid',\r\n    },\r\n    thumb: '<rect stroke-width=\"20%\" x=\"-5%\" y=\"-5%\" width=\"110%\" height=\"96%\"/>',\r\n};\r\nconst frameStylesDefault = {\r\n    solidSharp,\r\n    solidRound,\r\n    lineSingle,\r\n    lineMultiple,\r\n    edgeSeparate,\r\n    edgeCross,\r\n    edgeOverlap,\r\n    hook,\r\n    polaroid,\r\n};\r\nconst frameOptionsDefault = [\r\n    [undefined, (locale) => locale.labelNone],\r\n    ['solidSharp', (locale) => locale.frameLabelMatSharp],\r\n    ['solidRound', (locale) => locale.frameLabelMatRound],\r\n    ['lineSingle', (locale) => locale.frameLabelLineSingle],\r\n    ['lineMultiple', (locale) => locale.frameLabelLineMultiple],\r\n    ['edgeCross', (locale) => locale.frameLabelEdgeCross],\r\n    ['edgeSeparate', (locale) => locale.frameLabelEdgeSeparate],\r\n    ['edgeOverlap', (locale) => locale.frameLabelEdgeOverlap],\r\n    ['hook', (locale) => locale.frameLabelCornerHooks],\r\n    ['polaroid', (locale) => locale.frameLabelPolaroid],\r\n];\r\nvar _plugin_frame_defaults = {\r\n    frameStyles: frameStylesDefault,\r\n    frameOptions: frameOptionsDefault,\r\n};\r\n\r\nvar RGBToHSV = (r, g, b) => {\r\n    let v = Math.max(r, g, b), n = v - Math.min(r, g, b);\r\n    let h = n && (v == r ? (g - b) / n : v == g ? 2 + (b - r) / n : 4 + (r - g) / n);\r\n    return [(60 * (h < 0 ? h + 6 : h)) / 360, v && n / v, v];\r\n};\r\n\r\nvar HSVToRGB = (h, s, v) => {\r\n    let r, g, b;\r\n    const i = Math.floor(h * 6);\r\n    const f = h * 6 - i;\r\n    const p = v * (1 - s);\r\n    const q = v * (1 - f * s);\r\n    const t = v * (1 - (1 - f) * s);\r\n    switch (i % 6) {\r\n        case 0:\r\n            (r = v), (g = t), (b = p);\r\n            break;\r\n        case 1:\r\n            (r = q), (g = v), (b = p);\r\n            break;\r\n        case 2:\r\n            (r = p), (g = v), (b = t);\r\n            break;\r\n        case 3:\r\n            (r = p), (g = q), (b = v);\r\n            break;\r\n        case 4:\r\n            (r = t), (g = p), (b = v);\r\n            break;\r\n        case 5:\r\n            (r = v), (g = p), (b = q);\r\n            break;\r\n    }\r\n    return [r, g, b];\r\n};\r\n\r\n/* src/core/ui/components/ColorPreview.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$v(ctx) {\r\n\tlet div;\r\n\tlet span;\r\n\tlet div_style_value;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tattr(div, \"class\", \"PinturaColorPreview\");\r\n\t\t\tattr(div, \"title\", /*title*/ ctx[0]);\r\n\t\t\tattr(div, \"style\", div_style_value = `--color:${/*colorValue*/ ctx[1]}`);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tappend(div, span);\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tif (dirty & /*title*/ 1) {\r\n\t\t\t\tattr(div, \"title\", /*title*/ ctx[0]);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty & /*colorValue*/ 2 && div_style_value !== (div_style_value = `--color:${/*colorValue*/ ctx[1]}`)) {\r\n\t\t\t\tattr(div, \"style\", div_style_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti: noop,\r\n\t\to: noop,\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$v($$self, $$props, $$invalidate) {\r\n\tlet colorValue;\r\n\tlet { color = undefined } = $$props;\r\n\tlet { title = undefined } = $$props;\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('color' in $$props) $$invalidate(2, color = $$props.color);\r\n\t\tif ('title' in $$props) $$invalidate(0, title = $$props.title);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*color*/ 4) {\r\n\t\t\t$$invalidate(1, colorValue = color ? colorArrayToRGBA(color) : 'transparent');\r\n\t\t}\r\n\t};\r\n\r\n\treturn [title, colorValue, color];\r\n}\r\n\r\nclass ColorPreview extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\t\tinit(this, options, instance$v, create_fragment$v, safe_not_equal, { color: 2, title: 0 });\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/ColorPicker.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_if_block_4$4(ctx) {\r\n\tlet span;\r\n\tlet t;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt = text(/*label*/ ctx[0]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t\tappend(span, t);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[0] & /*label*/ 1) set_data(t, /*label*/ ctx[0]);\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (168:4) \r\nfunction create_label_slot(ctx) {\r\n\tlet span;\r\n\tlet colorpreview;\r\n\tlet t;\r\n\tlet current;\r\n\r\n\tcolorpreview = new ColorPreview({\r\n\t\t\tprops: {\r\n\t\t\t\tcolor: /*value*/ ctx[4],\r\n\t\t\t\ttitle: localize(/*title*/ ctx[8], /*locale*/ ctx[10])\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tlet if_block = !/*hidePresetLabel*/ ctx[9] && create_if_block_4$4(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tcreate_component(colorpreview.$$.fragment);\r\n\t\t\tt = space();\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tattr(span, \"slot\", \"label\");\r\n\t\t\tattr(span, \"class\", \"PinturaButtonLabel\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t\tmount_component(colorpreview, span, null);\r\n\t\t\tappend(span, t);\r\n\t\t\tif (if_block) if_block.m(span, null);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst colorpreview_changes = {};\r\n\t\t\tif (dirty[0] & /*value*/ 16) colorpreview_changes.color = /*value*/ ctx[4];\r\n\t\t\tif (dirty[0] & /*title, locale*/ 1280) colorpreview_changes.title = localize(/*title*/ ctx[8], /*locale*/ ctx[10]);\r\n\t\t\tcolorpreview.$set(colorpreview_changes);\r\n\r\n\t\t\tif (!/*hidePresetLabel*/ ctx[9]) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block_4$4(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\tif_block.m(span, null);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tif_block.d(1);\r\n\t\t\t\tif_block = null;\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(colorpreview.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(colorpreview.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t\tdestroy_component(colorpreview);\r\n\t\t\tif (if_block) if_block.d();\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (179:8) {#if enablePicker}\r\nfunction create_if_block_2$5(ctx) {\r\n\tlet div3;\r\n\tlet div2;\r\n\tlet div1;\r\n\tlet div0;\r\n\tlet div0_style_value;\r\n\tlet div1_style_value;\r\n\tlet div2_style_value;\r\n\tlet t0;\r\n\tlet slider;\r\n\tlet t1;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\tslider = new Slider({\r\n\t\t\tprops: {\r\n\t\t\t\tclass: \"PinturaHuePicker\",\r\n\t\t\t\tknobStyle: `background-color:${/*valueAsRGBAFullySaturated*/ ctx[19]}`,\r\n\t\t\t\tonchange: /*updateHue*/ ctx[24],\r\n\t\t\t\tvalue: /*hue*/ ctx[14],\r\n\t\t\t\tmin: 0,\r\n\t\t\t\tmax: 1,\r\n\t\t\t\tstep: 0.01\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tlet if_block = /*enableOpacity*/ ctx[11] && create_if_block_3$4(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv3 = element(\"div\");\r\n\t\t\tdiv2 = element(\"div\");\r\n\t\t\tdiv1 = element(\"div\");\r\n\t\t\tdiv0 = element(\"div\");\r\n\t\t\tt0 = space();\r\n\t\t\tcreate_component(slider.$$.fragment);\r\n\t\t\tt1 = space();\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tattr(div0, \"role\", \"button\");\r\n\t\t\tattr(div0, \"aria-label\", \"Saturation slider\");\r\n\t\t\tattr(div0, \"class\", \"PinturaPickerKnob\");\r\n\t\t\tattr(div0, \"tabindex\", \"0\");\r\n\t\t\tattr(div0, \"style\", div0_style_value = `background-color:${/*valueAsRGBAFullyOpaque*/ ctx[18]};`);\r\n\t\t\tattr(div1, \"class\", \"PinturaPickerKnobController\");\r\n\t\t\tattr(div1, \"style\", div1_style_value = `transform:translate(${/*sx*/ ctx[22]}%,${/*sy*/ ctx[21]}%)`);\r\n\t\t\tattr(div2, \"class\", \"PinturaSaturationPicker\");\r\n\t\t\tattr(div2, \"style\", div2_style_value = `background-color: ${/*valueAsRGBAFullySaturated*/ ctx[19]}`);\r\n\t\t\tattr(div3, \"class\", \"PinturaPicker\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div3, anchor);\r\n\t\t\tappend(div3, div2);\r\n\t\t\tappend(div2, div1);\r\n\t\t\tappend(div1, div0);\r\n\t\t\t/*div2_binding*/ ctx[32](div2);\r\n\t\t\tappend(div3, t0);\r\n\t\t\tmount_component(slider, div3, null);\r\n\t\t\tappend(div3, t1);\r\n\t\t\tif (if_block) if_block.m(div3, null);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(div0, \"nudge\", /*handleNudge*/ ctx[27]),\r\n\t\t\t\t\taction_destroyer(nudgeable.call(null, div0, { preventDefault: true })),\r\n\t\t\t\t\tlisten(div2, \"pointerdown\", /*handlePointerDown*/ ctx[26])\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (!current || dirty[0] & /*valueAsRGBAFullyOpaque*/ 262144 && div0_style_value !== (div0_style_value = `background-color:${/*valueAsRGBAFullyOpaque*/ ctx[18]};`)) {\r\n\t\t\t\tattr(div0, \"style\", div0_style_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*sx, sy*/ 6291456 && div1_style_value !== (div1_style_value = `transform:translate(${/*sx*/ ctx[22]}%,${/*sy*/ ctx[21]}%)`)) {\r\n\t\t\t\tattr(div1, \"style\", div1_style_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*valueAsRGBAFullySaturated*/ 524288 && div2_style_value !== (div2_style_value = `background-color: ${/*valueAsRGBAFullySaturated*/ ctx[19]}`)) {\r\n\t\t\t\tattr(div2, \"style\", div2_style_value);\r\n\t\t\t}\r\n\r\n\t\t\tconst slider_changes = {};\r\n\t\t\tif (dirty[0] & /*valueAsRGBAFullySaturated*/ 524288) slider_changes.knobStyle = `background-color:${/*valueAsRGBAFullySaturated*/ ctx[19]}`;\r\n\t\t\tif (dirty[0] & /*hue*/ 16384) slider_changes.value = /*hue*/ ctx[14];\r\n\t\t\tslider.$set(slider_changes);\r\n\r\n\t\t\tif (/*enableOpacity*/ ctx[11]) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[0] & /*enableOpacity*/ 2048) {\r\n\t\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block_3$4(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(div3, null);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block, 1, 1, () => {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(slider.$$.fragment, local);\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(slider.$$.fragment, local);\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div3);\r\n\t\t\t/*div2_binding*/ ctx[32](null);\r\n\t\t\tdestroy_component(slider);\r\n\t\t\tif (if_block) if_block.d();\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (213:16) {#if enableOpacity}\r\nfunction create_if_block_3$4(ctx) {\r\n\tlet slider;\r\n\tlet current;\r\n\r\n\tslider = new Slider({\r\n\t\t\tprops: {\r\n\t\t\t\tclass: \"PinturaOpacityPicker\",\r\n\t\t\t\tknobStyle: `background-color:${/*valueAsRGBA*/ ctx[16]}`,\r\n\t\t\t\ttrackStyle: `background-image:linear-gradient(to right,${/*valueAsRGBAFullyTransparent*/ ctx[17]},${/*valueAsRGBAFullyOpaque*/ ctx[18]})`,\r\n\t\t\t\tonchange: /*updateOpacity*/ ctx[25],\r\n\t\t\t\tvalue: /*opacity*/ ctx[15],\r\n\t\t\t\tmin: 0,\r\n\t\t\t\tmax: 1,\r\n\t\t\t\tstep: 0.01\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(slider.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(slider, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst slider_changes = {};\r\n\t\t\tif (dirty[0] & /*valueAsRGBA*/ 65536) slider_changes.knobStyle = `background-color:${/*valueAsRGBA*/ ctx[16]}`;\r\n\t\t\tif (dirty[0] & /*valueAsRGBAFullyTransparent, valueAsRGBAFullyOpaque*/ 393216) slider_changes.trackStyle = `background-image:linear-gradient(to right,${/*valueAsRGBAFullyTransparent*/ ctx[17]},${/*valueAsRGBAFullyOpaque*/ ctx[18]})`;\r\n\t\t\tif (dirty[0] & /*opacity*/ 32768) slider_changes.value = /*opacity*/ ctx[15];\r\n\t\t\tslider.$set(slider_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(slider.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(slider.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(slider, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (229:8) {#if enablePresets}\r\nfunction create_if_block$6(ctx) {\r\n\tlet radiogroup;\r\n\tlet current;\r\n\r\n\tradiogroup = new RadioGroup({\r\n\t\t\tprops: {\r\n\t\t\t\tlabel: localize(/*locale*/ ctx[10].labelColorPalette, /*locale*/ ctx[10]),\r\n\t\t\t\tclass: arrayJoin([\r\n\t\t\t\t\t'PinturaColorPresets',\r\n\t\t\t\t\t/*hidePresetLabel*/ ctx[9]\r\n\t\t\t\t\t? 'PinturaColorPresetsGrid'\r\n\t\t\t\t\t: 'PinturaColorPresetsList'\r\n\t\t\t\t]),\r\n\t\t\t\thideLabel: false,\r\n\t\t\t\tname: /*name*/ ctx[1],\r\n\t\t\t\tvalue: /*value*/ ctx[4],\r\n\t\t\t\toptionGroupClass: \"PinturaListOptionGroup\",\r\n\t\t\t\toptionClass: \"PinturaListOption\",\r\n\t\t\t\toptions: /*options*/ ctx[2].map(/*func*/ ctx[33]),\r\n\t\t\t\tselectedIndex: /*selectedIndex*/ ctx[3],\r\n\t\t\t\toptionMapper: /*optionMapper*/ ctx[7],\r\n\t\t\t\toptionLabelClass: /*optionLabelClass*/ ctx[6],\r\n\t\t\t\tonchange: /*func_1*/ ctx[34],\r\n\t\t\t\t$$slots: {\r\n\t\t\t\t\toption: [\r\n\t\t\t\t\t\tcreate_option_slot$3,\r\n\t\t\t\t\t\t({ option }) => ({ 45: option }),\r\n\t\t\t\t\t\t({ option }) => [0, option ? 16384 : 0]\r\n\t\t\t\t\t],\r\n\t\t\t\t\tgroup: [\r\n\t\t\t\t\t\tcreate_group_slot,\r\n\t\t\t\t\t\t({ option }) => ({ 45: option }),\r\n\t\t\t\t\t\t({ option }) => [0, option ? 16384 : 0]\r\n\t\t\t\t\t]\r\n\t\t\t\t},\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(radiogroup.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(radiogroup, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst radiogroup_changes = {};\r\n\t\t\tif (dirty[0] & /*locale*/ 1024) radiogroup_changes.label = localize(/*locale*/ ctx[10].labelColorPalette, /*locale*/ ctx[10]);\r\n\r\n\t\t\tif (dirty[0] & /*hidePresetLabel*/ 512) radiogroup_changes.class = arrayJoin([\r\n\t\t\t\t'PinturaColorPresets',\r\n\t\t\t\t/*hidePresetLabel*/ ctx[9]\r\n\t\t\t\t? 'PinturaColorPresetsGrid'\r\n\t\t\t\t: 'PinturaColorPresetsList'\r\n\t\t\t]);\r\n\r\n\t\t\tif (dirty[0] & /*name*/ 2) radiogroup_changes.name = /*name*/ ctx[1];\r\n\t\t\tif (dirty[0] & /*value*/ 16) radiogroup_changes.value = /*value*/ ctx[4];\r\n\t\t\tif (dirty[0] & /*options, locale*/ 1028) radiogroup_changes.options = /*options*/ ctx[2].map(/*func*/ ctx[33]);\r\n\t\t\tif (dirty[0] & /*selectedIndex*/ 8) radiogroup_changes.selectedIndex = /*selectedIndex*/ ctx[3];\r\n\t\t\tif (dirty[0] & /*optionMapper*/ 128) radiogroup_changes.optionMapper = /*optionMapper*/ ctx[7];\r\n\t\t\tif (dirty[0] & /*optionLabelClass*/ 64) radiogroup_changes.optionLabelClass = /*optionLabelClass*/ ctx[6];\r\n\r\n\t\t\tif (dirty[0] & /*hidePresetLabel*/ 512 | dirty[1] & /*$$scope, option*/ 49152) {\r\n\t\t\t\tradiogroup_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tradiogroup.$set(radiogroup_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(radiogroup.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(radiogroup.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(radiogroup, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (251:16) \r\nfunction create_group_slot(ctx) {\r\n\tlet span;\r\n\tlet t_value = /*option*/ ctx[45].label + \"\";\r\n\tlet t;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt = text(t_value);\r\n\t\t\tattr(span, \"slot\", \"group\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t\tappend(span, t);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[1] & /*option*/ 16384 && t_value !== (t_value = /*option*/ ctx[45].label + \"\")) set_data(t, t_value);\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (256:20) {#if !hidePresetLabel}\r\nfunction create_if_block_1$6(ctx) {\r\n\tlet span;\r\n\tlet t_value = /*option*/ ctx[45].label + \"\";\r\n\tlet t;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt = text(t_value);\r\n\t\t\tattr(span, \"class\", \"PinturaButtonLabel\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t\tappend(span, t);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[1] & /*option*/ 16384 && t_value !== (t_value = /*option*/ ctx[45].label + \"\")) set_data(t, t_value);\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (254:16) \r\nfunction create_option_slot$3(ctx) {\r\n\tlet span;\r\n\tlet colorpreview;\r\n\tlet t;\r\n\tlet current;\r\n\r\n\tcolorpreview = new ColorPreview({\r\n\t\t\tprops: {\r\n\t\t\t\ttitle: /*option*/ ctx[45].label,\r\n\t\t\t\tcolor: /*option*/ ctx[45].value\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tlet if_block = !/*hidePresetLabel*/ ctx[9] && create_if_block_1$6(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tcreate_component(colorpreview.$$.fragment);\r\n\t\t\tt = space();\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tattr(span, \"slot\", \"option\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t\tmount_component(colorpreview, span, null);\r\n\t\t\tappend(span, t);\r\n\t\t\tif (if_block) if_block.m(span, null);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst colorpreview_changes = {};\r\n\t\t\tif (dirty[1] & /*option*/ 16384) colorpreview_changes.title = /*option*/ ctx[45].label;\r\n\t\t\tif (dirty[1] & /*option*/ 16384) colorpreview_changes.color = /*option*/ ctx[45].value;\r\n\t\t\tcolorpreview.$set(colorpreview_changes);\r\n\r\n\t\t\tif (!/*hidePresetLabel*/ ctx[9]) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block_1$6(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\tif_block.m(span, null);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tif_block.d(1);\r\n\t\t\t\tif_block = null;\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(colorpreview.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(colorpreview.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t\tdestroy_component(colorpreview);\r\n\t\t\tif (if_block) if_block.d();\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (177:4) \r\nfunction create_details_slot(ctx) {\r\n\tlet div;\r\n\tlet t;\r\n\tlet current;\r\n\tlet if_block0 = /*enablePicker*/ ctx[13] && create_if_block_2$5(ctx);\r\n\tlet if_block1 = /*enablePresets*/ ctx[12] && create_if_block$6(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (if_block0) if_block0.c();\r\n\t\t\tt = space();\r\n\t\t\tif (if_block1) if_block1.c();\r\n\t\t\tattr(div, \"slot\", \"details\");\r\n\t\t\tattr(div, \"class\", \"PinturaColorPickerPanel\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tif (if_block0) if_block0.m(div, null);\r\n\t\t\tappend(div, t);\r\n\t\t\tif (if_block1) if_block1.m(div, null);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (/*enablePicker*/ ctx[13]) {\r\n\t\t\t\tif (if_block0) {\r\n\t\t\t\t\tif_block0.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[0] & /*enablePicker*/ 8192) {\r\n\t\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block0 = create_if_block_2$5(ctx);\r\n\t\t\t\t\tif_block0.c();\r\n\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\tif_block0.m(div, t);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block0) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block0, 1, 1, () => {\r\n\t\t\t\t\tif_block0 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (/*enablePresets*/ ctx[12]) {\r\n\t\t\t\tif (if_block1) {\r\n\t\t\t\t\tif_block1.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[0] & /*enablePresets*/ 4096) {\r\n\t\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block1 = create_if_block$6(ctx);\r\n\t\t\t\t\tif_block1.c();\r\n\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\tif_block1.m(div, null);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block1) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block1, 1, 1, () => {\r\n\t\t\t\t\tif_block1 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block0);\r\n\t\t\ttransition_in(if_block1);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block0);\r\n\t\t\ttransition_out(if_block1);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif (if_block0) if_block0.d();\r\n\t\t\tif (if_block1) if_block1.d();\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$u(ctx) {\r\n\tlet panel;\r\n\tlet current;\r\n\r\n\tpanel = new Panel({\r\n\t\t\tprops: {\r\n\t\t\t\tbuttonClass: arrayJoin(['PinturaColorPickerButton', /*buttonClass*/ ctx[5]]),\r\n\t\t\t\t$$slots: {\r\n\t\t\t\t\tdetails: [create_details_slot],\r\n\t\t\t\t\tlabel: [create_label_slot]\r\n\t\t\t\t},\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(panel.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(panel, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst panel_changes = {};\r\n\t\t\tif (dirty[0] & /*buttonClass*/ 32) panel_changes.buttonClass = arrayJoin(['PinturaColorPickerButton', /*buttonClass*/ ctx[5]]);\r\n\r\n\t\t\tif (dirty[0] & /*locale, hidePresetLabel, name, value, options, selectedIndex, optionMapper, optionLabelClass, enablePresets, valueAsRGBA, valueAsRGBAFullyTransparent, valueAsRGBAFullyOpaque, opacity, enableOpacity, valueAsRGBAFullySaturated, hue, input, sx, sy, enablePicker, label, title*/ 8388575 | dirty[1] & /*$$scope*/ 32768) {\r\n\t\t\t\tpanel_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tpanel.$set(panel_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(panel.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(panel.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(panel, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$u($$self, $$props, $$invalidate) {\r\n\tlet sx;\r\n\tlet sy;\r\n\tlet { label = undefined } = $$props;\r\n\tlet { name = undefined } = $$props;\r\n\tlet { options = [] } = $$props;\r\n\tlet { selectedIndex = -1 } = $$props;\r\n\tlet { value = undefined } = $$props;\r\n\tlet { buttonClass = undefined } = $$props;\r\n\tlet { optionLabelClass = undefined } = $$props;\r\n\tlet { optionMapper = undefined } = $$props;\r\n\tlet { onchange = undefined } = $$props;\r\n\tlet { title = undefined } = $$props;\r\n\tlet { hidePresetLabel = true } = $$props;\r\n\tlet { locale = undefined } = $$props;\r\n\tlet { enableOpacity = true } = $$props;\r\n\tlet { enablePresets = true } = $$props;\r\n\tlet { enablePicker = true } = $$props;\r\n\r\n\t// inputs\r\n\tlet hue;\r\n\r\n\tlet saturation;\r\n\tlet brightness;\r\n\tlet opacity;\r\n\r\n\t// shortcuts\r\n\tlet valueAsRGB;\r\n\r\n\tlet valueAsRGBA;\r\n\tlet valueAsRGBAFullyTransparent;\r\n\tlet valueAsRGBAFullyOpaque;\r\n\tlet valueAsRGBAFullySaturated;\r\n\r\n\t// remember previous value\r\n\tlet valuePrev;\r\n\r\n\tconst updateProps = (color, syncControls) => {\r\n\t\tvalueAsRGB = [color[0], color[1], color[2]];\r\n\r\n\t\tif (syncControls) {\r\n\t\t\tlet valueAsHSV = RGBToHSV(...valueAsRGB);\r\n\t\t\t$$invalidate(14, hue = valueAsHSV[0]);\r\n\t\t\t$$invalidate(29, saturation = valueAsHSV[1]);\r\n\t\t\t$$invalidate(30, brightness = valueAsHSV[2]);\r\n\t\t\t$$invalidate(15, opacity = isNumber(color[3]) ? color[3] : 1);\r\n\t\t}\r\n\r\n\t\t$$invalidate(16, valueAsRGBA = colorArrayToRGBA(color));\r\n\t\t$$invalidate(17, valueAsRGBAFullyTransparent = colorArrayToRGBA([...valueAsRGB, 0]));\r\n\t\t$$invalidate(18, valueAsRGBAFullyOpaque = colorArrayToRGBA([...valueAsRGB, 1]));\r\n\t\t$$invalidate(19, valueAsRGBAFullySaturated = colorArrayToRGBA(HSVToRGB(hue, 1, 1)));\r\n\t};\r\n\r\n\tconst update = () => {\r\n\t\tconst rgb = HSVToRGB(hue, saturation, brightness);\r\n\t\tconst rgba = [...rgb, opacity];\r\n\t\tupdateProps(rgba);\r\n\t\tonchange(rgba);\r\n\t};\r\n\r\n\tconst updateColorArray = arr => {\r\n\t\tconst rgba = arr.length === 3 ? [...arr, 1] : arr;\r\n\t\tupdateProps(rgba, true);\r\n\t\tonchange(rgba);\r\n\t};\r\n\r\n\tconst updateHue = h => {\r\n\t\t$$invalidate(14, hue = h);\r\n\t\tif (opacity === 0) $$invalidate(15, opacity = 1);\r\n\t\tupdate();\r\n\t};\r\n\r\n\tconst updateSaturationAndBrightness = (s, b) => {\r\n\t\t$$invalidate(29, saturation = s);\r\n\t\t$$invalidate(30, brightness = b);\r\n\t\tif (opacity === 0) $$invalidate(15, opacity = 1);\r\n\t\tupdate();\r\n\t};\r\n\r\n\tconst updateOpacity = o => {\r\n\t\t$$invalidate(15, opacity = o);\r\n\t\tupdate();\r\n\t};\r\n\r\n\tconst setValueByOffset = (offset, inputSize) => {\r\n\t\tconst x = clamp(offset.x / inputSize.width, 0, 1);\r\n\t\tconst y = clamp(offset.y / inputSize.height, 0, 1);\r\n\t\tupdateSaturationAndBrightness(x, 1 - y);\r\n\t};\r\n\r\n\tlet input;\r\n\tlet inputSize;\r\n\tlet inputOffset;\r\n\tlet inputPageOffset;\r\n\r\n\tconst handlePointerDown = e => {\r\n\t\te.stopPropagation();\r\n\t\tinputSize = sizeCreate(input.offsetWidth, input.offsetHeight);\r\n\t\tinputOffset = vectorCreateFromPointerEventOffset(e);\r\n\t\tinputPageOffset = vectorCreateFromPointerEvent(e);\r\n\t\tsetValueByOffset(inputOffset, inputSize);\r\n\t\tdocument.documentElement.addEventListener('pointermove', handlePointerMove);\r\n\t\tdocument.documentElement.addEventListener('pointerup', handlePointerUp);\r\n\t};\r\n\r\n\tconst handlePointerMove = e => {\r\n\t\tconst d = vectorSubtract(vectorCreateFromPointerEvent(e), inputPageOffset);\r\n\t\tsetValueByOffset(vectorAdd(vectorClone(inputOffset), d), inputSize);\r\n\t};\r\n\r\n\tconst handlePointerUp = e => {\r\n\t\tinputSize = undefined;\r\n\t\tdocument.documentElement.removeEventListener('pointermove', handlePointerMove);\r\n\t\tdocument.documentElement.removeEventListener('pointerup', handlePointerUp);\r\n\t};\r\n\r\n\tconst handleNudge = e => {\r\n\t\tinputSize = sizeCreate(input.offsetWidth, input.offsetHeight);\r\n\t\tconst x = sx / 100 * inputSize.width;\r\n\t\tconst y = sy / 100 * inputSize.height;\r\n\t\tsetValueByOffset({ x: x + e.detail.x, y: y + e.detail.y }, inputSize);\r\n\t};\r\n\r\n\tfunction div2_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\tinput = $$value;\r\n\t\t\t$$invalidate(20, input);\r\n\t\t});\r\n\t}\r\n\r\n\tconst func = ([color, label]) => [color, isFunction(label) ? label(locale) : label];\r\n\tconst func_1 = detail => updateColorArray(detail.value);\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('label' in $$props) $$invalidate(0, label = $$props.label);\r\n\t\tif ('name' in $$props) $$invalidate(1, name = $$props.name);\r\n\t\tif ('options' in $$props) $$invalidate(2, options = $$props.options);\r\n\t\tif ('selectedIndex' in $$props) $$invalidate(3, selectedIndex = $$props.selectedIndex);\r\n\t\tif ('value' in $$props) $$invalidate(4, value = $$props.value);\r\n\t\tif ('buttonClass' in $$props) $$invalidate(5, buttonClass = $$props.buttonClass);\r\n\t\tif ('optionLabelClass' in $$props) $$invalidate(6, optionLabelClass = $$props.optionLabelClass);\r\n\t\tif ('optionMapper' in $$props) $$invalidate(7, optionMapper = $$props.optionMapper);\r\n\t\tif ('onchange' in $$props) $$invalidate(28, onchange = $$props.onchange);\r\n\t\tif ('title' in $$props) $$invalidate(8, title = $$props.title);\r\n\t\tif ('hidePresetLabel' in $$props) $$invalidate(9, hidePresetLabel = $$props.hidePresetLabel);\r\n\t\tif ('locale' in $$props) $$invalidate(10, locale = $$props.locale);\r\n\t\tif ('enableOpacity' in $$props) $$invalidate(11, enableOpacity = $$props.enableOpacity);\r\n\t\tif ('enablePresets' in $$props) $$invalidate(12, enablePresets = $$props.enablePresets);\r\n\t\tif ('enablePicker' in $$props) $$invalidate(13, enablePicker = $$props.enablePicker);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*value*/ 16 | $$self.$$.dirty[1] & /*valuePrev*/ 1) {\r\n\t\t\t// update initial value if supplied\r\n\t\t\tif (value && (!valuePrev || !arrayEqual(value, valuePrev))) {\r\n\t\t\t\t$$invalidate(31, valuePrev = [...value]);\r\n\t\t\t\tupdateProps(value, true);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*saturation*/ 536870912) {\r\n\t\t\t$$invalidate(22, sx = saturation * 100);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*brightness*/ 1073741824) {\r\n\t\t\t$$invalidate(21, sy = 100 - brightness * 100);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tlabel,\r\n\t\tname,\r\n\t\toptions,\r\n\t\tselectedIndex,\r\n\t\tvalue,\r\n\t\tbuttonClass,\r\n\t\toptionLabelClass,\r\n\t\toptionMapper,\r\n\t\ttitle,\r\n\t\thidePresetLabel,\r\n\t\tlocale,\r\n\t\tenableOpacity,\r\n\t\tenablePresets,\r\n\t\tenablePicker,\r\n\t\thue,\r\n\t\topacity,\r\n\t\tvalueAsRGBA,\r\n\t\tvalueAsRGBAFullyTransparent,\r\n\t\tvalueAsRGBAFullyOpaque,\r\n\t\tvalueAsRGBAFullySaturated,\r\n\t\tinput,\r\n\t\tsy,\r\n\t\tsx,\r\n\t\tupdateColorArray,\r\n\t\tupdateHue,\r\n\t\tupdateOpacity,\r\n\t\thandlePointerDown,\r\n\t\thandleNudge,\r\n\t\tonchange,\r\n\t\tsaturation,\r\n\t\tbrightness,\r\n\t\tvaluePrev,\r\n\t\tdiv2_binding,\r\n\t\tfunc,\r\n\t\tfunc_1\r\n\t];\r\n}\r\n\r\nclass ColorPicker extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$u,\r\n\t\t\tcreate_fragment$u,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tlabel: 0,\r\n\t\t\t\tname: 1,\r\n\t\t\t\toptions: 2,\r\n\t\t\t\tselectedIndex: 3,\r\n\t\t\t\tvalue: 4,\r\n\t\t\t\tbuttonClass: 5,\r\n\t\t\t\toptionLabelClass: 6,\r\n\t\t\t\toptionMapper: 7,\r\n\t\t\t\tonchange: 28,\r\n\t\t\t\ttitle: 8,\r\n\t\t\t\thidePresetLabel: 9,\r\n\t\t\t\tlocale: 10,\r\n\t\t\t\tenableOpacity: 11,\r\n\t\t\t\tenablePresets: 12,\r\n\t\t\t\tenablePicker: 13\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1]\r\n\t\t);\r\n\t}\r\n}\r\n\r\nvar upperCaseFirstLetter = (str) => str.charAt(0).toUpperCase() + str.slice(1);\r\n\r\nlet result$1 = null;\r\nvar canCheckFontAvailability = () => {\r\n    if (result$1 === null) {\r\n        if (!isBrowser())\r\n            result$1 = false;\r\n        else {\r\n            try {\r\n                // if browser can detect font as non existend then it supports font checking (only chrome)\r\n                // @ts-ignore\r\n                result$1 = document.fonts.check('16px TestNonExistingFont') === false;\r\n            }\r\n            catch (err) {\r\n                // if throws assume can't check\r\n                result$1 = false;\r\n            }\r\n        }\r\n    }\r\n    return result$1;\r\n};\r\n\r\nconst toLocaleFn = (key, localePrefix) => (locale) => locale[localePrefix ? `${localePrefix}${upperCaseFirstLetter(key)}` : key];\r\nconst mapToSizeOption = (v) => [v, `${v}`];\r\nconst createLocaleMapper = (options, localePrefix) => (key) => [options[key], toLocaleFn(key, localePrefix)];\r\nconst toolColorDefault = [1, 0.2549, 0.2118];\r\nconst toolStrokeWidthDefault = '0.5%';\r\nconst toolStrokeColorDefault = [1, 1, 1, 0];\r\n//#region tools\r\nconst toolShapeDefaults = {\r\n    eraser: () => ({\r\n        eraseRadius: 0,\r\n    }),\r\n    path: () => ({\r\n        points: [],\r\n    }),\r\n    line: () => ({\r\n        x1: 0,\r\n        y1: 0,\r\n        x2: 0,\r\n        y2: 0,\r\n        disableErase: false,\r\n    }),\r\n    rectangle: () => ({\r\n        x: 0,\r\n        y: 0,\r\n        width: 0,\r\n        height: 0,\r\n    }),\r\n    ellipse: () => ({\r\n        x: 0,\r\n        y: 0,\r\n        rx: 0,\r\n        ry: 0,\r\n    }),\r\n    text: () => ({\r\n        x: 0,\r\n        y: 0,\r\n        text: 'Text',\r\n    }),\r\n};\r\nconst createToolStyle = (type, shape = {}, options) => {\r\n    if (!toolShapeDefaults[type])\r\n        return;\r\n    const { position = 'relative', inputMode = 'drag' } = options || {};\r\n    const shapeDef = {\r\n        ...toolShapeDefaults[type](),\r\n        ...shape,\r\n    };\r\n    return [shapeDef, { position, inputMode }];\r\n};\r\nconst createToolStyles = (tools) => ({\r\n    sharpie: createToolStyle('path', {\r\n        strokeWidth: toolStrokeWidthDefault,\r\n        strokeColor: [...toolColorDefault],\r\n        disableErase: false,\r\n        disableResize: true,\r\n        disableMove: true,\r\n    }),\r\n    eraser: createToolStyle('eraser'),\r\n    path: createToolStyle('path', {\r\n        pathClose: undefined,\r\n        strokeWidth: toolStrokeWidthDefault,\r\n        strokeColor: [...toolColorDefault],\r\n        backgroundColor: [0, 0, 0, 0],\r\n    }, {\r\n        inputMode: 'step',\r\n    }),\r\n    line: createToolStyle('line', {\r\n        strokeColor: [...toolColorDefault],\r\n        strokeWidth: toolStrokeWidthDefault,\r\n    }),\r\n    arrow: createToolStyle('line', {\r\n        lineStart: 'none',\r\n        lineEnd: 'arrow-solid',\r\n        strokeColor: [...toolColorDefault],\r\n        strokeWidth: toolStrokeWidthDefault,\r\n    }),\r\n    rectangle: createToolStyle('rectangle', {\r\n        strokeColor: [...toolStrokeColorDefault],\r\n        backgroundColor: [...toolColorDefault],\r\n    }),\r\n    ellipse: createToolStyle('ellipse', {\r\n        strokeColor: [...toolStrokeColorDefault],\r\n        backgroundColor: [...toolColorDefault],\r\n    }),\r\n    text: createToolStyle('text', {\r\n        color: [...toolColorDefault],\r\n        fontSize: '2%',\r\n    }),\r\n    ...tools,\r\n});\r\n//#endregion\r\n//#region toolbar\r\nconst createToolbarItem = (tool, label, props) => [\r\n    tool,\r\n    label || toLocaleFn(tool, 'shapeLabelTool'),\r\n    {\r\n        icon: toLocaleFn(tool, 'shapeIconTool'),\r\n        ...props,\r\n    },\r\n];\r\nconst createToolbar = (tools = [\r\n    'move',\r\n    'view',\r\n    'sharpie',\r\n    'eraser',\r\n    'path',\r\n    'line',\r\n    'arrow',\r\n    'rectangle',\r\n    'ellipse',\r\n    'text',\r\n    'preset',\r\n]) => tools\r\n    .map((tool) => {\r\n    // default tool definition, assume locale in\r\n    if (isString(tool))\r\n        return createToolbarItem(tool);\r\n    // tool def with propery\r\n    if (Array.isArray(tool)) {\r\n        // state update of tool with key in locale object\r\n        if (isObject(tool[1]))\r\n            return createToolbarItem(tool[0], undefined, tool[1]);\r\n        // should be string, string\r\n        return createToolbarItem(tool[0], tool[1], tool[2]);\r\n    }\r\n})\r\n    .filter(Boolean);\r\n//#endregion\r\n//#region style option defaults\r\nconst createDefaultColorOptions = () => ({\r\n    transparent: [1, 1, 1, 0],\r\n    white: [1, 1, 1],\r\n    silver: [0.8667, 0.8667, 0.8667],\r\n    gray: [0.6667, 0.6667, 0.6667],\r\n    black: [0, 0, 0],\r\n    navy: [0, 0.1216, 0.2471],\r\n    blue: [0, 0.4549, 0.851],\r\n    aqua: [0.498, 0.8588, 1],\r\n    teal: [0.2235, 0.8, 0.8],\r\n    olive: [0.2392, 0.6, 0.4392],\r\n    green: [0.1804, 0.8, 0.251],\r\n    yellow: [1, 0.8627, 0],\r\n    orange: [1, 0.5216, 0.1059],\r\n    red: [1, 0.2549, 0.2118],\r\n    maroon: [0.5216, 0.0784, 0.2941],\r\n    fuchsia: [0.9412, 0.0706, 0.7451],\r\n    purple: [0.6941, 0.051, 0.7882],\r\n});\r\nconst createDefaultFontSizeOptions = () => [\r\n    16, 18, 20, 24, 30, 36, 48, 64, 72, 96, 128, 144,\r\n];\r\nconst createDefaultLineHeightOptions = createDefaultFontSizeOptions;\r\nconst createDefaultFontScaleOptions = () => ({\r\n    extraSmall: '2%',\r\n    small: '4%',\r\n    mediumSmall: '8%',\r\n    medium: '10%',\r\n    mediumLarge: '15%',\r\n    large: '20%',\r\n    extraLarge: '25%',\r\n});\r\nconst createDefaultLineHeightScaleOptions = () => ({\r\n    extraSmall: '40%',\r\n    small: '60%',\r\n    mediumSmall: '100%',\r\n    medium: '120%',\r\n    mediumLarge: '140%',\r\n    large: '180%',\r\n    extraLarge: '220%',\r\n});\r\nconst createDefaultStrokeWidthOptions = () => [\r\n    1, 2, 3, 4, 6, 8, 12, 16, 20, 24, 32, 48, 64,\r\n];\r\nconst createDefaultStrokeScaleOptions = () => ({\r\n    extraSmall: '0.25%',\r\n    small: '0.5%',\r\n    mediumSmall: '1%',\r\n    medium: '1.75%',\r\n    mediumLarge: '2.5%',\r\n    large: '3.5%',\r\n    extraLarge: '5%',\r\n});\r\nconst createDefaultLineEndStyleOptions = () => [\r\n    'bar',\r\n    'arrow',\r\n    'arrowSolid',\r\n    'circle',\r\n    'circleSolid',\r\n    'square',\r\n    'squareSolid',\r\n];\r\nconst createDefaultFontFamilyOptions = () => [\r\n    [`Helvetica, Arial, Verdana, 'Droid Sans', sans-serif`, 'Sans Serif'],\r\n    [`'Arial Black', 'Avenir-Black', 'Arial Bold'`, 'Black'],\r\n    [`'Arial Narrow', 'Futura-CondensedMedium'`, 'Narrow'],\r\n    [`'Trebuchet MS'`, 'Humanist'],\r\n    [`Georgia, 'Avenir-Black', 'Times New Roman', 'Droid Serif', serif`, 'Serif'],\r\n    [`Palatino`, 'Old-Style'],\r\n    [`'Times New Roman', 'TimesNewRomanPSMT'`, 'Transitional'],\r\n    [`Menlo, Monaco, 'Lucida Console', monospace`, 'Monospaced'],\r\n    [`'Courier New', monospace`, 'Slab Serif'],\r\n];\r\nconst createDefaultTextAlignOptions = () => ['left', 'center', 'right'];\r\nconst createDefaultFontStyleOptions = () => [\r\n    ['normal', 'bold'],\r\n    ['italic', 'normal'],\r\n    ['italic', 'bold'],\r\n];\r\n//#endregion\r\n//#region style options\r\nconst createColorOptions = (colors) => Object.keys(colors).map(createLocaleMapper(colors, 'shapeTitleColor'));\r\nconst createFontSizeOptions = (sizes) => sizes.map(mapToSizeOption);\r\nconst createFontScaleOptions = (scales) => Object.keys(scales).map(createLocaleMapper(scales, 'labelSize'));\r\nconst createLineHeightOptions = (sizes) => sizes.map(mapToSizeOption);\r\nconst createLineHeightScaleOptions = (scales) => Object.keys(scales).map(createLocaleMapper(scales, 'labelSize'));\r\nconst createStrokeWidthOptions = (sizes) => sizes.map(mapToSizeOption);\r\nconst createStrokeScaleOptions = (scales) => Object.keys(scales).map(createLocaleMapper(scales, 'labelSize'));\r\nconst createFontFamilyOptions = (fonts) => [...fonts];\r\nconst createFontStyleOptions = (styles) => styles.map((style) => [\r\n    style,\r\n    (locale) => locale[`shapeLabelFontStyle${style\r\n        .filter((v) => v !== 'normal')\r\n        .map(upperCaseFirstLetter)\r\n        .join('')}`],\r\n]);\r\nconst createLineEndStyleOptions = (styles) => styles.map((style) => [\r\n    toKebabCase(style),\r\n    (locale) => locale[`shapeTitleLineDecoration${upperCaseFirstLetter(style)}`],\r\n    { icon: (locale) => locale[`shapeIconLineDecoration${upperCaseFirstLetter(style)}`] },\r\n]);\r\nconst createTextAlignOptions = (options) => options.map((align) => [\r\n    align,\r\n    (locale) => locale[`shapeTitleTextAlign${upperCaseFirstLetter(align)}`],\r\n    {\r\n        hideLabel: true,\r\n        icon: (locale) => locale[`shapeIconTextAlign${upperCaseFirstLetter(align)}`],\r\n    },\r\n]);\r\nconst createControlOptions = (items, options) => {\r\n    const { defaultKey, defaultValue, defaultOptions } = options || {};\r\n    const arr = [];\r\n    if (defaultKey)\r\n        arr[0] = [defaultValue, (locale) => locale[defaultKey], { ...defaultOptions }];\r\n    return [...arr, ...items];\r\n};\r\n//#endregion\r\n//#region shape style controls\r\nconst someFontsAvailableInStack = (stack) => stack\r\n    .split(',')\r\n    .map((name) => name.trim())\r\n    .some((name) => {\r\n    return document.fonts.check(`16px ${name}`);\r\n});\r\nconst createColorControl = (items, options = {}) => [\r\n    ColorPicker,\r\n    {\r\n        title: (locale) => locale.labelColor,\r\n        options: createControlOptions(items),\r\n        ...options,\r\n    },\r\n];\r\nconst createSliderControl = (options = {}) => [\r\n    ToggleSlider,\r\n    {\r\n        ...options,\r\n    },\r\n];\r\nconst FontTestClass = 'PinturaFontTest';\r\nconst createFontFamilyControl = (fontFamilies, options = { defaultKey: 'labelDefault' }) => [\r\n    Dropdown,\r\n    {\r\n        title: (locale) => locale.shapeTitleFontFamily,\r\n        onload: ({ options = [] }) => {\r\n            // can't check for font availability so don't try\r\n            if (!canCheckFontAvailability())\r\n                return;\r\n            options\r\n                // map to font stack (option value)\r\n                .map(([stack]) => stack)\r\n                // filter out undefined\r\n                .filter(Boolean)\r\n                // filter out fonts that are available\r\n                .filter((stack) => !someFontsAvailableInStack(stack))\r\n                // remaining fonts should have dom elements for future check\r\n                .forEach((stack) => {\r\n                // get as id\r\n                const testId = `${FontTestClass}-${stack\r\n                    .replace(/[^a-zA-Z0-9]+/g, '')\r\n                    .toLowerCase()}`;\r\n                // already added this tester\r\n                if (document.getElementById(testId))\r\n                    return;\r\n                // add font tester, this triggers browser to download font\r\n                document.body.append(h('span', {\r\n                    textContent: ' ',\r\n                    id: testId,\r\n                    class: FontTestClass,\r\n                    style: `font-family:${stack};font-size:0;color:transparent;`,\r\n                }));\r\n            });\r\n        },\r\n        ondestroy: () => {\r\n            // can't check for font availability so no need to clean up\r\n            if (!canCheckFontAvailability())\r\n                return;\r\n            // clean up testers\r\n            const testers = document.querySelectorAll('.PinturaFontTest');\r\n            testers.forEach((tester) => tester.remove());\r\n        },\r\n        optionLabelStyle: (value) => `font-family: ${value}`,\r\n        options: createControlOptions(fontFamilies, options),\r\n        optionFilter: (fontFamilyOption) => {\r\n            // don't filter if not in browser context\r\n            if (!canCheckFontAvailability())\r\n                return true;\r\n            // get font stack\r\n            const [stack] = fontFamilyOption;\r\n            // allow if undefined\r\n            if (!stack)\r\n                return true;\r\n            // filter out fonts that aren't available\r\n            const res = someFontsAvailableInStack(stack);\r\n            return res;\r\n        },\r\n    },\r\n];\r\nconst createBackgroundColorControl = (items, options = {}) => [\r\n    ColorPicker,\r\n    {\r\n        title: (locale) => locale.shapeTitleBackgroundColor,\r\n        options: createControlOptions(items),\r\n        ...options,\r\n    },\r\n];\r\nconst createStrokeColorControl = (items, options = {}) => [\r\n    ColorPicker,\r\n    {\r\n        title: (locale) => locale.shapeTitleStrokeColor,\r\n        options: createControlOptions(items),\r\n        buttonClass: 'PinturaColorPickerButtonStroke',\r\n        onchange: (value, shape) => {\r\n            // get shape strokeWidth as number\r\n            const strokeWidth = shape.strokeWidth;\r\n            const strokeWidthParsed = isNumber(strokeWidth) || isString(strokeWidth) ? parseFloat(strokeWidth) : 0;\r\n            // already has outline\r\n            if (strokeWidthParsed > 0)\r\n                return;\r\n            // set outline to first stroke width\r\n            shape.strokeWidth = (options && options.defaultStrokeWidth) || '0.5%';\r\n        },\r\n        ...options,\r\n    },\r\n];\r\nconst createStrokeWidthControl = (items) => [\r\n    Dropdown,\r\n    {\r\n        title: (locale) => locale.shapeTitleStrokeWidth,\r\n        options: (shape) => {\r\n            if (hasProp(shape, 'backgroundColor'))\r\n                return createControlOptions(items, {\r\n                    defaultKey: 'shapeLabelStrokeNone',\r\n                });\r\n            return createControlOptions(items);\r\n        },\r\n        onchange: (value, shape) => {\r\n            // no width selected\r\n            if (!value)\r\n                return;\r\n            // get shape strokeColor\r\n            const strokeColor = shape.strokeColor || [];\r\n            // already has visible stroke color or has no stroke color\r\n            if (strokeColor[3])\r\n                return;\r\n            // duplicate color and assign to shape\r\n            const color = [...strokeColor];\r\n            color[3] = 1;\r\n            shape.strokeColor[3] = color;\r\n        },\r\n    },\r\n];\r\nconst createLineControl = (items, titleKey, optionIconStyle) => [\r\n    Dropdown,\r\n    {\r\n        title: (locale) => locale[titleKey],\r\n        options: createControlOptions(items, {\r\n            defaultKey: 'labelNone',\r\n            defaultOptions: {\r\n                icon: `<g stroke=\"currentColor\" stroke-linecap=\"round\" stroke-width=\".125em\"><path d=\"M5,12 H14\"/></g>`,\r\n            },\r\n        }),\r\n        optionIconStyle,\r\n    },\r\n];\r\nconst createLineStartStyleControl = (items) => createLineControl(items, 'shapeTitleLineStart', `transform: scaleX(-1)`);\r\nconst createLineEndStyleControl = (items) => createLineControl(items, 'shapeTitleLineEnd');\r\nconst createFontColorControl = (items) => [\r\n    ColorPicker,\r\n    {\r\n        title: (locale) => locale.shapeTitleTextColor,\r\n        options: createControlOptions(items),\r\n    },\r\n];\r\nconst createFontStyleControl = (items) => [\r\n    Dropdown,\r\n    {\r\n        title: (locale) => locale.shapeTitleFontStyle,\r\n        optionLabelStyle: (value) => value && `font-style:${value[0]};font-weight:${value[1]}`,\r\n        options: createControlOptions(items, {\r\n            defaultKey: 'shapeLabelFontStyleNormal',\r\n        }),\r\n    },\r\n];\r\nconst createFontSizeControl = (items) => {\r\n    let options;\r\n    if (!items.find(([value]) => value === '4%')) {\r\n        options = { defaultKey: 'labelAuto', defaultValue: '4%' };\r\n    }\r\n    return [\r\n        Dropdown,\r\n        {\r\n            title: (locale) => locale.shapeTitleFontSize,\r\n            options: createControlOptions(items, options),\r\n        },\r\n    ];\r\n};\r\nconst createTextAlignControl = (items) => [\r\n    RadioGroup,\r\n    {\r\n        title: (locale) => locale.shapeTitleTextAlign,\r\n        options: createControlOptions(items),\r\n    },\r\n];\r\nconst createLineHeightControl = (items) => {\r\n    let options;\r\n    if (!items.find(([value]) => value === '120%')) {\r\n        options = { defaultKey: 'labelAuto', defaultValue: '120%' };\r\n    }\r\n    return [\r\n        Dropdown,\r\n        {\r\n            title: (locale) => locale.shapeTitleLineHeight,\r\n            options: createControlOptions(items, options),\r\n        },\r\n    ];\r\n};\r\nconst autoFormatNumberItems = (arr) => arr.map(mapToSizeOption);\r\nconst createShapeStyleControls = (options = {}) => {\r\n    const { colorOptions = createColorOptions(createDefaultColorOptions()), lineEndStyleOptions = createLineEndStyleOptions(createDefaultLineEndStyleOptions()), fontFamilyOptions = createFontFamilyOptions(createDefaultFontFamilyOptions()), fontStyleOptions = createFontStyleOptions(createDefaultFontStyleOptions()), textAlignOptions = createTextAlignOptions(createDefaultTextAlignOptions()), } = options;\r\n    // these are let because we might overwrite them later when autoformatting\r\n    let { strokeWidthOptions = createStrokeScaleOptions(createDefaultStrokeScaleOptions()), fontSizeOptions = createFontScaleOptions(createDefaultFontScaleOptions()), lineHeightOptions = createLineHeightScaleOptions(createDefaultLineHeightScaleOptions()), } = options;\r\n    // auto format items that are all numbers\r\n    [fontSizeOptions, lineHeightOptions, strokeWidthOptions] = [\r\n        fontSizeOptions,\r\n        lineHeightOptions,\r\n        strokeWidthOptions,\r\n    ].map((items) => {\r\n        if (Array.isArray(items) && items.every(isNumber)) {\r\n            return autoFormatNumberItems(items);\r\n        }\r\n        return items;\r\n    });\r\n    const controls = {\r\n        // generic\r\n        defaultColor: colorOptions && createColorControl(colorOptions),\r\n        defaultNumber: createSliderControl(),\r\n        defaultPercentage: createSliderControl({\r\n            getValue: (value) => parseFloat(value),\r\n            setValue: (value) => `${value}%`,\r\n            step: 0.05,\r\n            label: (value, min, max) => `${Math.round((value / max) * 100)}%`,\r\n            labelClass: 'PinturaPercentageLabel',\r\n        }),\r\n        // shape background\r\n        backgroundColor: colorOptions && createBackgroundColorControl(colorOptions),\r\n        // line/outline\r\n        strokeColor: colorOptions && createStrokeColorControl(colorOptions),\r\n        strokeWidth: strokeWidthOptions && createStrokeWidthControl(strokeWidthOptions),\r\n        // line\r\n        lineStart: lineEndStyleOptions && createLineStartStyleControl(lineEndStyleOptions),\r\n        lineEnd: lineEndStyleOptions && createLineEndStyleControl(lineEndStyleOptions),\r\n        // text\r\n        color: colorOptions && createFontColorControl(colorOptions),\r\n        fontFamily: fontFamilyOptions && createFontFamilyControl(fontFamilyOptions),\r\n        fontStyle_fontWeight: fontStyleOptions && createFontStyleControl(fontStyleOptions),\r\n        fontSize: fontSizeOptions && createFontSizeControl(fontSizeOptions),\r\n        lineHeight: lineHeightOptions && createLineHeightControl(lineHeightOptions),\r\n        textAlign: textAlignOptions && createTextAlignControl(textAlignOptions),\r\n        // rect\r\n        cornerRadius: [\r\n            'defaultPercentage',\r\n            {\r\n                min: 0,\r\n                max: 50,\r\n                title: (locale) => locale.shapeTitleCornerRadius,\r\n            },\r\n        ],\r\n        // generic options\r\n        frameColor: ['defaultColor'],\r\n        frameSize: [\r\n            'defaultPercentage',\r\n            {\r\n                min: 0.2,\r\n                max: 10,\r\n                title: (locale) => locale.labelSize,\r\n            },\r\n        ],\r\n        frameInset: [\r\n            'defaultPercentage',\r\n            { min: 0.5, max: 10, title: (locale) => locale.labelInset },\r\n        ],\r\n        frameOffset: [\r\n            'defaultPercentage',\r\n            { min: 0.5, max: 10, title: (locale) => locale.labelOffset },\r\n        ],\r\n        frameRadius: [\r\n            'defaultPercentage',\r\n            { min: 0.5, max: 10, title: (locale) => locale.labelRadius },\r\n        ],\r\n        frameAmount: [\r\n            'defaultNumber',\r\n            { min: 1, max: 5, step: 1, title: (locale) => locale.labelAmount },\r\n        ],\r\n    };\r\n    // assign custom entries (eraseRadius), maybe expand in future to assign all items this way\r\n    Object.entries(options).forEach(([key, value]) => {\r\n        if (controls[key])\r\n            return;\r\n        controls[key] = value;\r\n    });\r\n    return controls;\r\n};\r\n//#endregion\r\n\r\n/* src/core/ui/components/Measure.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$t(ctx) {\r\n\tlet div;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tconst default_slot_template = /*#slots*/ ctx[4].default;\r\n\tconst default_slot = create_slot(default_slot_template, ctx, /*$$scope*/ ctx[3], null);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (default_slot) default_slot.c();\r\n\t\t\tattr(div, \"class\", /*klass*/ ctx[0]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tdefault_slot.m(div, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(div, \"measure\", function () {\r\n\t\t\t\t\t\tif (is_function(/*didMount*/ ctx[1] && /*handleResize*/ ctx[2])) (/*didMount*/ ctx[1] && /*handleResize*/ ctx[2]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(new_ctx, [dirty]) {\r\n\t\t\tctx = new_ctx;\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tif (default_slot.p && (!current || dirty & /*$$scope*/ 8)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tdefault_slot,\r\n\t\t\t\t\t\tdefault_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[3],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[3])\r\n\t\t\t\t\t\t: get_slot_changes(default_slot_template, /*$$scope*/ ctx[3], dirty, null),\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*klass*/ 1) {\r\n\t\t\t\tattr(div, \"class\", /*klass*/ ctx[0]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(default_slot, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(default_slot, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif (default_slot) default_slot.d(detaching);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$t($$self, $$props, $$invalidate) {\r\n\tlet { $$slots: slots = {}, $$scope } = $$props;\r\n\tconst dispatch = createEventDispatcher();\r\n\tlet { class: klass = null } = $$props;\r\n\tlet didMount = false;\r\n\tconst handleResize = ({ detail }) => dispatch('measure', detail);\r\n\tonMount(() => $$invalidate(1, didMount = true));\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('class' in $$props) $$invalidate(0, klass = $$props.class);\r\n\t\tif ('$$scope' in $$props) $$invalidate(3, $$scope = $$props.$$scope);\r\n\t};\r\n\r\n\treturn [klass, didMount, handleResize, $$scope, slots];\r\n}\r\n\r\nclass Measure extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\t\tinit(this, options, instance$t, create_fragment$t, safe_not_equal, { class: 0 });\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/Util.svelte generated by Svelte v3.50.1 */\r\nconst get_footer_slot_changes = dirty => ({});\r\nconst get_footer_slot_context = ctx => ({});\r\nconst get_main_slot_changes = dirty => ({});\r\nconst get_main_slot_context = ctx => ({});\r\nconst get_header_slot_changes = dirty => ({});\r\nconst get_header_slot_context = ctx => ({});\r\n\r\n// (10:0) {#if hasHeader}\r\nfunction create_if_block_2$4(ctx) {\r\n\tlet div;\r\n\tlet current;\r\n\tconst header_slot_template = /*#slots*/ ctx[4].header;\r\n\tconst header_slot = create_slot(header_slot_template, ctx, /*$$scope*/ ctx[3], get_header_slot_context);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (header_slot) header_slot.c();\r\n\t\t\tattr(div, \"class\", \"PinturaUtilHeader\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\r\n\t\t\tif (header_slot) {\r\n\t\t\t\theader_slot.m(div, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (header_slot) {\r\n\t\t\t\tif (header_slot.p && (!current || dirty & /*$$scope*/ 8)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\theader_slot,\r\n\t\t\t\t\t\theader_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[3],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[3])\r\n\t\t\t\t\t\t: get_slot_changes(header_slot_template, /*$$scope*/ ctx[3], dirty, get_header_slot_changes),\r\n\t\t\t\t\t\tget_header_slot_context\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(header_slot, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(header_slot, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif (header_slot) header_slot.d(detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (17:22) <Measure class=\"PinturaStage\" on:measure />\r\nfunction fallback_block(ctx) {\r\n\tlet measure;\r\n\tlet current;\r\n\tmeasure = new Measure({ props: { class: \"PinturaStage\" } });\r\n\tmeasure.$on(\"measure\", /*measure_handler*/ ctx[5]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(measure.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(measure, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp: noop,\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(measure.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(measure.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(measure, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (20:0) {#if hasFooter}\r\nfunction create_if_block_1$5(ctx) {\r\n\tlet div;\r\n\tlet current;\r\n\tconst footer_slot_template = /*#slots*/ ctx[4].footer;\r\n\tconst footer_slot = create_slot(footer_slot_template, ctx, /*$$scope*/ ctx[3], get_footer_slot_context);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (footer_slot) footer_slot.c();\r\n\t\t\tattr(div, \"class\", \"PinturaUtilFooter\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\r\n\t\t\tif (footer_slot) {\r\n\t\t\t\tfooter_slot.m(div, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (footer_slot) {\r\n\t\t\t\tif (footer_slot.p && (!current || dirty & /*$$scope*/ 8)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tfooter_slot,\r\n\t\t\t\t\t\tfooter_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[3],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[3])\r\n\t\t\t\t\t\t: get_slot_changes(footer_slot_template, /*$$scope*/ ctx[3], dirty, get_footer_slot_changes),\r\n\t\t\t\t\t\tget_footer_slot_context\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(footer_slot, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(footer_slot, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif (footer_slot) footer_slot.d(detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$s(ctx) {\r\n\tlet t0;\r\n\tlet div;\r\n\tlet t1;\r\n\tlet t2;\r\n\tlet if_block2_anchor;\r\n\tlet current;\r\n\tlet if_block0 = /*hasHeader*/ ctx[1] && create_if_block_2$4(ctx);\r\n\tconst main_slot_template = /*#slots*/ ctx[4].main;\r\n\tconst main_slot = create_slot(main_slot_template, ctx, /*$$scope*/ ctx[3], get_main_slot_context);\r\n\tconst main_slot_or_fallback = main_slot || fallback_block(ctx);\r\n\tlet if_block1 = /*hasFooter*/ ctx[2] && create_if_block_1$5(ctx);\r\n\tlet if_block2 = false ;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (if_block0) if_block0.c();\r\n\t\t\tt0 = space();\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (main_slot_or_fallback) main_slot_or_fallback.c();\r\n\t\t\tt1 = space();\r\n\t\t\tif (if_block1) if_block1.c();\r\n\t\t\tt2 = space();\r\n\t\t\tif_block2_anchor = empty();\r\n\t\t\tattr(div, \"class\", \"PinturaUtilMain\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (if_block0) if_block0.m(target, anchor);\r\n\t\t\tinsert(target, t0, anchor);\r\n\t\t\tinsert(target, div, anchor);\r\n\r\n\t\t\tif (main_slot_or_fallback) {\r\n\t\t\t\tmain_slot_or_fallback.m(div, null);\r\n\t\t\t}\r\n\r\n\t\t\t/*div_binding*/ ctx[6](div);\r\n\t\t\tinsert(target, t1, anchor);\r\n\t\t\tif (if_block1) if_block1.m(target, anchor);\r\n\t\t\tinsert(target, t2, anchor);\r\n\t\t\tinsert(target, if_block2_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tif (/*hasHeader*/ ctx[1]) {\r\n\t\t\t\tif (if_block0) {\r\n\t\t\t\t\tif_block0.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty & /*hasHeader*/ 2) {\r\n\t\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block0 = create_if_block_2$4(ctx);\r\n\t\t\t\t\tif_block0.c();\r\n\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\tif_block0.m(t0.parentNode, t0);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block0) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block0, 1, 1, () => {\r\n\t\t\t\t\tif_block0 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (main_slot) {\r\n\t\t\t\tif (main_slot.p && (!current || dirty & /*$$scope*/ 8)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tmain_slot,\r\n\t\t\t\t\t\tmain_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[3],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[3])\r\n\t\t\t\t\t\t: get_slot_changes(main_slot_template, /*$$scope*/ ctx[3], dirty, get_main_slot_changes),\r\n\t\t\t\t\t\tget_main_slot_context\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (/*hasFooter*/ ctx[2]) {\r\n\t\t\t\tif (if_block1) {\r\n\t\t\t\t\tif_block1.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty & /*hasFooter*/ 4) {\r\n\t\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block1 = create_if_block_1$5(ctx);\r\n\t\t\t\t\tif_block1.c();\r\n\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\tif_block1.m(t2.parentNode, t2);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block1) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block1, 1, 1, () => {\r\n\t\t\t\t\tif_block1 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block0);\r\n\t\t\ttransition_in(main_slot_or_fallback, local);\r\n\t\t\ttransition_in(if_block1);\r\n\t\t\ttransition_in(if_block2);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block0);\r\n\t\t\ttransition_out(main_slot_or_fallback, local);\r\n\t\t\ttransition_out(if_block1);\r\n\t\t\ttransition_out(if_block2);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (if_block0) if_block0.d(detaching);\r\n\t\t\tif (detaching) detach(t0);\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif (main_slot_or_fallback) main_slot_or_fallback.d(detaching);\r\n\t\t\t/*div_binding*/ ctx[6](null);\r\n\t\t\tif (detaching) detach(t1);\r\n\t\t\tif (if_block1) if_block1.d(detaching);\r\n\t\t\tif (detaching) detach(t2);\r\n\t\t\tif (detaching) detach(if_block2_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$s($$self, $$props, $$invalidate) {\r\n\tlet { $$slots: slots = {}, $$scope } = $$props;\r\n\tlet { hasHeader = !!$$props.$$slots.header } = $$props;\r\n\tlet { hasFooter = !!$$props.$$slots.footer } = $$props;\r\n\tlet { root = undefined } = $$props;\r\n\r\n\tfunction measure_handler(event) {\r\n\t\tbubble.call(this, $$self, event);\r\n\t}\r\n\r\n\tfunction div_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\troot = $$value;\r\n\t\t\t$$invalidate(0, root);\r\n\t\t});\r\n\t}\r\n\r\n\t$$self.$$set = $$new_props => {\r\n\t\t$$invalidate(7, $$props = assign(assign({}, $$props), exclude_internal_props($$new_props)));\r\n\t\tif ('hasHeader' in $$new_props) $$invalidate(1, hasHeader = $$new_props.hasHeader);\r\n\t\tif ('hasFooter' in $$new_props) $$invalidate(2, hasFooter = $$new_props.hasFooter);\r\n\t\tif ('root' in $$new_props) $$invalidate(0, root = $$new_props.root);\r\n\t\tif ('$$scope' in $$new_props) $$invalidate(3, $$scope = $$new_props.$$scope);\r\n\t};\r\n\r\n\t$$props = exclude_internal_props($$props);\r\n\treturn [root, hasHeader, hasFooter, $$scope, slots, measure_handler, div_binding];\r\n}\r\n\r\nclass Util extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\t\tinit(this, options, instance$s, create_fragment$s, safe_not_equal, { hasHeader: 1, hasFooter: 2, root: 0 });\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/RangeInput.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_if_block$5(ctx) {\r\n\tlet div;\r\n\tlet div_style_value;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tattr(div, \"class\", \"PinturaRangeInputMeter\");\r\n\t\t\tattr(div, \"style\", div_style_value = `transform: translateX(${/*$position*/ ctx[9].x - /*svgPadding*/ ctx[11].x}px) translateY(${/*$position*/ ctx[9].y - /*svgPadding*/ ctx[11].y}px)`);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tdiv.innerHTML = /*svg*/ ctx[7];\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[0] & /*svg*/ 128) div.innerHTML = /*svg*/ ctx[7];\r\n\t\t\tif (dirty[0] & /*$position*/ 512 && div_style_value !== (div_style_value = `transform: translateX(${/*$position*/ ctx[9].x - /*svgPadding*/ ctx[11].x}px) translateY(${/*$position*/ ctx[9].y - /*svgPadding*/ ctx[11].y}px)`)) {\r\n\t\t\t\tattr(div, \"style\", div_style_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$r(ctx) {\r\n\tlet div1;\r\n\tlet span;\r\n\tlet t0;\r\n\tlet button;\r\n\tlet t1;\r\n\tlet button_disabled_value;\r\n\tlet t2;\r\n\tlet div0;\r\n\tlet interactable_action;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tlet if_block = /*$position*/ ctx[9] && create_if_block$5(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv1 = element(\"div\");\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt0 = space();\r\n\t\t\tbutton = element(\"button\");\r\n\t\t\tt1 = text(/*labelReset*/ ctx[1]);\r\n\t\t\tt2 = space();\r\n\t\t\tdiv0 = element(\"div\");\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tattr(span, \"class\", \"PinturaRangeInputValue\");\r\n\t\t\tattr(button, \"class\", \"PinturaRangeInputReset\");\r\n\t\t\tattr(button, \"type\", \"button\");\r\n\t\t\tbutton.disabled = button_disabled_value = /*value*/ ctx[0] === /*base*/ ctx[2];\r\n\t\t\tattr(div0, \"class\", \"PinturaRangeInputInner\");\r\n\t\t\tattr(div0, \"style\", /*rangeMask*/ ctx[8]);\r\n\t\t\tattr(div0, \"data-value-limited\", /*isLimited*/ ctx[5]);\r\n\t\t\tattr(div1, \"class\", \"PinturaRangeInput\");\r\n\t\t\tattr(div1, \"tabindex\", \"0\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div1, anchor);\r\n\t\t\tappend(div1, span);\r\n\t\t\tspan.innerHTML = /*valueLabel*/ ctx[3];\r\n\t\t\tappend(div1, t0);\r\n\t\t\tappend(div1, button);\r\n\t\t\tappend(button, t1);\r\n\t\t\tappend(div1, t2);\r\n\t\t\tappend(div1, div0);\r\n\t\t\tif (if_block) if_block.m(div0, null);\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(button, \"click\", /*handleReset*/ ctx[16]),\r\n\t\t\t\t\tlisten(div0, \"interactionstart\", /*handleDragStart*/ ctx[12]),\r\n\t\t\t\t\tlisten(div0, \"interactionupdate\", /*handleDragMove*/ ctx[14]),\r\n\t\t\t\t\tlisten(div0, \"interactionend\", /*handleDragEnd*/ ctx[15]),\r\n\t\t\t\t\tlisten(div0, \"interactionrelease\", /*handleDragRelease*/ ctx[13]),\r\n\t\t\t\t\taction_destroyer(interactable_action = interactable.call(null, div0, { inertia: /*$isAnimated*/ ctx[6] })),\r\n\t\t\t\t\tlisten(div0, \"measure\", /*measure_handler*/ ctx[35]),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div0)),\r\n\t\t\t\t\tlisten(div1, \"wheel\", /*handleWheel*/ ctx[18], { passive: false }),\r\n\t\t\t\t\tlisten(div1, \"nudge\", /*handleNudge*/ ctx[19]),\r\n\t\t\t\t\taction_destroyer(nudgeable.call(null, div1, {\r\n\t\t\t\t\t\tdirection: 'horizontal',\r\n\t\t\t\t\t\tpreventDefault: true\r\n\t\t\t\t\t}))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[0] & /*valueLabel*/ 8) span.innerHTML = /*valueLabel*/ ctx[3];\t\t\tif (dirty[0] & /*labelReset*/ 2) set_data(t1, /*labelReset*/ ctx[1]);\r\n\r\n\t\t\tif (dirty[0] & /*value, base*/ 5 && button_disabled_value !== (button_disabled_value = /*value*/ ctx[0] === /*base*/ ctx[2])) {\r\n\t\t\t\tbutton.disabled = button_disabled_value;\r\n\t\t\t}\r\n\r\n\t\t\tif (/*$position*/ ctx[9]) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block$5(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\tif_block.m(div0, null);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tif_block.d(1);\r\n\t\t\t\tif_block = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty[0] & /*rangeMask*/ 256) {\r\n\t\t\t\tattr(div0, \"style\", /*rangeMask*/ ctx[8]);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty[0] & /*isLimited*/ 32) {\r\n\t\t\t\tattr(div0, \"data-value-limited\", /*isLimited*/ ctx[5]);\r\n\t\t\t}\r\n\r\n\t\t\tif (interactable_action && is_function(interactable_action.update) && dirty[0] & /*$isAnimated*/ 64) interactable_action.update.call(null, { inertia: /*$isAnimated*/ ctx[6] });\r\n\t\t},\r\n\t\ti: noop,\r\n\t\to: noop,\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div1);\r\n\t\t\tif (if_block) if_block.d();\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nconst radiusBig = 2; // 2\r\nconst radiusSmall = 0.75; // .75\r\nconst indicatorSpacing = 10;\r\nconst indicatorInterval = 5;\r\nconst indicatorCount = 40; // must be even\r\n\r\nfunction instance$r($$self, $$props, $$invalidate) {\r\n\tlet range;\r\n\tlet valueMinLimited;\r\n\tlet valueMaxLimited;\r\n\tlet barSize;\r\n\tlet baseFraction;\r\n\tlet isLimited;\r\n\tlet rangeMask;\r\n\tlet $isAnimated;\r\n\tlet $position;\r\n\tlet { labelReset = 'Reset' } = $$props;\r\n\tlet { direction = 'x' } = $$props;\r\n\tlet { min = 0 } = $$props;\r\n\tlet { max = 1 } = $$props;\r\n\tlet { base = min } = $$props;\r\n\tlet { value = 0 } = $$props;\r\n\tlet { valueLabel = 0 } = $$props;\r\n\tlet { valueMin = undefined } = $$props;\r\n\tlet { valueMax = undefined } = $$props;\r\n\tlet { oninputstart = noop$1 } = $$props;\r\n\tlet { oninputmove = noop$1 } = $$props;\r\n\tlet { oninputend = noop$1 } = $$props;\r\n\tlet { elasticity = 0 } = $$props;\r\n\tlet { nudgeMultiplier = undefined } = $$props;\r\n\r\n\t//\r\n\t// context\r\n\t//\r\n\tconst isAnimated = getContext('isAnimated');\r\n\r\n\tcomponent_subscribe($$self, isAnimated, value => $$invalidate(6, $isAnimated = value));\r\n\tconst round = (number, increment, offset) => Math.ceil((number - offset) / increment) * increment + offset;\r\n\tlet size;\r\n\tlet svg;\r\n\tlet svgSize;\r\n\tconst svgPadding = { x: 2, y: 0 };\r\n\tconst createPathCircle = (cx, cy, r) => `M ${cx - r} ${cy} a ${r} ${r} 0 1 0 0 -1`;\r\n\r\n\tfunction getMask(limitedMin, limitedMax) {\r\n\t\tconst step = 1 / indicatorCount;\r\n\t\tconst from = toFraction(limitedMin, min, max);\r\n\t\tconst to = toFraction(limitedMax, min, max);\r\n\t\tconst fromSnapped = fixPrecision(round(from, step, 0) - step * 0.5);\r\n\t\tconst toSnapped = fixPrecision(round(to, step, 0) - step * 0.5);\r\n\t\treturn `--range-mask-from:${fromSnapped * 100}%;--range-mask-to:${toSnapped * 100}%`;\r\n\t}\r\n\r\n\t//\r\n\t// Dragging related\r\n\t//\r\n\tlet interactionOrigin = undefined;\r\n\r\n\tlet interactionReleased = false;\r\n\tlet interactionRange;\r\n\tlet interactionOptions = { snap: false, elastic: false };\r\n\r\n\tconst handleDragStart = () => {\r\n\t\tinteractionReleased = false;\r\n\t\tinteractionOrigin = get_store_value(position);\r\n\r\n\t\tinteractionRange = [\r\n\t\t\tvalueToPosition(valueMin != null ? valueMin : min, direction),\r\n\t\t\tvalueToPosition(valueMax != null ? valueMax : max, direction)\r\n\t\t];\r\n\r\n\t\toninputstart();\r\n\t};\r\n\r\n\tconst handleDragRelease = () => {\r\n\t\tinteractionReleased = true;\r\n\t};\r\n\r\n\tconst handleDragMove = ({ detail }) => {\r\n\t\tinteractionOptions.snap = !interactionReleased;\r\n\t\tinteractionOptions.elastic = !interactionReleased;\r\n\t\ttranslatePosition(interactionOrigin, detail.translation, interactionOptions);\r\n\t};\r\n\r\n\tconst handleDragEnd = ({ detail }) => {\r\n\t\tinteractionOptions.snap = false;\r\n\t\tinteractionOptions.elastic = false;\r\n\t\tconst valueAtPosition = translatePosition(interactionOrigin, detail.translation, interactionOptions);\r\n\t\tinteractionOrigin = undefined;\r\n\t\tinteractionRange = undefined;\r\n\r\n\t\t// if is near base position, set to base\r\n\t\tif (Math.abs(valueAtPosition - base) < 0.01) return oninputend(base);\r\n\r\n\t\toninputend(valueAtPosition);\r\n\t};\r\n\r\n\tconst translatePosition = (origin, translation, options) => {\r\n\t\tconst target = origin[direction] + translation[direction];\r\n\t\tconst targetLimited = clamp(target, interactionRange[1][direction], interactionRange[0][direction]);\r\n\r\n\t\tconst targetElastic = elasticity\r\n\t\t? targetLimited + elastify(target - targetLimited, elasticity)\r\n\t\t: targetLimited;\r\n\r\n\t\tconst targetVisual = options.elastic ? targetElastic : targetLimited;\r\n\r\n\t\t// set position\r\n\t\tconst targetValid = vectorCreate(0, 0);\r\n\r\n\t\ttargetValid[direction] = targetVisual;\r\n\t\tposition.set(targetValid, { hard: options.snap });\r\n\t\treturn clamp(positionToValue(targetValid, direction), min, max);\r\n\t};\r\n\r\n\tconst handleReset = () => {\r\n\t\t$$invalidate(0, value = clamp(base, valueMinLimited, valueMaxLimited));\r\n\t\toninputstart();\r\n\t\toninputend(value);\r\n\t};\r\n\r\n\t//\r\n\t// Meter position and value updates\r\n\t//\r\n\tconst position = spring();\r\n\r\n\tcomponent_subscribe($$self, position, value => $$invalidate(9, $position = value));\r\n\r\n\tconst valueToPosition = (value, axis) => {\r\n\t\tconst offset = (size[axis] - barSize[axis]) * 0.5;\r\n\t\tconst fraction = toFraction(value, min, max);\r\n\t\tconst v = fraction * barSize[axis] - barSize[axis] * 0.5;\r\n\t\tconst pos = offset - v;\r\n\r\n\t\treturn {\r\n\t\t\tx: axis === 'x' ? pos : 0,\r\n\t\t\ty: axis === 'y' ? pos : 0\r\n\t\t};\r\n\t};\r\n\r\n\tconst positionToValue = (position, axis) => {\r\n\t\tconst dist = position[axis] - size[axis] * 0.5;\r\n\t\tconst fraction = -(dist / barSize[axis]);\r\n\t\treturn min + fraction * range;\r\n\t};\r\n\r\n\tconst positionUnsub = position.subscribe(currentPosition => {\r\n\t\t// if not positioned yet or is not interacting we're not interested in this event\r\n\t\tif (!currentPosition || !interactionOrigin) return;\r\n\r\n\t\toninputmove(clamp(positionToValue(currentPosition, direction), min, max));\r\n\t});\r\n\r\n\tconst updatePosition = value => {\r\n\t\tconst interactionRange = [\r\n\t\t\tvalueToPosition(valueMin != null ? valueMin : min, direction),\r\n\t\t\tvalueToPosition(valueMax != null ? valueMax : max, direction)\r\n\t\t];\r\n\r\n\t\tconst target = {\r\n\t\t\tx: direction === 'x' ? $position.x + value : 0,\r\n\t\t\ty: direction === 'y' ? $position.y + value : 0\r\n\t\t};\r\n\r\n\t\tconst targetLimited = clamp(target[direction], interactionRange[1][direction], interactionRange[0][direction]);\r\n\t\tconst positionTarget = { ...$position, [direction]: targetLimited };\r\n\t\tset_store_value(position, $position = positionTarget, $position);\r\n\t\tconst result = clamp(positionToValue(positionTarget, direction), min, max);\r\n\t\toninputstart();\r\n\t\toninputmove(result);\r\n\t\toninputend(result);\r\n\t};\r\n\r\n\tconst handleWheel = e => {\r\n\t\t// don't run default actions, prevent other actions from running\r\n\t\te.preventDefault();\r\n\r\n\t\te.stopPropagation();\r\n\r\n\t\t// apply wheel delta to offset\r\n\t\tconst step = 8;\r\n\r\n\t\tconst delta = getWheelDelta(e) * step;\r\n\t\tupdatePosition(delta);\r\n\t};\r\n\r\n\tconst handleNudge = ({ detail }) => {\r\n\t\tupdatePosition(detail[direction] * Math.abs(nudgeMultiplier || 8));\r\n\t};\r\n\r\n\tonDestroy(() => {\r\n\t\tpositionUnsub();\r\n\t});\r\n\r\n\tconst measure_handler = e => $$invalidate(4, size = vectorCreateFromSize(e.detail));\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('labelReset' in $$props) $$invalidate(1, labelReset = $$props.labelReset);\r\n\t\tif ('direction' in $$props) $$invalidate(20, direction = $$props.direction);\r\n\t\tif ('min' in $$props) $$invalidate(21, min = $$props.min);\r\n\t\tif ('max' in $$props) $$invalidate(22, max = $$props.max);\r\n\t\tif ('base' in $$props) $$invalidate(2, base = $$props.base);\r\n\t\tif ('value' in $$props) $$invalidate(0, value = $$props.value);\r\n\t\tif ('valueLabel' in $$props) $$invalidate(3, valueLabel = $$props.valueLabel);\r\n\t\tif ('valueMin' in $$props) $$invalidate(23, valueMin = $$props.valueMin);\r\n\t\tif ('valueMax' in $$props) $$invalidate(24, valueMax = $$props.valueMax);\r\n\t\tif ('oninputstart' in $$props) $$invalidate(25, oninputstart = $$props.oninputstart);\r\n\t\tif ('oninputmove' in $$props) $$invalidate(26, oninputmove = $$props.oninputmove);\r\n\t\tif ('oninputend' in $$props) $$invalidate(27, oninputend = $$props.oninputend);\r\n\t\tif ('elasticity' in $$props) $$invalidate(28, elasticity = $$props.elasticity);\r\n\t\tif ('nudgeMultiplier' in $$props) $$invalidate(29, nudgeMultiplier = $$props.nudgeMultiplier);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*max, min*/ 6291456) {\r\n\t\t\t//\r\n\t\t\t// derived\r\n\t\t\t//\r\n\t\t\t$$invalidate(31, range = max - min);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*valueMin, min*/ 10485760) {\r\n\t\t\t$$invalidate(33, valueMinLimited = valueMin != null ? Math.max(valueMin, min) : min);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*valueMax, max*/ 20971520) {\r\n\t\t\t$$invalidate(32, valueMaxLimited = valueMax != null ? Math.min(valueMax, max) : max);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*base, min, max*/ 6291460) {\r\n\t\t\t$$invalidate(34, baseFraction = toFraction(base, min, max));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*size*/ 16 | $$self.$$.dirty[1] & /*baseFraction*/ 8) {\r\n\t\t\tif (size) {\r\n\t\t\t\tconst centerY = size.y * 0.5;\r\n\t\t\t\tlet indicatorCenter = indicatorCount * baseFraction;\r\n\t\t\t\tlet d = '';\r\n\t\t\t\tlet svgWidth;\r\n\t\t\t\tlet svgHeight = size.y;\r\n\t\t\t\tlet centerShape = '';\r\n\r\n\t\t\t\tfor (let i = 0; i <= indicatorCount; i++) {\r\n\t\t\t\t\tconst x = svgPadding.x + i * indicatorSpacing;\r\n\t\t\t\t\tconst y = centerY;\r\n\t\t\t\t\tconst r = i % indicatorInterval === 0 ? radiusBig : radiusSmall;\r\n\t\t\t\t\td += createPathCircle(x, y, r) + ' ';\r\n\t\t\t\t\tsvgWidth = x + svgPadding.x;\r\n\r\n\t\t\t\t\tif (i === indicatorCenter) {\r\n\t\t\t\t\t\tcenterShape = `<path d=\"M${x} ${y - 4} l2 3 l-2 -1 l-2 1 z\"/>`;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$$invalidate(7, svg = `<svg width=\"${svgWidth}\" height=\"${svgHeight}\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 ${svgWidth} ${svgHeight}\" aria-hidden=\"true\" focusable=\"false\">\r\n        ${centerShape}\r\n        <rect rx=\"4\" ry=\"4\" y=\"${centerY - 4}\"\" height=\"8\"/>\r\n        <path fill-rule=\"evenodd\" d=\"${d.trim()}\"/></svg>`);\r\n\r\n\t\t\t\t$$invalidate(30, svgSize = {\r\n\t\t\t\t\tx: svgWidth - svgPadding.x * 2,\r\n\t\t\t\t\ty: svgHeight\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*size, svgSize*/ 1073741840) {\r\n\t\t\tbarSize = size && svgSize;\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*min, max*/ 6291456 | $$self.$$.dirty[1] & /*valueMinLimited, valueMaxLimited*/ 6) {\r\n\t\t\t$$invalidate(5, isLimited = valueMinLimited !== min || valueMaxLimited !== max);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*isLimited*/ 32 | $$self.$$.dirty[1] & /*valueMinLimited, valueMaxLimited*/ 6) {\r\n\t\t\t$$invalidate(8, rangeMask = isLimited\r\n\t\t\t? getMask(valueMinLimited, valueMaxLimited)\r\n\t\t\t: '');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*size, value, direction, $isAnimated*/ 1048657 | $$self.$$.dirty[1] & /*range*/ 1) {\r\n\t\t\t// if has size (range is in here so the position is updated if the range is changed)\r\n\t\t\tif (range && size && size.x && size.y) {\r\n\t\t\t\tposition.set(valueToPosition(value, direction), { hard: $isAnimated === false });\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tvalue,\r\n\t\tlabelReset,\r\n\t\tbase,\r\n\t\tvalueLabel,\r\n\t\tsize,\r\n\t\tisLimited,\r\n\t\t$isAnimated,\r\n\t\tsvg,\r\n\t\trangeMask,\r\n\t\t$position,\r\n\t\tisAnimated,\r\n\t\tsvgPadding,\r\n\t\thandleDragStart,\r\n\t\thandleDragRelease,\r\n\t\thandleDragMove,\r\n\t\thandleDragEnd,\r\n\t\thandleReset,\r\n\t\tposition,\r\n\t\thandleWheel,\r\n\t\thandleNudge,\r\n\t\tdirection,\r\n\t\tmin,\r\n\t\tmax,\r\n\t\tvalueMin,\r\n\t\tvalueMax,\r\n\t\toninputstart,\r\n\t\toninputmove,\r\n\t\toninputend,\r\n\t\telasticity,\r\n\t\tnudgeMultiplier,\r\n\t\tsvgSize,\r\n\t\trange,\r\n\t\tvalueMaxLimited,\r\n\t\tvalueMinLimited,\r\n\t\tbaseFraction,\r\n\t\tmeasure_handler\r\n\t];\r\n}\r\n\r\nclass RangeInput extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$r,\r\n\t\t\tcreate_fragment$r,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tlabelReset: 1,\r\n\t\t\t\tdirection: 20,\r\n\t\t\t\tmin: 21,\r\n\t\t\t\tmax: 22,\r\n\t\t\t\tbase: 2,\r\n\t\t\t\tvalue: 0,\r\n\t\t\t\tvalueLabel: 3,\r\n\t\t\t\tvalueMin: 23,\r\n\t\t\t\tvalueMax: 24,\r\n\t\t\t\toninputstart: 25,\r\n\t\t\t\toninputmove: 26,\r\n\t\t\t\toninputend: 27,\r\n\t\t\t\telasticity: 28,\r\n\t\t\t\tnudgeMultiplier: 29\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1]\r\n\t\t);\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/Toolbar.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$q(ctx) {\r\n\tlet div1;\r\n\tlet div0;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tconst default_slot_template = /*#slots*/ ctx[7].default;\r\n\tconst default_slot = create_slot(default_slot_template, ctx, /*$$scope*/ ctx[6], null);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv1 = element(\"div\");\r\n\t\t\tdiv0 = element(\"div\");\r\n\t\t\tif (default_slot) default_slot.c();\r\n\t\t\tattr(div0, \"class\", \"PinturaToolbarInner\");\r\n\t\t\tattr(div1, \"class\", \"PinturaToolbar\");\r\n\t\t\tattr(div1, \"data-layout\", /*layout*/ ctx[1]);\r\n\t\t\tattr(div1, \"data-overflow\", /*overflow*/ ctx[0]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div1, anchor);\r\n\t\t\tappend(div1, div0);\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tdefault_slot.m(div0, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(div0, \"measure\", /*handleChildResizeEvent*/ ctx[3]),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div0)),\r\n\t\t\t\t\tlisten(div1, \"measure\", /*handleParentResizeEvent*/ ctx[2]),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div1))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tif (default_slot.p && (!current || dirty & /*$$scope*/ 64)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tdefault_slot,\r\n\t\t\t\t\t\tdefault_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[6],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[6])\r\n\t\t\t\t\t\t: get_slot_changes(default_slot_template, /*$$scope*/ ctx[6], dirty, null),\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*layout*/ 2) {\r\n\t\t\t\tattr(div1, \"data-layout\", /*layout*/ ctx[1]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*overflow*/ 1) {\r\n\t\t\t\tattr(div1, \"data-overflow\", /*overflow*/ ctx[0]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(default_slot, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(default_slot, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div1);\r\n\t\t\tif (default_slot) default_slot.d(detaching);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$q($$self, $$props, $$invalidate) {\r\n\tlet layout;\r\n\tlet { $$slots: slots = {}, $$scope } = $$props;\r\n\tlet childWidth = 0;\r\n\tlet childMaxWidth = 0;\r\n\tlet parentWidth = 0;\r\n\tlet overflow;\r\n\r\n\tconst testOverflow = () => {\r\n\t\t$$invalidate(0, overflow = layout === 'compact' && childWidth > parentWidth\r\n\t\t? 'overflow'\r\n\t\t: undefined);\r\n\t};\r\n\r\n\tconst handleParentResizeEvent = ({ detail }) => {\r\n\t\tconst { width } = detail;\r\n\t\t$$invalidate(5, parentWidth = width);\r\n\t\ttestOverflow();\r\n\t};\r\n\r\n\tconst handleChildResizeEvent = ({ detail }) => {\r\n\t\tconst { width } = detail;\r\n\r\n\t\tif (width > childMaxWidth) {\r\n\t\t\t$$invalidate(4, childMaxWidth = width);\r\n\t\t}\r\n\r\n\t\tchildWidth = width;\r\n\t\tif (!overflow) testOverflow();\r\n\t};\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('$$scope' in $$props) $$invalidate(6, $$scope = $$props.$$scope);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*childMaxWidth, parentWidth*/ 48) {\r\n\t\t\t$$invalidate(1, layout = childMaxWidth > parentWidth ? 'compact' : 'default');\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\toverflow,\r\n\t\tlayout,\r\n\t\thandleParentResizeEvent,\r\n\t\thandleChildResizeEvent,\r\n\t\tchildMaxWidth,\r\n\t\tparentWidth,\r\n\t\t$$scope,\r\n\t\tslots\r\n\t];\r\n}\r\n\r\nclass Toolbar extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\t\tinit(this, options, instance$q, create_fragment$q, safe_not_equal, {});\r\n\t}\r\n}\r\n\r\nvar DirectionRectMap = {\r\n    [Top]: (rect) => ({ x: rect.x, y: rect.y }),\r\n    [TopRight]: (rect) => ({ x: rect.x + rect.width, y: rect.y }),\r\n    [Right]: (rect) => ({ x: rect.x + rect.width, y: rect.y }),\r\n    [BottomRight]: (rect) => ({ x: rect.x + rect.width, y: rect.y + rect.height }),\r\n    [Bottom]: (rect) => ({ x: rect.x, y: rect.y + rect.height }),\r\n    [BottomLeft]: (rect) => ({ x: rect.x, y: rect.y + rect.height }),\r\n    [Left]: (rect) => ({ x: rect.x, y: rect.y }),\r\n    [TopLeft]: (rect) => ({ x: rect.x, y: rect.y }),\r\n};\r\n\r\n/* src/core/ui/components/RectManipulator.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction get_each_context$5(ctx, list, i) {\r\n\tconst child_ctx = ctx.slice();\r\n\tchild_ctx[14] = list[i].key;\r\n\tchild_ctx[15] = list[i].translate;\r\n\tchild_ctx[16] = list[i].scale;\r\n\tchild_ctx[17] = list[i].type;\r\n\tchild_ctx[18] = list[i].opacity;\r\n\treturn child_ctx;\r\n}\r\n\r\n// (110:0) {#each mappedDirections as { key, translate, scale, type, opacity }\r\nfunction create_each_block$5(key_1, ctx) {\r\n\tlet div;\r\n\tlet div_aria_label_value;\r\n\tlet div_tabindex_value;\r\n\tlet div_data_direction_value;\r\n\tlet div_data_shape_value;\r\n\tlet div_style_value;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\treturn {\r\n\t\tkey: key_1,\r\n\t\tfirst: null,\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tattr(div, \"role\", \"button\");\r\n\t\t\tattr(div, \"aria-label\", div_aria_label_value = `Drag ${/*type*/ ctx[17]} ${/*key*/ ctx[14]}`);\r\n\t\t\tattr(div, \"tabindex\", div_tabindex_value = /*type*/ ctx[17] === 'edge' ? -1 : 0);\r\n\t\t\tattr(div, \"class\", \"PinturaRectManipulator\");\r\n\t\t\tattr(div, \"data-direction\", div_data_direction_value = /*key*/ ctx[14]);\r\n\r\n\t\t\tattr(div, \"data-shape\", div_data_shape_value = `${/*type*/ ctx[17] === 'edge'\r\n\t\t\t? 'edge'\r\n\t\t\t: `${/*style*/ ctx[0]}`}`);\r\n\r\n\t\t\tattr(div, \"style\", div_style_value = `transform: translate3d(${/*translate*/ ctx[15].x}px, ${/*translate*/ ctx[15].y}px, 0) scale(${/*scale*/ ctx[16].x}, ${/*scale*/ ctx[16].y}); opacity: ${/*opacity*/ ctx[18]}`);\r\n\t\t\tthis.first = div;\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(div, \"nudge\", function () {\r\n\t\t\t\t\t\tif (is_function(/*nudge*/ ctx[6](/*key*/ ctx[14]))) /*nudge*/ ctx[6](/*key*/ ctx[14]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\taction_destroyer(nudgeable.call(null, div, { preventDefault: true })),\r\n\t\t\t\t\tlisten(div, \"interactionstart\", function () {\r\n\t\t\t\t\t\tif (is_function(/*route*/ ctx[5]('resizestart', /*key*/ ctx[14]))) /*route*/ ctx[5]('resizestart', /*key*/ ctx[14]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(div, \"interactionupdate\", function () {\r\n\t\t\t\t\t\tif (is_function(/*route*/ ctx[5]('resizemove', /*key*/ ctx[14]))) /*route*/ ctx[5]('resizemove', /*key*/ ctx[14]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(div, \"interactionend\", function () {\r\n\t\t\t\t\t\tif (is_function(/*route*/ ctx[5]('resizeend', /*key*/ ctx[14]))) /*route*/ ctx[5]('resizeend', /*key*/ ctx[14]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\taction_destroyer(interactable.call(null, div))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\r\n\t\t\tif (dirty & /*mappedDirections*/ 2 && div_aria_label_value !== (div_aria_label_value = `Drag ${/*type*/ ctx[17]} ${/*key*/ ctx[14]}`)) {\r\n\t\t\t\tattr(div, \"aria-label\", div_aria_label_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty & /*mappedDirections*/ 2 && div_tabindex_value !== (div_tabindex_value = /*type*/ ctx[17] === 'edge' ? -1 : 0)) {\r\n\t\t\t\tattr(div, \"tabindex\", div_tabindex_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty & /*mappedDirections*/ 2 && div_data_direction_value !== (div_data_direction_value = /*key*/ ctx[14])) {\r\n\t\t\t\tattr(div, \"data-direction\", div_data_direction_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty & /*mappedDirections, style*/ 3 && div_data_shape_value !== (div_data_shape_value = `${/*type*/ ctx[17] === 'edge'\r\n\t\t\t? 'edge'\r\n\t\t\t: `${/*style*/ ctx[0]}`}`)) {\r\n\t\t\t\tattr(div, \"data-shape\", div_data_shape_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty & /*mappedDirections*/ 2 && div_style_value !== (div_style_value = `transform: translate3d(${/*translate*/ ctx[15].x}px, ${/*translate*/ ctx[15].y}px, 0) scale(${/*scale*/ ctx[16].x}, ${/*scale*/ ctx[16].y}); opacity: ${/*opacity*/ ctx[18]}`)) {\r\n\t\t\t\tattr(div, \"style\", div_style_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$p(ctx) {\r\n\tlet each_blocks = [];\r\n\tlet each_1_lookup = new Map();\r\n\tlet each_1_anchor;\r\n\tlet each_value = /*mappedDirections*/ ctx[1];\r\n\tconst get_key = ctx => /*key*/ ctx[14];\r\n\r\n\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\tlet child_ctx = get_each_context$5(ctx, each_value, i);\r\n\t\tlet key = get_key(child_ctx);\r\n\t\teach_1_lookup.set(key, each_blocks[i] = create_each_block$5(key, child_ctx));\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].c();\r\n\t\t\t}\r\n\r\n\t\t\teach_1_anchor = empty();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].m(target, anchor);\r\n\t\t\t}\r\n\r\n\t\t\tinsert(target, each_1_anchor, anchor);\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tif (dirty & /*mappedDirections, style, nudge, route*/ 99) {\r\n\t\t\t\teach_value = /*mappedDirections*/ ctx[1];\r\n\t\t\t\teach_blocks = update_keyed_each(each_blocks, dirty, get_key, 1, ctx, each_value, each_1_lookup, each_1_anchor.parentNode, destroy_block, create_each_block$5, each_1_anchor, get_each_context$5);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti: noop,\r\n\t\to: noop,\r\n\t\td(detaching) {\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].d(detaching);\r\n\t\t\t}\r\n\r\n\t\t\tif (detaching) detach(each_1_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$p($$self, $$props, $$invalidate) {\r\n\tlet mappedDirections;\r\n\tlet $selectionOpacity;\r\n\tlet $selectionScale;\r\n\tlet $isAnimated;\r\n\tlet { rect = null } = $$props;\r\n\tlet { visible = false } = $$props;\r\n\tlet { style = undefined } = $$props;\r\n\r\n\t// contex\r\n\tconst isAnimated = getContext('isAnimated');\r\n\r\n\tcomponent_subscribe($$self, isAnimated, value => $$invalidate(11, $isAnimated = value));\r\n\r\n\t// is `undefined` to prevent bounce when first rendering view\r\n\tconst selectionScale = spring(undefined, {\r\n\t\tprecision: 0.0001,\r\n\t\tstiffness: 0.2,\r\n\t\tdamping: 0.4\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, selectionScale, value => $$invalidate(10, $selectionScale = value));\r\n\tconst selectionOpacity = spring(0, { precision: 0.001 });\r\n\tcomponent_subscribe($$self, selectionOpacity, value => $$invalidate(9, $selectionOpacity = value));\r\n\r\n\t//\r\n\t// dragging\r\n\t//\r\n\tlet currentDirection;\r\n\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\tconst route = (type, direction) => ({ detail }) => {\r\n\t\t// don't handle other interactions while manipulating on axis\r\n\t\tif (currentDirection && direction !== currentDirection) return;\r\n\r\n\t\t// ignore move and end events if no direction has been set\r\n\t\tif (type !== 'resizestart' && currentDirection === undefined) return;\r\n\r\n\t\t// set new direction\r\n\t\tif (type === 'resizestart') currentDirection = direction;\r\n\r\n\t\t// release direction\r\n\t\tif (type === 'resizeend') currentDirection = undefined;\r\n\r\n\t\tdispatch(type, {\r\n\t\t\tdirection,\r\n\t\t\ttranslation: detail && detail.translation\r\n\t\t});\r\n\t};\r\n\r\n\tconst nudge = direction => ({ detail }) => {\r\n\t\tdispatch(`resizestart`, { direction, translation: { x: 0, y: 0 } });\r\n\t\tdispatch(`resizemove`, { direction, translation: detail });\r\n\t\tdispatch(`resizeend`, { direction, translation: { x: 0, y: 0 } });\r\n\t};\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('rect' in $$props) $$invalidate(7, rect = $$props.rect);\r\n\t\tif ('visible' in $$props) $$invalidate(8, visible = $$props.visible);\r\n\t\tif ('style' in $$props) $$invalidate(0, style = $$props.style);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*visible, $isAnimated*/ 2304) {\r\n\t\t\tselectionScale.set(visible ? 1 : 0.5, { hard: $isAnimated === false });\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*visible, $isAnimated*/ 2304) {\r\n\t\t\tselectionOpacity.set(visible ? 1 : 0, { hard: $isAnimated === false });\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*rect, $selectionScale, $selectionOpacity*/ 1664) {\r\n\t\t\t//\r\n\t\t\t// rendering\r\n\t\t\t//\r\n\t\t\t$$invalidate(1, mappedDirections = Object.keys(Direction).map((key, i) => {\r\n\t\t\t\t// get direction enum\r\n\t\t\t\tconst direction = Direction[key];\r\n\r\n\t\t\t\t// get position from direction\r\n\t\t\t\tconst position = DirectionRectMap[direction](rect);\r\n\r\n\t\t\t\t// corner or edge\r\n\t\t\t\tconst type = direction.length === 1 ? 'edge' : 'corner';\r\n\r\n\t\t\t\tconst isCorner = type === 'corner';\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tkey: direction,\r\n\t\t\t\t\ttype,\r\n\t\t\t\t\tscale: {\r\n\t\t\t\t\t\tx: (/^(t|b)$/).test(direction)\r\n\t\t\t\t\t\t? rect.width\r\n\t\t\t\t\t\t: isCorner ? clamp($selectionScale, 0.5, 1.25) : 1,\r\n\t\t\t\t\t\ty: (/^(r|l)$/).test(direction)\r\n\t\t\t\t\t\t? rect.height\r\n\t\t\t\t\t\t: isCorner ? clamp($selectionScale, 0.5, 1.25) : 1\r\n\t\t\t\t\t},\r\n\t\t\t\t\ttranslate: { x: position.x, y: position.y },\r\n\t\t\t\t\topacity: $selectionOpacity\r\n\t\t\t\t};\r\n\t\t\t}));\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tstyle,\r\n\t\tmappedDirections,\r\n\t\tisAnimated,\r\n\t\tselectionScale,\r\n\t\tselectionOpacity,\r\n\t\troute,\r\n\t\tnudge,\r\n\t\trect,\r\n\t\tvisible,\r\n\t\t$selectionOpacity,\r\n\t\t$selectionScale,\r\n\t\t$isAnimated\r\n\t];\r\n}\r\n\r\nclass RectManipulator extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\t\tinit(this, options, instance$p, create_fragment$p, safe_not_equal, { rect: 7, visible: 8, style: 0 });\r\n\t}\r\n}\r\n\r\nvar gesturable = (element) => {\r\n    function dispatch(type, detail) {\r\n        element.dispatchEvent(new CustomEvent(type, { detail }));\r\n    }\r\n    const handleGestureStart = (e) => {\r\n        e.preventDefault();\r\n        element.addEventListener('gesturechange', handleGestureChange);\r\n        element.addEventListener('gestureend', handleGestureEnd);\r\n        dispatch('gesturedown');\r\n    };\r\n    const handleGestureChange = (e) => {\r\n        e.preventDefault();\r\n        dispatch('gestureupdate', e.scale);\r\n    };\r\n    const handleGestureEnd = (e) => {\r\n        dispatch('gestureup', e.scale);\r\n        e.preventDefault();\r\n        clean();\r\n    };\r\n    const clean = () => {\r\n        element.removeEventListener('gesturechange', handleGestureChange);\r\n        element.removeEventListener('gestureend', handleGestureEnd);\r\n    };\r\n    element.addEventListener('gesturestart', handleGestureStart);\r\n    return {\r\n        destroy: () => {\r\n            clean();\r\n            element.removeEventListener('gesturestart', handleGestureStart);\r\n        },\r\n    };\r\n};\r\n\r\nvar DirectionInversionTable = {\r\n    [Top]: Bottom,\r\n    [Right]: Left,\r\n    [Bottom]: Top,\r\n    [Left]: Right,\r\n    [TopLeft]: BottomRight,\r\n    [TopRight]: BottomLeft,\r\n    [BottomRight]: TopLeft,\r\n    [BottomLeft]: TopRight,\r\n};\r\n\r\nvar getTranslationInfo = (target) => {\r\n    const translateToRight = target === Right || target === TopRight || target === BottomRight;\r\n    const translateToLeft = target === Left || target === BottomLeft || target === TopLeft;\r\n    const translateToTop = target === Top || target === TopRight || target === TopLeft;\r\n    const translateToBottom = target === Bottom || target === BottomRight || target === BottomLeft;\r\n    const translateHorizontally = target === Left || target === Right;\r\n    const translateVertically = target === Top || target === Bottom;\r\n    const translateAxis = translateHorizontally || translateVertically;\r\n    return [\r\n        translateToRight,\r\n        translateToLeft,\r\n        translateToTop,\r\n        translateToBottom,\r\n        translateHorizontally,\r\n        translateVertically,\r\n        translateAxis,\r\n    ];\r\n};\r\n\r\nvar limitRectDirectionTranslation = (rect, transform, bounds, options = {}) => {\r\n    // the transforms to apply\r\n    const { target, translate } = transform;\r\n    // the transform requirements\r\n    const { aspectRatio, minSize, maxSize } = options;\r\n    // get anchor coordinates and x,y position we need this for relative scaling of the view rectangle\r\n    const anchor = DirectionInversionTable[target];\r\n    const anchorDirectionCoordinates = DirectionCoordinateTable[anchor];\r\n    const anchorPosition = vectorAdd(vectorCreate(rect.x, rect.y), vectorCreate(anchorDirectionCoordinates[0] * rect.width, anchorDirectionCoordinates[1] * rect.height));\r\n    // get coordinate of direction\r\n    const targetDirectionCoordinates = DirectionCoordinateTable[target];\r\n    const targetPosition = vectorAdd(rectClone$1(rect), vectorCreate(targetDirectionCoordinates[0] * rect.width, targetDirectionCoordinates[1] * rect.height));\r\n    // bools to determine which direction the interaction is moving in\r\n    const [translateToRight, translateToLeft, translateToTop, translateToBottom, translateHorizontally, translateVertically, translateAxis,] = getTranslationInfo(target);\r\n    let tx = translate.x;\r\n    let ty = translate.y;\r\n    if (translateHorizontally)\r\n        ty = 0;\r\n    else if (translateVertically)\r\n        tx = 0;\r\n    const interactionBounds = getInteractionBounds(anchorPosition, target, bounds, {\r\n        aspectRatio,\r\n        minSize,\r\n        maxSize,\r\n    });\r\n    // current bounds\r\n    let [t, r, b, l] = rectToBounds(rect);\r\n    // update view bounds with anchor based on translation direction (one side is always locked)\r\n    if (translateToRight)\r\n        l = anchorPosition.x;\r\n    else if (translateToLeft)\r\n        r = anchorPosition.x;\r\n    if (translateToBottom)\r\n        t = anchorPosition.y;\r\n    else if (translateToTop)\r\n        b = anchorPosition.y;\r\n    // update view bounds with interaction limits\r\n    if (translateToRight) {\r\n        const innerR = interactionBounds.inner.x + interactionBounds.inner.width;\r\n        const outerR = interactionBounds.outer.x + interactionBounds.outer.width;\r\n        r = clamp(targetPosition.x + tx, innerR, outerR);\r\n    }\r\n    else if (translateToLeft) {\r\n        const innerL = interactionBounds.outer.x;\r\n        const outerL = interactionBounds.inner.x;\r\n        l = clamp(targetPosition.x + tx, innerL, outerL);\r\n    }\r\n    if (translateToBottom) {\r\n        const innerB = interactionBounds.inner.y + interactionBounds.inner.height;\r\n        const outerB = interactionBounds.outer.y + interactionBounds.outer.height;\r\n        b = clamp(targetPosition.y + ty, innerB, outerB);\r\n    }\r\n    else if (translateToTop) {\r\n        const innerT = interactionBounds.outer.y;\r\n        const outerT = interactionBounds.inner.y;\r\n        t = clamp(targetPosition.y + ty, innerT, outerT);\r\n    }\r\n    // if aspect ratio is set we need to scale both axis\r\n    if (aspectRatio) {\r\n        // if translating over horizontal or vertical axis we need to update the other axis based on the aspect ratio as well\r\n        if (translateAxis) {\r\n            let dx = r - l;\r\n            let dy = b - t;\r\n            if (translateHorizontally) {\r\n                dy = dx / aspectRatio;\r\n                t = anchorPosition.y - dy * 0.5;\r\n                b = anchorPosition.y + dy * 0.5;\r\n            }\r\n            else if (translateVertically) {\r\n                dx = dy * aspectRatio;\r\n                l = anchorPosition.x - dx * 0.5;\r\n                r = anchorPosition.x + dx * 0.5;\r\n            }\r\n        }\r\n        // we're translating one of the corners in both the x and y direction, need to make sure it conforms to aspect ratio\r\n        else {\r\n            const pointer = vectorCreate(targetPosition.x + tx - anchorPosition.x, targetPosition.y + ty - anchorPosition.y);\r\n            // translations cannot be inverted, limited by anchor position\r\n            if (target === TopRight) {\r\n                pointer.x = Math.max(0, pointer.x);\r\n                pointer.y = Math.min(0, pointer.y);\r\n            }\r\n            else if (target === BottomRight) {\r\n                pointer.x = Math.max(0, pointer.x);\r\n                pointer.y = Math.max(0, pointer.y);\r\n            }\r\n            else if (target === BottomLeft) {\r\n                pointer.x = Math.min(0, pointer.x);\r\n                pointer.y = Math.max(0, pointer.y);\r\n            }\r\n            else if (target === TopLeft) {\r\n                pointer.x = Math.min(0, pointer.x);\r\n                pointer.y = Math.min(0, pointer.y);\r\n            }\r\n            // calculate the translation pointer, then get its length, now create a new pointer based on the aspect ratio, and scale it based on the original (limited) length\r\n            const pointerLength = vectorLength(pointer);\r\n            const pointerLengthMin = vectorLength(vectorCreate(interactionBounds.inner.width, interactionBounds.inner.height));\r\n            const pointerLengthMax = vectorLength(vectorCreate(interactionBounds.outer.width, interactionBounds.outer.height));\r\n            const pointerLengthLimited = clamp(pointerLength, pointerLengthMin, pointerLengthMax);\r\n            const pointerAspectRatio = vectorCreate(aspectRatio, 1);\r\n            const pointerScaled = vectorMultiply(vectorNormalize(pointerAspectRatio), pointerLengthLimited);\r\n            if (target === TopRight) {\r\n                r = anchorPosition.x + pointerScaled.x;\r\n                t = anchorPosition.y - pointerScaled.y;\r\n            }\r\n            else if (target === BottomRight) {\r\n                r = anchorPosition.x + pointerScaled.x;\r\n                b = anchorPosition.y + pointerScaled.y;\r\n            }\r\n            else if (target === BottomLeft) {\r\n                l = anchorPosition.x - pointerScaled.x;\r\n                b = anchorPosition.y + pointerScaled.y;\r\n            }\r\n            else if (target === TopLeft) {\r\n                l = anchorPosition.x - pointerScaled.x;\r\n                t = anchorPosition.y - pointerScaled.y;\r\n            }\r\n        }\r\n    }\r\n    return rectCreate(l, t, r - l, b - t);\r\n};\r\nconst getInteractionBounds = (anchor, dir, bounds, options) => {\r\n    const { aspectRatio, minSize, maxSize } = options;\r\n    const translateToRight = dir === Right || dir === TopRight || dir === BottomRight;\r\n    const translateToLeft = dir === Left || dir === BottomLeft || dir === TopLeft;\r\n    const translateToTop = dir === Top || dir === TopRight || dir === TopLeft;\r\n    const translateToBottom = dir === Bottom || dir === BottomRight || dir === BottomLeft;\r\n    const translateHorizontally = dir === Left || dir === Right;\r\n    const translateVertically = dir === Top || dir === Bottom;\r\n    // limit bounds based on anchor and direction\r\n    const limitedBounds = rectClone$1(bounds);\r\n    if (translateToRight) {\r\n        limitedBounds.x = anchor.x;\r\n        limitedBounds.width -= anchor.x;\r\n    }\r\n    else if (translateToLeft) {\r\n        limitedBounds.width = anchor.x;\r\n    }\r\n    if (translateToBottom) {\r\n        limitedBounds.y = anchor.y;\r\n        limitedBounds.height -= anchor.y;\r\n    }\r\n    else if (translateToTop) {\r\n        limitedBounds.height = anchor.y;\r\n    }\r\n    // limit max size based on bounds\r\n    const maxSizeLimitedToBounds = rectCreateFromDimensions(Math.min(limitedBounds.width, maxSize.width), Math.min(limitedBounds.height, maxSize.height));\r\n    if (aspectRatio) {\r\n        // limit height\r\n        if (translateHorizontally) {\r\n            const verticalSpace = Math.min(anchor.y, bounds.height - anchor.y);\r\n            maxSizeLimitedToBounds.height = Math.min(verticalSpace * 2, maxSizeLimitedToBounds.height);\r\n        }\r\n        // limit width\r\n        else if (translateVertically) {\r\n            const horizontalSpace = Math.min(anchor.x, bounds.width - anchor.x);\r\n            maxSizeLimitedToBounds.width = Math.min(horizontalSpace * 2, maxSizeLimitedToBounds.width);\r\n        }\r\n    }\r\n    const maxSizeLimited = aspectRatio\r\n        ? sizeCreateFromRect(rectContainRect(maxSizeLimitedToBounds, aspectRatio))\r\n        : maxSizeLimitedToBounds;\r\n    // limit min size\r\n    const minSizeLimited = aspectRatio\r\n        ? sizeCreateFromRect(rectCoverRect(rectCreateFromSize(minSize), aspectRatio))\r\n        : minSize;\r\n    let l, r, t, b;\r\n    // set bounds\r\n    if (translateToRight)\r\n        l = anchor.x;\r\n    else if (translateToLeft)\r\n        r = anchor.x;\r\n    if (translateToBottom)\r\n        t = anchor.y;\r\n    else if (translateToTop)\r\n        b = anchor.y;\r\n    // inner\r\n    if (translateToRight) {\r\n        r = l + minSizeLimited.width;\r\n    }\r\n    else if (translateToLeft) {\r\n        l = r - minSizeLimited.width;\r\n    }\r\n    if (translateToBottom) {\r\n        b = t + minSizeLimited.height;\r\n    }\r\n    else if (translateToTop) {\r\n        t = b - minSizeLimited.height;\r\n    }\r\n    if (translateHorizontally) {\r\n        t = anchor.y - minSizeLimited.height * 0.5;\r\n        b = anchor.y + minSizeLimited.height * 0.5;\r\n    }\r\n    else if (translateVertically) {\r\n        l = anchor.x - minSizeLimited.width * 0.5;\r\n        r = anchor.x + minSizeLimited.width * 0.5;\r\n    }\r\n    const inner = rectCreateFromPoints([vectorCreate(l, t), vectorCreate(r, b)]);\r\n    // outer\r\n    if (translateToRight) {\r\n        r = l + maxSizeLimited.width;\r\n    }\r\n    else if (translateToLeft) {\r\n        l = r - maxSizeLimited.width;\r\n    }\r\n    if (translateToBottom) {\r\n        b = t + maxSizeLimited.height;\r\n    }\r\n    else if (translateToTop) {\r\n        t = b - maxSizeLimited.height;\r\n    }\r\n    if (translateHorizontally) {\r\n        t = anchor.y - maxSizeLimited.height * 0.5;\r\n        b = anchor.y + maxSizeLimited.height * 0.5;\r\n    }\r\n    else if (translateVertically) {\r\n        l = anchor.x - maxSizeLimited.width * 0.5;\r\n        r = anchor.x + maxSizeLimited.width * 0.5;\r\n    }\r\n    const outer = rectCreateFromPoints([vectorCreate(l, t), vectorCreate(r, b)]);\r\n    return {\r\n        inner,\r\n        outer,\r\n    };\r\n};\r\n\r\nvar applyRectDirectionTranslation = (rect, transform, options = {}) => {\r\n    // the transforms to apply\r\n    const { target, translate } = transform;\r\n    // the transform requirements\r\n    const { aspectRatio } = options;\r\n    // get anchor coordinates and x,y position we need this for relative scaling of the view rectangle\r\n    const anchor = DirectionInversionTable[target];\r\n    const anchorDirectionCoordinates = DirectionCoordinateTable[anchor];\r\n    const anchorPosition = vectorAdd(rectClone$1(rect), vectorCreate(anchorDirectionCoordinates[0] * rect.width, anchorDirectionCoordinates[1] * rect.height));\r\n    // get coordinate of direction\r\n    const targetDirectionCoordinates = DirectionCoordinateTable[target];\r\n    const targetPosition = vectorAdd(rectClone$1(rect), vectorCreate(targetDirectionCoordinates[0] * rect.width, targetDirectionCoordinates[1] * rect.height));\r\n    // bools to determine which direction the interaction is moving in\r\n    const [translateToRight, translateToLeft, translateToTop, translateToBottom, translateHorizontally, translateVertically, translateAxis,] = getTranslationInfo(target);\r\n    let tx = translate.x;\r\n    let ty = translate.y;\r\n    if (translateHorizontally)\r\n        ty = 0;\r\n    else if (translateVertically)\r\n        tx = 0;\r\n    // current bounds\r\n    let [t, r, b, l] = rectToBounds(rect);\r\n    // update view bounds with anchor based on translation direction (one side is always locked)\r\n    if (translateToRight)\r\n        l = anchorPosition.x;\r\n    else if (translateToLeft)\r\n        r = anchorPosition.x;\r\n    if (translateToBottom)\r\n        t = anchorPosition.y;\r\n    else if (translateToTop)\r\n        b = anchorPosition.y;\r\n    // update view bounds with interaction limits\r\n    if (translateToRight) {\r\n        r = targetPosition.x + tx;\r\n    }\r\n    else if (translateToLeft) {\r\n        l = targetPosition.x + tx;\r\n    }\r\n    if (translateToBottom) {\r\n        b = targetPosition.y + ty;\r\n    }\r\n    else if (translateToTop) {\r\n        t = targetPosition.y + ty;\r\n    }\r\n    // if aspect ratio is set we need to scale both axis\r\n    if (aspectRatio) {\r\n        // if translating over horizontal or vertical axis we need to update the other axis based on the aspect ratio as well\r\n        if (translateAxis) {\r\n            let dx = r - l;\r\n            let dy = b - t;\r\n            if (translateHorizontally) {\r\n                dy = dx / aspectRatio;\r\n                t = anchorPosition.y - dy * 0.5;\r\n                b = anchorPosition.y + dy * 0.5;\r\n            }\r\n            else if (translateVertically) {\r\n                dx = dy * aspectRatio;\r\n                l = anchorPosition.x - dx * 0.5;\r\n                r = anchorPosition.x + dx * 0.5;\r\n            }\r\n        }\r\n        // we're translating one of the corners in both the x and y direction, need to make sure it conforms to aspect ratio\r\n        else {\r\n            const pointer = vectorCreate(targetPosition.x + tx - anchorPosition.x, targetPosition.y + ty - anchorPosition.y);\r\n            // translations cannot be inverted, limited by anchor position\r\n            if (target === TopRight) {\r\n                pointer.x = Math.max(0, pointer.x);\r\n                pointer.y = Math.min(0, pointer.y);\r\n            }\r\n            else if (target === BottomRight) {\r\n                pointer.x = Math.max(0, pointer.x);\r\n                pointer.y = Math.max(0, pointer.y);\r\n            }\r\n            else if (target === BottomLeft) {\r\n                pointer.x = Math.min(0, pointer.x);\r\n                pointer.y = Math.max(0, pointer.y);\r\n            }\r\n            else if (target === TopLeft) {\r\n                pointer.x = Math.min(0, pointer.x);\r\n                pointer.y = Math.min(0, pointer.y);\r\n            }\r\n            // calculate the translation pointer, then get its length, now create a new pointer based on the aspect ratio, and scale it based on the original (limited) length\r\n            const pointerLength = vectorLength(pointer);\r\n            const pointerAspectRatio = vectorCreate(aspectRatio, 1);\r\n            const pointerScaled = vectorMultiply(vectorNormalize(pointerAspectRatio), pointerLength);\r\n            if (target === TopRight) {\r\n                r = anchorPosition.x + pointerScaled.x;\r\n                t = anchorPosition.y - pointerScaled.y;\r\n            }\r\n            else if (target === BottomRight) {\r\n                r = anchorPosition.x + pointerScaled.x;\r\n                b = anchorPosition.y + pointerScaled.y;\r\n            }\r\n            else if (target === BottomLeft) {\r\n                l = anchorPosition.x - pointerScaled.x;\r\n                b = anchorPosition.y + pointerScaled.y;\r\n            }\r\n            else if (target === TopLeft) {\r\n                l = anchorPosition.x - pointerScaled.x;\r\n                t = anchorPosition.y - pointerScaled.y;\r\n            }\r\n        }\r\n    }\r\n    return rectCreate(l, t, r - l, b - t);\r\n};\r\n\r\nvar radToDeg = (rad) => rad * 180 / Math.PI;\r\n\r\n/* src/core/ui/plugins/crop/components/ImageRotator.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$o(ctx) {\r\n\tlet div;\r\n\tlet rangeinput;\r\n\tlet current;\r\n\r\n\trangeinput = new RangeInput({\r\n\t\t\tprops: {\r\n\t\t\t\telasticity: /*elasticity*/ ctx[5],\r\n\t\t\t\tmin: /*min*/ ctx[9],\r\n\t\t\t\tmax: /*max*/ ctx[10],\r\n\t\t\t\tvalue: /*value*/ ctx[11],\r\n\t\t\t\tvalueMin: Math.max(/*min*/ ctx[9], /*valueMin*/ ctx[0]),\r\n\t\t\t\tvalueMax: Math.min(/*max*/ ctx[10], /*valueMax*/ ctx[1]),\r\n\t\t\t\tlabelReset: /*labelReset*/ ctx[6],\r\n\t\t\t\tbase: /*center*/ ctx[12],\r\n\t\t\t\tvalueLabel: `${Math.round(radToDeg(/*value*/ ctx[11]))}&deg;`,\r\n\t\t\t\toninputstart: /*oninputstart*/ ctx[2],\r\n\t\t\t\toninputmove: /*func*/ ctx[17],\r\n\t\t\t\toninputend: /*func_1*/ ctx[18]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tcreate_component(rangeinput.$$.fragment);\r\n\t\t\tattr(div, \"class\", \"PinturaImageRotator\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tmount_component(rangeinput, div, null);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tconst rangeinput_changes = {};\r\n\t\t\tif (dirty & /*elasticity*/ 32) rangeinput_changes.elasticity = /*elasticity*/ ctx[5];\r\n\t\t\tif (dirty & /*min*/ 512) rangeinput_changes.min = /*min*/ ctx[9];\r\n\t\t\tif (dirty & /*max*/ 1024) rangeinput_changes.max = /*max*/ ctx[10];\r\n\t\t\tif (dirty & /*value*/ 2048) rangeinput_changes.value = /*value*/ ctx[11];\r\n\t\t\tif (dirty & /*min, valueMin*/ 513) rangeinput_changes.valueMin = Math.max(/*min*/ ctx[9], /*valueMin*/ ctx[0]);\r\n\t\t\tif (dirty & /*max, valueMax*/ 1026) rangeinput_changes.valueMax = Math.min(/*max*/ ctx[10], /*valueMax*/ ctx[1]);\r\n\t\t\tif (dirty & /*labelReset*/ 64) rangeinput_changes.labelReset = /*labelReset*/ ctx[6];\r\n\t\t\tif (dirty & /*center*/ 4096) rangeinput_changes.base = /*center*/ ctx[12];\r\n\t\t\tif (dirty & /*value*/ 2048) rangeinput_changes.valueLabel = `${Math.round(radToDeg(/*value*/ ctx[11]))}&deg;`;\r\n\t\t\tif (dirty & /*oninputstart*/ 4) rangeinput_changes.oninputstart = /*oninputstart*/ ctx[2];\r\n\t\t\tif (dirty & /*oninputmove, sign, turns*/ 392) rangeinput_changes.oninputmove = /*func*/ ctx[17];\r\n\t\t\tif (dirty & /*oninputend, sign, turns*/ 400) rangeinput_changes.oninputend = /*func_1*/ ctx[18];\r\n\t\t\trangeinput.$set(rangeinput_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(rangeinput.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(rangeinput.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tdestroy_component(rangeinput);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nconst MARGIN = 0.000000001;\r\n\r\nfunction instance$o($$self, $$props, $$invalidate) {\r\n\tlet min;\r\n\tlet max;\r\n\tlet center;\r\n\tlet range;\r\n\tlet sign;\r\n\tlet turns;\r\n\tlet value;\r\n\tlet { rotation } = $$props;\r\n\tlet { valueMin } = $$props;\r\n\tlet { valueMax } = $$props;\r\n\tlet { oninputstart = noop$1 } = $$props;\r\n\tlet { oninputmove = noop$1 } = $$props;\r\n\tlet { oninputend = noop$1 } = $$props;\r\n\tlet { elasticity = 0 } = $$props;\r\n\tlet { labelReset = undefined } = $$props;\r\n\tlet { rotationMin = undefined } = $$props;\r\n\tlet { rotationMax = undefined } = $$props;\r\n\tconst func = value => oninputmove(sign * turns + value);\r\n\tconst func_1 = value => oninputend(sign * turns + value);\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('rotation' in $$props) $$invalidate(13, rotation = $$props.rotation);\r\n\t\tif ('valueMin' in $$props) $$invalidate(0, valueMin = $$props.valueMin);\r\n\t\tif ('valueMax' in $$props) $$invalidate(1, valueMax = $$props.valueMax);\r\n\t\tif ('oninputstart' in $$props) $$invalidate(2, oninputstart = $$props.oninputstart);\r\n\t\tif ('oninputmove' in $$props) $$invalidate(3, oninputmove = $$props.oninputmove);\r\n\t\tif ('oninputend' in $$props) $$invalidate(4, oninputend = $$props.oninputend);\r\n\t\tif ('elasticity' in $$props) $$invalidate(5, elasticity = $$props.elasticity);\r\n\t\tif ('labelReset' in $$props) $$invalidate(6, labelReset = $$props.labelReset);\r\n\t\tif ('rotationMin' in $$props) $$invalidate(14, rotationMin = $$props.rotationMin);\r\n\t\tif ('rotationMax' in $$props) $$invalidate(15, rotationMax = $$props.rotationMax);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*rotationMin*/ 16384) {\r\n\t\t\t$$invalidate(9, min = rotationMin + MARGIN);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*rotationMax*/ 32768) {\r\n\t\t\t$$invalidate(10, max = rotationMax - MARGIN);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*min, max*/ 1536) {\r\n\t\t\t$$invalidate(12, center = min + (max - min) * 0.5);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*rotationMax*/ 32768) {\r\n\t\t\t$$invalidate(16, range = rotationMax * 2);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*rotation*/ 8192) {\r\n\t\t\t$$invalidate(8, sign = Math.sign(rotation));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*rotation, range*/ 73728) {\r\n\t\t\t$$invalidate(7, turns = Math.round(Math.abs(rotation) / range) * range);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*rotation, sign, turns*/ 8576) {\r\n\t\t\t$$invalidate(11, value = rotation - sign * turns);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tvalueMin,\r\n\t\tvalueMax,\r\n\t\toninputstart,\r\n\t\toninputmove,\r\n\t\toninputend,\r\n\t\telasticity,\r\n\t\tlabelReset,\r\n\t\tturns,\r\n\t\tsign,\r\n\t\tmin,\r\n\t\tmax,\r\n\t\tvalue,\r\n\t\tcenter,\r\n\t\trotation,\r\n\t\trotationMin,\r\n\t\trotationMax,\r\n\t\trange,\r\n\t\tfunc,\r\n\t\tfunc_1\r\n\t];\r\n}\r\n\r\nclass ImageRotator extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$o, create_fragment$o, safe_not_equal, {\r\n\t\t\trotation: 13,\r\n\t\t\tvalueMin: 0,\r\n\t\t\tvalueMax: 1,\r\n\t\t\toninputstart: 2,\r\n\t\t\toninputmove: 3,\r\n\t\t\toninputend: 4,\r\n\t\t\telasticity: 5,\r\n\t\t\tlabelReset: 6,\r\n\t\t\trotationMin: 14,\r\n\t\t\trotationMax: 15\r\n\t\t});\r\n\t}\r\n}\r\n\r\n/* src/core/ui/plugins/crop/components/ImageInfo.svelte generated by Svelte v3.50.1 */\r\nfunction createPrintInfo(width, height) {\r\n    var printWidth = (width/ 300).toFixed(1);\r\n    var printHeight = (height / 300).toFixed(1);\r\n    if ( inputedSize.width > 0 && inputedSize.height > 0 && printWidth > inputedSize.width && printHeight > inputedSize.height) {\r\n        return \"Print: \" + inputedSize.width + \"\\\"\" + \" x \" + inputedSize.height  + \"\\\"\";\r\n    } else {\r\n        return \"Print: \" + (width/ 300).toFixed(1) + \"\\\"\" + \" x \" + (height / 300).toFixed(1)  + \"\\\"\";\r\n    }\r\n}\r\n\r\nfunction createMaxPrintInfo(width, height) {\r\n    return \"Largest Print: \" + (width/ 300).toFixed(1) + \"\\\"\" + \" x \" + (height / 300).toFixed(1)  + \"\\\"\";\r\n}\r\n\r\nfunction createRatioInfo(width, height) {\r\n    var ratioLabel = getRatioLabel(width / height);\r\n    if (ratioLabel.widthLable != 0 && ratioLabel.heightLable != 0) {\r\n        return \"Ratio: \" + ratioLabel.widthLable + \":\" + ratioLabel.heightLable;\r\n    }\r\n}\r\n\r\nfunction create_fragment$n(ctx) {\r\n\tlet div;\r\n\tlet resolutionSpan;\r\n    let ratioPart;\r\n    let spanPrint;\r\n    let spanMaxPrint;\r\n    let resolutionLabel;\r\n    let fullPrint;\r\n    let maxPrint;\r\n    let ratioText;\r\n\tlet resolutionWidthText;\r\n\tlet t1;\r\n\tlet resolutionHeightText;\r\n    let sizePart;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n            ratioPart = element(\"p\");\r\n\t\t\tresolutionSpan = element(\"span\");\r\n            resolutionLabel = text(\"Resolution: \");\r\n            ratioText = text(createRatioInfo(/*width*/ ctx[0], /*height*/ ctx[1]));\r\n            spanPrint = element(\"span\");\r\n            spanMaxPrint = element(\"span\");\r\n\t\t\tresolutionWidthText = text(/*width*/ ctx[0]);\r\n\t\t\tt1 = text(\" x \");\r\n\t\t\tresolutionHeightText = text(/*height*/ ctx[1]);\r\n            fullPrint = text(createPrintInfo(/*width*/ ctx[0], /*height*/ ctx[1]))\r\n            maxPrint = text(createMaxPrintInfo(/*width*/ ctx[0], /*height*/ ctx[1]));\r\n\t\t\tattr(div, \"class\", \"PinturaImageInfo\");\r\n            attr(resolutionSpan, \"style\", \"padding-left:10px;justify-content:right\")\r\n            attr(spanPrint, \"style\", \"padding-right:10px; margin:0\")\r\n            attr(spanMaxPrint, \"style\", \"margin:0\")\r\n\r\n            sizePart = element(\"p\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n            append(div, ratioPart);\r\n            append(ratioPart, ratioText);\r\n\r\n\t\t\tappend(ratioPart, resolutionSpan);\r\n            \r\n            append(resolutionSpan, resolutionLabel);\r\n\t\t\tappend(resolutionSpan, resolutionWidthText);\r\n\t\t\tappend(resolutionSpan, t1);\r\n\t\t\tappend(resolutionSpan, resolutionHeightText);\r\n\r\n            append(div, sizePart);\r\n            append(spanPrint, fullPrint);\r\n            append(sizePart, spanPrint);\r\n\r\n            append(spanMaxPrint, maxPrint);\r\n            append(sizePart, spanMaxPrint);\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tif (dirty & /*width*/ 1) set_data(resolutionWidthText, /*width*/ ctx[0]);\r\n\t\t\tif (dirty & /*height*/ 2) set_data(resolutionHeightText, /*height*/ ctx[1]);\r\n            if (dirty) set_data(fullPrint, createPrintInfo(/*width*/ ctx[0], /*height*/ ctx[1]));\r\n            if (dirty) set_data(maxPrint, createMaxPrintInfo(/*width*/ ctx[0], /*height*/ ctx[1]));\r\n            if (dirty) set_data(ratioText, createRatioInfo(/*width*/ ctx[0], /*height*/ ctx[1]));\r\n\t\t},\r\n\t\ti: noop,\r\n\t\to: noop,\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$n($$self, $$props, $$invalidate) {\r\n\tlet { width } = $$props;\r\n\tlet { height } = $$props;\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('width' in $$props) $$invalidate(0, width = $$props.width);\r\n\t\tif ('height' in $$props) $$invalidate(1, height = $$props.height);\r\n\t};\r\n\r\n\treturn [width, height];\r\n}\r\n\r\nclass ImageInfo extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\t\tinit(this, options, instance$n, create_fragment$n, safe_not_equal, { width: 0, height: 1 });\r\n\t}\r\n}\r\n\r\nvar getSelectionPresetOptionIcon = (value, options = {}) => {\r\n    const { width = 24, height = 24, bounds = 16, radius = 3 } = options;\r\n    let aspectRatio = isArray(value) ? getAspectRatio(value[0], value[1]) : value;\r\n    let aspectRatioDefined = !!aspectRatio;\r\n    aspectRatio = aspectRatioDefined ? aspectRatio : 1;\r\n    let x;\r\n    let y;\r\n    let w;\r\n    let h;\r\n    w = aspectRatio > 1 ? bounds : aspectRatio * bounds;\r\n    h = w / aspectRatio;\r\n    x = Math.round((width - w) * 0.5);\r\n    y = Math.round((height - h) * 0.5);\r\n    const fill = aspectRatioDefined ? 'currentColor' : 'none';\r\n    const stroke = aspectRatioDefined ? 'none' : 'currentColor';\r\n    const strokeWidth = width / 16;\r\n    const strokeDashArray = [width / 12, width / 6].join(' ');\r\n    return `<rect fill=\"${fill}\" stroke=\"${stroke}\" stroke-width=\"${strokeWidth}\" stroke-dasharray=\"${strokeDashArray}\" x=\"${x}\" y=\"${y}\" width=\"${w}\" height=\"${h}\" rx=\"${radius}\"/>`;\r\n};\r\n\r\n/* src/core/ui/plugins/crop/components/CropPresetList.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_controls_slot(ctx) {\r\n\tlet radiogroup;\r\n\tlet current;\r\n\r\n\tradiogroup = new RadioGroup({\r\n\t\t\tprops: {\r\n\t\t\t\tclass: \"PinturaPresetListFilter\",\r\n\t\t\t\tlayout: \"row\",\r\n\t\t\t\toptions: /*filterOptions*/ ctx[8],\r\n\t\t\t\tselectedIndex: /*selectedFilterIndex*/ ctx[7],\r\n\t\t\t\tonchange: /*handleChangeFilter*/ ctx[10]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(radiogroup.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(radiogroup, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst radiogroup_changes = {};\r\n\t\t\tif (dirty & /*filterOptions*/ 256) radiogroup_changes.options = /*filterOptions*/ ctx[8];\r\n\t\t\tif (dirty & /*selectedFilterIndex*/ 128) radiogroup_changes.selectedIndex = /*selectedFilterIndex*/ ctx[7];\r\n\t\t\tradiogroup.$set(radiogroup_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(radiogroup.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(radiogroup.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(radiogroup, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$m(ctx) {\r\n\tlet dropdown;\r\n\tlet current;\r\n\r\n\tdropdown = new Dropdown({\r\n\t\t\tprops: {\r\n\t\t\t\ticon: /*icon*/ ctx[0],\r\n\t\t\t\tlabel: /*label*/ ctx[1],\r\n\t\t\t\tlabelClass: /*labelClass*/ ctx[2],\r\n\t\t\t\thideLabel: /*hideLabel*/ ctx[3],\r\n\t\t\t\toptions: /*filteredOptions*/ ctx[9],\r\n\t\t\t\tselectedIndex: /*selectedIndex*/ ctx[4],\r\n\t\t\t\tonchange: /*onchange*/ ctx[5],\r\n\t\t\t\toptionMapper: /*optionMapper*/ ctx[6],\r\n\t\t\t\t$$slots: { controls: [create_controls_slot] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(dropdown.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(dropdown, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tconst dropdown_changes = {};\r\n\t\t\tif (dirty & /*icon*/ 1) dropdown_changes.icon = /*icon*/ ctx[0];\r\n\t\t\tif (dirty & /*label*/ 2) dropdown_changes.label = /*label*/ ctx[1];\r\n\t\t\tif (dirty & /*labelClass*/ 4) dropdown_changes.labelClass = /*labelClass*/ ctx[2];\r\n\t\t\tif (dirty & /*hideLabel*/ 8) dropdown_changes.hideLabel = /*hideLabel*/ ctx[3];\r\n\t\t\tif (dirty & /*filteredOptions*/ 512) dropdown_changes.options = /*filteredOptions*/ ctx[9];\r\n\t\t\tif (dirty & /*selectedIndex*/ 16) dropdown_changes.selectedIndex = /*selectedIndex*/ ctx[4];\r\n\t\t\tif (dirty & /*onchange*/ 32) dropdown_changes.onchange = /*onchange*/ ctx[5];\r\n\t\t\tif (dirty & /*optionMapper*/ 64) dropdown_changes.optionMapper = /*optionMapper*/ ctx[6];\r\n\r\n\t\t\tif (dirty & /*$$scope, filterOptions, selectedFilterIndex*/ 262528) {\r\n\t\t\t\tdropdown_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tdropdown.$set(dropdown_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(dropdown.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(dropdown.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(dropdown, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nconst style = 'fill=\"none\" stroke=\"currentColor\"';\r\n\r\nfunction instance$m($$self, $$props, $$invalidate) {\r\n\tlet filteredOptions;\r\n\tlet selectedFilterIndex;\r\n\tlet filterOptions;\r\n\tlet { icon } = $$props;\r\n\tlet { label } = $$props;\r\n\tlet { labelClass } = $$props;\r\n\tlet { hideLabel } = $$props;\r\n\tlet { options } = $$props;\r\n\tlet { selectedIndex } = $$props;\r\n\tlet { onchange } = $$props;\r\n\tlet { optionMapper } = $$props;\r\n\tlet { filter = 'landscape' } = $$props;\r\n\tlet { onfilterchange = noop$1 } = $$props;\r\n\r\n\tconst getIcon = (x, y, width, height, r) => `\r\n    <rect ${style} x=\"${x}\" y=\"${y}\" width=\"${width}\" height=\"${height}\" rx=\"${r}\"/>`;\r\n\r\n\tconst getCheckmark = (x, y) => `<path ${style} d=\"M${x} ${y} l2 2 l3 -4\"/>`;\r\n\r\n\tconst mapGroupedOptions = (options, map) => (options || []).map(option => {\r\n\t\t// group\r\n\t\tif (isString(option[0])) {\r\n\t\t\toption[1] = option[1].map(map);\r\n\t\t\treturn option;\r\n\t\t}\r\n\r\n\t\t// single\r\n\t\treturn map(option);\r\n\t});\r\n\r\n\tconst createOptionMapper = filter => item => {\r\n\t\tconst [value, label, options = {}] = item;\r\n\r\n\t\tif (isNumber(value)) {\r\n\t\t\toptions.hidden = filter === 'landscape' ? value < 1 : value > 1;\r\n\t\t}\r\n\r\n\t\treturn [value, label, options];\r\n\t};\r\n\r\n\tconst handleChangeFilter = item => {\r\n\t\t$$invalidate(11, filter = item.value);\r\n\t\tonfilterchange(item.value);\r\n\t};\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('icon' in $$props) $$invalidate(0, icon = $$props.icon);\r\n\t\tif ('label' in $$props) $$invalidate(1, label = $$props.label);\r\n\t\tif ('labelClass' in $$props) $$invalidate(2, labelClass = $$props.labelClass);\r\n\t\tif ('hideLabel' in $$props) $$invalidate(3, hideLabel = $$props.hideLabel);\r\n\t\tif ('options' in $$props) $$invalidate(12, options = $$props.options);\r\n\t\tif ('selectedIndex' in $$props) $$invalidate(4, selectedIndex = $$props.selectedIndex);\r\n\t\tif ('onchange' in $$props) $$invalidate(5, onchange = $$props.onchange);\r\n\t\tif ('optionMapper' in $$props) $$invalidate(6, optionMapper = $$props.optionMapper);\r\n\t\tif ('filter' in $$props) $$invalidate(11, filter = $$props.filter);\r\n\t\tif ('onfilterchange' in $$props) $$invalidate(13, onfilterchange = $$props.onfilterchange);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*options, filter*/ 6144) {\r\n\t\t\t$$invalidate(9, filteredOptions = mapGroupedOptions(options, createOptionMapper(filter)));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*filter*/ 2048) {\r\n\t\t\t$$invalidate(7, selectedFilterIndex = filter === 'landscape' ? 0 : 1);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*selectedFilterIndex*/ 128) {\r\n\t\t\t$$invalidate(8, filterOptions = [\r\n\t\t\t\t[\r\n\t\t\t\t\t'landscape',\r\n\t\t\t\t\t'Landscape',\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\thideLabel: true,\r\n\t\t\t\t\t\ticon: getIcon(2, 6, 19, 12, 2) + (selectedFilterIndex === 0 ? getCheckmark(9, 12) : '')\r\n\t\t\t\t\t}\r\n\t\t\t\t],\r\n\t\t\t\t[\r\n\t\t\t\t\t'portrait',\r\n\t\t\t\t\t'Portrait',\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\thideLabel: true,\r\n\t\t\t\t\t\ticon: getIcon(5, 3, 13, 18, 2) + (selectedFilterIndex === 1 ? getCheckmark(9, 12) : '')\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t]);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\ticon,\r\n\t\tlabel,\r\n\t\tlabelClass,\r\n\t\thideLabel,\r\n\t\tselectedIndex,\r\n\t\tonchange,\r\n\t\toptionMapper,\r\n\t\tselectedFilterIndex,\r\n\t\tfilterOptions,\r\n\t\tfilteredOptions,\r\n\t\thandleChangeFilter,\r\n\t\tfilter,\r\n\t\toptions,\r\n\t\tonfilterchange\r\n\t];\r\n}\r\n\r\nclass CropPresetList extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$m, create_fragment$m, safe_not_equal, {\r\n\t\t\ticon: 0,\r\n\t\t\tlabel: 1,\r\n\t\t\tlabelClass: 2,\r\n\t\t\thideLabel: 3,\r\n\t\t\toptions: 12,\r\n\t\t\tselectedIndex: 4,\r\n\t\t\tonchange: 5,\r\n\t\t\toptionMapper: 6,\r\n\t\t\tfilter: 11,\r\n\t\t\tonfilterchange: 13\r\n\t\t});\r\n\t}\r\n}\r\n\r\n// this makes sure that the new rectangle doesn't have corners outside of the quad\r\nconst EDGE_DISTANCE_FACTOR = 0.9999;\r\nconst PRECISION = 6;\r\nconst fixVectorPrecision = (v) => vectorApply(v, (v) => fixPrecision(v, PRECISION));\r\nconst rectFixPrecision = (r) => rectApply(r, (v) => fixPrecision(v, PRECISION));\r\nconst quadFixPrecision = (q) => q.map(fixVectorPrecision);\r\nconst floatEquals = (a, b, margin = 0.0001) => Math.abs(a - b) < margin;\r\nvar getRectLimitedToQuad = (rectOrigin, rectTarget, transform, quad, options = {}) => {\r\n    const { aspectRatio } = options;\r\n    rectOrigin = rectFixPrecision(rectOrigin);\r\n    quad = quadFixPrecision(quad);\r\n    const anchor = rectGetCornerByTarget(rectOrigin, DirectionInversionTable[transform.target]);\r\n    const anchorFixed = vectorApply(anchor, (v) => fixPrecision(v, PRECISION));\r\n    const minSize = aspectRatio ? rectCoverRect(options.minSize, aspectRatio) : options.minSize;\r\n    const maxSize = aspectRatio ? rectContainRect(options.maxSize, aspectRatio) : options.maxSize;\r\n    const rectTargetCorner = rectGetCornerByTarget(rectTarget, transform.target);\r\n    // prevent scaling the target size smaller than 0\r\n    const dist = vectorDistance(rectTargetCorner, anchor);\r\n    if (dist < 1) {\r\n        rectTarget = rectClone$1(rectOrigin);\r\n        const scalar = Math.min(minSize.width / rectOrigin.width, minSize.height / rectOrigin.height);\r\n        rectScale$1(rectTarget, scalar, anchor);\r\n    }\r\n    // clamp between min and max size\r\n    rectTarget = rectClamp(rectClone$1(rectTarget), minSize, maxSize, anchor);\r\n    let rect = rectClone$1(rectTarget);\r\n    rectTarget = rectFixPrecision(rectTarget);\r\n    const quadEdges = quadToLines(quad, 1);\r\n    const cornersOrigin = rectGetCorners(rectOrigin);\r\n    const cornersTarget = rectGetCorners(rectTarget);\r\n    const anchorIndex = cornersOrigin.findIndex((corner) => vectorEqual(vectorApply(corner, (v) => fixPrecision(v, PRECISION)), anchorFixed));\r\n    const getLineIntersectionWithQuad = (line) => quadEdges\r\n        .map((quadEdge) => lineLineIntersection(quadEdge, line))\r\n        .filter(Boolean)\r\n        .pop();\r\n    // when aspect ratio is locked we can scale the original rectangle relatively to closest intersectionpoint\r\n    if (aspectRatio) {\r\n        const intersections = cornersTarget\r\n            .map((target, index) => {\r\n            // skip anchor\r\n            if (index === anchorIndex)\r\n                return;\r\n            // start ray slightly away from anchor so we don't intersect with quad edge\r\n            const dir = vectorCreate(anchor.x - target.x, anchor.y - target.y);\r\n            vectorNormalize(dir);\r\n            vectorMultiply(dir, 0.5);\r\n            // draw line from anchor to target to find intersection with quad edge\r\n            const rayOrigin = vectorCreate(anchor.x - dir.x, anchor.y - dir.y);\r\n            const ray = lineCreate(rayOrigin, fixVectorPrecision(target));\r\n            const intersection = getLineIntersectionWithQuad(ray);\r\n            if (!intersection)\r\n                return;\r\n            const origin = cornersOrigin[index];\r\n            return {\r\n                intersection,\r\n                cornerDist: vectorDistance(anchor, origin),\r\n                intersectionDist: vectorDistance(anchor, intersection),\r\n            };\r\n        })\r\n            .filter(Boolean);\r\n        if (intersections.length) {\r\n            const scalar = intersections.reduce((scalar, current) => {\r\n                const currentScalar = current.intersectionDist / current.cornerDist;\r\n                return currentScalar < scalar ? currentScalar : scalar;\r\n            }, Number.MAX_SAFE_INTEGER);\r\n            rect = rectClone$1(rectOrigin);\r\n            rectScale$1(rect, scalar, anchor);\r\n        }\r\n    }\r\n    else {\r\n        // if not a fixed aspect ratio\r\n        const isManipulatingEdge = transform.target.length === 1;\r\n        // is true if quad is rotated\r\n        const isRotated = !(quad[0].y === quad[1].y || quad[0].x === quad[1].x);\r\n        // get intersections\r\n        const intersections = cornersOrigin\r\n            .map((cornerOrigin, index) => {\r\n            // skip anchor\r\n            if (index === anchorIndex)\r\n                return;\r\n            const cornerTarget = cornersTarget[index];\r\n            const isDiagonal = !floatEquals(cornerTarget.x, anchorFixed.x) &&\r\n                !floatEquals(cornerTarget.y, anchorFixed.y);\r\n            // we ignore the diagonal ray if the quad isn't rotated this makes for better ux\r\n            if (!isManipulatingEdge && !isRotated && isDiagonal)\r\n                return;\r\n            if (isManipulatingEdge &&\r\n                (floatEquals(cornerTarget.x, anchorFixed.x) ||\r\n                    floatEquals(cornerTarget.y, anchorFixed.y)))\r\n                return;\r\n            const rayOrigin = vectorClone(isManipulatingEdge ? cornerOrigin : anchor);\r\n            // start ray slightly away from anchor so we don't intersect with quad edge\r\n            const dir = vectorSubtract(vectorClone(rayOrigin), cornerTarget);\r\n            vectorNormalize(dir);\r\n            vectorMultiply(dir, 0.5);\r\n            if (isManipulatingEdge) {\r\n                vectorAdd(rayOrigin, dir);\r\n            }\r\n            else {\r\n                vectorSubtract(rayOrigin, dir);\r\n            }\r\n            const ray = lineCreate(rayOrigin, cornerTarget);\r\n            const intersection = getLineIntersectionWithQuad(ray);\r\n            if (!intersection)\r\n                return;\r\n            return intersection;\r\n        })\r\n            .filter(Boolean);\r\n        if (intersections.length) {\r\n            const [translateToRight, translateToLeft, translateToTop, translateToBottom] = getTranslationInfo(transform.target);\r\n            let [t, r, b, l] = rectToBounds(rectTarget);\r\n            intersections.forEach(({ x, y }) => {\r\n                const pX = fixPrecision(x, PRECISION);\r\n                const pY = fixPrecision(y, PRECISION);\r\n                if (translateToTop && !floatEquals(pY, anchorFixed.y)) {\r\n                    t = Math.max(t, y);\r\n                }\r\n                if (translateToRight && !floatEquals(pX, anchorFixed.x)) {\r\n                    r = Math.min(r, x);\r\n                }\r\n                if (translateToBottom && !floatEquals(pY, anchorFixed.y)) {\r\n                    b = Math.min(b, y);\r\n                }\r\n                if (translateToLeft && !floatEquals(pX, anchorFixed.x)) {\r\n                    l = Math.max(l, x);\r\n                }\r\n            });\r\n            // new rect\r\n            rect = rectCreateFromBounds([t, r, b, l]);\r\n            // scale back a bit so doesn't overlap with quad\r\n            rectScale$1(rect, EDGE_DISTANCE_FACTOR, anchor);\r\n        }\r\n    }\r\n    // make sure is at least one pixel wide and high\r\n    rectClamp(rect, minSize, maxSize, anchor);\r\n    return rect;\r\n};\r\n\r\n/* src/core/ui/plugins/crop/index.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_default_slot_2$2(ctx) {\r\n\tlet dynamiccomponenttree;\r\n\tlet current;\r\n\tdynamiccomponenttree = new DynamicComponentTree_1({ props: { items: /*cropTools*/ ctx[11] } });\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(dynamiccomponenttree.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(dynamiccomponenttree, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst dynamiccomponenttree_changes = {};\r\n\t\t\tif (dirty[0] & /*cropTools*/ 2048) dynamiccomponenttree_changes.items = /*cropTools*/ ctx[11];\r\n\t\t\tdynamiccomponenttree.$set(dynamiccomponenttree_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(dynamiccomponenttree.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(dynamiccomponenttree.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(dynamiccomponenttree, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (1629:4) \r\nfunction create_header_slot(ctx) {\r\n\tlet div;\r\n\tlet toolbar;\r\n\tlet current;\r\n\r\n\ttoolbar = new Toolbar({\r\n\t\t\tprops: {\r\n\t\t\t\t$$slots: { default: [create_default_slot_2$2] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tcreate_component(toolbar.$$.fragment);\r\n\t\t\tattr(div, \"slot\", \"header\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tmount_component(toolbar, div, null);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst toolbar_changes = {};\r\n\r\n\t\t\tif (dirty[0] & /*cropTools*/ 2048 | dirty[7] & /*$$scope*/ 2) {\r\n\t\t\t\ttoolbar_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ttoolbar.$set(toolbar_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(toolbar.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(toolbar.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tdestroy_component(toolbar);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (1659:12) {#if shouldRenderImageSelection && shouldRenderImageSelectionRecenterButton}\r\nfunction create_if_block_5$2(ctx) {\r\n\tlet button;\r\n\tlet current;\r\n\r\n\tbutton = new Button({\r\n\t\t\tprops: {\r\n\t\t\t\tonclick: /*handleRecenterAction*/ ctx[88],\r\n\t\t\t\tlabel: /*locale*/ ctx[4].cropLabelButtonRecenter,\r\n\t\t\t\ticon: /*locale*/ ctx[4].cropIconButtonRecenter,\r\n\t\t\t\tclass: \"PinturaButtonCenter\",\r\n\t\t\t\tdisabled: !/*canCenter*/ ctx[9],\r\n\t\t\t\thideLabel: true,\r\n\t\t\t\tstyle: `opacity: ${/*$recenterOpacity*/ ctx[29]}; transform: translate3d(${/*$recenterOffset*/ ctx[30].x}px, ${/*$recenterOffset*/ ctx[30].y}px, 0)`\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(button.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(button, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst button_changes = {};\r\n\t\t\tif (dirty[0] & /*locale*/ 16) button_changes.label = /*locale*/ ctx[4].cropLabelButtonRecenter;\r\n\t\t\tif (dirty[0] & /*locale*/ 16) button_changes.icon = /*locale*/ ctx[4].cropIconButtonRecenter;\r\n\t\t\tif (dirty[0] & /*canCenter*/ 512) button_changes.disabled = !/*canCenter*/ ctx[9];\r\n\t\t\tif (dirty[0] & /*$recenterOpacity, $recenterOffset*/ 1610612736) button_changes.style = `opacity: ${/*$recenterOpacity*/ ctx[29]}; transform: translate3d(${/*$recenterOffset*/ ctx[30].x}px, ${/*$recenterOffset*/ ctx[30].y}px, 0)`;\r\n\t\t\tbutton.$set(button_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(button.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(button.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(button, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (1671:12) {#if shouldRenderImageSelection}\r\nfunction create_if_block_4$3(ctx) {\r\n\tlet rectmanipulator;\r\n\tlet current;\r\n\r\n\trectmanipulator = new RectManipulator({\r\n\t\t\tprops: {\r\n\t\t\t\trect: /*imageSelectionRectOffset*/ ctx[8],\r\n\t\t\t\tvisible: /*$isActive*/ ctx[12],\r\n\t\t\t\tstyle: /*cropImageSelectionCornerStyle*/ ctx[1]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\trectmanipulator.$on(\"resizestart\", /*handleSelectionGrab*/ ctx[68]);\r\n\trectmanipulator.$on(\"resizemove\", /*handleSelectionDrag*/ ctx[69]);\r\n\trectmanipulator.$on(\"resizeend\", /*handleSelectionRelease*/ ctx[70]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(rectmanipulator.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(rectmanipulator, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst rectmanipulator_changes = {};\r\n\t\t\tif (dirty[0] & /*imageSelectionRectOffset*/ 256) rectmanipulator_changes.rect = /*imageSelectionRectOffset*/ ctx[8];\r\n\t\t\tif (dirty[0] & /*$isActive*/ 4096) rectmanipulator_changes.visible = /*$isActive*/ ctx[12];\r\n\t\t\tif (dirty[0] & /*cropImageSelectionCornerStyle*/ 2) rectmanipulator_changes.style = /*cropImageSelectionCornerStyle*/ ctx[1];\r\n\t\t\trectmanipulator.$set(rectmanipulator_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(rectmanipulator.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(rectmanipulator.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(rectmanipulator, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (1684:8) {#if shouldRenderInfoIndicator}\r\nfunction create_if_block_3$3(ctx) {\r\n\tlet imageinfo;\r\n\tlet current;\r\n\r\n\timageinfo = new ImageInfo({\r\n\t\t\tprops: {\r\n\t\t\t\twidth: Math.round(/*$imageCropRect*/ ctx[13].width),\r\n\t\t\t\theight: Math.round(/*$imageCropRect*/ ctx[13].height)\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(imageinfo.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(imageinfo, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst imageinfo_changes = {};\r\n\t\t\tif (dirty[0] & /*$imageCropRect*/ 8192) imageinfo_changes.width = Math.round(/*$imageCropRect*/ ctx[13].width);\r\n\t\t\tif (dirty[0] & /*$imageCropRect*/ 8192) imageinfo_changes.height = Math.round(/*$imageCropRect*/ ctx[13].height);\r\n\t\t\timageinfo.$set(imageinfo_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(imageinfo.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(imageinfo.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(imageinfo, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (1635:4) \r\nfunction create_main_slot$1(ctx) {\r\n\tlet div1;\r\n\tlet div0;\r\n\tlet t0;\r\n\tlet interactable_action;\r\n\tlet t1;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tlet if_block0 = /*shouldRenderImageSelection*/ ctx[21] && /*shouldRenderImageSelectionRecenterButton*/ ctx[10] && create_if_block_5$2(ctx);\r\n\tlet if_block1 = /*shouldRenderImageSelection*/ ctx[21] && create_if_block_4$3(ctx);\r\n\tlet if_block2 = /*shouldRenderInfoIndicator*/ ctx[22] && create_if_block_3$3(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv1 = element(\"div\");\r\n\t\t\tdiv0 = element(\"div\");\r\n\t\t\tif (if_block0) if_block0.c();\r\n\t\t\tt0 = space();\r\n\t\t\tif (if_block1) if_block1.c();\r\n\t\t\tt1 = space();\r\n\t\t\tif (if_block2) if_block2.c();\r\n\t\t\tattr(div0, \"class\", \"PinturaStage\");\r\n\t\t\tattr(div1, \"slot\", \"main\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div1, anchor);\r\n\t\t\tappend(div1, div0);\r\n\t\t\tif (if_block0) if_block0.m(div0, null);\r\n\t\t\tappend(div0, t0);\r\n\t\t\tif (if_block1) if_block1.m(div0, null);\r\n\t\t\t/*div0_binding*/ ctx[161](div0);\r\n\t\t\tappend(div1, t1);\r\n\t\t\tif (if_block2) if_block2.m(div1, null);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div0)),\r\n\t\t\t\t\tlisten(div0, \"measure\", /*measure_handler_1*/ ctx[159]),\r\n\t\t\t\t\tlisten(\r\n\t\t\t\t\t\tdiv0,\r\n\t\t\t\t\t\t\"wheel\",\r\n\t\t\t\t\t\tfunction () {\r\n\t\t\t\t\t\t\tif (is_function(/*cropEnableZoom*/ ctx[2] && /*handleWheel*/ ctx[87])) (/*cropEnableZoom*/ ctx[2] && /*handleWheel*/ ctx[87]).apply(this, arguments);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{ passive: false }\r\n\t\t\t\t\t),\r\n\t\t\t\t\tlisten(div0, \"interactionstart\", /*handleImageDragStart*/ ctx[74]),\r\n\t\t\t\t\tlisten(div0, \"interactionupdate\", /*handleImageDrag*/ ctx[75]),\r\n\t\t\t\t\tlisten(div0, \"interactionrelease\", /*handleImageDragRelease*/ ctx[77]),\r\n\t\t\t\t\tlisten(div0, \"interactionend\", /*handleImageDragEnd*/ ctx[76]),\r\n\t\t\t\t\taction_destroyer(interactable_action = interactable.call(null, div0, {\r\n\t\t\t\t\t\tdrag: true,\r\n\t\t\t\t\t\tinertia: true,\r\n\t\t\t\t\t\tpinch: /*cropEnableZoom*/ ctx[2],\r\n\t\t\t\t\t\tshouldStartInteraction: interactable_function$1,\r\n\t\t\t\t\t\tgetEventPosition: /*interactable_function_1*/ ctx[162]\r\n\t\t\t\t\t})),\r\n\t\t\t\t\tlisten(div0, \"gesturedown\", /*handleGestureStart*/ ctx[84]),\r\n\t\t\t\t\tlisten(div0, \"gestureupdate\", /*handleGestureUpdate*/ ctx[85]),\r\n\t\t\t\t\tlisten(div0, \"gestureup\", /*handleGestureEnd*/ ctx[86]),\r\n\t\t\t\t\taction_destroyer(gesturable.call(null, div0))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\r\n\t\t\tif (/*shouldRenderImageSelection*/ ctx[21] && /*shouldRenderImageSelectionRecenterButton*/ ctx[10]) {\r\n\t\t\t\tif (if_block0) {\r\n\t\t\t\t\tif_block0.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[0] & /*shouldRenderImageSelection, shouldRenderImageSelectionRecenterButton*/ 2098176) {\r\n\t\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block0 = create_if_block_5$2(ctx);\r\n\t\t\t\t\tif_block0.c();\r\n\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\tif_block0.m(div0, t0);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block0) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block0, 1, 1, () => {\r\n\t\t\t\t\tif_block0 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (/*shouldRenderImageSelection*/ ctx[21]) {\r\n\t\t\t\tif (if_block1) {\r\n\t\t\t\t\tif_block1.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[0] & /*shouldRenderImageSelection*/ 2097152) {\r\n\t\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block1 = create_if_block_4$3(ctx);\r\n\t\t\t\t\tif_block1.c();\r\n\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\tif_block1.m(div0, null);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block1) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block1, 1, 1, () => {\r\n\t\t\t\t\tif_block1 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (interactable_action && is_function(interactable_action.update) && dirty[0] & /*cropEnableZoom, $rootRect*/ 16777220) interactable_action.update.call(null, {\r\n\t\t\t\tdrag: true,\r\n\t\t\t\tinertia: true,\r\n\t\t\t\tpinch: /*cropEnableZoom*/ ctx[2],\r\n\t\t\t\tshouldStartInteraction: interactable_function$1,\r\n\t\t\t\tgetEventPosition: /*interactable_function_1*/ ctx[162]\r\n\t\t\t});\r\n\r\n\t\t\tif (/*shouldRenderInfoIndicator*/ ctx[22]) {\r\n\t\t\t\tif (if_block2) {\r\n\t\t\t\t\tif_block2.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[0] & /*shouldRenderInfoIndicator*/ 4194304) {\r\n\t\t\t\t\t\ttransition_in(if_block2, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block2 = create_if_block_3$3(ctx);\r\n\t\t\t\t\tif_block2.c();\r\n\t\t\t\t\ttransition_in(if_block2, 1);\r\n\t\t\t\t\tif_block2.m(div1, null);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block2) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block2, 1, 1, () => {\r\n\t\t\t\t\tif_block2 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block0);\r\n\t\t\ttransition_in(if_block1);\r\n\t\t\ttransition_in(if_block2);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block0);\r\n\t\t\ttransition_out(if_block1);\r\n\t\t\ttransition_out(if_block2);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div1);\r\n\t\t\tif (if_block0) if_block0.d();\r\n\t\t\tif (if_block1) if_block1.d();\r\n\t\t\t/*div0_binding*/ ctx[161](null);\r\n\t\t\tif (if_block2) if_block2.d();\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (1692:8) {#if shouldRenderFooter}\r\nfunction create_if_block$4(ctx) {\r\n\tlet tablist;\r\n\tlet t;\r\n\tlet tabpanels;\r\n\tlet current;\r\n\r\n\tconst tablist_spread_levels = [\r\n\t\t{ class: \"PinturaControlList\" },\r\n\t\t{ tabs: /*tabs*/ ctx[7] },\r\n\t\t/*tabsConfig*/ ctx[18]\r\n\t];\r\n\r\n\tlet tablist_props = {\r\n\t\t$$slots: {\r\n\t\t\tdefault: [\r\n\t\t\t\tcreate_default_slot_1$3,\r\n\t\t\t\t({ tab }) => ({ 217: tab }),\r\n\t\t\t\t({ tab }) => [0, 0, 0, 0, 0, 0, 0, tab ? 1 : 0]\r\n\t\t\t]\r\n\t\t},\r\n\t\t$$scope: { ctx }\r\n\t};\r\n\r\n\tfor (let i = 0; i < tablist_spread_levels.length; i += 1) {\r\n\t\ttablist_props = assign(tablist_props, tablist_spread_levels[i]);\r\n\t}\r\n\r\n\ttablist = new TabList({ props: tablist_props });\r\n\ttablist.$on(\"select\", /*select_handler*/ ctx[160]);\r\n\r\n\tconst tabpanels_spread_levels = [\r\n\t\t{ class: \"PinturaControlPanels\" },\r\n\t\t{ panelClass: \"PinturaControlPanel\" },\r\n\t\t{ panels: /*panels*/ ctx[17] },\r\n\t\t/*tabsConfig*/ ctx[18]\r\n\t];\r\n\r\n\tlet tabpanels_props = {\r\n\t\t$$slots: {\r\n\t\t\tdefault: [\r\n\t\t\t\tcreate_default_slot$9,\r\n\t\t\t\t({ panel }) => ({ 216: panel }),\r\n\t\t\t\t({ panel }) => [0, 0, 0, 0, 0, 0, panel ? 1073741824 : 0]\r\n\t\t\t]\r\n\t\t},\r\n\t\t$$scope: { ctx }\r\n\t};\r\n\r\n\tfor (let i = 0; i < tabpanels_spread_levels.length; i += 1) {\r\n\t\ttabpanels_props = assign(tabpanels_props, tabpanels_spread_levels[i]);\r\n\t}\r\n\r\n\ttabpanels = new TabPanels({ props: tabpanels_props });\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(tablist.$$.fragment);\r\n\t\t\tt = space();\r\n\t\t\tcreate_component(tabpanels.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(tablist, target, anchor);\r\n\t\t\tinsert(target, t, anchor);\r\n\t\t\tmount_component(tabpanels, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst tablist_changes = (dirty[0] & /*tabs, tabsConfig*/ 262272)\r\n\t\t\t? get_spread_update(tablist_spread_levels, [\r\n\t\t\t\t\ttablist_spread_levels[0],\r\n\t\t\t\t\tdirty[0] & /*tabs*/ 128 && { tabs: /*tabs*/ ctx[7] },\r\n\t\t\t\t\tdirty[0] & /*tabsConfig*/ 262144 && get_spread_object(/*tabsConfig*/ ctx[18])\r\n\t\t\t\t])\r\n\t\t\t: {};\r\n\r\n\t\t\tif (dirty[7] & /*$$scope, tab*/ 3) {\r\n\t\t\t\ttablist_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ttablist.$set(tablist_changes);\r\n\r\n\t\t\tconst tabpanels_changes = (dirty[0] & /*panels, tabsConfig*/ 393216)\r\n\t\t\t? get_spread_update(tabpanels_spread_levels, [\r\n\t\t\t\t\ttabpanels_spread_levels[0],\r\n\t\t\t\t\ttabpanels_spread_levels[1],\r\n\t\t\t\t\tdirty[0] & /*panels*/ 131072 && { panels: /*panels*/ ctx[17] },\r\n\t\t\t\t\tdirty[0] & /*tabsConfig*/ 262144 && get_spread_object(/*tabsConfig*/ ctx[18])\r\n\t\t\t\t])\r\n\t\t\t: {};\r\n\r\n\t\t\tif (dirty[0] & /*$elasticityMultiplier, $imageRotation, locale, $imageRotationRange, cropRotationRange, imageZoomLevelMin, $imageZoomLevelRange, $imageZoomLevel*/ 511721496 | dirty[6] & /*panel*/ 1073741824 | dirty[7] & /*$$scope*/ 2) {\r\n\t\t\t\ttabpanels_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ttabpanels.$set(tabpanels_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(tablist.$$.fragment, local);\r\n\t\t\ttransition_in(tabpanels.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(tablist.$$.fragment, local);\r\n\t\t\ttransition_out(tabpanels.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(tablist, detaching);\r\n\t\t\tif (detaching) detach(t);\r\n\t\t\tdestroy_component(tabpanels, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (1693:12) <TabList                 class=\"PinturaControlList\"                 {tabs}                 {...tabsConfig}                 on:select={({ detail }) => (transformSelected = detail)}                 let:tab             >\r\nfunction create_default_slot_1$3(ctx) {\r\n\tlet span;\r\n\tlet t_value = /*tab*/ ctx[217].label + \"\";\r\n\tlet t;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt = text(t_value);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t\tappend(span, t);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[7] & /*tab*/ 1 && t_value !== (t_value = /*tab*/ ctx[217].label + \"\")) set_data(t, t_value);\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (1723:59) \r\nfunction create_if_block_2$3(ctx) {\r\n\tlet rangeinput;\r\n\tlet current;\r\n\r\n\trangeinput = new RangeInput({\r\n\t\t\tprops: {\r\n\t\t\t\telasticity: /*$elasticityMultiplier*/ ctx[25] * /*rangeInputElasticity*/ ctx[43],\r\n\t\t\t\tbase: imageZoomLevelBase,\r\n\t\t\t\tmin: /*imageZoomLevelMin*/ ctx[23],\r\n\t\t\t\tmax: imageZoomLevelMax,\r\n\t\t\t\tvalueMin: /*$imageZoomLevelRange*/ ctx[27][0],\r\n\t\t\t\tvalueMax: /*$imageZoomLevelRange*/ ctx[27][1],\r\n\t\t\t\tvalue: /*$imageZoomLevel*/ ctx[28],\r\n\t\t\t\tlabelReset: /*locale*/ ctx[4].labelReset,\r\n\t\t\t\tvalueLabel: `${Math.round(/*$imageZoomLevel*/ ctx[28] * 100)}%`,\r\n\t\t\t\toninputstart: /*handleResizeStart*/ ctx[81],\r\n\t\t\t\toninputmove: /*handleResizeMove*/ ctx[82],\r\n\t\t\t\toninputend: /*handleResizeEnd*/ ctx[83]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(rangeinput.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(rangeinput, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst rangeinput_changes = {};\r\n\t\t\tif (dirty[0] & /*$elasticityMultiplier*/ 33554432) rangeinput_changes.elasticity = /*$elasticityMultiplier*/ ctx[25] * /*rangeInputElasticity*/ ctx[43];\r\n\t\t\tif (dirty[0] & /*imageZoomLevelMin*/ 8388608) rangeinput_changes.min = /*imageZoomLevelMin*/ ctx[23];\r\n\t\t\tif (dirty[0] & /*$imageZoomLevelRange*/ 134217728) rangeinput_changes.valueMin = /*$imageZoomLevelRange*/ ctx[27][0];\r\n\t\t\tif (dirty[0] & /*$imageZoomLevelRange*/ 134217728) rangeinput_changes.valueMax = /*$imageZoomLevelRange*/ ctx[27][1];\r\n\t\t\tif (dirty[0] & /*$imageZoomLevel*/ 268435456) rangeinput_changes.value = /*$imageZoomLevel*/ ctx[28];\r\n\t\t\tif (dirty[0] & /*locale*/ 16) rangeinput_changes.labelReset = /*locale*/ ctx[4].labelReset;\r\n\t\t\tif (dirty[0] & /*$imageZoomLevel*/ 268435456) rangeinput_changes.valueLabel = `${Math.round(/*$imageZoomLevel*/ ctx[28] * 100)}%`;\r\n\t\t\trangeinput.$set(rangeinput_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(rangeinput.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(rangeinput.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(rangeinput, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (1710:16) {#if panel === cropUniqueId + '-rotation'}\r\nfunction create_if_block_1$4(ctx) {\r\n\tlet imagerotator;\r\n\tlet current;\r\n\r\n\timagerotator = new ImageRotator({\r\n\t\t\tprops: {\r\n\t\t\t\telasticity: /*$elasticityMultiplier*/ ctx[25] * /*rangeInputElasticity*/ ctx[43],\r\n\t\t\t\trotation: /*$imageRotation*/ ctx[14],\r\n\t\t\t\tlabelReset: /*locale*/ ctx[4].labelReset,\r\n\t\t\t\tvalueMin: /*$imageRotationRange*/ ctx[26][0],\r\n\t\t\t\tvalueMax: /*$imageRotationRange*/ ctx[26][1],\r\n\t\t\t\trotationMin: -/*cropRotationRange*/ ctx[3],\r\n\t\t\t\trotationMax: /*cropRotationRange*/ ctx[3],\r\n\t\t\t\toninputstart: /*handleRotateStart*/ ctx[71],\r\n\t\t\t\toninputmove: /*handleRotateMove*/ ctx[72],\r\n\t\t\t\toninputend: /*handleRotateEnd*/ ctx[73]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(imagerotator.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(imagerotator, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst imagerotator_changes = {};\r\n\t\t\tif (dirty[0] & /*$elasticityMultiplier*/ 33554432) imagerotator_changes.elasticity = /*$elasticityMultiplier*/ ctx[25] * /*rangeInputElasticity*/ ctx[43];\r\n\t\t\tif (dirty[0] & /*$imageRotation*/ 16384) imagerotator_changes.rotation = /*$imageRotation*/ ctx[14];\r\n\t\t\tif (dirty[0] & /*locale*/ 16) imagerotator_changes.labelReset = /*locale*/ ctx[4].labelReset;\r\n\t\t\tif (dirty[0] & /*$imageRotationRange*/ 67108864) imagerotator_changes.valueMin = /*$imageRotationRange*/ ctx[26][0];\r\n\t\t\tif (dirty[0] & /*$imageRotationRange*/ 67108864) imagerotator_changes.valueMax = /*$imageRotationRange*/ ctx[26][1];\r\n\t\t\tif (dirty[0] & /*cropRotationRange*/ 8) imagerotator_changes.rotationMin = -/*cropRotationRange*/ ctx[3];\r\n\t\t\tif (dirty[0] & /*cropRotationRange*/ 8) imagerotator_changes.rotationMax = /*cropRotationRange*/ ctx[3];\r\n\t\t\timagerotator.$set(imagerotator_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(imagerotator.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(imagerotator.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(imagerotator, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (1703:12) <TabPanels                 class=\"PinturaControlPanels\"                 panelClass=\"PinturaControlPanel\"                 {panels}                 {...tabsConfig}                 let:panel             >\r\nfunction create_default_slot$9(ctx) {\r\n\tlet current_block_type_index;\r\n\tlet if_block;\r\n\tlet if_block_anchor;\r\n\tlet current;\r\n\tconst if_block_creators = [create_if_block_1$4, create_if_block_2$3];\r\n\tconst if_blocks = [];\r\n\r\n\tfunction select_block_type(ctx, dirty) {\r\n\t\tif (/*panel*/ ctx[216] === /*cropUniqueId*/ ctx[93] + '-rotation') return 0;\r\n\t\tif (/*panel*/ ctx[216] === /*cropUniqueId*/ ctx[93] + '-zoom') return 1;\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tif (~(current_block_type_index = select_block_type(ctx))) {\r\n\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tif_block_anchor = empty();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (~current_block_type_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].m(target, anchor);\r\n\t\t\t}\r\n\r\n\t\t\tinsert(target, if_block_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tlet previous_block_index = current_block_type_index;\r\n\t\t\tcurrent_block_type_index = select_block_type(ctx);\r\n\r\n\t\t\tif (current_block_type_index === previous_block_index) {\r\n\t\t\t\tif (~current_block_type_index) {\r\n\t\t\t\t\tif_blocks[current_block_type_index].p(ctx, dirty);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\t\ttransition_out(if_blocks[previous_block_index], 1, 1, () => {\r\n\t\t\t\t\t\tif_blocks[previous_block_index] = null;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tcheck_outros();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (~current_block_type_index) {\r\n\t\t\t\t\tif_block = if_blocks[current_block_type_index];\r\n\r\n\t\t\t\t\tif (!if_block) {\r\n\t\t\t\t\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t\t\t\t\t\tif_block.c();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif_block.p(ctx, dirty);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(if_block_anchor.parentNode, if_block_anchor);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (~current_block_type_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].d(detaching);\r\n\t\t\t}\r\n\r\n\t\t\tif (detaching) detach(if_block_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (1691:4) \r\nfunction create_footer_slot$5(ctx) {\r\n\tlet div;\r\n\tlet current;\r\n\tlet if_block = /*shouldRenderFooter*/ ctx[19] && create_if_block$4(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tattr(div, \"slot\", \"footer\");\r\n\t\t\tattr(div, \"style\", /*footerStyle*/ ctx[16]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tif (if_block) if_block.m(div, null);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (/*shouldRenderFooter*/ ctx[19]) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[0] & /*shouldRenderFooter*/ 524288) {\r\n\t\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block$4(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(div, null);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block, 1, 1, () => {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*footerStyle*/ 65536) {\r\n\t\t\t\tattr(div, \"style\", /*footerStyle*/ ctx[16]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif (if_block) if_block.d();\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$l(ctx) {\r\n\tlet util;\r\n\tlet updating_root;\r\n\tlet current;\r\n\r\n\tfunction util_root_binding(value) {\r\n\t\t/*util_root_binding*/ ctx[163](value);\r\n\t}\r\n\r\n\tlet util_props = {\r\n\t\thasHeader: /*shouldRenderToolbar*/ ctx[20],\r\n\t\t$$slots: {\r\n\t\t\tfooter: [create_footer_slot$5],\r\n\t\t\tmain: [create_main_slot$1],\r\n\t\t\theader: [create_header_slot]\r\n\t\t},\r\n\t\t$$scope: { ctx }\r\n\t};\r\n\r\n\tif (/*root*/ ctx[15] !== void 0) {\r\n\t\tutil_props.root = /*root*/ ctx[15];\r\n\t}\r\n\r\n\tutil = new Util({ props: util_props });\r\n\tbinding_callbacks.push(() => bind(util, 'root', util_root_binding));\r\n\tutil.$on(\"measure\", /*measure_handler*/ ctx[164]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(util.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(util, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst util_changes = {};\r\n\t\t\tif (dirty[0] & /*shouldRenderToolbar*/ 1048576) util_changes.hasHeader = /*shouldRenderToolbar*/ ctx[20];\r\n\r\n\t\t\tif (dirty[0] & /*footerStyle, panels, tabsConfig, $elasticityMultiplier, $imageRotation, locale, $imageRotationRange, cropRotationRange, imageZoomLevelMin, $imageZoomLevelRange, $imageZoomLevel, tabs, transformSelected, shouldRenderFooter, $imageCropRect, shouldRenderInfoIndicator, stageRef, cropEnableZoom, $rootRect, imageSelectionRectOffset, $isActive, cropImageSelectionCornerStyle, shouldRenderImageSelection, canCenter, $recenterOpacity, $recenterOffset, shouldRenderImageSelectionRecenterButton, cropTools*/ 2146402302 | dirty[7] & /*$$scope*/ 2) {\r\n\t\t\t\tutil_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tif (!updating_root && dirty[0] & /*root*/ 32768) {\r\n\t\t\t\tupdating_root = true;\r\n\t\t\t\tutil_changes.root = /*root*/ ctx[15];\r\n\t\t\t\tadd_flush_callback(() => updating_root = false);\r\n\t\t\t}\r\n\r\n\t\t\tutil.$set(util_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(util.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(util.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(util, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nconst imageZoomLevelMax = 1;\r\nconst imageZoomLevelBase = 0;\r\nconst interactable_function$1 = (e, element) => e.target === element;\r\n\r\nfunction instance$l($$self, $$props, $$invalidate) {\r\n\tlet hasCropSelectPresetOptions;\r\n\tlet cropTools;\r\n\tlet imageZoomLevelMin;\r\n\tlet imageSelectionOffset;\r\n\tlet imageSelectionCenter;\r\n\tlet imageSelectionCenteredRect;\r\n\tlet isImageSelectionDisplayed;\r\n\tlet isImageSelectionCentered;\r\n\tlet isResizingSelection;\r\n\tlet isMaxSelectionRect;\r\n\tlet isOverlayMode;\r\n\tlet canZoomToCenter;\r\n\tlet canCenter;\r\n\tlet shouldRenderInfoIndicator;\r\n\tlet shouldRenderImageSelection;\r\n\tlet shouldRenderImageSelectionRecenterButton;\r\n\tlet imageSelectionRectOffset;\r\n\tlet hasPlentyVerticalSpace;\r\n\tlet shouldRenderPresetSelect;\r\n\tlet shouldRenderToolbar;\r\n\tlet couldRenderZoomInput;\r\n\tlet shouldRenderZoomInput;\r\n\tlet shouldRenderFooter;\r\n\tlet tabsConfig;\r\n\tlet tabs;\r\n\tlet panels;\r\n\tlet footerStyle;\r\n\tlet $footerOffset;\r\n\r\n\tlet $isActive,\r\n\t\t$$unsubscribe_isActive = noop,\r\n\t\t$$subscribe_isActive = () => ($$unsubscribe_isActive(), $$unsubscribe_isActive = subscribe(isActive, $$value => $$invalidate(12, $isActive = $$value)), isActive);\r\n\r\n\tlet $isAnimated;\r\n\tlet $env;\r\n\tlet $imageSelectionGuides;\r\n\tlet $imageOverlayMarkup;\r\n\tlet $stagePadded;\r\n\tlet $imagePreviewModifiers;\r\n\tlet $imageSelectionRectPresentation;\r\n\tlet $isInteracting;\r\n\tlet $imageIsStatic;\r\n\tlet $imageCropRect;\r\n\tlet $imageScalar;\r\n\tlet $presentationScalar;\r\n\tlet $utilRectPadded;\r\n\tlet $imageSelectionRectSnapshot;\r\n\tlet $imageSelectionRect;\r\n\tlet $stageRect;\r\n\tlet $isTransformingImage;\r\n\tlet $imageCropRangeAspectRatio;\r\n\tlet $imageSize;\r\n\tlet $imageRotation;\r\n\tlet $imageCropLimitToImage;\r\n\tlet $imageCropMinSize;\r\n\tlet $rootRect;\r\n\tlet $imageCropRectIntent;\r\n\tlet $imageCropRange;\r\n\tlet $imageCropRectOrigin;\r\n\tlet $imageCropAspectRatio;\r\n\tlet $imageStaticVisualCorners;\r\n\tlet $imageSelectionRectIntent;\r\n\tlet $imageCropMaxSize;\r\n\tlet $utilTools;\r\n\tlet $imageOutputSize;\r\n\tlet $selectedPresetIndex;\r\n\tlet $formattedCropPresetOptions;\r\n\tlet $imageFlipY;\r\n\tlet $imageFlipX;\r\n\tlet $redrawTrigger;\r\n\tlet $elasticityMultiplier;\r\n\tlet $imageRotationRange;\r\n\tlet $imageZoomLevelRange;\r\n\tlet $imageZoomLevel;\r\n\tlet $recenterOpacity;\r\n\tlet $recenterOffset;\r\n\t$$self.$$.on_destroy.push(() => $$unsubscribe_isActive());\r\n\tconst name = 'crop';\r\n\tlet { isActive } = $$props;\r\n\t$$subscribe_isActive();\r\n\tlet { stores } = $$props;\r\n\tlet { cropImageSelectionCornerStyle = 'circle' } = $$props;\r\n\r\n\tlet { cropWillRenderImageSelectionGuides = (interaction, interactionFraction) => {\r\n\t\tconst isRotating = interaction == 'rotate';\r\n\r\n\t\treturn {\r\n\t\t\trows: isRotating ? 5 : 3,\r\n\t\t\tcols: isRotating ? 5 : 3,\r\n\t\t\topacity: interactionFraction * 0.25\r\n\t\t};\r\n\t} } = $$props;\r\n\r\n\tlet { cropAutoCenterImageSelectionTimeout = undefined } = $$props;\r\n\tlet { cropEnableZoomMatchImageAspectRatio = true } = $$props;\r\n\tlet { cropEnableRotateMatchImageAspectRatio = 'never' } = $$props;\r\n\tlet { cropEnableRotationInput = true } = $$props;\r\n\tlet { cropEnableZoom = true } = $$props;\r\n\tlet { cropEnableZoomInput = true } = $$props;\r\n\tlet { cropEnableZoomAutoHide = true } = $$props;\r\n\tlet { cropEnableImageSelection = true } = $$props;\r\n\tlet { cropEnableInfoIndicator = false } = $$props;\r\n\tlet { cropEnableZoomTowardsWheelPosition = true } = $$props;\r\n\tlet { cropEnableLimitWheelInputToCropSelection = true } = $$props;\r\n\tlet { cropEnableCenterImageSelection = true } = $$props;\r\n\tlet { cropEnableButtonRotateLeft = true } = $$props;\r\n\tlet { cropEnableButtonRotateRight = false } = $$props;\r\n\tlet { cropEnableButtonFlipHorizontal = true } = $$props;\r\n\tlet { cropEnableButtonFlipVertical = false } = $$props;\r\n\tlet { cropSelectPresetOptions = undefined } = $$props;\r\n\tlet { cropEnableSelectPreset = true } = $$props;\r\n\tlet { cropEnableFilterMatchAspectRatio = true } = $$props;\r\n\tlet { cropSelectPresetFilter = false } = $$props;\r\n\tlet { cropEnableButtonToggleCropLimit = false } = $$props;\r\n\tlet { cropWillRenderTools = passthrough } = $$props;\r\n\tlet { cropActiveTransformTool = 'rotation' } = $$props;\r\n\tlet { cropMinimizeToolbar = 'auto' } = $$props;\r\n\tlet { cropInteractionFocus = 'image' } = $$props;\r\n\tlet { cropRotationRange = QUART_PI } = $$props;\r\n\tlet { locale = {} } = $$props;\r\n\r\n\t// context\r\n\tconst isAnimated = getContext('isAnimated');\r\n\r\n\tcomponent_subscribe($$self, isAnimated, value => $$invalidate(138, $isAnimated = value));\r\n\tconst elasticityMultiplier = getContext('elasticityMultiplier');\r\n\tcomponent_subscribe($$self, elasticityMultiplier, value => $$invalidate(25, $elasticityMultiplier = value));\r\n\tconst redrawTrigger = getContext('redrawTrigger');\r\n\tcomponent_subscribe($$self, redrawTrigger, value => $$invalidate(158, $redrawTrigger = value));\r\n\tconst imageIsStatic = getContext('imageIsStatic');\r\n\tcomponent_subscribe($$self, imageIsStatic, value => $$invalidate(144, $imageIsStatic = value));\r\n\tconst imageStaticVisualCorners = getContext('imageStaticVisualCorners');\r\n\tcomponent_subscribe($$self, imageStaticVisualCorners, value => $$invalidate(181, $imageStaticVisualCorners = value));\r\n\r\n\t// state\r\n\tlet interaction = 'idle';\r\n\r\n\t// formatted crop select options\r\n\tconst formattedCropPresetOptions = writable();\r\n\r\n\tcomponent_subscribe($$self, formattedCropPresetOptions, value => $$invalidate(155, $formattedCropPresetOptions = value));\r\n\r\n\t// #region helpers\r\n\tconst isCustomCrop = () => $imageCropAspectRatio === undefined;\r\n\r\n\tconst turnAspectRatio = aspectRatio => 1 / aspectRatio;\r\n\r\n\tconst applyCropPresetFilter = filter => {\r\n\t\t// no change\r\n\t\tif (!cropEnableFilterMatchAspectRatio || cropSelectPresetFilter === filter) return;\r\n\r\n\t\t// change\r\n\t\t$$invalidate(95, cropSelectPresetFilter = filter);\r\n\r\n\t\t// square or free, exit\r\n\t\tif (!$imageCropAspectRatio || $imageCropAspectRatio === 1) return;\r\n\r\n\t\tif (!hasValidRotatedCropAspectRatio()) return;\r\n\t\tset_store_value(imageCropAspectRatio, $imageCropAspectRatio = turnAspectRatio($imageCropAspectRatio), $imageCropAspectRatio);\r\n\t};\r\n\r\n\tconst hasValidRotatedCropAspectRatio = () => {\r\n\t\t// no options available, forced crop aspect ratio\r\n\t\tif ($imageCropAspectRatio === 1 || !hasCropSelectPresetOptions) return false;\r\n\r\n\t\t// get rotated\r\n\t\tconst rotatedImageCropAspectRatio = turnAspectRatio($imageCropAspectRatio);\r\n\r\n\t\t// options available but no valid option in list\r\n\t\tif (!flattenOptions($formattedCropPresetOptions).find(([aspectRatio]) => aspectRatio === rotatedImageCropAspectRatio)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t};\r\n\r\n\tconst isCropMaxSize = (imageCropRect, imageSize, imageRotation) => isRotatedSideways(imageRotation)\r\n\t? imageSize.width === Math.round(imageCropRect.height) || imageSize.height === Math.round(imageCropRect.width)\r\n\t: imageSize.width === Math.round(imageCropRect.width) || imageSize.height === Math.round(imageCropRect.height);\r\n\r\n\tconst isCropCentered = (imageCropRect, imageSize, imageRotation) => {\r\n\t\tconst imageSizeRotated = sizeApply(sizeRotate(sizeClone(imageSize), imageRotation), v => Math.abs(Math.round(v)));\r\n\t\tconst imageCenter = sizeCenter(imageSizeRotated);\r\n\t\tconst cropCenter = rectCenter(imageCropRect);\r\n\t\treturn vectorEqual(imageCenter, cropCenter);\r\n\t};\r\n\r\n\tconst canMatchCropAspectRatioToRotation = () => // is custom crop mode\r\n\t(isCustomCrop() || // can match preset crop and preset is available\r\n\tcropEnableRotateMatchImageAspectRatio === 'always' && hasValidRotatedCropAspectRatio()) && isCropCentered($imageCropRect, $imageSize, $imageRotation) && isCropMaxSize($imageCropRect, $imageSize, $imageRotation);\r\n\r\n\tconst applyRotation = value => {\r\n\t\tif (cropEnableRotateMatchImageAspectRatio !== 'never' && canMatchCropAspectRatioToRotation()) {\r\n\t\t\tset_store_value(imageRotation, $imageRotation += value, $imageRotation);\r\n\t\t\tconst isRotated = isRotatedSideways($imageRotation);\r\n\t\t\tconst w = isRotated ? $imageSize.height : $imageSize.width;\r\n\t\t\tconst h = isRotated ? $imageSize.width : $imageSize.height;\r\n\t\t\tset_store_value(imageCropRect, $imageCropRect = rectCreate(0, 0, w, h), $imageCropRect);\r\n\t\t\tif (!isCustomCrop()) set_store_value(imageCropAspectRatio, $imageCropAspectRatio = getAspectRatio(w, h), $imageCropAspectRatio);\r\n\t\t} else {\r\n\t\t\tset_store_value(imageRotation, $imageRotation += value, $imageRotation);\r\n\t\t}\r\n\t};\r\n\r\n\t//#endregion\r\n\tconst { history, env, isInteracting, isInteractingFraction, isTransformingImage, rootRect, stageRect, utilRect, utilRectPadded, rootLineColor, allowPan, allowZoom, rangeInputElasticity, presentationScalar, utilTools, // effect filtering\r\n\timagePreviewModifiers, imageOutlineOpacity, // crop selection\r\n\timageFlipX, imageFlipY, imageRotation, imageRotationRange, imageOutputSize, imageSelectionRect, imageSelectionRectSnapshot, imageSelectionRectIntent, imageSelectionRectPresentation, imageCropRectIntent, imageCropRectOrigin, imageCropRect, imageCropMinSize, imageCropMaxSize, imageCropRange, imageCropAspectRatio, imageCropLimitToImage, imageSize, imageScalar, imageOverlayMarkup, stagePadded, stageRecenter } = stores;\r\n\r\n\tcomponent_subscribe($$self, env, value => $$invalidate(139, $env = value));\r\n\tcomponent_subscribe($$self, isInteracting, value => $$invalidate(143, $isInteracting = value));\r\n\tcomponent_subscribe($$self, isTransformingImage, value => $$invalidate(175, $isTransformingImage = value));\r\n\tcomponent_subscribe($$self, rootRect, value => $$invalidate(24, $rootRect = value));\r\n\tcomponent_subscribe($$self, stageRect, value => $$invalidate(150, $stageRect = value));\r\n\tcomponent_subscribe($$self, utilRectPadded, value => $$invalidate(147, $utilRectPadded = value));\r\n\tcomponent_subscribe($$self, presentationScalar, value => $$invalidate(146, $presentationScalar = value));\r\n\tcomponent_subscribe($$self, utilTools, value => $$invalidate(184, $utilTools = value));\r\n\tcomponent_subscribe($$self, imagePreviewModifiers, value => $$invalidate(174, $imagePreviewModifiers = value));\r\n\tcomponent_subscribe($$self, imageFlipX, value => $$invalidate(157, $imageFlipX = value));\r\n\tcomponent_subscribe($$self, imageFlipY, value => $$invalidate(156, $imageFlipY = value));\r\n\tcomponent_subscribe($$self, imageRotation, value => $$invalidate(14, $imageRotation = value));\r\n\tcomponent_subscribe($$self, imageRotationRange, value => $$invalidate(26, $imageRotationRange = value));\r\n\tcomponent_subscribe($$self, imageOutputSize, value => $$invalidate(185, $imageOutputSize = value));\r\n\tcomponent_subscribe($$self, imageSelectionRect, value => $$invalidate(149, $imageSelectionRect = value));\r\n\tcomponent_subscribe($$self, imageSelectionRectSnapshot, value => $$invalidate(148, $imageSelectionRectSnapshot = value));\r\n\tcomponent_subscribe($$self, imageSelectionRectIntent, value => $$invalidate(182, $imageSelectionRectIntent = value));\r\n\tcomponent_subscribe($$self, imageSelectionRectPresentation, value => $$invalidate(142, $imageSelectionRectPresentation = value));\r\n\tcomponent_subscribe($$self, imageCropRectIntent, value => $$invalidate(177, $imageCropRectIntent = value));\r\n\tcomponent_subscribe($$self, imageCropRectOrigin, value => $$invalidate(179, $imageCropRectOrigin = value));\r\n\tcomponent_subscribe($$self, imageCropRect, value => $$invalidate(13, $imageCropRect = value));\r\n\tcomponent_subscribe($$self, imageCropMinSize, value => $$invalidate(153, $imageCropMinSize = value));\r\n\tcomponent_subscribe($$self, imageCropMaxSize, value => $$invalidate(183, $imageCropMaxSize = value));\r\n\tcomponent_subscribe($$self, imageCropRange, value => $$invalidate(178, $imageCropRange = value));\r\n\tcomponent_subscribe($$self, imageCropAspectRatio, value => $$invalidate(180, $imageCropAspectRatio = value));\r\n\tcomponent_subscribe($$self, imageCropLimitToImage, value => $$invalidate(152, $imageCropLimitToImage = value));\r\n\tcomponent_subscribe($$self, imageSize, value => $$invalidate(151, $imageSize = value));\r\n\tcomponent_subscribe($$self, imageScalar, value => $$invalidate(145, $imageScalar = value));\r\n\tcomponent_subscribe($$self, imageOverlayMarkup, value => $$invalidate(173, $imageOverlayMarkup = value));\r\n\tcomponent_subscribe($$self, stagePadded, value => $$invalidate(141, $stagePadded = value));\r\n\r\n\t// #endregion\r\n\t// #region adjusting crop selection\r\n\tlet presentationScalarSnapshot;\r\n\r\n\tlet imageSelectionRectMinSize;\r\n\tlet imageSelectionRectMaxSize;\r\n\r\n\tconst handleSelectionGrab = () => {\r\n\t\tinteraction = 'select';\r\n\r\n\t\t// now interacting\r\n\t\tset_store_value(isInteracting, $isInteracting = true, $isInteracting);\r\n\r\n\t\t// we remember the current view rect and crop rect, because that is the crop rect we use as a starting point to transform while dragging\r\n\t\tset_store_value(imageSelectionRectSnapshot, $imageSelectionRectSnapshot = rectClone$1($imageSelectionRect), $imageSelectionRectSnapshot);\r\n\r\n\t\t// remember current scalar so we can update min and max size correctly\r\n\t\tpresentationScalarSnapshot = $presentationScalar;\r\n\r\n\t\timageSelectionRectMinSize = sizeScale(sizeClone($imageCropMinSize), presentationScalarSnapshot);\r\n\t\timageSelectionRectMaxSize = sizeScale(sizeClone($imageCropMaxSize), presentationScalarSnapshot);\r\n\t};\r\n\r\n\tconst handleSelectionDrag = ({ detail }) => {\r\n\t\tconst { boundsLimited, boundsIntent } = translateSelection(detail.direction, detail.translation);\r\n\r\n\t\t// now transforming image\r\n\t\tset_store_value(isTransformingImage, $isTransformingImage = true, $isTransformingImage);\r\n\r\n\t\t// update actual image selection rectangle\r\n\t\tset_store_value(imageSelectionRectIntent, $imageSelectionRectIntent = boundsIntent, $imageSelectionRectIntent); // intent needs to be updated first because has no listeners attached\r\n\r\n\t\tset_store_value(imageSelectionRect, $imageSelectionRect = boundsLimited, $imageSelectionRect);\r\n\t};\r\n\r\n\tconst handleSelectionRelease = ({ detail }) => {\r\n\t\tconst { boundsLimited } = translateSelection(detail.direction, detail.translation);\r\n\r\n\t\t// no longer transforming image\r\n\t\tset_store_value(isTransformingImage, $isTransformingImage = false, $isTransformingImage);\r\n\r\n\t\t// we're no longer interacting with the image selection, we need to set this here so the image selection presentation is animated when applying the new bounds below\r\n\t\tset_store_value(isInteracting, $isInteracting = false, $isInteracting);\r\n\r\n\t\t// no more intent as we're finalizing the selection, so before setting the final selection, we set this to undefined | intent needs to be updated first because has no listeners attached\r\n\t\tset_store_value(imageSelectionRectIntent, $imageSelectionRectIntent = undefined, $imageSelectionRectIntent);\r\n\r\n\t\t// confirm the limited rect if actually made a change\r\n\t\tif (vectorLength(detail.translation)) {\r\n\t\t\tset_store_value(imageSelectionRect, $imageSelectionRect = boundsLimited, $imageSelectionRect);\r\n\t\t\thistory.write();\r\n\t\t}\r\n\r\n\t\t// need to set this to undefined after setting the final rect, the snapshot is used to calculate the crop rect transform\r\n\t\tset_store_value(imageSelectionRectSnapshot, $imageSelectionRectSnapshot = undefined, $imageSelectionRectSnapshot);\r\n\r\n\t\t// done interacting with selection\r\n\t\tinteraction = undefined;\r\n\t};\r\n\r\n\tconst translateSelection = (target, translate) => {\r\n\t\t// - selection may grow to max bounds (util bounds when _not_ static image)\r\n\t\t// - when image is static selection may grow to image polygon edges\r\n\t\t// - when not static image the image preview(!) is scaled to fit the selection, actual image size is not affected\r\n\t\t// - we always need to make sure the selection adheres to the aspect ratio of the min size\r\n\t\tconst directionTranslation = { target, translate };\r\n\r\n\t\tlet rectIntended = applyRectDirectionTranslation($imageSelectionRectSnapshot, directionTranslation, { aspectRatio: $imageCropAspectRatio });\r\n\r\n\t\t// calculate new rect bounds\r\n\t\tif ($imageIsStatic) {\r\n\t\t\t// make sure not smaller\r\n\t\t\trectIntended = limitRectDirectionTranslation($imageSelectionRectSnapshot, directionTranslation, $utilRectPadded, {\r\n\t\t\t\taspectRatio: $imageCropAspectRatio,\r\n\t\t\t\tminSize: imageSelectionRectMinSize,\r\n\t\t\t\tmaxSize: imageSelectionRectMaxSize\r\n\t\t\t});\r\n\r\n\t\t\t// limit selection rect to util bounds\r\n\t\t\trectIntended = rectLimitInRect(rectIntended, { ...$utilRectPadded, x: 0, y: 0 }, $imageCropAspectRatio);\r\n\r\n\t\t\t// no limits\r\n\t\t\tif (!$imageCropLimitToImage) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tboundsLimited: rectIntended,\r\n\t\t\t\t\tboundsIntent: rectIntended\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// limit to image\r\n\t\t\tlet rectLimited = getRectLimitedToQuad($imageSelectionRectSnapshot, rectIntended, directionTranslation, $imageStaticVisualCorners, {\r\n\t\t\t\taspectRatio: $imageCropAspectRatio,\r\n\t\t\t\tminSize: imageSelectionRectMinSize,\r\n\t\t\t\tmaxSize: imageSelectionRectMaxSize\r\n\t\t\t});\r\n\r\n\t\t\treturn {\r\n\t\t\t\tboundsLimited: rectLimited,\r\n\t\t\t\tboundsIntent: rectLimited\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tlet cropAspectRatioLimited;\r\n\r\n\t\t// size in crop rect\r\n\t\tconst cropSize = sizeCreateFromRect(rectDivide(rectClone$1(rectIntended), $presentationScalar));\r\n\r\n\t\t// if one of the edges is small and not both are smaller we need to correct\r\n\t\tif (cropSize.width < $imageCropMinSize.width || cropSize.height < $imageCropMinSize.height) {\r\n\t\t\t// if moving towards the center of the crop, it can't exceed bounds\r\n\t\t\tconst translateUp = translate.y < 0;\r\n\r\n\t\t\tconst translateRight = translate.x > 0;\r\n\t\t\tconst translateLeft = translate.x < 0;\r\n\t\t\tconst translateDown = translate.y > 0;\r\n\t\t\tconst couldExceedBounds = target === 't' && translateUp || target === 'r' && translateRight || target === 'b' && translateDown || target === 'l' && translateLeft || target === 'tr' && (translateRight || translateUp) || target === 'tl' && (translateLeft || translateUp) || target === 'br' && (translateRight || translateDown) || target === 'bl' && (translateLeft || translateDown);\r\n\r\n\t\t\t// need the aspect ratio of the crop to determine if it violates min size\r\n\t\t\tconst cropAspectRatio = rectAspectRatio(cropSize);\r\n\r\n\t\t\t// find the maximum size for the current aspect ratio\r\n\t\t\tconst cropSizeMax = getMaxSizeInRect($imageSize, $imageRotation, cropAspectRatio);\r\n\r\n\t\t\tif (couldExceedBounds && (cropSizeMax.width < $imageCropMinSize.width || cropSizeMax.height < $imageCropMinSize.height)) {\r\n\t\t\t\tif ($imageRotation !== 0) {\r\n\t\t\t\t\tconst sign = Math.sign($imageRotation);\r\n\t\t\t\t\tconst turns = Math.round(Math.abs($imageRotation) / HALF_PI) * HALF_PI;\r\n\t\t\t\t\tconst value = $imageRotation - sign * turns;\r\n\t\t\t\t\tconst imageIsRotated = turns / HALF_PI % 2 === 1;\r\n\t\t\t\t\tconst imageWidth = imageIsRotated ? $imageSize.height : $imageSize.width;\r\n\t\t\t\t\tconst imageHeight = imageIsRotated ? $imageSize.width : $imageSize.height;\r\n\t\t\t\t\tconst r = Math.abs(value);\r\n\t\t\t\t\tconst sin = Math.sin(r);\r\n\t\t\t\t\tconst cos = Math.cos(r);\r\n\r\n\t\t\t\t\tif (cropSize.width < $imageCropMinSize.width) {\r\n\t\t\t\t\t\t// width doesn't fit, let's limit the width to the min size\r\n\t\t\t\t\t\tcropSize.width = $imageCropMinSize.width;\r\n\r\n\t\t\t\t\t\t// And now calculate the height\r\n\t\t\t\t\t\t//  - rotation = .15\r\n\t\t\t\t\t\t//  - image size = 384 x 288\r\n\t\t\t\t\t\t//  - crop size width = 200\r\n\t\t\t\t\t\t// height = 288 - (Math.sin(.15) * 200) / Math.cos(.15)\r\n\t\t\t\t\t\tconst w = cos * cropSize.width + sin * cropSize.height;\r\n\r\n\t\t\t\t\t\tconst h = sin * cropSize.width + cos * cropSize.height;\r\n\t\t\t\t\t\tconst dx = imageWidth - w;\r\n\t\t\t\t\t\tconst dy = imageHeight - h;\r\n\r\n\t\t\t\t\t\tif (dx < dy) {\r\n\t\t\t\t\t\t\tcropSize.height = (imageWidth - cos * cropSize.width) / sin;\r\n\t\t\t\t\t\t} else if (dy < dx) {\r\n\t\t\t\t\t\t\tcropSize.height = (imageHeight - sin * cropSize.width) / cos;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (cropSize.height < $imageCropMinSize.height) {\r\n\t\t\t\t\t\t// height doesn't fit, let's limit the height to the min size\r\n\t\t\t\t\t\tcropSize.height = $imageCropMinSize.height;\r\n\r\n\t\t\t\t\t\t// And now calculate the width\r\n\t\t\t\t\t\t//  - rotation = .15\r\n\t\t\t\t\t\t//  - image size = 384 x 288\r\n\t\t\t\t\t\t//  - crop size height = 200\r\n\t\t\t\t\t\tconst w = cos * cropSize.width + sin * cropSize.height;\r\n\r\n\t\t\t\t\t\tconst h = sin * cropSize.width + cos * cropSize.height;\r\n\t\t\t\t\t\tconst dx = imageWidth - w;\r\n\t\t\t\t\t\tconst dy = imageHeight - h;\r\n\r\n\t\t\t\t\t\tif (dx < dy) {\r\n\t\t\t\t\t\t\t// (384 - (Math.sin(.15) * 250)) / Math.cos(.15)\r\n\t\t\t\t\t\t\tcropSize.width = (imageWidth - sin * cropSize.height) / cos;\r\n\t\t\t\t\t\t} else if (dy < dx) {\r\n\t\t\t\t\t\t\t// (288 - (Math.cos(.15) * 250)) / Math.sin(.15)\r\n\t\t\t\t\t\t\tcropSize.width = (imageHeight - cos * cropSize.height) / sin;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (cropSize.width < $imageCropMinSize.width) {\r\n\t\t\t\t\t\tcropSize.width = $imageCropMinSize.width;\r\n\t\t\t\t\t\tcropSize.height = $imageSize.height;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (cropSize.height < $imageCropMinSize.height) {\r\n\t\t\t\t\t\tcropSize.height = $imageCropMinSize.height;\r\n\t\t\t\t\t\tcropSize.width = $imageSize.width;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// we now have a corrected size, let's calculate the new aspect ratio and use that to limit the translation\r\n\t\t\t\tcropAspectRatioLimited = rectAspectRatio(cropSize);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (cropAspectRatioLimited) {\r\n\t\t\trectIntended = applyRectDirectionTranslation($imageSelectionRectSnapshot, directionTranslation, {\r\n\t\t\t\taspectRatio: cropAspectRatioLimited || $imageCropAspectRatio\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// limit rectangle to util bounds\r\n\t\tlet rectLimited = limitRectDirectionTranslation($imageSelectionRectSnapshot, directionTranslation, $utilRectPadded, {\r\n\t\t\taspectRatio: $imageCropAspectRatio || cropAspectRatioLimited,\r\n\t\t\tminSize: imageSelectionRectMinSize,\r\n\t\t\tmaxSize: imageSelectionRectMaxSize\r\n\t\t});\r\n\r\n\t\treturn {\r\n\t\t\tboundsLimited: rectLimited,\r\n\t\t\tboundsIntent: rectIntended\r\n\t\t};\r\n\t};\r\n\r\n\t// #endregion\r\n\t// #region rotating\r\n\tconst handleRotateStart = () => {\r\n\t\tinteraction = 'rotate';\r\n\r\n\t\t// now interacting with view\r\n\t\tset_store_value(isInteracting, $isInteracting = true, $isInteracting);\r\n\r\n\t\t// we need to know the origin of the crop so we can \"shrink\" the image to fit the crop rect while rotating\r\n\t\tset_store_value(imageCropRectOrigin, $imageCropRectOrigin = rectClone$1($imageCropRect), $imageCropRectOrigin);\r\n\t};\r\n\r\n\tconst handleRotateMove = value => {\r\n\t\t// now transforming image\r\n\t\tset_store_value(isTransformingImage, $isTransformingImage = true, $isTransformingImage);\r\n\r\n\t\tset_store_value(imageRotation, $imageRotation = value, $imageRotation); // will auto validate\r\n\t};\r\n\r\n\tconst handleRotateEnd = value => {\r\n\t\t// no longer transforming image\r\n\t\tset_store_value(isTransformingImage, $isTransformingImage = false, $isTransformingImage);\r\n\r\n\t\t// we're done interacting\r\n\t\tset_store_value(isInteracting, $isInteracting = false, $isInteracting);\r\n\r\n\t\t// apply our final rotation value\r\n\t\tset_store_value(imageRotation, $imageRotation = value, $imageRotation);\r\n\r\n\t\thistory.write();\r\n\r\n\t\t// done, so we no longer need to \"shrink\" the image\r\n\t\tset_store_value(imageCropRectOrigin, $imageCropRectOrigin = undefined, $imageCropRectOrigin);\r\n\t};\r\n\r\n\t// #endregion\r\n\t// #region moving\r\n\tlet interactionCropRect = undefined;\r\n\r\n\tlet interactionCropRectForce = undefined;\r\n\r\n\tconst handleImageDragStart = () => {\r\n\t\tinteraction = 'pan';\r\n\t\tinteractionCropRectForce = undefined;\r\n\t\tset_store_value(isInteracting, $isInteracting = true, $isInteracting);\r\n\t\tinteractionCropRect = rectClone$1($imageCropRect);\r\n\t};\r\n\r\n\tconst handleImageDrag = ({ detail }) => {\r\n\t\t// now transforming image\r\n\t\tset_store_value(isTransformingImage, $isTransformingImage = true, $isTransformingImage);\r\n\r\n\t\tmanipulateImage(detail);\r\n\t};\r\n\r\n\tconst handleImageDragEnd = ({ detail }) => {\r\n\t\t// no longer transforming image\r\n\t\tset_store_value(isTransformingImage, $isTransformingImage = false, $isTransformingImage);\r\n\r\n\t\t// done interacting\r\n\t\tset_store_value(isInteracting, $isInteracting = false, $isInteracting);\r\n\r\n\t\t// apply translation to the crop rect only if did make changes\r\n\t\tif (vectorLength(detail.translation) > 0 || detail.scalar !== 0) {\r\n\t\t\tmanipulateImage(detail);\r\n\t\t\thistory.write();\r\n\t\t}\r\n\r\n\t\t// no intent (needs to be set before crop rect is updated)\r\n\t\tset_store_value(imageCropRectIntent, $imageCropRectIntent = undefined, $imageCropRectIntent);\r\n\r\n\t\t// now done\r\n\t\tinteractionCropRect = undefined;\r\n\t};\r\n\r\n\tconst handleImageDragRelease = ({ detail: { translation } }) => {\r\n\t\t// flip translation direction as we are dragging crop selection\r\n\t\tif ($imageIsStatic) translation = vectorInvert(vectorClone(translation));\r\n\r\n\t\tinteractionCropRectForce = translation;\r\n\t\tset_store_value(isInteracting, $isInteracting = false, $isInteracting);\r\n\t};\r\n\r\n\tconst manipulateImage = ({ translation, scalar }) => {\r\n\t\t// flip translation direction as we are dragging crop selection\r\n\t\tif ($imageIsStatic) {\r\n\t\t\tscalar = 1;\r\n\t\t\ttranslation = vectorInvert(vectorClone(translation));\r\n\t\t}\r\n\r\n\t\tconst imageSelectionRectZoomFactor = Math.min($imageSelectionRect.width / $imageCropRect.width, $imageSelectionRect.height / $imageCropRect.height);\r\n\t\tconst scaledTranslation = vectorMultiply(vectorClone(translation), 1 / imageSelectionRectZoomFactor);\r\n\r\n\t\t// while we're interacting we apply changes to the original crop rectangle, after we apply a force\r\n\t\tlet cropIntent;\r\n\r\n\t\tif (!interactionCropRectForce) {\r\n\t\t\tcropIntent = rectTranslate$1(rectClone$1(interactionCropRect), vectorInvert(vectorClone(scaledTranslation)));\r\n\t\t\tif (scalar !== undefined) rectScale$1(cropIntent, 1 / scalar);\r\n\t\t} else {\r\n\t\t\t// we apply the force to the existing crop rect so animation is not borked\r\n\t\t\tconst forceTranslation = vectorSubtract(vectorClone(interactionCropRectForce), translation);\r\n\r\n\t\t\tinteractionCropRectForce = translation;\r\n\t\t\tcropIntent = rectTranslate$1(rectClone$1($imageCropRect), forceTranslation);\r\n\t\t}\r\n\r\n\t\t// update crop rect\r\n\t\tset_store_value(imageCropRectIntent, $imageCropRectIntent = cropIntent, $imageCropRectIntent); // auto calculates an elastic effect if bounds exceeded (needs to be set before crop rect is updated)\r\n\r\n\t\tset_store_value(imageCropRect, $imageCropRect = cropIntent, $imageCropRect); // auto limits to bounds if needed\r\n\t};\r\n\r\n\t// #endregion\r\n\t// #region resize with range input\r\n\tconst IMAGE_ZOOM_LEVEL_MIN = -1;\r\n\r\n\tconst calculateZoomLevel = (imageSize, size, imageRotation) => {\r\n\t\tif (isRotatedSideways(imageRotation)) {\r\n\t\t\treturn 1 - 1 / Math.min(imageSize.height / size.width, imageSize.width / size.height);\r\n\t\t}\r\n\r\n\t\treturn 1 - 1 / Math.min(imageSize.width / size.width, imageSize.height / size.height);\r\n\t};\r\n\r\n\tconst imageCropRangeAspectRatio = derived([imageCropRange, imageCropRect], ([$imageCropRange, $imageCropRect], set) => {\r\n\t\tif (!$imageCropRect) return;\r\n\t\tconst [minSize, maxSize] = $imageCropRange;\r\n\t\tconst aspectRatio = rectAspectRatio($imageCropRect);\r\n\r\n\t\tset([\r\n\t\t\tsizeCreateFromRect(rectApply(rectCoverRect(minSize, aspectRatio), fixPrecision)),\r\n\t\t\tsizeCreateFromRect(rectApply(rectContainRect(maxSize, aspectRatio), fixPrecision))\r\n\t\t]);\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, imageCropRangeAspectRatio, value => $$invalidate(176, $imageCropRangeAspectRatio = value));\r\n\r\n\t// this is the max value range that can be set (triggers white range indicator bar)\r\n\tconst imageZoomLevelRange = derived(\r\n\t\t[\r\n\t\t\timageSize,\r\n\t\t\timageCropLimitToImage,\r\n\t\t\timageCropMinSize,\r\n\t\t\timageCropMaxSize,\r\n\t\t\timageCropRange,\r\n\t\t\timageRotation\r\n\t\t],\r\n\t\t([\r\n\t\t\t\t$imageSize,\r\n\t\t\t\t$imageCropLimitToImage,\r\n\t\t\t\t$imageCropMinSize,\r\n\t\t\t\t$imageCropMaxSize,\r\n\t\t\t\t$imageCropRange,\r\n\t\t\t\t$imageRotation\r\n\t\t\t], set) => {\r\n\t\t\tif (!$imageSize) return;\r\n\t\t\tconst rangeMinSize = $imageCropRange[0];\r\n\t\t\tconst rangeMaxSize = $imageCropRange[1];\r\n\t\t\tlet minZoom;\r\n\t\t\tlet maxZoom;\r\n\r\n\t\t\t// can't zoom out\r\n\t\t\tif ($imageCropLimitToImage) {\r\n\t\t\t\tminZoom = calculateZoomLevel($imageSize, rangeMaxSize, $imageRotation);\r\n\t\t\t\tmaxZoom = Math.min(rangeMinSize.width / $imageCropMinSize.width, rangeMinSize.height / $imageCropMinSize.height);\r\n\t\t\t} else {\r\n\t\t\t\tminZoom = IMAGE_ZOOM_LEVEL_MIN;\r\n\t\t\t\tmaxZoom = 1;\r\n\t\t\t}\r\n\r\n\t\t\tconst range = [minZoom, maxZoom].map(v => fixPrecision(v));\r\n\t\t\tset(range);\r\n\t\t}\r\n\t);\r\n\r\n\tcomponent_subscribe($$self, imageZoomLevelRange, value => $$invalidate(27, $imageZoomLevelRange = value));\r\n\r\n\tconst imageZoomLevel = derived([imageSize, imageCropRect, imageCropRange, imageRotation], ([$imageSize, $imageCropRect, $imageCropRange, $imageRotation], set) => {\r\n\t\t// need to check if this value is set, could be that it's empty while loading a new image\r\n\t\tif (!$imageSize || !$imageCropRect) return set(0);\r\n\r\n\t\tlet z;\r\n\t\tconst rangeMinSize = $imageCropRange[0];\r\n\t\tconst rangeMaxSize = $imageCropRange[1];\r\n\t\tconst currentCropWidth = $imageCropRect.width;\r\n\t\tconst currentCropHeight = $imageCropRect.height;\r\n\t\tconst currentCropAspectRatio = rectAspectRatio($imageCropRect);\r\n\r\n\t\tconst imageRect = isRotatedSideways($imageRotation)\r\n\t\t? sizeCreate($imageSize.height, $imageSize.width)\r\n\t\t: $imageSize;\r\n\r\n\t\tconst imageCropMaxRect = rectContainRect(imageRect, currentCropAspectRatio);\r\n\r\n\t\tif (currentCropWidth <= imageCropMaxRect.width || currentCropHeight <= imageCropMaxRect.height) {\r\n\t\t\t// zoomed in\r\n\t\t\tconst w = imageCropMaxRect.width - rangeMinSize.width;\r\n\r\n\t\t\tconst h = imageCropMaxRect.height - rangeMinSize.height;\r\n\r\n\t\t\t// cannot zoom in\r\n\t\t\tif (w === 0 || h === 0) {\r\n\t\t\t\tz = 1;\r\n\t\t\t} else {\r\n\t\t\t\tz = 1 - Math.min((currentCropWidth - rangeMinSize.width) / w, (currentCropHeight - rangeMinSize.height) / h);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// zoomed out\r\n\t\t\tconst w = rangeMaxSize.width - imageCropMaxRect.width;\r\n\r\n\t\t\tconst h = rangeMaxSize.height - imageCropMaxRect.height;\r\n\t\t\tconst r = rectContainRect({ width: w, height: h }, currentCropAspectRatio);\r\n\t\t\tz = -Math.min((currentCropWidth - imageCropMaxRect.width) / r.width, (currentCropHeight - imageCropMaxRect.height) / r.height);\r\n\t\t}\r\n\r\n\t\tset(z);\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, imageZoomLevel, value => $$invalidate(28, $imageZoomLevel = value));\r\n\r\n\tconst snapshotCropRect = () => {\r\n\t\tinteractionCropRect = rectClone$1($imageCropRect);\r\n\t};\r\n\r\n\tconst resizeImage = zoom => {\r\n\t\tconst aspectRatio = rectAspectRatio(interactionCropRect);\r\n\t\tlet targetWidth;\r\n\t\tlet targetHeight;\r\n\t\tlet r;\r\n\r\n\t\tconst imageRect = isRotatedSideways($imageRotation)\r\n\t\t? sizeCreate($imageSize.height, $imageSize.width)\r\n\t\t: $imageSize;\r\n\r\n\t\tconst imageCropMaxRect = rectContainRect(imageRect, aspectRatio);\r\n\r\n\t\tif (zoom >= 0) {\r\n\t\t\t// zoom in\r\n\t\t\tconst rangeWidth = imageCropMaxRect.width - $imageCropRange[0].width;\r\n\r\n\t\t\tconst rangeHeight = imageCropMaxRect.height - $imageCropRange[0].height;\r\n\t\t\ttargetWidth = imageCropMaxRect.width - rangeWidth * zoom;\r\n\t\t\ttargetHeight = imageCropMaxRect.height - rangeHeight * zoom;\r\n\t\t\tr = rectCoverRect({ width: targetWidth, height: targetHeight }, aspectRatio);\r\n\t\t} else {\r\n\t\t\t// zoom out\r\n\t\t\tconst rangeWidth = $imageCropRange[1].width - imageCropMaxRect.width;\r\n\r\n\t\t\tconst rangeHeight = $imageCropRange[1].height - imageCropMaxRect.height;\r\n\t\t\ttargetWidth = imageCropMaxRect.width + rangeWidth * -zoom;\r\n\t\t\ttargetHeight = imageCropMaxRect.height + rangeHeight * -zoom;\r\n\t\t\tr = rectContainRect({ width: targetWidth, height: targetHeight }, aspectRatio);\r\n\t\t}\r\n\r\n\t\ttargetWidth = r.width;\r\n\t\ttargetHeight = r.height;\r\n\t\tconst targetX = interactionCropRect.x + interactionCropRect.width * 0.5 - targetWidth * 0.5;\r\n\t\tconst targetY = interactionCropRect.y + interactionCropRect.height * 0.5 - targetHeight * 0.5;\r\n\r\n\t\tset_store_value(\r\n\t\t\timageCropRect,\r\n\t\t\t$imageCropRect = {\r\n\t\t\t\tx: targetX,\r\n\t\t\t\ty: targetY,\r\n\t\t\t\twidth: targetWidth,\r\n\t\t\t\theight: targetHeight\r\n\t\t\t},\r\n\t\t\t$imageCropRect\r\n\t\t);\r\n\t};\r\n\r\n\tconst handleResizeStart = () => {\r\n\t\tinteraction = 'zoom';\r\n\r\n\t\t// now interacting with view\r\n\t\tset_store_value(isInteracting, $isInteracting = true, $isInteracting);\r\n\r\n\t\tsnapshotCropRect();\r\n\t};\r\n\r\n\tconst handleResizeMove = value => {\r\n\t\t// now transforming image\r\n\t\tset_store_value(isTransformingImage, $isTransformingImage = false, $isTransformingImage);\r\n\r\n\t\t// value range from 0 (no zoom) to 1 (100% zoom, 1x1 pixel)\r\n\t\tresizeImage(value);\r\n\t};\r\n\r\n\tconst handleResizeEnd = value => {\r\n\t\tresizeImage(value);\r\n\t\thistory.write();\r\n\r\n\t\t// no longer transforming image\r\n\t\tset_store_value(isTransformingImage, $isTransformingImage = false, $isTransformingImage);\r\n\r\n\t\t// we're done interacting\r\n\t\tset_store_value(isInteracting, $isInteracting = false, $isInteracting);\r\n\r\n\t\t// now done\r\n\t\tinteractionCropRect = undefined;\r\n\t};\r\n\r\n\t//#endregion\r\n\t// #region resize with gesture (MacBook trackpad Safari)\r\n\tlet gestureOriginCropRect;\r\n\r\n\tconst handleGestureStart = () => {\r\n\t\tinteraction = 'zoom';\r\n\r\n\t\t// don't handle gesture as we're already handling input with interactable\r\n\t\tif (interactionCropRect) return;\r\n\r\n\t\tgestureOriginCropRect = rectClone$1($imageCropRect);\r\n\r\n\t\t// now interacting\r\n\t\tset_store_value(isInteracting, $isInteracting = true, $isInteracting);\r\n\t};\r\n\r\n\tconst handleGestureUpdate = ({ detail }) => {\r\n\t\t// don't handle gesture as we're already handling input with interactable\r\n\t\tif (!gestureOriginCropRect) return;\r\n\r\n\t\t// now transforming image\r\n\t\tset_store_value(isTransformingImage, $isTransformingImage = true, $isTransformingImage);\r\n\r\n\t\thandleScaleGesture(detail);\r\n\t};\r\n\r\n\tconst handleScaleGesture = scale => {\r\n\t\tconst cropIntent = rectScale$1(rectClone$1(gestureOriginCropRect), 1 / scale);\r\n\t\tset_store_value(imageCropRectIntent, $imageCropRectIntent = cropIntent, $imageCropRectIntent);\r\n\t\tset_store_value(imageCropRect, $imageCropRect = cropIntent, $imageCropRect);\r\n\t};\r\n\r\n\tconst handleGestureEnd = ({ detail }) => {\r\n\t\t// don't handle gesture as we're already handling input with interactable\r\n\t\tif (!gestureOriginCropRect) return;\r\n\r\n\t\t// no longer transforming image\r\n\t\tset_store_value(isTransformingImage, $isTransformingImage = false, $isTransformingImage);\r\n\r\n\t\t// no longer interacting\r\n\t\tset_store_value(isInteracting, $isInteracting = false, $isInteracting);\r\n\r\n\t\thandleScaleGesture(detail);\r\n\r\n\t\t// no intent (needs to be set before crop rect is updated)\r\n\t\tset_store_value(imageCropRectIntent, $imageCropRectIntent = undefined, $imageCropRectIntent);\r\n\r\n\t\tgestureOriginCropRect = undefined;\r\n\t\thistory.write();\r\n\t};\r\n\r\n\t// #endregion\r\n\t// #region resizing with wheel\r\n\tlet zoomHistoryTimeoutId;\r\n\r\n\tconst handleWheel = e => {\r\n\t\tconst stageWheelPosition = getEventPositionInStage(e, $rootRect, $stageRect);\r\n\r\n\t\t// only block input if wheel is used within image rectangle\r\n\t\tif (cropEnableLimitWheelInputToCropSelection && !rectContainsPoint($imageSelectionRect, stageWheelPosition)) return;\r\n\r\n\t\tinteraction = 'zoom';\r\n\r\n\t\t// now interacting\r\n\t\tset_store_value(isInteracting, $isInteracting = true, $isInteracting);\r\n\r\n\t\t// transforming image\r\n\t\tset_store_value(isTransformingImage, $isTransformingImage = true, $isTransformingImage);\r\n\r\n\t\t// don't run default actions, prevent other actions from running\r\n\t\te.preventDefault();\r\n\r\n\t\te.stopPropagation();\r\n\r\n\t\t// convert wheel delta to scalar\r\n\t\tconst delta = getWheelDelta(e);\r\n\r\n\t\tconst scalar = 1 + delta / 100;\r\n\r\n\t\t// get current crop rect\r\n\t\tconst currentCropRect = rectClone$1($imageCropRect);\r\n\r\n\t\t// if already zoomed in, block further zoom in instructions\r\n\t\tconst isMinSize = Math.min($imageCropRect.width / $imageCropMinSize.width, $imageCropRect.height / $imageCropMinSize.height) === 1;\r\n\r\n\t\t// if is fully zoomed out and trying to zoom out more and crop shape is free, fit image aspect ratio\r\n\t\tif (cropEnableZoomMatchImageAspectRatio && $imageCropLimitToImage) {\r\n\t\t\tconst isAtMaxCropSize = isCropMaxSize($imageCropRect, $imageSize, $imageRotation);\r\n\r\n\t\t\tif (isCustomCrop() && isAtMaxCropSize && delta > 0 && isImageSelectionCentered) {\r\n\t\t\t\tset_store_value(isInteracting, $isInteracting = false, $isInteracting);\r\n\r\n\t\t\t\t// no longer transforming image\r\n\t\t\t\tset_store_value(isTransformingImage, $isTransformingImage = false, $isTransformingImage);\r\n\r\n\t\t\t\tconst newCropRect = isRotatedSideways($imageRotation)\r\n\t\t\t\t? rectCreateFromSize({\r\n\t\t\t\t\t\theight: $imageSize.width,\r\n\t\t\t\t\t\twidth: $imageSize.height\r\n\t\t\t\t\t})\r\n\t\t\t\t: rectCreateFromSize($imageSize);\r\n\r\n\t\t\t\t// no change, exit\r\n\t\t\t\tif (rectEqual(currentCropRect, newCropRect)) return;\r\n\r\n\t\t\t\t// if we were previously zooming in we need to clear the timeout to prevent two history entries\r\n\t\t\t\tclearTimeout(zoomHistoryTimeoutId);\r\n\r\n\t\t\t\t// test if crop rect in history is same as new crop rect, this is possible when zooming in and out real quick\r\n\t\t\t\tif (rectEqual(history.state.crop, newCropRect)) return;\r\n\r\n\t\t\t\t// store new crop rect\r\n\t\t\t\tset_store_value(imageCropRect, $imageCropRect = newCropRect, $imageCropRect);\r\n\r\n\t\t\t\thistory.write();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// by default when zooming, zoom from center of crop rectangle\r\n\t\tlet origin = rectCenter($imageCropRect);\r\n\r\n\t\t// when zooming in, zoom in on the part of the image below the mouse cursor\r\n\t\tconst shouldZoomTowardsWheelPosition = cropEnableZoomTowardsWheelPosition && cropInteractionFocus !== 'selection';\r\n\r\n\t\tif (shouldZoomTowardsWheelPosition && delta < 0 && !isMinSize) {\r\n\t\t\tconst selectionOffset = vectorSubtract(vectorClone(stageWheelPosition), $imageSelectionRect);\r\n\t\t\tconst imageSelectionScale = Math.min($imageSelectionRect.width / $imageCropRect.width, $imageSelectionRect.height / $imageCropRect.height);\r\n\r\n\t\t\t// if wheel is inside image selection rectangle (slightly expanded version), we zoom based on position in the rectangle, if not, we use the selection center\r\n\t\t\tconst expandedImageSelection = rectScale$1(rectClone$1($imageSelectionRect), 1.1);\r\n\r\n\t\t\torigin = rectContainsPoint(expandedImageSelection, stageWheelPosition)\r\n\t\t\t? vectorAdd(rectClone$1($imageCropRect), vectorMultiply(selectionOffset, 1 / imageSelectionScale))\r\n\t\t\t: origin;\r\n\t\t}\r\n\r\n\t\tlet newCropRect = rectScale$1(rectClone$1($imageCropRect), scalar, origin);\r\n\r\n\t\t// determin if is new crop rect exceeds min or max size, if so, limit\r\n\t\tif (!sizeContains($imageCropRangeAspectRatio[1], newCropRect)) {\r\n\t\t\t// exceeds max size, limit to max size and position at new crop rect center\r\n\t\t\tnewCropRect = rectCreateWithCenter(rectCenter(newCropRect), $imageCropRangeAspectRatio[1]);\r\n\t\t}\r\n\r\n\t\tif (!sizeContains(newCropRect, $imageCropRangeAspectRatio[0])) {\r\n\t\t\t// exceeds min size, limit to min size and position at new crop rect center\r\n\t\t\tnewCropRect = rectCreateWithCenter(rectCenter(newCropRect), $imageCropRangeAspectRatio[0]);\r\n\t\t}\r\n\r\n\t\t// no change, exit\r\n\t\tif (rectEqual(currentCropRect, newCropRect, fixPrecision)) {\r\n\t\t\tset_store_value(isInteracting, $isInteracting = false, $isInteracting);\r\n\r\n\t\t\t// no longer transforming image\r\n\t\t\tset_store_value(isTransformingImage, $isTransformingImage = false, $isTransformingImage);\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// attempt to update the rectangle, we use fixPrecision so the width and height are nice integers when at max zoom (this makes sure the `isMinSize` variable is set to true at this point)\r\n\t\tset_store_value(imageCropRect, $imageCropRect = rectApply(newCropRect, v => fixPrecision(v, 5)), $imageCropRect);\r\n\r\n\t\t// done!\r\n\t\tset_store_value(isInteracting, $isInteracting = false, $isInteracting);\r\n\r\n\t\t// no longer transforming image\r\n\t\tset_store_value(isTransformingImage, $isTransformingImage = false, $isTransformingImage);\r\n\r\n\t\t// write history timer\r\n\t\tclearTimeout(zoomHistoryTimeoutId);\r\n\r\n\t\tzoomHistoryTimeoutId = setTimeout(\r\n\t\t\t() => {\r\n\t\t\t\thistory.write();\r\n\t\t\t},\r\n\t\t\t500\r\n\t\t);\r\n\t};\r\n\r\n\t// #endregion\r\n\t// #region recenter\r\n\t// the 'measure' event triggers the editor to center and scale up the crop\r\n\tcreateEventDispatcher();\r\n\r\n\tconst handleRecenterAction = () => {\r\n\t\t// force recenter\r\n\t\tstageRecenter.set({});\r\n\t};\r\n\r\n\t// auto recenter after timeout\r\n\tlet cropAutoCenterImageSelectionTimeoutId;\r\n\r\n\t// animations\r\n\tconst recenterOpacity = spring(0, { precision: 0.0001 });\r\n\r\n\tcomponent_subscribe($$self, recenterOpacity, value => $$invalidate(29, $recenterOpacity = value));\r\n\tconst recenterOffset = spring();\r\n\tcomponent_subscribe($$self, recenterOffset, value => $$invalidate(30, $recenterOffset = value));\r\n\r\n\t//\r\n\t// enable seeing the image outside of the crop area, and disable the vignette effect\r\n\t//\r\n\tconst setPreviewModifiers = () => {\r\n\t\tset_store_value(\r\n\t\t\timagePreviewModifiers,\r\n\t\t\t$imagePreviewModifiers['crop'] = {\r\n\t\t\t\tmaskOpacity: 0.85,\r\n\t\t\t\tmaskMarkupOpacity: 0.85\r\n\t\t\t},\r\n\t\t\t$imagePreviewModifiers\r\n\t\t);\r\n\r\n\t\t// trigger store update\r\n\t\timagePreviewModifiers.set($imagePreviewModifiers);\r\n\t};\r\n\r\n\tconst clearPreviewModifiers = () => {\r\n\t\tdelete $imagePreviewModifiers['crop'];\r\n\r\n\t\t// trigger store update\r\n\t\timagePreviewModifiers.set($imagePreviewModifiers);\r\n\t};\r\n\r\n\t// #region crop selection presets\r\n\tconst selectedPresetIndex = derived([imageCropAspectRatio, imageOutputSize, formattedCropPresetOptions], ([$cropAspectRatio, $imageOutputSize, $formattedCropPresetOptions], set) => {\r\n\t\tif (!hasCropSelectPresetOptions) return;\r\n\t\tconst options = flattenOptions($formattedCropPresetOptions);\r\n\r\n\t\tconst matchedOptionValue = [...options].// to value\r\n\t\tmap(option => option[0]).// sort sizes first\r\n\t\tsort((a, b) => {\r\n\t\t\tif (isArray(a[0]) && !isArray(b[0])) return 1;\r\n\t\t\treturn -1;\r\n\t\t}).// match value\r\n\t\tfind(value => {\r\n\t\t\tif (isArray(value) && $imageOutputSize) {\r\n\t\t\t\t// size + aspect ratio\r\n\t\t\t\tconst [width, height] = value;\r\n\r\n\t\t\t\tconst outputSizeMatches = $imageOutputSize.width === width && $imageOutputSize.height === height;\r\n\t\t\t\tconst aspectRatioMatches = $cropAspectRatio === getAspectRatio(width, height);\r\n\t\t\t\treturn outputSizeMatches && aspectRatioMatches;\r\n\t\t\t}\r\n\r\n\t\t\t// aspect ratio\r\n\t\t\treturn value === $cropAspectRatio;\r\n\t\t});\r\n\r\n\t\t// no options found, exit\r\n\t\tif (!matchedOptionValue) return set(undefined);\r\n\r\n\t\tconst index = options.// to value\r\n\t\tmap(option => option[0]).// find index of matching value\r\n\t\tfindIndex(value => isArray(value)\r\n\t\t? arrayEqual(value, matchedOptionValue)\r\n\t\t: value === matchedOptionValue);\r\n\r\n\t\tset(index);\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, selectedPresetIndex, value => $$invalidate(154, $selectedPresetIndex = value));\r\n\r\n\tconst getAspectRatioBySelectedIndex = (selectedIndex, options) => {\r\n\t\tif (!hasCropSelectPresetOptions || selectedIndex === -1 || selectedIndex === undefined) return;\r\n\t\tconst selectedValue = flattenOptions(options)[selectedIndex][0];\r\n\r\n\t\treturn !selectedValue\r\n\t\t? undefined\r\n\t\t: isArray(selectedValue)\r\n\t\t\t? getAspectRatio(selectedValue[0], selectedValue[1])\r\n\t\t\t: selectedValue;\r\n\t};\r\n\r\n\t// #endregion\r\n\t// #region crop guides\r\n\tconst imageSelectionGuides = derived([rootLineColor, imageSelectionRectPresentation, isInteractingFraction], ([$rootLineColor, $rect, $isInteractingFraction], set) => {\r\n\t\tconst { rows, cols, opacity } = cropWillRenderImageSelectionGuides(interaction, $isInteractingFraction);\r\n\t\tif (!$rect || opacity <= 0) return set([]);\r\n\t\tconst { x, y, width, height } = $rect;\r\n\t\tconst w = width / cols;\r\n\t\tconst h = height / rows;\r\n\t\tconst shapes = [];\r\n\r\n\t\t// rows\r\n\t\tfor (let r = 1; r <= rows - 1; r++) {\r\n\t\t\tconst yo = y + h * r;\r\n\r\n\t\t\tshapes.push({\r\n\t\t\t\tid: `image-selection-guide-row-${r}`,\r\n\t\t\t\tpoints: [vectorCreate(x, yo), vectorCreate(x + width, yo)],\r\n\t\t\t\topacity,\r\n\t\t\t\tstrokeWidth: 1,\r\n\t\t\t\tstrokeColor: $rootLineColor\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// cols\r\n\t\tfor (let c = 1; c <= cols - 1; c++) {\r\n\t\t\tconst xo = x + w * c;\r\n\r\n\t\t\tshapes.push({\r\n\t\t\t\tid: `image-selection-guide-col-${c}`,\r\n\t\t\t\tpoints: [vectorCreate(xo, y), vectorCreate(xo, y + height)],\r\n\t\t\t\topacity,\r\n\t\t\t\tstrokeWidth: 1,\r\n\t\t\t\tstrokeColor: $rootLineColor\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tset(shapes);\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, imageSelectionGuides, value => $$invalidate(140, $imageSelectionGuides = value));\r\n\r\n\tconst syncGuides = () => {\r\n\t\t// remove existing guides\r\n\t\tconst overlayMarkup = $imageOverlayMarkup.filter(markup => !(/^image\\-selection\\-guide/).test(markup.id));\r\n\r\n\t\tif ($isActive) {\r\n\t\t\tset_store_value(imageOverlayMarkup, $imageOverlayMarkup = [...overlayMarkup, ...$imageSelectionGuides], $imageOverlayMarkup);\r\n\t\t} else {\r\n\t\t\tset_store_value(imageOverlayMarkup, $imageOverlayMarkup = overlayMarkup, $imageOverlayMarkup);\r\n\t\t}\r\n\t};\r\n\r\n\tconst cropUniqueId = `crop-${getUniqueId()}`;\r\n\r\n\t// let transformInitial = cropEnableRotationInput\r\n\t// ? cropActiveTransformTool\r\n\t// : 'zoom';\r\n    let transformInitial = 'zoom';\r\n\r\n\tlet transformToolInitial = cropUniqueId + '-' + transformInitial;\r\n\tlet transformSelected = transformToolInitial;\r\n\tlet root = undefined;\r\n\r\n\t// fixes rendering issue with stage being empty in overlay mode, this basically redispatches the measure event so the stage is correctly measured\r\n\tlet stageRef;\r\n\r\n\tconst footerOffset = spring($isAnimated ? 20 : 0);\r\n\tcomponent_subscribe($$self, footerOffset, value => $$invalidate(137, $footerOffset = value));\r\n\r\n\tfunction measure_handler_1(event) {\r\n\t\tbubble.call(this, $$self, event);\r\n\t}\r\n\r\n\tconst select_handler = ({ detail }) => $$invalidate(5, transformSelected = detail);\r\n\r\n\tfunction div0_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\tstageRef = $$value;\r\n\t\t\t$$invalidate(6, stageRef);\r\n\t\t});\r\n\t}\r\n\r\n\tconst interactable_function_1 = e => getEventPositionInViewport(e);\r\n\r\n\tfunction util_root_binding(value) {\r\n\t\troot = value;\r\n\t\t$$invalidate(15, root);\r\n\t}\r\n\r\n\tfunction measure_handler(event) {\r\n\t\tbubble.call(this, $$self, event);\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('isActive' in $$props) $$subscribe_isActive($$invalidate(0, isActive = $$props.isActive));\r\n\t\tif ('stores' in $$props) $$invalidate(97, stores = $$props.stores);\r\n\t\tif ('cropImageSelectionCornerStyle' in $$props) $$invalidate(1, cropImageSelectionCornerStyle = $$props.cropImageSelectionCornerStyle);\r\n\t\tif ('cropWillRenderImageSelectionGuides' in $$props) $$invalidate(98, cropWillRenderImageSelectionGuides = $$props.cropWillRenderImageSelectionGuides);\r\n\t\tif ('cropAutoCenterImageSelectionTimeout' in $$props) $$invalidate(99, cropAutoCenterImageSelectionTimeout = $$props.cropAutoCenterImageSelectionTimeout);\r\n\t\tif ('cropEnableZoomMatchImageAspectRatio' in $$props) $$invalidate(100, cropEnableZoomMatchImageAspectRatio = $$props.cropEnableZoomMatchImageAspectRatio);\r\n\t\tif ('cropEnableRotateMatchImageAspectRatio' in $$props) $$invalidate(101, cropEnableRotateMatchImageAspectRatio = $$props.cropEnableRotateMatchImageAspectRatio);\r\n\t\tif ('cropEnableRotationInput' in $$props) $$invalidate(102, cropEnableRotationInput = $$props.cropEnableRotationInput);\r\n\t\tif ('cropEnableZoom' in $$props) $$invalidate(2, cropEnableZoom = $$props.cropEnableZoom);\r\n\t\tif ('cropEnableZoomInput' in $$props) $$invalidate(103, cropEnableZoomInput = $$props.cropEnableZoomInput);\r\n\t\tif ('cropEnableZoomAutoHide' in $$props) $$invalidate(104, cropEnableZoomAutoHide = $$props.cropEnableZoomAutoHide);\r\n\t\tif ('cropEnableImageSelection' in $$props) $$invalidate(105, cropEnableImageSelection = $$props.cropEnableImageSelection);\r\n\t\tif ('cropEnableInfoIndicator' in $$props) $$invalidate(106, cropEnableInfoIndicator = $$props.cropEnableInfoIndicator);\r\n\t\tif ('cropEnableZoomTowardsWheelPosition' in $$props) $$invalidate(107, cropEnableZoomTowardsWheelPosition = $$props.cropEnableZoomTowardsWheelPosition);\r\n\t\tif ('cropEnableLimitWheelInputToCropSelection' in $$props) $$invalidate(108, cropEnableLimitWheelInputToCropSelection = $$props.cropEnableLimitWheelInputToCropSelection);\r\n\t\tif ('cropEnableCenterImageSelection' in $$props) $$invalidate(109, cropEnableCenterImageSelection = $$props.cropEnableCenterImageSelection);\r\n\t\tif ('cropEnableButtonRotateLeft' in $$props) $$invalidate(110, cropEnableButtonRotateLeft = $$props.cropEnableButtonRotateLeft);\r\n\t\tif ('cropEnableButtonRotateRight' in $$props) $$invalidate(111, cropEnableButtonRotateRight = $$props.cropEnableButtonRotateRight);\r\n\t\tif ('cropEnableButtonFlipHorizontal' in $$props) $$invalidate(112, cropEnableButtonFlipHorizontal = $$props.cropEnableButtonFlipHorizontal);\r\n\t\tif ('cropEnableButtonFlipVertical' in $$props) $$invalidate(113, cropEnableButtonFlipVertical = $$props.cropEnableButtonFlipVertical);\r\n\t\tif ('cropSelectPresetOptions' in $$props) $$invalidate(114, cropSelectPresetOptions = $$props.cropSelectPresetOptions);\r\n\t\tif ('cropEnableSelectPreset' in $$props) $$invalidate(115, cropEnableSelectPreset = $$props.cropEnableSelectPreset);\r\n\t\tif ('cropEnableFilterMatchAspectRatio' in $$props) $$invalidate(116, cropEnableFilterMatchAspectRatio = $$props.cropEnableFilterMatchAspectRatio);\r\n\t\tif ('cropSelectPresetFilter' in $$props) $$invalidate(95, cropSelectPresetFilter = $$props.cropSelectPresetFilter);\r\n\t\tif ('cropEnableButtonToggleCropLimit' in $$props) $$invalidate(117, cropEnableButtonToggleCropLimit = $$props.cropEnableButtonToggleCropLimit);\r\n\t\tif ('cropWillRenderTools' in $$props) $$invalidate(118, cropWillRenderTools = $$props.cropWillRenderTools);\r\n\t\tif ('cropActiveTransformTool' in $$props) $$invalidate(119, cropActiveTransformTool = $$props.cropActiveTransformTool);\r\n\t\tif ('cropMinimizeToolbar' in $$props) $$invalidate(120, cropMinimizeToolbar = $$props.cropMinimizeToolbar);\r\n\t\tif ('cropInteractionFocus' in $$props) $$invalidate(121, cropInteractionFocus = $$props.cropInteractionFocus);\r\n\t\tif ('cropRotationRange' in $$props) $$invalidate(3, cropRotationRange = $$props.cropRotationRange);\r\n\t\tif ('locale' in $$props) $$invalidate(4, locale = $$props.locale);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 4096 | $$self.$$.dirty[3] & /*cropInteractionFocus*/ 268435456) {\r\n\t\t\timageIsStatic.set(cropInteractionFocus === 'selection' && $isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*cropSelectPresetOptions*/ 2097152) {\r\n\t\t\t$$invalidate(128, hasCropSelectPresetOptions = cropSelectPresetOptions && Array.isArray(cropSelectPresetOptions) && cropSelectPresetOptions.length);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*cropSelectPresetOptions*/ 2097152 | $$self.$$.dirty[4] & /*hasCropSelectPresetOptions*/ 16) {\r\n\t\t\tformattedCropPresetOptions.set(hasCropSelectPresetOptions\r\n\t\t\t? cropSelectPresetOptions\r\n\t\t\t: []);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 4096) {\r\n\t\t\t$isActive && imageOutlineOpacity.set(1);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 4096) {\r\n\t\t\t// fully disable pan and zoom when crop tool is active\r\n\t\t\tallowPan.set(!$isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 4096) {\r\n\t\t\tallowZoom.set(!$isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*$env*/ 32768) {\r\n\t\t\t$$invalidate(123, isOverlayMode = $env.layoutMode === 'overlay');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*cropEnableSelectPreset, isOverlayMode*/ 1077936128) {\r\n\t\t\t$$invalidate(127, shouldRenderPresetSelect = cropEnableSelectPreset && !isOverlayMode);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*$utilRectPadded, $imageSelectionRect*/ 41943040) {\r\n\t\t\t// determine if we can center the crop, if we can, show the crop center button\r\n\t\t\t$$invalidate(136, imageSelectionCenteredRect = $utilRectPadded && $imageSelectionRect && rectCenterRect($utilRectPadded, $imageSelectionRect));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*$imageSelectionRect, imageSelectionCenteredRect*/ 33558528) {\r\n\t\t\t$$invalidate(134, isImageSelectionDisplayed = !!($imageSelectionRect && imageSelectionCenteredRect));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*isImageSelectionDisplayed, $imageSelectionRect, imageSelectionCenteredRect*/ 33559552) {\r\n\t\t\t$$invalidate(132, isImageSelectionCentered = isImageSelectionDisplayed && rectEqual($imageSelectionRect, imageSelectionCenteredRect, value => fixPrecision(value, 5)));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*locale, $imageRotation*/ 16400 | $$self.$$.dirty[3] & /*cropWillRenderTools, cropEnableButtonRotateLeft, cropEnableButtonRotateRight, cropEnableButtonFlipHorizontal, cropEnableButtonFlipVertical, cropSelectPresetFilter, cropEnableButtonToggleCropLimit*/ 52297732 | $$self.$$.dirty[4] & /*shouldRenderPresetSelect, hasCropSelectPresetOptions, $selectedPresetIndex, isImageSelectionCentered, $imageSize, $imageCropMinSize, $imageCropLimitToImage, $env*/ 2013298968 | $$self.$$.dirty[5] & /*$redrawTrigger, $imageFlipY, $imageFlipX, $formattedCropPresetOptions*/ 15) {\r\n\t\t\t// #region dynamic toolbar\r\n\t\t\t$$invalidate(11, cropTools = $redrawTrigger && cropWillRenderTools(\r\n\t\t\t\t[\r\n\t\t\t\t\tshouldRenderPresetSelect && hasCropSelectPresetOptions && [\r\n\t\t\t\t\t\tcropSelectPresetFilter === false\r\n\t\t\t\t\t\t? 'Dropdown'\r\n\t\t\t\t\t\t: CropPresetList,\r\n\t\t\t\t\t\t'select-preset',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ticon: localize(locale.cropIconSelectPreset, locale, getAspectRatioBySelectedIndex($selectedPresetIndex, $formattedCropPresetOptions)),\r\n\t\t\t\t\t\t\tlabel: localize(locale.cropLabelSelectPreset, locale, getAspectRatioBySelectedIndex($selectedPresetIndex, $formattedCropPresetOptions)),\r\n\t\t\t\t\t\t\tlabelClass: 'PinturaToolbarContentWide',\r\n\t\t\t\t\t\t\toptions: $formattedCropPresetOptions,\r\n\t\t\t\t\t\t\tfilter: cropSelectPresetFilter,\r\n\t\t\t\t\t\t\tonfilterchange: applyCropPresetFilter,\r\n\t\t\t\t\t\t\tselectedIndex: $selectedPresetIndex,\r\n\t\t\t\t\t\t\tonchange: ({ value }) => {\r\n\t\t\t\t\t\t\t\tif (isArray(value)) {\r\n\t\t\t\t\t\t\t\t\tset_store_value(imageCropAspectRatio, $imageCropAspectRatio = getAspectRatio(value[0], value[1]), $imageCropAspectRatio);\r\n\t\t\t\t\t\t\t\t\tset_store_value(imageOutputSize, $imageOutputSize = sizeCreateFromArray(value), $imageOutputSize);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tset_store_value(imageCropAspectRatio, $imageCropAspectRatio = value, $imageCropAspectRatio);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (isImageSelectionCentered) {\r\n\t\t\t\t\t\t\t\t\thandleRecenterAction();\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\thistory.write();\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\toptionMapper: option => {\r\n\t\t\t\t\t\t\t\t// if no aspect ratio found we enable the option by default\r\n\t\t\t\t\t\t\t\tlet disabled = false;\r\n\r\n\t\t\t\t\t\t\t\t// get aspect ratio for this option\r\n\t\t\t\t\t\t\t\tconst optionAspectRatio = isArray(option.value)\r\n\t\t\t\t\t\t\t\t? option.value[0] / option.value[1]\r\n\t\t\t\t\t\t\t\t: option.value;\r\n\r\n\t\t\t\t\t\t\t\t// can be undefined in which case we don't need to check anything\r\n\t\t\t\t\t\t\t\tif (optionAspectRatio) {\r\n\t\t\t\t\t\t\t\t\tconst maxCropSize = getMaxSizeInRect($imageSize, $imageRotation, optionAspectRatio);\r\n\t\t\t\t\t\t\t\t\tdisabled = maxCropSize.width < $imageCropMinSize.width || maxCropSize.height < $imageCropMinSize.height;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// add icon for this option\r\n\t\t\t\t\t\t\t\toption.icon = getSelectionPresetOptionIcon(option.value, { bounds: 14 });\r\n\r\n\t\t\t\t\t\t\t\treturn { ...option, disabled };\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\tcropEnableButtonToggleCropLimit && [\r\n\t\t\t\t\t\t'Dropdown',\r\n\t\t\t\t\t\t'select-crop-limit',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ticon: localize(locale.cropIconCropBoundary, locale, $imageCropLimitToImage),\r\n\t\t\t\t\t\t\tlabel: locale.cropLabelCropBoundary,\r\n\t\t\t\t\t\t\tlabelClass: 'PinturaToolbarContentWide',\r\n\t\t\t\t\t\t\tonchange: ({ value }) => {\r\n\t\t\t\t\t\t\t\tset_store_value(imageCropLimitToImage, $imageCropLimitToImage = value, $imageCropLimitToImage);\r\n\t\t\t\t\t\t\t\thistory.write();\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\toptions: [\r\n\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\ttrue,\r\n\t\t\t\t\t\t\t\t\tlocale.cropLabelCropBoundaryEdge,\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ticon: localize(locale.cropIconCropBoundary, locale, true)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\tfalse,\r\n\t\t\t\t\t\t\t\t\tlocale.cropLabelCropBoundaryNone,\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ticon: localize(locale.cropIconCropBoundary, locale, false)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n                    cropEnableButtonRotateLeft && [\r\n\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t'rotate-left',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlabel: locale.cropLabelButtonRotateLeft,\r\n\t\t\t\t\t\t\tlabelClass: 'PinturaToolbarContentWide',\r\n\t\t\t\t\t\t\ticon: locale.cropIconButtonRotateLeft,\r\n\t\t\t\t\t\t\tonclick: () => {\r\n\t\t\t\t\t\t\t\tapplyRotation(-Math.PI / 2);\r\n\t\t\t\t\t\t\t\thistory.write();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\tcropEnableButtonRotateRight && [\r\n\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t'rotate-right',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlabel: locale.cropLabelButtonRotateRight,\r\n\t\t\t\t\t\t\tlabelClass: 'PinturaToolbarContentWide',\r\n\t\t\t\t\t\t\ticon: locale.cropIconButtonRotateRight,\r\n\t\t\t\t\t\t\tonclick: () => {\r\n\t\t\t\t\t\t\t\tapplyRotation(Math.PI / 2);\r\n\t\t\t\t\t\t\t\thistory.write();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\tcropEnableButtonFlipHorizontal && [\r\n\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t'flip-horizontal',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlabel: locale.cropLabelButtonFlipHorizontal,\r\n\t\t\t\t\t\t\tlabelClass: 'PinturaToolbarContentWide',\r\n\t\t\t\t\t\t\ticon: locale.cropIconButtonFlipHorizontal,\r\n\t\t\t\t\t\t\tonclick: () => {\r\n\t\t\t\t\t\t\t\tif (isRotatedSideways($imageRotation)) {\r\n\t\t\t\t\t\t\t\t\tset_store_value(imageFlipY, $imageFlipY = !$imageFlipY, $imageFlipY);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tset_store_value(imageFlipX, $imageFlipX = !$imageFlipX, $imageFlipX);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\thistory.write();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\tcropEnableButtonFlipVertical && [\r\n\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t'flip-vertical',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlabel: locale.cropLabelButtonFlipVertical,\r\n\t\t\t\t\t\t\tlabelClass: 'PinturaToolbarContentWide',\r\n\t\t\t\t\t\t\ticon: locale.cropIconButtonFlipVertical,\r\n\t\t\t\t\t\t\tonclick: () => {\r\n\t\t\t\t\t\t\t\tif (isRotatedSideways($imageRotation)) {\r\n\t\t\t\t\t\t\t\t\tset_store_value(imageFlipX, $imageFlipX = !$imageFlipX, $imageFlipX);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tset_store_value(imageFlipY, $imageFlipY = !$imageFlipY, $imageFlipY);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\thistory.write();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t].filter(Boolean),\r\n\t\t\t\t$env,\r\n\t\t\t\t() => redrawTrigger.set({})\r\n\t\t\t).filter(Boolean));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive, cropTools*/ 6144 | $$self.$$.dirty[3] & /*cropMinimizeToolbar, isOverlayMode*/ 1207959552 | $$self.$$.dirty[4] & /*$env*/ 32768) {\r\n\t\t\tset_store_value(\r\n\t\t\t\tutilTools,\r\n\t\t\t\t$utilTools = $isActive && // should always minimize OR no room OR is overlay mode\r\n\t\t\t\tcropMinimizeToolbar !== 'never' && (cropMinimizeToolbar === 'always' || $env.verticalSpace === 'short' || isOverlayMode)\r\n\t\t\t\t? cropTools.map(([name, id, props]) => {\r\n\t\t\t\t\t\t// is node children\r\n\t\t\t\t\t\tif (Array.isArray(props)) return [name, id, props];\r\n\r\n\t\t\t\t\t\t// is props\r\n\t\t\t\t\t\treturn [name, id, { ...props, hideLabel: true }];\r\n\t\t\t\t\t})\r\n\t\t\t\t: [],\r\n\t\t\t\t$utilTools\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*$imageCropLimitToImage*/ 268435456) {\r\n\t\t\t$$invalidate(23, imageZoomLevelMin = $imageCropLimitToImage ? 0 : IMAGE_ZOOM_LEVEL_MIN);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*$utilRectPadded, $stageRect*/ 75497472) {\r\n\t\t\t// #endregion\r\n\t\t\t$$invalidate(129, imageSelectionOffset = $utilRectPadded && vectorCreate(-($stageRect.x - $utilRectPadded.x), -($stageRect.y - $utilRectPadded.y)));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*$imageSelectionRectPresentation, imageSelectionOffset*/ 262176) {\r\n\t\t\t// normalized crop bounds, we use these to limit the crop interactions to the view\r\n\t\t\t$$invalidate(130, imageSelectionCenter = $imageSelectionRectPresentation && vectorCreate(snapToPixel($imageSelectionRectPresentation.x + $imageSelectionRectPresentation.width * 0.5 + imageSelectionOffset.x), snapToPixel($imageSelectionRectPresentation.y + $imageSelectionRectPresentation.height * 0.5 + imageSelectionOffset.y)));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*$imageSelectionRectSnapshot*/ 16777216) {\r\n\t\t\t$$invalidate(133, isResizingSelection = $imageSelectionRectSnapshot != null);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*$utilRectPadded, imageSelectionCenteredRect*/ 8392704) {\r\n\t\t\t$$invalidate(135, isMaxSelectionRect = $utilRectPadded && imageSelectionCenteredRect && (imageSelectionCenteredRect.height === $utilRectPadded.height || imageSelectionCenteredRect.width === $utilRectPadded.width));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*isMaxSelectionRect, $presentationScalar, $imageScalar*/ 6293504) {\r\n\t\t\t$$invalidate(131, canZoomToCenter = !isMaxSelectionRect && $presentationScalar < 1 && $imageScalar < 1);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*isImageSelectionDisplayed, isResizingSelection, isImageSelectionCentered, canZoomToCenter*/ 1920) {\r\n\t\t\t$$invalidate(9, canCenter = isImageSelectionDisplayed && !isResizingSelection && (!isImageSelectionCentered || canZoomToCenter));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$imageCropRect*/ 8192 | $$self.$$.dirty[3] & /*cropEnableInfoIndicator, isOverlayMode*/ 1073750016) {\r\n\t\t\t$$invalidate(22, shouldRenderInfoIndicator = cropEnableInfoIndicator && !!$imageCropRect && !isOverlayMode);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*$imageSelectionRectPresentation, imageSelectionOffset*/ 262176) {\r\n\t\t\t$$invalidate(8, imageSelectionRectOffset = $imageSelectionRectPresentation && imageSelectionOffset && {\r\n\t\t\t\tx: $imageSelectionRectPresentation.x + imageSelectionOffset.x,\r\n\t\t\t\ty: $imageSelectionRectPresentation.y + imageSelectionOffset.y,\r\n\t\t\t\twidth: $imageSelectionRectPresentation.width,\r\n\t\t\t\theight: $imageSelectionRectPresentation.height\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*imageSelectionRectOffset*/ 256 | $$self.$$.dirty[3] & /*cropEnableImageSelection, isOverlayMode*/ 1073745920) {\r\n\t\t\t$$invalidate(21, shouldRenderImageSelection = cropEnableImageSelection && !!imageSelectionRectOffset && !isOverlayMode);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*cropEnableCenterImageSelection, cropAutoCenterImageSelectionTimeout*/ 65600 | $$self.$$.dirty[4] & /*imageSelectionCenter, $imageIsStatic*/ 1048640) {\r\n\t\t\t$$invalidate(10, shouldRenderImageSelectionRecenterButton = cropEnableCenterImageSelection && !!imageSelectionCenter && !cropAutoCenterImageSelectionTimeout && !$imageIsStatic);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*canCenter*/ 512 | $$self.$$.dirty[3] & /*cropAutoCenterImageSelectionTimeout, cropAutoCenterImageSelectionTimeoutId*/ 536870976 | $$self.$$.dirty[4] & /*$isInteracting*/ 524288) {\r\n\t\t\tif (canCenter && cropAutoCenterImageSelectionTimeout && !$isInteracting) {\r\n\t\t\t\tclearTimeout(cropAutoCenterImageSelectionTimeoutId);\r\n\t\t\t\t$$invalidate(122, cropAutoCenterImageSelectionTimeoutId = setTimeout(handleRecenterAction, cropAutoCenterImageSelectionTimeout));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*cropAutoCenterImageSelectionTimeoutId*/ 536870912 | $$self.$$.dirty[4] & /*$isInteracting*/ 524288) {\r\n\t\t\tif ($isInteracting) clearTimeout(cropAutoCenterImageSelectionTimeoutId);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*shouldRenderImageSelectionRecenterButton, canCenter*/ 1536 | $$self.$$.dirty[4] & /*$isAnimated*/ 16384) {\r\n\t\t\trecenterOpacity.set(\r\n\t\t\t\tshouldRenderImageSelectionRecenterButton && canCenter\r\n\t\t\t\t? 1\r\n\t\t\t\t: 0,\r\n\t\t\t\t{ hard: $isAnimated === false }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*imageSelectionCenter, $isAnimated*/ 16448) {\r\n\t\t\trecenterOffset.set(imageSelectionCenter, { hard: $isAnimated === false });\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 4096 | $$self.$$.dirty[4] & /*$stagePadded*/ 131072) {\r\n\t\t\tif ($isActive && !$stagePadded) {\r\n\t\t\t\tsetPreviewModifiers();\r\n\t\t\t} else {\r\n\t\t\t\tclearPreviewModifiers();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*$imageSelectionGuides*/ 65536) {\r\n\t\t\t// if overlay top changes\r\n\t\t\t$imageSelectionGuides && syncGuides();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*$env*/ 32768) {\r\n\t\t\t// #endregion\r\n\t\t\t//\r\n\t\t\t// Transform tabs\r\n\t\t\t//\r\n\t\t\t$$invalidate(126, hasPlentyVerticalSpace = $env.verticalSpace !== 'short');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*cropMinimizeToolbar, isOverlayMode*/ 1207959552 | $$self.$$.dirty[4] & /*hasPlentyVerticalSpace*/ 4) {\r\n\t\t\t$$invalidate(20, shouldRenderToolbar = // should show if is not allowed to hide and is not in overlay mode\r\n\t\t\tcropMinimizeToolbar === 'never' && !isOverlayMode || // or if plenty space and should not force hide\r\n\t\t\thasPlentyVerticalSpace && cropMinimizeToolbar !== 'always');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*cropEnableZoom*/ 4 | $$self.$$.dirty[3] & /*cropEnableZoomInput*/ 1024) {\r\n\t\t\t$$invalidate(125, couldRenderZoomInput = cropEnableZoom && cropEnableZoomInput);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*cropEnableZoomAutoHide*/ 2048 | $$self.$$.dirty[4] & /*hasPlentyVerticalSpace, couldRenderZoomInput*/ 6) {\r\n\t\t\t$$invalidate(124, shouldRenderZoomInput = cropEnableZoomAutoHide\r\n\t\t\t? hasPlentyVerticalSpace && couldRenderZoomInput\r\n\t\t\t: couldRenderZoomInput);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*cropEnableRotationInput*/ 512 | $$self.$$.dirty[4] & /*shouldRenderZoomInput*/ 1) {\r\n\t\t\t$$invalidate(19, shouldRenderFooter = cropEnableRotationInput || shouldRenderZoomInput);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*shouldRenderZoomInput*/ 1) {\r\n\t\t\tif (!shouldRenderZoomInput) {\r\n\t\t\t\t$$invalidate(5, transformSelected = transformToolInitial);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*transformSelected*/ 32) {\r\n\t\t\t$$invalidate(18, tabsConfig = {\r\n\t\t\t\tname: cropUniqueId,\r\n\t\t\t\tselected: transformSelected\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*locale*/ 16 | $$self.$$.dirty[3] & /*cropEnableRotationInput*/ 512 | $$self.$$.dirty[4] & /*shouldRenderZoomInput*/ 1) {\r\n\t\t\t$$invalidate(7, tabs = [\r\n                shouldRenderZoomInput && {\r\n\t\t\t\t\tid: cropUniqueId + '-zoom',\r\n\t\t\t\t\tlabel: locale.cropLabelTabZoom\r\n\t\t\t\t},\r\n\t\t\t\tcropEnableRotationInput && {\r\n\t\t\t\t\tid: cropUniqueId + '-rotation',\r\n\t\t\t\t\tlabel: locale.cropLabelTabRotation\r\n\t\t\t\t},\t\t\t\t\r\n\t\t\t].filter(Boolean));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*tabs*/ 128) {\r\n\t\t\t$$invalidate(17, panels = tabs.map(tab => tab.id));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*stageRef*/ 64 | $$self.$$.dirty[3] & /*isOverlayMode*/ 1073741824) {\r\n\t\t\tif (stageRef && !stageRef.children.length && isOverlayMode) {\r\n\t\t\t\tstageRef.dispatchEvent(new CustomEvent('measure', { detail: stageRef.rect }));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 4096 | $$self.$$.dirty[4] & /*$isAnimated*/ 16384) {\r\n\t\t\t$isAnimated && footerOffset.set($isActive ? 0 : 20);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*$footerOffset*/ 8192) {\r\n\t\t\t$$invalidate(16, footerStyle = $footerOffset\r\n\t\t\t? `transform: translateY(${$footerOffset}px)`\r\n\t\t\t: undefined);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tisActive,\r\n\t\tcropImageSelectionCornerStyle,\r\n\t\tcropEnableZoom,\r\n\t\tcropRotationRange,\r\n\t\tlocale,\r\n\t\ttransformSelected,\r\n\t\tstageRef,\r\n\t\ttabs,\r\n\t\timageSelectionRectOffset,\r\n\t\tcanCenter,\r\n\t\tshouldRenderImageSelectionRecenterButton,\r\n\t\tcropTools,\r\n\t\t$isActive,\r\n\t\t$imageCropRect,\r\n\t\t$imageRotation,\r\n\t\troot,\r\n\t\tfooterStyle,\r\n\t\tpanels,\r\n\t\ttabsConfig,\r\n\t\tshouldRenderFooter,\r\n\t\tshouldRenderToolbar,\r\n\t\tshouldRenderImageSelection,\r\n\t\tshouldRenderInfoIndicator,\r\n\t\timageZoomLevelMin,\r\n\t\t$rootRect,\r\n\t\t$elasticityMultiplier,\r\n\t\t$imageRotationRange,\r\n\t\t$imageZoomLevelRange,\r\n\t\t$imageZoomLevel,\r\n\t\t$recenterOpacity,\r\n\t\t$recenterOffset,\r\n\t\tisAnimated,\r\n\t\telasticityMultiplier,\r\n\t\tredrawTrigger,\r\n\t\timageIsStatic,\r\n\t\timageStaticVisualCorners,\r\n\t\tformattedCropPresetOptions,\r\n\t\tenv,\r\n\t\tisInteracting,\r\n\t\tisTransformingImage,\r\n\t\trootRect,\r\n\t\tstageRect,\r\n\t\tutilRectPadded,\r\n\t\trangeInputElasticity,\r\n\t\tpresentationScalar,\r\n\t\tutilTools,\r\n\t\timagePreviewModifiers,\r\n\t\timageFlipX,\r\n\t\timageFlipY,\r\n\t\timageRotation,\r\n\t\timageRotationRange,\r\n\t\timageOutputSize,\r\n\t\timageSelectionRect,\r\n\t\timageSelectionRectSnapshot,\r\n\t\timageSelectionRectIntent,\r\n\t\timageSelectionRectPresentation,\r\n\t\timageCropRectIntent,\r\n\t\timageCropRectOrigin,\r\n\t\timageCropRect,\r\n\t\timageCropMinSize,\r\n\t\timageCropMaxSize,\r\n\t\timageCropRange,\r\n\t\timageCropAspectRatio,\r\n\t\timageCropLimitToImage,\r\n\t\timageSize,\r\n\t\timageScalar,\r\n\t\timageOverlayMarkup,\r\n\t\tstagePadded,\r\n\t\thandleSelectionGrab,\r\n\t\thandleSelectionDrag,\r\n\t\thandleSelectionRelease,\r\n\t\thandleRotateStart,\r\n\t\thandleRotateMove,\r\n\t\thandleRotateEnd,\r\n\t\thandleImageDragStart,\r\n\t\thandleImageDrag,\r\n\t\thandleImageDragEnd,\r\n\t\thandleImageDragRelease,\r\n\t\timageCropRangeAspectRatio,\r\n\t\timageZoomLevelRange,\r\n\t\timageZoomLevel,\r\n\t\thandleResizeStart,\r\n\t\thandleResizeMove,\r\n\t\thandleResizeEnd,\r\n\t\thandleGestureStart,\r\n\t\thandleGestureUpdate,\r\n\t\thandleGestureEnd,\r\n\t\thandleWheel,\r\n\t\thandleRecenterAction,\r\n\t\trecenterOpacity,\r\n\t\trecenterOffset,\r\n\t\tselectedPresetIndex,\r\n\t\timageSelectionGuides,\r\n\t\tcropUniqueId,\r\n\t\tfooterOffset,\r\n\t\tcropSelectPresetFilter,\r\n\t\tname,\r\n\t\tstores,\r\n\t\tcropWillRenderImageSelectionGuides,\r\n\t\tcropAutoCenterImageSelectionTimeout,\r\n\t\tcropEnableZoomMatchImageAspectRatio,\r\n\t\tcropEnableRotateMatchImageAspectRatio,\r\n\t\tcropEnableRotationInput,\r\n\t\tcropEnableZoomInput,\r\n\t\tcropEnableZoomAutoHide,\r\n\t\tcropEnableImageSelection,\r\n\t\tcropEnableInfoIndicator,\r\n\t\tcropEnableZoomTowardsWheelPosition,\r\n\t\tcropEnableLimitWheelInputToCropSelection,\r\n\t\tcropEnableCenterImageSelection,\r\n\t\tcropEnableButtonRotateLeft,\r\n\t\tcropEnableButtonRotateRight,\r\n\t\tcropEnableButtonFlipHorizontal,\r\n\t\tcropEnableButtonFlipVertical,\r\n\t\tcropSelectPresetOptions,\r\n\t\tcropEnableSelectPreset,\r\n\t\tcropEnableFilterMatchAspectRatio,\r\n\t\tcropEnableButtonToggleCropLimit,\r\n\t\tcropWillRenderTools,\r\n\t\tcropActiveTransformTool,\r\n\t\tcropMinimizeToolbar,\r\n\t\tcropInteractionFocus,\r\n\t\tcropAutoCenterImageSelectionTimeoutId,\r\n\t\tisOverlayMode,\r\n\t\tshouldRenderZoomInput,\r\n\t\tcouldRenderZoomInput,\r\n\t\thasPlentyVerticalSpace,\r\n\t\tshouldRenderPresetSelect,\r\n\t\thasCropSelectPresetOptions,\r\n\t\timageSelectionOffset,\r\n\t\timageSelectionCenter,\r\n\t\tcanZoomToCenter,\r\n\t\tisImageSelectionCentered,\r\n\t\tisResizingSelection,\r\n\t\tisImageSelectionDisplayed,\r\n\t\tisMaxSelectionRect,\r\n\t\timageSelectionCenteredRect,\r\n\t\t$footerOffset,\r\n\t\t$isAnimated,\r\n\t\t$env,\r\n\t\t$imageSelectionGuides,\r\n\t\t$stagePadded,\r\n\t\t$imageSelectionRectPresentation,\r\n\t\t$isInteracting,\r\n\t\t$imageIsStatic,\r\n\t\t$imageScalar,\r\n\t\t$presentationScalar,\r\n\t\t$utilRectPadded,\r\n\t\t$imageSelectionRectSnapshot,\r\n\t\t$imageSelectionRect,\r\n\t\t$stageRect,\r\n\t\t$imageSize,\r\n\t\t$imageCropLimitToImage,\r\n\t\t$imageCropMinSize,\r\n\t\t$selectedPresetIndex,\r\n\t\t$formattedCropPresetOptions,\r\n\t\t$imageFlipY,\r\n\t\t$imageFlipX,\r\n\t\t$redrawTrigger,\r\n\t\tmeasure_handler_1,\r\n\t\tselect_handler,\r\n\t\tdiv0_binding,\r\n\t\tinteractable_function_1,\r\n\t\tutil_root_binding,\r\n\t\tmeasure_handler\r\n\t];\r\n}\r\n\r\nclass Crop extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$l,\r\n\t\t\tcreate_fragment$l,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tname: 96,\r\n\t\t\t\tisActive: 0,\r\n\t\t\t\tstores: 97,\r\n\t\t\t\tcropImageSelectionCornerStyle: 1,\r\n\t\t\t\tcropWillRenderImageSelectionGuides: 98,\r\n\t\t\t\tcropAutoCenterImageSelectionTimeout: 99,\r\n\t\t\t\tcropEnableZoomMatchImageAspectRatio: 100,\r\n\t\t\t\tcropEnableRotateMatchImageAspectRatio: 101,\r\n\t\t\t\tcropEnableRotationInput: 102,\r\n\t\t\t\tcropEnableZoom: 2,\r\n\t\t\t\tcropEnableZoomInput: 103,\r\n\t\t\t\tcropEnableZoomAutoHide: 104,\r\n\t\t\t\tcropEnableImageSelection: 105,\r\n\t\t\t\tcropEnableInfoIndicator: 106,\r\n\t\t\t\tcropEnableZoomTowardsWheelPosition: 107,\r\n\t\t\t\tcropEnableLimitWheelInputToCropSelection: 108,\r\n\t\t\t\tcropEnableCenterImageSelection: 109,\r\n\t\t\t\tcropEnableButtonRotateLeft: 110,\r\n\t\t\t\tcropEnableButtonRotateRight: 111,\r\n\t\t\t\tcropEnableButtonFlipHorizontal: 112,\r\n\t\t\t\tcropEnableButtonFlipVertical: 113,\r\n\t\t\t\tcropSelectPresetOptions: 114,\r\n\t\t\t\tcropEnableSelectPreset: 115,\r\n\t\t\t\tcropEnableFilterMatchAspectRatio: 116,\r\n\t\t\t\tcropSelectPresetFilter: 95,\r\n\t\t\t\tcropEnableButtonToggleCropLimit: 117,\r\n\t\t\t\tcropWillRenderTools: 118,\r\n\t\t\t\tcropActiveTransformTool: 119,\r\n\t\t\t\tcropMinimizeToolbar: 120,\r\n\t\t\t\tcropInteractionFocus: 121,\r\n\t\t\t\tcropRotationRange: 3,\r\n\t\t\t\tlocale: 4\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1, -1, -1, -1, -1, -1, -1]\r\n\t\t);\r\n\t}\r\n\r\n\tget name() {\r\n\t\treturn this.$$.ctx[96];\r\n\t}\r\n\r\n\tget isActive() {\r\n\t\treturn this.$$.ctx[0];\r\n\t}\r\n\r\n\tset isActive(isActive) {\r\n\t\tthis.$$set({ isActive });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stores() {\r\n\t\treturn this.$$.ctx[97];\r\n\t}\r\n\r\n\tset stores(stores) {\r\n\t\tthis.$$set({ stores });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropImageSelectionCornerStyle() {\r\n\t\treturn this.$$.ctx[1];\r\n\t}\r\n\r\n\tset cropImageSelectionCornerStyle(cropImageSelectionCornerStyle) {\r\n\t\tthis.$$set({ cropImageSelectionCornerStyle });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropWillRenderImageSelectionGuides() {\r\n\t\treturn this.$$.ctx[98];\r\n\t}\r\n\r\n\tset cropWillRenderImageSelectionGuides(cropWillRenderImageSelectionGuides) {\r\n\t\tthis.$$set({ cropWillRenderImageSelectionGuides });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropAutoCenterImageSelectionTimeout() {\r\n\t\treturn this.$$.ctx[99];\r\n\t}\r\n\r\n\tset cropAutoCenterImageSelectionTimeout(cropAutoCenterImageSelectionTimeout) {\r\n\t\tthis.$$set({ cropAutoCenterImageSelectionTimeout });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableZoomMatchImageAspectRatio() {\r\n\t\treturn this.$$.ctx[100];\r\n\t}\r\n\r\n\tset cropEnableZoomMatchImageAspectRatio(cropEnableZoomMatchImageAspectRatio) {\r\n\t\tthis.$$set({ cropEnableZoomMatchImageAspectRatio });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableRotateMatchImageAspectRatio() {\r\n\t\treturn this.$$.ctx[101];\r\n\t}\r\n\r\n\tset cropEnableRotateMatchImageAspectRatio(cropEnableRotateMatchImageAspectRatio) {\r\n\t\tthis.$$set({ cropEnableRotateMatchImageAspectRatio });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableRotationInput() {\r\n\t\treturn this.$$.ctx[102];\r\n\t}\r\n\r\n\tset cropEnableRotationInput(cropEnableRotationInput) {\r\n\t\tthis.$$set({ cropEnableRotationInput });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableZoom() {\r\n\t\treturn this.$$.ctx[2];\r\n\t}\r\n\r\n\tset cropEnableZoom(cropEnableZoom) {\r\n\t\tthis.$$set({ cropEnableZoom });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableZoomInput() {\r\n\t\treturn this.$$.ctx[103];\r\n\t}\r\n\r\n\tset cropEnableZoomInput(cropEnableZoomInput) {\r\n\t\tthis.$$set({ cropEnableZoomInput });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableZoomAutoHide() {\r\n\t\treturn this.$$.ctx[104];\r\n\t}\r\n\r\n\tset cropEnableZoomAutoHide(cropEnableZoomAutoHide) {\r\n\t\tthis.$$set({ cropEnableZoomAutoHide });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableImageSelection() {\r\n\t\treturn this.$$.ctx[105];\r\n\t}\r\n\r\n\tset cropEnableImageSelection(cropEnableImageSelection) {\r\n\t\tthis.$$set({ cropEnableImageSelection });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableInfoIndicator() {\r\n\t\treturn this.$$.ctx[106];\r\n\t}\r\n\r\n\tset cropEnableInfoIndicator(cropEnableInfoIndicator) {\r\n\t\tthis.$$set({ cropEnableInfoIndicator });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableZoomTowardsWheelPosition() {\r\n\t\treturn this.$$.ctx[107];\r\n\t}\r\n\r\n\tset cropEnableZoomTowardsWheelPosition(cropEnableZoomTowardsWheelPosition) {\r\n\t\tthis.$$set({ cropEnableZoomTowardsWheelPosition });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableLimitWheelInputToCropSelection() {\r\n\t\treturn this.$$.ctx[108];\r\n\t}\r\n\r\n\tset cropEnableLimitWheelInputToCropSelection(cropEnableLimitWheelInputToCropSelection) {\r\n\t\tthis.$$set({ cropEnableLimitWheelInputToCropSelection });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableCenterImageSelection() {\r\n\t\treturn this.$$.ctx[109];\r\n\t}\r\n\r\n\tset cropEnableCenterImageSelection(cropEnableCenterImageSelection) {\r\n\t\tthis.$$set({ cropEnableCenterImageSelection });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableButtonRotateLeft() {\r\n\t\treturn this.$$.ctx[110];\r\n\t}\r\n\r\n\tset cropEnableButtonRotateLeft(cropEnableButtonRotateLeft) {\r\n\t\tthis.$$set({ cropEnableButtonRotateLeft });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableButtonRotateRight() {\r\n\t\treturn this.$$.ctx[111];\r\n\t}\r\n\r\n\tset cropEnableButtonRotateRight(cropEnableButtonRotateRight) {\r\n\t\tthis.$$set({ cropEnableButtonRotateRight });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableButtonFlipHorizontal() {\r\n\t\treturn this.$$.ctx[112];\r\n\t}\r\n\r\n\tset cropEnableButtonFlipHorizontal(cropEnableButtonFlipHorizontal) {\r\n\t\tthis.$$set({ cropEnableButtonFlipHorizontal });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableButtonFlipVertical() {\r\n\t\treturn this.$$.ctx[113];\r\n\t}\r\n\r\n\tset cropEnableButtonFlipVertical(cropEnableButtonFlipVertical) {\r\n\t\tthis.$$set({ cropEnableButtonFlipVertical });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropSelectPresetOptions() {\r\n\t\treturn this.$$.ctx[114];\r\n\t}\r\n\r\n\tset cropSelectPresetOptions(cropSelectPresetOptions) {\r\n\t\tthis.$$set({ cropSelectPresetOptions });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableSelectPreset() {\r\n\t\treturn this.$$.ctx[115];\r\n\t}\r\n\r\n\tset cropEnableSelectPreset(cropEnableSelectPreset) {\r\n\t\tthis.$$set({ cropEnableSelectPreset });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableFilterMatchAspectRatio() {\r\n\t\treturn this.$$.ctx[116];\r\n\t}\r\n\r\n\tset cropEnableFilterMatchAspectRatio(cropEnableFilterMatchAspectRatio) {\r\n\t\tthis.$$set({ cropEnableFilterMatchAspectRatio });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropSelectPresetFilter() {\r\n\t\treturn this.$$.ctx[95];\r\n\t}\r\n\r\n\tset cropSelectPresetFilter(cropSelectPresetFilter) {\r\n\t\tthis.$$set({ cropSelectPresetFilter });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropEnableButtonToggleCropLimit() {\r\n\t\treturn this.$$.ctx[117];\r\n\t}\r\n\r\n\tset cropEnableButtonToggleCropLimit(cropEnableButtonToggleCropLimit) {\r\n\t\tthis.$$set({ cropEnableButtonToggleCropLimit });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropWillRenderTools() {\r\n\t\treturn this.$$.ctx[118];\r\n\t}\r\n\r\n\tset cropWillRenderTools(cropWillRenderTools) {\r\n\t\tthis.$$set({ cropWillRenderTools });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropActiveTransformTool() {\r\n\t\treturn this.$$.ctx[119];\r\n\t}\r\n\r\n\tset cropActiveTransformTool(cropActiveTransformTool) {\r\n\t\tthis.$$set({ cropActiveTransformTool });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropMinimizeToolbar() {\r\n\t\treturn this.$$.ctx[120];\r\n\t}\r\n\r\n\tset cropMinimizeToolbar(cropMinimizeToolbar) {\r\n\t\tthis.$$set({ cropMinimizeToolbar });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropInteractionFocus() {\r\n\t\treturn this.$$.ctx[121];\r\n\t}\r\n\r\n\tset cropInteractionFocus(cropInteractionFocus) {\r\n\t\tthis.$$set({ cropInteractionFocus });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget cropRotationRange() {\r\n\t\treturn this.$$.ctx[3];\r\n\t}\r\n\r\n\tset cropRotationRange(cropRotationRange) {\r\n\t\tthis.$$set({ cropRotationRange });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget locale() {\r\n\t\treturn this.$$.ctx[4];\r\n\t}\r\n\r\n\tset locale(locale) {\r\n\t\tthis.$$set({ locale });\r\n\t\tflush();\r\n\t}\r\n}\r\n\r\n// @ts-ignore\r\nvar _plugin_crop = { util: ['crop', Crop] };\r\n\r\n/* src/core/ui/plugins/filter/index.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_option_slot$2(ctx) {\r\n\tlet div1;\r\n\tlet div0;\r\n\tlet option = /*option*/ ctx[76];\r\n\tlet t0;\r\n\tlet span;\r\n\r\n\tlet t1_value = (isFunction(/*option*/ ctx[76].label)\r\n\t? /*option*/ ctx[76].label(/*locale*/ ctx[2])\r\n\t: /*option*/ ctx[76].label) + \"\";\r\n\r\n\tlet t1;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\tfunction measure_handler_1(...args) {\r\n\t\treturn /*measure_handler_1*/ ctx[51](/*option*/ ctx[76], ...args);\r\n\t}\r\n\r\n\tconst assign_div0 = () => /*div0_binding*/ ctx[52](div0, option);\r\n\tconst unassign_div0 = () => /*div0_binding*/ ctx[52](null, option);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv1 = element(\"div\");\r\n\t\t\tdiv0 = element(\"div\");\r\n\t\t\tt0 = space();\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt1 = text(t1_value);\r\n\t\t\tattr(div0, \"class\", FILTER_PREVIEW_CLASS_NAME);\r\n\t\t\tattr(div1, \"slot\", \"option\");\r\n\t\t\tattr(div1, \"class\", \"PinturaFilterOption\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div1, anchor);\r\n\t\t\tappend(div1, div0);\r\n\t\t\tassign_div0();\r\n\t\t\tappend(div1, t0);\r\n\t\t\tappend(div1, span);\r\n\t\t\tappend(span, t1);\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(div0, \"measure\", measure_handler_1),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div0))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\r\n\t\t\tif (option !== /*option*/ ctx[76]) {\r\n\t\t\t\tunassign_div0();\r\n\t\t\t\toption = /*option*/ ctx[76];\r\n\t\t\t\tassign_div0();\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty[0] & /*locale*/ 4 | dirty[2] & /*option*/ 16384 && t1_value !== (t1_value = (isFunction(/*option*/ ctx[76].label)\r\n\t\t\t? /*option*/ ctx[76].label(/*locale*/ ctx[2])\r\n\t\t\t: /*option*/ ctx[76].label) + \"\")) set_data(t1, t1_value);\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div1);\r\n\t\t\tunassign_div0();\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (388:8) <Scrollable             elasticity={$elasticityMultiplier * scrollElasticity}             onscroll={(offset) => (tileScrollOffset = offset)}             bind:maskFeatherStartOpacity={tileLeftOpacity}             bind:maskFeatherEndOpacity={tileRightOpacity}             bind:maskFeatherSize={tileMargin}             on:measure={(e) => (tileScrollContainerRect = e.detail)}         >\r\nfunction create_default_slot$8(ctx) {\r\n\tlet radiogroup;\r\n\tlet current;\r\n\r\n\tradiogroup = new RadioGroup({\r\n\t\t\tprops: {\r\n\t\t\t\tlocale: /*locale*/ ctx[2],\r\n\t\t\t\tlayout: \"row\",\r\n\t\t\t\toptions: /*filterOptions*/ ctx[3],\r\n\t\t\t\tselectedIndex: /*selectedFilterIndex*/ ctx[12],\r\n\t\t\t\tonchange: /*handleChangeFilter*/ ctx[32],\r\n\t\t\t\t$$slots: {\r\n\t\t\t\t\toption: [\r\n\t\t\t\t\t\tcreate_option_slot$2,\r\n\t\t\t\t\t\t({ option }) => ({ 76: option }),\r\n\t\t\t\t\t\t({ option }) => [0, 0, option ? 16384 : 0]\r\n\t\t\t\t\t]\r\n\t\t\t\t},\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(radiogroup.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(radiogroup, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst radiogroup_changes = {};\r\n\t\t\tif (dirty[0] & /*locale*/ 4) radiogroup_changes.locale = /*locale*/ ctx[2];\r\n\t\t\tif (dirty[0] & /*filterOptions*/ 8) radiogroup_changes.options = /*filterOptions*/ ctx[3];\r\n\t\t\tif (dirty[0] & /*selectedFilterIndex*/ 4096) radiogroup_changes.selectedIndex = /*selectedFilterIndex*/ ctx[12];\r\n\r\n\t\t\tif (dirty[0] & /*locale, tileElements*/ 1028 | dirty[2] & /*$$scope, option*/ 49152) {\r\n\t\t\t\tradiogroup_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tradiogroup.$set(radiogroup_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(radiogroup.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(radiogroup.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(radiogroup, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (379:4) \r\nfunction create_footer_slot$4(ctx) {\r\n\tlet div;\r\n\tlet scrollable;\r\n\tlet updating_maskFeatherStartOpacity;\r\n\tlet updating_maskFeatherEndOpacity;\r\n\tlet updating_maskFeatherSize;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\tfunction scrollable_maskFeatherStartOpacity_binding(value) {\r\n\t\t/*scrollable_maskFeatherStartOpacity_binding*/ ctx[54](value);\r\n\t}\r\n\r\n\tfunction scrollable_maskFeatherEndOpacity_binding(value) {\r\n\t\t/*scrollable_maskFeatherEndOpacity_binding*/ ctx[55](value);\r\n\t}\r\n\r\n\tfunction scrollable_maskFeatherSize_binding(value) {\r\n\t\t/*scrollable_maskFeatherSize_binding*/ ctx[56](value);\r\n\t}\r\n\r\n\tlet scrollable_props = {\r\n\t\telasticity: /*$elasticityMultiplier*/ ctx[13] * /*scrollElasticity*/ ctx[19],\r\n\t\tonscroll: /*func*/ ctx[53],\r\n\t\t$$slots: { default: [create_default_slot$8] },\r\n\t\t$$scope: { ctx }\r\n\t};\r\n\r\n\tif (/*tileLeftOpacity*/ ctx[4] !== void 0) {\r\n\t\tscrollable_props.maskFeatherStartOpacity = /*tileLeftOpacity*/ ctx[4];\r\n\t}\r\n\r\n\tif (/*tileRightOpacity*/ ctx[5] !== void 0) {\r\n\t\tscrollable_props.maskFeatherEndOpacity = /*tileRightOpacity*/ ctx[5];\r\n\t}\r\n\r\n\tif (/*tileMargin*/ ctx[6] !== void 0) {\r\n\t\tscrollable_props.maskFeatherSize = /*tileMargin*/ ctx[6];\r\n\t}\r\n\r\n\tscrollable = new Scrollable({ props: scrollable_props });\r\n\tbinding_callbacks.push(() => bind(scrollable, 'maskFeatherStartOpacity', scrollable_maskFeatherStartOpacity_binding));\r\n\tbinding_callbacks.push(() => bind(scrollable, 'maskFeatherEndOpacity', scrollable_maskFeatherEndOpacity_binding));\r\n\tbinding_callbacks.push(() => bind(scrollable, 'maskFeatherSize', scrollable_maskFeatherSize_binding));\r\n\tscrollable.$on(\"measure\", /*measure_handler_2*/ ctx[57]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tcreate_component(scrollable.$$.fragment);\r\n\t\t\tattr(div, \"slot\", \"footer\");\r\n\t\t\tattr(div, \"style\", /*footerStyle*/ ctx[11]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tmount_component(scrollable, div, null);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(div, \"transitionend\", /*handleTransitionEnd*/ ctx[30]),\r\n\t\t\t\t\tlisten(div, \"measure\", /*measure_handler_3*/ ctx[58]),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div, { observePosition: true }))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst scrollable_changes = {};\r\n\t\t\tif (dirty[0] & /*$elasticityMultiplier*/ 8192) scrollable_changes.elasticity = /*$elasticityMultiplier*/ ctx[13] * /*scrollElasticity*/ ctx[19];\r\n\t\t\tif (dirty[0] & /*tileScrollOffset*/ 128) scrollable_changes.onscroll = /*func*/ ctx[53];\r\n\r\n\t\t\tif (dirty[0] & /*locale, filterOptions, selectedFilterIndex, tileElements*/ 5132 | dirty[2] & /*$$scope*/ 32768) {\r\n\t\t\t\tscrollable_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tif (!updating_maskFeatherStartOpacity && dirty[0] & /*tileLeftOpacity*/ 16) {\r\n\t\t\t\tupdating_maskFeatherStartOpacity = true;\r\n\t\t\t\tscrollable_changes.maskFeatherStartOpacity = /*tileLeftOpacity*/ ctx[4];\r\n\t\t\t\tadd_flush_callback(() => updating_maskFeatherStartOpacity = false);\r\n\t\t\t}\r\n\r\n\t\t\tif (!updating_maskFeatherEndOpacity && dirty[0] & /*tileRightOpacity*/ 32) {\r\n\t\t\t\tupdating_maskFeatherEndOpacity = true;\r\n\t\t\t\tscrollable_changes.maskFeatherEndOpacity = /*tileRightOpacity*/ ctx[5];\r\n\t\t\t\tadd_flush_callback(() => updating_maskFeatherEndOpacity = false);\r\n\t\t\t}\r\n\r\n\t\t\tif (!updating_maskFeatherSize && dirty[0] & /*tileMargin*/ 64) {\r\n\t\t\t\tupdating_maskFeatherSize = true;\r\n\t\t\t\tscrollable_changes.maskFeatherSize = /*tileMargin*/ ctx[6];\r\n\t\t\t\tadd_flush_callback(() => updating_maskFeatherSize = false);\r\n\t\t\t}\r\n\r\n\t\t\tscrollable.$set(scrollable_changes);\r\n\r\n\t\t\tif (!current || dirty[0] & /*footerStyle*/ 2048) {\r\n\t\t\t\tattr(div, \"style\", /*footerStyle*/ ctx[11]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(scrollable.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(scrollable.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tdestroy_component(scrollable);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$k(ctx) {\r\n\tlet util;\r\n\tlet current;\r\n\r\n\tutil = new Util({\r\n\t\t\tprops: {\r\n\t\t\t\t$$slots: { footer: [create_footer_slot$4] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tutil.$on(\"measure\", /*measure_handler*/ ctx[59]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(util.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(util, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst util_changes = {};\r\n\r\n\t\t\tif (dirty[0] & /*footerStyle, footerRect, $elasticityMultiplier, tileScrollOffset, tileLeftOpacity, tileRightOpacity, tileMargin, tileScrollContainerRect, locale, filterOptions, selectedFilterIndex, tileElements*/ 16380 | dirty[2] & /*$$scope*/ 32768) {\r\n\t\t\t\tutil_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tutil.$set(util_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(util.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(util.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(util, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nlet FILTER_PREVIEW_CLASS_NAME = 'PinturaFilterPreview';\r\n\r\nfunction instance$k($$self, $$props, $$invalidate) {\r\n\tlet filterOptionsFlattened;\r\n\tlet selectedFilterIndex;\r\n\tlet footerStyle;\r\n\tlet $footerOffset;\r\n\tlet $imageColorMatrix;\r\n\tlet $imageTiles;\r\n\tlet $imagePreview;\r\n\r\n\tlet $isActiveFraction,\r\n\t\t$$unsubscribe_isActiveFraction = noop,\r\n\t\t$$subscribe_isActiveFraction = () => ($$unsubscribe_isActiveFraction(), $$unsubscribe_isActiveFraction = subscribe(isActiveFraction, $$value => $$invalidate(43, $isActiveFraction = $$value)), isActiveFraction);\r\n\r\n\tlet $interfaceImages;\r\n\tlet $imageBackgroundColor;\r\n\tlet $imageSize;\r\n\tlet $imageGamma;\r\n\tlet $imageTransforms;\r\n\tlet $tileRects;\r\n\tlet $utilRect;\r\n\tlet $stageRectBase;\r\n\r\n\tlet $isActive,\r\n\t\t$$unsubscribe_isActive = noop,\r\n\t\t$$subscribe_isActive = () => ($$unsubscribe_isActive(), $$unsubscribe_isActive = subscribe(isActive, $$value => $$invalidate(49, $isActive = $$value)), isActive);\r\n\r\n\tlet $animation;\r\n\tlet $canvasSize;\r\n\tlet $elasticityMultiplier;\r\n\t$$self.$$.on_destroy.push(() => $$unsubscribe_isActiveFraction());\r\n\t$$self.$$.on_destroy.push(() => $$unsubscribe_isActive());\r\n\tconst name = 'filter';\r\n\tlet { isActive } = $$props;\r\n\t$$subscribe_isActive();\r\n\tlet { isActiveFraction } = $$props;\r\n\t$$subscribe_isActiveFraction();\r\n\tlet { stores } = $$props;\r\n\tlet { locale } = $$props;\r\n\tlet { filterFunctions } = $$props;\r\n\tlet { filterOptions } = $$props;\r\n\r\n\t// context\r\n\tconst elasticityMultiplier = getContext('elasticityMultiplier');\r\n\r\n\tcomponent_subscribe($$self, elasticityMultiplier, value => $$invalidate(13, $elasticityMultiplier = value));\r\n\r\n\t// connect filter choice to stores\r\n\tconst { history, interfaceImages, stageRectBase, utilRect, animation, scrollElasticity, imageSize, imagePreview, imageCropRect, imageRotation, imageFlipX, imageFlipY, imageBackgroundColor, imageGamma, imageColorMatrix, allowPan, allowZoom, enableZoomControls } = stores;\r\n\r\n\tcomponent_subscribe($$self, interfaceImages, value => $$invalidate(60, $interfaceImages = value));\r\n\tcomponent_subscribe($$self, stageRectBase, value => $$invalidate(48, $stageRectBase = value));\r\n\tcomponent_subscribe($$self, utilRect, value => $$invalidate(47, $utilRect = value));\r\n\tcomponent_subscribe($$self, animation, value => $$invalidate(50, $animation = value));\r\n\tcomponent_subscribe($$self, imageSize, value => $$invalidate(62, $imageSize = value));\r\n\tcomponent_subscribe($$self, imagePreview, value => $$invalidate(42, $imagePreview = value));\r\n\tcomponent_subscribe($$self, imageBackgroundColor, value => $$invalidate(61, $imageBackgroundColor = value));\r\n\tcomponent_subscribe($$self, imageGamma, value => $$invalidate(44, $imageGamma = value));\r\n\tcomponent_subscribe($$self, imageColorMatrix, value => $$invalidate(40, $imageColorMatrix = value));\r\n\r\n\tconst getFilterIndex = (imageColorMatrix, filterOptionsFlattened) => {\r\n\t\tif (!imageColorMatrix || !imageColorMatrix['filter'] || !filterOptionsFlattened) return 0;\r\n\t\tconst filterColorMatrix = imageColorMatrix['filter'];\r\n\r\n\t\treturn filterOptionsFlattened.// get id and compare matrices\r\n\t\tfindIndex(([id]) => {\r\n\t\t\tif (!filterFunctions[id]) return false;\r\n\t\t\tconst matrix = filterFunctions[id]();\r\n\t\t\treturn arrayEqual(matrix, filterColorMatrix);\r\n\t\t});\r\n\t};\r\n\r\n\tconst tileRects = writable({});\r\n\tcomponent_subscribe($$self, tileRects, value => $$invalidate(46, $tileRects = value));\r\n\tconst handleTileResize = (item, rect) => set_store_value(tileRects, $tileRects[item.value] = rect, $tileRects);\r\n\r\n\tconst canvasSize = derived(tileRects, $tileRects => {\r\n\t\tif (!$tileRects[undefined]) return;\r\n\t\tconst tileRectFirst = $tileRects[undefined];\r\n\t\tif ($canvasSize && sizeEqual($canvasSize, tileRectFirst)) return $canvasSize;\r\n\t\treturn sizeClone(tileRectFirst);\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, canvasSize, value => $$invalidate(63, $canvasSize = value));\r\n\r\n\tconst imageTransforms = derived(\r\n\t\t[\r\n\t\t\tisActive,\r\n\t\t\tcanvasSize,\r\n\t\t\timageCropRect,\r\n\t\t\timageSize,\r\n\t\t\timageRotation,\r\n\t\t\timageFlipX,\r\n\t\t\timageFlipY\r\n\t\t],\r\n\t\t([\r\n\t\t\t\t$isActive,\r\n\t\t\t\t$canvasSize,\r\n\t\t\t\t$imageCropRect,\r\n\t\t\t\t$imageSize,\r\n\t\t\t\t$imageRotation,\r\n\t\t\t\t$imageFlipX,\r\n\t\t\t\t$imageFlipY\r\n\t\t\t], set) => {\r\n\t\t\tif (!$isActive || !$canvasSize || !$imageSize) return $imageTransforms;\r\n\t\t\tconst imageRect = rectCreateFromSize($imageSize);\r\n\t\t\tconst imageCenter = rectCenter(imageRect);\r\n\r\n\t\t\t// get base crop rect so we can correctly apply transforms\r\n\t\t\tconst cropRectBase = getBaseCropRect($imageSize, $imageCropRect, $imageRotation);\r\n\r\n\t\t\tconst cropRectBaseCenter = rectCenter(cropRectBase);\r\n\t\t\tconst imageTranslation = vectorSubtract(vectorClone(imageCenter), cropRectBaseCenter);\r\n\t\t\tconst imageOrigin = vectorInvert(vectorClone(imageTranslation));\r\n\r\n\t\t\t// scalar\r\n\t\t\tconst imageScalar = Math.max($canvasSize.width / $imageCropRect.width, $canvasSize.height / $imageCropRect.height);\r\n\r\n\t\t\t// update preview transforms\r\n\t\t\tset({\r\n\t\t\t\torigin: imageOrigin,\r\n\t\t\t\ttranslation: imageTranslation,\r\n\t\t\t\trotation: {\r\n\t\t\t\t\tx: $imageFlipY ? Math.PI : 0,\r\n\t\t\t\t\ty: $imageFlipX ? Math.PI : 0,\r\n\t\t\t\t\tz: $imageRotation\r\n\t\t\t\t},\r\n\t\t\t\tscale: imageScalar\r\n\t\t\t});\r\n\t\t}\r\n\t);\r\n\r\n\tcomponent_subscribe($$self, imageTransforms, value => $$invalidate(45, $imageTransforms = value));\r\n\r\n\tconst cloneImageTransforms = imageTransforms => ({\r\n\t\torigin: vectorClone(imageTransforms.origin),\r\n\t\ttranslation: vectorClone(imageTransforms.translation),\r\n\t\trotation: { ...imageTransforms.rotation },\r\n\t\t// perspective: vectorClone(imageTransforms.perspective),\r\n\t\tscale: imageTransforms.scale\r\n\t});\r\n\r\n\t//\r\n\t// Footer\r\n\t//\r\n\tconst footerOffset = spring($animation ? 20 : 0);\r\n\r\n\tcomponent_subscribe($$self, footerOffset, value => $$invalidate(39, $footerOffset = value));\r\n\tlet tileCornerRadius;\r\n\tconst tileElements = {};\r\n\r\n\tconst handleTransitionEnd = e => {\r\n\t\tif (e.target.className !== FILTER_PREVIEW_CLASS_NAME) return;\r\n\r\n\t\t$$invalidate(36, tileCornerRadius = Object.keys(tileElements).reduce(\r\n\t\t\t(prev, curr) => {\r\n\t\t\t\tconst element = tileElements[curr];\r\n\t\t\t\tconst style = getComputedStyle(element);\r\n\r\n\t\t\t\tconst corners = ['top-left', 'top-right', 'bottom-left', 'bottom-right'].map(corner => style.getPropertyValue(`border-${corner}-radius`)).map(unitToPixels).// this better aligns WebGL rounded corner with css rounded corner\r\n\t\t\t\tmap(v => v * 1.25);\r\n\r\n\t\t\t\tprev[curr] = corners;\r\n\t\t\t\treturn prev;\r\n\t\t\t},\r\n\t\t\t{}\r\n\t\t));\r\n\t};\r\n\r\n\tlet tileLeftOpacity; // set by Scrollable\r\n\tlet tileRightOpacity; // set by Scrollable\r\n\tlet tileMargin; // set by Scrollable\r\n\tlet tileScrollOffset = { x: 0, y: 0 };\r\n\tlet tileScrollContainerRect;\r\n\tlet tileWrapperOffset;\r\n\tlet footerRect;\r\n\tconst imageTiles = writable([]);\r\n\tcomponent_subscribe($$self, imageTiles, value => $$invalidate(41, $imageTiles = value));\r\n\r\n\t// clones an image tile for use in canvas\r\n\tconst cloneImageTile = tile => {\r\n\t\tconst clone = {\r\n\t\t\t// doesn't clone everything but should be enough\r\n\t\t\t...tile,\r\n\t\t\tdata: $imagePreview,\r\n\t\t\tsize: $imageSize,\r\n\t\t\toffset: { ...tile.offset },\r\n\t\t\tmask: { ...tile.mask },\r\n\t\t\tbackgroundColor: $imageBackgroundColor\r\n\t\t};\r\n\r\n\t\tclone.opacity = $isActiveFraction;\r\n\t\tclone.offset.y += $footerOffset;\r\n\t\tclone.mask.y += $footerOffset;\r\n\t\tclone.id = 'filter';\r\n\t\treturn clone;\r\n\t};\r\n\r\n\tconst filterInterfaceImages = () => $interfaceImages.filter(tile => tile.id !== 'filter');\r\n\r\n\tconst handleChangeFilter = ({ value }) => {\r\n\t\tset_store_value(\r\n\t\t\timageColorMatrix,\r\n\t\t\t$imageColorMatrix = {\r\n\t\t\t\t...$imageColorMatrix,\r\n\t\t\t\tfilter: isFunction(filterFunctions[value])\r\n\t\t\t\t? filterFunctions[value]()\r\n\t\t\t\t: undefined\r\n\t\t\t},\r\n\t\t\t$imageColorMatrix\r\n\t\t);\r\n\r\n\t\thistory.write();\r\n\t};\r\n\r\n\t// when destroyed we need to make sure all filter image previews are cleared\r\n\tonDestroy(() => {\r\n\t\tinterfaceImages.set([]);\r\n\t});\r\n\r\n\tconst measure_handler_1 = (option, e) => handleTileResize(option, e.detail);\r\n\r\n\tfunction div0_binding($$value, option) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\ttileElements[option.value] = $$value;\r\n\t\t\t$$invalidate(10, tileElements);\r\n\t\t});\r\n\t}\r\n\r\n\tconst func = offset => $$invalidate(7, tileScrollOffset = offset);\r\n\r\n\tfunction scrollable_maskFeatherStartOpacity_binding(value) {\r\n\t\ttileLeftOpacity = value;\r\n\t\t$$invalidate(4, tileLeftOpacity);\r\n\t}\r\n\r\n\tfunction scrollable_maskFeatherEndOpacity_binding(value) {\r\n\t\ttileRightOpacity = value;\r\n\t\t$$invalidate(5, tileRightOpacity);\r\n\t}\r\n\r\n\tfunction scrollable_maskFeatherSize_binding(value) {\r\n\t\ttileMargin = value;\r\n\t\t$$invalidate(6, tileMargin);\r\n\t}\r\n\r\n\tconst measure_handler_2 = e => $$invalidate(8, tileScrollContainerRect = e.detail);\r\n\tconst measure_handler_3 = e => $$invalidate(9, footerRect = e.detail);\r\n\r\n\tfunction measure_handler(event) {\r\n\t\tbubble.call(this, $$self, event);\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('isActive' in $$props) $$subscribe_isActive($$invalidate(0, isActive = $$props.isActive));\r\n\t\tif ('isActiveFraction' in $$props) $$subscribe_isActiveFraction($$invalidate(1, isActiveFraction = $$props.isActiveFraction));\r\n\t\tif ('stores' in $$props) $$invalidate(34, stores = $$props.stores);\r\n\t\tif ('locale' in $$props) $$invalidate(2, locale = $$props.locale);\r\n\t\tif ('filterFunctions' in $$props) $$invalidate(35, filterFunctions = $$props.filterFunctions);\r\n\t\tif ('filterOptions' in $$props) $$invalidate(3, filterOptions = $$props.filterOptions);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[1] & /*$isActive*/ 262144) {\r\n\t\t\t// enable pan and zoom\r\n\t\t\tallowPan.set($isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$isActive*/ 262144) {\r\n\t\t\tallowZoom.set($isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$isActive*/ 262144) {\r\n\t\t\tenableZoomControls.set($isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*filterOptions*/ 8) {\r\n\t\t\t$$invalidate(38, filterOptionsFlattened = flattenOptions(filterOptions));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$imageColorMatrix, filterOptionsFlattened*/ 640) {\r\n\t\t\t$$invalidate(12, selectedFilterIndex = getFilterIndex($imageColorMatrix, filterOptionsFlattened));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$animation, $isActive*/ 786432) {\r\n\t\t\t$animation && footerOffset.set($isActive ? 0 : 20);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*footerRect*/ 512 | $$self.$$.dirty[1] & /*$isActive, $utilRect, $stageRectBase*/ 458752) {\r\n\t\t\tif ($isActive && $utilRect && $stageRectBase && footerRect) {\r\n\t\t\t\t$$invalidate(37, tileWrapperOffset = {\r\n\t\t\t\t\tx: $stageRectBase.x - $utilRect.x,\r\n\t\t\t\t\ty: $stageRectBase.y - $utilRect.y + footerRect.y\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*tileScrollOffset, tileScrollContainerRect, tileMargin, tileLeftOpacity, tileRightOpacity*/ 496 | $$self.$$.dirty[1] & /*$imageTransforms, tileWrapperOffset, tileCornerRadius, filterOptionsFlattened, $tileRects, $imageColorMatrix, filterFunctions, $imageGamma*/ 58096) {\r\n\t\t\tif ($imageTransforms && tileWrapperOffset && tileScrollOffset && tileScrollContainerRect && tileCornerRadius) {\r\n\t\t\t\tconst boundsX = tileWrapperOffset.x + tileScrollContainerRect.x;\r\n\t\t\t\tconst offsetX = boundsX + tileScrollOffset.x;\r\n\t\t\t\tconst offsetY = tileWrapperOffset.y;\r\n\t\t\t\tconst containerLeft = tileScrollContainerRect.x + tileWrapperOffset.x;\r\n\t\t\t\tconst containerRight = containerLeft + tileScrollContainerRect.width;\r\n\r\n\t\t\t\timageTiles.set(filterOptionsFlattened.map(([id], i) => {\r\n\t\t\t\t\tconst tileRect = $tileRects[id];\r\n\r\n\t\t\t\t\t// test if is outside of view\r\n\t\t\t\t\tconst tileLeft = tileScrollOffset.x + tileRect.x;\r\n\r\n\t\t\t\t\tconst tileRight = tileLeft + tileRect.width;\r\n\t\t\t\t\tif (tileRight < 0 || tileLeft > tileScrollContainerRect.width) return false;\r\n\t\t\t\t\tconst x = offsetX + tileRect.x;\r\n\t\t\t\t\tconst y = offsetY + tileRect.y;\r\n\t\t\t\t\tconst preview = cloneImageTransforms($imageTransforms);\r\n\t\t\t\t\tpreview.offset = vectorCreate(tileRect.width * 0.5 + x, tileRect.height * 0.5 + y);\r\n\t\t\t\t\tlet clipX = 0;\r\n\t\t\t\t\tlet clipWidth = 0;\r\n\t\t\t\t\tpreview.maskOpacity = 1;\r\n\t\t\t\t\tpreview.mask = rectCreate(x + clipX, y, tileRect.width + clipWidth, tileRect.height);\r\n\t\t\t\t\tpreview.maskFeather = [1, 0, 1, 0, 1, containerRight, 1, containerRight];\r\n\r\n\t\t\t\t\tif (tileLeft < tileMargin && tileLeftOpacity < 1) {\r\n\t\t\t\t\t\tpreview.maskFeather[0] = tileLeftOpacity;\r\n\t\t\t\t\t\tpreview.maskFeather[1] = containerLeft;\r\n\t\t\t\t\t\tpreview.maskFeather[2] = 1;\r\n\t\t\t\t\t\tpreview.maskFeather[3] = containerLeft + tileMargin;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (tileRight > tileScrollContainerRect.width - tileMargin && tileRightOpacity < 1) {\r\n\t\t\t\t\t\tpreview.maskFeather[4] = tileRightOpacity;\r\n\t\t\t\t\t\tpreview.maskFeather[5] = containerRight - tileMargin;\r\n\t\t\t\t\t\tpreview.maskFeather[6] = 1;\r\n\t\t\t\t\t\tpreview.maskFeather[7] = containerRight;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tpreview.maskCornerRadius = tileCornerRadius[id];\r\n\t\t\t\t\tlet colorMatrices = $imageColorMatrix && Object.keys($imageColorMatrix).filter(name => name != 'filter').map(name => $imageColorMatrix[name]) || [];\r\n\r\n\t\t\t\t\tif (isFunction(filterFunctions[id])) {\r\n\t\t\t\t\t\tcolorMatrices.push(filterFunctions[id]());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tpreview.colorMatrix = colorMatrices.length\r\n\t\t\t\t\t? getColorMatrixFromColorMatrices(colorMatrices)\r\n\t\t\t\t\t: undefined;\r\n\r\n\t\t\t\t\tpreview.gamma = $imageGamma;\r\n\t\t\t\t\treturn preview;\r\n\t\t\t\t}).filter(Boolean));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$isActiveFraction, $imageTiles, $footerOffset, $imagePreview*/ 7424) {\r\n\t\t\t// Will update `interfaceImages` store when\r\n\t\t\t// - $isActiveFraction is updated\r\n\t\t\t// - $imageTiles is updated\r\n\t\t\t// - $footerOffset is updated\r\n\t\t\tif ($isActiveFraction > 0 && $imageTiles) {\r\n\r\n\t\t\t\tconst images = [\r\n\t\t\t\t\t// remove filter tiles\r\n\t\t\t\t\t...filterInterfaceImages(),\r\n\t\t\t\t\t// add new filter tiles\r\n\t\t\t\t\t...$imageTiles.map(cloneImageTile)\r\n\t\t\t\t];\r\n\r\n\t\t\t\t// images\r\n\t\t\t\tinterfaceImages.set(images);\r\n\t\t\t} else {\r\n\t\t\t\tinterfaceImages.set(// remove filter tiles\r\n\t\t\t\tfilterInterfaceImages());\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$footerOffset*/ 256) {\r\n\t\t\t$$invalidate(11, footerStyle = $footerOffset\r\n\t\t\t? `transform: translateY(${$footerOffset}px)`\r\n\t\t\t: undefined);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tisActive,\r\n\t\tisActiveFraction,\r\n\t\tlocale,\r\n\t\tfilterOptions,\r\n\t\ttileLeftOpacity,\r\n\t\ttileRightOpacity,\r\n\t\ttileMargin,\r\n\t\ttileScrollOffset,\r\n\t\ttileScrollContainerRect,\r\n\t\tfooterRect,\r\n\t\ttileElements,\r\n\t\tfooterStyle,\r\n\t\tselectedFilterIndex,\r\n\t\t$elasticityMultiplier,\r\n\t\telasticityMultiplier,\r\n\t\tinterfaceImages,\r\n\t\tstageRectBase,\r\n\t\tutilRect,\r\n\t\tanimation,\r\n\t\tscrollElasticity,\r\n\t\timageSize,\r\n\t\timagePreview,\r\n\t\timageBackgroundColor,\r\n\t\timageGamma,\r\n\t\timageColorMatrix,\r\n\t\ttileRects,\r\n\t\thandleTileResize,\r\n\t\tcanvasSize,\r\n\t\timageTransforms,\r\n\t\tfooterOffset,\r\n\t\thandleTransitionEnd,\r\n\t\timageTiles,\r\n\t\thandleChangeFilter,\r\n\t\tname,\r\n\t\tstores,\r\n\t\tfilterFunctions,\r\n\t\ttileCornerRadius,\r\n\t\ttileWrapperOffset,\r\n\t\tfilterOptionsFlattened,\r\n\t\t$footerOffset,\r\n\t\t$imageColorMatrix,\r\n\t\t$imageTiles,\r\n\t\t$imagePreview,\r\n\t\t$isActiveFraction,\r\n\t\t$imageGamma,\r\n\t\t$imageTransforms,\r\n\t\t$tileRects,\r\n\t\t$utilRect,\r\n\t\t$stageRectBase,\r\n\t\t$isActive,\r\n\t\t$animation,\r\n\t\tmeasure_handler_1,\r\n\t\tdiv0_binding,\r\n\t\tfunc,\r\n\t\tscrollable_maskFeatherStartOpacity_binding,\r\n\t\tscrollable_maskFeatherEndOpacity_binding,\r\n\t\tscrollable_maskFeatherSize_binding,\r\n\t\tmeasure_handler_2,\r\n\t\tmeasure_handler_3,\r\n\t\tmeasure_handler\r\n\t];\r\n}\r\n\r\nclass Filter extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$k,\r\n\t\t\tcreate_fragment$k,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tname: 33,\r\n\t\t\t\tisActive: 0,\r\n\t\t\t\tisActiveFraction: 1,\r\n\t\t\t\tstores: 34,\r\n\t\t\t\tlocale: 2,\r\n\t\t\t\tfilterFunctions: 35,\r\n\t\t\t\tfilterOptions: 3\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1, -1]\r\n\t\t);\r\n\t}\r\n\r\n\tget name() {\r\n\t\treturn this.$$.ctx[33];\r\n\t}\r\n\r\n\tget isActive() {\r\n\t\treturn this.$$.ctx[0];\r\n\t}\r\n\r\n\tset isActive(isActive) {\r\n\t\tthis.$$set({ isActive });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget isActiveFraction() {\r\n\t\treturn this.$$.ctx[1];\r\n\t}\r\n\r\n\tset isActiveFraction(isActiveFraction) {\r\n\t\tthis.$$set({ isActiveFraction });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stores() {\r\n\t\treturn this.$$.ctx[34];\r\n\t}\r\n\r\n\tset stores(stores) {\r\n\t\tthis.$$set({ stores });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget locale() {\r\n\t\treturn this.$$.ctx[2];\r\n\t}\r\n\r\n\tset locale(locale) {\r\n\t\tthis.$$set({ locale });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget filterFunctions() {\r\n\t\treturn this.$$.ctx[35];\r\n\t}\r\n\r\n\tset filterFunctions(filterFunctions) {\r\n\t\tthis.$$set({ filterFunctions });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget filterOptions() {\r\n\t\treturn this.$$.ctx[3];\r\n\t}\r\n\r\n\tset filterOptions(filterOptions) {\r\n\t\tthis.$$set({ filterOptions });\r\n\t\tflush();\r\n\t}\r\n}\r\n\r\n// @ts-ignore\r\nvar _plugin_filter = { util: ['filter', Filter] };\r\n\r\n/* src/core/ui/plugins/finetune/index.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_default_slot_2$1(ctx) {\r\n\tlet span;\r\n\tlet t_value = /*tab*/ ctx[42].label + \"\";\r\n\tlet t;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt = text(t_value);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t\tappend(span, t);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[1] & /*tab*/ 2048 && t_value !== (t_value = /*tab*/ ctx[42].label + \"\")) set_data(t, t_value);\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (160:8) <Scrollable             elasticity={$elasticityMultiplier * scrollElasticity}             class=\"PinturaControlListScroller\"         >\r\nfunction create_default_slot_1$2(ctx) {\r\n\tlet tablist;\r\n\tlet current;\r\n\r\n\tconst tablist_spread_levels = [\r\n\t\t{ class: \"PinturaControlList\" },\r\n\t\t{ tabs: /*tabs*/ ctx[1] },\r\n\t\t/*tabsConfig*/ ctx[5]\r\n\t];\r\n\r\n\tlet tablist_props = {\r\n\t\t$$slots: {\r\n\t\t\tdefault: [\r\n\t\t\t\tcreate_default_slot_2$1,\r\n\t\t\t\t({ tab }) => ({ 42: tab }),\r\n\t\t\t\t({ tab }) => [0, tab ? 2048 : 0]\r\n\t\t\t]\r\n\t\t},\r\n\t\t$$scope: { ctx }\r\n\t};\r\n\r\n\tfor (let i = 0; i < tablist_spread_levels.length; i += 1) {\r\n\t\ttablist_props = assign(tablist_props, tablist_spread_levels[i]);\r\n\t}\r\n\r\n\ttablist = new TabList({ props: tablist_props });\r\n\ttablist.$on(\"select\", /*select_handler*/ ctx[24]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(tablist.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(tablist, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst tablist_changes = (dirty[0] & /*tabs, tabsConfig*/ 34)\r\n\t\t\t? get_spread_update(tablist_spread_levels, [\r\n\t\t\t\t\ttablist_spread_levels[0],\r\n\t\t\t\t\tdirty[0] & /*tabs*/ 2 && { tabs: /*tabs*/ ctx[1] },\r\n\t\t\t\t\tdirty[0] & /*tabsConfig*/ 32 && get_spread_object(/*tabsConfig*/ ctx[5])\r\n\t\t\t\t])\r\n\t\t\t: {};\r\n\r\n\t\t\tif (dirty[1] & /*$$scope, tab*/ 6144) {\r\n\t\t\t\ttablist_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ttablist.$set(tablist_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(tablist.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(tablist.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(tablist, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (175:8) <TabPanels             class=\"PinturaControlPanels\"             panelClass=\"PinturaControlPanel\"             {panels}             {...tabsConfig}             let:panel         >\r\nfunction create_default_slot$7(ctx) {\r\n\tlet rangeinput;\r\n\tlet current;\r\n\tconst rangeinput_spread_levels = [/*$rangeInputConfig*/ ctx[7][/*panel*/ ctx[41]]];\r\n\tlet rangeinput_props = {};\r\n\r\n\tfor (let i = 0; i < rangeinput_spread_levels.length; i += 1) {\r\n\t\trangeinput_props = assign(rangeinput_props, rangeinput_spread_levels[i]);\r\n\t}\r\n\r\n\trangeinput = new RangeInput({ props: rangeinput_props });\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(rangeinput.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(rangeinput, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst rangeinput_changes = (dirty[0] & /*$rangeInputConfig*/ 128 | dirty[1] & /*panel*/ 1024)\r\n\t\t\t? get_spread_update(rangeinput_spread_levels, [get_spread_object(/*$rangeInputConfig*/ ctx[7][/*panel*/ ctx[41]])])\r\n\t\t\t: {};\r\n\r\n\t\t\trangeinput.$set(rangeinput_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(rangeinput.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(rangeinput.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(rangeinput, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (159:4) \r\nfunction create_footer_slot$3(ctx) {\r\n\tlet div;\r\n\tlet scrollable;\r\n\tlet t;\r\n\tlet tabpanels;\r\n\tlet current;\r\n\r\n\tscrollable = new Scrollable({\r\n\t\t\tprops: {\r\n\t\t\t\telasticity: /*$elasticityMultiplier*/ ctx[6] * /*scrollElasticity*/ ctx[9],\r\n\t\t\t\tclass: \"PinturaControlListScroller\",\r\n\t\t\t\t$$slots: { default: [create_default_slot_1$2] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tconst tabpanels_spread_levels = [\r\n\t\t{ class: \"PinturaControlPanels\" },\r\n\t\t{ panelClass: \"PinturaControlPanel\" },\r\n\t\t{ panels: /*panels*/ ctx[4] },\r\n\t\t/*tabsConfig*/ ctx[5]\r\n\t];\r\n\r\n\tlet tabpanels_props = {\r\n\t\t$$slots: {\r\n\t\t\tdefault: [\r\n\t\t\t\tcreate_default_slot$7,\r\n\t\t\t\t({ panel }) => ({ 41: panel }),\r\n\t\t\t\t({ panel }) => [0, panel ? 1024 : 0]\r\n\t\t\t]\r\n\t\t},\r\n\t\t$$scope: { ctx }\r\n\t};\r\n\r\n\tfor (let i = 0; i < tabpanels_spread_levels.length; i += 1) {\r\n\t\ttabpanels_props = assign(tabpanels_props, tabpanels_spread_levels[i]);\r\n\t}\r\n\r\n\ttabpanels = new TabPanels({ props: tabpanels_props });\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tcreate_component(scrollable.$$.fragment);\r\n\t\t\tt = space();\r\n\t\t\tcreate_component(tabpanels.$$.fragment);\r\n\t\t\tattr(div, \"slot\", \"footer\");\r\n\t\t\tattr(div, \"style\", /*footerStyle*/ ctx[3]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tmount_component(scrollable, div, null);\r\n\t\t\tappend(div, t);\r\n\t\t\tmount_component(tabpanels, div, null);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst scrollable_changes = {};\r\n\t\t\tif (dirty[0] & /*$elasticityMultiplier*/ 64) scrollable_changes.elasticity = /*$elasticityMultiplier*/ ctx[6] * /*scrollElasticity*/ ctx[9];\r\n\r\n\t\t\tif (dirty[0] & /*tabs, tabsConfig, tabSelected*/ 38 | dirty[1] & /*$$scope*/ 4096) {\r\n\t\t\t\tscrollable_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tscrollable.$set(scrollable_changes);\r\n\r\n\t\t\tconst tabpanels_changes = (dirty[0] & /*panels, tabsConfig*/ 48)\r\n\t\t\t? get_spread_update(tabpanels_spread_levels, [\r\n\t\t\t\t\ttabpanels_spread_levels[0],\r\n\t\t\t\t\ttabpanels_spread_levels[1],\r\n\t\t\t\t\tdirty[0] & /*panels*/ 16 && { panels: /*panels*/ ctx[4] },\r\n\t\t\t\t\tdirty[0] & /*tabsConfig*/ 32 && get_spread_object(/*tabsConfig*/ ctx[5])\r\n\t\t\t\t])\r\n\t\t\t: {};\r\n\r\n\t\t\tif (dirty[0] & /*$rangeInputConfig*/ 128 | dirty[1] & /*$$scope, panel*/ 5120) {\r\n\t\t\t\ttabpanels_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ttabpanels.$set(tabpanels_changes);\r\n\r\n\t\t\tif (!current || dirty[0] & /*footerStyle*/ 8) {\r\n\t\t\t\tattr(div, \"style\", /*footerStyle*/ ctx[3]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(scrollable.$$.fragment, local);\r\n\t\t\ttransition_in(tabpanels.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(scrollable.$$.fragment, local);\r\n\t\t\ttransition_out(tabpanels.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tdestroy_component(scrollable);\r\n\t\t\tdestroy_component(tabpanels);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$j(ctx) {\r\n\tlet util;\r\n\tlet current;\r\n\r\n\tutil = new Util({\r\n\t\t\tprops: {\r\n\t\t\t\t$$slots: { footer: [create_footer_slot$3] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tutil.$on(\"measure\", /*measure_handler*/ ctx[25]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(util.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(util, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst util_changes = {};\r\n\r\n\t\t\tif (dirty[0] & /*footerStyle, panels, tabsConfig, $rangeInputConfig, $elasticityMultiplier, tabs, tabSelected*/ 254 | dirty[1] & /*$$scope*/ 4096) {\r\n\t\t\t\tutil_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tutil.$set(util_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(util.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(util.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(util, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$j($$self, $$props, $$invalidate) {\r\n\tlet tabs;\r\n\tlet tabSelected;\r\n\tlet tabsConfig;\r\n\tlet panels;\r\n\tlet footerStyle;\r\n\tlet $footerOffset;\r\n\r\n\tlet $isActive,\r\n\t\t$$unsubscribe_isActive = noop,\r\n\t\t$$subscribe_isActive = () => ($$unsubscribe_isActive(), $$unsubscribe_isActive = subscribe(isActive, $$value => $$invalidate(21, $isActive = $$value)), isActive);\r\n\r\n\tlet $animation;\r\n\tlet $panelValues;\r\n\tlet $elasticityMultiplier;\r\n\tlet $rangeInputConfig;\r\n\t$$self.$$.on_destroy.push(() => $$unsubscribe_isActive());\r\n\tconst name = 'finetune';\r\n\tlet { stores } = $$props;\r\n\tlet { isActive } = $$props;\r\n\t$$subscribe_isActive();\r\n\tlet { locale = {} } = $$props;\r\n\tlet { finetuneControlConfiguration } = $$props;\r\n\tlet { finetuneOptions } = $$props;\r\n\tlet { finetuneNudgePrecision = undefined } = $$props;\r\n\tconst { history, animation, scrollElasticity, rangeInputElasticity, imageColorMatrix, imageConvolutionMatrix, imageGamma, imageVignette, imageNoise, allowPan, allowZoom, enableZoomControls } = stores;\r\n\tcomponent_subscribe($$self, animation, value => $$invalidate(22, $animation = value));\r\n\r\n\tconst imageEffectStores = {\r\n\t\timageColorMatrix,\r\n\t\timageConvolutionMatrix,\r\n\t\timageGamma,\r\n\t\timageVignette,\r\n\t\timageNoise\r\n\t};\r\n\r\n\t//\r\n\t// context\r\n\t//\r\n\tconst elasticityMultiplier = getContext('elasticityMultiplier');\r\n\r\n\tcomponent_subscribe($$self, elasticityMultiplier, value => $$invalidate(6, $elasticityMultiplier = value));\r\n\r\n\t//\r\n\t// Tabs\r\n\t//\r\n\tconst uid = `finetune-${getUniqueId()}`;\r\n\r\n\t//\r\n\t// Range inputs\r\n\t//\r\n\tconst panelValues = writable({});\r\n\r\n\tcomponent_subscribe($$self, panelValues, value => $$invalidate(23, $panelValues = value));\r\n\tconst rangeInputConfig = writable({});\r\n\tcomponent_subscribe($$self, rangeInputConfig, value => $$invalidate(7, $rangeInputConfig = value));\r\n\r\n\tconst updateRangeInputState = () => {\r\n\t\tset_store_value(\r\n\t\t\trangeInputConfig,\r\n\t\t\t$rangeInputConfig = Object.keys($panelValues).reduce(\r\n\t\t\t\t(config, id) => {\r\n\t\t\t\t\tconst { base, min, max, getLabel, getStore, setValue = (store, v) => store.set(v) } = finetuneControlConfiguration[id];\r\n\t\t\t\t\tconst store = getStore(imageEffectStores);\r\n\t\t\t\t\tconst value = $panelValues[id] != null ? $panelValues[id] : base;\r\n\r\n\t\t\t\t\tconfig[id] = {\r\n\t\t\t\t\t\tbase,\r\n\t\t\t\t\t\tmin,\r\n\t\t\t\t\t\tmax,\r\n\t\t\t\t\t\tvalue,\r\n\t\t\t\t\t\tvalueLabel: getLabel\r\n\t\t\t\t\t\t? getLabel(value, min, max, max - min)\r\n\t\t\t\t\t\t: Math.round(100 * value),\r\n\t\t\t\t\t\toninputmove: v => {\r\n\t\t\t\t\t\t\tsetValue(store, v);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\toninputend: v => {\r\n\t\t\t\t\t\t\tsetValue(store, v);\r\n\t\t\t\t\t\t\thistory.write();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\telasticity: $elasticityMultiplier * rangeInputElasticity,\r\n\t\t\t\t\t\tlabelReset: locale.labelReset,\r\n\t\t\t\t\t\tnudgeMultiplier: finetuneNudgePrecision\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\treturn config;\r\n\t\t\t\t},\r\n\t\t\t\t{}\r\n\t\t\t),\r\n\t\t\t$rangeInputConfig\r\n\t\t);\r\n\t};\r\n\r\n\t// need to unsubscribe when redrawing vie\r\n\tlet unsubs = [];\r\n\r\n\tconst subscribePanelStores = config => {\r\n\t\tif (unsubs) unsubs.forEach(unsub => unsub());\r\n\r\n\t\tunsubs = panels.map(id => {\r\n\t\t\tconst { getStore, getValue = passthrough } = config[id];\r\n\t\t\tconst store = getStore(imageEffectStores);\r\n\r\n\t\t\treturn store.subscribe(value => {\r\n\t\t\t\tconst currentValue = value != null ? getValue(value) : value;\r\n\t\t\t\tset_store_value(panelValues, $panelValues = { ...$panelValues, [id]: currentValue }, $panelValues);\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\t//\r\n\t// Footer\r\n\t//\r\n\tconst footerOffset = spring($animation ? 20 : 0);\r\n\r\n\tcomponent_subscribe($$self, footerOffset, value => $$invalidate(20, $footerOffset = value));\r\n\tconst select_handler = ({ detail }) => $$invalidate(2, tabSelected = detail);\r\n\r\n\tfunction measure_handler(event) {\r\n\t\tbubble.call(this, $$self, event);\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('stores' in $$props) $$invalidate(15, stores = $$props.stores);\r\n\t\tif ('isActive' in $$props) $$subscribe_isActive($$invalidate(0, isActive = $$props.isActive));\r\n\t\tif ('locale' in $$props) $$invalidate(16, locale = $$props.locale);\r\n\t\tif ('finetuneControlConfiguration' in $$props) $$invalidate(17, finetuneControlConfiguration = $$props.finetuneControlConfiguration);\r\n\t\tif ('finetuneOptions' in $$props) $$invalidate(18, finetuneOptions = $$props.finetuneOptions);\r\n\t\tif ('finetuneNudgePrecision' in $$props) $$invalidate(19, finetuneNudgePrecision = $$props.finetuneNudgePrecision);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 2097152) {\r\n\t\t\t// enable pan and zoom\r\n\t\t\tallowPan.set($isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 2097152) {\r\n\t\t\tallowZoom.set($isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 2097152) {\r\n\t\t\tenableZoomControls.set($isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*finetuneOptions, locale*/ 327680) {\r\n\t\t\t$$invalidate(1, tabs = finetuneOptions\r\n\t\t\t? finetuneOptions.map(([id, label]) => ({\r\n\t\t\t\t\tid,\r\n\t\t\t\t\tlabel: isFunction(label) ? label(locale) : label\r\n\t\t\t\t}))\r\n\t\t\t: []);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*tabs*/ 2) {\r\n\t\t\t$$invalidate(2, tabSelected = tabs.length && tabs[0].id);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*tabSelected*/ 4) {\r\n\t\t\t$$invalidate(5, tabsConfig = { name: uid, selected: tabSelected });\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*tabs*/ 2) {\r\n\t\t\t$$invalidate(4, panels = tabs.map(tab => tab.id));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*finetuneControlConfiguration*/ 131072) {\r\n\t\t\tfinetuneControlConfiguration && subscribePanelStores(finetuneControlConfiguration);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*finetuneControlConfiguration, $panelValues*/ 8519680) {\r\n\t\t\tfinetuneControlConfiguration && $panelValues && updateRangeInputState();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$animation, $isActive*/ 6291456) {\r\n\t\t\t$animation && footerOffset.set($isActive ? 0 : 20);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$footerOffset*/ 1048576) {\r\n\t\t\t$$invalidate(3, footerStyle = $footerOffset\r\n\t\t\t? `transform: translateY(${$footerOffset}px)`\r\n\t\t\t: undefined);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tisActive,\r\n\t\ttabs,\r\n\t\ttabSelected,\r\n\t\tfooterStyle,\r\n\t\tpanels,\r\n\t\ttabsConfig,\r\n\t\t$elasticityMultiplier,\r\n\t\t$rangeInputConfig,\r\n\t\tanimation,\r\n\t\tscrollElasticity,\r\n\t\telasticityMultiplier,\r\n\t\tpanelValues,\r\n\t\trangeInputConfig,\r\n\t\tfooterOffset,\r\n\t\tname,\r\n\t\tstores,\r\n\t\tlocale,\r\n\t\tfinetuneControlConfiguration,\r\n\t\tfinetuneOptions,\r\n\t\tfinetuneNudgePrecision,\r\n\t\t$footerOffset,\r\n\t\t$isActive,\r\n\t\t$animation,\r\n\t\t$panelValues,\r\n\t\tselect_handler,\r\n\t\tmeasure_handler\r\n\t];\r\n}\r\n\r\nclass Finetune extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$j,\r\n\t\t\tcreate_fragment$j,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tname: 14,\r\n\t\t\t\tstores: 15,\r\n\t\t\t\tisActive: 0,\r\n\t\t\t\tlocale: 16,\r\n\t\t\t\tfinetuneControlConfiguration: 17,\r\n\t\t\t\tfinetuneOptions: 18,\r\n\t\t\t\tfinetuneNudgePrecision: 19\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1]\r\n\t\t);\r\n\t}\r\n\r\n\tget name() {\r\n\t\treturn this.$$.ctx[14];\r\n\t}\r\n\r\n\tget stores() {\r\n\t\treturn this.$$.ctx[15];\r\n\t}\r\n\r\n\tset stores(stores) {\r\n\t\tthis.$$set({ stores });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget isActive() {\r\n\t\treturn this.$$.ctx[0];\r\n\t}\r\n\r\n\tset isActive(isActive) {\r\n\t\tthis.$$set({ isActive });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget locale() {\r\n\t\treturn this.$$.ctx[16];\r\n\t}\r\n\r\n\tset locale(locale) {\r\n\t\tthis.$$set({ locale });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget finetuneControlConfiguration() {\r\n\t\treturn this.$$.ctx[17];\r\n\t}\r\n\r\n\tset finetuneControlConfiguration(finetuneControlConfiguration) {\r\n\t\tthis.$$set({ finetuneControlConfiguration });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget finetuneOptions() {\r\n\t\treturn this.$$.ctx[18];\r\n\t}\r\n\r\n\tset finetuneOptions(finetuneOptions) {\r\n\t\tthis.$$set({ finetuneOptions });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget finetuneNudgePrecision() {\r\n\t\treturn this.$$.ctx[19];\r\n\t}\r\n\r\n\tset finetuneNudgePrecision(finetuneNudgePrecision) {\r\n\t\tthis.$$set({ finetuneNudgePrecision });\r\n\t\tflush();\r\n\t}\r\n}\r\n\r\n// @ts-ignore\r\nvar _plugin_finetune = { util: ['finetune', Finetune] };\r\n\r\nvar arrayIndexWrap = (index, arr) => {\r\n    const l = arr.length;\r\n    if (index < 0)\r\n        return (index % l) + l;\r\n    if (index >= l)\r\n        return index % l;\r\n    return index;\r\n};\r\n\r\n/* src/core/ui/components/ShapeManipulator.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction get_each_context$4(ctx, list, i) {\r\n\tconst child_ctx = ctx.slice();\r\n\tchild_ctx[48] = list[i].key;\r\n\tchild_ctx[49] = list[i].index;\r\n\tchild_ctx[50] = list[i].translate;\r\n\tchild_ctx[51] = list[i].scale;\r\n\tchild_ctx[14] = list[i].rotate;\r\n\tchild_ctx[52] = list[i].dir;\r\n\tchild_ctx[53] = list[i].center;\r\n\tchild_ctx[54] = list[i].type;\r\n\tchild_ctx[2] = list[i].visible;\r\n\treturn child_ctx;\r\n}\r\n\r\n// (259:4) {#if type === 'edge' && visible}\r\nfunction create_if_block_1$3(ctx) {\r\n\tlet div;\r\n\tlet div_style_value;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tattr(div, \"class\", \"PinturaShapeManipulator\");\r\n\t\t\tattr(div, \"data-control\", \"point\");\r\n\t\t\tattr(div, \"style\", div_style_value = `pointer-events:none;transform: translate3d(${/*center*/ ctx[53].x}px, ${/*center*/ ctx[53].y}px, 0) scale(${/*$selectionScale*/ ctx[4]}, ${/*$selectionScale*/ ctx[4]}); opacity: ${/*$selectionOpacity*/ ctx[5]}`);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[0] & /*resizeControls, $selectionScale, $selectionOpacity*/ 56 && div_style_value !== (div_style_value = `pointer-events:none;transform: translate3d(${/*center*/ ctx[53].x}px, ${/*center*/ ctx[53].y}px, 0) scale(${/*$selectionScale*/ ctx[4]}, ${/*$selectionScale*/ ctx[4]}); opacity: ${/*$selectionOpacity*/ ctx[5]}`)) {\r\n\t\t\t\tattr(div, \"style\", div_style_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (238:0) {#each resizeControls as { key, index, translate, scale, rotate, dir, center, type, visible }\r\nfunction create_each_block$4(key_1, ctx) {\r\n\tlet div;\r\n\tlet div_aria_label_value;\r\n\tlet div_tabindex_value;\r\n\tlet div_data_control_value;\r\n\tlet div_style_value;\r\n\tlet t;\r\n\tlet if_block_anchor;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\tfunction nudge_handler(...args) {\r\n\t\treturn /*nudge_handler*/ ctx[19](/*index*/ ctx[49], ...args);\r\n\t}\r\n\r\n\tlet if_block = /*type*/ ctx[54] === 'edge' && /*visible*/ ctx[2] && create_if_block_1$3(ctx);\r\n\r\n\treturn {\r\n\t\tkey: key_1,\r\n\t\tfirst: null,\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tt = space();\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tif_block_anchor = empty();\r\n\t\t\tattr(div, \"role\", \"button\");\r\n\t\t\tattr(div, \"aria-label\", div_aria_label_value = `Drag ${/*type*/ ctx[54]} ${/*key*/ ctx[48]}`);\r\n\t\t\tattr(div, \"tabindex\", div_tabindex_value = /*type*/ ctx[54] === 'edge' ? -1 : 0);\r\n\t\t\tattr(div, \"class\", \"PinturaShapeManipulator\");\r\n\t\t\tattr(div, \"data-control\", div_data_control_value = /*type*/ ctx[54]);\r\n\r\n\t\t\tattr(div, \"style\", div_style_value = `cursor: ${/*dir*/ ctx[52] ? /*dir*/ ctx[52] + '-resize' : 'move'}; transform: translate3d(${/*translate*/ ctx[50].x}px, ${/*translate*/ ctx[50].y}px, 0)${/*type*/ ctx[54] === 'edge'\r\n\t\t\t? ` rotate(${/*rotate*/ ctx[14]}rad)`\r\n\t\t\t: ''} scale(${/*type*/ ctx[54] === 'point'\r\n\t\t\t? /*$selectionScale*/ ctx[4]\r\n\t\t\t: /*scale*/ ctx[51].x}, ${/*type*/ ctx[54] === 'point'\r\n\t\t\t? /*$selectionScale*/ ctx[4]\r\n\t\t\t: /*scale*/ ctx[51].y}); opacity: ${/*$selectionOpacity*/ ctx[5]}`);\r\n\r\n\t\t\tthis.first = div;\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tinsert(target, t, anchor);\r\n\t\t\tif (if_block) if_block.m(target, anchor);\r\n\t\t\tinsert(target, if_block_anchor, anchor);\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(div, \"keydown\", /*handleKeyDown*/ ctx[7]),\r\n\t\t\t\t\tlisten(div, \"keyup\", /*handleKeyUp*/ ctx[8]),\r\n\t\t\t\t\tlisten(div, \"nudge\", nudge_handler),\r\n\t\t\t\t\taction_destroyer(nudgeable.call(null, div, { preventDefault: true })),\r\n\t\t\t\t\tlisten(div, \"interactionstart\", function () {\r\n\t\t\t\t\t\tif (is_function(/*resize*/ ctx[11]('start', /*index*/ ctx[49]))) /*resize*/ ctx[11]('start', /*index*/ ctx[49]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(div, \"interactionupdate\", function () {\r\n\t\t\t\t\t\tif (is_function(/*resize*/ ctx[11]('move', /*index*/ ctx[49]))) /*resize*/ ctx[11]('move', /*index*/ ctx[49]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(div, \"interactionend\", function () {\r\n\t\t\t\t\t\tif (is_function(/*resize*/ ctx[11]('end', /*index*/ ctx[49]))) /*resize*/ ctx[11]('end', /*index*/ ctx[49]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\taction_destroyer(interactable.call(null, div))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\r\n\t\t\tif (dirty[0] & /*resizeControls*/ 8 && div_aria_label_value !== (div_aria_label_value = `Drag ${/*type*/ ctx[54]} ${/*key*/ ctx[48]}`)) {\r\n\t\t\t\tattr(div, \"aria-label\", div_aria_label_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty[0] & /*resizeControls*/ 8 && div_tabindex_value !== (div_tabindex_value = /*type*/ ctx[54] === 'edge' ? -1 : 0)) {\r\n\t\t\t\tattr(div, \"tabindex\", div_tabindex_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty[0] & /*resizeControls*/ 8 && div_data_control_value !== (div_data_control_value = /*type*/ ctx[54])) {\r\n\t\t\t\tattr(div, \"data-control\", div_data_control_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty[0] & /*resizeControls, $selectionScale, $selectionOpacity*/ 56 && div_style_value !== (div_style_value = `cursor: ${/*dir*/ ctx[52] ? /*dir*/ ctx[52] + '-resize' : 'move'}; transform: translate3d(${/*translate*/ ctx[50].x}px, ${/*translate*/ ctx[50].y}px, 0)${/*type*/ ctx[54] === 'edge'\r\n\t\t\t? ` rotate(${/*rotate*/ ctx[14]}rad)`\r\n\t\t\t: ''} scale(${/*type*/ ctx[54] === 'point'\r\n\t\t\t? /*$selectionScale*/ ctx[4]\r\n\t\t\t: /*scale*/ ctx[51].x}, ${/*type*/ ctx[54] === 'point'\r\n\t\t\t? /*$selectionScale*/ ctx[4]\r\n\t\t\t: /*scale*/ ctx[51].y}); opacity: ${/*$selectionOpacity*/ ctx[5]}`)) {\r\n\t\t\t\tattr(div, \"style\", div_style_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (/*type*/ ctx[54] === 'edge' && /*visible*/ ctx[2]) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block_1$3(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\tif_block.m(if_block_anchor.parentNode, if_block_anchor);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tif_block.d(1);\r\n\t\t\t\tif_block = null;\r\n\t\t\t}\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif (detaching) detach(t);\r\n\t\t\tif (if_block) if_block.d(detaching);\r\n\t\t\tif (detaching) detach(if_block_anchor);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (269:0) {#if enableRotatePoints}\r\nfunction create_if_block$3(ctx) {\r\n\tlet div;\r\n\tlet div_style_value;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tattr(div, \"role\", \"button\");\r\n\t\t\tattr(div, \"aria-label\", \"Drag rotator\");\r\n\t\t\tattr(div, \"tabindex\", \"0\");\r\n\t\t\tattr(div, \"class\", \"PinturaShapeManipulator\");\r\n\t\t\tattr(div, \"data-control\", \"rotate\");\r\n\t\t\tattr(div, \"style\", div_style_value = `transform: translate3d(${/*rotatorPoint*/ ctx[0].x}px, ${/*rotatorPoint*/ ctx[0].y}px, 0) scale(${/*$selectionScale*/ ctx[4]}, ${/*$selectionScale*/ ctx[4]}); opacity: ${/*$selectionOpacity*/ ctx[5]}`);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(div, \"keydown\", /*handleKeyDown*/ ctx[7]),\r\n\t\t\t\t\tlisten(div, \"keyup\", /*handleKeyUp*/ ctx[8]),\r\n\t\t\t\t\tlisten(div, \"nudge\", /*handleRotateNudge*/ ctx[13]),\r\n\t\t\t\t\taction_destroyer(nudgeable.call(null, div, { preventDefault: true })),\r\n\t\t\t\t\tlisten(div, \"interactionstart\", /*rotate*/ ctx[14]('start')),\r\n\t\t\t\t\tlisten(div, \"interactionupdate\", /*rotate*/ ctx[14]('move')),\r\n\t\t\t\t\tlisten(div, \"interactionend\", /*rotate*/ ctx[14]('end')),\r\n\t\t\t\t\taction_destroyer(interactable.call(null, div))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[0] & /*rotatorPoint, $selectionScale, $selectionOpacity*/ 49 && div_style_value !== (div_style_value = `transform: translate3d(${/*rotatorPoint*/ ctx[0].x}px, ${/*rotatorPoint*/ ctx[0].y}px, 0) scale(${/*$selectionScale*/ ctx[4]}, ${/*$selectionScale*/ ctx[4]}); opacity: ${/*$selectionOpacity*/ ctx[5]}`)) {\r\n\t\t\t\tattr(div, \"style\", div_style_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$i(ctx) {\r\n\tlet each_blocks = [];\r\n\tlet each_1_lookup = new Map();\r\n\tlet t;\r\n\tlet if_block_anchor;\r\n\tlet each_value = /*resizeControls*/ ctx[3];\r\n\tconst get_key = ctx => /*key*/ ctx[48];\r\n\r\n\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\tlet child_ctx = get_each_context$4(ctx, each_value, i);\r\n\t\tlet key = get_key(child_ctx);\r\n\t\teach_1_lookup.set(key, each_blocks[i] = create_each_block$4(key, child_ctx));\r\n\t}\r\n\r\n\tlet if_block = /*enableRotatePoints*/ ctx[1] && create_if_block$3(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].c();\r\n\t\t\t}\r\n\r\n\t\t\tt = space();\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tif_block_anchor = empty();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].m(target, anchor);\r\n\t\t\t}\r\n\r\n\t\t\tinsert(target, t, anchor);\r\n\t\t\tif (if_block) if_block.m(target, anchor);\r\n\t\t\tinsert(target, if_block_anchor, anchor);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[0] & /*resizeControls, $selectionScale, $selectionOpacity, handleKeyDown, handleKeyUp, handleResizeNudge, resize*/ 6584) {\r\n\t\t\t\teach_value = /*resizeControls*/ ctx[3];\r\n\t\t\t\teach_blocks = update_keyed_each(each_blocks, dirty, get_key, 1, ctx, each_value, each_1_lookup, t.parentNode, destroy_block, create_each_block$4, t, get_each_context$4);\r\n\t\t\t}\r\n\r\n\t\t\tif (/*enableRotatePoints*/ ctx[1]) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block$3(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\tif_block.m(if_block_anchor.parentNode, if_block_anchor);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tif_block.d(1);\r\n\t\t\t\tif_block = null;\r\n\t\t\t}\r\n\t\t},\r\n\t\ti: noop,\r\n\t\to: noop,\r\n\t\td(detaching) {\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].d(detaching);\r\n\t\t\t}\r\n\r\n\t\t\tif (detaching) detach(t);\r\n\t\t\tif (if_block) if_block.d(detaching);\r\n\t\t\tif (detaching) detach(if_block_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$i($$self, $$props, $$invalidate) {\r\n\tlet resizeControls;\r\n\tlet $isAnimated;\r\n\tlet $selectionScale;\r\n\tlet $selectionOpacity;\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\t// which cursor to render\r\n\tconst EIGTH_PI = QUART_PI * 0.5;\r\n\r\n\tconst N = HALF_PI;\r\n\tconst N0 = N - EIGTH_PI;\r\n\tconst N1 = N + EIGTH_PI;\r\n\tconst S = -HALF_PI;\r\n\tconst S0 = S - EIGTH_PI;\r\n\tconst S1 = S + EIGTH_PI;\r\n\tconst E = PI;\r\n\tconst E0 = E - EIGTH_PI;\r\n\tconst E1 = -PI + EIGTH_PI;\r\n\tconst W0 = EIGTH_PI;\r\n\tconst W1 = -EIGTH_PI;\r\n\tconst NW = N - QUART_PI;\r\n\tconst NW0 = NW - EIGTH_PI;\r\n\tconst NW1 = NW + EIGTH_PI;\r\n\tconst NE = PI - QUART_PI;\r\n\tconst NE0 = NE - EIGTH_PI;\r\n\tconst NE1 = NE + EIGTH_PI;\r\n\tconst SE = S - QUART_PI;\r\n\tconst SE0 = SE + EIGTH_PI;\r\n\tconst SE1 = SE - EIGTH_PI;\r\n\tconst SW = S + QUART_PI;\r\n\tconst SW0 = SW + EIGTH_PI;\r\n\tconst SW1 = SW - EIGTH_PI;\r\n\tlet { visible = false } = $$props;\r\n\tlet { points = [] } = $$props;\r\n\tlet { rotatorPoint = undefined } = $$props;\r\n\tlet { enableDragEdges = true } = $$props;\r\n\tlet { enableDragPoints = true } = $$props;\r\n\tlet { enableRotatePoints = true } = $$props;\r\n\r\n\t// contex\r\n\tconst isAnimated = getContext('isAnimated');\r\n\r\n\tcomponent_subscribe($$self, isAnimated, value => $$invalidate(18, $isAnimated = value));\r\n\r\n\t// internal\r\n\tlet shiftKey = false;\r\n\r\n\tconst handleKeyDown = e => shiftKey = e.shiftKey;\r\n\tconst handleKeyUp = e => shiftKey = false;\r\n\r\n\t// state\r\n\tconst selectionScale = spring(0.5, {\r\n\t\tprecision: 0.0001,\r\n\t\tstiffness: 0.3,\r\n\t\tdamping: 0.7\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, selectionScale, value => $$invalidate(4, $selectionScale = value));\r\n\r\n\tconst selectionOpacity = spring(0, {\r\n\t\tprecision: 0.001,\r\n\t\tstiffness: 0.3,\r\n\t\tdamping: 0.7\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, selectionOpacity, value => $$invalidate(5, $selectionOpacity = value));\r\n\r\n\tconst rotate = type => ({ detail }) => {\r\n\t\t// always make sure we have a translation to work with\r\n\t\tconst translation = detail && detail.translation\r\n\t\t? detail.translation\r\n\t\t: vectorCreate(0, 0);\r\n\r\n\t\tdispatch(`rotate${type}`, { translation, shiftKey });\r\n\t};\r\n\r\n\tconst resize = (type, indexes) => ({ detail }) => {\r\n\t\t// always make sure we have a translation to work with\r\n\t\tconst translation = detail && detail.translation\r\n\t\t? detail.translation\r\n\t\t: vectorCreate(0, 0);\r\n\r\n\t\t// done transforming the points\r\n\t\tdispatch(`resize${type}`, {\r\n\t\t\t...detail,\r\n\t\t\tindexes,\r\n\t\t\ttranslation,\r\n\t\t\tshiftKey\r\n\t\t});\r\n\t};\r\n\r\n\t// https://en.wikipedia.org/wiki/Radian#/media/File:Degree-Radian_Conversion.svg\r\n\tconst getDirectionByAngle = angle => {\r\n\t\tlet dir = '';\r\n\t\tconst isNorth = angle <= N1 && angle >= N0;\r\n\t\tconst isSouth = angle >= S0 && angle <= S1;\r\n\t\tconst isEast = angle <= E1 || angle >= E0;\r\n\t\tconst isWest = angle >= W1 && angle <= W0;\r\n\t\tconst isNorthEast = angle >= NE0 && angle <= NE1;\r\n\t\tconst isNorthWest = angle >= NW0 && angle <= NW1;\r\n\t\tconst isSouthEast = angle <= SE0 && angle >= SE1;\r\n\t\tconst isSouthWest = angle <= SW0 && angle >= SW1;\r\n\t\tif (isNorth || isSouth) dir = 'ns';\r\n\t\tif (isEast || isWest) dir = 'ew';\r\n\t\tif (isNorthEast || isSouthWest) dir = 'nesw';\r\n\t\tif (isNorthWest || isSouthEast) dir = 'nwse';\r\n\t\treturn dir;\r\n\t};\r\n\r\n\t// 2 points -> [corner, corner]\r\n\t// 3 points => [corner, edge, corner, edge, corner, edge],\r\n\t// 4 points => [corner, edge, corner, edge, corner, edge, corner, edge]\r\n\tconst mapPointsToControls = (points, axis) => {\r\n\t\tlet i = 0;\r\n\t\tconst center = vectorCenter(points);\r\n\t\tconst out = [];\r\n\t\tconst l = points.length;\r\n\r\n\t\t// const isLine = l === 2 || l > 4;\r\n\t\t// const isAxisLimited = axis !== 'both';\r\n\t\tfor (; i < l; i++) {\r\n\t\t\tconst i0 = arrayIndexWrap(i - 1, points);\r\n\r\n\t\t\t// const i1 = i;\r\n\t\t\tconst i2 = arrayIndexWrap(i + 1, points);\r\n\r\n\t\t\tconst p0 = points[i0];\r\n\t\t\tconst p1 = points[i];\r\n\t\t\tconst p2 = points[i2];\r\n\t\t\tconst dir = Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n\r\n\t\t\t// can drag vertices\r\n\t\t\tif (enableDragPoints) {\r\n\t\t\t\tconst a = vectorNormalize(vectorCreate(p0.x - p1.x, p0.y - p1.y));\r\n\t\t\t\tconst b = vectorNormalize(vectorCreate(p2.x - p1.x, p2.y - p1.y));\r\n\t\t\t\tconst cornerVector = vectorCreate(a.x + b.x, a.y + b.y);\r\n\r\n\t\t\t\tconst dir = !enableDragEdges\r\n\t\t\t\t? undefined\r\n\t\t\t\t: enableDragPoints && getDirectionByAngle(Math.atan2(cornerVector.y, cornerVector.x));\r\n\r\n\t\t\t\tout.push({\r\n\t\t\t\t\tindex: [i],\r\n\t\t\t\t\tkey: `point-${i}`,\r\n\t\t\t\t\ttype: 'point',\r\n\t\t\t\t\tscale: { x: 1, y: 1 },\r\n\t\t\t\t\ttranslate: { x: p1.x, y: p1.y },\r\n\t\t\t\t\tangle: undefined,\r\n\t\t\t\t\trotate: enableRotatePoints,\r\n\t\t\t\t\tcenter: p1,\r\n\t\t\t\t\tdir\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// skip edge dragging\r\n\t\t\tif (!enableDragEdges) continue;\r\n\r\n\t\t\tif (Array.isArray(enableDragEdges) && !enableDragEdges.some(([indexFrom, indexTo]) => {\r\n\t\t\t\treturn i === indexFrom && i2 === indexTo;\r\n\t\t\t})) continue;\r\n\r\n\t\t\tconst mid = vectorCreate(p1.x + (p2.x - p1.x) * 0.5, p1.y + (p2.y - p1.y) * 0.5);\r\n\r\n\t\t\t// create edge\r\n\t\t\tout.push({\r\n\t\t\t\tindex: [i, i2],\r\n\t\t\t\tkey: `edge-${i}`,\r\n\t\t\t\ttype: 'edge',\r\n\t\t\t\tscale: { x: vectorDistance(p1, p2), y: 1 },\r\n\t\t\t\ttranslate: { x: p1.x, y: p1.y },\r\n\t\t\t\tangle: dir,\r\n\t\t\t\trotate: dir,\r\n\t\t\t\tcenter: mid,\r\n\t\t\t\tvisible: Array.isArray(enableDragEdges),\r\n\t\t\t\tdir: getDirectionByAngle(Math.atan2(center.y - mid.y, center.x - mid.x))\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn out;\r\n\t};\r\n\r\n\tconst handleResizeNudge = (indexes, translation) => {\r\n\t\tdispatch(`resizestart`, {\r\n\t\t\tindexes,\r\n\t\t\ttranslation: vectorCreateEmpty()\r\n\t\t});\r\n\r\n\t\tdispatch(`resizemove`, { indexes, translation });\r\n\r\n\t\tdispatch(`resizeend`, {\r\n\t\t\tindexes,\r\n\t\t\ttranslation: vectorCreateEmpty()\r\n\t\t});\r\n\t};\r\n\r\n\tconst handleRotateNudge = ({ detail }) => {\r\n\t\tdispatch(`rotatestart`, { translation: vectorCreateEmpty() });\r\n\t\tdispatch(`rotatemove`, { translation: detail });\r\n\t\tdispatch(`rotateend`, { translation: vectorCreateEmpty() });\r\n\t};\r\n\r\n\tconst nudge_handler = (index, { detail }) => handleResizeNudge(index, detail);\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('visible' in $$props) $$invalidate(2, visible = $$props.visible);\r\n\t\tif ('points' in $$props) $$invalidate(15, points = $$props.points);\r\n\t\tif ('rotatorPoint' in $$props) $$invalidate(0, rotatorPoint = $$props.rotatorPoint);\r\n\t\tif ('enableDragEdges' in $$props) $$invalidate(16, enableDragEdges = $$props.enableDragEdges);\r\n\t\tif ('enableDragPoints' in $$props) $$invalidate(17, enableDragPoints = $$props.enableDragPoints);\r\n\t\tif ('enableRotatePoints' in $$props) $$invalidate(1, enableRotatePoints = $$props.enableRotatePoints);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*visible, $isAnimated*/ 262148) {\r\n\t\t\tselectionScale.set(visible ? 1 : 0.5, { hard: $isAnimated === false });\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*visible, $isAnimated*/ 262148) {\r\n\t\t\tselectionOpacity.set(visible ? 1 : 0, { hard: $isAnimated === false });\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*points*/ 32768) {\r\n\t\t\t$$invalidate(3, resizeControls = mapPointsToControls(points));\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\trotatorPoint,\r\n\t\tenableRotatePoints,\r\n\t\tvisible,\r\n\t\tresizeControls,\r\n\t\t$selectionScale,\r\n\t\t$selectionOpacity,\r\n\t\tisAnimated,\r\n\t\thandleKeyDown,\r\n\t\thandleKeyUp,\r\n\t\tselectionScale,\r\n\t\tselectionOpacity,\r\n\t\tresize,\r\n\t\thandleResizeNudge,\r\n\t\thandleRotateNudge,\r\n\t\trotate,\r\n\t\tpoints,\r\n\t\tenableDragEdges,\r\n\t\tenableDragPoints,\r\n\t\t$isAnimated,\r\n\t\tnudge_handler\r\n\t];\r\n}\r\n\r\nclass ShapeManipulator extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$i,\r\n\t\t\tcreate_fragment$i,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tvisible: 2,\r\n\t\t\t\tpoints: 15,\r\n\t\t\t\trotatorPoint: 0,\r\n\t\t\t\tenableDragEdges: 16,\r\n\t\t\t\tenableDragPoints: 17,\r\n\t\t\t\tenableRotatePoints: 1\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1]\r\n\t\t);\r\n\t}\r\n}\r\n\r\nvar getEventPositionInEditor = (e, viewOffset) => {\r\n    const positionInViewport = getEventPositionInViewport(e);\r\n    return vectorSubtract(positionInViewport, viewOffset);\r\n};\r\n\r\nvar cursorMoveToEnd = (field) => (field.selectionStart = field.selectionEnd = field.value.length);\r\n\r\nlet result = null;\r\nvar supportsVisualViewport = () => {\r\n    if (result === null) {\r\n        result = isBrowser() && 'visualViewport' in window;\r\n    }\r\n    return result;\r\n};\r\n\r\nvar createSoftKeyboardObserver = (cb) => {\r\n    if (!supportsVisualViewport())\r\n        return false;\r\n    const heightNormal = visualViewport.height;\r\n    const testState = () => {\r\n        cb(visualViewport.height < heightNormal ? 'visible' : 'hidden');\r\n    };\r\n    visualViewport.addEventListener('resize', testState);\r\n    return () => visualViewport.removeEventListener('resize', testState);\r\n};\r\n\r\n/* src/core/ui/components/InputForm.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$h(ctx) {\r\n\tlet div2;\r\n\tlet div1;\r\n\tlet button0;\r\n\tlet t0;\r\n\tlet div0;\r\n\tlet t1;\r\n\tlet button1;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\tbutton0 = new Button({\r\n\t\t\tprops: {\r\n\t\t\t\tonclick: /*oncancel*/ ctx[1],\r\n\t\t\t\tlabel: /*labelCancel*/ ctx[5],\r\n\t\t\t\ticon: /*iconCancel*/ ctx[7],\r\n\t\t\t\thideLabel: !/*labelCancelShow*/ ctx[6]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tconst default_slot_template = /*#slots*/ ctx[20].default;\r\n\tconst default_slot = create_slot(default_slot_template, ctx, /*$$scope*/ ctx[19], null);\r\n\r\n\tbutton1 = new Button({\r\n\t\t\tprops: {\r\n\t\t\t\tonclick: /*onconfirm*/ ctx[0],\r\n\t\t\t\tlabel: /*labelConfirm*/ ctx[2],\r\n\t\t\t\ticon: /*iconConfirm*/ ctx[4],\r\n\t\t\t\thideLabel: !/*labelConfirmShow*/ ctx[3],\r\n\t\t\t\tclass: \"PinturaInputFormButtonConfirm\"\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv2 = element(\"div\");\r\n\t\t\tdiv1 = element(\"div\");\r\n\t\t\tcreate_component(button0.$$.fragment);\r\n\t\t\tt0 = space();\r\n\t\t\tdiv0 = element(\"div\");\r\n\t\t\tif (default_slot) default_slot.c();\r\n\t\t\tt1 = space();\r\n\t\t\tcreate_component(button1.$$.fragment);\r\n\t\t\tattr(div0, \"class\", \"PinturaInputFormFields\");\r\n\t\t\tattr(div1, \"class\", \"PinturaInputFormInner\");\r\n\t\t\tattr(div2, \"class\", \"PinturaInputForm\");\r\n\t\t\tattr(div2, \"style\", /*style*/ ctx[9]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div2, anchor);\r\n\t\t\tappend(div2, div1);\r\n\t\t\tmount_component(button0, div1, null);\r\n\t\t\tappend(div1, t0);\r\n\t\t\tappend(div1, div0);\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tdefault_slot.m(div0, null);\r\n\t\t\t}\r\n\r\n\t\t\tappend(div1, t1);\r\n\t\t\tmount_component(button1, div1, null);\r\n\t\t\t/*div2_binding*/ ctx[21](div2);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(div2, \"focusin\", /*handleFocusIn*/ ctx[10]),\r\n\t\t\t\t\tlisten(div2, \"focusout\", /*handleFocusOut*/ ctx[11]),\r\n\t\t\t\t\tlisten(div2, \"measure\", /*handleMeasure*/ ctx[12]),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div2))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst button0_changes = {};\r\n\t\t\tif (dirty[0] & /*oncancel*/ 2) button0_changes.onclick = /*oncancel*/ ctx[1];\r\n\t\t\tif (dirty[0] & /*labelCancel*/ 32) button0_changes.label = /*labelCancel*/ ctx[5];\r\n\t\t\tif (dirty[0] & /*iconCancel*/ 128) button0_changes.icon = /*iconCancel*/ ctx[7];\r\n\t\t\tif (dirty[0] & /*labelCancelShow*/ 64) button0_changes.hideLabel = !/*labelCancelShow*/ ctx[6];\r\n\t\t\tbutton0.$set(button0_changes);\r\n\r\n\t\t\tif (default_slot) {\r\n\t\t\t\tif (default_slot.p && (!current || dirty[0] & /*$$scope*/ 524288)) {\r\n\t\t\t\t\tupdate_slot_base(\r\n\t\t\t\t\t\tdefault_slot,\r\n\t\t\t\t\t\tdefault_slot_template,\r\n\t\t\t\t\t\tctx,\r\n\t\t\t\t\t\t/*$$scope*/ ctx[19],\r\n\t\t\t\t\t\t!current\r\n\t\t\t\t\t\t? get_all_dirty_from_scope(/*$$scope*/ ctx[19])\r\n\t\t\t\t\t\t: get_slot_changes(default_slot_template, /*$$scope*/ ctx[19], dirty, null),\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst button1_changes = {};\r\n\t\t\tif (dirty[0] & /*onconfirm*/ 1) button1_changes.onclick = /*onconfirm*/ ctx[0];\r\n\t\t\tif (dirty[0] & /*labelConfirm*/ 4) button1_changes.label = /*labelConfirm*/ ctx[2];\r\n\t\t\tif (dirty[0] & /*iconConfirm*/ 16) button1_changes.icon = /*iconConfirm*/ ctx[4];\r\n\t\t\tif (dirty[0] & /*labelConfirmShow*/ 8) button1_changes.hideLabel = !/*labelConfirmShow*/ ctx[3];\r\n\t\t\tbutton1.$set(button1_changes);\r\n\r\n\t\t\tif (!current || dirty[0] & /*style*/ 512) {\r\n\t\t\t\tattr(div2, \"style\", /*style*/ ctx[9]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(button0.$$.fragment, local);\r\n\t\t\ttransition_in(default_slot, local);\r\n\t\t\ttransition_in(button1.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(button0.$$.fragment, local);\r\n\t\t\ttransition_out(default_slot, local);\r\n\t\t\ttransition_out(button1.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div2);\r\n\t\t\tdestroy_component(button0);\r\n\t\t\tif (default_slot) default_slot.d(detaching);\r\n\t\t\tdestroy_component(button1);\r\n\t\t\t/*div2_binding*/ ctx[21](null);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nconst panelDelay = 200;\r\n\r\nfunction instance$h($$self, $$props, $$invalidate) {\r\n\tlet computedStyle;\r\n\tlet shouldStickToKeyboard;\r\n\tlet style;\r\n\tlet { $$slots: slots = {}, $$scope } = $$props;\r\n\tlet { onconfirm } = $$props;\r\n\tlet { oncancel } = $$props;\r\n\tlet { autoFocus = true } = $$props;\r\n\tlet { autoPositionCursor = true } = $$props;\r\n\tlet { labelConfirm } = $$props;\r\n\tlet { labelConfirmShow = true } = $$props;\r\n\tlet { iconConfirm } = $$props;\r\n\tlet { labelCancel } = $$props;\r\n\tlet { labelCancelShow = false } = $$props;\r\n\tlet { iconCancel } = $$props;\r\n\tlet { panelOffset = vectorCreateEmpty() } = $$props;\r\n\tlet panelVisible = false;\r\n\tlet panelHeight = undefined;\r\n\tlet panelRevealTimeout = undefined;\r\n\tlet panelPosition = '';\r\n\tlet panelOpacity = 0;\r\n\tlet root;\r\n\tconst isTextarea = element => (/textarea/i).test(element);\r\n\r\n\tconst preventTextAreaScrollingOnIOS = element => {\r\n\t\t// preventsDefault on textarea events when can no longer scroll up or down in textarea\r\n\t\tlet lastScreenY;\r\n\r\n\t\tconst handleTouchStart = e => lastScreenY = e.touches[0].screenY;\r\n\r\n\t\tconst handleTouchMove = e => {\r\n\t\t\tconst currentScreenY = e.touches[0].screenY;\r\n\t\t\tconst target = e.target;\r\n\r\n\t\t\tif ((/textarea/i).test(target.nodeName)) {\r\n\t\t\t\t// moving down\r\n\t\t\t\tif (currentScreenY > lastScreenY) {\r\n\t\t\t\t\tif (target.scrollTop == 0) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else // moving up\r\n\t\t\t\tif (currentScreenY < lastScreenY) {\r\n\t\t\t\t\tif (target.scrollTop + target.offsetHeight == target.scrollHeight) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlastScreenY = currentScreenY;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\telement.addEventListener('touchstart', handleTouchStart);\r\n\t\telement.addEventListener('touchmove', handleTouchMove);\r\n\r\n\t\treturn () => {\r\n\t\t\telement.removeEventListener('touchstart', handleTouchStart);\r\n\t\t\telement.removeEventListener('touchmove', handleTouchMove);\r\n\t\t};\r\n\t};\r\n\r\n\tconst focus = () => {\r\n\t\tconst field = root.querySelector('input, textarea');\r\n\t\tfield.focus();\r\n\r\n\t\t// only select when showing for first time\r\n\t\tif (panelOpacity >= 1) return;\r\n\r\n\t\tfield.select();\r\n\t};\r\n\r\n\tconst show = () => {\r\n\t\tpanelVisible = true;\r\n\r\n\t\t// browser does not support keyboard listener, place modal at top of view\r\n\t\tif (!unsubSoftKeyboardListener && (isIOS() || isAndroid())) {\r\n\t\t\t$$invalidate(16, panelPosition = 'top:1em;bottom:auto;');\r\n\t\t}\r\n\r\n\t\t// prevent interacting with the root element\r\n\t\tif (isIOS()) preventTextAreaScrollingOnIOS(root);\r\n\r\n\t\t// reveal\r\n\t\t$$invalidate(17, panelOpacity = 1);\r\n\t};\r\n\r\n\tconst hide = () => {\r\n\t\tpanelVisible = false;\r\n\t\t$$invalidate(17, panelOpacity = 0);\r\n\t};\r\n\r\n\tconst handleSoftKeyboard = keyboardState => {\r\n\t\t// shouldn't stick, we'll stick it to the top of the viewport so the keyboard doesn't obscure the input field\r\n\t\tif (!shouldStickToKeyboard) {\r\n\t\t\t$$invalidate(16, panelPosition = `top: 4.5em; bottom: auto`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// no need to continue, already hidden\r\n\t\tif (keyboardState === 'hidden' && !panelVisible) {\r\n\t\t\tfocus();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// gonna update position here\r\n\t\tclearTimeout(panelRevealTimeout);\r\n\r\n\t\tpanelRevealTimeout = undefined;\r\n\r\n\t\t// position\r\n\t\t$$invalidate(16, panelPosition = `top:${visualViewport.height - panelHeight - panelOffset.y}px`);\r\n\r\n\t\t// if a soft keyboard is detected, turn into modal mode\r\n\t\tif (keyboardState === 'visible') {\r\n\t\t\t// stick to keyboard\r\n\t\t\t$$invalidate(8, root.dataset.layout = 'stick', root);\r\n\r\n\t\t\t// need to refocus\r\n\t\t\tfocus();\r\n\r\n\t\t\t// place above keyboard\r\n\t\t\tshow();\r\n\t\t} else // keyboard is hidden\r\n\t\t{\r\n\t\t\thide();\r\n\t\t}\r\n\t};\r\n\r\n\tlet focusDateTime;\r\n\r\n\tconst handleFocusIn = e => {\r\n\t\tif (!isTextarea(e.target)) return;\r\n\r\n\t\t// we need to remember focus time so we can detect unrealistic blur event caused by soft keyboard shenanigans\r\n\t\tfocusDateTime = Date.now();\r\n\r\n\t\t// move cursor\r\n\t\tif (autoPositionCursor) cursorMoveToEnd(e.target);\r\n\r\n\t\t// wait a couple milliseconds\r\n\t\tclearTimeout(panelRevealTimeout);\r\n\r\n\t\tpanelRevealTimeout = setTimeout(show, panelDelay);\r\n\t};\r\n\r\n\tconst handleFocusOut = e => {\r\n\t\tconst focusDuration = Date.now() - focusDateTime;\r\n\t\tif (focusDuration > 50) return;\r\n\r\n\t\t// unrealistic blur, refocus\r\n\t\te.stopPropagation();\r\n\r\n\t\tfocus();\r\n\t};\r\n\r\n\tconst unsubSoftKeyboardListener = createSoftKeyboardObserver(handleSoftKeyboard);\r\n\r\n\tconst handleMeasure = ({ detail }) => {\r\n\t\tpanelHeight = detail.height;\r\n\t};\r\n\r\n\tonMount(() => {\r\n\t\tif (!autoFocus) return;\r\n\t\tfocus();\r\n\t});\r\n\r\n\tonDestroy(() => {\r\n\t\tunsubSoftKeyboardListener && unsubSoftKeyboardListener();\r\n\t});\r\n\r\n\tfunction div2_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\troot = $$value;\r\n\t\t\t$$invalidate(8, root);\r\n\t\t});\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('onconfirm' in $$props) $$invalidate(0, onconfirm = $$props.onconfirm);\r\n\t\tif ('oncancel' in $$props) $$invalidate(1, oncancel = $$props.oncancel);\r\n\t\tif ('autoFocus' in $$props) $$invalidate(13, autoFocus = $$props.autoFocus);\r\n\t\tif ('autoPositionCursor' in $$props) $$invalidate(14, autoPositionCursor = $$props.autoPositionCursor);\r\n\t\tif ('labelConfirm' in $$props) $$invalidate(2, labelConfirm = $$props.labelConfirm);\r\n\t\tif ('labelConfirmShow' in $$props) $$invalidate(3, labelConfirmShow = $$props.labelConfirmShow);\r\n\t\tif ('iconConfirm' in $$props) $$invalidate(4, iconConfirm = $$props.iconConfirm);\r\n\t\tif ('labelCancel' in $$props) $$invalidate(5, labelCancel = $$props.labelCancel);\r\n\t\tif ('labelCancelShow' in $$props) $$invalidate(6, labelCancelShow = $$props.labelCancelShow);\r\n\t\tif ('iconCancel' in $$props) $$invalidate(7, iconCancel = $$props.iconCancel);\r\n\t\tif ('panelOffset' in $$props) $$invalidate(15, panelOffset = $$props.panelOffset);\r\n\t\tif ('$$scope' in $$props) $$invalidate(19, $$scope = $$props.$$scope);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*root*/ 256) {\r\n\t\t\t$$invalidate(18, computedStyle = root && getComputedStyle(root));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*computedStyle*/ 262144) {\r\n\t\t\tshouldStickToKeyboard = computedStyle && computedStyle.getPropertyValue('--editor-modal') === '1';\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*panelOpacity, panelPosition*/ 196608) {\r\n\t\t\t$$invalidate(9, style = `opacity:${panelOpacity};${panelPosition}`);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tonconfirm,\r\n\t\toncancel,\r\n\t\tlabelConfirm,\r\n\t\tlabelConfirmShow,\r\n\t\ticonConfirm,\r\n\t\tlabelCancel,\r\n\t\tlabelCancelShow,\r\n\t\ticonCancel,\r\n\t\troot,\r\n\t\tstyle,\r\n\t\thandleFocusIn,\r\n\t\thandleFocusOut,\r\n\t\thandleMeasure,\r\n\t\tautoFocus,\r\n\t\tautoPositionCursor,\r\n\t\tpanelOffset,\r\n\t\tpanelPosition,\r\n\t\tpanelOpacity,\r\n\t\tcomputedStyle,\r\n\t\t$$scope,\r\n\t\tslots,\r\n\t\tdiv2_binding\r\n\t];\r\n}\r\n\r\nclass InputForm extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$h,\r\n\t\t\tcreate_fragment$h,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tonconfirm: 0,\r\n\t\t\t\toncancel: 1,\r\n\t\t\t\tautoFocus: 13,\r\n\t\t\t\tautoPositionCursor: 14,\r\n\t\t\t\tlabelConfirm: 2,\r\n\t\t\t\tlabelConfirmShow: 3,\r\n\t\t\t\ticonConfirm: 4,\r\n\t\t\t\tlabelCancel: 5,\r\n\t\t\t\tlabelCancelShow: 6,\r\n\t\t\t\ticonCancel: 7,\r\n\t\t\t\tpanelOffset: 15\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1]\r\n\t\t);\r\n\t}\r\n}\r\n\r\nvar t = (text) => document.createTextNode(text);\r\n\r\nvar replaceDivWithBr = (html) => (isSafari() && html.endsWith('<div><br></div>')\r\n    ? html.replace(/<div><br><\\/div>$/, '<br><br>')\r\n    : html)\r\n    .replace(/<div><br><\\/div>/g, '<br>')\r\n    .replace(/<\\/div>/g, '')\r\n    .replace(/<div>/g, '<br>');\r\n\r\n/* src/core/ui/components/ContentEditable.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$g(ctx) {\r\n\tlet pre;\r\n\tlet pre_data_wrap_content_value;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tpre = element(\"pre\");\r\n\t\t\tattr(pre, \"class\", \"PinturaContentEditable\");\r\n\r\n\t\t\tattr(pre, \"data-wrap-content\", pre_data_wrap_content_value = !/*wrapLines*/ ctx[3] && !/*allowNewline*/ ctx[4]\r\n\t\t\t? 'nowrap'\r\n\t\t\t: 'wrap');\r\n\r\n\t\t\tattr(pre, \"contenteditable\", \"\");\r\n\t\t\tattr(pre, \"spellcheck\", /*spellcheck*/ ctx[0]);\r\n\t\t\tattr(pre, \"autocorrect\", /*autocorrect*/ ctx[1]);\r\n\t\t\tattr(pre, \"autocapitalize\", /*autocapitalize*/ ctx[2]);\r\n\t\t\tattr(pre, \"style\", /*contentStyle*/ ctx[6]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, pre, anchor);\r\n\t\t\t/*pre_binding*/ ctx[23](pre);\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(pre, \"input\", /*handleInput*/ ctx[11]),\r\n\t\t\t\t\tlisten(pre, \"compositionend\", /*handleCompositionEnd*/ ctx[10]),\r\n\t\t\t\t\tlisten(pre, \"paste\", /*handlePaste*/ ctx[12]),\r\n\t\t\t\t\tlisten(pre, \"keydown\", /*handleKeydown*/ ctx[8]),\r\n\t\t\t\t\tlisten(pre, \"keyup\", /*handleKeyup*/ ctx[9]),\r\n\t\t\t\t\tlisten(pre, \"blur\", /*handleBlur*/ ctx[7])\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[0] & /*wrapLines, allowNewline*/ 24 && pre_data_wrap_content_value !== (pre_data_wrap_content_value = !/*wrapLines*/ ctx[3] && !/*allowNewline*/ ctx[4]\r\n\t\t\t? 'nowrap'\r\n\t\t\t: 'wrap')) {\r\n\t\t\t\tattr(pre, \"data-wrap-content\", pre_data_wrap_content_value);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty[0] & /*spellcheck*/ 1) {\r\n\t\t\t\tattr(pre, \"spellcheck\", /*spellcheck*/ ctx[0]);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty[0] & /*autocorrect*/ 2) {\r\n\t\t\t\tattr(pre, \"autocorrect\", /*autocorrect*/ ctx[1]);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty[0] & /*autocapitalize*/ 4) {\r\n\t\t\t\tattr(pre, \"autocapitalize\", /*autocapitalize*/ ctx[2]);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty[0] & /*contentStyle*/ 64) {\r\n\t\t\t\tattr(pre, \"style\", /*contentStyle*/ ctx[6]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti: noop,\r\n\t\to: noop,\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(pre);\r\n\t\t\t/*pre_binding*/ ctx[23](null);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$g($$self, $$props, $$invalidate) {\r\n\tlet isReady;\r\n\tlet { spellcheck = 'false' } = $$props;\r\n\tlet { autocorrect = 'off' } = $$props;\r\n\tlet { autocapitalize = 'off' } = $$props;\r\n\tlet { wrapLines = true } = $$props;\r\n\tlet { allowNewline = true } = $$props;\r\n\tlet { textStyles = false } = $$props;\r\n\tlet { formatInput = passthrough } = $$props;\r\n\tlet { formatPaste = passthrough } = $$props;\r\n\tlet { style = undefined } = $$props;\r\n\tlet { innerHTML = undefined } = $$props;\r\n\tlet { oninput = noop$1 } = $$props;\r\n\tconst confirm = () => confirmInputState();\r\n\tconst focus = () => element && element.focus();\r\n\r\n\tconst select = () => {\r\n\t\tif (!element) return;\r\n\t\tconst range = document.createRange();\r\n\t\trange.selectNodeContents(element);\r\n\t\tconst selection = getSelectionSafe();\r\n\t\tselection.removeAllRanges();\r\n\t\tselection.addRange(range);\r\n\t};\r\n\r\n\t// events\r\n\tconst dispatchEvent = createEventDispatcher();\r\n\r\n\t// reference to contenteditable element\r\n\tlet element;\r\n\r\n\t// use <br> for line breaks\r\n\tdocument.execCommand('defaultParagraphSeparator', false, 'br');\r\n\r\n\tconst setInnerHTML = html => {\r\n\t\tif (html === element.innerHTML) return;\r\n\t\t$$invalidate(5, element.innerHTML = html, element);\r\n\t\tif (element === document.activeElement) select();\r\n\t};\r\n\r\n\tconst removeTextStyles = html => {\r\n\t\treturn html.replace(/<\\/?(?:i|b|em|strong)>/, '');\r\n\t};\r\n\r\n\tconst updateInnerHTML = () => {\r\n\t\t// sync property\r\n\t\t$$invalidate(13, innerHTML = element.innerHTML);\r\n\r\n\t\t// let others know\r\n\t\tconst currentValue = replaceDivWithBr(innerHTML);\r\n\r\n\t\tdispatchEvent('input', currentValue);\r\n\t\toninput(currentValue);\r\n\r\n\t\t// always scroll to top\r\n\t\trequestAnimationFrame(() => element && element.scrollTo(0, 0));\r\n\t};\r\n\r\n\tconst confirmInputState = () => {\r\n\t\t// bookmark caret positions\r\n\t\tinsertBookmarks(element);\r\n\r\n\t\t// remove styles\r\n\t\tconst html = textStyles\r\n\t\t? element.innerHTML\r\n\t\t: removeTextStyles(element.innerHTML);\r\n\r\n\t\t// update HTML (don't remove caret positions)\r\n\t\t$$invalidate(5, element.innerHTML = formatInput(html), element);\r\n\r\n\t\t// select bookmarks and remove from DOM\r\n\t\tselectBookmarks(element);\r\n\r\n\t\t// content updated\r\n\t\tupdateInnerHTML();\r\n\t};\r\n\r\n\tconst handleBlur = () => {\r\n\t\tdispatchEvent('blur');\r\n\t};\r\n\r\n\tconst handleConfirm = () => {\r\n\t\tdispatchEvent('confirm');\r\n\t};\r\n\r\n\tconst handleCancel = () => {\r\n\t\tdispatchEvent('cancel');\r\n\t};\r\n\r\n\tconst handleKeydown = e => {\r\n\t\t// is escape key, cancel\r\n\t\tif ((/escape/i).test(e.code)) {\r\n\t\t\te.stopPropagation();\r\n\t\t\treturn handleCancel();\r\n\t\t}\r\n\r\n\t\t// stop here\r\n\t\tif (!(/enter/i).test(e.code)) return;\r\n\r\n\t\t// don't let others handle return while in text area\r\n\t\te.stopPropagation();\r\n\r\n\t\t// is cmd + enter or ctrl + enter\r\n\t\tif (e.ctrlKey || e.metaKey) return handleConfirm();\r\n\r\n\t\t// block return when newlines not allowed\r\n\t\tif (!allowNewline) e.preventDefault();\r\n\t};\r\n\r\n\tconst handleKeyup = () => {\r\n\t\t\r\n\t};\r\n\r\n\tconst handleCompositionEnd = e => {\r\n\t\tif (e.data === '') return;\r\n\t\tconfirmInputState();\r\n\t};\r\n\r\n\tconst handleInput = e => {\r\n\t\tconst { inputType } = e;\r\n\r\n\t\t// more info on when inputType is which value\r\n\t\t// https://rawgit.com/w3c/input-events/v1/index.html#interface-InputEvent-Attributes\r\n\t\tif (inputType === 'insertCompositionText' || inputType === 'deleteCompositionText') {\r\n\t\t\t// we're composing (to for example write é, or Japanese characters),\r\n\t\t\t// if so, wait for composition end before formatting content\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconfirmInputState();\r\n\t};\r\n\r\n\tconst handlePaste = e => {\r\n\t\te.preventDefault();\r\n\r\n\t\t// remove styles\r\n\t\tconst plainText = e.clipboardData.getData('text/plain');\r\n\r\n\t\tconst html = textStyles ? plainText : removeTextStyles(plainText);\r\n\r\n\t\t// format the pasted text before adding\r\n\t\tconst text = formatPaste(html);\r\n\r\n\t\tif (!text.length) return;\r\n\r\n\t\t// get range for current selection and replace with text\r\n\t\tconst range = getSelectionSafe().getRangeAt(0);\r\n\r\n\t\trange.deleteContents();\r\n\t\trange.insertNode(document.createTextNode(text));\r\n\r\n\t\t// content updated\r\n\t\tupdateInnerHTML();\r\n\t};\r\n\r\n\t//#region bookmarks\r\n\tconst createBookmark = name => {\r\n\t\tconst bookmarkNode = h('span');\r\n\t\tbookmarkNode.dataset.bookmark = name;\r\n\t\treturn bookmarkNode;\r\n\t};\r\n\r\n\tconst insertBookmark = (node, offset, name) => {\r\n\t\t// create the bookmark element\r\n\t\tconst bookmarkNode = createBookmark(name);\r\n\r\n\t\t// split up in two text nodes and insert\r\n\t\tif (node.nodeType === Node.TEXT_NODE) {\r\n\t\t\tconst text = node.textContent;\r\n\r\n\t\t\tif (name === 'start') {\r\n\t\t\t\tconst before = t(text.substr(0, offset));\r\n\t\t\t\tconst after = t(text.substr(offset));\r\n\t\t\t\tnode.replaceWith(before, bookmarkNode, after);\r\n\t\t\t} else {\r\n\t\t\t\tconst before = t(text.substr(0, offset));\r\n\t\t\t\tconst after = t(text.substr(offset));\r\n\t\t\t\tnode.replaceWith(before, bookmarkNode, after);\r\n\t\t\t}\r\n\t\t} else // is node\r\n\t\tif (node.nodeType === Node.ELEMENT_NODE) {\r\n\t\t\tnode.insertBefore(bookmarkNode, node.childNodes[offset]);\r\n\t\t}\r\n\t};\r\n\r\n\tconst getSelectionSafe = () => {\r\n\t\tconst root = element.getRootNode();\r\n\r\n\t\t// chrome needs to select from shadowRoot if in Shadow DOM\r\n\t\t// firefox can select from document and doesn't have getSelection support on shadowRoot\r\n\t\t// safari cannot deal with text selection in shadowRoot at this time (MacOS Safari 16)\r\n\t\treturn 'getSelection' in root\r\n\t\t? root.getSelection()\r\n\t\t: document.getSelection();\r\n\t};\r\n\r\n\tconst insertBookmarks = element => {\r\n\t\tconst selection = getSelectionSafe();\r\n\t\tif (!(selection.getRangeAt && selection.rangeCount)) return;\r\n\t\tconst range = selection.getRangeAt(0);\r\n\t\tconst { startOffset, endOffset, startContainer, endContainer } = range;\r\n\r\n\t\t// range needs to be in element\r\n\t\tif (!element.contains(range.startContainer) || !element.contains(range.endContainer)) return;\r\n\r\n\t\t// should break up one text container\r\n\t\tif (startContainer.nodeType === Node.TEXT_NODE && startContainer === endContainer) {\r\n\t\t\tconst text = startContainer.textContent;\r\n\t\t\tconst before = text.substr(0, startOffset);\r\n\t\t\tconst bookmarkStart = createBookmark('start');\r\n\r\n\t\t\tconst selected = endOffset - startOffset > 0\r\n\t\t\t? text.substr(startOffset, endOffset)\r\n\t\t\t: '';\r\n\r\n\t\t\tconst bookmarkEnd = createBookmark('end');\r\n\t\t\tconst after = text.substr(endOffset);\r\n\t\t\tstartContainer.replaceWith(before, bookmarkStart, selected, bookmarkEnd, after);\r\n\t\t} else // should add to separate containers\r\n\t\t{\r\n\t\t\tinsertBookmark(startContainer, startOffset, 'start');\r\n\r\n\t\t\tinsertBookmark(\r\n\t\t\t\tendContainer,\r\n\t\t\t\t// if is same container need to move to next index as we've just added start bookmark\r\n\t\t\t\tendOffset + (startContainer === endContainer ? 1 : 0),\r\n\t\t\t\t'end'\r\n\t\t\t);\r\n\t\t}\r\n\t};\r\n\r\n\tconst selectBookmarks = element => {\r\n\t\t// get locations of bookmarks\r\n\t\tconst bookmarkStart = findBookmark(element, 'start');\r\n\r\n\t\tconst bookmarkEnd = findBookmark(element, 'end');\r\n\r\n\t\t// remove bookmarks (if found)\r\n\t\tif (!bookmarkStart || !bookmarkEnd) return;\r\n\r\n\t\t// set caret positions\r\n\t\tconst range = document.createRange();\r\n\r\n\t\trange.setStart(bookmarkStart, 0);\r\n\t\trange.setEnd(bookmarkEnd, 0);\r\n\t\tconst selection = getSelectionSafe();\r\n\t\tselection.removeAllRanges();\r\n\t\tselection.addRange(range);\r\n\r\n\t\t// remove bookmarks\r\n\t\tbookmarkStart.remove();\r\n\r\n\t\tbookmarkEnd.remove();\r\n\t};\r\n\r\n\tconst findBookmark = (element, name) => {\r\n\t\tconst children = element.children;\r\n\r\n\t\tfor (let i = 0; i < children.length; i++) {\r\n\t\t\tconst node = children[i];\r\n\t\t\tif (node.dataset.bookmark === name) return node;\r\n\r\n\t\t\tif (node.children.length) {\r\n\t\t\t\tconst bookmarkNode = findBookmark(node, name);\r\n\t\t\t\tif (bookmarkNode) return bookmarkNode;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn;\r\n\t};\r\n\r\n\t// add extra space on left or right side of content input so special symbols\r\n\t// are rendered on correct line while waiting for completion\r\n\tlet contentStyle;\r\n\r\n\tfunction pre_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\telement = $$value;\r\n\t\t\t$$invalidate(5, element);\r\n\t\t});\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('spellcheck' in $$props) $$invalidate(0, spellcheck = $$props.spellcheck);\r\n\t\tif ('autocorrect' in $$props) $$invalidate(1, autocorrect = $$props.autocorrect);\r\n\t\tif ('autocapitalize' in $$props) $$invalidate(2, autocapitalize = $$props.autocapitalize);\r\n\t\tif ('wrapLines' in $$props) $$invalidate(3, wrapLines = $$props.wrapLines);\r\n\t\tif ('allowNewline' in $$props) $$invalidate(4, allowNewline = $$props.allowNewline);\r\n\t\tif ('textStyles' in $$props) $$invalidate(14, textStyles = $$props.textStyles);\r\n\t\tif ('formatInput' in $$props) $$invalidate(15, formatInput = $$props.formatInput);\r\n\t\tif ('formatPaste' in $$props) $$invalidate(16, formatPaste = $$props.formatPaste);\r\n\t\tif ('style' in $$props) $$invalidate(17, style = $$props.style);\r\n\t\tif ('innerHTML' in $$props) $$invalidate(13, innerHTML = $$props.innerHTML);\r\n\t\tif ('oninput' in $$props) $$invalidate(18, oninput = $$props.oninput);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*element*/ 32) {\r\n\t\t\t// set value when html property is set and element reference is bound\r\n\t\t\t$$invalidate(22, isReady = !!element);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*isReady, innerHTML*/ 4202496) {\r\n\t\t\tif (isReady && innerHTML) setInnerHTML(innerHTML);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*wrapLines, allowNewline, style*/ 131096) {\r\n\t\t\tif (!wrapLines && allowNewline) {\r\n\t\t\t\t// TODO: no fix for center text yet\r\n\t\t\t\tconst contentStyleAdditional = style.includes(':right')\r\n\t\t\t\t? 'text-indent:-100px!important'\r\n\t\t\t\t: !style.includes(':center')\r\n\t\t\t\t\t? 'min-width:calc(100% + 100px)!important'\r\n\t\t\t\t\t: '';\r\n\r\n\t\t\t\t$$invalidate(6, contentStyle = style + ';overflow:visible;' + contentStyleAdditional);\r\n\t\t\t} else {\r\n\t\t\t\t$$invalidate(6, contentStyle = style);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tspellcheck,\r\n\t\tautocorrect,\r\n\t\tautocapitalize,\r\n\t\twrapLines,\r\n\t\tallowNewline,\r\n\t\telement,\r\n\t\tcontentStyle,\r\n\t\thandleBlur,\r\n\t\thandleKeydown,\r\n\t\thandleKeyup,\r\n\t\thandleCompositionEnd,\r\n\t\thandleInput,\r\n\t\thandlePaste,\r\n\t\tinnerHTML,\r\n\t\ttextStyles,\r\n\t\tformatInput,\r\n\t\tformatPaste,\r\n\t\tstyle,\r\n\t\toninput,\r\n\t\tconfirm,\r\n\t\tfocus,\r\n\t\tselect,\r\n\t\tisReady,\r\n\t\tpre_binding\r\n\t];\r\n}\r\n\r\nclass ContentEditable extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$g,\r\n\t\t\tcreate_fragment$g,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tspellcheck: 0,\r\n\t\t\t\tautocorrect: 1,\r\n\t\t\t\tautocapitalize: 2,\r\n\t\t\t\twrapLines: 3,\r\n\t\t\t\tallowNewline: 4,\r\n\t\t\t\ttextStyles: 14,\r\n\t\t\t\tformatInput: 15,\r\n\t\t\t\tformatPaste: 16,\r\n\t\t\t\tstyle: 17,\r\n\t\t\t\tinnerHTML: 13,\r\n\t\t\t\toninput: 18,\r\n\t\t\t\tconfirm: 19,\r\n\t\t\t\tfocus: 20,\r\n\t\t\t\tselect: 21\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1]\r\n\t\t);\r\n\t}\r\n\r\n\tget spellcheck() {\r\n\t\treturn this.$$.ctx[0];\r\n\t}\r\n\r\n\tset spellcheck(spellcheck) {\r\n\t\tthis.$$set({ spellcheck });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget autocorrect() {\r\n\t\treturn this.$$.ctx[1];\r\n\t}\r\n\r\n\tset autocorrect(autocorrect) {\r\n\t\tthis.$$set({ autocorrect });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget autocapitalize() {\r\n\t\treturn this.$$.ctx[2];\r\n\t}\r\n\r\n\tset autocapitalize(autocapitalize) {\r\n\t\tthis.$$set({ autocapitalize });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget wrapLines() {\r\n\t\treturn this.$$.ctx[3];\r\n\t}\r\n\r\n\tset wrapLines(wrapLines) {\r\n\t\tthis.$$set({ wrapLines });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget allowNewline() {\r\n\t\treturn this.$$.ctx[4];\r\n\t}\r\n\r\n\tset allowNewline(allowNewline) {\r\n\t\tthis.$$set({ allowNewline });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget textStyles() {\r\n\t\treturn this.$$.ctx[14];\r\n\t}\r\n\r\n\tset textStyles(textStyles) {\r\n\t\tthis.$$set({ textStyles });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget formatInput() {\r\n\t\treturn this.$$.ctx[15];\r\n\t}\r\n\r\n\tset formatInput(formatInput) {\r\n\t\tthis.$$set({ formatInput });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget formatPaste() {\r\n\t\treturn this.$$.ctx[16];\r\n\t}\r\n\r\n\tset formatPaste(formatPaste) {\r\n\t\tthis.$$set({ formatPaste });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget style() {\r\n\t\treturn this.$$.ctx[17];\r\n\t}\r\n\r\n\tset style(style) {\r\n\t\tthis.$$set({ style });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget innerHTML() {\r\n\t\treturn this.$$.ctx[13];\r\n\t}\r\n\r\n\tset innerHTML(innerHTML) {\r\n\t\tthis.$$set({ innerHTML });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget oninput() {\r\n\t\treturn this.$$.ctx[18];\r\n\t}\r\n\r\n\tset oninput(oninput) {\r\n\t\tthis.$$set({ oninput });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget confirm() {\r\n\t\treturn this.$$.ctx[19];\r\n\t}\r\n\r\n\tget focus() {\r\n\t\treturn this.$$.ctx[20];\r\n\t}\r\n\r\n\tget select() {\r\n\t\treturn this.$$.ctx[21];\r\n\t}\r\n}\r\n\r\nvar textToHTML = (text) => {\r\n    const html = text\r\n        // collapse space sequences\r\n        .replace(/ {2,}/g, ' ')\r\n        // handle non breaking space characters\r\n        .replace(/&/g, '&amp;')\r\n        .replace(/\\u00a0/g, '&nbsp;')\r\n        .replace(/</g, '&lt;')\r\n        .replace(/>/g, '&gt;')\r\n        // lines\r\n        .split('\\n')\r\n        // to br's\r\n        .join('<br>');\r\n    return html;\r\n};\r\n\r\nvar htmlToText = (html) => {\r\n    const text = replaceDivWithBr(html)\r\n        .split('<br>')\r\n        .join('\\n')\r\n        .replace(/&nbsp;/g, String.fromCharCode(160))\r\n        .replace(/&amp;/g, '&')\r\n        .replace(/&lt;/g, '<')\r\n        .replace(/&gt;/g, '>');\r\n    return text;\r\n};\r\n\r\nvar fromPercentage = (value, context) => isString(value) ? (parseFloat(value) / 100) * context : value;\r\n\r\nvar toPercentagePoint = (point, context) => ({\r\n    x: toPercentage(point.x, context.width),\r\n    y: toPercentage(point.y, context.height),\r\n});\r\n\r\n/* src/core/ui/components/ShapeLayoutEditor.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction get_each_context$3(ctx, list, i) {\r\n\tconst child_ctx = ctx.slice();\r\n\tchild_ctx[218] = list[i];\r\n\tchild_ctx[220] = i;\r\n\treturn child_ctx;\r\n}\r\n\r\n// (3442:12) {#each shapeNavList as item, index (item.id)}\r\nfunction create_each_block$3(key_1, ctx) {\r\n\tlet li;\r\n\tlet button;\r\n\tlet colorpreview;\r\n\tlet t0;\r\n\tlet span;\r\n\tlet t1_value = /*item*/ ctx[218].name + \"\";\r\n\tlet t1;\r\n\tlet button_aria_label_value;\r\n\tlet t2;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\tcolorpreview = new ColorPreview({\r\n\t\t\tprops: { color: /*item*/ ctx[218].color }\r\n\t\t});\r\n\r\n\tfunction click_handler() {\r\n\t\treturn /*click_handler*/ ctx[146](/*index*/ ctx[220]);\r\n\t}\r\n\r\n\treturn {\r\n\t\tkey: key_1,\r\n\t\tfirst: null,\r\n\t\tc() {\r\n\t\t\tli = element(\"li\");\r\n\t\t\tbutton = element(\"button\");\r\n\t\t\tcreate_component(colorpreview.$$.fragment);\r\n\t\t\tt0 = space();\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt1 = text(t1_value);\r\n\t\t\tt2 = space();\r\n\t\t\tattr(button, \"class\", \"PinturaShapeListItem\");\r\n\t\t\tattr(button, \"type\", \"button\");\r\n\t\t\tattr(button, \"aria-label\", button_aria_label_value = \"Select shape \" + /*item*/ ctx[218].name);\r\n\t\t\tthis.first = li;\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, li, anchor);\r\n\t\t\tappend(li, button);\r\n\t\t\tmount_component(colorpreview, button, null);\r\n\t\t\tappend(button, t0);\r\n\t\t\tappend(button, span);\r\n\t\t\tappend(span, t1);\r\n\t\t\tappend(li, t2);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = listen(button, \"click\", click_handler);\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\t\t\tconst colorpreview_changes = {};\r\n\t\t\tif (dirty[0] & /*shapeNavList*/ 524288) colorpreview_changes.color = /*item*/ ctx[218].color;\r\n\t\t\tcolorpreview.$set(colorpreview_changes);\r\n\t\t\tif ((!current || dirty[0] & /*shapeNavList*/ 524288) && t1_value !== (t1_value = /*item*/ ctx[218].name + \"\")) set_data(t1, t1_value);\r\n\r\n\t\t\tif (!current || dirty[0] & /*shapeNavList*/ 524288 && button_aria_label_value !== (button_aria_label_value = \"Select shape \" + /*item*/ ctx[218].name)) {\r\n\t\t\t\tattr(button, \"aria-label\", button_aria_label_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(colorpreview.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(colorpreview.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(li);\r\n\t\t\tdestroy_component(colorpreview);\r\n\t\t\tmounted = false;\r\n\t\t\tdispose();\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3458:4) {#if shouldRenderShapeManipulator}\r\nfunction create_if_block_4$2(ctx) {\r\n\tlet shapemanipulator;\r\n\tlet current;\r\n\r\n\tshapemanipulator = new ShapeManipulator({\r\n\t\t\tprops: {\r\n\t\t\t\tvisible: true,\r\n\t\t\t\tpoints: /*shapeManipulatorPoints*/ ctx[10],\r\n\t\t\t\trotatorPoint: /*shapeManipulatorRotationPointPosition*/ ctx[25],\r\n\t\t\t\tenableDragEdges: /*allowEdgeControls*/ ctx[15],\r\n\t\t\t\tenableDragPoints: /*allowCornerControls*/ ctx[27],\r\n\t\t\t\tenableRotatePoints: /*allowRotateControls*/ ctx[13]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tshapemanipulator.$on(\"resizestart\", /*handleManipulatorResizeGrab*/ ctx[35]);\r\n\tshapemanipulator.$on(\"resizemove\", /*handleManipulatorResizeDrag*/ ctx[36]);\r\n\tshapemanipulator.$on(\"resizeend\", /*handleManipulatorResizeEnd*/ ctx[37]);\r\n\tshapemanipulator.$on(\"rotatestart\", /*handleManipulatorRotateGrab*/ ctx[38]);\r\n\tshapemanipulator.$on(\"rotatemove\", /*handleManipulatorRotateDrag*/ ctx[39]);\r\n\tshapemanipulator.$on(\"rotateend\", /*handleManipulatorRotateEnd*/ ctx[40]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(shapemanipulator.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(shapemanipulator, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst shapemanipulator_changes = {};\r\n\t\t\tif (dirty[0] & /*shapeManipulatorPoints*/ 1024) shapemanipulator_changes.points = /*shapeManipulatorPoints*/ ctx[10];\r\n\t\t\tif (dirty[0] & /*shapeManipulatorRotationPointPosition*/ 33554432) shapemanipulator_changes.rotatorPoint = /*shapeManipulatorRotationPointPosition*/ ctx[25];\r\n\t\t\tif (dirty[0] & /*allowEdgeControls*/ 32768) shapemanipulator_changes.enableDragEdges = /*allowEdgeControls*/ ctx[15];\r\n\t\t\tif (dirty[0] & /*allowCornerControls*/ 134217728) shapemanipulator_changes.enableDragPoints = /*allowCornerControls*/ ctx[27];\r\n\t\t\tif (dirty[0] & /*allowRotateControls*/ 8192) shapemanipulator_changes.enableRotatePoints = /*allowRotateControls*/ ctx[13];\r\n\t\t\tshapemanipulator.$set(shapemanipulator_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(shapemanipulator.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(shapemanipulator.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(shapemanipulator, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3475:4) {#if shouldRenderTextInput}\r\nfunction create_if_block_1$2(ctx) {\r\n\tlet current_block_type_index;\r\n\tlet if_block;\r\n\tlet if_block_anchor;\r\n\tlet current;\r\n\tconst if_block_creators = [create_if_block_2$2, create_if_block_3$2];\r\n\tconst if_blocks = [];\r\n\r\n\tfunction select_block_type(ctx, dirty) {\r\n\t\tif (/*textInputMode*/ ctx[4] === 'modal') return 0;\r\n\t\tif (/*textInputMode*/ ctx[4] === 'inline') return 1;\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tif (~(current_block_type_index = select_block_type(ctx))) {\r\n\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tif_block_anchor = empty();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (~current_block_type_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].m(target, anchor);\r\n\t\t\t}\r\n\r\n\t\t\tinsert(target, if_block_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tlet previous_block_index = current_block_type_index;\r\n\t\t\tcurrent_block_type_index = select_block_type(ctx);\r\n\r\n\t\t\tif (current_block_type_index === previous_block_index) {\r\n\t\t\t\tif (~current_block_type_index) {\r\n\t\t\t\t\tif_blocks[current_block_type_index].p(ctx, dirty);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\t\ttransition_out(if_blocks[previous_block_index], 1, 1, () => {\r\n\t\t\t\t\t\tif_blocks[previous_block_index] = null;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tcheck_outros();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (~current_block_type_index) {\r\n\t\t\t\t\tif_block = if_blocks[current_block_type_index];\r\n\r\n\t\t\t\t\tif (!if_block) {\r\n\t\t\t\t\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t\t\t\t\t\tif_block.c();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif_block.p(ctx, dirty);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(if_block_anchor.parentNode, if_block_anchor);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (~current_block_type_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].d(detaching);\r\n\t\t\t}\r\n\r\n\t\t\tif (detaching) detach(if_block_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3499:45) \r\nfunction create_if_block_3$2(ctx) {\r\n\tlet div;\r\n\tlet contenteditable;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\tlet contenteditable_props = {\r\n\t\tformatInput: /*formatContentEditable*/ ctx[42],\r\n\t\twrapLines: !!/*activeMarkupComputed*/ ctx[12].width,\r\n\t\tallowNewline: /*shapeAllowNewline*/ ctx[26],\r\n\t\tstyle: /*textInputTextStyles*/ ctx[24]\r\n\t};\r\n\r\n\tcontenteditable = new ContentEditable({ props: contenteditable_props });\r\n\t/*contenteditable_binding*/ ctx[149](contenteditable);\r\n\tcontenteditable.$on(\"input\", /*handleTextInput*/ ctx[43]);\r\n\tcontenteditable.$on(\"keyup\", /*handleTextInputKeyUp*/ ctx[46]);\r\n\tcontenteditable.$on(\"cancel\", /*handleTextCancel*/ ctx[48]);\r\n\tcontenteditable.$on(\"confirm\", /*handleTextConfirm*/ ctx[47]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tcreate_component(contenteditable.$$.fragment);\r\n\t\t\tattr(div, \"class\", \"PinturaInlineInput\");\r\n\t\t\tattr(div, \"style\", /*textInputPositionStyles*/ ctx[23]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tmount_component(contenteditable, div, null);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = listen(div, \"focusout\", /*focusout_handler*/ ctx[150]);\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst contenteditable_changes = {};\r\n\t\t\tif (dirty[0] & /*activeMarkupComputed*/ 4096) contenteditable_changes.wrapLines = !!/*activeMarkupComputed*/ ctx[12].width;\r\n\t\t\tif (dirty[0] & /*shapeAllowNewline*/ 67108864) contenteditable_changes.allowNewline = /*shapeAllowNewline*/ ctx[26];\r\n\t\t\tif (dirty[0] & /*textInputTextStyles*/ 16777216) contenteditable_changes.style = /*textInputTextStyles*/ ctx[24];\r\n\t\t\tcontenteditable.$set(contenteditable_changes);\r\n\r\n\t\t\tif (!current || dirty[0] & /*textInputPositionStyles*/ 8388608) {\r\n\t\t\t\tattr(div, \"style\", /*textInputPositionStyles*/ ctx[23]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(contenteditable.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(contenteditable.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\t/*contenteditable_binding*/ ctx[149](null);\r\n\t\t\tdestroy_component(contenteditable);\r\n\t\t\tmounted = false;\r\n\t\t\tdispose();\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3476:8) {#if textInputMode === 'modal'}\r\nfunction create_if_block_2$2(ctx) {\r\n\tlet inputform;\r\n\tlet current;\r\n\r\n\tinputform = new InputForm({\r\n\t\t\tprops: {\r\n\t\t\t\tpanelOffset: /*offset*/ ctx[2],\r\n\t\t\t\tonconfirm: /*handleTextConfirm*/ ctx[47],\r\n\t\t\t\toncancel: /*handleTextCancel*/ ctx[48],\r\n\t\t\t\tlabelCancel: /*locale*/ ctx[5].shapeLabelInputCancel,\r\n\t\t\t\ticonCancel: /*locale*/ ctx[5].shapeIconInputCancel,\r\n\t\t\t\tlabelConfirm: /*locale*/ ctx[5].shapeLabelInputConfirm,\r\n\t\t\t\ticonConfirm: /*locale*/ ctx[5].shapeIconInputConfirm,\r\n\t\t\t\t$$slots: { default: [create_default_slot$6] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(inputform.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(inputform, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst inputform_changes = {};\r\n\t\t\tif (dirty[0] & /*offset*/ 4) inputform_changes.panelOffset = /*offset*/ ctx[2];\r\n\t\t\tif (dirty[0] & /*locale*/ 32) inputform_changes.labelCancel = /*locale*/ ctx[5].shapeLabelInputCancel;\r\n\t\t\tif (dirty[0] & /*locale*/ 32) inputform_changes.iconCancel = /*locale*/ ctx[5].shapeIconInputCancel;\r\n\t\t\tif (dirty[0] & /*locale*/ 32) inputform_changes.labelConfirm = /*locale*/ ctx[5].shapeLabelInputConfirm;\r\n\t\t\tif (dirty[0] & /*locale*/ 32) inputform_changes.iconConfirm = /*locale*/ ctx[5].shapeIconInputConfirm;\r\n\r\n\t\t\tif (dirty[0] & /*textInputTextStyles, textInput, textInputText*/ 20971648 | dirty[7] & /*$$scope*/ 16) {\r\n\t\t\t\tinputform_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tinputform.$set(inputform_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(inputform.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(inputform.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(inputform, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3477:12) <InputForm                 panelOffset={offset}                 onconfirm={handleTextConfirm}                 oncancel={handleTextCancel}                 labelCancel={locale.shapeLabelInputCancel}                 iconCancel={locale.shapeIconInputCancel}                 labelConfirm={locale.shapeLabelInputConfirm}                 iconConfirm={locale.shapeIconInputConfirm}             >\r\nfunction create_default_slot$6(ctx) {\r\n\tlet textarea;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\ttextarea = element(\"textarea\");\r\n\t\t\tattr(textarea, \"spellcheck\", \"false\");\r\n\t\t\tattr(textarea, \"autocorrect\", \"off\");\r\n\t\t\tattr(textarea, \"autocapitalize\", \"off\");\r\n\t\t\tattr(textarea, \"style\", /*textInputTextStyles*/ ctx[24]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, textarea, anchor);\r\n\t\t\t/*textarea_binding*/ ctx[147](textarea);\r\n\t\t\tset_input_value(textarea, /*textInputText*/ ctx[22]);\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(textarea, \"keydown\", /*handleTextInputKeyDown*/ ctx[45]),\r\n\t\t\t\t\tlisten(textarea, \"keypress\", /*handleTextInputAttempt*/ ctx[44]),\r\n\t\t\t\t\tlisten(textarea, \"keyup\", /*handleTextInputKeyUp*/ ctx[46]),\r\n\t\t\t\t\tlisten(textarea, \"input\", /*handleTextInput*/ ctx[43]),\r\n\t\t\t\t\tlisten(textarea, \"input\", /*textarea_input_handler*/ ctx[148])\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[0] & /*textInputTextStyles*/ 16777216) {\r\n\t\t\t\tattr(textarea, \"style\", /*textInputTextStyles*/ ctx[24]);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty[0] & /*textInputText*/ 4194304) {\r\n\t\t\t\tset_input_value(textarea, /*textInputText*/ ctx[22]);\r\n\t\t\t}\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(textarea);\r\n\t\t\t/*textarea_binding*/ ctx[147](null);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (3523:4) {#if $markupControlsOpacity > 0}\r\nfunction create_if_block$2(ctx) {\r\n\tlet div;\r\n\tlet dynamiccomponenttree;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\tdynamiccomponenttree = new DynamicComponentTree_1({\r\n\t\t\tprops: {\r\n\t\t\t\titems: /*shapeControls*/ ctx[20],\r\n\t\t\t\tkey: /*activeShapeId*/ ctx[9]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tcreate_component(dynamiccomponenttree.$$.fragment);\r\n\t\t\tattr(div, \"class\", \"PinturaShapeControls\");\r\n\t\t\tattr(div, \"style\", /*markupControlsStyle*/ ctx[21]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tmount_component(dynamiccomponenttree, div, null);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(div, \"measure\", /*measure_handler_1*/ ctx[151]),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst dynamiccomponenttree_changes = {};\r\n\t\t\tif (dirty[0] & /*shapeControls*/ 1048576) dynamiccomponenttree_changes.items = /*shapeControls*/ ctx[20];\r\n\t\t\tif (dirty[0] & /*activeShapeId*/ 512) dynamiccomponenttree_changes.key = /*activeShapeId*/ ctx[9];\r\n\t\t\tdynamiccomponenttree.$set(dynamiccomponenttree_changes);\r\n\r\n\t\t\tif (!current || dirty[0] & /*markupControlsStyle*/ 2097152) {\r\n\t\t\t\tattr(div, \"style\", /*markupControlsStyle*/ ctx[21]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(dynamiccomponenttree.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(dynamiccomponenttree.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tdestroy_component(dynamiccomponenttree);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$f(ctx) {\r\n\tlet div;\r\n\tlet nav;\r\n\tlet ul;\r\n\tlet each_blocks = [];\r\n\tlet each_1_lookup = new Map();\r\n\tlet t0;\r\n\tlet t1;\r\n\tlet t2;\r\n\tlet interactable_action;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tlet each_value = /*shapeNavList*/ ctx[19];\r\n\tconst get_key = ctx => /*item*/ ctx[218].id;\r\n\r\n\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\tlet child_ctx = get_each_context$3(ctx, each_value, i);\r\n\t\tlet key = get_key(child_ctx);\r\n\t\teach_1_lookup.set(key, each_blocks[i] = create_each_block$3(key, child_ctx));\r\n\t}\r\n\r\n\tlet if_block0 = /*shouldRenderShapeManipulator*/ ctx[14] && create_if_block_4$2(ctx);\r\n\tlet if_block1 = /*shouldRenderTextInput*/ ctx[11] && create_if_block_1$2(ctx);\r\n\tlet if_block2 = /*$markupControlsOpacity*/ ctx[16] > 0 && create_if_block$2(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tnav = element(\"nav\");\r\n\t\t\tul = element(\"ul\");\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].c();\r\n\t\t\t}\r\n\r\n\t\t\tt0 = space();\r\n\t\t\tif (if_block0) if_block0.c();\r\n\t\t\tt1 = space();\r\n\t\t\tif (if_block1) if_block1.c();\r\n\t\t\tt2 = space();\r\n\t\t\tif (if_block2) if_block2.c();\r\n\t\t\tattr(nav, \"class\", \"PinturaShapeList\");\r\n\t\t\tattr(nav, \"data-visible\", /*showShapeList*/ ctx[17]);\r\n\t\t\tattr(div, \"class\", \"PinturaShapeEditor\");\r\n\t\t\tattr(div, \"tabindex\", \"0\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tappend(div, nav);\r\n\t\t\tappend(nav, ul);\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].m(ul, null);\r\n\t\t\t}\r\n\r\n\t\t\tappend(div, t0);\r\n\t\t\tif (if_block0) if_block0.m(div, null);\r\n\t\t\tappend(div, t1);\r\n\t\t\tif (if_block1) if_block1.m(div, null);\r\n\t\t\tappend(div, t2);\r\n\t\t\tif (if_block2) if_block2.m(div, null);\r\n\t\t\t/*div_binding*/ ctx[152](div);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(nav, \"focusin\", /*handleFocusIn*/ ctx[51]),\r\n\t\t\t\t\tlisten(nav, \"focusout\", /*handleFocusOut*/ ctx[52]),\r\n\t\t\t\t\tlisten(div, \"keydown\", function () {\r\n\t\t\t\t\t\tif (is_function(/*disabled*/ ctx[1] ? noop$1 : /*handleKey*/ ctx[41])) (/*disabled*/ ctx[1] ? noop$1 : /*handleKey*/ ctx[41]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(div, \"nudge\", function () {\r\n\t\t\t\t\t\tif (is_function(/*disabled*/ ctx[1] ? noop$1 : /*handleNudge*/ ctx[50])) (/*disabled*/ ctx[1] ? noop$1 : /*handleNudge*/ ctx[50]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(div, \"measure\", /*measure_handler*/ ctx[145]),\r\n\t\t\t\t\tlisten(div, \"pointermove\", function () {\r\n\t\t\t\t\t\tif (is_function(/*disabled*/ ctx[1]\r\n\t\t\t\t\t\t? noop$1\r\n\t\t\t\t\t\t: /*handlePointerMove*/ ctx[53])) (/*disabled*/ ctx[1]\r\n\t\t\t\t\t\t? noop$1\r\n\t\t\t\t\t\t: /*handlePointerMove*/ ctx[53]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(div, \"interactionstart\", function () {\r\n\t\t\t\t\t\tif (is_function(/*disabled*/ ctx[1]\r\n\t\t\t\t\t\t? noop$1\r\n\t\t\t\t\t\t: /*handleInteractionStart*/ ctx[30])) (/*disabled*/ ctx[1]\r\n\t\t\t\t\t\t? noop$1\r\n\t\t\t\t\t\t: /*handleInteractionStart*/ ctx[30]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(div, \"interactionupdate\", function () {\r\n\t\t\t\t\t\tif (is_function(/*disabled*/ ctx[1]\r\n\t\t\t\t\t\t? noop$1\r\n\t\t\t\t\t\t: /*handleInteractionUpdate*/ ctx[32])) (/*disabled*/ ctx[1]\r\n\t\t\t\t\t\t? noop$1\r\n\t\t\t\t\t\t: /*handleInteractionUpdate*/ ctx[32]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(div, \"interactioncancel\", function () {\r\n\t\t\t\t\t\tif (is_function(/*disabled*/ ctx[1]\r\n\t\t\t\t\t\t? noop$1\r\n\t\t\t\t\t\t: /*handleInteractionCancel*/ ctx[31])) (/*disabled*/ ctx[1]\r\n\t\t\t\t\t\t? noop$1\r\n\t\t\t\t\t\t: /*handleInteractionCancel*/ ctx[31]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(div, \"interactionrelease\", function () {\r\n\t\t\t\t\t\tif (is_function(/*disabled*/ ctx[1]\r\n\t\t\t\t\t\t? noop$1\r\n\t\t\t\t\t\t: /*handleInteractionRelease*/ ctx[33])) (/*disabled*/ ctx[1]\r\n\t\t\t\t\t\t? noop$1\r\n\t\t\t\t\t\t: /*handleInteractionRelease*/ ctx[33]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(div, \"interactionend\", function () {\r\n\t\t\t\t\t\tif (is_function(/*disabled*/ ctx[1]\r\n\t\t\t\t\t\t? noop$1\r\n\t\t\t\t\t\t: /*handleInteractionEnd*/ ctx[34])) (/*disabled*/ ctx[1]\r\n\t\t\t\t\t\t? noop$1\r\n\t\t\t\t\t\t: /*handleInteractionEnd*/ ctx[34]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div)),\r\n\t\t\t\t\taction_destroyer(nudgeable.call(null, div)),\r\n\t\t\t\t\taction_destroyer(interactable_action = interactable.call(null, div, {\r\n\t\t\t\t\t\tdrag: true,\r\n\t\t\t\t\t\tinertia: true,\r\n\t\t\t\t\t\tmultiTouch: false,\r\n\t\t\t\t\t\tshouldStartInteraction: interactable_function,\r\n\t\t\t\t\t\tgetEventPosition: /*interactable_function_1*/ ctx[153]\r\n\t\t\t\t\t}))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\r\n\t\t\tif (dirty[0] & /*shapeNavList, selectShape, markup*/ 524353) {\r\n\t\t\t\teach_value = /*shapeNavList*/ ctx[19];\r\n\t\t\t\tgroup_outros();\r\n\t\t\t\teach_blocks = update_keyed_each(each_blocks, dirty, get_key, 1, ctx, each_value, each_1_lookup, ul, outro_and_destroy_block, create_each_block$3, null, get_each_context$3);\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[0] & /*showShapeList*/ 131072) {\r\n\t\t\t\tattr(nav, \"data-visible\", /*showShapeList*/ ctx[17]);\r\n\t\t\t}\r\n\r\n\t\t\tif (/*shouldRenderShapeManipulator*/ ctx[14]) {\r\n\t\t\t\tif (if_block0) {\r\n\t\t\t\t\tif_block0.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[0] & /*shouldRenderShapeManipulator*/ 16384) {\r\n\t\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block0 = create_if_block_4$2(ctx);\r\n\t\t\t\t\tif_block0.c();\r\n\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\tif_block0.m(div, t1);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block0) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block0, 1, 1, () => {\r\n\t\t\t\t\tif_block0 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (/*shouldRenderTextInput*/ ctx[11]) {\r\n\t\t\t\tif (if_block1) {\r\n\t\t\t\t\tif_block1.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[0] & /*shouldRenderTextInput*/ 2048) {\r\n\t\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block1 = create_if_block_1$2(ctx);\r\n\t\t\t\t\tif_block1.c();\r\n\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\tif_block1.m(div, t2);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block1) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block1, 1, 1, () => {\r\n\t\t\t\t\tif_block1 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (/*$markupControlsOpacity*/ ctx[16] > 0) {\r\n\t\t\t\tif (if_block2) {\r\n\t\t\t\t\tif_block2.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[0] & /*$markupControlsOpacity*/ 65536) {\r\n\t\t\t\t\t\ttransition_in(if_block2, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block2 = create_if_block$2(ctx);\r\n\t\t\t\t\tif_block2.c();\r\n\t\t\t\t\ttransition_in(if_block2, 1);\r\n\t\t\t\t\tif_block2.m(div, null);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block2) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block2, 1, 1, () => {\r\n\t\t\t\t\tif_block2 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (interactable_action && is_function(interactable_action.update) && dirty[0] & /*rootRect*/ 8) interactable_action.update.call(null, {\r\n\t\t\t\tdrag: true,\r\n\t\t\t\tinertia: true,\r\n\t\t\t\tmultiTouch: false,\r\n\t\t\t\tshouldStartInteraction: interactable_function,\r\n\t\t\t\tgetEventPosition: /*interactable_function_1*/ ctx[153]\r\n\t\t\t});\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\r\n\t\t\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\t\t\ttransition_in(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\ttransition_in(if_block0);\r\n\t\t\ttransition_in(if_block1);\r\n\t\t\ttransition_in(if_block2);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\ttransition_out(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\ttransition_out(if_block0);\r\n\t\t\ttransition_out(if_block1);\r\n\t\t\ttransition_out(if_block2);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].d();\r\n\t\t\t}\r\n\r\n\t\t\tif (if_block0) if_block0.d();\r\n\t\t\tif (if_block1) if_block1.d();\r\n\t\t\tif (if_block2) if_block2.d();\r\n\t\t\t/*div_binding*/ ctx[152](null);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nconst POLYGON_END_PATH_DISTANCE_SQUARED = 256;\r\nconst POLYGON_VERTEX_MIN_DISTANCE_SQUARED = 100;\r\nconst ROTATION_CONTROL_OFFSET = 20;\r\nconst MIN_TEXT_MARKUP_WIDTH = 10;\r\nconst markupHoverShapeId = 'markup-hover';\r\nconst shapeControlDist = 16;\r\nconst interactable_function = (e, element) => e.target === element;\r\n\r\nfunction instance$f($$self, $$props, $$invalidate) {\r\n\tlet activeMarkup;\r\n\tlet activeMarkupSelected;\r\n\tlet activeShapeIsDraft;\r\n\tlet activeShapeId;\r\n\tlet activeMarkupComputed;\r\n\tlet activeMarkupItemIsDraft;\r\n\tlet shapeActivePoints;\r\n\tlet allowResizeControls;\r\n\tlet allowRotateControls;\r\n\tlet allowEdgeControls;\r\n\tlet allowCornerControls;\r\n\tlet shouldRenderShapeManipulator;\r\n\tlet shapeActiveScreenPoints;\r\n\tlet shapeManipulatorPoints;\r\n\tlet shapeAllowNewline;\r\n\tlet shapeManipulatorRotationPoint;\r\n\tlet shapeManipulatorRotationPointPosition;\r\n\tlet currentPointerPosition;\r\n\tlet isTextMarkupSelected;\r\n\tlet shouldRenderTextInput;\r\n\tlet textShapeOrigin;\r\n\tlet textShapeDisplayOrigin;\r\n\tlet textSizeDisplayOrigin;\r\n\tlet textRectDisplayOrigin;\r\n\tlet textInputText;\r\n\tlet textInputTextStyles;\r\n\tlet textInputPositionStyles;\r\n\tlet controlledMarkupItem;\r\n\tlet allowShapeFlip;\r\n\tlet allowShapeChangeTextLayout;\r\n\tlet allowShapeDuplicate;\r\n\tlet allowShapeRemove;\r\n\tlet allowShapeReorder;\r\n\tlet allowShapeInput;\r\n\tlet allowShapeAdjustOpacity;\r\n\tlet markupControlsAnchorPosition;\r\n\tlet shapeControlsPosition;\r\n\tlet markupControlsStyle;\r\n\tlet shapeControls;\r\n\tlet shapeNavList;\r\n\tlet $markupControlsOpacity;\r\n\tlet $isAnimated;\r\n\tlet $keysPressedStored;\r\n\tlet { uid = getUniqueId() } = $$props;\r\n\tlet { ui } = $$props;\r\n\tlet { disabled = false } = $$props;\r\n\tlet { markup } = $$props;\r\n\tlet { offset } = $$props;\r\n\tlet { contextRotation = 0 } = $$props;\r\n\tlet { contextFlipX = false } = $$props;\r\n\tlet { contextFlipY = false } = $$props;\r\n\tlet { contextZoom = 1 } = $$props;\r\n\tlet { active = false } = $$props;\r\n\tlet { opacity = 1 } = $$props;\r\n\tlet { parentRect } = $$props;\r\n\tlet { rootRect } = $$props;\r\n\tlet { utilRect } = $$props;\r\n\tlet { hoverColor } = $$props;\r\n\tlet { textInputMode = 'inline' } = $$props;\r\n\tlet { oninteractionstart = noop$1 } = $$props;\r\n\tlet { oninteractionupdate = noop$1 } = $$props;\r\n\tlet { oninteractionrelease = noop$1 } = $$props;\r\n\tlet { oninteractionend = noop$1 } = $$props;\r\n\tlet { oninteractioncancel = noop$1 } = $$props;\r\n\tlet { onaddshape = noop$1 } = $$props;\r\n\tlet { onupdateshape = noop$1 } = $$props;\r\n\tlet { onselectshape = noop$1 } = $$props;\r\n\tlet { onremoveshape = noop$1 } = $$props;\r\n\tlet { ontapshape = noop$1 } = $$props;\r\n\tlet { onhovershape = noop$1 } = $$props;\r\n\tlet { onhovercanvas = noop$1 } = $$props;\r\n\tlet { ontapcanvas = noop$1 } = $$props;\r\n\tlet { beforeSelectShape = () => true } = $$props;\r\n\tlet { beforeDeselectShape = () => true } = $$props;\r\n\tlet { beforeRemoveShape = () => true } = $$props;\r\n\tlet { beforeUpdateShape = (shape, props) => props } = $$props;\r\n\tlet { willRenderShapeControls = passthrough } = $$props;\r\n\tlet { willStartInteraction = (position, rect) => true } = $$props;\r\n\tlet { mapEditorPointToImagePoint } = $$props;\r\n\tlet { mapImagePointToEditorPoint } = $$props;\r\n\tlet { eraseRadius = undefined } = $$props;\r\n\tlet { selectRadius = undefined } = $$props;\r\n\tlet { enableButtonFlipVertical = false } = $$props;\r\n\tlet { enableTapToAddText = true } = $$props;\r\n\tlet { locale } = $$props;\r\n\tconst isAnimated = getContext('isAnimated');\r\n\tcomponent_subscribe($$self, isAnimated, value => $$invalidate(144, $isAnimated = value));\r\n\r\n\t//\r\n\t// Cache\r\n\t//\r\n\tconst updateShape = (shape, props, parentRect) => {\r\n\t\tlet propsToUpdate = beforeUpdateShape({ ...shape }, props, { ...parentRect });\r\n\t\tshapeUpdateProps(shape, propsToUpdate, parentRect);\r\n\t};\r\n\r\n\tconst snapRelativeToAnchor = (anchor, target) => {\r\n\t\tconst length = vectorDistance(anchor, target);\r\n\t\tconst angle = vectorAngleBetween(anchor, target);\r\n\t\tconst angleSnapInterval = Math.PI / 8;\r\n\t\tconst angleSnapped = angleSnapInterval * Math.round(angle / angleSnapInterval) - contextRotation % angleSnapInterval;\r\n\t\ttarget.x = anchor.x + length * Math.cos(angleSnapped);\r\n\t\ttarget.y = anchor.y + length * Math.sin(angleSnapped);\r\n\t};\r\n\r\n\t//#region polygon helpers\r\n\tconst circleOverlapsWithLine = (point, radius, from, to) => {\r\n\t\tconst ac = vectorCreate(point.x - from.x, point.y - from.y);\r\n\t\tconst ab = vectorCreate(to.x - from.x, to.y - from.y);\r\n\t\tconst ab2 = vectorDot(ab, ab);\r\n\t\tconst acab = vectorDot(ac, ab);\r\n\t\tlet t = acab / ab2;\r\n\t\tt = t < 0 ? 0 : t;\r\n\t\tt = t > 1 ? 1 : t;\r\n\t\tconst h = vectorCreate(ab.x * t + from.x - point.x, ab.y * t + from.y - point.y);\r\n\t\tconst h2 = vectorDot(h, h);\r\n\t\treturn h2 <= radius * radius;\r\n\t};\r\n\r\n\tconst circleOverlapsWithPath = (position, radius, points) => {\r\n\t\tconst l = points.length;\r\n\r\n\t\tfor (let i = 0; i < l - 1; i++) {\r\n\t\t\tif (circleOverlapsWithLine(position, radius, points[i], points[i + 1])) return true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t};\r\n\r\n\tconst circleOverlapsWithPolygon = (position, radius, points) => {\r\n\t\tif (pointInPoly$1(position, points)) return true;\r\n\t\tif (circleOverlapsWithPath(position, radius, points)) return true;\r\n\t\treturn circleOverlapsWithLine(position, radius, points[0], points[points.length - 1]);\r\n\t};\r\n\r\n\tconst circleOverlapsWithEllipse = (position, radius, ellipse, rotation, flipX, flipY) => {\r\n\t\tconst points = ellipseToPolygon(vectorCreate(ellipse.x, ellipse.y), ellipse.rx, ellipse.ry, rotation, flipX, flipY, 12);\r\n\t\treturn circleOverlapsWithPolygon(position, radius, points);\r\n\t};\r\n\r\n\tconst circleOverlapsWithRect = (position, radius, rect, rotation, pivot) => circleOverlapsWithPolygon(position, radius, rectRotate(rect, rotation, pivot || rectCenter(rect)));\r\n\r\n\tconst shapeToPoly = (computedShape, resolution = 12) => {\r\n\t\tif (shapeIsRect(computedShape)) {\r\n\t\t\treturn rectRotate(computedShape, computedShape.rotation, rectCenter(computedShape));\r\n\t\t} else if (shapeIsText(computedShape)) {\r\n\t\t\tconst computedRect = getMarkupShapeRect(computedShape);\r\n\t\t\treturn rectRotate(computedRect, computedShape.rotation, rectCenter(computedRect));\r\n\t\t} else if (shapeIsEllipse(computedShape)) {\r\n\t\t\treturn ellipseToPolygon(vectorCreate(computedShape.x, computedShape.y), computedShape.rx, computedShape.ry, computedShape.rotation, computedShape.flipX, computedShape.flipY, resolution);\r\n\t\t}\r\n\r\n\t\treturn [];\r\n\t};\r\n\r\n\t//#endregion\r\n\t//#region createShape eraseShape\r\n\tconst keysPressedStored = getContext('keysPressed');\r\n\r\n\tcomponent_subscribe($$self, keysPressedStored, value => $$invalidate(166, $keysPressedStored = value));\r\n\r\n\t// draw shape manipulator edges\r\n\tconst getShapeUpdateRotation = (rotation, flipX, flipY) => {\r\n\t\tif (rotation === 0) return rotation;\r\n\t\tif (flipX && flipY) return rotation;\r\n\t\tif (flipX) return -rotation;\r\n\t\tif (flipY) return -rotation;\r\n\t\treturn rotation;\r\n\t};\r\n\r\n\tconst createShape = (shapeDefault, options = {}) => {\r\n\t\t// state\r\n\t\tlet interactionOrigin;\r\n\r\n\t\tlet interactionRadius;\r\n\t\tlet interactionPosition;\r\n\t\tlet isEllipse = shapeIsEllipse(shapeDefault);\r\n\t\tlet isText = shapeIsText(shapeDefault);\r\n\t\tlet isRelative = options.position === 'relative';\r\n\t\tconst isSteppedInputMode = options.inputMode === 'step';\r\n\r\n\t\tif (shapeIsPath(shapeDefault)) {\r\n\t\t\t// stepped input mode\r\n\t\t\tif (isSteppedInputMode) {\r\n\t\t\t\tlet isFirstPoint = false;\r\n\r\n\t\t\t\tconst getPoint = (previousPoint, pointerPosition) => {\r\n\t\t\t\t\t// has started drawing? only handle end\r\n\t\t\t\t\tconst draft = getMarkupItemDraft();\r\n\r\n\t\t\t\t\t// if has previous point\r\n\t\t\t\t\tconst previousPointComputed = previousPoint && vectorCreate(fromPercentage(previousPoint.x, parentRect.width), fromPercentage(previousPoint.y, parentRect.height));\r\n\r\n\t\t\t\t\t// point in editor view\r\n\t\t\t\t\tconst previousPointInEditor = previousPointComputed && mapImagePointToEditorPoint(previousPointComputed);\r\n\r\n\t\t\t\t\t// if shift is held snap to last point\r\n\t\t\t\t\tif ($keysPressedStored.includes(16) && previousPointInEditor) snapRelativeToAnchor(previousPointInEditor, pointerPosition);\r\n\r\n\t\t\t\t\tconst currentPoint = mapEditorPointToImagePoint(pointerPosition);\r\n\r\n\t\t\t\t\t// get first point as absolute\r\n\t\t\t\t\tconst originPoint = draft.points.length ? draft.points[0] : currentPoint;\r\n\r\n\t\t\t\t\tconst originPointComputed = vectorCreate(fromPercentage(originPoint.x, parentRect.width), fromPercentage(originPoint.y, parentRect.height));\r\n\r\n\t\t\t\t\t// point in editor view\r\n\t\t\t\t\tconst originPointInEditor = mapImagePointToEditorPoint(originPointComputed);\r\n\r\n\t\t\t\t\t// distance between origin and new point\r\n\t\t\t\t\tconst distFromOriginSquared = vectorDistanceSquared(originPointInEditor, pointerPosition);\r\n\r\n\t\t\t\t\t// clicked second point at same location, discard draft\r\n\t\t\t\t\tif (!isFirstPoint && draft.points.length === 1 && distFromOriginSquared < 36) {\r\n\t\t\t\t\t\treturn discardMarkupItemDraft();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// minimum of three points to create a polygon\r\n\t\t\t\t\tif (draft.points.length > 2 && distFromOriginSquared <= POLYGON_END_PATH_DISTANCE_SQUARED) {\r\n\t\t\t\t\t\tdraft.pathClose = true;\r\n\r\n\t\t\t\t\t\t// select the draft\r\n\t\t\t\t\t\tselectShape(draft);\r\n\r\n\t\t\t\t\t\tconst shape = confirmMarkupItemDraft();\r\n\t\t\t\t\t\tonaddshape(shape);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// clicked at same location as previous point, confirm as line\r\n\t\t\t\t\tconst hasVisibleStroke = draft.strokeWidth && draft.strokeColor && (draft.strokeColor[3] === undefined || draft.strokeColor[3] > 0);\r\n\r\n\t\t\t\t\tconst distFromPreviousSquared = vectorDistanceSquared(previousPointInEditor, pointerPosition);\r\n\r\n\t\t\t\t\tif (hasVisibleStroke && draft.points.length > 1 && distFromPreviousSquared < POLYGON_END_PATH_DISTANCE_SQUARED) {\r\n\t\t\t\t\t\t// open path\r\n\t\t\t\t\t\tdraft.pathClose = false;\r\n\r\n\t\t\t\t\t\tdraft.backgroundColor = [0, 0, 0, 0];\r\n\r\n\t\t\t\t\t\t// select the draft\r\n\t\t\t\t\t\tselectShape(draft);\r\n\r\n\t\t\t\t\t\tconst shape = confirmMarkupItemDraft();\r\n\t\t\t\t\t\tonaddshape(shape);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// distance between previous and new point needs to be sufficient\r\n\t\t\t\t\tif (draft.points.length > 0) {\r\n\t\t\t\t\t\tif (distFromPreviousSquared < POLYGON_VERTEX_MIN_DISTANCE_SQUARED) return;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// return new point!\r\n\t\t\t\t\treturn isRelative\r\n\t\t\t\t\t? toPercentagePoint(currentPoint, parentRect)\r\n\t\t\t\t\t: currentPoint;\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tstart: e => {\r\n\t\t\t\t\t\tconst { origin } = e.detail;\r\n\t\t\t\t\t\tinteractionRadius = 4;\r\n\t\t\t\t\t\tinteractionOrigin = vectorClone(origin);\r\n\t\t\t\t\t\tinteractionPosition = vectorClone(origin);\r\n\r\n\t\t\t\t\t\t// has started drawing? only handle end\r\n\t\t\t\t\t\tconst draft = getMarkupItemDraft();\r\n\r\n\t\t\t\t\t\tif (draft) {\r\n\t\t\t\t\t\t\t// add next point\r\n\t\t\t\t\t\t\tconst previousPoint = draft.points[draft.points.length - 1];\r\n\r\n\t\t\t\t\t\t\tconst computedPoint = getPoint(previousPoint, interactionOrigin);\r\n\t\t\t\t\t\t\tif (computedPoint) draft.points = [...draft.points, computedPoint];\r\n\t\t\t\t\t\t\treturn syncShapes();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// first point\r\n\t\t\t\t\t\tisFirstPoint = true;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tupdate: e => {\r\n\t\t\t\t\t\t// this only runs for first point so we can drag to start AND tap to start a path\r\n\t\t\t\t\t\tif (!isFirstPoint) return;\r\n\r\n\t\t\t\t\t\t// get draft ref\r\n\t\t\t\t\t\tconst draft = getMarkupItemDraft();\r\n\r\n\t\t\t\t\t\tif (!draft) return;\r\n\r\n\t\t\t\t\t\t// get next point\r\n\t\t\t\t\t\tconst previousPoint = draft.points[0];\r\n\r\n\t\t\t\t\t\tconst computedPoint = getPoint(previousPoint, vectorCreate(interactionOrigin.x + e.detail.translation.x, interactionOrigin.y + e.detail.translation.y));\r\n\t\t\t\t\t\tif (!computedPoint) return;\r\n\r\n\t\t\t\t\t\t// first point is pointerdown, keep overwriting next point\r\n\t\t\t\t\t\tdraft.points[1] = computedPoint;\r\n\r\n\t\t\t\t\t\t// update view\r\n\t\t\t\t\t\tsyncShapes();\r\n\t\t\t\t\t},\r\n\t\t\t\t\trelease: e => e.detail.preventInertia(),\r\n\t\t\t\t\tcancel: e => discardMarkupItemDraft(),\r\n\t\t\t\t\tend: e => {\r\n\t\t\t\t\t\tif (!isFirstPoint) return;\r\n\r\n\t\t\t\t\t\t// hasn't started drawing yet, let's add origin\r\n\t\t\t\t\t\tconst originPoint = mapEditorPointToImagePoint(interactionOrigin);\r\n\r\n\t\t\t\t\t\tconst computedPoint = isRelative\r\n\t\t\t\t\t\t? toPercentagePoint(originPoint, parentRect)\r\n\t\t\t\t\t\t: originPoint;\r\n\r\n\t\t\t\t\t\t// if is tap\r\n\t\t\t\t\t\tconst { isTap } = e.detail;\r\n\r\n\t\t\t\t\t\tif (isTap) {\r\n\t\t\t\t\t\t\t// if any shape below pointer select the shape and discard the path\r\n\t\t\t\t\t\t\tconst foundShapes = getShapesNearPosition(originPoint, 0, shapeCanSelect);\r\n\r\n\t\t\t\t\t\t\tif (foundShapes.length) return discardMarkupItemDraft();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// add to markup so it's drawn\r\n\t\t\t\t\t\taddMarkupItemDraft({ ...shapeDefault, points: [computedPoint] });\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// drag input mode\r\n\t\t\treturn {\r\n\t\t\t\tstart: e => {\r\n\t\t\t\t\tconst { origin } = e.detail;\r\n\t\t\t\t\tinteractionRadius = 4;\r\n\t\t\t\t\tinteractionOrigin = vectorClone(origin);\r\n\t\t\t\t\tinteractionPosition = vectorClone(origin);\r\n\t\t\t\t\tconst originPoint = mapEditorPointToImagePoint(origin);\r\n\r\n\t\t\t\t\tconst computedPoint = isRelative\r\n\t\t\t\t\t? toPercentagePoint(originPoint, parentRect)\r\n\t\t\t\t\t: originPoint;\r\n\r\n\t\t\t\t\t// add to markup so it's drawn\r\n\t\t\t\t\taddMarkupItemDraft({ ...shapeDefault, points: [computedPoint] });\r\n\t\t\t\t},\r\n\t\t\t\tupdate: e => {\r\n\t\t\t\t\tconst draft = getMarkupItemDraft();\r\n\t\t\t\t\tconst { translation } = e.detail;\r\n\r\n\t\t\t\t\t// position\r\n\t\t\t\t\tconst pointerPosition = vectorCreate(interactionOrigin.x + translation.x, interactionOrigin.y + translation.y);\r\n\r\n\t\t\t\t\t// distance between interaction and pointer if it's too close, we don't draw this point\r\n\t\t\t\t\tconst dist = vectorDistance(interactionPosition, pointerPosition);\r\n\r\n\t\t\t\t\tif (fixPrecision(dist, 5) <= interactionRadius) return;\r\n\r\n\t\t\t\t\t// get angle between interaction and pointer\r\n\t\t\t\t\tconst angle = vectorAngleBetween(pointerPosition, interactionPosition);\r\n\r\n\t\t\t\t\t// move brush towards pointer at angle\r\n\t\t\t\t\tconst moveDist = interactionRadius - dist;\r\n\r\n\t\t\t\t\tinteractionPosition.x += moveDist * Math.cos(angle);\r\n\t\t\t\t\tinteractionPosition.y += moveDist * Math.sin(angle);\r\n\r\n\t\t\t\t\t// create point\r\n\t\t\t\t\tconst point = mapEditorPointToImagePoint(interactionPosition);\r\n\r\n\t\t\t\t\tconst computedPoint = isRelative\r\n\t\t\t\t\t? toPercentagePoint(point, parentRect)\r\n\t\t\t\t\t: point;\r\n\r\n\t\t\t\t\tdraft.points = draft.points.concat(computedPoint);\r\n\t\t\t\t\tsyncShapes();\r\n\t\t\t\t},\r\n\t\t\t\trelease: e => e.detail.preventInertia(),\r\n\t\t\t\tcancel: e => {\r\n\t\t\t\t\tdiscardMarkupItemDraft();\r\n\t\t\t\t},\r\n\t\t\t\tend: e => {\r\n\t\t\t\t\tif (e.detail.isTap) return discardMarkupItemDraft();\r\n\t\t\t\t\tconst shape = confirmMarkupItemDraft();\r\n\t\t\t\t\tonaddshape(shape);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t} else if (isEllipse || isText || shapeIsRect(shapeDefault)) {\r\n\t\t\treturn {\r\n\t\t\t\tstart: e => {\r\n\t\t\t\t\tconst { origin } = e.detail;\r\n\r\n\t\t\t\t\t// need to remember origin so we can correctly apply interaction translation\r\n\t\t\t\t\tinteractionOrigin = vectorClone(origin);\r\n\r\n\t\t\t\t\tconst mappedOriginPosition = mapEditorPointToImagePoint(interactionOrigin);\r\n\r\n\t\t\t\t\tconst computedOriginPosition = isRelative\r\n\t\t\t\t\t? toPercentagePoint(mappedOriginPosition, parentRect)\r\n\t\t\t\t\t: mappedOriginPosition;\r\n\r\n\t\t\t\t\tconst rotation = -1 * getShapeUpdateRotation(contextRotation, contextFlipX, contextFlipY);\r\n\r\n\t\t\t\t\t// add to markup so it's drawn\r\n\t\t\t\t\tconst draft = {\r\n\t\t\t\t\t\t...shapeDefault,\r\n\t\t\t\t\t\trotation,\r\n\t\t\t\t\t\t...computedOriginPosition\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// de-flip shape\r\n\t\t\t\t\tdraft.flipX = contextFlipX;\r\n\r\n\t\t\t\t\tdraft.flipY = contextFlipY;\r\n\r\n\t\t\t\t\t// remove position\r\n\t\t\t\t\tdelete draft.position;\r\n\r\n\t\t\t\t\t// hide initially\r\n\t\t\t\t\tdraft.opacity = 0;\r\n\r\n\t\t\t\t\t// set base position props\r\n\t\t\t\t\tconst initProps = isEllipse ? ['rx', 'ry'] : ['width', 'height'];\r\n\r\n\t\t\t\t\tinitProps.forEach(prop => {\r\n\t\t\t\t\t\t// skip existing props\r\n\t\t\t\t\t\t// if (hasProp(draft, prop)) return;\r\n\t\t\t\t\t\t// set base props\r\n\t\t\t\t\t\tdraft[prop] = isRelative ? '0%' : 0;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\taddMarkupItemDraft(draft);\r\n\t\t\t\t},\r\n\t\t\t\tupdate: e => {\r\n\t\t\t\t\tconst draft = getMarkupItemDraft();\r\n\t\t\t\t\tdraft.opacity = 1;\r\n\t\t\t\t\tconst { aspectRatio } = draft;\r\n\t\t\t\t\tlet { translation } = e.detail;\r\n\r\n\t\t\t\t\t// limit to aspect ratio\r\n\t\t\t\t\tif (aspectRatio) {\r\n\t\t\t\t\t\tconst t = Math.abs(translation.x) * aspectRatio;\r\n\t\t\t\t\t\ttranslation.x = translation.x;\r\n\t\t\t\t\t\ttranslation.y = t * Math.sign(translation.y);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// position\r\n\t\t\t\t\tconst pointerPosition = vectorCreate(interactionOrigin.x + translation.x, interactionOrigin.y + translation.y);\r\n\r\n\t\t\t\t\tconst mappedOriginPosition = mapEditorPointToImagePoint(interactionOrigin);\r\n\t\t\t\t\tconst mappedPointerPosition = mapEditorPointToImagePoint(pointerPosition);\r\n\r\n\t\t\t\t\tconst pivot = {\r\n\t\t\t\t\t\tx: mappedOriginPosition.x + (mappedPointerPosition.x - mappedOriginPosition.x) * 0.5,\r\n\t\t\t\t\t\ty: mappedOriginPosition.y + (mappedPointerPosition.y - mappedOriginPosition.y) * 0.5\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tconst rotation = getShapeUpdateRotation(contextRotation, contextFlipX, contextFlipY);\r\n\t\t\t\t\tvectorRotate(mappedOriginPosition, rotation, pivot);\r\n\t\t\t\t\tvectorRotate(mappedPointerPosition, rotation, pivot);\r\n\t\t\t\t\tconst l = Math.min(mappedOriginPosition.x, mappedPointerPosition.x);\r\n\t\t\t\t\tconst t = Math.min(mappedOriginPosition.y, mappedPointerPosition.y);\r\n\t\t\t\t\tconst r = Math.max(mappedOriginPosition.x, mappedPointerPosition.x);\r\n\t\t\t\t\tconst b = Math.max(mappedOriginPosition.y, mappedPointerPosition.y);\r\n\t\t\t\t\tlet width = r - l;\r\n\t\t\t\t\tlet height = b - t;\r\n\t\t\t\t\tlet props = {};\r\n\r\n\t\t\t\t\tif (isEllipse) {\r\n\t\t\t\t\t\tprops.x = l + width * 0.5;\r\n\t\t\t\t\t\tprops.y = t + height * 0.5;\r\n\t\t\t\t\t\tprops.rx = width * 0.5;\r\n\t\t\t\t\t\tprops.ry = height * 0.5;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tprops.x = l;\r\n\t\t\t\t\t\tprops.y = t;\r\n\t\t\t\t\t\tprops.width = width;\r\n\t\t\t\t\t\tprops.height = height;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tupdateShape(draft, props, parentRect);\r\n\t\t\t\t\tsyncShapes();\r\n\t\t\t\t},\r\n\t\t\t\trelease: e => {\r\n\t\t\t\t\te.detail.preventInertia();\r\n\t\t\t\t},\r\n\t\t\t\tcancel: e => {\r\n\t\t\t\t\tdiscardMarkupItemDraft();\r\n\t\t\t\t},\r\n\t\t\t\tend: e => {\r\n\t\t\t\t\tconst draft = getMarkupItemDraft();\r\n\r\n\t\t\t\t\tif (e.detail.isTap) {\r\n\t\t\t\t\t\t// will cancel if is not text shape\r\n\t\t\t\t\t\tif (!shapeIsText(draft) || !enableTapToAddText || interactionTarget) return discardMarkupItemDraft();\r\n\r\n\t\t\t\t\t\t// will add 'auto' text shape if not targetting other shape\r\n\t\t\t\t\t\tdelete draft.width;\r\n\r\n\t\t\t\t\t\tdelete draft.height;\r\n\t\t\t\t\t\tif (draft.disableNewline !== false) delete draft.textAlign;\r\n\r\n\t\t\t\t\t\t// position the shape correctly\r\n\t\t\t\t\t\tconst draftComputedShape = shapeComputeDisplay({ ...draft }, parentRect);\r\n\r\n\t\t\t\t\t\tconst size = textToSize(draft.text, draftComputedShape);\r\n\r\n\t\t\t\t\t\tconst mappedOriginPosition = mapEditorPointToImagePoint({\r\n\t\t\t\t\t\t\tx: interactionOrigin.x,\r\n\t\t\t\t\t\t\ty: interactionOrigin.y - size.height * 0.5\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tconst mappedPointerPosition = mapEditorPointToImagePoint({\r\n\t\t\t\t\t\t\tx: interactionOrigin.x + size.width,\r\n\t\t\t\t\t\t\ty: interactionOrigin.y + size.height * 0.5\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tconst pivot = {\r\n\t\t\t\t\t\t\tx: mappedOriginPosition.x + (mappedPointerPosition.x - mappedOriginPosition.x) * 0.5,\r\n\t\t\t\t\t\t\ty: mappedOriginPosition.y + (mappedPointerPosition.y - mappedOriginPosition.y) * 0.5\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tconst rotation = getShapeUpdateRotation(contextRotation, contextFlipX, contextFlipY);\r\n\t\t\t\t\t\tvectorRotate(mappedOriginPosition, rotation, pivot);\r\n\t\t\t\t\t\tvectorRotate(mappedPointerPosition, rotation, pivot);\r\n\t\t\t\t\t\tconst l = Math.min(mappedOriginPosition.x, mappedPointerPosition.x);\r\n\t\t\t\t\t\tconst t = Math.min(mappedOriginPosition.y, mappedPointerPosition.y);\r\n\r\n\t\t\t\t\t\tdraft.x = isString(draft.x)\r\n\t\t\t\t\t\t? toPercentage(l, parentRect.width)\r\n\t\t\t\t\t\t: l;\r\n\r\n\t\t\t\t\t\tdraft.y = isString(draft.y)\r\n\t\t\t\t\t\t? toPercentage(t, parentRect.height)\r\n\t\t\t\t\t\t: t;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// reveal\r\n\t\t\t\t\tdraft.opacity = 1;\r\n\r\n\t\t\t\t\t// finish markup\r\n\t\t\t\t\tif (!shapeIsText(draft)) {\r\n\t\t\t\t\t\tconst shape = confirmMarkupItemDraft();\r\n\t\t\t\t\t\tonaddshape(shape);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// select the draft\r\n\t\t\t\t\tselectShape(draft);\r\n\r\n\t\t\t\t\t// also enable editing the text\r\n\t\t\t\t\tif (shapeIsText(draft)) editMarkupItem(draft);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t} else if (shapeIsLine(shapeDefault)) {\r\n\t\t\treturn {\r\n\t\t\t\tstart: e => {\r\n\t\t\t\t\tconst { origin } = e.detail;\r\n\t\t\t\t\tconst originMapped = mapEditorPointToImagePoint(origin);\r\n\t\t\t\t\tconst originSnapped = vectorApply(originMapped, snapToPixel);\r\n\t\t\t\t\tinteractionOrigin = vectorClone(origin);\r\n\r\n\t\t\t\t\t// add to markup so it's drawn\r\n\t\t\t\t\taddMarkupItemDraft({\r\n\t\t\t\t\t\t...shapeDefault,\r\n\t\t\t\t\t\tx1: isRelative\r\n\t\t\t\t\t\t? toPercentage(originSnapped.x, parentRect.width)\r\n\t\t\t\t\t\t: originSnapped.x,\r\n\t\t\t\t\t\ty1: isRelative\r\n\t\t\t\t\t\t? toPercentage(originSnapped.y, parentRect.height)\r\n\t\t\t\t\t\t: originSnapped.y,\r\n\t\t\t\t\t\tx2: isRelative\r\n\t\t\t\t\t\t? toPercentage(originSnapped.x, parentRect.width)\r\n\t\t\t\t\t\t: originSnapped.x,\r\n\t\t\t\t\t\ty2: isRelative\r\n\t\t\t\t\t\t? toPercentage(originSnapped.y, parentRect.height)\r\n\t\t\t\t\t\t: originSnapped.y,\r\n\t\t\t\t\t\topacity: 0\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tupdate: e => {\r\n\t\t\t\t\tconst draft = getMarkupItemDraft();\r\n\t\t\t\t\tconst { translation } = e.detail;\r\n\t\t\t\t\tconst interactionTarget = vectorAdd(vectorClone(interactionOrigin), translation);\r\n\r\n\t\t\t\t\t// shift pressed\r\n\t\t\t\t\tif ($keysPressedStored.includes(16)) {\r\n\t\t\t\t\t\tconst length = vectorDistance(interactionOrigin, interactionTarget);\r\n\t\t\t\t\t\tconst angle = vectorAngleBetween(interactionOrigin, interactionTarget);\r\n\t\t\t\t\t\tconst angleSnapInterval = Math.PI / 4;\r\n\t\t\t\t\t\tconst angleSnapped = angleSnapInterval * Math.round(angle / angleSnapInterval);\r\n\t\t\t\t\t\tinteractionTarget.x = interactionOrigin.x + length * Math.cos(angleSnapped);\r\n\t\t\t\t\t\tinteractionTarget.y = interactionOrigin.y + length * Math.sin(angleSnapped);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// update line end position\r\n\t\t\t\t\tconst point = mapEditorPointToImagePoint(interactionTarget);\r\n\r\n\t\t\t\t\tupdateMarkupShape(draft, {\r\n\t\t\t\t\t\tx2: isRelative\r\n\t\t\t\t\t\t? toPercentage(point.x, parentRect.width)\r\n\t\t\t\t\t\t: point.x,\r\n\t\t\t\t\t\ty2: isRelative\r\n\t\t\t\t\t\t? toPercentage(point.y, parentRect.height)\r\n\t\t\t\t\t\t: point.y,\r\n\t\t\t\t\t\topacity: 1\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tsyncShapes();\r\n\t\t\t\t},\r\n\t\t\t\trelease: e => e.detail.preventInertia(),\r\n\t\t\t\tcancel: e => {\r\n\t\t\t\t\tdiscardMarkupItemDraft();\r\n\t\t\t\t},\r\n\t\t\t\tend: e => {\r\n\t\t\t\t\tconst draft = getMarkupItemDraft();\r\n\t\t\t\t\tif (e.detail.isTap) return discardMarkupItemDraft();\r\n\t\t\t\t\tdraft.opacity = 1;\r\n\r\n\t\t\t\t\t// finish markup\r\n\t\t\t\t\tconst shape = confirmMarkupItemDraft();\r\n\r\n\t\t\t\t\tonaddshape(shape);\r\n\r\n\t\t\t\t\t// select the draft\r\n\t\t\t\t\tselectShape(shape);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n\r\n\tconst eraseShape = () => {\r\n\t\tlet origin;\r\n\t\tlet positionPrevious;\r\n\t\tconst eraseRadiusSquared = eraseRadius * eraseRadius;\r\n\r\n\t\tconst erase = (positionA, positionB, forceErase = false) => {\r\n\t\t\tconst d2 = vectorDistanceSquared(positionA, positionB);\r\n\r\n\t\t\t// skip, too close to previous point\r\n\t\t\tif (!forceErase && d2 < 2) return false;\r\n\r\n\t\t\tconst shapesThatCanBeErased = markup.filter(shape => !shape.disableErase);\r\n\r\n\t\t\t// if line is shorter than radius do simple erase operation, find all points within range from current position\r\n\t\t\tlet shapesFound;\r\n\r\n\t\t\tif (d2 < eraseRadiusSquared) {\r\n\t\t\t\tshapesFound = getShapesNearPosition(mapEditorPointToImagePoint(positionB), eraseRadius);\r\n\t\t\t} else {\r\n\t\t\t\tshapesFound = getShapesBetweenPoints(shapesThatCanBeErased, mapEditorPointToImagePoint(positionA), mapEditorPointToImagePoint(positionB), eraseRadius);\r\n\t\t\t}\r\n\r\n\t\t\tconst shapesRemoved = removeMarkupItems(shapesFound);\r\n\t\t\tshapesRemoved.forEach(onremoveshape);\r\n\t\t\treturn true;\r\n\t\t};\r\n\r\n\t\treturn {\r\n\t\t\tstart: e => {\r\n\t\t\t\torigin = vectorCreate(Math.round(e.detail.origin.x), Math.round(e.detail.origin.y));\r\n\t\t\t\terase(origin, origin, true);\r\n\t\t\t\tpositionPrevious = origin;\r\n\t\t\t},\r\n\t\t\tupdate: e => {\r\n\t\t\t\tconst { translation } = e.detail;\r\n\t\t\t\tconst positionCurrent = vectorCreate(Math.round(origin.x + translation.x), Math.round(origin.y + translation.y));\r\n\r\n\t\t\t\tif (erase(positionPrevious, positionCurrent)) {\r\n\t\t\t\t\tpositionPrevious = vectorClone(positionCurrent);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\trelease: e => e.detail.preventInertia(),\r\n\t\t\tend: () => {\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n\t//#endregion\r\n\t//\r\n\t// Mapping coordinates\r\n\t//\r\n\tconst getImagePointWithScreenTranslation = (point, translation) => {\r\n\t\tconst pointInScreenSpace = mapImagePointToEditorPoint(point);\r\n\t\treturn mapEditorPointToImagePoint(vectorAdd(pointInScreenSpace, translation));\r\n\t};\r\n\r\n\t//\r\n\t// Interaction\r\n\t//\r\n\t//#region translateShape rotateShape resizeShape\r\n\tconst translateShape = (shapeCurrent, shapeOriginComputed, translation) => {\r\n\t\tif (shapeIsLine(shapeCurrent)) {\r\n\t\t\tconst beginImageOffset = getImagePointWithScreenTranslation(shapeLineGetStartPoint(shapeOriginComputed), translation);\r\n\t\t\tconst endImageOffset = getImagePointWithScreenTranslation(shapeLineGetEndPoint(shapeOriginComputed), translation);\r\n\r\n\t\t\tupdateShape(\r\n\t\t\t\tshapeCurrent,\r\n\t\t\t\t{\r\n\t\t\t\t\tx1: beginImageOffset.x,\r\n\t\t\t\t\ty1: beginImageOffset.y,\r\n\t\t\t\t\tx2: endImageOffset.x,\r\n\t\t\t\t\ty2: endImageOffset.y\r\n\t\t\t\t},\r\n\t\t\t\tparentRect\r\n\t\t\t);\r\n\t\t} else if (shapeCurrent.points) {\r\n\t\t\tupdateShape(\r\n\t\t\t\tshapeCurrent,\r\n\t\t\t\t{\r\n\t\t\t\t\tpoints: shapeOriginComputed.points.map(point => {\r\n\t\t\t\t\t\treturn getImagePointWithScreenTranslation(point, translation);\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t\tparentRect\r\n\t\t\t);\r\n\t\t} else if (shapeIsRect(shapeCurrent) || shapeIsText(shapeCurrent) || shapeIsEllipse(shapeCurrent)) {\r\n\t\t\tconst imagePoint = getImagePointWithScreenTranslation(shapeOriginComputed, translation);\r\n\t\t\tupdateShape(shapeCurrent, imagePoint, parentRect);\r\n\t\t}\r\n\r\n\t\tsyncShapes();\r\n\t};\r\n\r\n\tconst IndexFlipXMap = { 0: 1, 1: 0, 2: 3, 3: 2 };\r\n\tconst IndexFlipYMap = { 0: 3, 1: 2, 2: 1, 3: 0 };\r\n\r\n\tconst resizeShape = (shapeCurrent, shapeOriginComputed, indexes, translation, options) => {\r\n\t\t// is a line of points\r\n\t\tif (shapeIsLine(shapeCurrent) || shapeIsPath(shapeCurrent) && hasProp(shapeCurrent, 'pathClose')) {\r\n\t\t\tconst [targetIndex] = indexes;\r\n\r\n\t\t\tconst snap = $keysPressedStored.includes(16)\r\n\t\t\t? snapRelativeToAnchor\r\n\t\t\t: (_, target) => target;\r\n\r\n\t\t\tlet getPoint;\r\n\t\t\tlet snapPoint;\r\n\t\t\tlet setPoint;\r\n\r\n\t\t\tif (shapeIsLine(shapeCurrent)) {\r\n\t\t\t\t// start\r\n\t\t\t\tif (targetIndex === 0) {\r\n\t\t\t\t\tgetPoint = () => shapeLineGetStartPoint(shapeOriginComputed);\r\n\r\n\t\t\t\t\t// snap angle relative to opposite point\r\n\t\t\t\t\tsnapPoint = point => snap(shapeLineGetEndPoint(shapeOriginComputed), point);\r\n\r\n\t\t\t\t\tsetPoint = (shape, point) => {\r\n\t\t\t\t\t\tshape.x1 = point.x;\r\n\t\t\t\t\t\tshape.y1 = point.y;\r\n\t\t\t\t\t};\r\n\t\t\t\t} else // end\r\n\t\t\t\tif (targetIndex === 1) {\r\n\t\t\t\t\tgetPoint = () => shapeLineGetEndPoint(shapeOriginComputed);\r\n\r\n\t\t\t\t\t// snap angle relative to opposite point\r\n\t\t\t\t\tsnapPoint = point => snap(shapeLineGetStartPoint(shapeOriginComputed), point);\r\n\r\n\t\t\t\t\tsetPoint = (shape, point) => {\r\n\t\t\t\t\t\tshape.x2 = point.x;\r\n\t\t\t\t\t\tshape.y2 = point.y;\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst computedPoints = shapeOriginComputed.points;\r\n\t\t\t\tgetPoint = () => computedPoints[targetIndex];\r\n\r\n\t\t\t\tsnapPoint = point => {\r\n\t\t\t\t\tconst pointBefore = computedPoints[arrayIndexWrap(targetIndex - 1, computedPoints)];\r\n\t\t\t\t\tconst pointAfter = computedPoints[arrayIndexWrap(targetIndex + 1, computedPoints)];\r\n\t\t\t\t\tsnap(pointBefore, point);\r\n\t\t\t\t\tsnap(pointAfter, point);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tsetPoint = (shape, point) => shape.points[targetIndex] = point;\r\n\t\t\t}\r\n\r\n\t\t\tconst point = getImagePointWithScreenTranslation(getPoint(), translation);\r\n\t\t\tsnapPoint(point);\r\n\t\t\tsetPoint(shapeCurrent, point);\r\n\t\t} else // is a box\r\n\t\tif (shapeHasSize(shapeCurrent) || shapeIsEllipse(shapeCurrent) || shapeIsTextBox(shapeCurrent)) {\r\n\t\t\tlet hasAutoHeight = false;\r\n\t\t\tlet shapeOriginRect;\r\n\r\n\t\t\tif (shapeIsEllipse(shapeCurrent)) {\r\n\t\t\t\tshapeOriginRect = rectCreateFromEllipse(shapeOriginComputed);\r\n\t\t\t} else if (shapeHasSize(shapeCurrent)) {\r\n\t\t\t\tshapeOriginRect = rectCreateFromAny(shapeOriginComputed);\r\n\t\t\t} else {\r\n\t\t\t\t// is text with 'width' only\r\n\t\t\t\thasAutoHeight = true;\r\n\r\n\t\t\t\tshapeOriginRect = rectCreateFromAny(shapeOriginComputed);\r\n\t\t\t\tconst size = textToSize(shapeOriginComputed.text, shapeOriginComputed);\r\n\t\t\t\tshapeOriginRect.height = size.height;\r\n\t\t\t}\r\n\r\n\t\t\tlet shapeAspectRatio;\r\n\r\n\t\t\tif (shapeCurrent.aspectRatio) {\r\n\t\t\t\tshapeAspectRatio = shapeCurrent.aspectRatio;\r\n\t\t\t} else if (options.shiftKey && !hasAutoHeight) {\r\n\t\t\t\tshapeAspectRatio = shapeOriginRect.width / shapeOriginRect.height;\r\n\t\t\t}\r\n\r\n\t\t\t// current shape\r\n\t\t\tconst rectAligned = rectCreateFromAny(shapeOriginRect);\r\n\r\n\t\t\tconst rectAlignedCenterPosition = rectCenter(rectAligned);\r\n\t\t\tconst rectRotation = shapeCurrent.rotation;\r\n\t\t\tconst rectAlignedCorners = rectGetCorners(rectAligned);\r\n\t\t\tconst rectCorners = rectRotate(rectAligned, rectRotation);\r\n\r\n\t\t\t// is translating one corner\r\n\t\t\tif (indexes.length === 1) {\r\n\t\t\t\t// corner\r\n\t\t\t\tlet cornerIndex = indexes[0];\r\n\r\n\t\t\t\tif (shapeCurrent.flipX) cornerIndex = IndexFlipXMap[cornerIndex];\r\n\t\t\t\tif (shapeCurrent.flipY) cornerIndex = IndexFlipYMap[cornerIndex];\r\n\t\t\t\tconst [tl, tr, br, bl] = rectAlignedCorners;\r\n\t\t\t\tconst screenTargetPosition = mapImagePointToEditorPoint(rectCorners[cornerIndex]);\r\n\t\t\t\tvectorAdd(screenTargetPosition, translation);\r\n\t\t\t\tconst imageTargetPosition = mapEditorPointToImagePoint(screenTargetPosition);\r\n\t\t\t\tconst imageTargetTranslation = vectorCreate(imageTargetPosition.x - rectCorners[cornerIndex].x, imageTargetPosition.y - rectCorners[cornerIndex].y);\r\n\r\n\t\t\t\t// if (shapeCurrent.flipX) imageTargetTranslation.x = -imageTargetTranslation.x;\r\n\t\t\t\t// if (shapeCurrent.flipY) imageTargetTranslation.y = -imageTargetTranslation.y;\r\n\t\t\t\tconst imageTargetTranslationAligned = vectorRotate(vectorClone(imageTargetTranslation), -rectRotation);\r\n\r\n\t\t\t\tconst imageTargetPositionAligned = vectorCreate(rectAlignedCorners[cornerIndex].x + imageTargetTranslationAligned.x, rectAlignedCorners[cornerIndex].y + imageTargetTranslationAligned.y);\r\n\t\t\t\tlet anchor;\r\n\t\t\t\tif (cornerIndex === 0) anchor = br;\r\n\t\t\t\tif (cornerIndex === 1) anchor = bl;\r\n\t\t\t\tif (cornerIndex === 2) anchor = tl;\r\n\t\t\t\tif (cornerIndex === 3) anchor = tr;\r\n\r\n\t\t\t\t// create an aligned and updated rectangle\r\n\t\t\t\tconst rectAlignedResized = rectCreateFromPoints([anchor, imageTargetPositionAligned]);\r\n\r\n\t\t\t\t// limit rect\r\n\t\t\t\tif (shapeAspectRatio) {\r\n\t\t\t\t\t// get size that adheres to aspect ratio but still fits current rectangle\r\n\t\t\t\t\tconst { width, height } = rectContainRect(rectAlignedResized, shapeAspectRatio);\r\n\r\n\t\t\t\t\tconst [t, r, b, l] = rectToBounds(rectAlignedResized);\r\n\r\n\t\t\t\t\t// update size\r\n\t\t\t\t\trectAlignedResized.width = width;\r\n\r\n\t\t\t\t\trectAlignedResized.height = height;\r\n\r\n\t\t\t\t\t// align to anchor\r\n\t\t\t\t\tif (imageTargetPositionAligned.y < anchor.y) {\r\n\t\t\t\t\t\trectAlignedResized.y = b - height;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (imageTargetPositionAligned.x < anchor.x) {\r\n\t\t\t\t\t\trectAlignedResized.x = r - width;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// rotate the aligned rectangle around it's original pivot point\r\n\t\t\t\tconst rr = rectRotate(rectAlignedResized, rectRotation, rectAlignedCenterPosition);\r\n\r\n\t\t\t\t// now calculate the new center and then rotate the tl and br corners around that center to find their new positions\r\n\t\t\t\tconst rrc = vectorCenter(rr);\r\n\r\n\t\t\t\tconst p1 = vectorRotate(rr[0], -rectRotation, rrc);\r\n\t\t\t\tconst p2 = vectorRotate(rr[2], -rectRotation, rrc);\r\n\r\n\t\t\t\t// if (shapeCurrent.flipX || shapeCurrent.flipY) {\r\n\t\t\t\t//     vectorsFlip([p1, p2], shapeCurrent.flipX, shapeCurrent.flipY, rectAlignedCenterPosition.x, rectAlignedCenterPosition.y)\r\n\t\t\t\t// }\r\n\t\t\t\tconst rectUpdated = rectCreateFromPoints([p1, p2]);\r\n\r\n\t\t\t\tupdateShape(\r\n\t\t\t\t\tshapeCurrent,\r\n\t\t\t\t\tshapeIsEllipse(shapeCurrent)\r\n\t\t\t\t\t? ellipseCreateFromRect(rectUpdated)\r\n\t\t\t\t\t: rectUpdated,\r\n\t\t\t\t\tparentRect\r\n\t\t\t\t);\r\n\t\t\t} else // is translating two corner points\r\n\t\t\t{\r\n\t\t\t\t// 0-1 -> 2-3\r\n\t\t\t\t// 1-2 -> 3-0\r\n\t\t\t\t// 2-3 -> 0-1\r\n\t\t\t\t// 3-0 -> 1-2\r\n\t\t\t\tindexes = indexes.map(index => {\r\n\t\t\t\t\tif (shapeCurrent.flipX) index = IndexFlipXMap[index];\r\n\t\t\t\t\tif (shapeCurrent.flipY) index = IndexFlipYMap[index];\r\n\t\t\t\t\treturn index;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tconst [cornerA, cornerB] = indexes.map(index => rectCorners[index]);\r\n\r\n\t\t\t\tconst mid = {\r\n\t\t\t\t\tx: cornerA.x + (cornerB.x - cornerA.x) * 0.5,\r\n\t\t\t\t\ty: cornerA.y + (cornerB.y - cornerA.y) * 0.5\r\n\t\t\t\t};\r\n\r\n\t\t\t\tconst [cornerAlignedA, cornerAlignedB] = indexes.map(index => rectAlignedCorners[index]);\r\n\r\n\t\t\t\tconst [cornerAlignedC, cornerAlignedD] = indexes.map(index => {\r\n\t\t\t\t\tconst mappedIndex = index + 2;\r\n\t\t\t\t\tif (mappedIndex < 4) return rectAlignedCorners[mappedIndex];\r\n\t\t\t\t\treturn rectAlignedCorners[mappedIndex - 4];\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// const midAligned = {\r\n\t\t\t\t//     x: cornerAlignedA.x + (cornerAlignedB.x - cornerAlignedA.x) * .5,\r\n\t\t\t\t//     y: cornerAlignedA.y + (cornerAlignedB.y - cornerAlignedA.y) * .5\r\n\t\t\t\t// };\r\n\t\t\t\tconst midAnchorAligned = {\r\n\t\t\t\t\tx: cornerAlignedC.x + (cornerAlignedD.x - cornerAlignedC.x) * 0.5,\r\n\t\t\t\t\ty: cornerAlignedC.y + (cornerAlignedD.y - cornerAlignedC.y) * 0.5\r\n\t\t\t\t};\r\n\r\n\t\t\t\tconst screenTargetPosition = mapImagePointToEditorPoint(mid);\r\n\t\t\t\tvectorAdd(screenTargetPosition, translation);\r\n\t\t\t\tconst imageTargetPosition = mapEditorPointToImagePoint(screenTargetPosition);\r\n\t\t\t\tconst imageTargetTranslation = vectorCreate(imageTargetPosition.x - mid.x, imageTargetPosition.y - mid.y);\r\n\r\n\t\t\t\t// if (shapeCurrent.flipX) imageTargetTranslation.x = -imageTargetTranslation.x;\r\n\t\t\t\t// if (shapeCurrent.flipY) imageTargetTranslation.y = -imageTargetTranslation.y;\r\n\t\t\t\tconst imageTargetTranslationAligned = vectorRotate(vectorClone(imageTargetTranslation), -rectRotation);\r\n\r\n\t\t\t\t// const imageTargetPositionAligned = vectorCreate(\r\n\t\t\t\t//     midAligned.x + imageTargetTranslationAligned.x,\r\n\t\t\t\t//     midAligned.y + imageTargetTranslationAligned.y,\r\n\t\t\t\t// );\r\n\t\t\t\tconst d = vectorSubtract(vectorClone(cornerAlignedA), cornerAlignedB);\r\n\r\n\t\t\t\tconst f = vectorApply(d, v => 1 - Math.abs(Math.sign(v)));\r\n\t\t\t\tconst t = vectorCreate(imageTargetTranslationAligned.x * f.x, imageTargetTranslationAligned.y * f.y);\r\n\t\t\t\tvectorAdd(cornerAlignedA, t);\r\n\t\t\t\tvectorAdd(cornerAlignedB, t);\r\n\t\t\t\tconst rectAlignedResized = rectCreateFromPoints(rectAlignedCorners);\r\n\r\n\t\t\t\t// limit rect\r\n\t\t\t\tif (shapeAspectRatio) {\r\n\t\t\t\t\tlet width = rectAlignedResized.width;\r\n\t\t\t\t\tlet height = rectAlignedResized.height;\r\n\r\n\t\t\t\t\tif (f.y === 0) {\r\n\t\t\t\t\t\theight = width / shapeAspectRatio;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\twidth = height * shapeAspectRatio;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// update size\r\n\t\t\t\t\trectAlignedResized.width = width;\r\n\r\n\t\t\t\t\trectAlignedResized.height = height;\r\n\r\n\t\t\t\t\t// align to anchor\r\n\t\t\t\t\tif (f.y === 0) {\r\n\t\t\t\t\t\trectAlignedResized.y = midAnchorAligned.y - height * 0.5;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trectAlignedResized.x = midAnchorAligned.x - width * 0.5;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// rotate the aligned rectangle around it's original pivot point\r\n\t\t\t\tconst rr = rectRotate(rectAlignedResized, rectRotation, rectAlignedCenterPosition);\r\n\r\n\t\t\t\t// now calculate the new center and then rotate the tl and br corners around that center to find their new positions\r\n\t\t\t\tconst rrc = vectorCenter(rr);\r\n\r\n\t\t\t\tconst p1 = vectorRotate(rr[0], -rectRotation, rrc);\r\n\t\t\t\tconst p2 = vectorRotate(rr[2], -rectRotation, rrc);\r\n\r\n\t\t\t\t// if (shapeCurrent.flipX || shapeCurrent.flipY) {\r\n\t\t\t\t//     vectorsFlip([p1, p2], shapeCurrent.flipX, shapeCurrent.flipY, rectAlignedCenterPosition.x, rectAlignedCenterPosition.y)\r\n\t\t\t\t// }\r\n\t\t\t\tconst rectUpdated = rectCreateFromPoints([p1, p2]);\r\n\r\n\t\t\t\tlet props;\r\n\r\n\t\t\t\tif (shapeIsEllipse(shapeCurrent)) {\r\n\t\t\t\t\tprops = ellipseCreateFromRect(rectUpdated);\r\n\t\t\t\t} else if (shapeHasSize(shapeCurrent)) {\r\n\t\t\t\t\tprops = rectUpdated;\r\n\t\t\t\t} else if (hasAutoHeight) {\r\n\t\t\t\t\tprops = {\r\n\t\t\t\t\t\tx: rectUpdated.x,\r\n\t\t\t\t\t\ty: rectUpdated.y,\r\n\t\t\t\t\t\twidth: rectUpdated.width\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tupdateShape(shapeCurrent, props, parentRect);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// redraw\r\n\t\tsyncShapes();\r\n\t};\r\n\r\n\tlet rotatorInitialPosition;\r\n\r\n\tconst rotateShape = (shapeCurrent, shapeOriginComputed, translation, options) => {\r\n\t\t// calculate angle between translated rotation control and origin\r\n\t\tconst shapeRect = getMarkupShapeRect(shapeComputeDisplay(shapeDeepCopy(shapeCurrent), parentRect));\r\n\r\n\t\tconst shapeCenter = rectCenter(shapeRect);\r\n\t\tconst p = getImagePointWithScreenTranslation(rotatorInitialPosition, translation);\r\n\t\tlet shapeRotation = vectorAngleBetween(p, shapeCenter) + Math.PI / 2;\r\n\r\n\t\tif (options.shiftKey) {\r\n\t\t\tconst rotatorSnapInterval = Math.PI / 16;\r\n\t\t\tshapeRotation = rotatorSnapInterval * Math.round(shapeRotation / rotatorSnapInterval) - contextRotation % rotatorSnapInterval;\r\n\t\t}\r\n\r\n\t\tupdateShape(shapeCurrent, { rotation: shapeRotation }, parentRect);\r\n\t\tsyncShapes();\r\n\t};\r\n\r\n\tconst getMarkupItemDraft = () => {\r\n\t\tif (!markup.length) return;\r\n\t\treturn markup.find(shapeIsDraft);\r\n\t};\r\n\r\n\tconst getMarkupItemDraftIndex = () => {\r\n\t\tif (!markup.length) return;\r\n\t\treturn markup.findIndex(shapeIsDraft);\r\n\t};\r\n\r\n\tconst addMarkupItemDraft = (shape, sync = true) => {\r\n\t\tif (getMarkupItemDraft()) return;\r\n\t\tshapeMakeDraft(shape);\r\n\t\treturn addShape(shape, sync);\r\n\t};\r\n\r\n\tconst confirmMarkupItemDraft = () => {\r\n\t\tconst markupItem = getMarkupItemDraft();\r\n\t\tif (!markupItem) return;\r\n\t\tshapeMakeFinal(markupItem);\r\n\t\tsyncShapes();\r\n\t\treturn markupItem;\r\n\t};\r\n\r\n\tconst discardMarkupItemDraft = () => {\r\n\t\tif (!getMarkupItemDraft()) return;\r\n\t\tmarkup.splice(getMarkupItemDraftIndex(), 1);\r\n\t\tsyncShapes();\r\n\t};\r\n\r\n\tconst createMarkupItem = (props = {}) => ({ id: getUniqueId(), ...props });\r\n\tconst syncShapes = () => $$invalidate(0, markup);\r\n\r\n\tconst addShape = (shape, sync = true) => {\r\n\t\tmarkup.push(shape);\r\n\r\n\t\t// sync markup array\r\n\t\tif (sync) syncShapes();\r\n\r\n\t\treturn shape;\r\n\t};\r\n\r\n\tconst removeMarkupShapeProps = (shape, props = [], sync = true) => {\r\n\t\tprops.filter(Boolean).forEach(prop => delete shape[prop]);\r\n\r\n\t\t// sync markup array\r\n\t\tif (!sync) return;\r\n\r\n\t\tsyncShapes();\r\n\t};\r\n\r\n\tconst updateMarkupShape = (shape, props, sync = true) => {\r\n\t\t// update markup\r\n\t\tshape = Object.assign(shape, props);\r\n\r\n\t\t// sync markup array\r\n\t\tif (!sync) return;\r\n\r\n\t\tsyncShapes();\r\n\t};\r\n\r\n\tconst updateMarkupShapeProperty = (shape, name, value, sync = true) => {\r\n\t\tshape[name] = value;\r\n\r\n\t\t// sync markup array\r\n\t\tif (!sync) return;\r\n\r\n\t\tsyncShapes();\r\n\t};\r\n\r\n\tconst updateMarkupItemsShapeProperty = (name, value, sync = true) => {\r\n\t\tmarkup.forEach(shape => updateMarkupShapeProperty(shape, name, value, false));\r\n\r\n\t\t// sync markup array\r\n\t\tif (!sync) return;\r\n\r\n\t\tsyncShapes();\r\n\t};\r\n\r\n\tconst updateMarkupShapeItems = (props, sync = true) => {\r\n\t\tmarkup.forEach(markupItem => updateMarkupShape(markupItem, props, false));\r\n\r\n\t\t// sync markup array\r\n\t\tif (!sync) return;\r\n\r\n\t\tsyncShapes();\r\n\t};\r\n\r\n\tconst getActiveMarkupItem = () => [...markup].reverse().find(shapeIsSelected);\r\n\tconst hasActiveMarkupItem = () => !!getActiveMarkupItem();\r\n\r\n\tconst removeShape = shapeToRemove => {\r\n\t\tif (!beforeRemoveShape(shapeToRemove)) return false;\r\n\t\t$$invalidate(0, markup = markup.filter(shape => shape !== shapeToRemove));\r\n\t\tonremoveshape(shapeToRemove);\r\n\t};\r\n\r\n\tconst removeActiveMarkupItem = () => {\r\n\t\tconst activeShape = getActiveMarkupItem();\r\n\t\tif (!activeShape) return;\r\n\r\n\t\t// get removable markup items,\r\n\t\tconst removableShapes = markup.filter(shape => shapeCanRemove(shape) && shapeCanSelect(shape));\r\n\r\n\t\t// find index of active shape so we can select the next active shape on removal\r\n\t\tconst index = removableShapes.findIndex(shape => shape === activeShape);\r\n\r\n\t\t// remove the active ship from the shape array\r\n\t\tconst didRemove = removeShape(activeShape);\r\n\r\n\t\tif (didRemove === false) return;\r\n\r\n\t\t// remember selection\r\n\t\tpreviousSelectedShape = activeShape;\r\n\r\n\t\t// if no more markup items, release active shape\r\n\t\tif (removableShapes.length - 1 <= 0) return blurShapes();\r\n\r\n\t\t// select next active markup item\r\n\t\tconst indexNext = index - 1 < 0 ? removableShapes.length - 1 : index - 1;\r\n\r\n\t\tselectShape(removableShapes[indexNext]);\r\n\t};\r\n\r\n\tlet previousSelectedShape = undefined;\r\n\r\n\tconst blurShapes = (options = {}) => {\r\n\t\tconst { storePrevious = true } = options;\r\n\r\n\t\t// clear text state cache, when a text shape is blurred the changes are confirmed\r\n\t\tObject.keys(ShapeTextStateCache).forEach(key => ShapeTextStateCache[key] = {});\r\n\r\n\t\t// remember shape\r\n\t\tif (storePrevious) previousSelectedShape = getSelectedShape();\r\n\r\n\t\tupdateMarkupShapeItems({\r\n\t\t\tisSelected: false,\r\n\t\t\tisEditing: false,\r\n\t\t\t_prerender: false\r\n\t\t});\r\n\t};\r\n\r\n\tconst getSelectedShape = () => markup.find(shapeIsSelected);\r\n\r\n\tconst selectShape = (shape, sync = true) => {\r\n\t\t// can't select draft\r\n\t\tif (shapeIsDraft(shape)) return;\r\n\r\n\t\t// get currently selected shape\r\n\t\tconst selectedShapeCurrent = getSelectedShape();\r\n\r\n\t\tconst selectedShape = selectedShapeCurrent || previousSelectedShape;\r\n\r\n\t\t// was already selected\r\n\t\tconst wasSelectedShape = shapeIsSelected(shape);\r\n\r\n\t\t// reset previous selected shape\r\n\t\tpreviousSelectedShape = undefined;\r\n\r\n\t\t// if is returned false will cancel select operation\r\n\t\tif (!beforeSelectShape(selectedShape, shape)) return;\r\n\r\n\t\t// remove selected state from other markup\r\n\t\tblurShapes();\r\n\r\n\t\t// select\r\n\t\tshapeSelect(shape);\r\n\r\n\t\t// selected this shape\r\n\t\t!wasSelectedShape && onselectshape(shape);\r\n\r\n\t\t// sync\r\n\t\tif (!sync) return;\r\n\r\n\t\tsyncShapes();\r\n\t};\r\n\r\n\tconst deselectMarkupItem = markupItem => {\r\n\t\t// we're blurring an active text field, should confirm state if inline text editing\r\n\t\tif (textInput && markupItem.isEditing && textInput.confirm) textInput.confirm();\r\n\r\n\t\tupdateMarkupShape(markupItem, {\r\n\t\t\tisSelected: false,\r\n\t\t\tisEditing: false,\r\n\t\t\t_prerender: false\r\n\t\t});\r\n\t};\r\n\r\n\tconst editMarkupItem = markupItem => {\r\n\t\tupdateMarkupShape(markupItem, {\r\n\t\t\tisSelected: true,\r\n\t\t\tisEditing: true,\r\n\t\t\t_prerender: textInputMode === 'inline'\r\n\t\t});\r\n\t};\r\n\r\n\tconst finishEditMarkupItem = markupItem => {\r\n\t\tupdateMarkupShape(markupItem, {\r\n\t\t\tisSelected: true,\r\n\t\t\tisEditing: false,\r\n\t\t\t_prerender: false\r\n\t\t});\r\n\t};\r\n\r\n\tconst removeMarkupItems = shapesToRemove => {\r\n\t\tif (!shapesToRemove.length) return [];\r\n\t\tconst shapesToRemoveFiltered = shapesToRemove.filter(beforeRemoveShape);\r\n\t\t$$invalidate(0, markup = markup.filter(shape => !shapesToRemoveFiltered.includes(shape)));\r\n\t\treturn shapesToRemoveFiltered;\r\n\t};\r\n\r\n\tconst getTextShapeRect = shape => {\r\n\t\tconst size = textToSize(shape.text, shape);\r\n\r\n\t\treturn rectCreate(\r\n\t\t\tshape.x,\r\n\t\t\tshape.y,\r\n\t\t\tshape.width\r\n\t\t\t? Math.min(shape.width, size.width)\r\n\t\t\t: size.width,\r\n\t\t\tshape.height\r\n\t\t\t? Math.min(shape.height, size.height)\r\n\t\t\t: size.height\r\n\t\t);\r\n\t};\r\n\r\n\tconst getMarkupShapeRect = shape => {\r\n\t\t// has own rect\r\n\t\tif (shapeHasSize(shape)) return rectCreateFromAny(shape);\r\n\r\n\t\tif (shapeIsEllipse(shape)) return rectCreateFromEllipse(shape);\r\n\r\n\t\t// calculate the size on canvas\r\n\t\tconst rect = getTextShapeRect(shape);\r\n\r\n\t\trect.width = Math.max(MIN_TEXT_MARKUP_WIDTH, shape.width || rect.width);\r\n\t\treturn rect;\r\n\t};\r\n\r\n\tconst getShapesNearPosition = (position, range = 0, shapeFilter = () => true) => [...markup].// reverse the array, want to select from top to bottom\r\n\treverse().// filter out shapes we're not interested in\r\n\tfilter(shapeFilter).// need priority indicator\r\n\tmap(shape => ({ shape, priority: 1 })).// find markup near pointer\r\n\tfilter(result => {\r\n\t\t// get shape\r\n\t\tconst { shape } = result;\r\n\r\n\t\t// we need to know where the shape will end up\r\n\t\tconst computedShape = shapeComputeDisplay(shapeDeepCopy(shape), parentRect);\r\n\r\n\t\t// add stroke width to range\r\n\t\tconst r = range + (computedShape.strokeWidth || 0);\r\n\r\n\t\t// test if clicked in rect\r\n\t\tif (shapeIsRect(computedShape)) {\r\n\t\t\treturn circleOverlapsWithRect(position, r, computedShape, shape.rotation);\r\n\t\t}\r\n\r\n\t\t// test if clicked on text\r\n\t\tif (shapeIsText(computedShape)) {\r\n\t\t\tconst shapeRect = getMarkupShapeRect(computedShape);\r\n\t\t\tconst isPositionInBounds = circleOverlapsWithRect(position, r, shapeRect, shape.rotation);\r\n\t\t\tlet isPositionInVisual = false;\r\n\r\n\t\t\tif (isPositionInBounds && !shapeIsSelected(shape)) {\r\n\t\t\t\tconst visualRect = getTextShapeRect(computedShape);\r\n\r\n\t\t\t\tif (shape.textAlign === 'right' && !shape.flipX) {\r\n\t\t\t\t\tvisualRect.x = shapeRect.x + shapeRect.width - visualRect.width;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (shape.textAlign === 'center') {\r\n\t\t\t\t\tvisualRect.x = shapeRect.x + shapeRect.width * 0.5 - visualRect.width * 0.5;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tisPositionInVisual = circleOverlapsWithRect(position, r, visualRect, shape.rotation, rectCenter(shapeRect));\r\n\t\t\t\tif (!isPositionInVisual) result.priority = -1;\r\n\t\t\t}\r\n\r\n\t\t\treturn isPositionInBounds;\r\n\t\t}\r\n\r\n\t\t// test if click on ellipse\r\n\t\tif (shapeIsEllipse(computedShape)) {\r\n\t\t\treturn circleOverlapsWithEllipse(position, r, computedShape, shape.rotation, shape.flipX, shape.flipY);\r\n\t\t}\r\n\r\n\t\t// test if clicked on line\r\n\t\tif (shapeIsLine(computedShape)) {\r\n\t\t\t// radius around click position, test if line intersects\r\n\t\t\treturn circleOverlapsWithLine(position, Math.max(16, r), shapeLineGetStartPoint(computedShape), shapeLineGetEndPoint(computedShape)); // always increase range when selecting lines\r\n\t\t}\r\n\r\n\t\t// test if clicked inside polygon\r\n\t\tif (shapeIsPath(computedShape) && computedShape.pathClose) {\r\n\t\t\treturn circleOverlapsWithPolygon(position, r, computedShape.points);\r\n\t\t}\r\n\r\n\t\t// test if clicked on path\r\n\t\tif (shapeIsPath(computedShape)) {\r\n\t\t\t// radius around click position, test if line intersects\r\n\t\t\treturn circleOverlapsWithPath(position, Math.max(16, r), computedShape.points); // always increase range when selecting lines\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}).sort((a, b) => {\r\n\t\tif (a.priority < b.priority) return 1;\r\n\t\tif (a.priority > b.priority) return -1;\r\n\t\treturn 0;\r\n\t}).map(item => item.shape);\r\n\r\n\tconst getShapesBetweenPoints = (shapes, a, b, range = 0) => {\r\n\t\t// make sure range is not negative\r\n\t\tconst r = Math.abs(range);\r\n\r\n\t\t// create line\r\n\t\tconst line = lineCreate(a, b);\r\n\r\n\t\t// eraseLine should be in image space\r\n\t\tconst eraseLine = lineExtend(line, r);\r\n\r\n\t\t// create line polygon\r\n\t\tconst erasePoly = lineExtrude(eraseLine, r);\r\n\r\n\t\t// loop over shapes and find intersecting shapes\r\n\t\tconst res = shapes.filter(shape => {\r\n\t\t\tconst computedShape = shapeComputeDisplay(shapeDeepCopy(shape), parentRect);\r\n\r\n\t\t\t// if shape is line or path\r\n\t\t\tif (shapeIsLine(computedShape) || shapeIsPath(computedShape)) {\r\n\t\t\t\tconst points = computedShape.points\r\n\t\t\t\t? [...computedShape.points]\r\n\t\t\t\t: [\r\n\t\t\t\t\t\tshapeLineGetStartPoint(computedShape),\r\n\t\t\t\t\t\tshapeLineGetEndPoint(computedShape)\r\n\t\t\t\t\t];\r\n\r\n\t\t\t\treturn !!linePointsIntersection(eraseLine, points);\r\n\t\t\t}\r\n\r\n\t\t\t// else turn into polygon and compare polygons\r\n\t\t\treturn polyIntersectsWithPoly(erasePoly, shapeToPoly(computedShape));\r\n\t\t});\r\n\r\n\t\treturn res;\r\n\t};\r\n\r\n\t//#region shape base interaction\r\n\tlet interactionPoint = undefined;\r\n\r\n\tlet interactionTimer = undefined;\r\n\tlet interactionTarget = undefined;\r\n\tlet interactionShape = undefined;\r\n\tlet interactionShapeOrigin = undefined;\r\n\tlet interactionShapeOriginComputed = undefined;\r\n\tlet interactionShapeWasSelected = false;\r\n\tlet isInteracting = false;\r\n\r\n\tconst handleInteractionStart = e => {\r\n\t\tconst { origin } = e.detail;\r\n\t\tinteractionShape = undefined;\r\n\t\tinteractionShapeOrigin = undefined;\r\n\t\tinteractionShapeOriginComputed = undefined;\r\n\t\tinteractionShapeWasSelected = false;\r\n\t\tinteractionTarget = undefined;\r\n\t\tclearTimeout(interactionTimer);\r\n\t\tinteractionTimer = setTimeout(() => $$invalidate(118, isInteracting = true), 250);\r\n\r\n\t\t// if is editing text\r\n\t\tconst draft = getMarkupItemDraft();\r\n\r\n\t\tif (draft && !(shapeIsPath(draft) && hasProp(draft, 'pathClose'))) confirmMarkupItemDraft();\r\n\r\n\t\t// test if target is a shape, if not, run interaction handler\r\n\t\tinteractionPoint = mapEditorPointToImagePoint(vectorClone(origin));\r\n\r\n\t\tconst foundShapes = getShapesNearPosition(interactionPoint, selectRadius, shape => shapeCanSelect(shape));\r\n\t\tconst targettedMarkupItem = foundShapes.length && foundShapes.shift();\r\n\r\n\t\t// confirm text when moving between shapes\r\n\t\tif (activeMarkup && shapeIsTextEditing(activeMarkup)) handleTextConfirm();\r\n\r\n\t\t// deselect\r\n\t\tif (!targettedMarkupItem && activeMarkup && shapeIsTextEditing(activeMarkup)) deselectMarkupItem(activeMarkup);\r\n\r\n\t\t// if is clicking outside of canvas, don't create new shape\r\n\t\tif (!willStartInteraction(origin)) return;\r\n\r\n\t\t// check if markup was targetted\r\n\t\tif (targettedMarkupItem && shapeIsSelected(targettedMarkupItem)) {\r\n\t\t\tinteractionShapeWasSelected = true;\r\n\t\t\tinteractionShape = targettedMarkupItem;\r\n\r\n\t\t\t// create a deep copy so we can check on end interaction if the shape was changed\r\n\t\t\tinteractionShapeOrigin = shapeDeepCopy(interactionShape);\r\n\r\n\t\t\t// clone shape we're interacting with so we can update it properly\r\n\t\t\tinteractionShapeOriginComputed = shapeComputeDisplay(shapeDeepCopy(interactionShape), parentRect);\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// set target\r\n\t\tinteractionTarget = targettedMarkupItem || undefined;\r\n\r\n\t\t// started interacting\r\n\t\tconst didStartInteraction = oninteractionstart(e);\r\n\r\n\t\t// drag current targetted it as fallback interaction,\r\n\t\t// helps make sticker interaction easier\r\n\t\tif (!didStartInteraction && targettedMarkupItem) {\r\n\t\t\t// select\r\n\t\t\tselectShape(targettedMarkupItem);\r\n\r\n\t\t\tinteractionShape = targettedMarkupItem;\r\n\r\n\t\t\t// create a deep copy so we can check on end interaction if the shape was changed\r\n\t\t\tinteractionShapeOrigin = shapeDeepCopy(interactionShape);\r\n\r\n\t\t\t// clone shape we're interacting with so we can update it properly\r\n\t\t\tinteractionShapeOriginComputed = shapeComputeDisplay(shapeDeepCopy(interactionShape), parentRect);\r\n\t\t}\r\n\t};\r\n\r\n\tconst resetInteraction = () => {\r\n\t\tclearTimeout(interactionTimer);\r\n\t\tinteractionTimer = undefined;\r\n\t\t$$invalidate(118, isInteracting = false);\r\n\t};\r\n\r\n\tconst handleInteractionCancel = e => {\r\n\t\tresetInteraction();\r\n\t\toninteractioncancel(e);\r\n\t};\r\n\r\n\tconst handleInteractionUpdate = e => {\r\n\t\tconst { translation } = e.detail;\r\n\r\n\t\t// is interacting with shape\r\n\t\tif (interactionShape) {\r\n\t\t\t// prevent moving if not allowed\r\n\t\t\tif (!shapeCanMove(interactionShape)) return;\r\n\r\n\t\t\t// prevent moving if is editing text\r\n\t\t\tif (shapeIsTextEditing(interactionShape)) return;\r\n\r\n\t\t\treturn translateShape(interactionShape, interactionShapeOriginComputed, translation);\r\n\t\t}\r\n\r\n\t\toninteractionupdate(e);\r\n\t};\r\n\r\n\tconst handleInteractionRelease = e => {\r\n\t\tresetInteraction();\r\n\r\n\t\t// test if is text and if we double tapped, if so, switch to text edit mode\r\n\t\tif (interactionShape) {\r\n\t\t\tif (shapeIsTextEditing(interactionShape)) {\r\n\t\t\t\thandleTextCancel();\r\n\t\t\t} else // if tapped shape, and shape is text, and shape was selected\r\n\t\t\tif (e.detail.isTap && interactionShapeWasSelected && shapeIsText(interactionShape) && shapeCanInput(interactionShape) !== false) {\r\n\t\t\t\teditMarkupItem(interactionShape);\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\toninteractionrelease(e);\r\n\t};\r\n\r\n\tconst handleInteractionEnd = e => {\r\n\t\tconst isSelectInteraction = interactionTarget && e.detail.isTap;\r\n\r\n\t\tif (e.detail.isTap) ontapcanvas({\r\n\t\t\ttarget: interactionShape || interactionTarget,\r\n\t\t\tposition: interactionPoint\r\n\t\t});\r\n\r\n\t\t// shape remains active so user can resize, rotate\r\n\t\tif (interactionShape) {\r\n\t\t\tontapshape(interactionShape);\r\n\r\n\t\t\tif (!shapeEqual(interactionShape, interactionShapeOrigin)) {\r\n\t\t\t\tonupdateshape(interactionShape);\r\n\t\t\t}\r\n\r\n\t\t\tinteractionShape = undefined;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// can we deselect the current shape?\r\n\t\tconst currentSelectedShape = getSelectedShape();\r\n\r\n\t\tconst allowDeselectShape = currentSelectedShape\r\n\t\t? beforeDeselectShape(currentSelectedShape, interactionTarget || undefined)\r\n\t\t: true;\r\n\r\n\t\tif (allowDeselectShape) {\r\n\t\t\tblurShapes({ storePrevious: false });\r\n\t\t}\r\n\r\n\t\toninteractionend(e);\r\n\r\n\t\tif (allowDeselectShape && isSelectInteraction) {\r\n\t\t\tselectShape(interactionTarget);\r\n\t\t}\r\n\t};\r\n\r\n\t//#endregion\r\n\t//\r\n\t// Shape manipulation\r\n\t//\r\n\tconst getMarkupShapePoints = shape => {\r\n\t\tif (shapeIsRect(shape)) {\r\n\t\t\t// too small to draw\r\n\t\t\tif (shape.width < 1 && shape.height < 1) return;\r\n\r\n\t\t\tconst center = rectCenter(shape);\r\n\t\t\tconst points = rectGetCorners(shape);\r\n\r\n\t\t\tif (shape.flipX || shape.flipY) {\r\n\t\t\t\tvectorsFlip(points, shape.flipX, shape.flipY, center.x, center.y);\r\n\t\t\t}\r\n\r\n\t\t\treturn vectorsRotate(points, shape.rotation, center.x, center.y);\r\n\t\t}\r\n\r\n\t\tif (shapeIsEllipse(shape)) {\r\n\t\t\tif (shape.rx < 1 && shape.ry < 1) return;\r\n\t\t\tconst center = shape;\r\n\t\t\tconst points = rectGetCorners(rectCreateFromEllipse(shape));\r\n\r\n\t\t\tif (shape.flipX || shape.flipY) {\r\n\t\t\t\tvectorsFlip(points, shape.flipX, shape.flipY, center.x, center.y);\r\n\t\t\t}\r\n\r\n\t\t\treturn vectorsRotate(points, shape.rotation, center.x, center.y);\r\n\t\t}\r\n\r\n\t\tif (shapeIsLine(shape)) {\r\n\t\t\treturn [shapeLineGetStartPoint(shape), shapeLineGetEndPoint(shape)];\r\n\t\t}\r\n\r\n\t\tif (shapeIsPath(shape)) {\r\n\t\t\treturn [...shape.points];\r\n\t\t}\r\n\r\n\t\tif (shapeIsText(shape)) {\r\n\t\t\t// too small to draw\r\n\t\t\tif (shape.width < 5 && shape.height < 5) return;\r\n\r\n\t\t\tconst rect = getMarkupShapeRect(shape);\r\n\t\t\trect.width = Math.max(MIN_TEXT_MARKUP_WIDTH, rect.width);\r\n\t\t\tconst center = rectCenter(rect);\r\n\t\t\tconst points = rectGetCorners(rect);\r\n\r\n\t\t\tif (shape.flipX || shape.flipY) {\r\n\t\t\t\tvectorsFlip(points, shape.flipX, shape.flipY, center.x, center.y);\r\n\t\t\t}\r\n\r\n\t\t\treturn vectorsRotate(points, shape.rotation, center.x, center.y);\r\n\t\t}\r\n\r\n\t\treturn [];\r\n\t};\r\n\r\n\tconst getShapeRotationPoint = shape => {\r\n\t\tconst points = getMarkupShapePoints(shape);\r\n\t\tlet origin;\r\n\t\tlet dir;\r\n\r\n\t\tif (shape.flipY) {\r\n\t\t\torigin = vectorCenter([points[0], points[1]]);\r\n\t\t\tdir = vectorNormalize(vectorCreate(points[1].x - points[2].x, points[1].y - points[2].y));\r\n\t\t} else {\r\n\t\t\torigin = vectorCenter([points[2], points[3]]);\r\n\t\t\tdir = vectorNormalize(vectorCreate(points[2].x - points[1].x, points[2].y - points[1].y));\r\n\t\t}\r\n\r\n\t\tvectorMultiply(dir, ROTATION_CONTROL_OFFSET / contextZoom);\r\n\t\treturn { origin, dir };\r\n\t};\r\n\r\n\tconst getShapeRotationPointOnScreen = shape => {\r\n\t\tconst markupPoint = getShapeRotationPoint(shape);\r\n\r\n\t\tconst screenPosition = mapImagePointToEditorPoint({\r\n\t\t\tx: markupPoint.origin.x + markupPoint.dir.x,\r\n\t\t\ty: markupPoint.origin.y + markupPoint.dir.y\r\n\t\t});\r\n\r\n\t\tconst screenOrigin = mapImagePointToEditorPoint(markupPoint.origin);\r\n\r\n\t\treturn {\r\n\t\t\torigin: screenOrigin,\r\n\t\t\tposition: screenPosition\r\n\t\t};\r\n\t};\r\n\r\n\tconst showHover = shape => {\r\n\t\tconst shapePoints = getMarkupShapePoints(shapeComputeDisplay(shapeDeepCopy(shape), parentRect));\r\n\t\tif (!shapePoints) return;\r\n\t\tconst points = shapePoints.map(mapImagePointToEditorPoint);\r\n\r\n\t\tconst pathClose = shape.pathClose\r\n\t\t? true\r\n\t\t: shapeIsPath(shape) || shapeIsLine(shape) ? false : true;\r\n\r\n\t\tconst outlineShadow = {\r\n\t\t\tid: markupHoverShapeId,\r\n\t\t\tpoints: points.map(p => vectorCreate(p.x + 1, p.y + 1)),\r\n\t\t\tstrokeColor: [0, 0, 0, 0.1],\r\n\t\t\tstrokeWidth: 2,\r\n\t\t\tpathClose\r\n\t\t};\r\n\r\n\t\tconst outline = {\r\n\t\t\tid: markupHoverShapeId,\r\n\t\t\tpoints,\r\n\t\t\tstrokeColor: hoverColor, //[3 / 255, 169 / 255, 244 / 255],\r\n\t\t\tstrokeWidth: 2,\r\n\t\t\tpathClose\r\n\t\t};\r\n\r\n\t\t// remove any previous hover shapes\r\n\t\tconst res = ui.filter(shape => shape.id !== markupHoverShapeId);\r\n\r\n\t\t// update ui\r\n\t\t$$invalidate(54, ui = [...res, outlineShadow, outline]);\r\n\t};\r\n\r\n\tconst hideHover = () => {\r\n\t\t// remove shapes\r\n\t\tconst res = ui.filter(shape => shape.id !== markupHoverShapeId);\r\n\r\n\t\t// no shapes removed, don't update ui\r\n\t\tif (res.length === ui.length) return;\r\n\r\n\t\t$$invalidate(54, ui = res);\r\n\t};\r\n\r\n\tlet hoverShape;\r\n\r\n\t// draw shape manipulator edges\r\n\tconst ShapeManipulatorUid = `markup-manipulator-segment-` + uid;\r\n\r\n\tconst redrawManipulatorLines = (opacity, shape, pointerPosition) => {\r\n\t\tconst isPath = shapeIsPath(shape);\r\n\t\tconst isPolygon = isPath && hasProp(shape, 'pathClose');\r\n\t\tconst hasStroke = isPolygon && shapeHasStroke(shape);\r\n\t\tconst isDraft = shapeIsDraft(shape);\r\n\t\tconst isTextEditing = shapeIsTextEditing(shape);\r\n\r\n\t\t// don't draw line manipulator on sharpie draft\r\n\t\tif (isDraft && isPath && !isPolygon) return;\r\n\r\n\t\t// create manipulator outline segments\r\n\t\tconst segments = [];\r\n\r\n\t\tconst screenPoints = [...shapeActiveScreenPoints];\r\n\t\tconst screenPointsLast = screenPoints[screenPoints.length - 1];\r\n\t\tconst screenPointsFirst = screenPoints[0];\r\n\t\tconst shadowOpacity = (isTextEditing ? 0.05 : 0.1) * opacity;\r\n\t\tconst lineOpacity = (isTextEditing ? 0.5 : 1) * opacity;\r\n\t\tconst strokeColorShadow = [0, 0, 0];\r\n\t\tconst strokeColor = [1, 1, 1];\r\n\t\tconst strokeWidth = isTextEditing ? 1 : 1.5;\r\n\r\n\t\t// if shift is held snap to last point\r\n\t\tif ($keysPressedStored.includes(16) && screenPointsLast && pointerPosition) snapRelativeToAnchor(screenPointsLast, pointerPosition);\r\n\r\n\t\tconst distToOriginSquared = screenPoints.length && isPolygon && isDraft && pointerPosition\r\n\t\t? vectorDistanceSquared(screenPointsFirst, pointerPosition)\r\n\t\t: Infinity;\r\n\r\n\t\tconst distToLastSquared = screenPoints.length && isPolygon && isDraft && pointerPosition\r\n\t\t? vectorDistanceSquared(screenPointsLast, pointerPosition)\r\n\t\t: Infinity;\r\n\r\n\t\tconst canClosePath = distToOriginSquared <= POLYGON_END_PATH_DISTANCE_SQUARED;\r\n\t\tconst canEndPath = distToLastSquared <= POLYGON_END_PATH_DISTANCE_SQUARED;\r\n\r\n\t\t// if we can't close the path we draw a line from the last point to the pointer position\r\n\t\tif (!canClosePath && pointerPosition) screenPoints.push(pointerPosition);\r\n\r\n\t\tconst canDrawLine = screenPoints.length > 1;\r\n\r\n\t\tconst closeSelectionPath = shape.pathClose\r\n\t\t? true\r\n\t\t: shapeIsPath(shape) || shapeIsLine(shape)\r\n\t\t\t? screenPoints.length > 2 && canClosePath\r\n\t\t\t: true;\r\n\r\n\t\t// shadows\r\n\t\tcanDrawLine && segments.push({\r\n\t\t\tid: ShapeManipulatorUid,\r\n\t\t\tpoints: screenPoints.map(p => vectorCreate(p.x + 1, p.y + 1)),\r\n\t\t\tpathClose: closeSelectionPath,\r\n\t\t\tstrokeColor: strokeColorShadow,\r\n\t\t\tstrokeWidth: 2,\r\n\t\t\topacity: shadowOpacity\r\n\t\t});\r\n\r\n\t\tisPolygon && segments.push(...screenPoints.map(point => {\r\n\t\t\treturn {\r\n\t\t\t\tid: ShapeManipulatorUid,\r\n\t\t\t\t...point,\r\n\t\t\t\trx: strokeWidth * 2,\r\n\t\t\t\try: strokeWidth * 2,\r\n\t\t\t\tbackgroundColor: strokeColorShadow,\r\n\t\t\t\topacity: shadowOpacity\r\n\t\t\t};\r\n\t\t}));\r\n\r\n\t\tif (shapeManipulatorRotationPoint) {\r\n\t\t\t// add rotator line shadow\r\n\t\t\tsegments.push({\r\n\t\t\t\tid: ShapeManipulatorUid,\r\n\t\t\t\tpoints: [\r\n\t\t\t\t\tvectorCreate(shapeManipulatorRotationPoint.origin.x + 1, shapeManipulatorRotationPoint.origin.y + 1),\r\n\t\t\t\t\tvectorCreate(shapeManipulatorRotationPoint.position.x + 1, shapeManipulatorRotationPoint.position.y + 1)\r\n\t\t\t\t],\r\n\t\t\t\tstrokeColor: strokeColorShadow,\r\n\t\t\t\tstrokeWidth: 2,\r\n\t\t\t\topacity: shadowOpacity\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// lines\r\n\t\tcanDrawLine && segments.push({\r\n\t\t\tid: ShapeManipulatorUid,\r\n\t\t\tpoints: screenPoints,\r\n\t\t\tpathClose: closeSelectionPath,\r\n\t\t\tstrokeColor,\r\n\t\t\tstrokeWidth,\r\n\t\t\tbackgroundColor: isDraft && shape.backgroundColor && shape.backgroundColor[3] > 0\r\n\t\t\t? shape.backgroundColor\r\n\t\t\t: [0, 0, 0, 0],\r\n\t\t\topacity: lineOpacity\r\n\t\t});\r\n\r\n\t\tisPolygon && segments.push(...screenPoints.map(point => {\r\n\t\t\treturn {\r\n\t\t\t\tid: ShapeManipulatorUid,\r\n\t\t\t\t...point,\r\n\t\t\t\trx: strokeWidth * 3,\r\n\t\t\t\try: strokeWidth * 3,\r\n\t\t\t\tbackgroundColor: [0.5, 0.5, 0.5],\r\n\t\t\t\tstrokeWidth,\r\n\t\t\t\tstrokeColor\r\n\t\t\t};\r\n\t\t}));\r\n\r\n\t\tisPolygon && isDraft && // !canEndPath &&\r\n\t\tshapeActiveScreenPoints.length >= 3 && segments.push({\r\n\t\t\t...screenPointsFirst,\r\n\t\t\tid: ShapeManipulatorUid,\r\n\t\t\trx: strokeWidth * (canClosePath ? 5 : 4),\r\n\t\t\try: strokeWidth * (canClosePath ? 5 : 4),\r\n\t\t\tbackgroundColor: canClosePath ? hoverColor : [0.5, 0.5, 0.5],\r\n\t\t\tstrokeWidth,\r\n\t\t\tstrokeColor\r\n\t\t});\r\n\r\n\t\tisPolygon && isDraft && hasStroke && !canClosePath && shapeActivePoints.length >= 2 && segments.push({\r\n\t\t\t...screenPointsLast,\r\n\t\t\tid: ShapeManipulatorUid,\r\n\t\t\trx: strokeWidth * (canEndPath ? 5 : 4),\r\n\t\t\try: strokeWidth * (canEndPath ? 5 : 4),\r\n\t\t\tbackgroundColor: canEndPath ? hoverColor : [0.5, 0.5, 0.5],\r\n\t\t\tstrokeWidth,\r\n\t\t\tstrokeColor\r\n\t\t});\r\n\r\n\t\tif (shapeManipulatorRotationPoint) {\r\n\t\t\t// add rotator line\r\n\t\t\tsegments.push({\r\n\t\t\t\tid: ShapeManipulatorUid,\r\n\t\t\t\tpoints: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tx: shapeManipulatorRotationPoint.origin.x,\r\n\t\t\t\t\t\ty: shapeManipulatorRotationPoint.origin.y\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tx: shapeManipulatorRotationPoint.position.x,\r\n\t\t\t\t\t\ty: shapeManipulatorRotationPoint.position.y\r\n\t\t\t\t\t}\r\n\t\t\t\t],\r\n\t\t\t\tstrokeColor,\r\n\t\t\t\tstrokeWidth,\r\n\t\t\t\topacity: lineOpacity\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// replace existing segments\r\n\t\t$$invalidate(54, ui = ui.filter(guide => guide.id !== ShapeManipulatorUid).concat(segments));\r\n\t};\r\n\r\n\tconst removeMarkupManipulatorLines = () => {\r\n\t\t$$invalidate(54, ui = ui.filter(guide => guide.id !== ShapeManipulatorUid));\r\n\t};\r\n\r\n\tconst togglePrerender = isActive => {\r\n\t\tif (!isActive) return updateMarkupShapeItems({ _prerender: false });\r\n\t\tconst shape = markup.find(markupItem => markupItem.isEditing);\r\n\t\tif (!shape) return;\r\n\t\tupdateMarkupShape(shape, { _prerender: textInputMode === 'inline' });\r\n\t};\r\n\r\n\tconst handleManipulatorResizeGrab = e => {\r\n\t\t$$invalidate(118, isInteracting = true);\r\n\t\tinteractionShape = activeMarkup;\r\n\t\tinteractionShapeOriginComputed = activeMarkupComputed;\r\n\t};\r\n\r\n\tconst handleManipulatorResizeDrag = e => {\r\n\t\t// is possible when using multiple fingers (scale canvas + drag / resize)\r\n\t\tif (!interactionShape) {\r\n\t\t\t$$invalidate(118, isInteracting = false);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst { translation, indexes, shiftKey } = e.detail;\r\n\t\tresizeShape(interactionShape, interactionShapeOriginComputed, indexes, translation, { shiftKey });\r\n\t};\r\n\r\n\tconst handleManipulatorResizeEnd = e => {\r\n\t\t// is possible when using multiple fingers (scale canvas + drag / resize)\r\n\t\tif (!interactionShape) {\r\n\t\t\t$$invalidate(118, isInteracting = false);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tselectShape(interactionShape);\r\n\t\tconst { isTap } = e.detail;\r\n\t\tif (isTap) ontapshape(interactionShape);\r\n\t\tinteractionShape = undefined;\r\n\t\t$$invalidate(118, isInteracting = false);\r\n\t\tonupdateshape(activeMarkup);\r\n\t};\r\n\r\n\tconst handleManipulatorRotateGrab = e => {\r\n\t\trotatorInitialPosition = getShapeRotationPoint(activeMarkupComputed).origin;\r\n\t\t$$invalidate(118, isInteracting = true);\r\n\t\tinteractionShape = activeMarkup;\r\n\t\tinteractionShapeOriginComputed = activeMarkupComputed;\r\n\t};\r\n\r\n\tconst handleManipulatorRotateDrag = e => {\r\n\t\t// is possible when using multiple fingers (scale canvas + drag / resize)\r\n\t\tif (!interactionShape) {\r\n\t\t\t$$invalidate(118, isInteracting = false);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst { translation, shiftKey } = e.detail;\r\n\t\trotateShape(interactionShape, interactionShapeOriginComputed, translation, { shiftKey });\r\n\t};\r\n\r\n\tconst handleManipulatorRotateEnd = () => {\r\n\t\t// is possible when using multiple fingers (scale canvas + drag / resize)\r\n\t\tif (!interactionShape) {\r\n\t\t\t$$invalidate(118, isInteracting = false);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tselectShape(interactionShape);\r\n\t\tinteractionShape = undefined;\r\n\t\t$$invalidate(118, isInteracting = false);\r\n\t\tonupdateshape(activeMarkup);\r\n\t};\r\n\r\n\t//\r\n\t// Keyboard\r\n\t//\r\n\tconst handleKey = e => {\r\n\t\t// get key type\r\n\t\tconst { key } = e;\r\n\r\n\t\tconst isEscape = (/escape/i).test(key);\r\n\r\n\t\t// if (isEscape && getMarkupItemDraft()) {\r\n\t\t//     e.preventDefault();\r\n\t\t//     e.stopPropagation();\r\n\t\t//     discardMarkupItemDraft();\r\n\t\t//     return;\r\n\t\t// }\r\n\t\t// only handle key input if a shape has been selected\r\n\t\tif (!hasActiveMarkupItem()) return;\r\n\r\n\t\t// if is escape deselect active item\r\n\t\tif (isEscape) {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopPropagation();\r\n\t\t\treturn deselectMarkupItem(activeMarkup);\r\n\t\t}\r\n\r\n\t\t// if is tab, select next markup item\r\n\t\t/*\r\nif (/arrow/i.test(key)) {\r\n    const success = e.shiftKey \r\n        ? selectPreviousMarkupItem(activeMarkup)\r\n        : selectNextMarkupItem(activeMarkup);\r\n    \r\n    if (success) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n    }\r\n}\r\n*/\r\n\t\t// if is remove active\r\n\t\tif ((/backspace|delete/i).test(key) && !isTextInputElement(e.target)) {\r\n\t\t\t// prevent back navigation on Firefox\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t// remove the item\r\n\t\t\tremoveActiveMarkupItem();\r\n\t\t}\r\n\r\n\t\t// if is duplicate active shape keyboard shortcut\r\n\t\tif (allowShapeDuplicate && key === 'd' && (e.metaKey || e.ctrlKey)) {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopPropagation();\r\n\t\t\tduplicateActiveMarkup();\r\n\t\t}\r\n\t};\r\n\r\n\tconst isTextInputElement = element => {\r\n\t\treturn element.isContentEditable || (/input|textarea/i).test(element.nodeName);\r\n\t};\r\n\r\n\t//\r\n\t// Text input\r\n\t//\r\n\tlet textInput;\r\n\r\n\tconst getTextShapeOriginSnapshot = () => ({ ...activeMarkup });\r\n\r\n\tconst getTextInputTextStyles = (shapeComputed, mode) => {\r\n\t\tconst { textAlign = 'left', fontFamily = 'sans-serif', fontWeight = 'normal', fontStyle = 'normal' } = shapeComputed;\r\n\t\tconst fontSize = shapeComputed.fontSize;\r\n\t\tconst imp = '!important';\r\n\t\tconst cosmetic = `text-align:${textAlign}${imp};font-family:${fontFamily}${imp};font-weight:${fontWeight}${imp};font-style:${fontStyle}${imp};`;\r\n\t\tif (mode === 'modal') return cosmetic;\r\n\t\tconst color = colorArrayToRGBA(shapeComputed.color);\r\n\t\tconst lineHeight = shapeComputed.lineHeight;\r\n\t\tconst initialLineOffset = Math.max(0, fontSize - lineHeight) * 0.5;\r\n\t\treturn `--bottom-inset:${initialLineOffset}px;padding:${initialLineOffset}px 0 0${imp};color:${color}${imp};font-size:${fontSize}px${imp};line-height:${lineHeight}px${imp};${cosmetic}`;\r\n\t};\r\n\r\n\tconst getTextInputPositionStyles = (shapeComputed, offset, contextZoom, contextRotation) => {\r\n\t\tlet center;\r\n\t\tlet size;\r\n\r\n\t\tif (shapeComputed.width && shapeComputed.height) {\r\n\t\t\t// text box\r\n\t\t\tcenter = rectCenter(shapeComputed);\r\n\r\n\t\t\tsize = sizeCreateFromAny(shapeComputed);\r\n\t\t} else {\r\n\t\t\t// text line\r\n\t\t\tsize = textToSize(activeMarkup.text, activeMarkupComputed);\r\n\r\n\t\t\t// if has fix width, we'll use that\r\n\t\t\tsize.width = activeMarkupComputed.width || size.width;\r\n\r\n\t\t\tcenter = vectorCreate(shapeComputed.x + size.width * 0.5, shapeComputed.y + size.height * 0.5);\r\n\t\t}\r\n\r\n\t\tconst lineHeight = Math.max(0, shapeComputed.fontSize - shapeComputed.lineHeight) + shapeComputed.lineHeight;\r\n\t\tconst position = mapImagePointToEditorPoint(center);\r\n\t\tlet tx = position.x - offset.x - size.width * 0.5;\r\n\t\tlet ty = position.y - offset.y - size.height * 0.5;\r\n\t\tlet flipX = shapeComputed.flipX;\r\n\t\tlet flipY = shapeComputed.flipY;\r\n\t\tlet r = shapeComputed.rotation;\r\n\r\n\t\tif (contextFlipX && contextFlipY) {\r\n\t\t\tflipX = !flipX;\r\n\t\t\tflipY = !flipY;\r\n\t\t} else if (contextFlipX) {\r\n\t\t\tflipX = !flipX;\r\n\t\t\tr = -r;\r\n\t\t} else if (contextFlipY) {\r\n\t\t\tflipY = !flipY;\r\n\t\t\tr = -r;\r\n\t\t}\r\n\r\n\t\tr += contextRotation;\r\n\t\tconst sx = contextZoom * (flipX ? -1 : 1);\r\n\t\tconst sy = contextZoom * (flipY ? -1 : 1);\r\n\t\treturn `--line-height:${lineHeight}px;width:${size.width}px;height:${size.height}px;transform:translate(${tx}px,${ty}px) rotate(${r}rad) scale(${sx}, ${sy})`;\r\n\t};\r\n\r\n\t// sets the contenteditable text when user clicks text shape\r\n\tconst syncTextInput = () => updateTextInputValue(textInputText);\r\n\r\n\tconst updateTextInputValue = text => {\r\n\t\t$$invalidate(7, textInput.innerHTML = textToHTML(text), textInput);\r\n\t};\r\n\r\n\t// cleans up single line text\r\n\tconst removeLineBreaks = text => {\r\n\t\tconst lines = text.// split on lines so we can create compressed normal line of text\r\n\t\tsplit(/[\\n\\r]/g);\r\n\r\n\t\tif (lines.length > 1) {\r\n\t\t\treturn lines.// remove spaces around lines\r\n\t\t\tmap(str => str.trim()).// remove empty strings\r\n\t\t\tfilter(str => str.length).// create new line\r\n\t\t\tjoin(' ');\r\n\t\t}\r\n\r\n\t\t// just return line\r\n\t\treturn lines[0];\r\n\t};\r\n\r\n\tconst getTextInputValue = element => {\r\n\t\tlet textInputValue;\r\n\r\n\t\tif (element.value === undefined) {\r\n\t\t\ttextInputValue = htmlToText(element.innerHTML);\r\n\t\t} else {\r\n\t\t\ttextInputValue = element.value;\r\n\t\t}\r\n\r\n\t\tconst value = shapeIsTextBlock(activeMarkup) && activeMarkup.disableNewline !== false\r\n\t\t? removeLineBreaks(textInputValue)\r\n\t\t: textInputValue;\r\n\r\n\t\treturn value;\r\n\t};\r\n\r\n\tconst formatContentEditable = html => {\r\n\t\t// check if can input\r\n\t\tconst canInput = shapeCanInput(activeMarkup, html);\r\n\r\n\t\treturn canInput === true ? html : canInput;\r\n\t};\r\n\r\n\tconst handleTextInput = () => {\r\n\t\tconst value = getTextInputValue(textInput);\r\n\t\tconst canInput = shapeCanInput(activeMarkup, value);\r\n\t\tconst text = canInput === true ? value : canInput;\r\n\t\tlet x = textShapeDisplayOrigin.x;\r\n\t\tlet y = textShapeDisplayOrigin.y;\r\n\r\n\t\t// if does not have height we need to adjust offset if is rotated\r\n\t\tif (!activeMarkup.height) {\r\n\t\t\t// draw origin rect\r\n\t\t\tconst originRotatedRect = rectRotate({ ...textRectDisplayOrigin }, activeMarkup.rotation);\r\n\r\n\t\t\t// draw current rect\r\n\t\t\tconst size = textToSize(text, activeMarkupComputed);\r\n\r\n\t\t\tconst currentRotatedRect = rectRotate({ x, y, ...size }, activeMarkup.rotation);\r\n\t\t\tconst [originTopLeft, ,originBottomRight] = originRotatedRect;\r\n\t\t\tconst [currentTopLeft, ,currentBottomRight] = currentRotatedRect;\r\n\t\t\tlet a = originTopLeft;\r\n\t\t\tlet b = currentTopLeft;\r\n\r\n\t\t\t// if flipped we need to 'extend' the text field in the opposite direction\r\n\t\t\tif (activeMarkup.flipX) {\r\n\t\t\t\ta = originBottomRight;\r\n\t\t\t\tb = currentBottomRight;\r\n\t\t\t}\r\n\r\n\t\t\t// move\r\n\t\t\tconst d = vectorSubtract(vectorClone(a), b);\r\n\r\n\t\t\tx += d.x;\r\n\t\t\ty += d.y;\r\n\t\t}\r\n\r\n\t\tupdateMarkupShape(activeMarkup, {\r\n\t\t\tx: isString(textShapeOrigin.x)\r\n\t\t\t? toPercentage(x, parentRect.width)\r\n\t\t\t: x,\r\n\t\t\ty: isString(textShapeOrigin.y)\r\n\t\t\t? toPercentage(y, parentRect.height)\r\n\t\t\t: y,\r\n\t\t\ttext\r\n\t\t});\r\n\t};\r\n\r\n\tconst handleTextInputAttempt = e => {\r\n\t\tconst { target, key } = e;\r\n\t\tconst currentValue = target.value || target.innerText;\r\n\t\tconst selectionStart = target.selectionStart || 0;\r\n\t\tconst selectionEnd = target.selectionEnd || currentValue.length;\r\n\t\tconst currentValueStart = currentValue.substring(0, selectionStart);\r\n\t\tconst currentValueEnd = currentValue.substring(selectionEnd);\r\n\t\tconst intendedValue = currentValueStart + key + currentValueEnd;\r\n\t\tconst filteredValue = shapeCanInput(activeMarkup, intendedValue);\r\n\t\tif (filteredValue !== intendedValue) return e.preventDefault();\r\n\t};\r\n\r\n\t// prevent moving shape when focusing text field, and close field if escape pressed\r\n\tconst handleTextInputKeyDown = e => {\r\n\t\t// block newlines for auto width text that doesn't allow newlines\r\n\t\tif (shapeIsTextBlock(activeMarkup) && (/enter/i).test(e.code) && activeMarkup.disableNewline !== false) return e.preventDefault();\r\n\r\n\t\tif ((/arrow/i).test(e.code)) return e.stopPropagation();\r\n\t\tif ((/escape/i).test(e.key)) return handleTextCancel();\r\n\t};\r\n\r\n\t// handle alt/ctrl/cmd + return\r\n\tconst handleTextInputKeyUp = e => {\r\n\t\t// get key type\r\n\t\tconst { key, ctrlKey, altKey } = e;\r\n\r\n\t\t// confirm multi line text elements\r\n\t\tif ((/enter/i).test(key) && (ctrlKey || altKey)) return handleTextConfirm();\r\n\t};\r\n\r\n\tconst handleTextConfirm = () => {\r\n\t\t// if was draft, now need to confirm\r\n\t\tlet wasDraft = activeShapeIsDraft;\r\n\r\n\t\tif (activeShapeIsDraft) confirmMarkupItemDraft();\r\n\r\n\t\t// final text input check\r\n\t\ttextInput && textInput.confirm && textInput.confirm();\r\n\r\n\t\thandleTextInput();\r\n\r\n\t\t// done\r\n\t\tfinishEditMarkupItem(activeMarkup);\r\n\r\n\t\tif (wasDraft) onaddshape(activeMarkup); else onupdateshape(activeMarkup);\r\n\t};\r\n\r\n\tconst handleTextCancel = () => {\r\n\t\tif (activeShapeIsDraft) {\r\n\t\t\tdiscardMarkupItemDraft();\r\n\t\t} else {\r\n\t\t\tupdateMarkupShape(activeMarkup, {\r\n\t\t\t\ttext: textShapeOrigin.text,\r\n\t\t\t\tx: textShapeOrigin.x,\r\n\t\t\t\ty: textShapeOrigin.y\r\n\t\t\t});\r\n\r\n\t\t\tfinishEditMarkupItem(activeMarkup);\r\n\t\t}\r\n\t};\r\n\r\n\t//#region shape popup menu actions\r\n\tconst getShapeSizeTranslation = (originRect, targetRect, { flipX, flipY, rotation }, anchor = 'top left') => {\r\n\t\tlet a, b;\r\n\r\n\t\t// draw origin rect\r\n\t\tconst [originTopLeft, originTopRight, originBottomRight, originBottomLeft] = rectRotate(originRect, rotation);\r\n\r\n\t\t// draw target rect\r\n\t\tconst [targetTopLeft, targetTopRight, targetBottomRight, targetBottomLeft] = rectRotate(targetRect, rotation);\r\n\r\n\t\tif (anchor === 'top center') {\r\n\t\t\t// for now doesn't matter if it's flipped horizontal\r\n\t\t\tconst originMid = vectorCenter(flipY\r\n\t\t\t? [originBottomLeft, originBottomRight]\r\n\t\t\t: [originTopLeft, originTopRight]);\r\n\r\n\t\t\tconst targetMid = vectorCenter(flipY\r\n\t\t\t? [targetBottomLeft, targetBottomRight]\r\n\t\t\t: [targetTopLeft, targetTopRight]);\r\n\r\n\t\t\ta = originMid;\r\n\t\t\tb = targetMid;\r\n\t\t} else if (anchor === 'top right' && !flipX || anchor === 'top left' && flipX) {\r\n\t\t\t// tr\r\n\t\t\ta = flipY ? originBottomRight : originTopRight;\r\n\r\n\t\t\tb = flipY ? targetBottomRight : targetTopRight;\r\n\t\t} else {\r\n\t\t\t// tl\r\n\t\t\ta = flipY ? originBottomLeft : originTopLeft;\r\n\r\n\t\t\tb = flipY ? targetBottomLeft : targetTopLeft;\r\n\t\t}\r\n\r\n\t\treturn vectorSubtract(vectorClone(a), b);\r\n\t};\r\n\r\n\tconst translateRelative = (current, position, translation) => vectorCreate(\r\n\t\tisString(current.x)\r\n\t\t? toPercentage(position.x + translation.x, parentRect.width)\r\n\t\t: position.x + translation.x,\r\n\t\tisString(current.y)\r\n\t\t? toPercentage(position.y + translation.y, parentRect.height)\r\n\t\t: position.y + translation.y\r\n\t);\r\n\r\n\tconst ShapeTextStateCache = {};\r\n\tconst handleEditTextActiveMarkup = () => editMarkupItem(activeMarkup);\r\n\r\n\tconst handleTextSwitchLayout = () => {\r\n\t\tconst shapeTextSize = sizeApply(textToSize(activeMarkup.text, activeMarkupComputed), v => Math.ceil(v));\r\n\t\tconst isFixedBox = hasProp(activeMarkup, 'height');\r\n\t\tconst isAutoHeightBox = !isFixedBox && hasProp(activeMarkup, 'width');\r\n\r\n\t\t// set/get cache entries for this text shape\r\n\t\tconst key = activeMarkup.id;\r\n\r\n\t\tlet cache = ShapeTextStateCache[key];\r\n\r\n\t\tif (!cache) {\r\n\t\t\tShapeTextStateCache[key] = {};\r\n\t\t\tcache = ShapeTextStateCache[key];\r\n\t\t}\r\n\r\n\t\tconst toAutoWidth = sizeFrom => {\r\n\t\t\t// remove width prop\r\n\t\t\tconst { width, ...autoSizeProps } = activeMarkupComputed;\r\n\r\n\t\t\tconst sizeTo = textToSize(activeMarkup.text, autoSizeProps);\r\n\r\n\t\t\t// this will change dimensions so if rotated we have to calculate new position\r\n\t\t\tconst translation = getShapeSizeTranslation(rectCreate(activeMarkupComputed.x, activeMarkupComputed.y, sizeFrom.width, sizeFrom.height), rectCreate(activeMarkupComputed.x, activeMarkupComputed.y, sizeTo.width, sizeTo.height), activeMarkupComputed, `top ${activeMarkup.textAlign}`);\r\n\r\n\t\t\tconst shouldRemoveTextAlign = activeMarkupComputed.disableNewline !== false;\r\n\r\n\t\t\t// switch to auto mode\r\n\t\t\tremoveMarkupShapeProps(activeMarkup, ['width', 'height', shouldRemoveTextAlign && 'textAlign']);\r\n\r\n\t\t\t// update position based on size translation\r\n\t\t\tupdateMarkupShape(activeMarkup, {\r\n\t\t\t\t...translateRelative(activeMarkup, activeMarkupComputed, translation)\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tconst toAutoHeight = sizeFrom => {\r\n\t\t\t// -> switch to auto height mode\r\n\t\t\tconst sizeTo = sizeCreate(cache.width || activeMarkupComputed.width || shapeTextSize.width, shapeTextSize.height);\r\n\r\n\t\t\tconst textAlign = cache.textAlign || 'left';\r\n\r\n\t\t\t// this will change dimensions so if rotated we have to calculate new position\r\n\t\t\tconst translation = getShapeSizeTranslation(rectCreate(activeMarkupComputed.x, activeMarkupComputed.y, sizeFrom.width, sizeFrom.height), rectCreate(activeMarkupComputed.x, activeMarkupComputed.y, sizeTo.width, sizeTo.height), activeMarkupComputed, `top ${textAlign}`);\r\n\r\n\t\t\t// switch to auto-height mode\r\n\t\t\tremoveMarkupShapeProps(activeMarkup, ['height']);\r\n\r\n\t\t\t// update position based on size translation\r\n\t\t\tupdateMarkupShape(activeMarkup, {\r\n\t\t\t\t...translateRelative(activeMarkup, activeMarkupComputed, translation),\r\n\t\t\t\twidth: isString(activeMarkup.width)\r\n\t\t\t\t? toPercentage(sizeTo.width, parentRect.width)\r\n\t\t\t\t: sizeTo.width,\r\n\t\t\t\ttextAlign\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tconst toFixedSize = sizeFrom => {\r\n\t\t\t// this can change dimensions so we need to recalculate position\r\n\t\t\tconst sizeTo = sizeCreate(cache.width || shapeTextSize.width, cache.height || shapeTextSize.height);\r\n\r\n\t\t\tconst textAlign = cache.textAlign || 'left';\r\n\r\n\t\t\t// this will change dimensions so if rotated we have to calculate new position\r\n\t\t\tconst translation = getShapeSizeTranslation(rectCreate(activeMarkupComputed.x, activeMarkupComputed.y, sizeFrom.width, sizeFrom.height), rectCreate(activeMarkupComputed.x, activeMarkupComputed.y, sizeTo.width, sizeTo.height), activeMarkupComputed, `top ${textAlign}`);\r\n\r\n\t\t\t// switch to fixed box, use stored alignment or default to left text align\r\n\t\t\tupdateMarkupShape(activeMarkup, {\r\n\t\t\t\t...translateRelative(activeMarkup, activeMarkupComputed, translation),\r\n\t\t\t\twidth: isString(activeMarkup.width)\r\n\t\t\t\t? toPercentage(sizeTo.width, parentRect.width)\r\n\t\t\t\t: sizeTo.width,\r\n\t\t\t\theight: isString(activeMarkup.width)\r\n\t\t\t\t? toPercentage(sizeTo.height, parentRect.height)\r\n\t\t\t\t: sizeTo.height,\r\n\t\t\t\ttextAlign\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tif (isFixedBox) {\r\n\t\t\t// store size so we can restore it later\r\n\t\t\tcache.textAlign = activeMarkup.textAlign;\r\n\r\n\t\t\tcache.width = activeMarkupComputed.width;\r\n\t\t\tcache.height = activeMarkupComputed.height;\r\n\t\t\tconst sizeFrom = sizeCreate(activeMarkupComputed.width, activeMarkupComputed.height);\r\n\r\n\t\t\tif (shapeCanChangeTextLayout(activeMarkup, 'auto-height')) {\r\n\t\t\t\ttoAutoHeight(sizeFrom);\r\n\t\t\t} else if (shapeCanChangeTextLayout(activeMarkup, 'auto-width')) {\r\n\t\t\t\ttoAutoWidth(sizeFrom);\r\n\t\t\t}\r\n\t\t} else if (isAutoHeightBox) {\r\n\t\t\t// store alignment so we can restore it later\r\n\t\t\tcache.textAlign = activeMarkup.textAlign;\r\n\r\n\t\t\tcache.width = activeMarkupComputed.width;\r\n\r\n\t\t\t// -> switch to auto width\r\n\t\t\tconst sizeFrom = sizeCreate(activeMarkupComputed.width, shapeTextSize.height);\r\n\r\n\t\t\tif (shapeCanChangeTextLayout(activeMarkup, 'auto-width')) {\r\n\t\t\t\ttoAutoWidth(sizeFrom);\r\n\t\t\t} else if (shapeCanChangeTextLayout(activeMarkup, 'fixed-size')) {\r\n\t\t\t\ttoFixedSize(sizeFrom);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// -> switch to fixed size or auto height\r\n\t\t\tcache.textAlign = activeMarkup.textAlign;\r\n\r\n\t\t\tconst sizeFrom = sizeCreate(Math.ceil(shapeTextSize.width), Math.ceil(shapeTextSize.height));\r\n\r\n\t\t\tif (shapeCanChangeTextLayout(activeMarkup, 'fixed-size')) {\r\n\t\t\t\ttoFixedSize(sizeFrom);\r\n\t\t\t} else if (shapeCanChangeTextLayout(activeMarkup, 'auto-height')) {\r\n\t\t\t\ttoAutoHeight(sizeFrom);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleFlipX = e => {\r\n\t\te.stopPropagation();\r\n\t\tconst flipX = activeMarkup.flipX || false;\r\n\t\tupdateMarkupShapeProperty(activeMarkup, 'flipX', !flipX);\r\n\t\tonupdateshape(activeMarkup);\r\n\t};\r\n\r\n\tconst handleFlipY = e => {\r\n\t\te.stopPropagation();\r\n\t\tconst flipY = activeMarkup.flipY || false;\r\n\t\tupdateMarkupShapeProperty(activeMarkup, 'flipY', !flipY);\r\n\t\tonupdateshape(activeMarkup);\r\n\t};\r\n\r\n\tconst handleAdjustOpacity = value => {\r\n\t\tupdateMarkupShapeProperty(activeMarkup, 'opacity', value);\r\n\t};\r\n\r\n\tconst handleConfirmOpacity = value => {\r\n\t\thandleAdjustOpacity(value);\r\n\t\tonupdateshape(activeMarkup);\r\n\t};\r\n\r\n\tconst handleRemoveActiveMarkup = e => {\r\n\t\te.stopPropagation();\r\n\t\te.target.blur(); // cancels focus of remove button\r\n\t\tremoveActiveMarkupItem();\r\n\t};\r\n\r\n\tconst handleMoveToFrontActiveMarkup = e => {\r\n\t\te.stopPropagation();\r\n\r\n\t\t// test if is not already at top of stack, if so, exit\r\n\t\tconst index = markup.findIndex(shape => shape === activeMarkup);\r\n\r\n\t\tif (index === markup.length - 1) return;\r\n\r\n\t\t// add to last index\r\n\t\t$$invalidate(0, markup = markup.filter(markupItem => markupItem !== activeMarkup).concat([activeMarkup]));\r\n\r\n\t\tonupdateshape(activeMarkup);\r\n\t};\r\n\r\n\tconst handleDuplicateActiveMarkup = e => {\r\n\t\te.stopPropagation();\r\n\t\tduplicateActiveMarkup();\r\n\t};\r\n\r\n\tconst duplicateActiveMarkup = () => {\r\n\t\t// create clone\r\n\t\tconst clone = shapeDeepCopy(activeMarkup);\r\n\r\n\t\tclone.id = getUniqueId();\r\n\t\tconst duplicationOffset = vectorCreate(50, -50);\r\n\r\n\t\t// offset\r\n\t\tif (hasProp(clone, 'points')) {\r\n\t\t\tconst computedProps = shapeGetPropsPixelValues(clone, ['points'], parentRect);\r\n\r\n\t\t\tcomputedProps.points.forEach(point => {\r\n\t\t\t\tpoint.x += duplicationOffset.x;\r\n\t\t\t\tpoint.y += duplicationOffset.y;\r\n\t\t\t});\r\n\r\n\t\t\tshapeUpdateProps(clone, computedProps, parentRect);\r\n\t\t} else if (shapeIsLine(clone)) {\r\n\t\t\tconst computedProps = shapeGetPropsPixelValues(clone, ['x1', 'y1', 'x2', 'y2'], parentRect);\r\n\t\t\tcomputedProps.x1 += duplicationOffset.x;\r\n\t\t\tcomputedProps.y1 += duplicationOffset.y;\r\n\t\t\tcomputedProps.x2 += duplicationOffset.x;\r\n\t\t\tcomputedProps.y2 += duplicationOffset.y;\r\n\t\t\tshapeUpdateProps(clone, computedProps, parentRect);\r\n\t\t} else {\r\n\t\t\tconst currentPosition = shapeGetPropsPixelValues(clone, ['x', 'y'], parentRect);\r\n\t\t\tcurrentPosition.x += 50;\r\n\t\t\tcurrentPosition.y -= 50;\r\n\t\t\tshapeUpdateProps(clone, currentPosition, parentRect);\r\n\t\t}\r\n\r\n\t\t// add clone\r\n\t\tmarkup.push(clone);\r\n\r\n\t\t// added\r\n\t\tonaddshape(clone);\r\n\r\n\t\t// select clone\r\n\t\tselectShape(clone);\r\n\t};\r\n\r\n\t//#endregion\r\n\tconst getMarkupControlsAnchorPosition = rect => vectorApply(vectorCreate(rect.x + rect.width * 0.5, rect.y), snapToPixel);\r\n\r\n\t//\r\n\t// show & position markup controls panel\r\n\t//\r\n\tconst markupControlsOpacity = spring(0, { stiffness: 0.2, damping: 0.7 });\r\n\r\n\tcomponent_subscribe($$self, markupControlsOpacity, value => $$invalidate(16, $markupControlsOpacity = value));\r\n\tlet shapeControlsSize;\r\n\r\n\tconst getShapeControlPositionOnCanvas = position => {\r\n\t\tconst left = utilRect.x;\r\n\t\tconst top = utilRect.y;\r\n\t\tconst right = left + utilRect.width;\r\n\t\tlet x = Math.max(position.x - shapeControlsSize.width * 0.5, left);\r\n\t\tlet y = Math.max(position.y - shapeControlsSize.height - shapeControlDist, top);\r\n\t\tif (x + shapeControlsSize.width > right) x = right - shapeControlsSize.width;\r\n\t\treturn vectorCreate(x, y);\r\n\t};\r\n\r\n\tconst TextLayoutChangeIcon = (locale, shape) => {\r\n\t\tconst { disableTextLayout = [] } = shape;\r\n\r\n\t\t// is fixed size\r\n\t\tif ('height' in shape) {\r\n\t\t\tif (disableTextLayout.includes('auto-height')) {\r\n\t\t\t\t// next is auto-width, no need to set as is empty\r\n\t\t\t\treturn locale.shapeIconButtonTextLayoutAutoWidth;\r\n\t\t\t} else {\r\n\t\t\t\t// next is auto-height\r\n\t\t\t\treturn locale.shapeIconButtonTextLayoutAutoHeight;\r\n\t\t\t}\r\n\t\t} else // is auto-height\r\n\t\tif ('width' in shape) {\r\n\t\t\tif (disableTextLayout.includes('auto-width')) {\r\n\t\t\t\t// next is fixed-size\r\n\t\t\t\treturn locale.shapeIconButtonTextLayoutFixedSize;\r\n\t\t\t} else {\r\n\t\t\t\t// next is auto-width, no need to set as is empty\r\n\t\t\t\treturn locale.shapeIconButtonTextLayoutAutoWidth;\r\n\t\t\t}\r\n\t\t} else // is auto-width\r\n\t\t{\r\n\t\t\t// next is fixed-size\r\n\t\t\tif (disableTextLayout.includes('fixed-size')) {\r\n\t\t\t\t// next is fixed-size\r\n\t\t\t\treturn locale.shapeIconButtonTextLayoutAutoHeight;\r\n\t\t\t} else {\r\n\t\t\t\t// next is auto-width, no need to set as is empty\r\n\t\t\t\treturn locale.shapeIconButtonTextLayoutFixedSize;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst TextLayoutChangeLabel = (locale, shape) => {\r\n\t\tconst { disableTextLayout = [] } = shape;\r\n\r\n\t\t// is fixed size\r\n\t\tif ('height' in shape) {\r\n\t\t\tif (disableTextLayout.includes('auto-height')) {\r\n\t\t\t\t// next is auto-width, no need to set as is empty\r\n\t\t\t\treturn locale.shapeTitleButtonTextLayoutAutoWidth;\r\n\t\t\t} else {\r\n\t\t\t\t// next is auto-height\r\n\t\t\t\treturn locale.shapeTitleButtonTextLayoutAutoHeight;\r\n\t\t\t}\r\n\t\t} else // is auto-height\r\n\t\tif ('width' in shape) {\r\n\t\t\tif (disableTextLayout.includes('auto-width')) {\r\n\t\t\t\t// next is fixed-size\r\n\t\t\t\treturn locale.shapeTitleButtonTextLayoutFixedSize;\r\n\t\t\t} else {\r\n\t\t\t\t// next is auto-width, no need to set as is empty\r\n\t\t\t\treturn locale.shapeTitleButtonTextLayoutAutoWidth;\r\n\t\t\t}\r\n\t\t} else // is auto-width\r\n\t\t{\r\n\t\t\t// next is fixed-size\r\n\t\t\tif (disableTextLayout.includes('fixed-size')) {\r\n\t\t\t\t// next is fixed-size\r\n\t\t\t\treturn locale.shapeTitleButtonTextLayoutAutoHeight;\r\n\t\t\t} else {\r\n\t\t\t\t// next is auto-width, no need to set as is empty\r\n\t\t\t\treturn locale.shapeTitleButtonTextLayoutFixedSize;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleNudge = e => {\r\n\t\tconst shape = getActiveMarkupItem();\r\n\t\tif (!shape) return;\r\n\t\tif (shapeIsTextEditing(shape)) return;\r\n\t\tif (!shapeCanMove(shape)) return;\r\n\t\tinteractionShape = shape;\r\n\t\tinteractionShapeOriginComputed = shapeComputeDisplay(shapeDeepCopy(interactionShape), parentRect);\r\n\t\ttranslateShape(interactionShape, interactionShapeOriginComputed, e.detail);\r\n\t};\r\n\r\n\t// shape navigator\r\n\tlet showShapeList = false;\r\n\r\n\tconst handleFocusIn = e => {\r\n\t\t$$invalidate(17, showShapeList = true);\r\n\t};\r\n\r\n\tconst handleFocusOut = ({ relatedTarget }) => {\r\n\t\t// still in list\r\n\t\tif (relatedTarget && relatedTarget.classList.contains('shape-selector__button')) return;\r\n\r\n\t\t$$invalidate(17, showShapeList = false);\r\n\t};\r\n\r\n\t// change cursor style\r\n\tlet lastImagePosition = vectorCreateEmpty();\r\n\r\n\tlet pointerPositionInEditor = undefined;\r\n\r\n\tconst handlePointerMove = e => {\r\n\t\t// not handled for touch interaction\r\n\t\tif (e.pointerType === 'touch') return;\r\n\r\n\t\t// if interactionTimer is set an interaction was started\r\n\t\tif (isInteracting || interactionTimer) setHoverShape(undefined);\r\n\r\n\t\tconst editorPosition = getEventPositionInEditor(e, rootRect);\r\n\t\tconst imagePosition = vectorApply(mapEditorPointToImagePoint(editorPosition), v => Math.round(v));\r\n\t\tif (vectorEqual(imagePosition, lastImagePosition)) return;\r\n\t\tlastImagePosition = vectorClone(imagePosition);\r\n\t\t$$invalidate(120, pointerPositionInEditor = editorPosition);\r\n\t\tif (isInteracting || interactionTimer) return;\r\n\t\tonhovercanvas(editorPosition, imagePosition);\r\n\r\n\t\t// no hover effect when creating markup\r\n\t\tif (activeMarkupItemIsDraft) return;\r\n\r\n\t\tconst [shape] = getShapesNearPosition(imagePosition, 0, shapeCanSelect);\r\n\r\n\t\t// can't hover draft\r\n\t\tif (shape && shapeIsDraft(shape)) return;\r\n\r\n\t\tsetHoverShape(shape);\r\n\t};\r\n\r\n\tconst setHoverShape = shape => {\r\n\t\t// let others know we're hovering this shape\r\n\t\tonhovershape(shape);\r\n\r\n\t\t// update interface\r\n\t\t$$invalidate(119, hoverShape = shape);\r\n\t};\r\n\r\n\t// clean up\r\n\tonDestroy(() => {\r\n\t\t// clean up invisible lines\r\n\t\tremoveMarkupManipulatorLines();\r\n\r\n\t\t// clean up hover lines\r\n\t\thideHover();\r\n\t});\r\n\r\n\t// element ref\r\n\tlet element;\r\n\r\n\tfunction measure_handler(event) {\r\n\t\tbubble.call(this, $$self, event);\r\n\t}\r\n\r\n\tconst click_handler = index => selectShape(markup[index]);\r\n\r\n\tfunction textarea_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\ttextInput = $$value;\r\n\t\t\t$$invalidate(7, textInput);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction textarea_input_handler() {\r\n\t\ttextInputText = this.value;\r\n\t\t((((($$invalidate(22, textInputText), $$invalidate(11, shouldRenderTextInput)), $$invalidate(123, activeMarkup)), $$invalidate(137, isTextMarkupSelected)), $$invalidate(1, disabled)), $$invalidate(0, markup));\r\n\t}\r\n\r\n\tfunction contenteditable_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\ttextInput = $$value;\r\n\t\t\t$$invalidate(7, textInput);\r\n\t\t});\r\n\t}\r\n\r\n\tconst focusout_handler = () => {\r\n\t\t// need to focus root shape editor node as otherwise next escape press closes modal when in modal\r\n\t\telement && element.focus();\r\n\t};\r\n\r\n\tconst measure_handler_1 = e => $$invalidate(8, shapeControlsSize = e.detail);\r\n\r\n\tfunction div_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\telement = $$value;\r\n\t\t\t$$invalidate(18, element);\r\n\t\t});\r\n\t}\r\n\r\n\tconst interactable_function_1 = e => getEventPositionInEditor(e, rootRect);\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('uid' in $$props) $$invalidate(55, uid = $$props.uid);\r\n\t\tif ('ui' in $$props) $$invalidate(54, ui = $$props.ui);\r\n\t\tif ('disabled' in $$props) $$invalidate(1, disabled = $$props.disabled);\r\n\t\tif ('markup' in $$props) $$invalidate(0, markup = $$props.markup);\r\n\t\tif ('offset' in $$props) $$invalidate(2, offset = $$props.offset);\r\n\t\tif ('contextRotation' in $$props) $$invalidate(56, contextRotation = $$props.contextRotation);\r\n\t\tif ('contextFlipX' in $$props) $$invalidate(57, contextFlipX = $$props.contextFlipX);\r\n\t\tif ('contextFlipY' in $$props) $$invalidate(58, contextFlipY = $$props.contextFlipY);\r\n\t\tif ('contextZoom' in $$props) $$invalidate(59, contextZoom = $$props.contextZoom);\r\n\t\tif ('active' in $$props) $$invalidate(60, active = $$props.active);\r\n\t\tif ('opacity' in $$props) $$invalidate(61, opacity = $$props.opacity);\r\n\t\tif ('parentRect' in $$props) $$invalidate(62, parentRect = $$props.parentRect);\r\n\t\tif ('rootRect' in $$props) $$invalidate(3, rootRect = $$props.rootRect);\r\n\t\tif ('utilRect' in $$props) $$invalidate(63, utilRect = $$props.utilRect);\r\n\t\tif ('hoverColor' in $$props) $$invalidate(64, hoverColor = $$props.hoverColor);\r\n\t\tif ('textInputMode' in $$props) $$invalidate(4, textInputMode = $$props.textInputMode);\r\n\t\tif ('oninteractionstart' in $$props) $$invalidate(65, oninteractionstart = $$props.oninteractionstart);\r\n\t\tif ('oninteractionupdate' in $$props) $$invalidate(66, oninteractionupdate = $$props.oninteractionupdate);\r\n\t\tif ('oninteractionrelease' in $$props) $$invalidate(67, oninteractionrelease = $$props.oninteractionrelease);\r\n\t\tif ('oninteractionend' in $$props) $$invalidate(68, oninteractionend = $$props.oninteractionend);\r\n\t\tif ('oninteractioncancel' in $$props) $$invalidate(69, oninteractioncancel = $$props.oninteractioncancel);\r\n\t\tif ('onaddshape' in $$props) $$invalidate(70, onaddshape = $$props.onaddshape);\r\n\t\tif ('onupdateshape' in $$props) $$invalidate(71, onupdateshape = $$props.onupdateshape);\r\n\t\tif ('onselectshape' in $$props) $$invalidate(72, onselectshape = $$props.onselectshape);\r\n\t\tif ('onremoveshape' in $$props) $$invalidate(73, onremoveshape = $$props.onremoveshape);\r\n\t\tif ('ontapshape' in $$props) $$invalidate(74, ontapshape = $$props.ontapshape);\r\n\t\tif ('onhovershape' in $$props) $$invalidate(75, onhovershape = $$props.onhovershape);\r\n\t\tif ('onhovercanvas' in $$props) $$invalidate(76, onhovercanvas = $$props.onhovercanvas);\r\n\t\tif ('ontapcanvas' in $$props) $$invalidate(77, ontapcanvas = $$props.ontapcanvas);\r\n\t\tif ('beforeSelectShape' in $$props) $$invalidate(78, beforeSelectShape = $$props.beforeSelectShape);\r\n\t\tif ('beforeDeselectShape' in $$props) $$invalidate(79, beforeDeselectShape = $$props.beforeDeselectShape);\r\n\t\tif ('beforeRemoveShape' in $$props) $$invalidate(80, beforeRemoveShape = $$props.beforeRemoveShape);\r\n\t\tif ('beforeUpdateShape' in $$props) $$invalidate(81, beforeUpdateShape = $$props.beforeUpdateShape);\r\n\t\tif ('willRenderShapeControls' in $$props) $$invalidate(82, willRenderShapeControls = $$props.willRenderShapeControls);\r\n\t\tif ('willStartInteraction' in $$props) $$invalidate(83, willStartInteraction = $$props.willStartInteraction);\r\n\t\tif ('mapEditorPointToImagePoint' in $$props) $$invalidate(84, mapEditorPointToImagePoint = $$props.mapEditorPointToImagePoint);\r\n\t\tif ('mapImagePointToEditorPoint' in $$props) $$invalidate(85, mapImagePointToEditorPoint = $$props.mapImagePointToEditorPoint);\r\n\t\tif ('eraseRadius' in $$props) $$invalidate(86, eraseRadius = $$props.eraseRadius);\r\n\t\tif ('selectRadius' in $$props) $$invalidate(87, selectRadius = $$props.selectRadius);\r\n\t\tif ('enableButtonFlipVertical' in $$props) $$invalidate(88, enableButtonFlipVertical = $$props.enableButtonFlipVertical);\r\n\t\tif ('enableTapToAddText' in $$props) $$invalidate(89, enableTapToAddText = $$props.enableTapToAddText);\r\n\t\tif ('locale' in $$props) $$invalidate(5, locale = $$props.locale);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*disabled, markup*/ 3) {\r\n\t\t\t$$invalidate(123, activeMarkup = !disabled && markup && (getMarkupItemDraft() || getActiveMarkupItem()));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*activeMarkup*/ 1073741824) {\r\n\t\t\t$$invalidate(142, activeMarkupSelected = !!activeMarkup);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*activeMarkup*/ 1073741824) {\r\n\t\t\t$$invalidate(134, activeShapeIsDraft = activeMarkup && shapeIsDraft(activeMarkup));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*activeMarkup*/ 1073741824 | $$self.$$.dirty[4] & /*activeShapeIsDraft*/ 1024) {\r\n\t\t\t$$invalidate(9, activeShapeId = activeMarkup && !activeShapeIsDraft\r\n\t\t\t? activeMarkup.id\r\n\t\t\t: undefined);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*rootRect*/ 8 | $$self.$$.dirty[2] & /*parentRect*/ 1 | $$self.$$.dirty[3] & /*activeMarkup*/ 1073741824) {\r\n\t\t\t// rootRect is in there so it recomputes the shape when the editor is resized\r\n\t\t\t$$invalidate(12, activeMarkupComputed = rootRect && activeMarkup && shapeComputeDisplay(shapeDeepCopy(activeMarkup), parentRect));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*activeMarkup*/ 1073741824 | $$self.$$.dirty[4] & /*activeShapeIsDraft*/ 1024) {\r\n\t\t\t$$invalidate(121, activeMarkupItemIsDraft = !!(activeMarkup && activeShapeIsDraft));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*activeMarkupComputed*/ 4096 | $$self.$$.dirty[1] & /*opacity*/ 1073741824 | $$self.$$.dirty[3] & /*activeMarkup*/ 1073741824) {\r\n\t\t\t// $: shapeProps = activeMarkup || undefined;\r\n\t\t\t// TODO: we use opacity to trigger a redraw of the active points, this should be changed to the image zoom factor in a future release\r\n\t\t\t//  && !shapeIsPath(activeMarkupComputed)\r\n\t\t\t$$invalidate(141, shapeActivePoints = activeMarkup && opacity && getMarkupShapePoints(activeMarkupComputed) || []);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*activeMarkup*/ 1073741824) {\r\n\t\t\t$$invalidate(143, allowResizeControls = activeMarkup && shapeCanResize(activeMarkup) && !shapeIsTextEditing(activeMarkup));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*activeMarkup*/ 1073741824) {\r\n\t\t\t$$invalidate(13, allowRotateControls = activeMarkup && shapeCanRotate(activeMarkup) && !shapeIsTextEditing(activeMarkup));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*activeMarkup*/ 1073741824 | $$self.$$.dirty[4] & /*allowResizeControls*/ 524288) {\r\n\t\t\t$$invalidate(15, allowEdgeControls = allowResizeControls && hasProp(activeMarkup, 'text') && !activeMarkup.height\r\n\t\t\t? [[1, 2], [3, 0]]\r\n\t\t\t: activeMarkup && (shapeIsLine(activeMarkup) || shapeIsPath(activeMarkup))\r\n\t\t\t\t? false\r\n\t\t\t\t: allowResizeControls);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*allowEdgeControls*/ 32768 | $$self.$$.dirty[3] & /*activeMarkup*/ 1073741824 | $$self.$$.dirty[4] & /*allowResizeControls*/ 524288) {\r\n\t\t\t$$invalidate(27, allowCornerControls = activeMarkup\r\n\t\t\t? Array.isArray(allowEdgeControls)\r\n\t\t\t\t? false\r\n\t\t\t\t: allowResizeControls\r\n\t\t\t: false);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*activeMarkup*/ 1073741824 | $$self.$$.dirty[4] & /*shapeActivePoints*/ 131072) {\r\n\t\t\t$$invalidate(14, shouldRenderShapeManipulator = activeMarkup && shapeActivePoints.length > 1);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[2] & /*mapImagePointToEditorPoint*/ 8388608 | $$self.$$.dirty[4] & /*shapeActivePoints*/ 131072) {\r\n\t\t\t$$invalidate(139, shapeActiveScreenPoints = shapeActivePoints.map(mapImagePointToEditorPoint));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*offset*/ 4 | $$self.$$.dirty[4] & /*shapeActiveScreenPoints*/ 32768) {\r\n\t\t\t$$invalidate(10, shapeManipulatorPoints = shapeActiveScreenPoints.map(point => vectorCreate(point.x - offset.x, point.y - offset.y)));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*activeMarkup*/ 1073741824 | $$self.$$.dirty[4] & /*activeMarkupSelected*/ 262144) {\r\n\t\t\t$$invalidate(26, shapeAllowNewline = activeMarkupSelected && (shapeIsTextBox(activeMarkup)\r\n\t\t\t? // has selected text box, if text box has disableNewline property, follow setting, else allow new lines\r\n\t\t\t\thasProp(activeMarkup, 'disableNewline')\r\n\t\t\t\t? !activeMarkup.disableNewline\r\n\t\t\t\t: true\r\n\t\t\t: // has selected something else, only disable new lines if disableNewline is explicitly set to false\r\n\t\t\t\tactiveMarkup.disableNewline === false));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[2] & /*mapImagePointToEditorPoint*/ 8388608 | $$self.$$.dirty[3] & /*hoverShape*/ 67108864) {\r\n\t\t\thoverShape && mapImagePointToEditorPoint && !shapeIsSelected(hoverShape) && shapeCanSelect(hoverShape)\r\n\t\t\t? showHover(hoverShape)\r\n\t\t\t: hideHover();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*shouldRenderShapeManipulator, allowRotateControls, shapeManipulatorPoints, activeMarkupComputed*/ 29696 | $$self.$$.dirty[1] & /*opacity*/ 1073741824) {\r\n\t\t\t// TODO: we use opacity to trigger a redraw of the active points,\r\n\t\t\t// this should be changed to the image zoom factor in a future release\r\n\t\t\t$$invalidate(140, shapeManipulatorRotationPoint = shouldRenderShapeManipulator && allowRotateControls && opacity && shapeManipulatorPoints && getShapeRotationPointOnScreen(activeMarkupComputed));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*offset*/ 4 | $$self.$$.dirty[4] & /*shapeManipulatorRotationPoint*/ 65536) {\r\n\t\t\t$$invalidate(25, shapeManipulatorRotationPointPosition = shapeManipulatorRotationPoint && vectorCreate(shapeManipulatorRotationPoint.position.x - offset.x, shapeManipulatorRotationPoint.position.y - offset.y));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*activeMarkup, pointerPositionInEditor*/ 1207959552 | $$self.$$.dirty[4] & /*activeShapeIsDraft*/ 1024) {\r\n\t\t\t$$invalidate(138, currentPointerPosition = activeShapeIsDraft && shapeIsPath(activeMarkup) && pointerPositionInEditor);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*opacity*/ 1073741824 | $$self.$$.dirty[3] & /*activeMarkup*/ 1073741824 | $$self.$$.dirty[4] & /*shapeActiveScreenPoints, currentPointerPosition*/ 49152) {\r\n\t\t\t// add contextPresentationRect so we redraw active markup each frame\r\n\t\t\tif (activeMarkup && shapeActiveScreenPoints && opacity > 0) {\r\n\t\t\t\tredrawManipulatorLines(opacity, activeMarkup, currentPointerPosition);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*activeMarkup*/ 1073741824) {\r\n\t\t\tif (!activeMarkup) {\r\n\t\t\t\tremoveMarkupManipulatorLines();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*active*/ 536870912) {\r\n\t\t\ttogglePrerender(active);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*textInput, textInputMode*/ 144) {\r\n\t\t\t// auto focus text input when created and in inline mode\r\n\t\t\tif (textInput && textInputMode === 'inline') textInput.focus();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*activeMarkup*/ 1073741824) {\r\n\t\t\t$$invalidate(137, isTextMarkupSelected = activeMarkup && shapeIsText(activeMarkup));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*activeMarkup*/ 1073741824 | $$self.$$.dirty[4] & /*isTextMarkupSelected*/ 8192) {\r\n\t\t\t$$invalidate(11, shouldRenderTextInput = isTextMarkupSelected && shapeCanInput(activeMarkup) !== false && shapeIsTextEditing(activeMarkup));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*shouldRenderTextInput*/ 2048) {\r\n\t\t\t$$invalidate(133, textShapeOrigin = shouldRenderTextInput\r\n\t\t\t? getTextShapeOriginSnapshot()\r\n\t\t\t: undefined);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[2] & /*parentRect*/ 1 | $$self.$$.dirty[4] & /*textShapeOrigin*/ 512) {\r\n\t\t\t$$invalidate(135, textShapeDisplayOrigin = textShapeOrigin && shapeComputeDisplay({ ...textShapeOrigin }, parentRect));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*textShapeDisplayOrigin*/ 2048) {\r\n\t\t\t$$invalidate(136, textSizeDisplayOrigin = textShapeDisplayOrigin && textToSize(textShapeDisplayOrigin.text, textShapeDisplayOrigin));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*textShapeDisplayOrigin, textSizeDisplayOrigin*/ 6144) {\r\n\t\t\ttextRectDisplayOrigin = textShapeDisplayOrigin && rectCreate(textShapeDisplayOrigin.x, textShapeDisplayOrigin.y, textSizeDisplayOrigin.width, textSizeDisplayOrigin.height);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*shouldRenderTextInput*/ 2048 | $$self.$$.dirty[3] & /*activeMarkup*/ 1073741824) {\r\n\t\t\t$$invalidate(22, textInputText = shouldRenderTextInput ? activeMarkup.text : '');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*shouldRenderTextInput, activeMarkupComputed, textInputMode*/ 6160) {\r\n\t\t\t$$invalidate(24, textInputTextStyles = shouldRenderTextInput && getTextInputTextStyles(activeMarkupComputed, textInputMode));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*shouldRenderTextInput, activeMarkupComputed, offset*/ 6148 | $$self.$$.dirty[1] & /*contextZoom, contextRotation*/ 301989888) {\r\n\t\t\t$$invalidate(23, textInputPositionStyles = shouldRenderTextInput && getTextInputPositionStyles(activeMarkupComputed, offset, contextZoom, contextRotation));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*shouldRenderTextInput, textInput, textInputMode*/ 2192) {\r\n\t\t\tif (shouldRenderTextInput && textInput && textInputMode === 'inline') syncTextInput();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*activeMarkup, activeMarkupItemIsDraft*/ 1342177280 | $$self.$$.dirty[4] & /*controlledMarkupItem*/ 8) {\r\n\t\t\t$$invalidate(127, controlledMarkupItem = activeMarkup && !activeMarkupItemIsDraft\r\n\t\t\t? activeMarkup\r\n\t\t\t: controlledMarkupItem);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*controlledMarkupItem*/ 8) {\r\n\t\t\t$$invalidate(129, allowShapeFlip = controlledMarkupItem && shapeCanFlip(controlledMarkupItem));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*controlledMarkupItem*/ 8) {\r\n\t\t\t$$invalidate(124, allowShapeChangeTextLayout = controlledMarkupItem && shapeCanChangeTextLayout(controlledMarkupItem));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*controlledMarkupItem*/ 8) {\r\n\t\t\t$$invalidate(126, allowShapeDuplicate = controlledMarkupItem && shapeCanDuplicate(controlledMarkupItem));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*controlledMarkupItem*/ 8) {\r\n\t\t\t$$invalidate(125, allowShapeRemove = controlledMarkupItem && shapeCanRemove(controlledMarkupItem));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*controlledMarkupItem*/ 8) {\r\n\t\t\t$$invalidate(128, allowShapeReorder = controlledMarkupItem && shapeCanReorder(controlledMarkupItem));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*controlledMarkupItem*/ 8) {\r\n\t\t\t$$invalidate(122, allowShapeInput = controlledMarkupItem && shapeCanInput(controlledMarkupItem) !== false);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[4] & /*controlledMarkupItem*/ 8) {\r\n\t\t\t$$invalidate(130, allowShapeAdjustOpacity = controlledMarkupItem && hasProp(controlledMarkupItem, 'backgroundImage') && shapeCanStyle(controlledMarkupItem, 'opacity'));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*shouldRenderTextInput*/ 2048 | $$self.$$.dirty[3] & /*activeMarkup, activeMarkupItemIsDraft, isInteracting*/ 1375731712 | $$self.$$.dirty[4] & /*$isAnimated*/ 1048576) {\r\n\t\t\tmarkupControlsOpacity.set(\r\n\t\t\t\tactiveMarkup && !activeMarkupItemIsDraft && !isInteracting && !shouldRenderTextInput\r\n\t\t\t\t? 1\r\n\t\t\t\t: 0,\r\n\t\t\t\t{ hard: $isAnimated === false }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*shapeManipulatorPoints*/ 1024 | $$self.$$.dirty[3] & /*activeMarkup, activeMarkupItemIsDraft*/ 1342177280 | $$self.$$.dirty[4] & /*markupControlsAnchorPosition*/ 256) {\r\n\t\t\t$$invalidate(132, markupControlsAnchorPosition = activeMarkup && !activeMarkupItemIsDraft && shapeManipulatorPoints.length\r\n\t\t\t? getMarkupControlsAnchorPosition(rectCreateFromPoints(shapeManipulatorPoints))\r\n\t\t\t: markupControlsAnchorPosition);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*shapeControlsSize*/ 256 | $$self.$$.dirty[2] & /*utilRect*/ 2 | $$self.$$.dirty[4] & /*markupControlsAnchorPosition*/ 256) {\r\n\t\t\t$$invalidate(131, shapeControlsPosition = markupControlsAnchorPosition && shapeControlsSize && utilRect && getShapeControlPositionOnCanvas(markupControlsAnchorPosition));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$markupControlsOpacity*/ 65536 | $$self.$$.dirty[4] & /*shapeControlsPosition*/ 128) {\r\n\t\t\t$$invalidate(21, markupControlsStyle = shapeControlsPosition && `transform: translate(${shapeControlsPosition.x}px, ${shapeControlsPosition.y}px);opacity:${$markupControlsOpacity}`);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*activeShapeId, locale, markup*/ 545 | $$self.$$.dirty[2] & /*willRenderShapeControls, enableButtonFlipVertical*/ 68157440 | $$self.$$.dirty[3] & /*activeMarkup, allowShapeInput*/ 1610612736 | $$self.$$.dirty[4] & /*allowShapeAdjustOpacity, allowShapeFlip, allowShapeReorder, controlledMarkupItem, allowShapeDuplicate, allowShapeRemove, allowShapeChangeTextLayout*/ 127) {\r\n\t\t\t$$invalidate(20, shapeControls = activeShapeId && willRenderShapeControls && runSafe(() => willRenderShapeControls(\r\n\t\t\t\t[\r\n\t\t\t\t\tallowShapeAdjustOpacity && [\r\n\t\t\t\t\t\t'div',\r\n\t\t\t\t\t\t'alpha',\r\n\t\t\t\t\t\t{ class: 'PinturaShapeControlsGroup' },\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t'Slider',\r\n\t\t\t\t\t\t\t\t'adjust-opacity',\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tonrelease: handleConfirmOpacity,\r\n\t\t\t\t\t\t\t\t\tonchange: handleAdjustOpacity,\r\n\t\t\t\t\t\t\t\t\tstep: 0.01,\r\n\t\t\t\t\t\t\t\t\tvalue: hasProp(activeMarkup, 'opacity')\r\n\t\t\t\t\t\t\t\t\t? activeMarkup.opacity\r\n\t\t\t\t\t\t\t\t\t: 1,\r\n\t\t\t\t\t\t\t\t\tlabel: (value, min, max) => `${Math.round(value / max * 100)}%`,\r\n\t\t\t\t\t\t\t\t\tmin: 0,\r\n\t\t\t\t\t\t\t\t\tmax: 1,\r\n\t\t\t\t\t\t\t\t\tdirection: 'x'\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t],\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t'div',\r\n\t\t\t\t\t\t'beta',\r\n\t\t\t\t\t\t{ class: 'PinturaShapeControlsGroup' },\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\tallowShapeFlip && [\r\n\t\t\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t\t\t'flip-horizontal',\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tonclick: handleFlipX,\r\n\t\t\t\t\t\t\t\t\tlabel: locale.shapeTitleButtonFlipHorizontal,\r\n\t\t\t\t\t\t\t\t\ticon: locale.shapeIconButtonFlipHorizontal,\r\n\t\t\t\t\t\t\t\t\thideLabel: true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tallowShapeFlip && enableButtonFlipVertical && [\r\n\t\t\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t\t\t'flip-vertical',\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tonclick: handleFlipY,\r\n\t\t\t\t\t\t\t\t\tlabel: locale.shapeTitleButtonFlipVertical,\r\n\t\t\t\t\t\t\t\t\ticon: locale.shapeIconButtonFlipVertical,\r\n\t\t\t\t\t\t\t\t\thideLabel: true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tallowShapeReorder && [\r\n\t\t\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t\t\t'to-front',\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tonclick: handleMoveToFrontActiveMarkup,\r\n\t\t\t\t\t\t\t\t\tlabel: locale.shapeTitleButtonMoveToFront,\r\n\t\t\t\t\t\t\t\t\ticon: locale.shapeIconButtonMoveToFront,\r\n\t\t\t\t\t\t\t\t\thideLabel: true,\r\n\t\t\t\t\t\t\t\t\tdisabled: markup[markup.length - 1] === controlledMarkupItem\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tallowShapeDuplicate && [\r\n\t\t\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t\t\t'duplicate',\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tonclick: handleDuplicateActiveMarkup,\r\n\t\t\t\t\t\t\t\t\tlabel: locale.shapeTitleButtonDuplicate,\r\n\t\t\t\t\t\t\t\t\ticon: locale.shapeIconButtonDuplicate,\r\n\t\t\t\t\t\t\t\t\thideLabel: true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tallowShapeRemove && [\r\n\t\t\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t\t\t'remove',\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tonclick: handleRemoveActiveMarkup,\r\n\t\t\t\t\t\t\t\t\tlabel: locale.shapeTitleButtonRemove,\r\n\t\t\t\t\t\t\t\t\ticon: locale.shapeIconButtonRemove,\r\n\t\t\t\t\t\t\t\t\thideLabel: true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t].filter(Boolean)\r\n\t\t\t\t\t],\r\n\t\t\t\t\tallowShapeInput && allowShapeChangeTextLayout && [\r\n\t\t\t\t\t\t'div',\r\n\t\t\t\t\t\t'gamma',\r\n\t\t\t\t\t\t{ class: 'PinturaShapeControlsGroup' },\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t\t\t'text-layout',\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tonclick: handleTextSwitchLayout,\r\n\t\t\t\t\t\t\t\t\tlabel: localize(TextLayoutChangeLabel, locale, activeMarkup),\r\n\t\t\t\t\t\t\t\t\ticon: localize(TextLayoutChangeIcon, locale, activeMarkup),\r\n\t\t\t\t\t\t\t\t\thideLabel: true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t],\r\n\t\t\t\t\tallowShapeInput && [\r\n\t\t\t\t\t\t'div',\r\n\t\t\t\t\t\t'delta',\r\n\t\t\t\t\t\t{ class: 'PinturaShapeControlsGroup' },\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t'Button',\r\n\t\t\t\t\t\t\t\t'edit-text',\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tlabel: locale.shapeLabelInputText,\r\n\t\t\t\t\t\t\t\t\tonclick: handleEditTextActiveMarkup\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t]\r\n\t\t\t\t].filter(Boolean),\r\n\t\t\t\tactiveShapeId\r\n\t\t\t)));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*markup, locale*/ 33) {\r\n\t\t\t$$invalidate(19, shapeNavList = markup.filter(shapeCanSelect).filter(shape => !shapeIsDraft(shape)).map(shape => ({\r\n\t\t\t\tid: shape.id,\r\n\t\t\t\tcolor: shapeIsText(shape)\r\n\t\t\t\t? shape.color\r\n\t\t\t\t: shapeIsLine(shape)\r\n\t\t\t\t\t? shape.strokeColor\r\n\t\t\t\t\t: shape.backgroundColor,\r\n\t\t\t\tname: shape.name || locale[`shapeLabelTool${capitalizeFirstLetter(shapeGetDescription(shape))}`]\r\n\t\t\t})));\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tmarkup,\r\n\t\tdisabled,\r\n\t\toffset,\r\n\t\trootRect,\r\n\t\ttextInputMode,\r\n\t\tlocale,\r\n\t\tselectShape,\r\n\t\ttextInput,\r\n\t\tshapeControlsSize,\r\n\t\tactiveShapeId,\r\n\t\tshapeManipulatorPoints,\r\n\t\tshouldRenderTextInput,\r\n\t\tactiveMarkupComputed,\r\n\t\tallowRotateControls,\r\n\t\tshouldRenderShapeManipulator,\r\n\t\tallowEdgeControls,\r\n\t\t$markupControlsOpacity,\r\n\t\tshowShapeList,\r\n\t\telement,\r\n\t\tshapeNavList,\r\n\t\tshapeControls,\r\n\t\tmarkupControlsStyle,\r\n\t\ttextInputText,\r\n\t\ttextInputPositionStyles,\r\n\t\ttextInputTextStyles,\r\n\t\tshapeManipulatorRotationPointPosition,\r\n\t\tshapeAllowNewline,\r\n\t\tallowCornerControls,\r\n\t\tisAnimated,\r\n\t\tkeysPressedStored,\r\n\t\thandleInteractionStart,\r\n\t\thandleInteractionCancel,\r\n\t\thandleInteractionUpdate,\r\n\t\thandleInteractionRelease,\r\n\t\thandleInteractionEnd,\r\n\t\thandleManipulatorResizeGrab,\r\n\t\thandleManipulatorResizeDrag,\r\n\t\thandleManipulatorResizeEnd,\r\n\t\thandleManipulatorRotateGrab,\r\n\t\thandleManipulatorRotateDrag,\r\n\t\thandleManipulatorRotateEnd,\r\n\t\thandleKey,\r\n\t\tformatContentEditable,\r\n\t\thandleTextInput,\r\n\t\thandleTextInputAttempt,\r\n\t\thandleTextInputKeyDown,\r\n\t\thandleTextInputKeyUp,\r\n\t\thandleTextConfirm,\r\n\t\thandleTextCancel,\r\n\t\tmarkupControlsOpacity,\r\n\t\thandleNudge,\r\n\t\thandleFocusIn,\r\n\t\thandleFocusOut,\r\n\t\thandlePointerMove,\r\n\t\tui,\r\n\t\tuid,\r\n\t\tcontextRotation,\r\n\t\tcontextFlipX,\r\n\t\tcontextFlipY,\r\n\t\tcontextZoom,\r\n\t\tactive,\r\n\t\topacity,\r\n\t\tparentRect,\r\n\t\tutilRect,\r\n\t\thoverColor,\r\n\t\toninteractionstart,\r\n\t\toninteractionupdate,\r\n\t\toninteractionrelease,\r\n\t\toninteractionend,\r\n\t\toninteractioncancel,\r\n\t\tonaddshape,\r\n\t\tonupdateshape,\r\n\t\tonselectshape,\r\n\t\tonremoveshape,\r\n\t\tontapshape,\r\n\t\tonhovershape,\r\n\t\tonhovercanvas,\r\n\t\tontapcanvas,\r\n\t\tbeforeSelectShape,\r\n\t\tbeforeDeselectShape,\r\n\t\tbeforeRemoveShape,\r\n\t\tbeforeUpdateShape,\r\n\t\twillRenderShapeControls,\r\n\t\twillStartInteraction,\r\n\t\tmapEditorPointToImagePoint,\r\n\t\tmapImagePointToEditorPoint,\r\n\t\teraseRadius,\r\n\t\tselectRadius,\r\n\t\tenableButtonFlipVertical,\r\n\t\tenableTapToAddText,\r\n\t\tcreateShape,\r\n\t\teraseShape,\r\n\t\tgetMarkupItemDraft,\r\n\t\tgetMarkupItemDraftIndex,\r\n\t\taddMarkupItemDraft,\r\n\t\tconfirmMarkupItemDraft,\r\n\t\tdiscardMarkupItemDraft,\r\n\t\tcreateMarkupItem,\r\n\t\tsyncShapes,\r\n\t\taddShape,\r\n\t\tremoveMarkupShapeProps,\r\n\t\tupdateMarkupShape,\r\n\t\tupdateMarkupShapeProperty,\r\n\t\tupdateMarkupItemsShapeProperty,\r\n\t\tupdateMarkupShapeItems,\r\n\t\tgetActiveMarkupItem,\r\n\t\thasActiveMarkupItem,\r\n\t\tremoveShape,\r\n\t\tremoveActiveMarkupItem,\r\n\t\tblurShapes,\r\n\t\tdeselectMarkupItem,\r\n\t\teditMarkupItem,\r\n\t\tfinishEditMarkupItem,\r\n\t\tremoveMarkupItems,\r\n\t\tgetTextShapeRect,\r\n\t\tgetMarkupShapeRect,\r\n\t\tgetShapesNearPosition,\r\n\t\tgetShapesBetweenPoints,\r\n\t\tisInteracting,\r\n\t\thoverShape,\r\n\t\tpointerPositionInEditor,\r\n\t\tactiveMarkupItemIsDraft,\r\n\t\tallowShapeInput,\r\n\t\tactiveMarkup,\r\n\t\tallowShapeChangeTextLayout,\r\n\t\tallowShapeRemove,\r\n\t\tallowShapeDuplicate,\r\n\t\tcontrolledMarkupItem,\r\n\t\tallowShapeReorder,\r\n\t\tallowShapeFlip,\r\n\t\tallowShapeAdjustOpacity,\r\n\t\tshapeControlsPosition,\r\n\t\tmarkupControlsAnchorPosition,\r\n\t\ttextShapeOrigin,\r\n\t\tactiveShapeIsDraft,\r\n\t\ttextShapeDisplayOrigin,\r\n\t\ttextSizeDisplayOrigin,\r\n\t\tisTextMarkupSelected,\r\n\t\tcurrentPointerPosition,\r\n\t\tshapeActiveScreenPoints,\r\n\t\tshapeManipulatorRotationPoint,\r\n\t\tshapeActivePoints,\r\n\t\tactiveMarkupSelected,\r\n\t\tallowResizeControls,\r\n\t\t$isAnimated,\r\n\t\tmeasure_handler,\r\n\t\tclick_handler,\r\n\t\ttextarea_binding,\r\n\t\ttextarea_input_handler,\r\n\t\tcontenteditable_binding,\r\n\t\tfocusout_handler,\r\n\t\tmeasure_handler_1,\r\n\t\tdiv_binding,\r\n\t\tinteractable_function_1\r\n\t];\r\n}\r\n\r\nclass ShapeLayoutEditor extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$f,\r\n\t\t\tcreate_fragment$f,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tuid: 55,\r\n\t\t\t\tui: 54,\r\n\t\t\t\tdisabled: 1,\r\n\t\t\t\tmarkup: 0,\r\n\t\t\t\toffset: 2,\r\n\t\t\t\tcontextRotation: 56,\r\n\t\t\t\tcontextFlipX: 57,\r\n\t\t\t\tcontextFlipY: 58,\r\n\t\t\t\tcontextZoom: 59,\r\n\t\t\t\tactive: 60,\r\n\t\t\t\topacity: 61,\r\n\t\t\t\tparentRect: 62,\r\n\t\t\t\trootRect: 3,\r\n\t\t\t\tutilRect: 63,\r\n\t\t\t\thoverColor: 64,\r\n\t\t\t\ttextInputMode: 4,\r\n\t\t\t\toninteractionstart: 65,\r\n\t\t\t\toninteractionupdate: 66,\r\n\t\t\t\toninteractionrelease: 67,\r\n\t\t\t\toninteractionend: 68,\r\n\t\t\t\toninteractioncancel: 69,\r\n\t\t\t\tonaddshape: 70,\r\n\t\t\t\tonupdateshape: 71,\r\n\t\t\t\tonselectshape: 72,\r\n\t\t\t\tonremoveshape: 73,\r\n\t\t\t\tontapshape: 74,\r\n\t\t\t\tonhovershape: 75,\r\n\t\t\t\tonhovercanvas: 76,\r\n\t\t\t\tontapcanvas: 77,\r\n\t\t\t\tbeforeSelectShape: 78,\r\n\t\t\t\tbeforeDeselectShape: 79,\r\n\t\t\t\tbeforeRemoveShape: 80,\r\n\t\t\t\tbeforeUpdateShape: 81,\r\n\t\t\t\twillRenderShapeControls: 82,\r\n\t\t\t\twillStartInteraction: 83,\r\n\t\t\t\tmapEditorPointToImagePoint: 84,\r\n\t\t\t\tmapImagePointToEditorPoint: 85,\r\n\t\t\t\teraseRadius: 86,\r\n\t\t\t\tselectRadius: 87,\r\n\t\t\t\tenableButtonFlipVertical: 88,\r\n\t\t\t\tenableTapToAddText: 89,\r\n\t\t\t\tlocale: 5,\r\n\t\t\t\tcreateShape: 90,\r\n\t\t\t\teraseShape: 91,\r\n\t\t\t\tgetMarkupItemDraft: 92,\r\n\t\t\t\tgetMarkupItemDraftIndex: 93,\r\n\t\t\t\taddMarkupItemDraft: 94,\r\n\t\t\t\tconfirmMarkupItemDraft: 95,\r\n\t\t\t\tdiscardMarkupItemDraft: 96,\r\n\t\t\t\tcreateMarkupItem: 97,\r\n\t\t\t\tsyncShapes: 98,\r\n\t\t\t\taddShape: 99,\r\n\t\t\t\tremoveMarkupShapeProps: 100,\r\n\t\t\t\tupdateMarkupShape: 101,\r\n\t\t\t\tupdateMarkupShapeProperty: 102,\r\n\t\t\t\tupdateMarkupItemsShapeProperty: 103,\r\n\t\t\t\tupdateMarkupShapeItems: 104,\r\n\t\t\t\tgetActiveMarkupItem: 105,\r\n\t\t\t\thasActiveMarkupItem: 106,\r\n\t\t\t\tremoveShape: 107,\r\n\t\t\t\tremoveActiveMarkupItem: 108,\r\n\t\t\t\tblurShapes: 109,\r\n\t\t\t\tselectShape: 6,\r\n\t\t\t\tdeselectMarkupItem: 110,\r\n\t\t\t\teditMarkupItem: 111,\r\n\t\t\t\tfinishEditMarkupItem: 112,\r\n\t\t\t\tremoveMarkupItems: 113,\r\n\t\t\t\tgetTextShapeRect: 114,\r\n\t\t\t\tgetMarkupShapeRect: 115,\r\n\t\t\t\tgetShapesNearPosition: 116,\r\n\t\t\t\tgetShapesBetweenPoints: 117\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1, -1, -1, -1, -1, -1, -1]\r\n\t\t);\r\n\t}\r\n\r\n\tget createShape() {\r\n\t\treturn this.$$.ctx[90];\r\n\t}\r\n\r\n\tget eraseShape() {\r\n\t\treturn this.$$.ctx[91];\r\n\t}\r\n\r\n\tget getMarkupItemDraft() {\r\n\t\treturn this.$$.ctx[92];\r\n\t}\r\n\r\n\tget getMarkupItemDraftIndex() {\r\n\t\treturn this.$$.ctx[93];\r\n\t}\r\n\r\n\tget addMarkupItemDraft() {\r\n\t\treturn this.$$.ctx[94];\r\n\t}\r\n\r\n\tget confirmMarkupItemDraft() {\r\n\t\treturn this.$$.ctx[95];\r\n\t}\r\n\r\n\tget discardMarkupItemDraft() {\r\n\t\treturn this.$$.ctx[96];\r\n\t}\r\n\r\n\tget createMarkupItem() {\r\n\t\treturn this.$$.ctx[97];\r\n\t}\r\n\r\n\tget syncShapes() {\r\n\t\treturn this.$$.ctx[98];\r\n\t}\r\n\r\n\tget addShape() {\r\n\t\treturn this.$$.ctx[99];\r\n\t}\r\n\r\n\tget removeMarkupShapeProps() {\r\n\t\treturn this.$$.ctx[100];\r\n\t}\r\n\r\n\tget updateMarkupShape() {\r\n\t\treturn this.$$.ctx[101];\r\n\t}\r\n\r\n\tget updateMarkupShapeProperty() {\r\n\t\treturn this.$$.ctx[102];\r\n\t}\r\n\r\n\tget updateMarkupItemsShapeProperty() {\r\n\t\treturn this.$$.ctx[103];\r\n\t}\r\n\r\n\tget updateMarkupShapeItems() {\r\n\t\treturn this.$$.ctx[104];\r\n\t}\r\n\r\n\tget getActiveMarkupItem() {\r\n\t\treturn this.$$.ctx[105];\r\n\t}\r\n\r\n\tget hasActiveMarkupItem() {\r\n\t\treturn this.$$.ctx[106];\r\n\t}\r\n\r\n\tget removeShape() {\r\n\t\treturn this.$$.ctx[107];\r\n\t}\r\n\r\n\tget removeActiveMarkupItem() {\r\n\t\treturn this.$$.ctx[108];\r\n\t}\r\n\r\n\tget blurShapes() {\r\n\t\treturn this.$$.ctx[109];\r\n\t}\r\n\r\n\tget selectShape() {\r\n\t\treturn this.$$.ctx[6];\r\n\t}\r\n\r\n\tget deselectMarkupItem() {\r\n\t\treturn this.$$.ctx[110];\r\n\t}\r\n\r\n\tget editMarkupItem() {\r\n\t\treturn this.$$.ctx[111];\r\n\t}\r\n\r\n\tget finishEditMarkupItem() {\r\n\t\treturn this.$$.ctx[112];\r\n\t}\r\n\r\n\tget removeMarkupItems() {\r\n\t\treturn this.$$.ctx[113];\r\n\t}\r\n\r\n\tget getTextShapeRect() {\r\n\t\treturn this.$$.ctx[114];\r\n\t}\r\n\r\n\tget getMarkupShapeRect() {\r\n\t\treturn this.$$.ctx[115];\r\n\t}\r\n\r\n\tget getShapesNearPosition() {\r\n\t\treturn this.$$.ctx[116];\r\n\t}\r\n\r\n\tget getShapesBetweenPoints() {\r\n\t\treturn this.$$.ctx[117];\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/ShapeStyleControls.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction get_each_context$2(ctx, list, i) {\r\n\tconst child_ctx = ctx.slice();\r\n\tchild_ctx[9] = list[i];\r\n\treturn child_ctx;\r\n}\r\n\r\n// (25:12) {#each controls as control (control.id)}\r\nfunction create_each_block$2(key_1, ctx) {\r\n\tlet li;\r\n\tlet span;\r\n\tlet t0_value = localize(/*control*/ ctx[9].componentProps.title, /*locale*/ ctx[1]) + \"\";\r\n\tlet t0;\r\n\tlet t1;\r\n\tlet switch_instance;\r\n\tlet t2;\r\n\tlet current;\r\n\tconst switch_instance_spread_levels = [/*control*/ ctx[9].componentProps];\r\n\tvar switch_value = /*control*/ ctx[9].component;\r\n\r\n\tfunction switch_props(ctx) {\r\n\t\tlet switch_instance_props = {};\r\n\r\n\t\tfor (let i = 0; i < switch_instance_spread_levels.length; i += 1) {\r\n\t\t\tswitch_instance_props = assign(switch_instance_props, switch_instance_spread_levels[i]);\r\n\t\t}\r\n\r\n\t\treturn { props: switch_instance_props };\r\n\t}\r\n\r\n\tif (switch_value) {\r\n\t\tswitch_instance = new switch_value(switch_props());\r\n\t}\r\n\r\n\treturn {\r\n\t\tkey: key_1,\r\n\t\tfirst: null,\r\n\t\tc() {\r\n\t\t\tli = element(\"li\");\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt0 = text(t0_value);\r\n\t\t\tt1 = space();\r\n\t\t\tif (switch_instance) create_component(switch_instance.$$.fragment);\r\n\t\t\tt2 = space();\r\n\t\t\tattr(span, \"class\", \"PinturaShapeStyleLabel\");\r\n\t\t\tattr(li, \"class\", \"PinturaShapeStyle\");\r\n\t\t\tthis.first = li;\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, li, anchor);\r\n\t\t\tappend(li, span);\r\n\t\t\tappend(span, t0);\r\n\t\t\tappend(li, t1);\r\n\r\n\t\t\tif (switch_instance) {\r\n\t\t\t\tmount_component(switch_instance, li, null);\r\n\t\t\t}\r\n\r\n\t\t\tappend(li, t2);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\t\t\tif ((!current || dirty & /*controls, locale*/ 3) && t0_value !== (t0_value = localize(/*control*/ ctx[9].componentProps.title, /*locale*/ ctx[1]) + \"\")) set_data(t0, t0_value);\r\n\r\n\t\t\tconst switch_instance_changes = (dirty & /*controls*/ 1)\r\n\t\t\t? get_spread_update(switch_instance_spread_levels, [get_spread_object(/*control*/ ctx[9].componentProps)])\r\n\t\t\t: {};\r\n\r\n\t\t\tif (switch_value !== (switch_value = /*control*/ ctx[9].component)) {\r\n\t\t\t\tif (switch_instance) {\r\n\t\t\t\t\tgroup_outros();\r\n\t\t\t\t\tconst old_component = switch_instance;\r\n\r\n\t\t\t\t\ttransition_out(old_component.$$.fragment, 1, 0, () => {\r\n\t\t\t\t\t\tdestroy_component(old_component, 1);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tcheck_outros();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (switch_value) {\r\n\t\t\t\t\tswitch_instance = new switch_value(switch_props());\r\n\t\t\t\t\tcreate_component(switch_instance.$$.fragment);\r\n\t\t\t\t\ttransition_in(switch_instance.$$.fragment, 1);\r\n\t\t\t\t\tmount_component(switch_instance, li, t2);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tswitch_instance = null;\r\n\t\t\t\t}\r\n\t\t\t} else if (switch_value) {\r\n\t\t\t\tswitch_instance.$set(switch_instance_changes);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\tif (switch_instance) transition_in(switch_instance.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\tif (switch_instance) transition_out(switch_instance.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(li);\r\n\t\t\tif (switch_instance) destroy_component(switch_instance);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (23:4) <Scrollable class=\"PinturaShapeStyles\" elasticity={scrollElasticity}>\r\nfunction create_default_slot$5(ctx) {\r\n\tlet ul;\r\n\tlet each_blocks = [];\r\n\tlet each_1_lookup = new Map();\r\n\tlet current;\r\n\tlet each_value = /*controls*/ ctx[0];\r\n\tconst get_key = ctx => /*control*/ ctx[9].id;\r\n\r\n\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\tlet child_ctx = get_each_context$2(ctx, each_value, i);\r\n\t\tlet key = get_key(child_ctx);\r\n\t\teach_1_lookup.set(key, each_blocks[i] = create_each_block$2(key, child_ctx));\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tul = element(\"ul\");\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].c();\r\n\t\t\t}\r\n\r\n\t\t\tattr(ul, \"class\", \"PinturaShapeStyleList\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, ul, anchor);\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].m(ul, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty & /*controls, localize, locale*/ 3) {\r\n\t\t\t\teach_value = /*controls*/ ctx[0];\r\n\t\t\t\tgroup_outros();\r\n\t\t\t\teach_blocks = update_keyed_each(each_blocks, dirty, get_key, 1, ctx, each_value, each_1_lookup, ul, outro_and_destroy_block, create_each_block$2, null, get_each_context$2);\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\r\n\t\t\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\t\t\ttransition_in(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\ttransition_out(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(ul);\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].d();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$e(ctx) {\r\n\tlet div;\r\n\tlet scrollable;\r\n\tlet current;\r\n\r\n\tscrollable = new Scrollable({\r\n\t\t\tprops: {\r\n\t\t\t\tclass: \"PinturaShapeStyles\",\r\n\t\t\t\telasticity: /*scrollElasticity*/ ctx[2],\r\n\t\t\t\t$$slots: { default: [create_default_slot$5] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tcreate_component(scrollable.$$.fragment);\r\n\t\t\tattr(div, \"style\", /*style*/ ctx[3]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tmount_component(scrollable, div, null);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tconst scrollable_changes = {};\r\n\t\t\tif (dirty & /*scrollElasticity*/ 4) scrollable_changes.elasticity = /*scrollElasticity*/ ctx[2];\r\n\r\n\t\t\tif (dirty & /*$$scope, controls, locale*/ 4099) {\r\n\t\t\t\tscrollable_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tscrollable.$set(scrollable_changes);\r\n\r\n\t\t\tif (!current || dirty & /*style*/ 8) {\r\n\t\t\t\tattr(div, \"style\", /*style*/ ctx[3]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(scrollable.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(scrollable.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tdestroy_component(scrollable);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$e($$self, $$props, $$invalidate) {\r\n\tlet style;\r\n\tlet $opacity;\r\n\tlet $isAnimated;\r\n\tlet { isActive = false } = $$props;\r\n\tlet { controls = [] } = $$props;\r\n\tlet { locale } = $$props;\r\n\tlet { scrollElasticity } = $$props;\r\n\r\n\t// context\r\n\tconst isAnimated = getContext('isAnimated');\r\n\r\n\tcomponent_subscribe($$self, isAnimated, value => $$invalidate(8, $isAnimated = value));\r\n\tconst opacity = spring(0, { stiffness: 0.25, damping: 0.9 });\r\n\tcomponent_subscribe($$self, opacity, value => $$invalidate(7, $opacity = value));\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('isActive' in $$props) $$invalidate(6, isActive = $$props.isActive);\r\n\t\tif ('controls' in $$props) $$invalidate(0, controls = $$props.controls);\r\n\t\tif ('locale' in $$props) $$invalidate(1, locale = $$props.locale);\r\n\t\tif ('scrollElasticity' in $$props) $$invalidate(2, scrollElasticity = $$props.scrollElasticity);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*isActive, $isAnimated*/ 320) {\r\n\t\t\topacity.set(isActive ? 1 : 0, { hard: $isAnimated === false });\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*$opacity, isActive*/ 192) {\r\n\t\t\t$$invalidate(3, style = `opacity:${$opacity};${!isActive ? 'pointer-events:none;' : ''}${$opacity <= 0 ? 'visibility:hidden' : ''}`);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tcontrols,\r\n\t\tlocale,\r\n\t\tscrollElasticity,\r\n\t\tstyle,\r\n\t\tisAnimated,\r\n\t\topacity,\r\n\t\tisActive,\r\n\t\t$opacity,\r\n\t\t$isAnimated\r\n\t];\r\n}\r\n\r\nclass ShapeStyleControls extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$e, create_fragment$e, safe_not_equal, {\r\n\t\t\tisActive: 6,\r\n\t\t\tcontrols: 0,\r\n\t\t\tlocale: 1,\r\n\t\t\tscrollElasticity: 2\r\n\t\t});\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/ShapeStyleEditor.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction get_each_context$1(ctx, list, i) {\r\n\tconst child_ctx = ctx.slice();\r\n\tchild_ctx[12] = list[i].key;\r\n\tchild_ctx[3] = list[i].controls;\r\n\tchild_ctx[13] = list[i].isActive;\r\n\treturn child_ctx;\r\n}\r\n\r\n// (143:4) {#each currentStyleControlSets as { key, controls, isActive }\r\nfunction create_each_block$1(key_1, ctx) {\r\n\tlet first;\r\n\tlet shapestylecontrols;\r\n\tlet current;\r\n\r\n\tshapestylecontrols = new ShapeStyleControls({\r\n\t\t\tprops: {\r\n\t\t\t\tisActive: /*isActive*/ ctx[13],\r\n\t\t\t\tcontrols: /*controls*/ ctx[3],\r\n\t\t\t\tlocale: /*locale*/ ctx[1],\r\n\t\t\t\tscrollElasticity: /*scrollElasticity*/ ctx[2]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tkey: key_1,\r\n\t\tfirst: null,\r\n\t\tc() {\r\n\t\t\tfirst = empty();\r\n\t\t\tcreate_component(shapestylecontrols.$$.fragment);\r\n\t\t\tthis.first = first;\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, first, anchor);\r\n\t\t\tmount_component(shapestylecontrols, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\t\t\tconst shapestylecontrols_changes = {};\r\n\t\t\tif (dirty & /*currentStyleControlSets*/ 16) shapestylecontrols_changes.isActive = /*isActive*/ ctx[13];\r\n\t\t\tif (dirty & /*currentStyleControlSets*/ 16) shapestylecontrols_changes.controls = /*controls*/ ctx[3];\r\n\t\t\tif (dirty & /*locale*/ 2) shapestylecontrols_changes.locale = /*locale*/ ctx[1];\r\n\t\t\tif (dirty & /*scrollElasticity*/ 4) shapestylecontrols_changes.scrollElasticity = /*scrollElasticity*/ ctx[2];\r\n\t\t\tshapestylecontrols.$set(shapestylecontrols_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(shapestylecontrols.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(shapestylecontrols.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(first);\r\n\t\t\tdestroy_component(shapestylecontrols, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$d(ctx) {\r\n\tlet div;\r\n\tlet each_blocks = [];\r\n\tlet each_1_lookup = new Map();\r\n\tlet div_class_value;\r\n\tlet current;\r\n\tlet each_value = /*currentStyleControlSets*/ ctx[4];\r\n\tconst get_key = ctx => /*key*/ ctx[12];\r\n\r\n\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\tlet child_ctx = get_each_context$1(ctx, each_value, i);\r\n\t\tlet key = get_key(child_ctx);\r\n\t\teach_1_lookup.set(key, each_blocks[i] = create_each_block$1(key, child_ctx));\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].c();\r\n\t\t\t}\r\n\r\n\t\t\tattr(div, \"class\", div_class_value = arrayJoin(['PinturaShapeStyleEditor', /*klass*/ ctx[0]]));\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].m(div, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tif (dirty & /*currentStyleControlSets, locale, scrollElasticity*/ 22) {\r\n\t\t\t\teach_value = /*currentStyleControlSets*/ ctx[4];\r\n\t\t\t\tgroup_outros();\r\n\t\t\t\teach_blocks = update_keyed_each(each_blocks, dirty, get_key, 1, ctx, each_value, each_1_lookup, div, outro_and_destroy_block, create_each_block$1, null, get_each_context$1);\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*klass*/ 1 && div_class_value !== (div_class_value = arrayJoin(['PinturaShapeStyleEditor', /*klass*/ ctx[0]]))) {\r\n\t\t\t\tattr(div, \"class\", div_class_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\r\n\t\t\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\t\t\ttransition_in(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\ttransition_out(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].d();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$d($$self, $$props, $$invalidate) {\r\n\tlet controlKeys;\r\n\tlet activeControls;\r\n\tlet currentStyleControlSets;\r\n\tlet { class: klass = undefined } = $$props;\r\n\tlet { controls = {} } = $$props;\r\n\tlet { shape = undefined } = $$props;\r\n\tlet { onchange } = $$props;\r\n\tlet { locale } = $$props;\r\n\tlet { scrollElasticity } = $$props;\r\n\r\n\tconst getShapeControls = shape => {\r\n\t\tconst activeControls = controlKeys.filter(styleKey => styleKey.split('_').every(styleKey => // shape needs to have the property\r\n\t\thasProp(shape, styleKey) && // shape needs to be able to style the property\r\n\t\tshapeCanStyle(shape, styleKey))).map(styleKey => {\r\n\t\t\tconst styleKeys = styleKey.split('_');\r\n\r\n\t\t\tconst currentValue = styleKeys.length > 1\r\n\t\t\t? styleKeys.map(key => shape[key])\r\n\t\t\t: shape[styleKey];\r\n\r\n\t\t\tlet [component, componentProps] = controls[styleKey];\r\n\r\n\t\t\t// is reference to other control or string representation of component\r\n\t\t\tif (isString(component)) {\r\n\t\t\t\t// exif if not a valid default control\r\n\t\t\t\tif (controls[component]) {\r\n\t\t\t\t\t// create component based on reference\r\n\t\t\t\t\tconst componentCustomProps = { ...componentProps };\r\n\r\n\t\t\t\t\t[component, componentProps] = controls[component];\r\n\r\n\t\t\t\t\tcomponentProps = {\r\n\t\t\t\t\t\t...componentProps,\r\n\t\t\t\t\t\t...componentCustomProps\r\n\t\t\t\t\t};\r\n\t\t\t\t} else if (component === 'Dropdown') {\r\n\t\t\t\t\tcomponent = Dropdown;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// skip\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst options = isFunction(componentProps.options)\r\n\t\t\t? componentProps.options(shape)\r\n\t\t\t: componentProps.options;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tid: styleKey,\r\n\t\t\t\tcomponent,\r\n\t\t\t\tcomponentProps: {\r\n\t\t\t\t\t...componentProps,\r\n\t\t\t\t\t// set the options prop\r\n\t\t\t\t\toptions,\r\n\t\t\t\t\t// defaults\r\n\t\t\t\t\tlocale,\r\n\t\t\t\t\tvalue: currentValue,\r\n\t\t\t\t\toptionLabelClass: 'PinturaButtonLabel',\r\n\t\t\t\t\tonchange: detail => {\r\n\t\t\t\t\t\tconst value = isObject(detail) && !isArray(detail)\r\n\t\t\t\t\t\t? detail.value\r\n\t\t\t\t\t\t: detail;\r\n\r\n\t\t\t\t\t\t// allow custom changes\r\n\t\t\t\t\t\tif (componentProps.onchange) componentProps.onchange(value, shape);\r\n\r\n\t\t\t\t\t\t// internal change\r\n\t\t\t\t\t\tconst props = styleKeys.length > 1\r\n\t\t\t\t\t\t? styleKeys.reduce(\r\n\t\t\t\t\t\t\t\t(prev, key, index) => {\r\n\t\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t\t...prev,\r\n\t\t\t\t\t\t\t\t\t\t[key]: Array.isArray(value) ? value[index] : value\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{}\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t: { [styleKey]: value };\r\n\r\n\t\t\t\t\t\tonchange(props);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}).filter(Boolean);\r\n\r\n\t\treturn activeControls;\r\n\t};\r\n\r\n\tconst styleControlSets = [];\r\n\r\n\tconst getStyleControlSets = (key, controls) => {\r\n\t\tlet controlSet = styleControlSets.find(controlSet => controlSet.key === key);\r\n\r\n\t\tif (!controlSet) {\r\n\t\t\t// create\r\n\t\t\tcontrolSet = { key, controls };\r\n\r\n\t\t\t// add\r\n\t\t\tstyleControlSets.push(controlSet);\r\n\t\t}\r\n\r\n\t\t// hide all\r\n\t\tstyleControlSets.forEach(controlSet => controlSet.isActive = false);\r\n\r\n\t\t// update active controls\r\n\t\tcontrolSet.controls = controls;\r\n\r\n\t\t// show active\r\n\t\tcontrolSet.isActive = true;\r\n\r\n\t\treturn styleControlSets;\r\n\t};\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('class' in $$props) $$invalidate(0, klass = $$props.class);\r\n\t\tif ('controls' in $$props) $$invalidate(3, controls = $$props.controls);\r\n\t\tif ('shape' in $$props) $$invalidate(5, shape = $$props.shape);\r\n\t\tif ('onchange' in $$props) $$invalidate(6, onchange = $$props.onchange);\r\n\t\tif ('locale' in $$props) $$invalidate(1, locale = $$props.locale);\r\n\t\tif ('scrollElasticity' in $$props) $$invalidate(2, scrollElasticity = $$props.scrollElasticity);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*controls*/ 8) {\r\n\t\t\t// finds the controls needed to style the selected shape\r\n\t\t\t$$invalidate(8, controlKeys = Object.keys(controls).filter(key => controls[key]));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*shape, controlKeys*/ 288) {\r\n\t\t\t$$invalidate(7, activeControls = shape && Object.keys(shape).length && controlKeys && shapeCanStyle(shape)\r\n\t\t\t? getShapeControls(shape)\r\n\t\t\t: []);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*shape, activeControls*/ 160) {\r\n\t\t\t$$invalidate(4, currentStyleControlSets = getStyleControlSets(\r\n\t\t\t\tshape && Object.keys(shape).length\r\n\t\t\t\t? Object.keys(shape).join('_')\r\n\t\t\t\t: 'none',\r\n\t\t\t\tactiveControls || []\r\n\t\t\t));\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tklass,\r\n\t\tlocale,\r\n\t\tscrollElasticity,\r\n\t\tcontrols,\r\n\t\tcurrentStyleControlSets,\r\n\t\tshape,\r\n\t\tonchange,\r\n\t\tactiveControls,\r\n\t\tcontrolKeys\r\n\t];\r\n}\r\n\r\nclass ShapeStyleEditor extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$d, create_fragment$d, safe_not_equal, {\r\n\t\t\tclass: 0,\r\n\t\t\tcontrols: 3,\r\n\t\t\tshape: 5,\r\n\t\t\tonchange: 6,\r\n\t\t\tlocale: 1,\r\n\t\t\tscrollElasticity: 2\r\n\t\t});\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/DragButton.svelte generated by Svelte v3.50.1 */\r\n\r\nconst { document: document_1$1 } = globals;\r\n\r\nfunction create_fragment$c(ctx) {\r\n\tlet t;\r\n\tlet button;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tt = space();\r\n\t\t\tbutton = element(\"button\");\r\n\t\t\tattr(button, \"class\", \"PinturaDragButton\");\r\n\t\t\tattr(button, \"type\", \"button\");\r\n\t\t\tattr(button, \"title\", /*title*/ ctx[1]);\r\n\t\t\tbutton.disabled = /*disabled*/ ctx[2];\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, t, anchor);\r\n\t\t\tinsert(target, button, anchor);\r\n\t\t\tbutton.innerHTML = /*html*/ ctx[0];\r\n\t\t\t/*button_binding*/ ctx[11](button);\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(document_1$1.body, \"load\", /*handleLoad*/ ctx[5], true),\r\n\t\t\t\t\tlisten(document_1$1.body, \"error\", /*handleError*/ ctx[6], true),\r\n\t\t\t\t\tlisten(button, \"pointerdown\", /*handleDown*/ ctx[4])\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tif (dirty & /*html*/ 1) button.innerHTML = /*html*/ ctx[0];\r\n\t\t\tif (dirty & /*title*/ 2) {\r\n\t\t\t\tattr(button, \"title\", /*title*/ ctx[1]);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty & /*disabled*/ 4) {\r\n\t\t\t\tbutton.disabled = /*disabled*/ ctx[2];\r\n\t\t\t}\r\n\t\t},\r\n\t\ti: noop,\r\n\t\to: noop,\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(t);\r\n\t\t\tif (detaching) detach(button);\r\n\t\t\t/*button_binding*/ ctx[11](null);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$c($$self, $$props, $$invalidate) {\r\n\tlet { html } = $$props;\r\n\tlet { title } = $$props;\r\n\tlet { onclick } = $$props;\r\n\tlet { disabled = false } = $$props;\r\n\tlet { ongrab = noop$1 } = $$props;\r\n\tlet { ondrag = noop$1 } = $$props;\r\n\tlet { ondrop = noop$1 } = $$props;\r\n\tlet element;\r\n\tconst isOverButton = e => vectorDistanceSquared(downPosition, vectorCreate(e.pageX, e.pageY)) < 256;\r\n\tlet downPosition;\r\n\r\n\tconst handleDown = e => {\r\n\t\tdownPosition = vectorCreate(e.pageX, e.pageY);\r\n\t\tongrab(e);\r\n\t\tdocument.documentElement.addEventListener('pointermove', handleMove);\r\n\t\tdocument.documentElement.addEventListener('pointerup', handleUp);\r\n\t};\r\n\r\n\tconst handleUp = e => {\r\n\t\tdocument.documentElement.removeEventListener('pointermove', handleMove);\r\n\t\tdocument.documentElement.removeEventListener('pointerup', handleUp);\r\n\t\tconst upPosition = vectorCreate(e.pageX, e.pageY);\r\n\r\n\t\t// must have moved enough distance to drop\r\n\t\tif (vectorDistanceSquared(downPosition, upPosition) < 32) return onclick(e);\r\n\r\n\t\t// cant drop in button /\r\n\t\tif (isOverButton(e)) return;\r\n\r\n\t\t// was dragging\r\n\t\tondrop(e);\r\n\t};\r\n\r\n\tconst handleMove = e => {\r\n\t\t// must have moved enough distance from button\r\n\t\tif (isOverButton(e)) return;\r\n\r\n\t\t// dragging out of button\r\n\t\tondrag(e);\r\n\t};\r\n\r\n\t// image loading\r\n\tconst isImageTarget = target => element && element.contains(target) && target.nodeName === 'IMG';\r\n\r\n\tconst handleLoad = ({ target }) => {\r\n\t\tif (!isImageTarget(target)) return;\r\n\t\t$$invalidate(3, element.dataset.load = true, element);\r\n\t};\r\n\r\n\tconst handleError = ({ target }) => {\r\n\t\tif (!isImageTarget(target)) return;\r\n\t\t$$invalidate(3, element.dataset.error = true, element);\r\n\t};\r\n\r\n\tfunction button_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\telement = $$value;\r\n\t\t\t$$invalidate(3, element);\r\n\t\t});\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('html' in $$props) $$invalidate(0, html = $$props.html);\r\n\t\tif ('title' in $$props) $$invalidate(1, title = $$props.title);\r\n\t\tif ('onclick' in $$props) $$invalidate(7, onclick = $$props.onclick);\r\n\t\tif ('disabled' in $$props) $$invalidate(2, disabled = $$props.disabled);\r\n\t\tif ('ongrab' in $$props) $$invalidate(8, ongrab = $$props.ongrab);\r\n\t\tif ('ondrag' in $$props) $$invalidate(9, ondrag = $$props.ondrag);\r\n\t\tif ('ondrop' in $$props) $$invalidate(10, ondrop = $$props.ondrop);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*element*/ 8) {\r\n\t\t\tif (element && element.querySelector('img')) $$invalidate(3, element.dataset.loader = true, element);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\thtml,\r\n\t\ttitle,\r\n\t\tdisabled,\r\n\t\telement,\r\n\t\thandleDown,\r\n\t\thandleLoad,\r\n\t\thandleError,\r\n\t\tonclick,\r\n\t\tongrab,\r\n\t\tondrag,\r\n\t\tondrop,\r\n\t\tbutton_binding\r\n\t];\r\n}\r\n\r\nclass DragButton extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$c, create_fragment$c, safe_not_equal, {\r\n\t\t\thtml: 0,\r\n\t\t\ttitle: 1,\r\n\t\t\tonclick: 7,\r\n\t\t\tdisabled: 2,\r\n\t\t\tongrab: 8,\r\n\t\t\tondrag: 9,\r\n\t\t\tondrop: 10\r\n\t\t});\r\n\t}\r\n}\r\n\r\n/* src/core/ui/components/ShapePresetsList.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction get_each_context(ctx, list, i) {\r\n\tconst child_ctx = ctx.slice();\r\n\tchild_ctx[14] = list[i];\r\n\treturn child_ctx;\r\n}\r\n\r\n// (25:4) {#each presets as preset (preset.id)}\r\nfunction create_each_block(key_1, ctx) {\r\n\tlet li;\r\n\tlet dragbutton;\r\n\tlet t;\r\n\tlet didMountPresetThumb_action;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\tfunction func() {\r\n\t\treturn /*func*/ ctx[10](/*preset*/ ctx[14]);\r\n\t}\r\n\r\n\tfunction func_1(...args) {\r\n\t\treturn /*func_1*/ ctx[11](/*preset*/ ctx[14], ...args);\r\n\t}\r\n\r\n\tfunction func_2(...args) {\r\n\t\treturn /*func_2*/ ctx[12](/*preset*/ ctx[14], ...args);\r\n\t}\r\n\r\n\tfunction func_3(...args) {\r\n\t\treturn /*func_3*/ ctx[13](/*preset*/ ctx[14], ...args);\r\n\t}\r\n\r\n\tdragbutton = new DragButton({\r\n\t\t\tprops: {\r\n\t\t\t\tonclick: func,\r\n\t\t\t\tongrab: func_1,\r\n\t\t\t\tondrag: func_2,\r\n\t\t\t\tondrop: func_3,\r\n\t\t\t\tdisabled: /*disabled*/ ctx[1] || /*preset*/ ctx[14].disabled,\r\n\t\t\t\ttitle: /*preset*/ ctx[14].title,\r\n\t\t\t\thtml: /*preset*/ ctx[14].thumb\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tkey: key_1,\r\n\t\tfirst: null,\r\n\t\tc() {\r\n\t\t\tli = element(\"li\");\r\n\t\t\tcreate_component(dragbutton.$$.fragment);\r\n\t\t\tt = space();\r\n\t\t\tattr(li, \"class\", \"PinturaShapePreset\");\r\n\t\t\tattr(li, \"style\", /*style*/ ctx[6]);\r\n\t\t\tthis.first = li;\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, li, anchor);\r\n\t\t\tmount_component(dragbutton, li, null);\r\n\t\t\tappend(li, t);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = action_destroyer(didMountPresetThumb_action = /*didMountPresetThumb*/ ctx[8].call(null, li, /*preset*/ ctx[14]));\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\t\t\tconst dragbutton_changes = {};\r\n\t\t\tif (dirty & /*onclickpreset, presets*/ 5) dragbutton_changes.onclick = func;\r\n\t\t\tif (dirty & /*ongrabpreset, presets*/ 9) dragbutton_changes.ongrab = func_1;\r\n\t\t\tif (dirty & /*ondragpreset, presets*/ 17) dragbutton_changes.ondrag = func_2;\r\n\t\t\tif (dirty & /*ondroppreset, presets*/ 33) dragbutton_changes.ondrop = func_3;\r\n\t\t\tif (dirty & /*disabled, presets*/ 3) dragbutton_changes.disabled = /*disabled*/ ctx[1] || /*preset*/ ctx[14].disabled;\r\n\t\t\tif (dirty & /*presets*/ 1) dragbutton_changes.title = /*preset*/ ctx[14].title;\r\n\t\t\tif (dirty & /*presets*/ 1) dragbutton_changes.html = /*preset*/ ctx[14].thumb;\r\n\t\t\tdragbutton.$set(dragbutton_changes);\r\n\r\n\t\t\tif (!current || dirty & /*style*/ 64) {\r\n\t\t\t\tattr(li, \"style\", /*style*/ ctx[6]);\r\n\t\t\t}\r\n\r\n\t\t\tif (didMountPresetThumb_action && is_function(didMountPresetThumb_action.update) && dirty & /*presets*/ 1) didMountPresetThumb_action.update.call(null, /*preset*/ ctx[14]);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(dragbutton.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(dragbutton.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(li);\r\n\t\t\tdestroy_component(dragbutton);\r\n\t\t\tmounted = false;\r\n\t\t\tdispose();\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$b(ctx) {\r\n\tlet ul;\r\n\tlet each_blocks = [];\r\n\tlet each_1_lookup = new Map();\r\n\tlet current;\r\n\tlet each_value = /*presets*/ ctx[0];\r\n\tconst get_key = ctx => /*preset*/ ctx[14].id;\r\n\r\n\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\tlet child_ctx = get_each_context(ctx, each_value, i);\r\n\t\tlet key = get_key(child_ctx);\r\n\t\teach_1_lookup.set(key, each_blocks[i] = create_each_block(key, child_ctx));\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tul = element(\"ul\");\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].c();\r\n\t\t\t}\r\n\r\n\t\t\tattr(ul, \"class\", \"PinturaShapePresetsList\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, ul, anchor);\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].m(ul, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tif (dirty & /*style, presets, onclickpreset, ongrabpreset, ondragpreset, ondroppreset, disabled*/ 127) {\r\n\t\t\t\teach_value = /*presets*/ ctx[0];\r\n\t\t\t\tgroup_outros();\r\n\t\t\t\teach_blocks = update_keyed_each(each_blocks, dirty, get_key, 1, ctx, each_value, each_1_lookup, ul, outro_and_destroy_block, create_each_block, null, get_each_context);\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\r\n\t\t\tfor (let i = 0; i < each_value.length; i += 1) {\r\n\t\t\t\ttransition_in(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\ttransition_out(each_blocks[i]);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(ul);\r\n\r\n\t\t\tfor (let i = 0; i < each_blocks.length; i += 1) {\r\n\t\t\t\teach_blocks[i].d();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$b($$self, $$props, $$invalidate) {\r\n\tlet style;\r\n\tlet $opacity;\r\n\tlet { presets } = $$props;\r\n\tlet { disabled = undefined } = $$props;\r\n\tlet { onclickpreset } = $$props;\r\n\tlet { ongrabpreset = undefined } = $$props;\r\n\tlet { ondragpreset = undefined } = $$props;\r\n\tlet { ondroppreset = undefined } = $$props;\r\n\tconst opacity = spring(0, { stiffness: 0.25, damping: 0.9 });\r\n\tcomponent_subscribe($$self, opacity, value => $$invalidate(9, $opacity = value));\r\n\tconst didMountPresetThumb = (element, item) => item.mount && item.mount(element.firstChild, item);\r\n\tonMount(() => opacity.set(1));\r\n\tconst func = preset => onclickpreset(preset.id);\r\n\tconst func_1 = (preset, e) => ongrabpreset && ongrabpreset(preset.id, e);\r\n\tconst func_2 = (preset, e) => ondragpreset && ondragpreset(preset.id, e);\r\n\tconst func_3 = (preset, e) => ondroppreset && ondroppreset(preset.id, e);\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('presets' in $$props) $$invalidate(0, presets = $$props.presets);\r\n\t\tif ('disabled' in $$props) $$invalidate(1, disabled = $$props.disabled);\r\n\t\tif ('onclickpreset' in $$props) $$invalidate(2, onclickpreset = $$props.onclickpreset);\r\n\t\tif ('ongrabpreset' in $$props) $$invalidate(3, ongrabpreset = $$props.ongrabpreset);\r\n\t\tif ('ondragpreset' in $$props) $$invalidate(4, ondragpreset = $$props.ondragpreset);\r\n\t\tif ('ondroppreset' in $$props) $$invalidate(5, ondroppreset = $$props.ondroppreset);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*$opacity*/ 512) {\r\n\t\t\t$$invalidate(6, style = `opacity:${$opacity}`);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tpresets,\r\n\t\tdisabled,\r\n\t\tonclickpreset,\r\n\t\tongrabpreset,\r\n\t\tondragpreset,\r\n\t\tondroppreset,\r\n\t\tstyle,\r\n\t\topacity,\r\n\t\tdidMountPresetThumb,\r\n\t\t$opacity,\r\n\t\tfunc,\r\n\t\tfunc_1,\r\n\t\tfunc_2,\r\n\t\tfunc_3\r\n\t];\r\n}\r\n\r\nclass ShapePresetsList extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$b, create_fragment$b, safe_not_equal, {\r\n\t\t\tpresets: 0,\r\n\t\t\tdisabled: 1,\r\n\t\t\tonclickpreset: 2,\r\n\t\t\tongrabpreset: 3,\r\n\t\t\tondragpreset: 4,\r\n\t\t\tondroppreset: 5\r\n\t\t});\r\n\t}\r\n}\r\n\r\nvar isSVGMarkup = (str) => /<svg /.test(str);\r\n\r\n/* src/core/ui/components/ShapePresetsPalette.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_if_block_6(ctx) {\r\n\tlet dynamiccomponenttree;\r\n\tlet current;\r\n\r\n\tdynamiccomponenttree = new DynamicComponentTree_1({\r\n\t\t\tprops: { items: /*presetToolbar*/ ctx[10] }\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(dynamiccomponenttree.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(dynamiccomponenttree, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst dynamiccomponenttree_changes = {};\r\n\t\t\tif (dirty & /*presetToolbar*/ 1024) dynamiccomponenttree_changes.items = /*presetToolbar*/ ctx[10];\r\n\t\t\tdynamiccomponenttree.$set(dynamiccomponenttree_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(dynamiccomponenttree.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(dynamiccomponenttree.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(dynamiccomponenttree, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (162:4) {#if shouldRenderPresets}\r\nfunction create_if_block$1(ctx) {\r\n\tlet current_block_type_index;\r\n\tlet if_block;\r\n\tlet if_block_anchor;\r\n\tlet current;\r\n\tconst if_block_creators = [create_if_block_1$1, create_else_block$1];\r\n\tconst if_blocks = [];\r\n\r\n\tfunction select_block_type_1(ctx, dirty) {\r\n\t\tif (/*shouldGroupPresets*/ ctx[8]) return 0;\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tcurrent_block_type_index = select_block_type_1(ctx);\r\n\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif_block.c();\r\n\t\t\tif_block_anchor = empty();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif_blocks[current_block_type_index].m(target, anchor);\r\n\t\t\tinsert(target, if_block_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tlet previous_block_index = current_block_type_index;\r\n\t\t\tcurrent_block_type_index = select_block_type_1(ctx);\r\n\r\n\t\t\tif (current_block_type_index === previous_block_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].p(ctx, dirty);\r\n\t\t\t} else {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_blocks[previous_block_index], 1, 1, () => {\r\n\t\t\t\t\tif_blocks[previous_block_index] = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t\tif_block = if_blocks[current_block_type_index];\r\n\r\n\t\t\t\tif (!if_block) {\r\n\t\t\t\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\tif_block.m(if_block_anchor.parentNode, if_block_anchor);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif_blocks[current_block_type_index].d(detaching);\r\n\t\t\tif (detaching) detach(if_block_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (211:8) {:else}\r\nfunction create_else_block$1(ctx) {\r\n\tlet div;\r\n\tlet t;\r\n\tlet scrollable;\r\n\tlet current;\r\n\tlet if_block = /*presetToolbar*/ ctx[10] && create_if_block_5$1(ctx);\r\n\r\n\tscrollable = new Scrollable({\r\n\t\t\tprops: {\r\n\t\t\t\tscrollAutoCancel: /*shouldRenderPresets*/ ctx[9],\r\n\t\t\t\telasticity: /*scrollElasticity*/ ctx[0],\r\n\t\t\t\t$$slots: { default: [create_default_slot_5] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tt = space();\r\n\t\t\tcreate_component(scrollable.$$.fragment);\r\n\t\t\tattr(div, \"class\", \"PinturaShapePresetsFlat\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tif (if_block) if_block.m(div, null);\r\n\t\t\tappend(div, t);\r\n\t\t\tmount_component(scrollable, div, null);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (/*presetToolbar*/ ctx[10]) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty & /*presetToolbar*/ 1024) {\r\n\t\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block_5$1(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(div, t);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block, 1, 1, () => {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tconst scrollable_changes = {};\r\n\t\t\tif (dirty & /*shouldRenderPresets*/ 512) scrollable_changes.scrollAutoCancel = /*shouldRenderPresets*/ ctx[9];\r\n\t\t\tif (dirty & /*scrollElasticity*/ 1) scrollable_changes.elasticity = /*scrollElasticity*/ ctx[0];\r\n\r\n\t\t\tif (dirty & /*$$scope, presetsMapped, onaddpreset, ongrabpreset, ondragpreset, ondroppreset*/ 536871070) {\r\n\t\t\t\tscrollable_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tscrollable.$set(scrollable_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\ttransition_in(scrollable.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\ttransition_out(scrollable.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif (if_block) if_block.d();\r\n\t\t\tdestroy_component(scrollable);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (164:8) {#if shouldGroupPresets}\r\nfunction create_if_block_1$1(ctx) {\r\n\tlet div;\r\n\tlet scrollable;\r\n\tlet t;\r\n\tlet tabpanels;\r\n\tlet current;\r\n\r\n\tscrollable = new Scrollable({\r\n\t\t\tprops: {\r\n\t\t\t\telasticity: /*scrollElasticity*/ ctx[0],\r\n\t\t\t\tclass: \"PinturaShapePresetsGroups\",\r\n\t\t\t\t$$slots: { default: [create_default_slot_2] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tconst tabpanels_spread_levels = [\r\n\t\t{ class: \"PinturaControlPanels\" },\r\n\t\t{ panelClass: \"PinturaControlPanel\" },\r\n\t\t{ panels: /*panels*/ ctx[11] },\r\n\t\t/*tabsConfig*/ ctx[12]\r\n\t];\r\n\r\n\tlet tabpanels_props = {\r\n\t\t$$slots: {\r\n\t\t\tdefault: [\r\n\t\t\t\tcreate_default_slot$4,\r\n\t\t\t\t({ panel, panelIsActive }) => ({ 26: panel, 27: panelIsActive }),\r\n\t\t\t\t({ panel, panelIsActive }) => (panel ? 67108864 : 0) | (panelIsActive ? 134217728 : 0)\r\n\t\t\t]\r\n\t\t},\r\n\t\t$$scope: { ctx }\r\n\t};\r\n\r\n\tfor (let i = 0; i < tabpanels_spread_levels.length; i += 1) {\r\n\t\ttabpanels_props = assign(tabpanels_props, tabpanels_spread_levels[i]);\r\n\t}\r\n\r\n\ttabpanels = new TabPanels({ props: tabpanels_props });\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tcreate_component(scrollable.$$.fragment);\r\n\t\t\tt = space();\r\n\t\t\tcreate_component(tabpanels.$$.fragment);\r\n\t\t\tattr(div, \"class\", \"PinturaShapePresetsGrouped\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tmount_component(scrollable, div, null);\r\n\t\t\tappend(div, t);\r\n\t\t\tmount_component(tabpanels, div, null);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst scrollable_changes = {};\r\n\t\t\tif (dirty & /*scrollElasticity*/ 1) scrollable_changes.elasticity = /*scrollElasticity*/ ctx[0];\r\n\r\n\t\t\tif (dirty & /*$$scope, tabs, tabsConfig, tabSelected, presetToolbar*/ 536876128) {\r\n\t\t\t\tscrollable_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tscrollable.$set(scrollable_changes);\r\n\r\n\t\t\tconst tabpanels_changes = (dirty & /*panels, tabsConfig*/ 6144)\r\n\t\t\t? get_spread_update(tabpanels_spread_levels, [\r\n\t\t\t\t\ttabpanels_spread_levels[0],\r\n\t\t\t\t\ttabpanels_spread_levels[1],\r\n\t\t\t\t\tdirty & /*panels*/ 2048 && { panels: /*panels*/ ctx[11] },\r\n\t\t\t\t\tdirty & /*tabsConfig*/ 4096 && get_spread_object(/*tabsConfig*/ ctx[12])\r\n\t\t\t\t])\r\n\t\t\t: {};\r\n\r\n\t\t\tif (dirty & /*$$scope, panelIsActive, shouldRenderPresets, scrollElasticity, presetTabs, panel, onaddpreset, ongrabpreset, ondragpreset, ondroppreset*/ 738206239) {\r\n\t\t\t\ttabpanels_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ttabpanels.$set(tabpanels_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(scrollable.$$.fragment, local);\r\n\t\t\ttransition_in(tabpanels.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(scrollable.$$.fragment, local);\r\n\t\t\ttransition_out(tabpanels.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tdestroy_component(scrollable);\r\n\t\t\tdestroy_component(tabpanels);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (214:16) {#if presetToolbar}\r\nfunction create_if_block_5$1(ctx) {\r\n\tlet dynamiccomponenttree;\r\n\tlet current;\r\n\r\n\tdynamiccomponenttree = new DynamicComponentTree_1({\r\n\t\t\tprops: { items: /*presetToolbar*/ ctx[10] }\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(dynamiccomponenttree.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(dynamiccomponenttree, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst dynamiccomponenttree_changes = {};\r\n\t\t\tif (dirty & /*presetToolbar*/ 1024) dynamiccomponenttree_changes.items = /*presetToolbar*/ ctx[10];\r\n\t\t\tdynamiccomponenttree.$set(dynamiccomponenttree_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(dynamiccomponenttree.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(dynamiccomponenttree.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(dynamiccomponenttree, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (218:16) <Scrollable scrollAutoCancel={shouldRenderPresets} elasticity={scrollElasticity}>\r\nfunction create_default_slot_5(ctx) {\r\n\tlet shapepresetslist;\r\n\tlet current;\r\n\r\n\tshapepresetslist = new ShapePresetsList({\r\n\t\t\tprops: {\r\n\t\t\t\tpresets: /*presetsMapped*/ ctx[7],\r\n\t\t\t\tonclickpreset: /*onaddpreset*/ ctx[1],\r\n\t\t\t\tongrabpreset: /*ongrabpreset*/ ctx[2],\r\n\t\t\t\tondragpreset: /*ondragpreset*/ ctx[3],\r\n\t\t\t\tondroppreset: /*ondroppreset*/ ctx[4]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(shapepresetslist.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(shapepresetslist, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst shapepresetslist_changes = {};\r\n\t\t\tif (dirty & /*presetsMapped*/ 128) shapepresetslist_changes.presets = /*presetsMapped*/ ctx[7];\r\n\t\t\tif (dirty & /*onaddpreset*/ 2) shapepresetslist_changes.onclickpreset = /*onaddpreset*/ ctx[1];\r\n\t\t\tif (dirty & /*ongrabpreset*/ 4) shapepresetslist_changes.ongrabpreset = /*ongrabpreset*/ ctx[2];\r\n\t\t\tif (dirty & /*ondragpreset*/ 8) shapepresetslist_changes.ondragpreset = /*ondragpreset*/ ctx[3];\r\n\t\t\tif (dirty & /*ondroppreset*/ 16) shapepresetslist_changes.ondroppreset = /*ondroppreset*/ ctx[4];\r\n\t\t\tshapepresetslist.$set(shapepresetslist_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(shapepresetslist.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(shapepresetslist.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(shapepresetslist, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (167:20) {#if presetToolbar}\r\nfunction create_if_block_4$1(ctx) {\r\n\tlet dynamiccomponenttree;\r\n\tlet current;\r\n\r\n\tdynamiccomponenttree = new DynamicComponentTree_1({\r\n\t\t\tprops: { items: /*presetToolbar*/ ctx[10] }\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(dynamiccomponenttree.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(dynamiccomponenttree, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst dynamiccomponenttree_changes = {};\r\n\t\t\tif (dirty & /*presetToolbar*/ 1024) dynamiccomponenttree_changes.items = /*presetToolbar*/ ctx[10];\r\n\t\t\tdynamiccomponenttree.$set(dynamiccomponenttree_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(dynamiccomponenttree.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(dynamiccomponenttree.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(dynamiccomponenttree, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (178:24) {#if tab.icon}\r\nfunction create_if_block_3$1(ctx) {\r\n\tlet icon;\r\n\tlet current;\r\n\r\n\ticon = new Icon({\r\n\t\t\tprops: {\r\n\t\t\t\t$$slots: { default: [create_default_slot_4] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(icon.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(icon, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst icon_changes = {};\r\n\r\n\t\t\tif (dirty & /*$$scope, tab*/ 805306368) {\r\n\t\t\t\ticon_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ticon.$set(icon_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(icon.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(icon.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(icon, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (179:28) <Icon>\r\nfunction create_default_slot_4(ctx) {\r\n\tlet g;\r\n\tlet raw_value = /*tab*/ ctx[28].icon + \"\";\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tg = svg_element(\"g\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, g, anchor);\r\n\t\t\tg.innerHTML = raw_value;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty & /*tab*/ 268435456 && raw_value !== (raw_value = /*tab*/ ctx[28].icon + \"\")) g.innerHTML = raw_value;\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(g);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (181:24) {#if !tab.hideLabel}\r\nfunction create_if_block_2$1(ctx) {\r\n\tlet span;\r\n\tlet t_value = /*tab*/ ctx[28].label + \"\";\r\n\tlet t;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt = text(t_value);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, span, anchor);\r\n\t\t\tappend(span, t);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty & /*tab*/ 268435456 && t_value !== (t_value = /*tab*/ ctx[28].label + \"\")) set_data(t, t_value);\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(span);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (170:20) <TabList                         class=\"PinturaControlList\"                         {tabs}                         {...tabsConfig}                         layout=\"compact\"                         on:select={({ detail }) => (tabSelected = detail)}                         let:tab                     >\r\nfunction create_default_slot_3(ctx) {\r\n\tlet t;\r\n\tlet if_block1_anchor;\r\n\tlet current;\r\n\tlet if_block0 = /*tab*/ ctx[28].icon && create_if_block_3$1(ctx);\r\n\tlet if_block1 = !/*tab*/ ctx[28].hideLabel && create_if_block_2$1(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (if_block0) if_block0.c();\r\n\t\t\tt = space();\r\n\t\t\tif (if_block1) if_block1.c();\r\n\t\t\tif_block1_anchor = empty();\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (if_block0) if_block0.m(target, anchor);\r\n\t\t\tinsert(target, t, anchor);\r\n\t\t\tif (if_block1) if_block1.m(target, anchor);\r\n\t\t\tinsert(target, if_block1_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (/*tab*/ ctx[28].icon) {\r\n\t\t\t\tif (if_block0) {\r\n\t\t\t\t\tif_block0.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty & /*tab*/ 268435456) {\r\n\t\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block0 = create_if_block_3$1(ctx);\r\n\t\t\t\t\tif_block0.c();\r\n\t\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\t\tif_block0.m(t.parentNode, t);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block0) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block0, 1, 1, () => {\r\n\t\t\t\t\tif_block0 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (!/*tab*/ ctx[28].hideLabel) {\r\n\t\t\t\tif (if_block1) {\r\n\t\t\t\t\tif_block1.p(ctx, dirty);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block1 = create_if_block_2$1(ctx);\r\n\t\t\t\t\tif_block1.c();\r\n\t\t\t\t\tif_block1.m(if_block1_anchor.parentNode, if_block1_anchor);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block1) {\r\n\t\t\t\tif_block1.d(1);\r\n\t\t\t\tif_block1 = null;\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block0);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block0);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (if_block0) if_block0.d(detaching);\r\n\t\t\tif (detaching) detach(t);\r\n\t\t\tif (if_block1) if_block1.d(detaching);\r\n\t\t\tif (detaching) detach(if_block1_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (166:16) <Scrollable elasticity={scrollElasticity} class=\"PinturaShapePresetsGroups\">\r\nfunction create_default_slot_2(ctx) {\r\n\tlet t;\r\n\tlet tablist;\r\n\tlet current;\r\n\tlet if_block = /*presetToolbar*/ ctx[10] && create_if_block_4$1(ctx);\r\n\r\n\tconst tablist_spread_levels = [\r\n\t\t{ class: \"PinturaControlList\" },\r\n\t\t{ tabs: /*tabs*/ ctx[5] },\r\n\t\t/*tabsConfig*/ ctx[12],\r\n\t\t{ layout: \"compact\" }\r\n\t];\r\n\r\n\tlet tablist_props = {\r\n\t\t$$slots: {\r\n\t\t\tdefault: [\r\n\t\t\t\tcreate_default_slot_3,\r\n\t\t\t\t({ tab }) => ({ 28: tab }),\r\n\t\t\t\t({ tab }) => tab ? 268435456 : 0\r\n\t\t\t]\r\n\t\t},\r\n\t\t$$scope: { ctx }\r\n\t};\r\n\r\n\tfor (let i = 0; i < tablist_spread_levels.length; i += 1) {\r\n\t\ttablist_props = assign(tablist_props, tablist_spread_levels[i]);\r\n\t}\r\n\r\n\ttablist = new TabList({ props: tablist_props });\r\n\ttablist.$on(\"select\", /*select_handler*/ ctx[18]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tt = space();\r\n\t\t\tcreate_component(tablist.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tif (if_block) if_block.m(target, anchor);\r\n\t\t\tinsert(target, t, anchor);\r\n\t\t\tmount_component(tablist, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (/*presetToolbar*/ ctx[10]) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty & /*presetToolbar*/ 1024) {\r\n\t\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block_4$1(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(t.parentNode, t);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block, 1, 1, () => {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tconst tablist_changes = (dirty & /*tabs, tabsConfig*/ 4128)\r\n\t\t\t? get_spread_update(tablist_spread_levels, [\r\n\t\t\t\t\ttablist_spread_levels[0],\r\n\t\t\t\t\tdirty & /*tabs*/ 32 && { tabs: /*tabs*/ ctx[5] },\r\n\t\t\t\t\tdirty & /*tabsConfig*/ 4096 && get_spread_object(/*tabsConfig*/ ctx[12]),\r\n\t\t\t\t\ttablist_spread_levels[3]\r\n\t\t\t\t])\r\n\t\t\t: {};\r\n\r\n\t\t\tif (dirty & /*$$scope, tab*/ 805306368) {\r\n\t\t\t\ttablist_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ttablist.$set(tablist_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\ttransition_in(tablist.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\ttransition_out(tablist.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (if_block) if_block.d(detaching);\r\n\t\t\tif (detaching) detach(t);\r\n\t\t\tdestroy_component(tablist, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (195:20) <Scrollable                         scroll={panelIsActive ? { scrollOffset: 0, animate: false } : undefined}                         scrollAutoCancel={shouldRenderPresets}                         elasticity={scrollElasticity}                     >\r\nfunction create_default_slot_1$1(ctx) {\r\n\tlet shapepresetslist;\r\n\tlet current;\r\n\r\n\tshapepresetslist = new ShapePresetsList({\r\n\t\t\tprops: {\r\n\t\t\t\tpresets: /*presetTabs*/ ctx[13][/*panel*/ ctx[26]].items,\r\n\t\t\t\tdisabled: /*presetTabs*/ ctx[13][/*panel*/ ctx[26]].disabled,\r\n\t\t\t\tonclickpreset: /*onaddpreset*/ ctx[1],\r\n\t\t\t\tongrabpreset: /*ongrabpreset*/ ctx[2],\r\n\t\t\t\tondragpreset: /*ondragpreset*/ ctx[3],\r\n\t\t\t\tondroppreset: /*ondroppreset*/ ctx[4]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(shapepresetslist.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(shapepresetslist, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst shapepresetslist_changes = {};\r\n\t\t\tif (dirty & /*presetTabs, panel*/ 67117056) shapepresetslist_changes.presets = /*presetTabs*/ ctx[13][/*panel*/ ctx[26]].items;\r\n\t\t\tif (dirty & /*presetTabs, panel*/ 67117056) shapepresetslist_changes.disabled = /*presetTabs*/ ctx[13][/*panel*/ ctx[26]].disabled;\r\n\t\t\tif (dirty & /*onaddpreset*/ 2) shapepresetslist_changes.onclickpreset = /*onaddpreset*/ ctx[1];\r\n\t\t\tif (dirty & /*ongrabpreset*/ 4) shapepresetslist_changes.ongrabpreset = /*ongrabpreset*/ ctx[2];\r\n\t\t\tif (dirty & /*ondragpreset*/ 8) shapepresetslist_changes.ondragpreset = /*ondragpreset*/ ctx[3];\r\n\t\t\tif (dirty & /*ondroppreset*/ 16) shapepresetslist_changes.ondroppreset = /*ondroppreset*/ ctx[4];\r\n\t\t\tshapepresetslist.$set(shapepresetslist_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(shapepresetslist.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(shapepresetslist.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(shapepresetslist, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (187:16) <TabPanels                     class=\"PinturaControlPanels\"                     panelClass=\"PinturaControlPanel\"                     {panels}                     {...tabsConfig}                     let:panel                     let:panelIsActive                 >\r\nfunction create_default_slot$4(ctx) {\r\n\tlet scrollable;\r\n\tlet current;\r\n\r\n\tscrollable = new Scrollable({\r\n\t\t\tprops: {\r\n\t\t\t\tscroll: /*panelIsActive*/ ctx[27]\r\n\t\t\t\t? { scrollOffset: 0, animate: false }\r\n\t\t\t\t: undefined,\r\n\t\t\t\tscrollAutoCancel: /*shouldRenderPresets*/ ctx[9],\r\n\t\t\t\telasticity: /*scrollElasticity*/ ctx[0],\r\n\t\t\t\t$$slots: { default: [create_default_slot_1$1] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(scrollable.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(scrollable, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst scrollable_changes = {};\r\n\r\n\t\t\tif (dirty & /*panelIsActive*/ 134217728) scrollable_changes.scroll = /*panelIsActive*/ ctx[27]\r\n\t\t\t? { scrollOffset: 0, animate: false }\r\n\t\t\t: undefined;\r\n\r\n\t\t\tif (dirty & /*shouldRenderPresets*/ 512) scrollable_changes.scrollAutoCancel = /*shouldRenderPresets*/ ctx[9];\r\n\t\t\tif (dirty & /*scrollElasticity*/ 1) scrollable_changes.elasticity = /*scrollElasticity*/ ctx[0];\r\n\r\n\t\t\tif (dirty & /*$$scope, presetTabs, panel, onaddpreset, ongrabpreset, ondragpreset, ondroppreset*/ 603987998) {\r\n\t\t\t\tscrollable_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tscrollable.$set(scrollable_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(scrollable.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(scrollable.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(scrollable, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$a(ctx) {\r\n\tlet div;\r\n\tlet current_block_type_index;\r\n\tlet if_block;\r\n\tlet current;\r\n\tconst if_block_creators = [create_if_block$1, create_if_block_6];\r\n\tconst if_blocks = [];\r\n\r\n\tfunction select_block_type(ctx, dirty) {\r\n\t\tif (/*shouldRenderPresets*/ ctx[9]) return 0;\r\n\t\tif (/*presetToolbar*/ ctx[10]) return 1;\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tif (~(current_block_type_index = select_block_type(ctx))) {\r\n\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tattr(div, \"class\", \"PinturaShapePresetsPalette\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\r\n\t\t\tif (~current_block_type_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].m(div, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tlet previous_block_index = current_block_type_index;\r\n\t\t\tcurrent_block_type_index = select_block_type(ctx);\r\n\r\n\t\t\tif (current_block_type_index === previous_block_index) {\r\n\t\t\t\tif (~current_block_type_index) {\r\n\t\t\t\t\tif_blocks[current_block_type_index].p(ctx, dirty);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\t\ttransition_out(if_blocks[previous_block_index], 1, 1, () => {\r\n\t\t\t\t\t\tif_blocks[previous_block_index] = null;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tcheck_outros();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (~current_block_type_index) {\r\n\t\t\t\t\tif_block = if_blocks[current_block_type_index];\r\n\r\n\t\t\t\t\tif (!if_block) {\r\n\t\t\t\t\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t\t\t\t\t\tif_block.c();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif_block.p(ctx, dirty);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(div, null);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\r\n\t\t\tif (~current_block_type_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].d();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$a($$self, $$props, $$invalidate) {\r\n\tlet presetsMapped;\r\n\tlet shouldRenderPresets;\r\n\tlet shouldGroupPresets;\r\n\tlet tabs;\r\n\tlet presetTabs;\r\n\tlet tabSelected;\r\n\tlet tabsConfig;\r\n\tlet panels;\r\n\tlet presetToolbar;\r\n\tlet { locale } = $$props;\r\n\tlet { presets } = $$props;\r\n\tlet { scrollElasticity } = $$props;\r\n\tlet { enableSelectImage = true } = $$props;\r\n\tlet { willRenderPresetToolbar = passthrough } = $$props;\r\n\tlet { onaddpreset = noop$1 } = $$props;\r\n\tlet { ongrabpreset = undefined } = $$props;\r\n\tlet { ondragpreset = undefined } = $$props;\r\n\tlet { ondroppreset = undefined } = $$props;\r\n\tconst uid = `presets-${getUniqueId()}`;\r\n\tconst isPresetGroup = item => isArray(item) && isString(item[0]) && isArray(item[1]);\r\n\r\n\tconst getPresetThumb = (value, alt = '') => {\r\n\t\t// could be svg\r\n\t\tif (isSVGMarkup(value)) return value;\r\n\r\n\t\t// test if is emoji\r\n\t\tif (isEmoji(value)) return getEmojiSVG(value, alt);\r\n\r\n\t\t// must be URL\r\n\t\treturn `<img src=\"${value}\" alt=\"${alt}\"/>`;\r\n\t};\r\n\r\n\tconst getAltFromSrc = src => getFilenameWithoutExtension(getFilenameFromURL(src));\r\n\tconst excludedStickerItemProps = ['src', 'alt', 'thumb', 'shape', 'id', 'mount', 'disabled'];\r\n\r\n\tconst mapPreset = item => {\r\n\t\tlet id = item;\r\n\t\tlet src;\r\n\t\tlet shape;\r\n\t\tlet shapeProps;\r\n\t\tlet thumb;\r\n\t\tlet alt;\r\n\t\tlet mount;\r\n\t\tlet disabled;\r\n\r\n\t\t// if item is a string, it's either an emoji or a URL\r\n\t\tif (isString(item)) {\r\n\t\t\t// is emoji\r\n\t\t\tif (isEmoji(item)) {\r\n\t\t\t\tsrc = item;\r\n\t\t\t\talt = item;\r\n\t\t\t\tthumb = getPresetThumb(src, alt);\r\n\t\t\t} else // must be URL\r\n\t\t\t{\r\n\t\t\t\tsrc = item;\r\n\t\t\t\talt = getAltFromSrc(src);\r\n\t\t\t\tthumb = getPresetThumb(src, alt);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// set custom thumbnail if defined\r\n\t\t\tsrc = item.src;\r\n\r\n\t\t\talt = item.alt || (isString(src)\r\n\t\t\t? getAltFromSrc(src)\r\n\t\t\t: isString(item.thumb)\r\n\t\t\t\t? getAltFromSrc(item.thumb)\r\n\t\t\t\t: undefined);\r\n\r\n\t\t\tthumb = getPresetThumb(item.thumb || src, alt);\r\n\t\t\tshape = item.shape;\r\n\t\t\tmount = item.mount;\r\n\t\t\tdisabled = item.disabled;\r\n\r\n\t\t\tshapeProps = Object.keys(item).reduce(\r\n\t\t\t\t(prev, curr) => {\r\n\t\t\t\t\tif (excludedStickerItemProps.includes(curr)) return prev;\r\n\t\t\t\t\tprev[curr] = item[curr];\r\n\t\t\t\t\treturn prev;\r\n\t\t\t\t},\r\n\t\t\t\t{}\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tid,\r\n\t\t\tsrc,\r\n\t\t\tthumb,\r\n\t\t\tshape,\r\n\t\t\tshapeProps,\r\n\t\t\talt,\r\n\t\t\ttitle: alt,\r\n\t\t\tmount,\r\n\t\t\tdisabled\r\n\t\t};\r\n\t};\r\n\r\n\tconst mapPresets = items => items.map(item => {\r\n\t\tif (isPresetGroup(item)) {\r\n\t\t\treturn {\r\n\t\t\t\t...item[2],\r\n\t\t\t\tid: `${uid}-${item[0].toLowerCase()}`,\r\n\t\t\t\tlabel: item[0],\r\n\t\t\t\titems: mapPresets(item[1])\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn mapPreset(item);\r\n\t});\r\n\r\n\tconst select_handler = ({ detail }) => $$invalidate(6, tabSelected = detail);\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('locale' in $$props) $$invalidate(14, locale = $$props.locale);\r\n\t\tif ('presets' in $$props) $$invalidate(15, presets = $$props.presets);\r\n\t\tif ('scrollElasticity' in $$props) $$invalidate(0, scrollElasticity = $$props.scrollElasticity);\r\n\t\tif ('enableSelectImage' in $$props) $$invalidate(16, enableSelectImage = $$props.enableSelectImage);\r\n\t\tif ('willRenderPresetToolbar' in $$props) $$invalidate(17, willRenderPresetToolbar = $$props.willRenderPresetToolbar);\r\n\t\tif ('onaddpreset' in $$props) $$invalidate(1, onaddpreset = $$props.onaddpreset);\r\n\t\tif ('ongrabpreset' in $$props) $$invalidate(2, ongrabpreset = $$props.ongrabpreset);\r\n\t\tif ('ondragpreset' in $$props) $$invalidate(3, ondragpreset = $$props.ondragpreset);\r\n\t\tif ('ondroppreset' in $$props) $$invalidate(4, ondroppreset = $$props.ondroppreset);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*presets*/ 32768) {\r\n\t\t\t$$invalidate(7, presetsMapped = mapPresets(presets));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*presetsMapped*/ 128) {\r\n\t\t\t//\r\n\t\t\t// handle file input\r\n\t\t\t//\r\n\t\t\t$$invalidate(9, shouldRenderPresets = presetsMapped.length);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*shouldRenderPresets, presetsMapped*/ 640) {\r\n\t\t\t$$invalidate(8, shouldGroupPresets = shouldRenderPresets && presetsMapped.some(preset => !!preset.items));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*shouldGroupPresets, presetsMapped*/ 384) {\r\n\t\t\t$$invalidate(5, tabs = shouldGroupPresets && presetsMapped);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*shouldGroupPresets, presetsMapped*/ 384) {\r\n\t\t\t$$invalidate(13, presetTabs = shouldGroupPresets && presetsMapped.reduce(\r\n\t\t\t\t(prev, curr) => {\r\n\t\t\t\t\tprev[curr.id] = curr;\r\n\t\t\t\t\treturn prev;\r\n\t\t\t\t},\r\n\t\t\t\t{}\r\n\t\t\t));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*tabSelected, tabs*/ 96) {\r\n\t\t\t$$invalidate(6, tabSelected = tabSelected || tabs && (tabs.find(tab => !tab.disabled) || {}).id);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*tabSelected*/ 64) {\r\n\t\t\t$$invalidate(12, tabsConfig = { name: uid, selected: tabSelected });\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*tabs*/ 32) {\r\n\t\t\t$$invalidate(11, panels = tabs && tabs.map(tab => tab.id));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*locale, willRenderPresetToolbar, enableSelectImage, onaddpreset*/ 212994) {\r\n\t\t\t$$invalidate(10, presetToolbar = locale && willRenderPresetToolbar([\r\n\t\t\t\tenableSelectImage && [\r\n\t\t\t\t\t'Button',\r\n\t\t\t\t\t'browse',\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlabel: locale.shapeLabelButtonSelectSticker,\r\n\t\t\t\t\t\ticon: locale.shapeIconButtonSelectSticker,\r\n\t\t\t\t\t\tonclick: () => {\r\n\t\t\t\t\t\t\tbrowse().then(file => {\r\n\t\t\t\t\t\t\t\tif (!file) return;\r\n\t\t\t\t\t\t\t\tonaddpreset(file);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t]));\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tscrollElasticity,\r\n\t\tonaddpreset,\r\n\t\tongrabpreset,\r\n\t\tondragpreset,\r\n\t\tondroppreset,\r\n\t\ttabs,\r\n\t\ttabSelected,\r\n\t\tpresetsMapped,\r\n\t\tshouldGroupPresets,\r\n\t\tshouldRenderPresets,\r\n\t\tpresetToolbar,\r\n\t\tpanels,\r\n\t\ttabsConfig,\r\n\t\tpresetTabs,\r\n\t\tlocale,\r\n\t\tpresets,\r\n\t\tenableSelectImage,\r\n\t\twillRenderPresetToolbar,\r\n\t\tselect_handler\r\n\t];\r\n}\r\n\r\nclass ShapePresetsPalette extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$a, create_fragment$a, safe_not_equal, {\r\n\t\t\tlocale: 14,\r\n\t\t\tpresets: 15,\r\n\t\t\tscrollElasticity: 0,\r\n\t\t\tenableSelectImage: 16,\r\n\t\t\twillRenderPresetToolbar: 17,\r\n\t\t\tonaddpreset: 1,\r\n\t\t\tongrabpreset: 2,\r\n\t\t\tondragpreset: 3,\r\n\t\t\tondroppreset: 4\r\n\t\t});\r\n\t}\r\n}\r\n\r\nvar createPingDispatcher = (node) => (type, data) => {\r\n    node.dispatchEvent(createPing(type, data));\r\n};\r\n\r\n/* src/core/ui/components/ShapeUtil.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_if_block_5(ctx) {\r\n\tlet shapelayouteditor;\r\n\tlet updating_markup;\r\n\tlet updating_ui;\r\n\tlet current;\r\n\r\n\tconst shapelayouteditor_spread_levels = [\r\n\t\t{ locale: /*locale*/ ctx[4] },\r\n\t\t{ uid: /*utilKey*/ ctx[14] },\r\n\t\t{ parentRect: /*$parentRect*/ ctx[29] },\r\n\t\t{ rootRect: /*$rootRect*/ ctx[43] },\r\n\t\t{ utilRect: /*$utilRectPadded*/ ctx[30] },\r\n\t\t{ offset: /*markupOffset*/ ctx[38] },\r\n\t\t{\r\n\t\t\tdisabled: /*$enablePanInputStatus*/ ctx[28]\r\n\t\t},\r\n\t\t{\r\n\t\t\tcontextRotation: /*imageRotation*/ ctx[17]\r\n\t\t},\r\n\t\t{ contextFlipX: /*imageFlipX*/ ctx[18] },\r\n\t\t{ contextFlipY: /*imageFlipY*/ ctx[19] },\r\n\t\t{\r\n\t\t\tcontextZoom: /*$imageSelectionZoomCurrent*/ ctx[42]\r\n\t\t},\r\n\t\t{ active: /*$isActive*/ ctx[26] },\r\n\t\t{ opacity: /*$isActiveFraction*/ ctx[45] },\r\n\t\t{\r\n\t\t\thoverColor: /*$rootColorSecondary*/ ctx[46]\r\n\t\t},\r\n\t\t{ eraseRadius: /*toolEraseRadius*/ ctx[37] },\r\n\t\t{\r\n\t\t\tselectRadius: /*toolSelectRadius*/ ctx[6]\r\n\t\t},\r\n\t\t{\r\n\t\t\tenableButtonFlipVertical: /*enableButtonFlipVertical*/ ctx[9]\r\n\t\t},\r\n\t\t{\r\n\t\t\tmapEditorPointToImagePoint: /*mapScreenPointToImagePoint*/ ctx[15]\r\n\t\t},\r\n\t\t{\r\n\t\t\tmapImagePointToEditorPoint: /*mapImagePointToScreenPoint*/ ctx[16]\r\n\t\t},\r\n\t\t{\r\n\t\t\tenableTapToAddText: /*enableTapToAddText*/ ctx[12]\r\n\t\t},\r\n\t\t{ textInputMode: /*textInputMode*/ ctx[7] },\r\n\t\t{\r\n\t\t\twillStartInteraction: /*handleWillStartInteraction*/ ctx[80]\r\n\t\t},\r\n\t\t{\r\n\t\t\toninteractionstart: /*handleInteractionStart*/ ctx[66]\r\n\t\t},\r\n\t\t{\r\n\t\t\toninteractionupdate: /*handleInteractionUpdate*/ ctx[67]\r\n\t\t},\r\n\t\t{\r\n\t\t\toninteractionrelease: /*handleInteractionRelease*/ ctx[68]\r\n\t\t},\r\n\t\t{\r\n\t\t\toninteractionend: /*handleInteractionEnd*/ ctx[70]\r\n\t\t},\r\n\t\t{\r\n\t\t\toninteractioncancel: /*handleInteractionCancel*/ ctx[69]\r\n\t\t},\r\n\t\t{\r\n\t\t\tonhovershape: /*handleHoverShape*/ ctx[74]\r\n\t\t},\r\n\t\t{ ontapcanvas: /*handleTapCanvas*/ ctx[73] },\r\n\t\t{ onaddshape: /*func_1*/ ctx[121] },\r\n\t\t{ onselectshape: /*func_2*/ ctx[122] },\r\n\t\t{ ontapshape: /*func_3*/ ctx[123] },\r\n\t\t{ onupdateshape: /*func_4*/ ctx[124] },\r\n\t\t{ onremoveshape: /*func_5*/ ctx[125] },\r\n\t\t/*layoutEditorHooks*/ ctx[32]\r\n\t];\r\n\r\n\tfunction shapelayouteditor_markup_binding(value) {\r\n\t\t/*shapelayouteditor_markup_binding*/ ctx[127](value);\r\n\t}\r\n\r\n\tfunction shapelayouteditor_ui_binding(value) {\r\n\t\t/*shapelayouteditor_ui_binding*/ ctx[128](value);\r\n\t}\r\n\r\n\tlet shapelayouteditor_props = {};\r\n\r\n\tfor (let i = 0; i < shapelayouteditor_spread_levels.length; i += 1) {\r\n\t\tshapelayouteditor_props = assign(shapelayouteditor_props, shapelayouteditor_spread_levels[i]);\r\n\t}\r\n\r\n\tif (/*$shapes*/ ctx[27] !== void 0) {\r\n\t\tshapelayouteditor_props.markup = /*$shapes*/ ctx[27];\r\n\t}\r\n\r\n\tif (/*$imageOverlayMarkup*/ ctx[44] !== void 0) {\r\n\t\tshapelayouteditor_props.ui = /*$imageOverlayMarkup*/ ctx[44];\r\n\t}\r\n\r\n\tshapelayouteditor = new ShapeLayoutEditor({ props: shapelayouteditor_props });\r\n\t/*shapelayouteditor_binding*/ ctx[126](shapelayouteditor);\r\n\tbinding_callbacks.push(() => bind(shapelayouteditor, 'markup', shapelayouteditor_markup_binding));\r\n\tbinding_callbacks.push(() => bind(shapelayouteditor, 'ui', shapelayouteditor_ui_binding));\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(shapelayouteditor.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(shapelayouteditor, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst shapelayouteditor_changes = (dirty[0] & /*locale, utilKey, $parentRect, $utilRectPadded, $enablePanInputStatus, imageRotation, imageFlipX, imageFlipY, $isActive, toolSelectRadius, enableButtonFlipVertical, mapScreenPointToImagePoint, mapImagePointToScreenPoint, enableTapToAddText, textInputMode, ping*/ 1955582672 | dirty[1] & /*$rootRect, markupOffset, $imageSelectionZoomCurrent, $isActiveFraction, $rootColorSecondary, toolEraseRadius, layoutEditorHooks*/ 55490 | dirty[2] & /*handleWillStartInteraction, handleInteractionStart, handleInteractionUpdate, handleInteractionRelease, handleInteractionEnd, handleInteractionCancel, handleHoverShape, handleTapCanvas, handleMarkupUpdate*/ 793072)\r\n\t\t\t? get_spread_update(shapelayouteditor_spread_levels, [\r\n\t\t\t\t\tdirty[0] & /*locale*/ 16 && { locale: /*locale*/ ctx[4] },\r\n\t\t\t\t\tdirty[0] & /*utilKey*/ 16384 && { uid: /*utilKey*/ ctx[14] },\r\n\t\t\t\t\tdirty[0] & /*$parentRect*/ 536870912 && { parentRect: /*$parentRect*/ ctx[29] },\r\n\t\t\t\t\tdirty[1] & /*$rootRect*/ 4096 && { rootRect: /*$rootRect*/ ctx[43] },\r\n\t\t\t\t\tdirty[0] & /*$utilRectPadded*/ 1073741824 && { utilRect: /*$utilRectPadded*/ ctx[30] },\r\n\t\t\t\t\tdirty[1] & /*markupOffset*/ 128 && { offset: /*markupOffset*/ ctx[38] },\r\n\t\t\t\t\tdirty[0] & /*$enablePanInputStatus*/ 268435456 && {\r\n\t\t\t\t\t\tdisabled: /*$enablePanInputStatus*/ ctx[28]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdirty[0] & /*imageRotation*/ 131072 && {\r\n\t\t\t\t\t\tcontextRotation: /*imageRotation*/ ctx[17]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdirty[0] & /*imageFlipX*/ 262144 && { contextFlipX: /*imageFlipX*/ ctx[18] },\r\n\t\t\t\t\tdirty[0] & /*imageFlipY*/ 524288 && { contextFlipY: /*imageFlipY*/ ctx[19] },\r\n\t\t\t\t\tdirty[1] & /*$imageSelectionZoomCurrent*/ 2048 && {\r\n\t\t\t\t\t\tcontextZoom: /*$imageSelectionZoomCurrent*/ ctx[42]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdirty[0] & /*$isActive*/ 67108864 && { active: /*$isActive*/ ctx[26] },\r\n\t\t\t\t\tdirty[1] & /*$isActiveFraction*/ 16384 && { opacity: /*$isActiveFraction*/ ctx[45] },\r\n\t\t\t\t\tdirty[1] & /*$rootColorSecondary*/ 32768 && {\r\n\t\t\t\t\t\thoverColor: /*$rootColorSecondary*/ ctx[46]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdirty[1] & /*toolEraseRadius*/ 64 && { eraseRadius: /*toolEraseRadius*/ ctx[37] },\r\n\t\t\t\t\tdirty[0] & /*toolSelectRadius*/ 64 && {\r\n\t\t\t\t\t\tselectRadius: /*toolSelectRadius*/ ctx[6]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdirty[0] & /*enableButtonFlipVertical*/ 512 && {\r\n\t\t\t\t\t\tenableButtonFlipVertical: /*enableButtonFlipVertical*/ ctx[9]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdirty[0] & /*mapScreenPointToImagePoint*/ 32768 && {\r\n\t\t\t\t\t\tmapEditorPointToImagePoint: /*mapScreenPointToImagePoint*/ ctx[15]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdirty[0] & /*mapImagePointToScreenPoint*/ 65536 && {\r\n\t\t\t\t\t\tmapImagePointToEditorPoint: /*mapImagePointToScreenPoint*/ ctx[16]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdirty[0] & /*enableTapToAddText*/ 4096 && {\r\n\t\t\t\t\t\tenableTapToAddText: /*enableTapToAddText*/ ctx[12]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdirty[0] & /*textInputMode*/ 128 && { textInputMode: /*textInputMode*/ ctx[7] },\r\n\t\t\t\t\tdirty[2] & /*handleWillStartInteraction*/ 262144 && {\r\n\t\t\t\t\t\twillStartInteraction: /*handleWillStartInteraction*/ ctx[80]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdirty[2] & /*handleInteractionStart*/ 16 && {\r\n\t\t\t\t\t\toninteractionstart: /*handleInteractionStart*/ ctx[66]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdirty[2] & /*handleInteractionUpdate*/ 32 && {\r\n\t\t\t\t\t\toninteractionupdate: /*handleInteractionUpdate*/ ctx[67]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdirty[2] & /*handleInteractionRelease*/ 64 && {\r\n\t\t\t\t\t\toninteractionrelease: /*handleInteractionRelease*/ ctx[68]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdirty[2] & /*handleInteractionEnd*/ 256 && {\r\n\t\t\t\t\t\toninteractionend: /*handleInteractionEnd*/ ctx[70]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdirty[2] & /*handleInteractionCancel*/ 128 && {\r\n\t\t\t\t\t\toninteractioncancel: /*handleInteractionCancel*/ ctx[69]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdirty[2] & /*handleHoverShape*/ 4096 && {\r\n\t\t\t\t\t\tonhovershape: /*handleHoverShape*/ ctx[74]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdirty[2] & /*handleTapCanvas*/ 2048 && { ontapcanvas: /*handleTapCanvas*/ ctx[73] },\r\n\t\t\t\t\tdirty[0] & /*ping*/ 8388608 | dirty[2] & /*handleMarkupUpdate*/ 524288 && { onaddshape: /*func_1*/ ctx[121] },\r\n\t\t\t\t\tdirty[0] & /*ping*/ 8388608 && { onselectshape: /*func_2*/ ctx[122] },\r\n\t\t\t\t\tdirty[0] & /*ping*/ 8388608 && { ontapshape: /*func_3*/ ctx[123] },\r\n\t\t\t\t\tdirty[0] & /*ping*/ 8388608 | dirty[2] & /*handleMarkupUpdate*/ 524288 && { onupdateshape: /*func_4*/ ctx[124] },\r\n\t\t\t\t\tdirty[0] & /*ping*/ 8388608 | dirty[2] & /*handleMarkupUpdate*/ 524288 && { onremoveshape: /*func_5*/ ctx[125] },\r\n\t\t\t\t\tdirty[1] & /*layoutEditorHooks*/ 2 && get_spread_object(/*layoutEditorHooks*/ ctx[32])\r\n\t\t\t\t])\r\n\t\t\t: {};\r\n\r\n\t\t\tif (!updating_markup && dirty[0] & /*$shapes*/ 134217728) {\r\n\t\t\t\tupdating_markup = true;\r\n\t\t\t\tshapelayouteditor_changes.markup = /*$shapes*/ ctx[27];\r\n\t\t\t\tadd_flush_callback(() => updating_markup = false);\r\n\t\t\t}\r\n\r\n\t\t\tif (!updating_ui && dirty[1] & /*$imageOverlayMarkup*/ 8192) {\r\n\t\t\t\tupdating_ui = true;\r\n\t\t\t\tshapelayouteditor_changes.ui = /*$imageOverlayMarkup*/ ctx[44];\r\n\t\t\t\tadd_flush_callback(() => updating_ui = false);\r\n\t\t\t}\r\n\r\n\t\t\tshapelayouteditor.$set(shapelayouteditor_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(shapelayouteditor.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(shapelayouteditor.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\t/*shapelayouteditor_binding*/ ctx[126](null);\r\n\t\t\tdestroy_component(shapelayouteditor, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (903:4) \r\nfunction create_main_slot(ctx) {\r\n\tlet div;\r\n\tlet div_style_value;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tlet if_block = /*shouldRenderShapeEditor*/ ctx[39] && create_if_block_5(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tattr(div, \"slot\", \"main\");\r\n\t\t\tattr(div, \"style\", div_style_value = `cursor:${/*cursor*/ ctx[35]}`);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tif (if_block) if_block.m(div, null);\r\n\t\t\t/*div_binding*/ ctx[129](div);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(div, \"keydown\", /*handleKey*/ ctx[71]),\r\n\t\t\t\t\taction_destroyer(dropable.call(null, div)),\r\n\t\t\t\t\tlisten(div, \"dropfiles\", function () {\r\n\t\t\t\t\t\tif (is_function(/*enablePresetDropImage*/ ctx[11]\r\n\t\t\t\t\t\t? /*handleDropFiles*/ ctx[79]\r\n\t\t\t\t\t\t: noop$1)) (/*enablePresetDropImage*/ ctx[11]\r\n\t\t\t\t\t\t? /*handleDropFiles*/ ctx[79]\r\n\t\t\t\t\t\t: noop$1).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\taction_destroyer(measurable.call(null, div)),\r\n\t\t\t\t\tlisten(div, \"measure\", /*measure_handler_1*/ ctx[119])\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\r\n\t\t\tif (/*shouldRenderShapeEditor*/ ctx[39]) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[1] & /*shouldRenderShapeEditor*/ 256) {\r\n\t\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block_5(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(div, null);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block, 1, 1, () => {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[1] & /*cursor*/ 16 && div_style_value !== (div_style_value = `cursor:${/*cursor*/ ctx[35]}`)) {\r\n\t\t\t\tattr(div, \"style\", div_style_value);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif (if_block) if_block.d();\r\n\t\t\t/*div_binding*/ ctx[129](null);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (1036:38) \r\nfunction create_if_block_4(ctx) {\r\n\tlet shapepresetspalette;\r\n\tlet current;\r\n\r\n\tshapepresetspalette = new ShapePresetsPalette({\r\n\t\t\tprops: {\r\n\t\t\t\tlocale: /*locale*/ ctx[4],\r\n\t\t\t\tpresets: /*shapePresets*/ ctx[13],\r\n\t\t\t\tenableSelectImage: /*enablePresetSelectImage*/ ctx[10],\r\n\t\t\t\twillRenderPresetToolbar: /*runWillRenderPresetToolbarHook*/ ctx[33],\r\n\t\t\t\tonaddpreset: /*handleAddPreset*/ ctx[78],\r\n\t\t\t\tongrabpreset: /*handleGrabPreset*/ ctx[75],\r\n\t\t\t\tondragpreset: /*handleDragPreset*/ ctx[76],\r\n\t\t\t\tondroppreset: /*handleDropPreset*/ ctx[77],\r\n\t\t\t\tscrollElasticity: /*computedScrollElasticity*/ ctx[34]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(shapepresetspalette.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(shapepresetspalette, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst shapepresetspalette_changes = {};\r\n\t\t\tif (dirty[0] & /*locale*/ 16) shapepresetspalette_changes.locale = /*locale*/ ctx[4];\r\n\t\t\tif (dirty[0] & /*shapePresets*/ 8192) shapepresetspalette_changes.presets = /*shapePresets*/ ctx[13];\r\n\t\t\tif (dirty[0] & /*enablePresetSelectImage*/ 1024) shapepresetspalette_changes.enableSelectImage = /*enablePresetSelectImage*/ ctx[10];\r\n\t\t\tif (dirty[1] & /*runWillRenderPresetToolbarHook*/ 4) shapepresetspalette_changes.willRenderPresetToolbar = /*runWillRenderPresetToolbarHook*/ ctx[33];\r\n\t\t\tif (dirty[1] & /*computedScrollElasticity*/ 8) shapepresetspalette_changes.scrollElasticity = /*computedScrollElasticity*/ ctx[34];\r\n\t\t\tshapepresetspalette.$set(shapepresetspalette_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(shapepresetspalette.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(shapepresetspalette.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(shapepresetspalette, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (971:8) {#if shouldRenderControls}\r\nfunction create_if_block(ctx) {\r\n\tlet div;\r\n\tlet current_block_type_index;\r\n\tlet if_block0;\r\n\tlet t;\r\n\tlet if_block1_anchor;\r\n\tlet current;\r\n\tconst if_block_creators = [create_if_block_3, create_else_block];\r\n\tconst if_blocks = [];\r\n\r\n\tfunction select_block_type_1(ctx, dirty) {\r\n\t\tif (/*shouldRenderPresets*/ ctx[36]) return 0;\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tcurrent_block_type_index = select_block_type_1(ctx);\r\n\tif_block0 = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\tlet if_block1 = /*showToolbar*/ ctx[41] && create_if_block_1(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif_block0.c();\r\n\t\t\tt = space();\r\n\t\t\tif (if_block1) if_block1.c();\r\n\t\t\tif_block1_anchor = empty();\r\n\t\t\tattr(div, \"class\", \"PinturaControlPanels\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tif_blocks[current_block_type_index].m(div, null);\r\n\t\t\tinsert(target, t, anchor);\r\n\t\t\tif (if_block1) if_block1.m(target, anchor);\r\n\t\t\tinsert(target, if_block1_anchor, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tlet previous_block_index = current_block_type_index;\r\n\t\t\tcurrent_block_type_index = select_block_type_1(ctx);\r\n\r\n\t\t\tif (current_block_type_index === previous_block_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].p(ctx, dirty);\r\n\t\t\t} else {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_blocks[previous_block_index], 1, 1, () => {\r\n\t\t\t\t\tif_blocks[previous_block_index] = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t\tif_block0 = if_blocks[current_block_type_index];\r\n\r\n\t\t\t\tif (!if_block0) {\r\n\t\t\t\t\tif_block0 = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t\t\t\t\tif_block0.c();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block0.p(ctx, dirty);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttransition_in(if_block0, 1);\r\n\t\t\t\tif_block0.m(div, null);\r\n\t\t\t}\r\n\r\n\t\t\tif (/*showToolbar*/ ctx[41]) {\r\n\t\t\t\tif (if_block1) {\r\n\t\t\t\t\tif_block1.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[1] & /*showToolbar*/ 1024) {\r\n\t\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block1 = create_if_block_1(ctx);\r\n\t\t\t\t\tif_block1.c();\r\n\t\t\t\t\ttransition_in(if_block1, 1);\r\n\t\t\t\t\tif_block1.m(if_block1_anchor.parentNode, if_block1_anchor);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block1) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block1, 1, 1, () => {\r\n\t\t\t\t\tif_block1 = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block0);\r\n\t\t\ttransition_in(if_block1);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block0);\r\n\t\t\ttransition_out(if_block1);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif_blocks[current_block_type_index].d();\r\n\t\t\tif (detaching) detach(t);\r\n\t\t\tif (if_block1) if_block1.d(detaching);\r\n\t\t\tif (detaching) detach(if_block1_anchor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (987:16) {:else}\r\nfunction create_else_block(ctx) {\r\n\tlet div;\r\n\tlet shapestyleeditor;\r\n\tlet current;\r\n\r\n\tshapestyleeditor = new ShapeStyleEditor({\r\n\t\t\tprops: {\r\n\t\t\t\tlocale: /*locale*/ ctx[4],\r\n\t\t\t\tshape: /*markupShapeSelected*/ ctx[24],\r\n\t\t\t\tonchange: /*handleUpdateSelectedMarkupShape*/ ctx[72],\r\n\t\t\t\tcontrols: /*shapeControls*/ ctx[8],\r\n\t\t\t\tscrollElasticity: /*computedScrollElasticity*/ ctx[34]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tcreate_component(shapestyleeditor.$$.fragment);\r\n\t\t\tattr(div, \"class\", \"PinturaControlPanel\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tmount_component(shapestyleeditor, div, null);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst shapestyleeditor_changes = {};\r\n\t\t\tif (dirty[0] & /*locale*/ 16) shapestyleeditor_changes.locale = /*locale*/ ctx[4];\r\n\t\t\tif (dirty[0] & /*markupShapeSelected*/ 16777216) shapestyleeditor_changes.shape = /*markupShapeSelected*/ ctx[24];\r\n\t\t\tif (dirty[0] & /*shapeControls*/ 256) shapestyleeditor_changes.controls = /*shapeControls*/ ctx[8];\r\n\t\t\tif (dirty[1] & /*computedScrollElasticity*/ 8) shapestyleeditor_changes.scrollElasticity = /*computedScrollElasticity*/ ctx[34];\r\n\t\t\tshapestyleeditor.$set(shapestyleeditor_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(shapestyleeditor.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(shapestyleeditor.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tdestroy_component(shapestyleeditor);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (973:16) {#if shouldRenderPresets}\r\nfunction create_if_block_3(ctx) {\r\n\tlet div;\r\n\tlet shapepresetspalette;\r\n\tlet current;\r\n\r\n\tshapepresetspalette = new ShapePresetsPalette({\r\n\t\t\tprops: {\r\n\t\t\t\tlocale: /*locale*/ ctx[4],\r\n\t\t\t\tpresets: /*shapePresets*/ ctx[13],\r\n\t\t\t\tenableSelectImage: /*enablePresetSelectImage*/ ctx[10],\r\n\t\t\t\twillRenderPresetToolbar: /*runWillRenderPresetToolbarHook*/ ctx[33],\r\n\t\t\t\tonaddpreset: /*handleAddPreset*/ ctx[78],\r\n\t\t\t\tongrabpreset: /*handleGrabPreset*/ ctx[75],\r\n\t\t\t\tondragpreset: /*handleDragPreset*/ ctx[76],\r\n\t\t\t\tondroppreset: /*handleDropPreset*/ ctx[77],\r\n\t\t\t\tscrollElasticity: /*computedScrollElasticity*/ ctx[34]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tcreate_component(shapepresetspalette.$$.fragment);\r\n\t\t\tattr(div, \"class\", \"PinturaControlPanel\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tmount_component(shapepresetspalette, div, null);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst shapepresetspalette_changes = {};\r\n\t\t\tif (dirty[0] & /*locale*/ 16) shapepresetspalette_changes.locale = /*locale*/ ctx[4];\r\n\t\t\tif (dirty[0] & /*shapePresets*/ 8192) shapepresetspalette_changes.presets = /*shapePresets*/ ctx[13];\r\n\t\t\tif (dirty[0] & /*enablePresetSelectImage*/ 1024) shapepresetspalette_changes.enableSelectImage = /*enablePresetSelectImage*/ ctx[10];\r\n\t\t\tif (dirty[1] & /*runWillRenderPresetToolbarHook*/ 4) shapepresetspalette_changes.willRenderPresetToolbar = /*runWillRenderPresetToolbarHook*/ ctx[33];\r\n\t\t\tif (dirty[1] & /*computedScrollElasticity*/ 8) shapepresetspalette_changes.scrollElasticity = /*computedScrollElasticity*/ ctx[34];\r\n\t\t\tshapepresetspalette.$set(shapepresetspalette_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(shapepresetspalette.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(shapepresetspalette.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tdestroy_component(shapepresetspalette);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (1000:12) {#if showToolbar}\r\nfunction create_if_block_1(ctx) {\r\n\tlet scrollable;\r\n\tlet current;\r\n\r\n\tscrollable = new Scrollable({\r\n\t\t\tprops: {\r\n\t\t\t\tclass: \"PinturaControlListScroller\",\r\n\t\t\t\telasticity: /*computedScrollElasticity*/ ctx[34],\r\n\t\t\t\t$$slots: { default: [create_default_slot$3] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(scrollable.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(scrollable, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst scrollable_changes = {};\r\n\t\t\tif (dirty[1] & /*computedScrollElasticity*/ 8) scrollable_changes.elasticity = /*computedScrollElasticity*/ ctx[34];\r\n\r\n\t\t\tif (dirty[0] & /*locale, toolsFiltered, toolActive*/ 33554449 | dirty[5] & /*$$scope*/ 256) {\r\n\t\t\t\tscrollable_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tscrollable.$set(scrollable_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(scrollable.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(scrollable.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(scrollable, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (1018:28) {#if option.icon}\r\nfunction create_if_block_2(ctx) {\r\n\tlet icon;\r\n\tlet current;\r\n\r\n\ticon = new Icon({\r\n\t\t\tprops: {\r\n\t\t\t\t$$slots: { default: [create_default_slot_1] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(icon.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(icon, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst icon_changes = {};\r\n\r\n\t\t\tif (dirty[0] & /*locale*/ 16 | dirty[5] & /*$$scope, option*/ 384) {\r\n\t\t\t\ticon_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ticon.$set(icon_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(icon.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(icon.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(icon, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (1019:32) <Icon                                     >\r\nfunction create_default_slot_1(ctx) {\r\n\tlet g;\r\n\r\n\tlet raw_value = (isFunction(/*option*/ ctx[162].icon)\r\n\t? /*option*/ ctx[162].icon(/*locale*/ ctx[4])\r\n\t: /*option*/ ctx[162].icon) + \"\";\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tg = svg_element(\"g\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, g, anchor);\r\n\t\t\tg.innerHTML = raw_value;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[0] & /*locale*/ 16 | dirty[5] & /*option*/ 128 && raw_value !== (raw_value = (isFunction(/*option*/ ctx[162].icon)\r\n\t\t\t? /*option*/ ctx[162].icon(/*locale*/ ctx[4])\r\n\t\t\t: /*option*/ ctx[162].icon) + \"\")) g.innerHTML = raw_value;\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(g);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (1017:24) \r\nfunction create_option_slot$1(ctx) {\r\n\tlet div;\r\n\tlet t0;\r\n\tlet span;\r\n\r\n\tlet t1_value = (isFunction(/*option*/ ctx[162].label)\r\n\t? /*option*/ ctx[162].label(/*locale*/ ctx[4])\r\n\t: /*option*/ ctx[162].label) + \"\";\r\n\r\n\tlet t1;\r\n\tlet current;\r\n\tlet if_block = /*option*/ ctx[162].icon && create_if_block_2(ctx);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tt0 = space();\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt1 = text(t1_value);\r\n\t\t\tattr(div, \"slot\", \"option\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tif (if_block) if_block.m(div, null);\r\n\t\t\tappend(div, t0);\r\n\t\t\tappend(div, span);\r\n\t\t\tappend(span, t1);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (/*option*/ ctx[162].icon) {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tif_block.p(ctx, dirty);\r\n\r\n\t\t\t\t\tif (dirty[5] & /*option*/ 128) {\r\n\t\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = create_if_block_2(ctx);\r\n\t\t\t\t\tif_block.c();\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(div, t0);\r\n\t\t\t\t}\r\n\t\t\t} else if (if_block) {\r\n\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\ttransition_out(if_block, 1, 1, () => {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcheck_outros();\r\n\t\t\t}\r\n\r\n\t\t\tif ((!current || dirty[0] & /*locale*/ 16 | dirty[5] & /*option*/ 128) && t1_value !== (t1_value = (isFunction(/*option*/ ctx[162].label)\r\n\t\t\t? /*option*/ ctx[162].label(/*locale*/ ctx[4])\r\n\t\t\t: /*option*/ ctx[162].label) + \"\")) set_data(t1, t1_value);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tif (if_block) if_block.d();\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (1001:16) <Scrollable                     class=\"PinturaControlListScroller\"                     elasticity={computedScrollElasticity}                 >\r\nfunction create_default_slot$3(ctx) {\r\n\tlet radiogroup;\r\n\tlet current;\r\n\r\n\tradiogroup = new RadioGroup({\r\n\t\t\tprops: {\r\n\t\t\t\tlocale: /*locale*/ ctx[4],\r\n\t\t\t\tclass: \"PinturaControlList\",\r\n\t\t\t\toptionClass: \"PinturaControlListOption\",\r\n\t\t\t\tlayout: \"row\",\r\n\t\t\t\toptions: /*toolsFiltered*/ ctx[25],\r\n\t\t\t\tselectedIndex: /*toolsFiltered*/ ctx[25].findIndex(/*func*/ ctx[120]),\r\n\t\t\t\tonchange: /*updateActiveTool*/ ctx[65],\r\n\t\t\t\t$$slots: {\r\n\t\t\t\t\toption: [\r\n\t\t\t\t\t\tcreate_option_slot$1,\r\n\t\t\t\t\t\t({ option }) => ({ 162: option }),\r\n\t\t\t\t\t\t({ option }) => [0, 0, 0, 0, 0, option ? 128 : 0]\r\n\t\t\t\t\t]\r\n\t\t\t\t},\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(radiogroup.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(radiogroup, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst radiogroup_changes = {};\r\n\t\t\tif (dirty[0] & /*locale*/ 16) radiogroup_changes.locale = /*locale*/ ctx[4];\r\n\t\t\tif (dirty[0] & /*toolsFiltered*/ 33554432) radiogroup_changes.options = /*toolsFiltered*/ ctx[25];\r\n\t\t\tif (dirty[0] & /*toolsFiltered, toolActive*/ 33554433) radiogroup_changes.selectedIndex = /*toolsFiltered*/ ctx[25].findIndex(/*func*/ ctx[120]);\r\n\r\n\t\t\tif (dirty[0] & /*locale*/ 16 | dirty[5] & /*$$scope, option*/ 384) {\r\n\t\t\t\tradiogroup_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tradiogroup.$set(radiogroup_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(radiogroup.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(radiogroup.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(radiogroup, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (970:4) \r\nfunction create_footer_slot$2(ctx) {\r\n\tlet div;\r\n\tlet current_block_type_index;\r\n\tlet if_block;\r\n\tlet current;\r\n\tconst if_block_creators = [create_if_block, create_if_block_4];\r\n\tconst if_blocks = [];\r\n\r\n\tfunction select_block_type(ctx, dirty) {\r\n\t\tif (/*shouldRenderControls*/ ctx[40]) return 0;\r\n\t\tif (/*shouldRenderPresets*/ ctx[36]) return 1;\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tif (~(current_block_type_index = select_block_type(ctx))) {\r\n\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t}\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tif (if_block) if_block.c();\r\n\t\t\tattr(div, \"slot\", \"footer\");\r\n\t\t\tattr(div, \"style\", /*footerStyle*/ ctx[31]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\r\n\t\t\tif (~current_block_type_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].m(div, null);\r\n\t\t\t}\r\n\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tlet previous_block_index = current_block_type_index;\r\n\t\t\tcurrent_block_type_index = select_block_type(ctx);\r\n\r\n\t\t\tif (current_block_type_index === previous_block_index) {\r\n\t\t\t\tif (~current_block_type_index) {\r\n\t\t\t\t\tif_blocks[current_block_type_index].p(ctx, dirty);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (if_block) {\r\n\t\t\t\t\tgroup_outros();\r\n\r\n\t\t\t\t\ttransition_out(if_blocks[previous_block_index], 1, 1, () => {\r\n\t\t\t\t\t\tif_blocks[previous_block_index] = null;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tcheck_outros();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (~current_block_type_index) {\r\n\t\t\t\t\tif_block = if_blocks[current_block_type_index];\r\n\r\n\t\t\t\t\tif (!if_block) {\r\n\t\t\t\t\t\tif_block = if_blocks[current_block_type_index] = if_block_creators[current_block_type_index](ctx);\r\n\t\t\t\t\t\tif_block.c();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif_block.p(ctx, dirty);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttransition_in(if_block, 1);\r\n\t\t\t\t\tif_block.m(div, null);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif_block = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty[1] & /*footerStyle*/ 1) {\r\n\t\t\t\tattr(div, \"style\", /*footerStyle*/ ctx[31]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(if_block);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(if_block);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\r\n\t\t\tif (~current_block_type_index) {\r\n\t\t\t\tif_blocks[current_block_type_index].d();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$9(ctx) {\r\n\tlet util;\r\n\tlet current;\r\n\r\n\tutil = new Util({\r\n\t\t\tprops: {\r\n\t\t\t\t$$slots: {\r\n\t\t\t\t\tfooter: [create_footer_slot$2],\r\n\t\t\t\t\tmain: [create_main_slot]\r\n\t\t\t\t},\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tutil.$on(\"measure\", /*measure_handler*/ ctx[130]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(util.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(util, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst util_changes = {};\r\n\r\n\t\t\tif (dirty[0] & /*locale, toolsFiltered, toolActive, shapePresets, enablePresetSelectImage, markupShapeSelected, shapeControls, pingHub, enablePresetDropImage, utilKey, $parentRect, $utilRectPadded, $enablePanInputStatus, imageRotation, imageFlipX, imageFlipY, $isActive, toolSelectRadius, enableButtonFlipVertical, mapScreenPointToImagePoint, mapImagePointToScreenPoint, enableTapToAddText, textInputMode, ping, markupEditor, $shapes*/ 2146435025 | dirty[1] & /*footerStyle, computedScrollElasticity, showToolbar, runWillRenderPresetToolbarHook, shouldRenderPresets, shouldRenderControls, cursor, $rootRect, markupOffset, $imageSelectionZoomCurrent, $isActiveFraction, $rootColorSecondary, toolEraseRadius, layoutEditorHooks, $imageOverlayMarkup, shouldRenderShapeEditor*/ 65535 | dirty[5] & /*$$scope*/ 256) {\r\n\t\t\t\tutil_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tutil.$set(util_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(util.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(util.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(util, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nlet isPanning = false;\r\n\r\nfunction instance$9($$self, $$props, $$invalidate) {\r\n\tlet toolsFiltered;\r\n\tlet hasShapeControls;\r\n\tlet showToolbar;\r\n\tlet hasTools;\r\n\tlet hasActiveTool;\r\n\tlet shouldRenderControls;\r\n\tlet shouldRenderShapeEditor;\r\n\tlet markupOffset;\r\n\tlet markupShapeKeys;\r\n\tlet markupSelected;\r\n\tlet markupEditing;\r\n\tlet markupToolShape;\r\n\tlet markupToolStylesComputed;\r\n\tlet markupShapeSelected;\r\n\tlet toolEraseRadius;\r\n\tlet shouldRenderPresets;\r\n\tlet shouldStickToImage;\r\n\tlet userEnabledPanModeWithKeyboard;\r\n\tlet userEnabledPanModeWithButton;\r\n\tlet enablePanMode;\r\n\tlet isEditingText;\r\n\tlet cursor;\r\n\tlet ping;\r\n\tlet computedScrollElasticity;\r\n\tlet runWillRenderPresetToolbarHook;\r\n\tlet layoutEditorHooks;\r\n\tlet footerStyle;\r\n\tlet $footerOffset;\r\n\r\n\tlet $isActive,\r\n\t\t$$unsubscribe_isActive = noop,\r\n\t\t$$subscribe_isActive = () => ($$unsubscribe_isActive(), $$unsubscribe_isActive = subscribe(isActive, $$value => $$invalidate(26, $isActive = $$value)), isActive);\r\n\r\n\tlet $isAnimated;\r\n\r\n\tlet $shapes,\r\n\t\t$$unsubscribe_shapes = noop,\r\n\t\t$$subscribe_shapes = () => ($$unsubscribe_shapes(), $$unsubscribe_shapes = subscribe(shapes, $$value => $$invalidate(27, $shapes = $$value)), shapes);\r\n\r\n\tlet $env;\r\n\tlet $redrawTrigger;\r\n\tlet $elasticityMultiplier;\r\n\tlet $stageRect;\r\n\tlet $imageSelectionZoomCurrent;\r\n\tlet $imageSelectionPan;\r\n\tlet $stageScalar;\r\n\tlet $imageSelectionRect;\r\n\tlet $enablePanInputStatus;\r\n\tlet $keysPressedStore;\r\n\r\n\tlet $parentRect,\r\n\t\t$$unsubscribe_parentRect = noop,\r\n\t\t$$subscribe_parentRect = () => ($$unsubscribe_parentRect(), $$unsubscribe_parentRect = subscribe(parentRect, $$value => $$invalidate(29, $parentRect = $$value)), parentRect);\r\n\r\n\tlet $imageCropRect;\r\n\tlet $shapePreprocessor;\r\n\tlet $ui;\r\n\tlet $utilRectPadded;\r\n\r\n\tlet $isVisible,\r\n\t\t$$unsubscribe_isVisible = noop,\r\n\t\t$$subscribe_isVisible = () => ($$unsubscribe_isVisible(), $$unsubscribe_isVisible = subscribe(isVisible, $$value => $$invalidate(117, $isVisible = $$value)), isVisible);\r\n\r\n\tlet $imagePreviewModifiers;\r\n\tlet $rootRect;\r\n\tlet $imageOverlayMarkup;\r\n\r\n\tlet $isActiveFraction,\r\n\t\t$$unsubscribe_isActiveFraction = noop,\r\n\t\t$$subscribe_isActiveFraction = () => ($$unsubscribe_isActiveFraction(), $$unsubscribe_isActiveFraction = subscribe(isActiveFraction, $$value => $$invalidate(45, $isActiveFraction = $$value)), isActiveFraction);\r\n\r\n\tlet $rootColorSecondary;\r\n\t$$self.$$.on_destroy.push(() => $$unsubscribe_isActive());\r\n\t$$self.$$.on_destroy.push(() => $$unsubscribe_shapes());\r\n\t$$self.$$.on_destroy.push(() => $$unsubscribe_parentRect());\r\n\t$$self.$$.on_destroy.push(() => $$unsubscribe_isVisible());\r\n\t$$self.$$.on_destroy.push(() => $$unsubscribe_isActiveFraction());\r\n\tlet { isActive } = $$props;\r\n\t$$subscribe_isActive();\r\n\tlet { isActiveFraction } = $$props;\r\n\t$$subscribe_isActiveFraction();\r\n\tlet { isVisible } = $$props;\r\n\t$$subscribe_isVisible();\r\n\tlet { stores } = $$props;\r\n\tlet { locale = {} } = $$props;\r\n\tlet { shapes } = $$props;\r\n\t$$subscribe_shapes();\r\n\tlet { toolbar = [] } = $$props;\r\n\tlet { toolShapes = {} } = $$props;\r\n\tlet { toolActive = undefined } = $$props;\r\n\tlet { toolSelectRadius = undefined } = $$props;\r\n\tlet { toolRetainStyles = false } = $$props;\r\n\tlet { textInputMode = undefined } = $$props;\r\n\tlet { shapeControls = {} } = $$props;\r\n\tlet { enableButtonFlipVertical = false } = $$props;\r\n\tlet { enablePresetSelectImage = true } = $$props;\r\n\tlet { enablePresetDropImage = true } = $$props;\r\n\tlet { enableSelectToolToAddShape = false } = $$props;\r\n\tlet { enableAutoSelectMoveTool = ['line', 'arrow', 'path', 'rectangle', 'ellipse', 'text'] } = $$props;\r\n\tlet { enableTapToAddText = false } = $$props;\r\n\tlet { enableMoveTool = false } = $$props;\r\n\tlet { enableViewTool = false } = $$props;\r\n\tlet { willRenderPresetToolbar = undefined } = $$props;\r\n\tlet { willStartInteraction = undefined } = $$props;\r\n\tlet { shapePresets = [] } = $$props;\r\n\tlet { utilKey } = $$props;\r\n\tlet { mapScreenPointToImagePoint } = $$props;\r\n\tlet { mapImagePointToScreenPoint } = $$props;\r\n\tlet { imageRotation = 0 } = $$props;\r\n\tlet { imageFlipX = false } = $$props;\r\n\tlet { imageFlipY = false } = $$props;\r\n\tlet { parentRect } = $$props;\r\n\t$$subscribe_parentRect();\r\n\tlet { hooks = {} } = $$props;\r\n\r\n\t// context\r\n\tconst isAnimated = getContext('isAnimated');\r\n\r\n\tcomponent_subscribe($$self, isAnimated, value => $$invalidate(110, $isAnimated = value));\r\n\tconst elasticityMultiplier = getContext('elasticityMultiplier');\r\n\tcomponent_subscribe($$self, elasticityMultiplier, value => $$invalidate(113, $elasticityMultiplier = value));\r\n\tconst ui = getContext('ui');\r\n\tcomponent_subscribe($$self, ui, value => $$invalidate(139, $ui = value));\r\n\r\n\t// stores\r\n\tconst { env, history, rootRect, rootColorSecondary, enablePanInput, enablePanInputStatus, enableZoomInput, stageRect, utilRectPadded, scrollElasticity, imageOverlayMarkup, imagePreviewModifiers, imageCropRect, shapePreprocessor, stageScalar, imageSelectionRect, imageSelectionZoomCurrent, imageSelectionPan, allowPan, allowZoom, enableZoomControls } = stores;\r\n\r\n\tcomponent_subscribe($$self, env, value => $$invalidate(111, $env = value));\r\n\tcomponent_subscribe($$self, rootRect, value => $$invalidate(43, $rootRect = value));\r\n\tcomponent_subscribe($$self, rootColorSecondary, value => $$invalidate(46, $rootColorSecondary = value));\r\n\tcomponent_subscribe($$self, enablePanInputStatus, value => $$invalidate(28, $enablePanInputStatus = value));\r\n\tcomponent_subscribe($$self, stageRect, value => $$invalidate(114, $stageRect = value));\r\n\tcomponent_subscribe($$self, utilRectPadded, value => $$invalidate(30, $utilRectPadded = value));\r\n\tcomponent_subscribe($$self, imageOverlayMarkup, value => $$invalidate(44, $imageOverlayMarkup = value));\r\n\tcomponent_subscribe($$self, imagePreviewModifiers, value => $$invalidate(118, $imagePreviewModifiers = value));\r\n\tcomponent_subscribe($$self, imageCropRect, value => $$invalidate(138, $imageCropRect = value));\r\n\tcomponent_subscribe($$self, shapePreprocessor, value => $$invalidate(116, $shapePreprocessor = value));\r\n\tcomponent_subscribe($$self, stageScalar, value => $$invalidate(136, $stageScalar = value));\r\n\tcomponent_subscribe($$self, imageSelectionRect, value => $$invalidate(137, $imageSelectionRect = value));\r\n\tcomponent_subscribe($$self, imageSelectionZoomCurrent, value => $$invalidate(42, $imageSelectionZoomCurrent = value));\r\n\tcomponent_subscribe($$self, imageSelectionPan, value => $$invalidate(135, $imageSelectionPan = value));\r\n\r\n\t// remove presets tool if no shape presets defined\r\n\tconst filterTools = (toolbar, { willRenderPresetToolbar, shapePresets, enableViewTool, enableMoveTool }) => {\r\n\t\t// enableMoveTool\r\n\t\tlet tools = shapePresets.length === 0 && !willRenderPresetToolbar\r\n\t\t? toolbar.filter(tool => tool[0] !== 'preset')\r\n\t\t: toolbar;\r\n\r\n\t\t// filter move tool\r\n\t\ttools = enableMoveTool\r\n\t\t? tools\r\n\t\t: tools.filter(tool => tool[0] !== 'move');\r\n\r\n\t\t// filter view tool\r\n\t\treturn enableViewTool\r\n\t\t? tools\r\n\t\t: tools.filter(tool => tool[0] !== 'view');\r\n\t};\r\n\r\n\tconst keysPressedStore = getContext('keysPressed');\r\n\tcomponent_subscribe($$self, keysPressedStore, value => $$invalidate(115, $keysPressedStore = value));\r\n\r\n\tconst updateActiveTool = ({ value }, event) => {\r\n\t\t$$invalidate(0, toolActive = value);\r\n\r\n\t\t// if is keyboard navigating or should add shape\r\n\t\tif (enableSelectToolToAddShape || (/enter/i).test(event.key)) {\r\n\t\t\tAddToolDefaultShape(value);\r\n\t\t}\r\n\t};\r\n\r\n\tconst AddToolDefaultShape = tool => {\r\n\t\tconst [shape, options] = toolShapes[tool];\r\n\t\tlet isRelative = options.position === 'relative';\r\n\t\tlet shapeToAdd;\r\n\t\tlet size;\r\n\t\tconst x = isRelative ? '0%' : 0;\r\n\t\tconst y = isRelative ? '0%' : 0;\r\n\r\n\t\tif (shapeIsRect(shape) || shapeIsText(shape)) {\r\n\t\t\tsize = isRelative ? '20%' : $parentRect.width * 0.2;\r\n\t\t\tshapeToAdd = shapeDeepCopy(shape);\r\n\t\t\tshapeToAdd.x = x;\r\n\t\t\tshapeToAdd.y = y;\r\n\t\t\tshapeUpdateProps(shapeToAdd, { width: size, height: size }, $parentRect);\r\n\t\t} else if (shapeIsEllipse(shape)) {\r\n\t\t\tsize = isRelative ? '10%' : $parentRect.width * 0.1;\r\n\t\t\tshapeToAdd = shapeDeepCopy(shape);\r\n\t\t\tshapeToAdd.x = x;\r\n\t\t\tshapeToAdd.y = y;\r\n\t\t\tshapeUpdateProps(shapeToAdd, { rx: size, ry: size }, $parentRect);\r\n\t\t} else if (shapeIsLine(shape)) {\r\n\t\t\tsize = isRelative ? '10%' : $parentRect.width * 0.1;\r\n\t\t\tshapeToAdd = shapeDeepCopy(shape);\r\n\t\t\tshapeToAdd.x1 = x;\r\n\t\t\tshapeToAdd.y1 = y;\r\n\t\t\tshapeToAdd.x2 = x;\r\n\t\t\tshapeToAdd.y2 = y;\r\n\t\t}\r\n\r\n\t\tif (!shapeToAdd) return;\r\n\r\n\t\tPromise.resolve().then(() => {\r\n\t\t\taddShape(createShapeAtPosition(shapeToAdd, undefined, size));\r\n\t\t});\r\n\t};\r\n\r\n\tconst mapScreenEventToImagePoint = e => mapScreenPointToImagePoint(getEventPositionInEditor(e, $rootRect));\r\n\r\n\t// A reference to the markup editor, we need this so we can call exported functions\r\n\tlet markupEditor;\r\n\r\n\t// the current tool styles\r\n\tlet markupToolStyles = {};\r\n\r\n\t//\r\n\t// Create new shape\r\n\t//\r\n\tlet interactionHandler;\r\n\r\n\tconst handleInteractionStart = e => {\r\n\t\tif (toolActive === 'eraser') {\r\n\t\t\tinteractionHandler = markupEditor.eraseShape();\r\n\t\t} else if (toolActive && toolShapes[toolActive]) {\r\n\t\t\tconst [shape, options] = toolShapes[toolActive];\r\n\t\t\tinteractionHandler = markupEditor.createShape({ ...shape, ...markupToolStylesComputed }, options);\r\n\t\t} else {\r\n\t\t\tinteractionHandler = undefined;\r\n\t\t}\r\n\r\n\t\tif (!interactionHandler) return false;\r\n\t\tinteractionHandler.start(e);\r\n\t\treturn true;\r\n\t};\r\n\r\n\tconst handleInteractionUpdate = e => {\r\n\t\tif (!interactionHandler) return false;\r\n\t\tinteractionHandler.update(e);\r\n\t\treturn true;\r\n\t};\r\n\r\n\tconst handleInteractionRelease = e => {\r\n\t\tif (!interactionHandler) return false;\r\n\t\tinteractionHandler.release(e);\r\n\t\treturn true;\r\n\t};\r\n\r\n\tconst handleInteractionCancel = e => {\r\n\t\tif (!interactionHandler) return false;\r\n\t\tinteractionHandler.cancel(e);\r\n\t\tinteractionHandler = undefined;\r\n\t\treturn true;\r\n\t};\r\n\r\n\tconst handleInteractionEnd = e => {\r\n\t\tif (!interactionHandler) return false;\r\n\t\tinteractionHandler.end(e);\r\n\t\tinteractionHandler = undefined;\r\n\r\n\t\t// when a shape is built with multiple clicks a draft might still be active\r\n\t\tconst draft = markupEditor.getMarkupItemDraft();\r\n\r\n\t\t// always fall back to move when done with current tool\r\n\t\tconst canSwitchToMoveTool = enableMoveTool && (enableAutoSelectMoveTool === true || Array.isArray(enableAutoSelectMoveTool) && enableAutoSelectMoveTool.includes(toolActive));\r\n\r\n\t\t// should switch back to move tool if draft is finished OR if draft is there and is text editing\r\n\t\tif ((!draft || draft.isEditing) && canSwitchToMoveTool) {\r\n\t\t\t$$invalidate(0, toolActive = 'move');\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t};\r\n\r\n\tconst confirmDraft = draft => {\r\n\t\tconst isPolygon = shapeIsPath(draft) && hasProp(draft, 'pathClose');\r\n\t\tif (!isPolygon) return;\r\n\r\n\t\t//  show stroke color\r\n\t\tconst strokeColor = [...draft.strokeColor];\r\n\r\n\t\tstrokeColor[3] = 1;\r\n\r\n\t\t// update the draft shape\r\n\t\tmarkupEditor.updateMarkupShape(\r\n\t\t\tdraft,\r\n\t\t\t{\r\n\t\t\t\t// don't close this path\r\n\t\t\t\tpathClose: false, // wait with sync till confirm\r\n\t\t\t\t// set opaque stroke color\r\n\t\t\t\tstrokeColor\r\n\t\t\t},\r\n\t\t\tfalse\r\n\t\t); // wait with sync till confirm\r\n\r\n\t\tmarkupEditor.removeMarkupShapeProps(draft, ['backgroundColor'], false); // wait with sync till confirm\r\n\t\tmarkupEditor.confirmMarkupItemDraft();\r\n\t\tmarkupEditor.selectShape(draft);\r\n\t};\r\n\r\n\tconst handleKey = e => {\r\n\t\tconst { key } = e;\r\n\t\tconst draft = markupEditor.getMarkupItemDraft();\r\n\r\n\t\tif ((/escape/i).test(key) && draft) {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopPropagation();\r\n\t\t\tmarkupEditor.discardMarkupItemDraft();\r\n\t\t\tinteractionHandler = undefined;\r\n\t\t}\r\n\r\n\t\tif ((/enter/i).test(key) && draft) {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopPropagation();\r\n\t\t\tconfirmDraft(draft);\r\n\t\t\tinteractionHandler = undefined;\r\n\t\t}\r\n\t};\r\n\r\n\tconst blurOnToolSwitch = () => {\r\n\t\tif (!markupEditor || toolActive === 'move') return;\r\n\t\tmarkupEditor.blurShapes();\r\n\t};\r\n\r\n\tconst getStoredStyles = () => {\r\n\t\treturn $ui[utilKey] ? $ui[utilKey][toolActive] : {};\r\n\t};\r\n\r\n\t// if toolShapes are updated we reset the current tool styles as chose by the user, this allows us to set styles programatically\r\n\tconst didUpdateToolShapes = () => {\r\n\t\t$$invalidate(95, markupToolStyles = {});\r\n\t};\r\n\r\n\tconst updateInterfaceState = (util, tool, computedStyles) => {\r\n\t\tconst utilObj = $ui[util];\r\n\t\tconst toolObj = utilObj ? utilObj[tool] : {};\r\n\r\n\t\tui.set({\r\n\t\t\t...$ui,\r\n\t\t\t[util]: {\r\n\t\t\t\t...utilObj,\r\n\t\t\t\t[tool]: { ...toolObj, ...computedStyles }\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tconst resetInterfaceState = util => {\r\n\t\tui.set({ [util]: {} });\r\n\t};\r\n\r\n\tlet updateWriteHistoryTimeoutId;\r\n\r\n\tfunction handleUpdateSelectedMarkupShape(props) {\r\n\t\t// remember style for when creating or styling other element\r\n\t\tObject.keys(props).forEach(key => $$invalidate(95, markupToolStyles[key] = props[key], markupToolStyles));\r\n\r\n\t\t// fire event\r\n\t\tping('selectstyle', props);\r\n\r\n\t\t// it's possible we're only updating default styles\r\n\t\tif (!markupSelected) return;\r\n\r\n\t\t// update element\r\n\t\tmarkupEditor.updateMarkupShape(markupSelected, props);\r\n\r\n\t\t// update markup style with delay so we don't write every state change to history (mainly relevant for color changes when dragging color)\r\n\t\tclearTimeout(updateWriteHistoryTimeoutId);\r\n\r\n\t\tupdateWriteHistoryTimeoutId = setTimeout(\r\n\t\t\t() => {\r\n\t\t\t\thandleMarkupUpdate();\r\n\t\t\t},\r\n\t\t\t200\r\n\t\t);\r\n\t}\r\n\r\n\tlet hoverShape;\r\n\r\n\t/*\r\n\r\nlet eraserShape = {\r\n    id: 'markup-eraser',\r\n    x: 0,\r\n    y: 0,\r\n    rx: 0,\r\n    ry: 0,\r\n    strokeWidth: 0.5,\r\n    strokeColor: [0, 0, 0],\r\n};\r\n\r\nconst handleHoverCanvas = (canvasPosition, imagePosition) => {\r\n    $imageOverlayMarkup = [\r\n        ...$imageOverlayMarkup.filter((shape) => shape.id !== 'markup-eraser'),\r\n    ];\r\n\r\n    if (!vectorInSize(imagePosition, $imageSize)) return;\r\n\r\n    const computedEraserRadius = toolEraseRadius * $presentationScalar;\r\n\r\n    if (toolActive !== 'eraser' || computedEraserRadius < 8) return;\r\n\r\n    const shape = { ...eraserShape };\r\n    shape.x = canvasPosition.x;\r\n    shape.y = canvasPosition.y;\r\n    shape.rx = shape.ry = computedEraserRadius;\r\n\r\n    const shapeShadow = { ...eraserShape };\r\n    shapeShadow.x = canvasPosition.x;\r\n    shapeShadow.y = canvasPosition.y;\r\n    shapeShadow.strokeWidth = 3;\r\n    shapeShadow.strokeColor = [1, 1, 1];\r\n    shapeShadow.opacity = 0.25;\r\n    shapeShadow.rx = shapeShadow.ry = shape.rx;\r\n\r\n    $imageOverlayMarkup = [\r\n        ...$imageOverlayMarkup.filter((shape) => shape.id !== 'markup-eraser'),\r\n        shapeShadow,\r\n        shape,\r\n    ];\r\n};\r\n*/\r\n\tconst handleTapCanvas = details => ping('markuptap', details);\r\n\r\n\tconst handleHoverShape = shape => $$invalidate(96, hoverShape = shape);\r\n\r\n\tconst getCursor = (shapeUnderPointer, shapeSelected, panInputEnabled, isPanning, currentActiveTool) => // computedEraserRadius\r\n\t{\r\n\t\t// hide cursor if eraser radius is set\r\n\t\tif (panInputEnabled) return isPanning ? 'grabbing' : 'grab';\r\n\r\n\t\t// no shape, return crosshair\r\n\t\tif (!shapeUnderPointer) return currentActiveTool === 'move' ? 'default' : 'crosshair';\r\n\r\n\t\t// treat both as the same shape\r\n\t\tlet shape = shapeUnderPointer || shapeSelected;\r\n\r\n\t\t// can select (else won't hover)\r\n\t\tif (!shapeIsSelected(shape)) return 'default';\r\n\r\n\t\t// show text input cursor\r\n\t\tif (shapeIsEditing(shape)) {\r\n\t\t\tif (textInputMode === 'modal') return 'default';\r\n\t\t\treturn 'text';\r\n\t\t}\r\n\r\n\t\t// show move cursor\r\n\t\tif (shapeCanMove(shape)) return 'move';\r\n\r\n\t\t// can't move\r\n\t\treturn 'default';\r\n\t};\r\n\r\n\tconst createShapeAtPosition = (shape, position, size) => {\r\n\t\t// position defaults to crop center\r\n\t\tlet positionIsCenter = false;\r\n\r\n\t\tif (!position) {\r\n\t\t\t// is centering to stage\r\n\t\t\tpositionIsCenter = true;\r\n\r\n\t\t\t// calculate image or rect position\r\n\t\t\tposition = shouldStickToImage\r\n\t\t\t? mapScreenPointToImagePoint(rectCenter($stageRect))\r\n\t\t\t: rectCenter($imageCropRect);\r\n\t\t}\r\n\r\n\t\t// adjust offset if parent rect is image crop rect\r\n\t\tposition.x -= $parentRect.x || 0;\r\n\r\n\t\tposition.y -= $parentRect.y || 0;\r\n\r\n\t\t// de-flip shape\r\n\t\tif (imageFlipX || imageFlipY) {\r\n\t\t\tshape.flipX = imageFlipX;\r\n\t\t\tshape.flipY = imageFlipY;\r\n\t\t}\r\n\r\n\t\t// reposition if there's already shapes at position and shape isn't full screen\r\n\t\tconst shapesAlreadyAtPosition = markupEditor.getShapesNearPosition(position);\r\n\r\n\t\tif (positionIsCenter && shapesAlreadyAtPosition.length) {\r\n\t\t\tconst dist = Math.min($imageCropRect.width, $imageCropRect.height) * 0.1;\r\n\t\t\tposition.x += Math.round(-dist + Math.random() * dist * 2);\r\n\t\t\tposition.y += Math.round(-dist + Math.random() * dist * 2);\r\n\t\t}\r\n\r\n\t\t// de-rotate shape\r\n\t\tif (imageRotation !== 0) {\r\n\t\t\tif (imageFlipX && imageFlipY) shape.rotation = -imageRotation; else if (imageFlipX) shape.rotation = imageRotation; else if (imageFlipY) shape.rotation = imageRotation; else shape.rotation = -imageRotation;\r\n\t\t}\r\n\r\n\t\tif (hasProp(shape, 'width') && hasProp(shape, 'height')) {\r\n\t\t\tconst { width, height } = shapeGetPropsPixelValues(shape, ['width', 'height'], $parentRect);\r\n\r\n\t\t\tshapeUpdateProps(\r\n\t\t\t\tshape,\r\n\t\t\t\t{\r\n\t\t\t\t\tx: position.x - width * 0.5,\r\n\t\t\t\t\ty: position.y - height * 0.5\r\n\t\t\t\t},\r\n\t\t\t\t$parentRect\r\n\t\t\t);\r\n\t\t} else if (shapeIsEllipse(shape)) {\r\n\t\t\tshapeUpdateProps(shape, { x: position.x, y: position.y }, $parentRect);\r\n\t\t} else if (shapeIsLine(shape)) {\r\n\t\t\tconst { x1, y1, x2, y2 } = shapeGetPropsPixelValues(shape, ['x1', 'y1', 'x2', 'y2'], $parentRect);\r\n\t\t\tconst dist = vectorDistance(vectorCreate(x1, y1), vectorCreate(x2, y2));\r\n\r\n\t\t\tconst l = isString(size)\r\n\t\t\t? toPixelValue(size, $parentRect.width)\r\n\t\t\t: dist;\r\n\r\n\t\t\tshapeUpdateProps(\r\n\t\t\t\tshape,\r\n\t\t\t\t{\r\n\t\t\t\t\tx1: position.x - l,\r\n\t\t\t\t\ty1: position.y + l,\r\n\t\t\t\t\tx2: position.x + l,\r\n\t\t\t\t\ty2: position.y - l\r\n\t\t\t\t},\r\n\t\t\t\t$parentRect\r\n\t\t\t);\r\n\t\t} else if (shapeIsPath(shape)) {\r\n\t\t\tconst { points } = shapeGetPropsPixelValues(shape, ['points'], $parentRect);\r\n\t\t\tconst center = vectorCenter(points);\r\n\r\n\t\t\tshapeUpdateProps(\r\n\t\t\t\tshape,\r\n\t\t\t\t{\r\n\t\t\t\t\tpoints: points.map(point => ({\r\n\t\t\t\t\t\tx: point.x + position.x - center.x,\r\n\t\t\t\t\t\ty: point.y + position.y - center.y\r\n\t\t\t\t\t}))\r\n\t\t\t\t},\r\n\t\t\t\t$parentRect\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn shape;\r\n\t};\r\n\r\n\tconst addPreset = (preset, position) => {\r\n\t\tconst shape = createShapeAtPosition(shapeCreateFromPreset(preset, $imageCropRect), position);\r\n\r\n\t\t// force position\r\n\t\tif (preset.shape) {\r\n\t\t\tif (hasProp(preset.shape, 'x')) shape.x = preset.shape.x;\r\n\t\t\tif (hasProp(preset.shape, 'y')) shape.y = preset.shape.y;\r\n\t\t}\r\n\r\n\t\treturn addShape(shape);\r\n\t};\r\n\r\n\tconst addShape = shape => {\r\n\t\tconst { beforeAddShape = () => true } = hooks;\r\n\t\tif (!beforeAddShape(shape)) return;\r\n\t\tmarkupEditor.addShape(shape);\r\n\t\tmarkupEditor.selectShape(shape);\r\n\t\thistory.write();\r\n\t\tping('addshape', shape);\r\n\t\treturn shape;\r\n\t};\r\n\r\n\tlet dragCancelled = false;\r\n\r\n\tconst handleGrabPreset = () => {\r\n\t\tdragCancelled = false;\r\n\t};\r\n\r\n\tconst handleDragPreset = (preset, e) => {\r\n\t\tif (dragCancelled) return;\r\n\t\tconst { beforeAddShape = () => true } = hooks;\r\n\t\tconst position = mapScreenEventToImagePoint(e);\r\n\r\n\t\t// create or update if is inside image\r\n\t\tconst draft = markupEditor.getMarkupItemDraft();\r\n\r\n\t\tconst inCropRect = rectContainsPoint($imageCropRect, {\r\n\t\t\t// adjust offset if parent rect is image crop rect\r\n\t\t\tx: position.x + ($parentRect.x || 0),\r\n\t\t\ty: position.y + ($parentRect.y || 0)\r\n\t\t});\r\n\r\n\t\t// remove draft if not dragging inside image\r\n\t\tif (draft && !inCropRect) markupEditor.discardMarkupItemDraft();\r\n\r\n\t\t// stop here if we're not in the crop rect\r\n\t\tif (!inCropRect) return;\r\n\r\n\t\t// create draft shape\r\n\t\tif (!draft) {\r\n\t\t\tconst presetShape = shapeCreateFromPreset(preset, $imageCropRect);\r\n\t\t\tconst shape = createShapeAtPosition(presetShape, position);\r\n\r\n\t\t\tif (!beforeAddShape(shape)) {\r\n\t\t\t\tdragCancelled = true;\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tshapeMakeDraft(shape);\r\n\t\t\tmarkupEditor.addShape(shape);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// center shape on pointer if it has dimensions\r\n\t\tif (shapeIsRect(draft)) {\r\n\t\t\tposition.x -= draft.width * 0.5;\r\n\t\t\tposition.y -= draft.height * 0.5;\r\n\t\t}\r\n\r\n\t\t// force position\r\n\t\tif (preset.shape) {\r\n\t\t\tif (hasProp(preset.shape, 'x')) position.x = preset.shape.x;\r\n\t\t\tif (hasProp(preset.shape, 'y')) position.y = preset.shape.y;\r\n\t\t}\r\n\r\n\t\t// update the draft shape\r\n\t\tmarkupEditor.updateMarkupShape(draft, position);\r\n\t};\r\n\r\n\tconst handleDropPreset = (_, e) => {\r\n\t\tif (dragCancelled) return;\r\n\t\tconst position = mapScreenEventToImagePoint(e);\r\n\r\n\t\tif (!rectContainsPoint($imageCropRect, {\r\n\t\t\tx: position.x + ($parentRect.x || 0),\r\n\t\t\ty: position.y + ($parentRect.y || 0)\r\n\t\t})) {\r\n\t\t\tmarkupEditor.discardMarkupItemDraft();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// confirm shape\r\n\t\tconst shape = markupEditor.confirmMarkupItemDraft();\r\n\r\n\t\tmarkupEditor.selectShape(shape);\r\n\r\n\t\t// shape added\r\n\t\tping('addshape', shape);\r\n\r\n\t\t// update history\r\n\t\thistory.write();\r\n\t};\r\n\r\n\tconst handleAddPreset = preset => addPreset(preset);\r\n\tconst handleAddFiles = (files, position) => files.forEach(file => addPreset(file, position));\r\n\tconst handleDropFiles = e => handleAddFiles(e.detail.resources, mapScreenEventToImagePoint(e.detail.event));\r\n\r\n\t//#endregion\r\n\tconst handleWillStartInteraction = position => {\r\n\t\tif (!willStartInteraction) return true;\r\n\r\n\t\t// calculate current image selection rect\r\n\t\tconst selectionRect = rectClone($imageSelectionRect);\r\n\r\n\t\trectScale(selectionRect, 1 / $stageScalar);\r\n\t\trectTranslate(selectionRect, $imageSelectionPan);\r\n\t\trectScale(selectionRect, $imageSelectionZoomCurrent);\r\n\r\n\t\t// should return true if interaction is allowed\r\n\t\treturn willStartInteraction(position, {\r\n\t\t\t...selectionRect,\r\n\t\t\tx: selectionRect.x + $stageRect.x,\r\n\t\t\ty: selectionRect.y + $stageRect.y\r\n\t\t});\r\n\t};\r\n\r\n\t//\r\n\t// History\r\n\t//\r\n\tconst handleMarkupUpdate = () => {\r\n\t\thistory.write();\r\n\t};\r\n\r\n\t// used to fire ping events from\r\n\tlet pingHub;\r\n\r\n\tconst redrawTrigger = getContext('redrawTrigger');\r\n\tcomponent_subscribe($$self, redrawTrigger, value => $$invalidate(112, $redrawTrigger = value));\r\n\r\n\t//\r\n\t// confirm draft text when leaving view\r\n\t//\r\n\tconst toggleShapePrerendering = active => {\r\n\t\tif (!shapes) return;\r\n\r\n\t\tshapes.set($shapes.map(shape => {\r\n\t\t\tshape._prerender = active ? shapeIsEditing(shape) : false;\r\n\t\t\treturn shape;\r\n\t\t}));\r\n\t};\r\n\r\n\t//\r\n\t// Footer style\r\n\t//\r\n\tconst footerOffset = spring($isAnimated ? 20 : 0);\r\n\r\n\tcomponent_subscribe($$self, footerOffset, value => $$invalidate(109, $footerOffset = value));\r\n\r\n\tfunction measure_handler_1(event) {\r\n\t\tbubble.call(this, $$self, event);\r\n\t}\r\n\r\n\tconst func = option => option[0] === toolActive;\r\n\r\n\tconst func_1 = shape => {\r\n\t\tping('addshape', shape);\r\n\t\thandleMarkupUpdate();\r\n\t};\r\n\r\n\tconst func_2 = shape => {\r\n\t\tping('selectshape', shape);\r\n\t};\r\n\r\n\tconst func_3 = shape => {\r\n\t\tping('tapshape', shape);\r\n\t};\r\n\r\n\tconst func_4 = shape => {\r\n\t\tping('updateshape', shape);\r\n\t\thandleMarkupUpdate();\r\n\t};\r\n\r\n\tconst func_5 = shape => {\r\n\t\tping('removeshape', shape);\r\n\t\thandleMarkupUpdate();\r\n\t};\r\n\r\n\tfunction shapelayouteditor_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\tmarkupEditor = $$value;\r\n\t\t\t$$invalidate(21, markupEditor);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction shapelayouteditor_markup_binding(value) {\r\n\t\t$shapes = value;\r\n\t\tshapes.set($shapes);\r\n\t}\r\n\r\n\tfunction shapelayouteditor_ui_binding(value) {\r\n\t\t$imageOverlayMarkup = value;\r\n\t\timageOverlayMarkup.set($imageOverlayMarkup);\r\n\t}\r\n\r\n\tfunction div_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\tpingHub = $$value;\r\n\t\t\t$$invalidate(22, pingHub);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction measure_handler(event) {\r\n\t\tbubble.call(this, $$self, event);\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('isActive' in $$props) $$subscribe_isActive($$invalidate(1, isActive = $$props.isActive));\r\n\t\tif ('isActiveFraction' in $$props) $$subscribe_isActiveFraction($$invalidate(2, isActiveFraction = $$props.isActiveFraction));\r\n\t\tif ('isVisible' in $$props) $$subscribe_isVisible($$invalidate(3, isVisible = $$props.isVisible));\r\n\t\tif ('stores' in $$props) $$invalidate(84, stores = $$props.stores);\r\n\t\tif ('locale' in $$props) $$invalidate(4, locale = $$props.locale);\r\n\t\tif ('shapes' in $$props) $$subscribe_shapes($$invalidate(5, shapes = $$props.shapes));\r\n\t\tif ('toolbar' in $$props) $$invalidate(85, toolbar = $$props.toolbar);\r\n\t\tif ('toolShapes' in $$props) $$invalidate(86, toolShapes = $$props.toolShapes);\r\n\t\tif ('toolActive' in $$props) $$invalidate(0, toolActive = $$props.toolActive);\r\n\t\tif ('toolSelectRadius' in $$props) $$invalidate(6, toolSelectRadius = $$props.toolSelectRadius);\r\n\t\tif ('toolRetainStyles' in $$props) $$invalidate(87, toolRetainStyles = $$props.toolRetainStyles);\r\n\t\tif ('textInputMode' in $$props) $$invalidate(7, textInputMode = $$props.textInputMode);\r\n\t\tif ('shapeControls' in $$props) $$invalidate(8, shapeControls = $$props.shapeControls);\r\n\t\tif ('enableButtonFlipVertical' in $$props) $$invalidate(9, enableButtonFlipVertical = $$props.enableButtonFlipVertical);\r\n\t\tif ('enablePresetSelectImage' in $$props) $$invalidate(10, enablePresetSelectImage = $$props.enablePresetSelectImage);\r\n\t\tif ('enablePresetDropImage' in $$props) $$invalidate(11, enablePresetDropImage = $$props.enablePresetDropImage);\r\n\t\tif ('enableSelectToolToAddShape' in $$props) $$invalidate(88, enableSelectToolToAddShape = $$props.enableSelectToolToAddShape);\r\n\t\tif ('enableAutoSelectMoveTool' in $$props) $$invalidate(89, enableAutoSelectMoveTool = $$props.enableAutoSelectMoveTool);\r\n\t\tif ('enableTapToAddText' in $$props) $$invalidate(12, enableTapToAddText = $$props.enableTapToAddText);\r\n\t\tif ('enableMoveTool' in $$props) $$invalidate(90, enableMoveTool = $$props.enableMoveTool);\r\n\t\tif ('enableViewTool' in $$props) $$invalidate(91, enableViewTool = $$props.enableViewTool);\r\n\t\tif ('willRenderPresetToolbar' in $$props) $$invalidate(92, willRenderPresetToolbar = $$props.willRenderPresetToolbar);\r\n\t\tif ('willStartInteraction' in $$props) $$invalidate(93, willStartInteraction = $$props.willStartInteraction);\r\n\t\tif ('shapePresets' in $$props) $$invalidate(13, shapePresets = $$props.shapePresets);\r\n\t\tif ('utilKey' in $$props) $$invalidate(14, utilKey = $$props.utilKey);\r\n\t\tif ('mapScreenPointToImagePoint' in $$props) $$invalidate(15, mapScreenPointToImagePoint = $$props.mapScreenPointToImagePoint);\r\n\t\tif ('mapImagePointToScreenPoint' in $$props) $$invalidate(16, mapImagePointToScreenPoint = $$props.mapImagePointToScreenPoint);\r\n\t\tif ('imageRotation' in $$props) $$invalidate(17, imageRotation = $$props.imageRotation);\r\n\t\tif ('imageFlipX' in $$props) $$invalidate(18, imageFlipX = $$props.imageFlipX);\r\n\t\tif ('imageFlipY' in $$props) $$invalidate(19, imageFlipY = $$props.imageFlipY);\r\n\t\tif ('parentRect' in $$props) $$subscribe_parentRect($$invalidate(20, parentRect = $$props.parentRect));\r\n\t\tif ('hooks' in $$props) $$invalidate(94, hooks = $$props.hooks);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 67108864) {\r\n\t\t\t// enable pan and zoom for shape manipulation plugins\r\n\t\t\tallowPan.set($isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 67108864) {\r\n\t\t\tallowZoom.set($isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 67108864) {\r\n\t\t\tenableZoomControls.set($isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*shapePresets*/ 8192 | $$self.$$.dirty[2] & /*toolbar, willRenderPresetToolbar, enableMoveTool, enableViewTool*/ 1887436800) {\r\n\t\t\t$$invalidate(25, toolsFiltered = filterTools(toolbar, {\r\n\t\t\t\twillRenderPresetToolbar,\r\n\t\t\t\tshapePresets,\r\n\t\t\t\tenableMoveTool,\r\n\t\t\t\tenableViewTool\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*shapeControls*/ 256) {\r\n\t\t\t$$invalidate(106, hasShapeControls = Object.keys(shapeControls).length);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*toolsFiltered*/ 33554432) {\r\n\t\t\t$$invalidate(41, showToolbar = toolsFiltered.length > 1);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*toolsFiltered*/ 33554432) {\r\n\t\t\t$$invalidate(107, hasTools = !!toolsFiltered.length);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*toolActive, toolsFiltered*/ 33554433 | $$self.$$.dirty[3] & /*hasTools*/ 16384) {\r\n\t\t\t// set to first tool in toolbar list if not defined\r\n\t\t\tif (hasTools && toolActive === undefined) $$invalidate(0, toolActive = toolsFiltered[0][0]);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*toolActive*/ 1) {\r\n\t\t\t$$invalidate(108, hasActiveTool = toolActive !== undefined);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*hasActiveTool, hasTools, hasShapeControls*/ 57344) {\r\n\t\t\t$$invalidate(40, shouldRenderControls = (!hasActiveTool || hasTools) && hasShapeControls);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*pingHub*/ 4194304) {\r\n\t\t\t$$invalidate(23, ping = pingHub && createPingDispatcher(pingHub));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive, ping, toolActive*/ 75497473) {\r\n\t\t\t$isActive && ping && ping('selectcontrol', toolActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive, utilKey*/ 67125248 | $$self.$$.dirty[3] & /*$imagePreviewModifiers*/ 33554432) {\r\n\t\t\t//\r\n\t\t\t// enable seeing the markup outlines outside of the crop area\r\n\t\t\t//\r\n\t\t\tif ($isActive) {\r\n\t\t\t\tset_store_value(imagePreviewModifiers, $imagePreviewModifiers[utilKey] = { maskMarkupOpacity: 0.85 }, $imagePreviewModifiers);\r\n\t\t\t} else {\r\n\t\t\t\tdelete $imagePreviewModifiers[utilKey];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*toolActive, markupEditor*/ 2097153) {\r\n\t\t\tif (toolActive && markupEditor) {\r\n\t\t\t\tconst draft = markupEditor.getMarkupItemDraft();\r\n\t\t\t\tif (draft) confirmDraft(draft);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*toolActive*/ 1) {\r\n\t\t\tif (toolActive) blurOnToolSwitch();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 67108864 | $$self.$$.dirty[3] & /*$isVisible*/ 16777216) {\r\n\t\t\t$$invalidate(39, shouldRenderShapeEditor = $isActive && $isVisible);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$utilRectPadded*/ 1073741824 | $$self.$$.dirty[3] & /*$stageRect*/ 2097152) {\r\n\t\t\t$$invalidate(38, markupOffset = $utilRectPadded && vectorCreate($stageRect.x - $utilRectPadded.x, $stageRect.y - $utilRectPadded.y));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*shapeControls*/ 256) {\r\n\t\t\t$$invalidate(105, markupShapeKeys = Object.keys(shapeControls));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$shapes*/ 134217728) {\r\n\t\t\t$$invalidate(97, markupSelected = $shapes.filter(shapeIsSelected)[0]);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$shapes*/ 134217728) {\r\n\t\t\t$$invalidate(100, markupEditing = $shapes.find(shape => shapeIsEditing(shape)));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive, toolActive*/ 67108865 | $$self.$$.dirty[2] & /*toolShapes*/ 16777216) {\r\n\t\t\t$$invalidate(103, markupToolShape = $isActive && toolShapes[toolActive]\r\n\t\t\t? shapeFormat(shapeDeepCopy({\r\n\t\t\t\t\t...toolShapes[toolActive][0],\r\n\t\t\t\t\t...getStoredStyles()\r\n\t\t\t\t}))\r\n\t\t\t: {});\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[2] & /*toolShapes*/ 16777216) {\r\n\t\t\tif (toolShapes) didUpdateToolShapes();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*markupToolShape, markupShapeKeys, markupToolStyles*/ 5124) {\r\n\t\t\t// compute markup styles\r\n\t\t\t$$invalidate(104, markupToolStylesComputed = markupToolShape && Object.keys(markupToolShape).reduce(\r\n\t\t\t\t(prev, key) => {\r\n\t\t\t\t\tconst isDisableStyleProp = key === 'disableStyle';\r\n\t\t\t\t\tconst isStylableProp = markupShapeKeys.find(shapeKey => shapeKey.split('_').includes(key));\r\n\r\n\t\t\t\t\t// skip props that can't be styled, but keep all `disable` props\r\n\t\t\t\t\tif (!isDisableStyleProp && !isStylableProp) return prev;\r\n\r\n\t\t\t\t\t// skip props that are set to undefined, this means they won't auto-inherit current styles (line won't inherit line ends)\r\n\t\t\t\t\tif (markupToolShape[key] === undefined) return prev;\r\n\r\n\t\t\t\t\t// apply this style\r\n\t\t\t\t\tprev[key] = hasProp(markupToolStyles, key)\r\n\t\t\t\t\t? markupToolStyles[key]\r\n\t\t\t\t\t: markupToolShape[key];\r\n\r\n\t\t\t\t\treturn prev;\r\n\t\t\t\t},\r\n\t\t\t\t{}\r\n\t\t\t));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*utilKey, toolActive*/ 16385 | $$self.$$.dirty[2] & /*toolRetainStyles*/ 33554432 | $$self.$$.dirty[3] & /*markupToolStylesComputed*/ 2048) {\r\n\t\t\ttoolRetainStyles\r\n\t\t\t? updateInterfaceState(utilKey, toolActive, markupToolStylesComputed)\r\n\t\t\t: resetInterfaceState(utilKey);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*markupSelected, markupToolStylesComputed*/ 2064) {\r\n\t\t\t$$invalidate(24, markupShapeSelected = markupSelected || markupToolStylesComputed);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*markupShapeSelected*/ 16777216 | $$self.$$.dirty[3] & /*$shapePreprocessor*/ 8388608) {\r\n\t\t\t// TODO: remove temporary warning while everyone switches to 8.7.0+\r\n\t\t\tif (markupShapeSelected && markupShapeSelected.lineEnd && !$shapePreprocessor) {\r\n\t\t\t\tconsole.warn(`Set shapePreprocessor property to draw lineStart and lineEnd styles.\\nhttps://pqina.nl/pintura/docs/v8/api/exports/#createshapepreprocessor`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*markupToolShape, markupToolStylesComputed*/ 3072) {\r\n\t\t\t$$invalidate(37, toolEraseRadius = markupToolShape && isNumber(markupToolShape.eraseRadius)\r\n\t\t\t? (markupToolStylesComputed || markupToolShape).eraseRadius\r\n\t\t\t: undefined);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*toolActive, shapePresets, enablePresetSelectImage*/ 9217 | $$self.$$.dirty[2] & /*willRenderPresetToolbar*/ 1073741824) {\r\n\t\t\t//\r\n\t\t\t// presets\r\n\t\t\t//\r\n\t\t\t$$invalidate(36, shouldRenderPresets = toolActive === 'preset' && (shapePresets.length > 0 || enablePresetSelectImage || willRenderPresetToolbar));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$parentRect*/ 536870912) {\r\n\t\t\t// if parent rect is a `Size` we're sticking presets to the image context\r\n\t\t\tshouldStickToImage = !hasProp($parentRect, 'x') && !hasProp($parentRect, 'y');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*$keysPressedStore*/ 4194304) {\r\n\t\t\t//#region Pan and Zoom\r\n\t\t\t$$invalidate(101, userEnabledPanModeWithKeyboard = $keysPressedStore && $keysPressedStore[0] === 32);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*toolActive*/ 1) {\r\n\t\t\t$$invalidate(102, userEnabledPanModeWithButton = toolActive === 'view');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*userEnabledPanModeWithButton, userEnabledPanModeWithKeyboard*/ 768) {\r\n\t\t\t$$invalidate(99, enablePanMode = userEnabledPanModeWithButton || userEnabledPanModeWithKeyboard);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*markupEditing*/ 128) {\r\n\t\t\t$$invalidate(98, isEditingText = !!markupEditing);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 67108864 | $$self.$$.dirty[3] & /*enablePanMode, isEditingText*/ 96) {\r\n\t\t\tenablePanInput.set($isActive ? enablePanMode && !isEditingText : true);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 67108864 | $$self.$$.dirty[3] & /*isEditingText*/ 32) {\r\n\t\t\tenableZoomInput.set($isActive ? !isEditingText : true);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$enablePanInputStatus, toolActive*/ 268435457 | $$self.$$.dirty[3] & /*hoverShape, markupSelected*/ 24) {\r\n\t\t\t$$invalidate(35, cursor = getCursor(hoverShape, markupSelected, $enablePanInputStatus, isPanning, toolActive));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*$elasticityMultiplier*/ 1048576) {\r\n\t\t\t//\r\n\t\t\t// scroll components\r\n\t\t\t//\r\n\t\t\t$$invalidate(34, computedScrollElasticity = $elasticityMultiplier * scrollElasticity);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[2] & /*willRenderPresetToolbar*/ 1073741824 | $$self.$$.dirty[3] & /*$redrawTrigger, $env*/ 786432) {\r\n\t\t\t$$invalidate(33, runWillRenderPresetToolbarHook = $redrawTrigger && willRenderPresetToolbar\r\n\t\t\t? toolbar => runSafe(() => willRenderPresetToolbar(toolbar, addPreset, { ...$env }, () => redrawTrigger.set({})))\r\n\t\t\t: passthrough);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*hooks*/ 2) {\r\n\t\t\t//\r\n\t\t\t// filter out beforeAdd hook\r\n\t\t\t//\r\n\t\t\t$$invalidate(32, layoutEditorHooks = Object.keys(hooks).reduce(\r\n\t\t\t\t(prev, curr) => {\r\n\t\t\t\t\tif (curr === 'beforeAddShape' || hooks[curr] === undefined) return prev;\r\n\t\t\t\t\tprev[curr] = hooks[curr];\r\n\t\t\t\t\treturn prev;\r\n\t\t\t\t},\r\n\t\t\t\t{}\r\n\t\t\t));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 67108864) {\r\n\t\t\ttoggleShapePrerendering($isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 67108864 | $$self.$$.dirty[3] & /*$isAnimated*/ 131072) {\r\n\t\t\t$isAnimated && footerOffset.set($isActive ? 0 : 20);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[3] & /*$footerOffset*/ 65536) {\r\n\t\t\t$$invalidate(31, footerStyle = $footerOffset\r\n\t\t\t? `transform: translateY(${$footerOffset}px)`\r\n\t\t\t: undefined);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\ttoolActive,\r\n\t\tisActive,\r\n\t\tisActiveFraction,\r\n\t\tisVisible,\r\n\t\tlocale,\r\n\t\tshapes,\r\n\t\ttoolSelectRadius,\r\n\t\ttextInputMode,\r\n\t\tshapeControls,\r\n\t\tenableButtonFlipVertical,\r\n\t\tenablePresetSelectImage,\r\n\t\tenablePresetDropImage,\r\n\t\tenableTapToAddText,\r\n\t\tshapePresets,\r\n\t\tutilKey,\r\n\t\tmapScreenPointToImagePoint,\r\n\t\tmapImagePointToScreenPoint,\r\n\t\timageRotation,\r\n\t\timageFlipX,\r\n\t\timageFlipY,\r\n\t\tparentRect,\r\n\t\tmarkupEditor,\r\n\t\tpingHub,\r\n\t\tping,\r\n\t\tmarkupShapeSelected,\r\n\t\ttoolsFiltered,\r\n\t\t$isActive,\r\n\t\t$shapes,\r\n\t\t$enablePanInputStatus,\r\n\t\t$parentRect,\r\n\t\t$utilRectPadded,\r\n\t\tfooterStyle,\r\n\t\tlayoutEditorHooks,\r\n\t\trunWillRenderPresetToolbarHook,\r\n\t\tcomputedScrollElasticity,\r\n\t\tcursor,\r\n\t\tshouldRenderPresets,\r\n\t\ttoolEraseRadius,\r\n\t\tmarkupOffset,\r\n\t\tshouldRenderShapeEditor,\r\n\t\tshouldRenderControls,\r\n\t\tshowToolbar,\r\n\t\t$imageSelectionZoomCurrent,\r\n\t\t$rootRect,\r\n\t\t$imageOverlayMarkup,\r\n\t\t$isActiveFraction,\r\n\t\t$rootColorSecondary,\r\n\t\tisAnimated,\r\n\t\telasticityMultiplier,\r\n\t\tui,\r\n\t\tenv,\r\n\t\trootRect,\r\n\t\trootColorSecondary,\r\n\t\tenablePanInputStatus,\r\n\t\tstageRect,\r\n\t\tutilRectPadded,\r\n\t\timageOverlayMarkup,\r\n\t\timagePreviewModifiers,\r\n\t\timageCropRect,\r\n\t\tshapePreprocessor,\r\n\t\tstageScalar,\r\n\t\timageSelectionRect,\r\n\t\timageSelectionZoomCurrent,\r\n\t\timageSelectionPan,\r\n\t\tkeysPressedStore,\r\n\t\tupdateActiveTool,\r\n\t\thandleInteractionStart,\r\n\t\thandleInteractionUpdate,\r\n\t\thandleInteractionRelease,\r\n\t\thandleInteractionCancel,\r\n\t\thandleInteractionEnd,\r\n\t\thandleKey,\r\n\t\thandleUpdateSelectedMarkupShape,\r\n\t\thandleTapCanvas,\r\n\t\thandleHoverShape,\r\n\t\thandleGrabPreset,\r\n\t\thandleDragPreset,\r\n\t\thandleDropPreset,\r\n\t\thandleAddPreset,\r\n\t\thandleDropFiles,\r\n\t\thandleWillStartInteraction,\r\n\t\thandleMarkupUpdate,\r\n\t\tredrawTrigger,\r\n\t\tfooterOffset,\r\n\t\tstores,\r\n\t\ttoolbar,\r\n\t\ttoolShapes,\r\n\t\ttoolRetainStyles,\r\n\t\tenableSelectToolToAddShape,\r\n\t\tenableAutoSelectMoveTool,\r\n\t\tenableMoveTool,\r\n\t\tenableViewTool,\r\n\t\twillRenderPresetToolbar,\r\n\t\twillStartInteraction,\r\n\t\thooks,\r\n\t\tmarkupToolStyles,\r\n\t\thoverShape,\r\n\t\tmarkupSelected,\r\n\t\tisEditingText,\r\n\t\tenablePanMode,\r\n\t\tmarkupEditing,\r\n\t\tuserEnabledPanModeWithKeyboard,\r\n\t\tuserEnabledPanModeWithButton,\r\n\t\tmarkupToolShape,\r\n\t\tmarkupToolStylesComputed,\r\n\t\tmarkupShapeKeys,\r\n\t\thasShapeControls,\r\n\t\thasTools,\r\n\t\thasActiveTool,\r\n\t\t$footerOffset,\r\n\t\t$isAnimated,\r\n\t\t$env,\r\n\t\t$redrawTrigger,\r\n\t\t$elasticityMultiplier,\r\n\t\t$stageRect,\r\n\t\t$keysPressedStore,\r\n\t\t$shapePreprocessor,\r\n\t\t$isVisible,\r\n\t\t$imagePreviewModifiers,\r\n\t\tmeasure_handler_1,\r\n\t\tfunc,\r\n\t\tfunc_1,\r\n\t\tfunc_2,\r\n\t\tfunc_3,\r\n\t\tfunc_4,\r\n\t\tfunc_5,\r\n\t\tshapelayouteditor_binding,\r\n\t\tshapelayouteditor_markup_binding,\r\n\t\tshapelayouteditor_ui_binding,\r\n\t\tdiv_binding,\r\n\t\tmeasure_handler\r\n\t];\r\n}\r\n\r\nclass ShapeUtil extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$9,\r\n\t\t\tcreate_fragment$9,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tisActive: 1,\r\n\t\t\t\tisActiveFraction: 2,\r\n\t\t\t\tisVisible: 3,\r\n\t\t\t\tstores: 84,\r\n\t\t\t\tlocale: 4,\r\n\t\t\t\tshapes: 5,\r\n\t\t\t\ttoolbar: 85,\r\n\t\t\t\ttoolShapes: 86,\r\n\t\t\t\ttoolActive: 0,\r\n\t\t\t\ttoolSelectRadius: 6,\r\n\t\t\t\ttoolRetainStyles: 87,\r\n\t\t\t\ttextInputMode: 7,\r\n\t\t\t\tshapeControls: 8,\r\n\t\t\t\tenableButtonFlipVertical: 9,\r\n\t\t\t\tenablePresetSelectImage: 10,\r\n\t\t\t\tenablePresetDropImage: 11,\r\n\t\t\t\tenableSelectToolToAddShape: 88,\r\n\t\t\t\tenableAutoSelectMoveTool: 89,\r\n\t\t\t\tenableTapToAddText: 12,\r\n\t\t\t\tenableMoveTool: 90,\r\n\t\t\t\tenableViewTool: 91,\r\n\t\t\t\twillRenderPresetToolbar: 92,\r\n\t\t\t\twillStartInteraction: 93,\r\n\t\t\t\tshapePresets: 13,\r\n\t\t\t\tutilKey: 14,\r\n\t\t\t\tmapScreenPointToImagePoint: 15,\r\n\t\t\t\tmapImagePointToScreenPoint: 16,\r\n\t\t\t\timageRotation: 17,\r\n\t\t\t\timageFlipX: 18,\r\n\t\t\t\timageFlipY: 19,\r\n\t\t\t\tparentRect: 20,\r\n\t\t\t\thooks: 94\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1, -1, -1, -1, -1]\r\n\t\t);\r\n\t}\r\n\r\n\tget isActive() {\r\n\t\treturn this.$$.ctx[1];\r\n\t}\r\n\r\n\tset isActive(isActive) {\r\n\t\tthis.$$set({ isActive });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget isActiveFraction() {\r\n\t\treturn this.$$.ctx[2];\r\n\t}\r\n\r\n\tset isActiveFraction(isActiveFraction) {\r\n\t\tthis.$$set({ isActiveFraction });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget isVisible() {\r\n\t\treturn this.$$.ctx[3];\r\n\t}\r\n\r\n\tset isVisible(isVisible) {\r\n\t\tthis.$$set({ isVisible });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stores() {\r\n\t\treturn this.$$.ctx[84];\r\n\t}\r\n\r\n\tset stores(stores) {\r\n\t\tthis.$$set({ stores });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget locale() {\r\n\t\treturn this.$$.ctx[4];\r\n\t}\r\n\r\n\tset locale(locale) {\r\n\t\tthis.$$set({ locale });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget shapes() {\r\n\t\treturn this.$$.ctx[5];\r\n\t}\r\n\r\n\tset shapes(shapes) {\r\n\t\tthis.$$set({ shapes });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget toolbar() {\r\n\t\treturn this.$$.ctx[85];\r\n\t}\r\n\r\n\tset toolbar(toolbar) {\r\n\t\tthis.$$set({ toolbar });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget toolShapes() {\r\n\t\treturn this.$$.ctx[86];\r\n\t}\r\n\r\n\tset toolShapes(toolShapes) {\r\n\t\tthis.$$set({ toolShapes });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget toolActive() {\r\n\t\treturn this.$$.ctx[0];\r\n\t}\r\n\r\n\tset toolActive(toolActive) {\r\n\t\tthis.$$set({ toolActive });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget toolSelectRadius() {\r\n\t\treturn this.$$.ctx[6];\r\n\t}\r\n\r\n\tset toolSelectRadius(toolSelectRadius) {\r\n\t\tthis.$$set({ toolSelectRadius });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget toolRetainStyles() {\r\n\t\treturn this.$$.ctx[87];\r\n\t}\r\n\r\n\tset toolRetainStyles(toolRetainStyles) {\r\n\t\tthis.$$set({ toolRetainStyles });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget textInputMode() {\r\n\t\treturn this.$$.ctx[7];\r\n\t}\r\n\r\n\tset textInputMode(textInputMode) {\r\n\t\tthis.$$set({ textInputMode });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget shapeControls() {\r\n\t\treturn this.$$.ctx[8];\r\n\t}\r\n\r\n\tset shapeControls(shapeControls) {\r\n\t\tthis.$$set({ shapeControls });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableButtonFlipVertical() {\r\n\t\treturn this.$$.ctx[9];\r\n\t}\r\n\r\n\tset enableButtonFlipVertical(enableButtonFlipVertical) {\r\n\t\tthis.$$set({ enableButtonFlipVertical });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enablePresetSelectImage() {\r\n\t\treturn this.$$.ctx[10];\r\n\t}\r\n\r\n\tset enablePresetSelectImage(enablePresetSelectImage) {\r\n\t\tthis.$$set({ enablePresetSelectImage });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enablePresetDropImage() {\r\n\t\treturn this.$$.ctx[11];\r\n\t}\r\n\r\n\tset enablePresetDropImage(enablePresetDropImage) {\r\n\t\tthis.$$set({ enablePresetDropImage });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableSelectToolToAddShape() {\r\n\t\treturn this.$$.ctx[88];\r\n\t}\r\n\r\n\tset enableSelectToolToAddShape(enableSelectToolToAddShape) {\r\n\t\tthis.$$set({ enableSelectToolToAddShape });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableAutoSelectMoveTool() {\r\n\t\treturn this.$$.ctx[89];\r\n\t}\r\n\r\n\tset enableAutoSelectMoveTool(enableAutoSelectMoveTool) {\r\n\t\tthis.$$set({ enableAutoSelectMoveTool });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableTapToAddText() {\r\n\t\treturn this.$$.ctx[12];\r\n\t}\r\n\r\n\tset enableTapToAddText(enableTapToAddText) {\r\n\t\tthis.$$set({ enableTapToAddText });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableMoveTool() {\r\n\t\treturn this.$$.ctx[90];\r\n\t}\r\n\r\n\tset enableMoveTool(enableMoveTool) {\r\n\t\tthis.$$set({ enableMoveTool });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableViewTool() {\r\n\t\treturn this.$$.ctx[91];\r\n\t}\r\n\r\n\tset enableViewTool(enableViewTool) {\r\n\t\tthis.$$set({ enableViewTool });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget willRenderPresetToolbar() {\r\n\t\treturn this.$$.ctx[92];\r\n\t}\r\n\r\n\tset willRenderPresetToolbar(willRenderPresetToolbar) {\r\n\t\tthis.$$set({ willRenderPresetToolbar });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget willStartInteraction() {\r\n\t\treturn this.$$.ctx[93];\r\n\t}\r\n\r\n\tset willStartInteraction(willStartInteraction) {\r\n\t\tthis.$$set({ willStartInteraction });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget shapePresets() {\r\n\t\treturn this.$$.ctx[13];\r\n\t}\r\n\r\n\tset shapePresets(shapePresets) {\r\n\t\tthis.$$set({ shapePresets });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget utilKey() {\r\n\t\treturn this.$$.ctx[14];\r\n\t}\r\n\r\n\tset utilKey(utilKey) {\r\n\t\tthis.$$set({ utilKey });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget mapScreenPointToImagePoint() {\r\n\t\treturn this.$$.ctx[15];\r\n\t}\r\n\r\n\tset mapScreenPointToImagePoint(mapScreenPointToImagePoint) {\r\n\t\tthis.$$set({ mapScreenPointToImagePoint });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget mapImagePointToScreenPoint() {\r\n\t\treturn this.$$.ctx[16];\r\n\t}\r\n\r\n\tset mapImagePointToScreenPoint(mapImagePointToScreenPoint) {\r\n\t\tthis.$$set({ mapImagePointToScreenPoint });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget imageRotation() {\r\n\t\treturn this.$$.ctx[17];\r\n\t}\r\n\r\n\tset imageRotation(imageRotation) {\r\n\t\tthis.$$set({ imageRotation });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget imageFlipX() {\r\n\t\treturn this.$$.ctx[18];\r\n\t}\r\n\r\n\tset imageFlipX(imageFlipX) {\r\n\t\tthis.$$set({ imageFlipX });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget imageFlipY() {\r\n\t\treturn this.$$.ctx[19];\r\n\t}\r\n\r\n\tset imageFlipY(imageFlipY) {\r\n\t\tthis.$$set({ imageFlipY });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget parentRect() {\r\n\t\treturn this.$$.ctx[20];\r\n\t}\r\n\r\n\tset parentRect(parentRect) {\r\n\t\tthis.$$set({ parentRect });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget hooks() {\r\n\t\treturn this.$$.ctx[94];\r\n\t}\r\n\r\n\tset hooks(hooks) {\r\n\t\tthis.$$set({ hooks });\r\n\t\tflush();\r\n\t}\r\n}\r\n\r\nvar _mapImagePointToScreenPoint = (imagePoint, canvasSize, imageSize, imageOrigin, imageTranslation, imageRotation, imageScalar, imageFlipX, imageFlipY) => {\r\n    const mappedPoint = vectorClone(imagePoint);\r\n    const imageCenterX = imageSize.width * 0.5;\r\n    const imageCenterY = imageSize.height * 0.5;\r\n    const canvasCenterX = canvasSize.width * 0.5;\r\n    const canvasCenterY = canvasSize.height * 0.5;\r\n    const imageOffsetX = imageTranslation.x + imageOrigin.x;\r\n    const imageOffsetY = imageTranslation.y + imageOrigin.y;\r\n    if (imageFlipX)\r\n        mappedPoint.x = imageSize.width - mappedPoint.x;\r\n    if (imageFlipY)\r\n        mappedPoint.y = imageSize.height - mappedPoint.y;\r\n    // rotate around image center based on if image is rotated\r\n    const c = Math.cos(imageRotation);\r\n    const s = Math.sin(imageRotation);\r\n    mappedPoint.x -= imageCenterX;\r\n    mappedPoint.y -= imageCenterY;\r\n    const rx = mappedPoint.x * c - mappedPoint.y * s;\r\n    const ry = mappedPoint.x * s + mappedPoint.y * c;\r\n    mappedPoint.x = imageCenterX + rx;\r\n    mappedPoint.y = imageCenterY + ry;\r\n    // position based on screen transforms\r\n    mappedPoint.x *= imageScalar;\r\n    mappedPoint.y *= imageScalar;\r\n    mappedPoint.x += canvasCenterX;\r\n    mappedPoint.y += canvasCenterY;\r\n    mappedPoint.x += imageOffsetX;\r\n    mappedPoint.y += imageOffsetY;\r\n    mappedPoint.x -= imageCenterX * imageScalar;\r\n    mappedPoint.y -= imageCenterY * imageScalar;\r\n    const tx = (imageTranslation.x - imageOffsetX) * imageScalar;\r\n    const ty = (imageTranslation.y - imageOffsetY) * imageScalar;\r\n    const rtx = tx * c - ty * s;\r\n    const rty = tx * s + ty * c;\r\n    mappedPoint.x += rtx;\r\n    mappedPoint.y += rty;\r\n    return mappedPoint;\r\n};\r\n\r\nvar _mapScreenPointToImagePoint = (screenPoint, canvasSize, imageSize, imageOrigin, imageTranslation, imageRotation, imageScalar, imageFlipX, imageFlipY) => {\r\n    const mappedPoint = vectorClone(screenPoint);\r\n    const imageCenter = sizeCenter(imageSize);\r\n    const canvasCenter = sizeCenter(canvasSize);\r\n    const imageOffset = vectorCreate(imageTranslation.x + imageOrigin.x, imageTranslation.y + imageOrigin.y);\r\n    const c = Math.cos(imageRotation);\r\n    const s = Math.sin(imageRotation);\r\n    mappedPoint.x -= canvasCenter.x;\r\n    mappedPoint.y -= canvasCenter.y;\r\n    const tx = (imageTranslation.x - imageOffset.x) * imageScalar;\r\n    const ty = (imageTranslation.y - imageOffset.y) * imageScalar;\r\n    const rtx = tx * c - ty * s;\r\n    const rty = tx * s + ty * c;\r\n    mappedPoint.x -= rtx;\r\n    mappedPoint.y -= rty;\r\n    mappedPoint.x -= imageOffset.x;\r\n    mappedPoint.y -= imageOffset.y;\r\n    mappedPoint.x /= imageScalar;\r\n    mappedPoint.y /= imageScalar;\r\n    const rx = mappedPoint.x * c + mappedPoint.y * s;\r\n    const ry = mappedPoint.x * s - mappedPoint.y * c;\r\n    mappedPoint.x = rx;\r\n    mappedPoint.y = -ry;\r\n    mappedPoint.x += imageCenter.x;\r\n    mappedPoint.y += imageCenter.y;\r\n    if (imageFlipX)\r\n        mappedPoint.x = imageSize.width - mappedPoint.x;\r\n    if (imageFlipY)\r\n        mappedPoint.y = imageSize.height - mappedPoint.y;\r\n    return mappedPoint;\r\n};\r\n\r\n/* src/core/ui/plugins/annotate/index.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$8(ctx) {\r\n\tlet shapeutil;\r\n\tlet updating_toolActive;\r\n\tlet current;\r\n\r\n\tfunction shapeutil_toolActive_binding(value) {\r\n\t\t/*shapeutil_toolActive_binding*/ ctx[51](value);\r\n\t}\r\n\r\n\tlet shapeutil_props = {\r\n\t\tutilKey: 'annotate',\r\n\t\tstores: /*stores*/ ctx[4],\r\n\t\tlocale: /*locale*/ ctx[5],\r\n\t\tisActive: /*isActive*/ ctx[1],\r\n\t\tisActiveFraction: /*isActiveFraction*/ ctx[2],\r\n\t\tisVisible: /*isVisible*/ ctx[3],\r\n\t\tmapScreenPointToImagePoint: /*mapScreenPointToImagePoint*/ ctx[36],\r\n\t\tmapImagePointToScreenPoint: /*mapImagePointToScreenPoint*/ ctx[35],\r\n\t\timageRotation: /*$imageRotation*/ ctx[37],\r\n\t\timageFlipX: /*$imageFlipX*/ ctx[34],\r\n\t\timageFlipY: /*$imageFlipY*/ ctx[33],\r\n\t\tshapes: /*imageAnnotation*/ ctx[39],\r\n\t\ttoolbar: /*annotateTools*/ ctx[13] || /*markupEditorToolbar*/ ctx[6],\r\n\t\ttoolShapes: /*annotateToolShapes*/ ctx[14] || /*markupEditorToolStyles*/ ctx[7],\r\n\t\ttoolRetainStyles: /*markupEditorToolRetainStyles*/ ctx[8],\r\n\t\tenableSelectToolToAddShape: /*enableSelectToolToAddShape*/ ctx[23],\r\n\t\tenableTapToAddText: /*enableTapToAddText*/ ctx[24],\r\n\t\tenableViewTool: /*enableViewTool*/ ctx[22],\r\n\t\tenableMoveTool: /*enableMoveTool*/ ctx[26],\r\n\t\tenableAutoSelectMoveTool: /*enableAutoSelectMoveTool*/ ctx[25],\r\n\t\tshapeControls: /*annotateShapeControls*/ ctx[15] || /*markupEditorShapeStyleControls*/ ctx[9],\r\n\t\tshapePresets: /*annotatePresets*/ ctx[19],\r\n\t\tenableButtonFlipVertical: /*annotateEnableButtonFlipVertical*/ ctx[16],\r\n\t\tparentRect: /*imageSize*/ ctx[40],\r\n\t\tenablePresetDropImage: /*annotateEnableDropImagePreset*/ ctx[18],\r\n\t\tenablePresetSelectImage: /*annotateEnableSelectImagePreset*/ ctx[17],\r\n\t\ttoolSelectRadius: /*markupEditorToolSelectRadius*/ ctx[10],\r\n\t\ttextInputMode: /*markupEditorTextInputMode*/ ctx[11],\r\n\t\twillStartInteraction: /*markupEditorWillStartInteraction*/ ctx[21],\r\n\t\twillRenderPresetToolbar: /*annotateWillRenderShapePresetToolbar*/ ctx[20] || /*willRenderShapePresetToolbar*/ ctx[12],\r\n\t\thooks: {\r\n\t\t\twillRenderShapeControls: /*willRenderShapeControls*/ ctx[27],\r\n\t\t\tbeforeAddShape: /*beforeAddShape*/ ctx[28],\r\n\t\t\tbeforeRemoveShape: /*beforeRemoveShape*/ ctx[29],\r\n\t\t\tbeforeDeselectShape: /*beforeDeselectShape*/ ctx[30],\r\n\t\t\tbeforeSelectShape: /*beforeSelectShape*/ ctx[31],\r\n\t\t\tbeforeUpdateShape: /*beforeUpdateShape*/ ctx[32]\r\n\t\t}\r\n\t};\r\n\r\n\tif (/*annotateActiveTool*/ ctx[0] !== void 0) {\r\n\t\tshapeutil_props.toolActive = /*annotateActiveTool*/ ctx[0];\r\n\t}\r\n\r\n\tshapeutil = new ShapeUtil({ props: shapeutil_props });\r\n\tbinding_callbacks.push(() => bind(shapeutil, 'toolActive', shapeutil_toolActive_binding));\r\n\tshapeutil.$on(\"measure\", /*measure_handler*/ ctx[52]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(shapeutil.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(shapeutil, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst shapeutil_changes = {};\r\n\t\t\tif (dirty[0] & /*stores*/ 16) shapeutil_changes.stores = /*stores*/ ctx[4];\r\n\t\t\tif (dirty[0] & /*locale*/ 32) shapeutil_changes.locale = /*locale*/ ctx[5];\r\n\t\t\tif (dirty[0] & /*isActive*/ 2) shapeutil_changes.isActive = /*isActive*/ ctx[1];\r\n\t\t\tif (dirty[0] & /*isActiveFraction*/ 4) shapeutil_changes.isActiveFraction = /*isActiveFraction*/ ctx[2];\r\n\t\t\tif (dirty[0] & /*isVisible*/ 8) shapeutil_changes.isVisible = /*isVisible*/ ctx[3];\r\n\t\t\tif (dirty[1] & /*mapScreenPointToImagePoint*/ 32) shapeutil_changes.mapScreenPointToImagePoint = /*mapScreenPointToImagePoint*/ ctx[36];\r\n\t\t\tif (dirty[1] & /*mapImagePointToScreenPoint*/ 16) shapeutil_changes.mapImagePointToScreenPoint = /*mapImagePointToScreenPoint*/ ctx[35];\r\n\t\t\tif (dirty[1] & /*$imageRotation*/ 64) shapeutil_changes.imageRotation = /*$imageRotation*/ ctx[37];\r\n\t\t\tif (dirty[1] & /*$imageFlipX*/ 8) shapeutil_changes.imageFlipX = /*$imageFlipX*/ ctx[34];\r\n\t\t\tif (dirty[1] & /*$imageFlipY*/ 4) shapeutil_changes.imageFlipY = /*$imageFlipY*/ ctx[33];\r\n\t\t\tif (dirty[0] & /*annotateTools, markupEditorToolbar*/ 8256) shapeutil_changes.toolbar = /*annotateTools*/ ctx[13] || /*markupEditorToolbar*/ ctx[6];\r\n\t\t\tif (dirty[0] & /*annotateToolShapes, markupEditorToolStyles*/ 16512) shapeutil_changes.toolShapes = /*annotateToolShapes*/ ctx[14] || /*markupEditorToolStyles*/ ctx[7];\r\n\t\t\tif (dirty[0] & /*markupEditorToolRetainStyles*/ 256) shapeutil_changes.toolRetainStyles = /*markupEditorToolRetainStyles*/ ctx[8];\r\n\t\t\tif (dirty[0] & /*enableSelectToolToAddShape*/ 8388608) shapeutil_changes.enableSelectToolToAddShape = /*enableSelectToolToAddShape*/ ctx[23];\r\n\t\t\tif (dirty[0] & /*enableTapToAddText*/ 16777216) shapeutil_changes.enableTapToAddText = /*enableTapToAddText*/ ctx[24];\r\n\t\t\tif (dirty[0] & /*enableViewTool*/ 4194304) shapeutil_changes.enableViewTool = /*enableViewTool*/ ctx[22];\r\n\t\t\tif (dirty[0] & /*enableMoveTool*/ 67108864) shapeutil_changes.enableMoveTool = /*enableMoveTool*/ ctx[26];\r\n\t\t\tif (dirty[0] & /*enableAutoSelectMoveTool*/ 33554432) shapeutil_changes.enableAutoSelectMoveTool = /*enableAutoSelectMoveTool*/ ctx[25];\r\n\t\t\tif (dirty[0] & /*annotateShapeControls, markupEditorShapeStyleControls*/ 33280) shapeutil_changes.shapeControls = /*annotateShapeControls*/ ctx[15] || /*markupEditorShapeStyleControls*/ ctx[9];\r\n\t\t\tif (dirty[0] & /*annotatePresets*/ 524288) shapeutil_changes.shapePresets = /*annotatePresets*/ ctx[19];\r\n\t\t\tif (dirty[0] & /*annotateEnableButtonFlipVertical*/ 65536) shapeutil_changes.enableButtonFlipVertical = /*annotateEnableButtonFlipVertical*/ ctx[16];\r\n\t\t\tif (dirty[0] & /*annotateEnableDropImagePreset*/ 262144) shapeutil_changes.enablePresetDropImage = /*annotateEnableDropImagePreset*/ ctx[18];\r\n\t\t\tif (dirty[0] & /*annotateEnableSelectImagePreset*/ 131072) shapeutil_changes.enablePresetSelectImage = /*annotateEnableSelectImagePreset*/ ctx[17];\r\n\t\t\tif (dirty[0] & /*markupEditorToolSelectRadius*/ 1024) shapeutil_changes.toolSelectRadius = /*markupEditorToolSelectRadius*/ ctx[10];\r\n\t\t\tif (dirty[0] & /*markupEditorTextInputMode*/ 2048) shapeutil_changes.textInputMode = /*markupEditorTextInputMode*/ ctx[11];\r\n\t\t\tif (dirty[0] & /*markupEditorWillStartInteraction*/ 2097152) shapeutil_changes.willStartInteraction = /*markupEditorWillStartInteraction*/ ctx[21];\r\n\t\t\tif (dirty[0] & /*annotateWillRenderShapePresetToolbar, willRenderShapePresetToolbar*/ 1052672) shapeutil_changes.willRenderPresetToolbar = /*annotateWillRenderShapePresetToolbar*/ ctx[20] || /*willRenderShapePresetToolbar*/ ctx[12];\r\n\r\n\t\t\tif (dirty[0] & /*willRenderShapeControls, beforeAddShape, beforeRemoveShape, beforeDeselectShape*/ 2013265920 | dirty[1] & /*beforeSelectShape, beforeUpdateShape*/ 3) shapeutil_changes.hooks = {\r\n\t\t\t\twillRenderShapeControls: /*willRenderShapeControls*/ ctx[27],\r\n\t\t\t\tbeforeAddShape: /*beforeAddShape*/ ctx[28],\r\n\t\t\t\tbeforeRemoveShape: /*beforeRemoveShape*/ ctx[29],\r\n\t\t\t\tbeforeDeselectShape: /*beforeDeselectShape*/ ctx[30],\r\n\t\t\t\tbeforeSelectShape: /*beforeSelectShape*/ ctx[31],\r\n\t\t\t\tbeforeUpdateShape: /*beforeUpdateShape*/ ctx[32]\r\n\t\t\t};\r\n\r\n\t\t\tif (!updating_toolActive && dirty[0] & /*annotateActiveTool*/ 1) {\r\n\t\t\t\tupdating_toolActive = true;\r\n\t\t\t\tshapeutil_changes.toolActive = /*annotateActiveTool*/ ctx[0];\r\n\t\t\t\tadd_flush_callback(() => updating_toolActive = false);\r\n\t\t\t}\r\n\r\n\t\t\tshapeutil.$set(shapeutil_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(shapeutil.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(shapeutil.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(shapeutil, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$8($$self, $$props, $$invalidate) {\r\n\tlet mapScreenPointToImagePoint;\r\n\tlet mapImagePointToScreenPoint;\r\n\tlet $imageFlipY;\r\n\tlet $imageFlipX;\r\n\tlet $imageTransformsInterpolated;\r\n\tlet $imageTransforms;\r\n\tlet $imageSize;\r\n\tlet $rootRect;\r\n\tlet $imageRotation;\r\n\tconst name = 'annotate';\r\n\tlet { isActive } = $$props;\r\n\tlet { isActiveFraction } = $$props;\r\n\tlet { isVisible } = $$props;\r\n\tlet { stores } = $$props;\r\n\tlet { locale = {} } = $$props;\r\n\tlet { markupEditorToolbar = undefined } = $$props;\r\n\tlet { markupEditorToolStyles = undefined } = $$props;\r\n\tlet { markupEditorToolRetainStyles = undefined } = $$props;\r\n\tlet { markupEditorShapeStyleControls = undefined } = $$props;\r\n\tlet { markupEditorToolSelectRadius = undefined } = $$props;\r\n\tlet { markupEditorTextInputMode = undefined } = $$props;\r\n\tlet { willRenderShapePresetToolbar = undefined } = $$props;\r\n\tlet { annotateTools = undefined } = $$props;\r\n\tlet { annotateToolShapes = undefined } = $$props;\r\n\tlet { annotateShapeControls = undefined } = $$props;\r\n\tlet { annotateActiveTool = undefined } = $$props;\r\n\tlet { annotateEnableButtonFlipVertical = false } = $$props;\r\n\tlet { annotateEnableSelectImagePreset = false } = $$props;\r\n\tlet { annotateEnableDropImagePreset = true } = $$props;\r\n\tlet { annotatePresets = [] } = $$props;\r\n\tlet { annotateWillRenderShapePresetToolbar = undefined } = $$props;\r\n\tlet { markupEditorWillStartInteraction = undefined } = $$props;\r\n\tlet { enableViewTool = undefined } = $$props;\r\n\tlet { enableSelectToolToAddShape = undefined } = $$props;\r\n\tlet { enableTapToAddText = undefined } = $$props;\r\n\tlet { enableAutoSelectMoveTool = undefined } = $$props;\r\n\tlet { enableMoveTool = undefined } = $$props;\r\n\tlet { willRenderShapeControls = undefined } = $$props;\r\n\tlet { beforeAddShape = undefined } = $$props;\r\n\tlet { beforeRemoveShape = undefined } = $$props;\r\n\tlet { beforeDeselectShape = undefined } = $$props;\r\n\tlet { beforeSelectShape = undefined } = $$props;\r\n\tlet { beforeUpdateShape = undefined } = $$props;\r\n\r\n\t// export let markupEditorInteractionMode = false; // @deprecated\r\n\t// connect filter choice to stores\r\n\tconst { rootRect, imageAnnotation, imageSize, imageRotation, imageFlipX, imageFlipY, imageTransforms, imageTransformsInterpolated } = stores;\r\n\r\n\tcomponent_subscribe($$self, rootRect, value => $$invalidate(50, $rootRect = value));\r\n\tcomponent_subscribe($$self, imageSize, value => $$invalidate(49, $imageSize = value));\r\n\tcomponent_subscribe($$self, imageRotation, value => $$invalidate(37, $imageRotation = value));\r\n\tcomponent_subscribe($$self, imageFlipX, value => $$invalidate(34, $imageFlipX = value));\r\n\tcomponent_subscribe($$self, imageFlipY, value => $$invalidate(33, $imageFlipY = value));\r\n\tcomponent_subscribe($$self, imageTransforms, value => $$invalidate(48, $imageTransforms = value));\r\n\tcomponent_subscribe($$self, imageTransformsInterpolated, value => $$invalidate(47, $imageTransformsInterpolated = value));\r\n\r\n\tfunction shapeutil_toolActive_binding(value) {\r\n\t\tannotateActiveTool = value;\r\n\t\t$$invalidate(0, annotateActiveTool);\r\n\t}\r\n\r\n\tfunction measure_handler(event) {\r\n\t\tbubble.call(this, $$self, event);\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('isActive' in $$props) $$invalidate(1, isActive = $$props.isActive);\r\n\t\tif ('isActiveFraction' in $$props) $$invalidate(2, isActiveFraction = $$props.isActiveFraction);\r\n\t\tif ('isVisible' in $$props) $$invalidate(3, isVisible = $$props.isVisible);\r\n\t\tif ('stores' in $$props) $$invalidate(4, stores = $$props.stores);\r\n\t\tif ('locale' in $$props) $$invalidate(5, locale = $$props.locale);\r\n\t\tif ('markupEditorToolbar' in $$props) $$invalidate(6, markupEditorToolbar = $$props.markupEditorToolbar);\r\n\t\tif ('markupEditorToolStyles' in $$props) $$invalidate(7, markupEditorToolStyles = $$props.markupEditorToolStyles);\r\n\t\tif ('markupEditorToolRetainStyles' in $$props) $$invalidate(8, markupEditorToolRetainStyles = $$props.markupEditorToolRetainStyles);\r\n\t\tif ('markupEditorShapeStyleControls' in $$props) $$invalidate(9, markupEditorShapeStyleControls = $$props.markupEditorShapeStyleControls);\r\n\t\tif ('markupEditorToolSelectRadius' in $$props) $$invalidate(10, markupEditorToolSelectRadius = $$props.markupEditorToolSelectRadius);\r\n\t\tif ('markupEditorTextInputMode' in $$props) $$invalidate(11, markupEditorTextInputMode = $$props.markupEditorTextInputMode);\r\n\t\tif ('willRenderShapePresetToolbar' in $$props) $$invalidate(12, willRenderShapePresetToolbar = $$props.willRenderShapePresetToolbar);\r\n\t\tif ('annotateTools' in $$props) $$invalidate(13, annotateTools = $$props.annotateTools);\r\n\t\tif ('annotateToolShapes' in $$props) $$invalidate(14, annotateToolShapes = $$props.annotateToolShapes);\r\n\t\tif ('annotateShapeControls' in $$props) $$invalidate(15, annotateShapeControls = $$props.annotateShapeControls);\r\n\t\tif ('annotateActiveTool' in $$props) $$invalidate(0, annotateActiveTool = $$props.annotateActiveTool);\r\n\t\tif ('annotateEnableButtonFlipVertical' in $$props) $$invalidate(16, annotateEnableButtonFlipVertical = $$props.annotateEnableButtonFlipVertical);\r\n\t\tif ('annotateEnableSelectImagePreset' in $$props) $$invalidate(17, annotateEnableSelectImagePreset = $$props.annotateEnableSelectImagePreset);\r\n\t\tif ('annotateEnableDropImagePreset' in $$props) $$invalidate(18, annotateEnableDropImagePreset = $$props.annotateEnableDropImagePreset);\r\n\t\tif ('annotatePresets' in $$props) $$invalidate(19, annotatePresets = $$props.annotatePresets);\r\n\t\tif ('annotateWillRenderShapePresetToolbar' in $$props) $$invalidate(20, annotateWillRenderShapePresetToolbar = $$props.annotateWillRenderShapePresetToolbar);\r\n\t\tif ('markupEditorWillStartInteraction' in $$props) $$invalidate(21, markupEditorWillStartInteraction = $$props.markupEditorWillStartInteraction);\r\n\t\tif ('enableViewTool' in $$props) $$invalidate(22, enableViewTool = $$props.enableViewTool);\r\n\t\tif ('enableSelectToolToAddShape' in $$props) $$invalidate(23, enableSelectToolToAddShape = $$props.enableSelectToolToAddShape);\r\n\t\tif ('enableTapToAddText' in $$props) $$invalidate(24, enableTapToAddText = $$props.enableTapToAddText);\r\n\t\tif ('enableAutoSelectMoveTool' in $$props) $$invalidate(25, enableAutoSelectMoveTool = $$props.enableAutoSelectMoveTool);\r\n\t\tif ('enableMoveTool' in $$props) $$invalidate(26, enableMoveTool = $$props.enableMoveTool);\r\n\t\tif ('willRenderShapeControls' in $$props) $$invalidate(27, willRenderShapeControls = $$props.willRenderShapeControls);\r\n\t\tif ('beforeAddShape' in $$props) $$invalidate(28, beforeAddShape = $$props.beforeAddShape);\r\n\t\tif ('beforeRemoveShape' in $$props) $$invalidate(29, beforeRemoveShape = $$props.beforeRemoveShape);\r\n\t\tif ('beforeDeselectShape' in $$props) $$invalidate(30, beforeDeselectShape = $$props.beforeDeselectShape);\r\n\t\tif ('beforeSelectShape' in $$props) $$invalidate(31, beforeSelectShape = $$props.beforeSelectShape);\r\n\t\tif ('beforeUpdateShape' in $$props) $$invalidate(32, beforeUpdateShape = $$props.beforeUpdateShape);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[1] & /*$rootRect, $imageSize, $imageTransformsInterpolated, $imageTransforms, $imageFlipX, $imageFlipY*/ 983052) {\r\n\t\t\t//\r\n\t\t\t// Mapping coordinates\r\n\t\t\t//\r\n\t\t\t$$invalidate(36, mapScreenPointToImagePoint = point => _mapScreenPointToImagePoint(point, $rootRect, $imageSize, $imageTransformsInterpolated.origin, $imageTransformsInterpolated.translation, $imageTransforms.rotation.z, $imageTransformsInterpolated.scale, $imageFlipX, $imageFlipY));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$rootRect, $imageSize, $imageTransformsInterpolated, $imageTransforms, $imageFlipX, $imageFlipY*/ 983052) {\r\n\t\t\t$$invalidate(35, mapImagePointToScreenPoint = point => _mapImagePointToScreenPoint(point, $rootRect, $imageSize, $imageTransformsInterpolated.origin, $imageTransformsInterpolated.translation, $imageTransforms.rotation.z, $imageTransformsInterpolated.scale, $imageFlipX, $imageFlipY));\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tannotateActiveTool,\r\n\t\tisActive,\r\n\t\tisActiveFraction,\r\n\t\tisVisible,\r\n\t\tstores,\r\n\t\tlocale,\r\n\t\tmarkupEditorToolbar,\r\n\t\tmarkupEditorToolStyles,\r\n\t\tmarkupEditorToolRetainStyles,\r\n\t\tmarkupEditorShapeStyleControls,\r\n\t\tmarkupEditorToolSelectRadius,\r\n\t\tmarkupEditorTextInputMode,\r\n\t\twillRenderShapePresetToolbar,\r\n\t\tannotateTools,\r\n\t\tannotateToolShapes,\r\n\t\tannotateShapeControls,\r\n\t\tannotateEnableButtonFlipVertical,\r\n\t\tannotateEnableSelectImagePreset,\r\n\t\tannotateEnableDropImagePreset,\r\n\t\tannotatePresets,\r\n\t\tannotateWillRenderShapePresetToolbar,\r\n\t\tmarkupEditorWillStartInteraction,\r\n\t\tenableViewTool,\r\n\t\tenableSelectToolToAddShape,\r\n\t\tenableTapToAddText,\r\n\t\tenableAutoSelectMoveTool,\r\n\t\tenableMoveTool,\r\n\t\twillRenderShapeControls,\r\n\t\tbeforeAddShape,\r\n\t\tbeforeRemoveShape,\r\n\t\tbeforeDeselectShape,\r\n\t\tbeforeSelectShape,\r\n\t\tbeforeUpdateShape,\r\n\t\t$imageFlipY,\r\n\t\t$imageFlipX,\r\n\t\tmapImagePointToScreenPoint,\r\n\t\tmapScreenPointToImagePoint,\r\n\t\t$imageRotation,\r\n\t\trootRect,\r\n\t\timageAnnotation,\r\n\t\timageSize,\r\n\t\timageRotation,\r\n\t\timageFlipX,\r\n\t\timageFlipY,\r\n\t\timageTransforms,\r\n\t\timageTransformsInterpolated,\r\n\t\tname,\r\n\t\t$imageTransformsInterpolated,\r\n\t\t$imageTransforms,\r\n\t\t$imageSize,\r\n\t\t$rootRect,\r\n\t\tshapeutil_toolActive_binding,\r\n\t\tmeasure_handler\r\n\t];\r\n}\r\n\r\nclass Annotate extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$8,\r\n\t\t\tcreate_fragment$8,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tname: 46,\r\n\t\t\t\tisActive: 1,\r\n\t\t\t\tisActiveFraction: 2,\r\n\t\t\t\tisVisible: 3,\r\n\t\t\t\tstores: 4,\r\n\t\t\t\tlocale: 5,\r\n\t\t\t\tmarkupEditorToolbar: 6,\r\n\t\t\t\tmarkupEditorToolStyles: 7,\r\n\t\t\t\tmarkupEditorToolRetainStyles: 8,\r\n\t\t\t\tmarkupEditorShapeStyleControls: 9,\r\n\t\t\t\tmarkupEditorToolSelectRadius: 10,\r\n\t\t\t\tmarkupEditorTextInputMode: 11,\r\n\t\t\t\twillRenderShapePresetToolbar: 12,\r\n\t\t\t\tannotateTools: 13,\r\n\t\t\t\tannotateToolShapes: 14,\r\n\t\t\t\tannotateShapeControls: 15,\r\n\t\t\t\tannotateActiveTool: 0,\r\n\t\t\t\tannotateEnableButtonFlipVertical: 16,\r\n\t\t\t\tannotateEnableSelectImagePreset: 17,\r\n\t\t\t\tannotateEnableDropImagePreset: 18,\r\n\t\t\t\tannotatePresets: 19,\r\n\t\t\t\tannotateWillRenderShapePresetToolbar: 20,\r\n\t\t\t\tmarkupEditorWillStartInteraction: 21,\r\n\t\t\t\tenableViewTool: 22,\r\n\t\t\t\tenableSelectToolToAddShape: 23,\r\n\t\t\t\tenableTapToAddText: 24,\r\n\t\t\t\tenableAutoSelectMoveTool: 25,\r\n\t\t\t\tenableMoveTool: 26,\r\n\t\t\t\twillRenderShapeControls: 27,\r\n\t\t\t\tbeforeAddShape: 28,\r\n\t\t\t\tbeforeRemoveShape: 29,\r\n\t\t\t\tbeforeDeselectShape: 30,\r\n\t\t\t\tbeforeSelectShape: 31,\r\n\t\t\t\tbeforeUpdateShape: 32\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1]\r\n\t\t);\r\n\t}\r\n\r\n\tget name() {\r\n\t\treturn this.$$.ctx[46];\r\n\t}\r\n\r\n\tget isActive() {\r\n\t\treturn this.$$.ctx[1];\r\n\t}\r\n\r\n\tset isActive(isActive) {\r\n\t\tthis.$$set({ isActive });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget isActiveFraction() {\r\n\t\treturn this.$$.ctx[2];\r\n\t}\r\n\r\n\tset isActiveFraction(isActiveFraction) {\r\n\t\tthis.$$set({ isActiveFraction });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget isVisible() {\r\n\t\treturn this.$$.ctx[3];\r\n\t}\r\n\r\n\tset isVisible(isVisible) {\r\n\t\tthis.$$set({ isVisible });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stores() {\r\n\t\treturn this.$$.ctx[4];\r\n\t}\r\n\r\n\tset stores(stores) {\r\n\t\tthis.$$set({ stores });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget locale() {\r\n\t\treturn this.$$.ctx[5];\r\n\t}\r\n\r\n\tset locale(locale) {\r\n\t\tthis.$$set({ locale });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorToolbar() {\r\n\t\treturn this.$$.ctx[6];\r\n\t}\r\n\r\n\tset markupEditorToolbar(markupEditorToolbar) {\r\n\t\tthis.$$set({ markupEditorToolbar });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorToolStyles() {\r\n\t\treturn this.$$.ctx[7];\r\n\t}\r\n\r\n\tset markupEditorToolStyles(markupEditorToolStyles) {\r\n\t\tthis.$$set({ markupEditorToolStyles });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorToolRetainStyles() {\r\n\t\treturn this.$$.ctx[8];\r\n\t}\r\n\r\n\tset markupEditorToolRetainStyles(markupEditorToolRetainStyles) {\r\n\t\tthis.$$set({ markupEditorToolRetainStyles });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorShapeStyleControls() {\r\n\t\treturn this.$$.ctx[9];\r\n\t}\r\n\r\n\tset markupEditorShapeStyleControls(markupEditorShapeStyleControls) {\r\n\t\tthis.$$set({ markupEditorShapeStyleControls });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorToolSelectRadius() {\r\n\t\treturn this.$$.ctx[10];\r\n\t}\r\n\r\n\tset markupEditorToolSelectRadius(markupEditorToolSelectRadius) {\r\n\t\tthis.$$set({ markupEditorToolSelectRadius });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorTextInputMode() {\r\n\t\treturn this.$$.ctx[11];\r\n\t}\r\n\r\n\tset markupEditorTextInputMode(markupEditorTextInputMode) {\r\n\t\tthis.$$set({ markupEditorTextInputMode });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget willRenderShapePresetToolbar() {\r\n\t\treturn this.$$.ctx[12];\r\n\t}\r\n\r\n\tset willRenderShapePresetToolbar(willRenderShapePresetToolbar) {\r\n\t\tthis.$$set({ willRenderShapePresetToolbar });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget annotateTools() {\r\n\t\treturn this.$$.ctx[13];\r\n\t}\r\n\r\n\tset annotateTools(annotateTools) {\r\n\t\tthis.$$set({ annotateTools });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget annotateToolShapes() {\r\n\t\treturn this.$$.ctx[14];\r\n\t}\r\n\r\n\tset annotateToolShapes(annotateToolShapes) {\r\n\t\tthis.$$set({ annotateToolShapes });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget annotateShapeControls() {\r\n\t\treturn this.$$.ctx[15];\r\n\t}\r\n\r\n\tset annotateShapeControls(annotateShapeControls) {\r\n\t\tthis.$$set({ annotateShapeControls });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget annotateActiveTool() {\r\n\t\treturn this.$$.ctx[0];\r\n\t}\r\n\r\n\tset annotateActiveTool(annotateActiveTool) {\r\n\t\tthis.$$set({ annotateActiveTool });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget annotateEnableButtonFlipVertical() {\r\n\t\treturn this.$$.ctx[16];\r\n\t}\r\n\r\n\tset annotateEnableButtonFlipVertical(annotateEnableButtonFlipVertical) {\r\n\t\tthis.$$set({ annotateEnableButtonFlipVertical });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget annotateEnableSelectImagePreset() {\r\n\t\treturn this.$$.ctx[17];\r\n\t}\r\n\r\n\tset annotateEnableSelectImagePreset(annotateEnableSelectImagePreset) {\r\n\t\tthis.$$set({ annotateEnableSelectImagePreset });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget annotateEnableDropImagePreset() {\r\n\t\treturn this.$$.ctx[18];\r\n\t}\r\n\r\n\tset annotateEnableDropImagePreset(annotateEnableDropImagePreset) {\r\n\t\tthis.$$set({ annotateEnableDropImagePreset });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget annotatePresets() {\r\n\t\treturn this.$$.ctx[19];\r\n\t}\r\n\r\n\tset annotatePresets(annotatePresets) {\r\n\t\tthis.$$set({ annotatePresets });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget annotateWillRenderShapePresetToolbar() {\r\n\t\treturn this.$$.ctx[20];\r\n\t}\r\n\r\n\tset annotateWillRenderShapePresetToolbar(annotateWillRenderShapePresetToolbar) {\r\n\t\tthis.$$set({ annotateWillRenderShapePresetToolbar });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorWillStartInteraction() {\r\n\t\treturn this.$$.ctx[21];\r\n\t}\r\n\r\n\tset markupEditorWillStartInteraction(markupEditorWillStartInteraction) {\r\n\t\tthis.$$set({ markupEditorWillStartInteraction });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableViewTool() {\r\n\t\treturn this.$$.ctx[22];\r\n\t}\r\n\r\n\tset enableViewTool(enableViewTool) {\r\n\t\tthis.$$set({ enableViewTool });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableSelectToolToAddShape() {\r\n\t\treturn this.$$.ctx[23];\r\n\t}\r\n\r\n\tset enableSelectToolToAddShape(enableSelectToolToAddShape) {\r\n\t\tthis.$$set({ enableSelectToolToAddShape });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableTapToAddText() {\r\n\t\treturn this.$$.ctx[24];\r\n\t}\r\n\r\n\tset enableTapToAddText(enableTapToAddText) {\r\n\t\tthis.$$set({ enableTapToAddText });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableAutoSelectMoveTool() {\r\n\t\treturn this.$$.ctx[25];\r\n\t}\r\n\r\n\tset enableAutoSelectMoveTool(enableAutoSelectMoveTool) {\r\n\t\tthis.$$set({ enableAutoSelectMoveTool });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableMoveTool() {\r\n\t\treturn this.$$.ctx[26];\r\n\t}\r\n\r\n\tset enableMoveTool(enableMoveTool) {\r\n\t\tthis.$$set({ enableMoveTool });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget willRenderShapeControls() {\r\n\t\treturn this.$$.ctx[27];\r\n\t}\r\n\r\n\tset willRenderShapeControls(willRenderShapeControls) {\r\n\t\tthis.$$set({ willRenderShapeControls });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget beforeAddShape() {\r\n\t\treturn this.$$.ctx[28];\r\n\t}\r\n\r\n\tset beforeAddShape(beforeAddShape) {\r\n\t\tthis.$$set({ beforeAddShape });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget beforeRemoveShape() {\r\n\t\treturn this.$$.ctx[29];\r\n\t}\r\n\r\n\tset beforeRemoveShape(beforeRemoveShape) {\r\n\t\tthis.$$set({ beforeRemoveShape });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget beforeDeselectShape() {\r\n\t\treturn this.$$.ctx[30];\r\n\t}\r\n\r\n\tset beforeDeselectShape(beforeDeselectShape) {\r\n\t\tthis.$$set({ beforeDeselectShape });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget beforeSelectShape() {\r\n\t\treturn this.$$.ctx[31];\r\n\t}\r\n\r\n\tset beforeSelectShape(beforeSelectShape) {\r\n\t\tthis.$$set({ beforeSelectShape });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget beforeUpdateShape() {\r\n\t\treturn this.$$.ctx[32];\r\n\t}\r\n\r\n\tset beforeUpdateShape(beforeUpdateShape) {\r\n\t\tthis.$$set({ beforeUpdateShape });\r\n\t\tflush();\r\n\t}\r\n}\r\n\r\n// @ts-ignore\r\nvar _plugin_annotate = { util: ['annotate', Annotate, ({ duration }) => !duration] };\r\n\r\n/* src/core/ui/plugins/decorate/index.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$7(ctx) {\r\n\tlet shapeutil;\r\n\tlet updating_toolActive;\r\n\tlet current;\r\n\r\n\tfunction shapeutil_toolActive_binding(value) {\r\n\t\t/*shapeutil_toolActive_binding*/ ctx[43](value);\r\n\t}\r\n\r\n\tlet shapeutil_props = {\r\n\t\tstores: /*stores*/ ctx[4],\r\n\t\tlocale: /*locale*/ ctx[5],\r\n\t\tisActive: /*isActive*/ ctx[1],\r\n\t\tisActiveFraction: /*isActiveFraction*/ ctx[2],\r\n\t\tisVisible: /*isVisible*/ ctx[3],\r\n\t\tmapScreenPointToImagePoint: /*mapScreenPointToImagePoint*/ ctx[34],\r\n\t\tmapImagePointToScreenPoint: /*mapImagePointToScreenPoint*/ ctx[33],\r\n\t\tutilKey: 'decorate',\r\n\t\tshapes: /*imageDecoration*/ ctx[36],\r\n\t\ttoolbar: /*decorateTools*/ ctx[13] || /*markupEditorToolbar*/ ctx[6],\r\n\t\ttoolShapes: /*decorateToolShapes*/ ctx[14] || /*markupEditorToolStyles*/ ctx[7],\r\n\t\ttoolRetainStyles: /*markupEditorToolRetainStyles*/ ctx[8],\r\n\t\tshapeControls: /*decorateShapeControls*/ ctx[15] || /*markupEditorShapeStyleControls*/ ctx[9],\r\n\t\tshapePresets: /*decoratePresets*/ ctx[19],\r\n\t\tenableSelectToolToAddShape: /*enableSelectToolToAddShape*/ ctx[21],\r\n\t\tenableTapToAddText: /*enableTapToAddText*/ ctx[22],\r\n\t\tenableViewTool: /*enableViewTool*/ ctx[23],\r\n\t\tenableMoveTool: /*enableMoveTool*/ ctx[24],\r\n\t\tenableAutoSelectMoveTool: /*enableAutoSelectMoveTool*/ ctx[25],\r\n\t\tenablePresetSelectImage: /*decorateEnableSelectImagePreset*/ ctx[17],\r\n\t\tenablePresetDropImage: /*decorateEnableDropImagePreset*/ ctx[18],\r\n\t\tenableButtonFlipVertical: /*decorateEnableButtonFlipVertical*/ ctx[16],\r\n\t\tparentRect: /*imageCropRect*/ ctx[35],\r\n\t\ttoolSelectRadius: /*markupEditorToolSelectRadius*/ ctx[10],\r\n\t\ttextInputMode: /*markupEditorTextInputMode*/ ctx[11],\r\n\t\twillStartInteraction: /*markupEditorWillStartInteraction*/ ctx[32],\r\n\t\twillRenderPresetToolbar: /*decorateWillRenderShapePresetToolbar*/ ctx[20] || /*willRenderShapePresetToolbar*/ ctx[12],\r\n\t\thooks: {\r\n\t\t\twillRenderShapeControls: /*willRenderShapeControls*/ ctx[26],\r\n\t\t\tbeforeAddShape: /*beforeAddShape*/ ctx[27],\r\n\t\t\tbeforeRemoveShape: /*beforeRemoveShape*/ ctx[28],\r\n\t\t\tbeforeDeselectShape: /*beforeDeselectShape*/ ctx[29],\r\n\t\t\tbeforeSelectShape: /*beforeSelectShape*/ ctx[30],\r\n\t\t\tbeforeUpdateShape: /*beforeUpdateShape*/ ctx[31]\r\n\t\t}\r\n\t};\r\n\r\n\tif (/*decorateActiveTool*/ ctx[0] !== void 0) {\r\n\t\tshapeutil_props.toolActive = /*decorateActiveTool*/ ctx[0];\r\n\t}\r\n\r\n\tshapeutil = new ShapeUtil({ props: shapeutil_props });\r\n\tbinding_callbacks.push(() => bind(shapeutil, 'toolActive', shapeutil_toolActive_binding));\r\n\tshapeutil.$on(\"measure\", /*measure_handler*/ ctx[44]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(shapeutil.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(shapeutil, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst shapeutil_changes = {};\r\n\t\t\tif (dirty[0] & /*stores*/ 16) shapeutil_changes.stores = /*stores*/ ctx[4];\r\n\t\t\tif (dirty[0] & /*locale*/ 32) shapeutil_changes.locale = /*locale*/ ctx[5];\r\n\t\t\tif (dirty[0] & /*isActive*/ 2) shapeutil_changes.isActive = /*isActive*/ ctx[1];\r\n\t\t\tif (dirty[0] & /*isActiveFraction*/ 4) shapeutil_changes.isActiveFraction = /*isActiveFraction*/ ctx[2];\r\n\t\t\tif (dirty[0] & /*isVisible*/ 8) shapeutil_changes.isVisible = /*isVisible*/ ctx[3];\r\n\t\t\tif (dirty[1] & /*mapScreenPointToImagePoint*/ 8) shapeutil_changes.mapScreenPointToImagePoint = /*mapScreenPointToImagePoint*/ ctx[34];\r\n\t\t\tif (dirty[1] & /*mapImagePointToScreenPoint*/ 4) shapeutil_changes.mapImagePointToScreenPoint = /*mapImagePointToScreenPoint*/ ctx[33];\r\n\t\t\tif (dirty[0] & /*decorateTools, markupEditorToolbar*/ 8256) shapeutil_changes.toolbar = /*decorateTools*/ ctx[13] || /*markupEditorToolbar*/ ctx[6];\r\n\t\t\tif (dirty[0] & /*decorateToolShapes, markupEditorToolStyles*/ 16512) shapeutil_changes.toolShapes = /*decorateToolShapes*/ ctx[14] || /*markupEditorToolStyles*/ ctx[7];\r\n\t\t\tif (dirty[0] & /*markupEditorToolRetainStyles*/ 256) shapeutil_changes.toolRetainStyles = /*markupEditorToolRetainStyles*/ ctx[8];\r\n\t\t\tif (dirty[0] & /*decorateShapeControls, markupEditorShapeStyleControls*/ 33280) shapeutil_changes.shapeControls = /*decorateShapeControls*/ ctx[15] || /*markupEditorShapeStyleControls*/ ctx[9];\r\n\t\t\tif (dirty[0] & /*decoratePresets*/ 524288) shapeutil_changes.shapePresets = /*decoratePresets*/ ctx[19];\r\n\t\t\tif (dirty[0] & /*enableSelectToolToAddShape*/ 2097152) shapeutil_changes.enableSelectToolToAddShape = /*enableSelectToolToAddShape*/ ctx[21];\r\n\t\t\tif (dirty[0] & /*enableTapToAddText*/ 4194304) shapeutil_changes.enableTapToAddText = /*enableTapToAddText*/ ctx[22];\r\n\t\t\tif (dirty[0] & /*enableViewTool*/ 8388608) shapeutil_changes.enableViewTool = /*enableViewTool*/ ctx[23];\r\n\t\t\tif (dirty[0] & /*enableMoveTool*/ 16777216) shapeutil_changes.enableMoveTool = /*enableMoveTool*/ ctx[24];\r\n\t\t\tif (dirty[0] & /*enableAutoSelectMoveTool*/ 33554432) shapeutil_changes.enableAutoSelectMoveTool = /*enableAutoSelectMoveTool*/ ctx[25];\r\n\t\t\tif (dirty[0] & /*decorateEnableSelectImagePreset*/ 131072) shapeutil_changes.enablePresetSelectImage = /*decorateEnableSelectImagePreset*/ ctx[17];\r\n\t\t\tif (dirty[0] & /*decorateEnableDropImagePreset*/ 262144) shapeutil_changes.enablePresetDropImage = /*decorateEnableDropImagePreset*/ ctx[18];\r\n\t\t\tif (dirty[0] & /*decorateEnableButtonFlipVertical*/ 65536) shapeutil_changes.enableButtonFlipVertical = /*decorateEnableButtonFlipVertical*/ ctx[16];\r\n\t\t\tif (dirty[0] & /*markupEditorToolSelectRadius*/ 1024) shapeutil_changes.toolSelectRadius = /*markupEditorToolSelectRadius*/ ctx[10];\r\n\t\t\tif (dirty[0] & /*markupEditorTextInputMode*/ 2048) shapeutil_changes.textInputMode = /*markupEditorTextInputMode*/ ctx[11];\r\n\t\t\tif (dirty[1] & /*markupEditorWillStartInteraction*/ 2) shapeutil_changes.willStartInteraction = /*markupEditorWillStartInteraction*/ ctx[32];\r\n\t\t\tif (dirty[0] & /*decorateWillRenderShapePresetToolbar, willRenderShapePresetToolbar*/ 1052672) shapeutil_changes.willRenderPresetToolbar = /*decorateWillRenderShapePresetToolbar*/ ctx[20] || /*willRenderShapePresetToolbar*/ ctx[12];\r\n\r\n\t\t\tif (dirty[0] & /*willRenderShapeControls, beforeAddShape, beforeRemoveShape, beforeDeselectShape, beforeSelectShape*/ 2080374784 | dirty[1] & /*beforeUpdateShape*/ 1) shapeutil_changes.hooks = {\r\n\t\t\t\twillRenderShapeControls: /*willRenderShapeControls*/ ctx[26],\r\n\t\t\t\tbeforeAddShape: /*beforeAddShape*/ ctx[27],\r\n\t\t\t\tbeforeRemoveShape: /*beforeRemoveShape*/ ctx[28],\r\n\t\t\t\tbeforeDeselectShape: /*beforeDeselectShape*/ ctx[29],\r\n\t\t\t\tbeforeSelectShape: /*beforeSelectShape*/ ctx[30],\r\n\t\t\t\tbeforeUpdateShape: /*beforeUpdateShape*/ ctx[31]\r\n\t\t\t};\r\n\r\n\t\t\tif (!updating_toolActive && dirty[0] & /*decorateActiveTool*/ 1) {\r\n\t\t\t\tupdating_toolActive = true;\r\n\t\t\t\tshapeutil_changes.toolActive = /*decorateActiveTool*/ ctx[0];\r\n\t\t\t\tadd_flush_callback(() => updating_toolActive = false);\r\n\t\t\t}\r\n\r\n\t\t\tshapeutil.$set(shapeutil_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(shapeutil.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(shapeutil.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(shapeutil, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$7($$self, $$props, $$invalidate) {\r\n\tlet presentationZoom;\r\n\tlet mapScreenPointToImagePoint;\r\n\tlet mapImagePointToScreenPoint;\r\n\tlet $imageSelectionRectPresentation;\r\n\tlet $imageTransformsInterpolated;\r\n\tconst name = 'decorate';\r\n\tlet { isActive } = $$props;\r\n\tlet { isActiveFraction } = $$props;\r\n\tlet { isVisible } = $$props;\r\n\tlet { stores } = $$props;\r\n\tlet { locale = {} } = $$props;\r\n\tlet { markupEditorToolbar = undefined } = $$props;\r\n\tlet { markupEditorToolStyles = undefined } = $$props;\r\n\tlet { markupEditorToolRetainStyles = undefined } = $$props;\r\n\tlet { markupEditorShapeStyleControls = undefined } = $$props;\r\n\tlet { markupEditorToolSelectRadius = undefined } = $$props;\r\n\tlet { markupEditorTextInputMode = undefined } = $$props;\r\n\tlet { willRenderShapePresetToolbar = undefined } = $$props;\r\n\tlet { decorateTools = undefined } = $$props;\r\n\tlet { decorateToolShapes = undefined } = $$props;\r\n\tlet { decorateShapeControls = undefined } = $$props;\r\n\tlet { decorateActiveTool = undefined } = $$props;\r\n\tlet { decorateEnableButtonFlipVertical = false } = $$props;\r\n\tlet { decorateEnableSelectImagePreset = false } = $$props;\r\n\tlet { decorateEnableDropImagePreset = true } = $$props;\r\n\tlet { decoratePresets = [] } = $$props;\r\n\tlet { decorateWillRenderShapePresetToolbar = undefined } = $$props;\r\n\tlet { enableSelectToolToAddShape = undefined } = $$props;\r\n\tlet { enableTapToAddText = undefined } = $$props;\r\n\tlet { enableViewTool = undefined } = $$props;\r\n\tlet { enableMoveTool = undefined } = $$props;\r\n\tlet { enableAutoSelectMoveTool = undefined } = $$props;\r\n\tlet { willRenderShapeControls = undefined } = $$props;\r\n\tlet { beforeAddShape = undefined } = $$props;\r\n\tlet { beforeRemoveShape = undefined } = $$props;\r\n\tlet { beforeDeselectShape = undefined } = $$props;\r\n\tlet { beforeSelectShape = undefined } = $$props;\r\n\tlet { beforeUpdateShape = undefined } = $$props;\r\n\tlet { markupEditorWillStartInteraction = undefined } = $$props;\r\n\tconst { imageCropRect, imageDecoration, imageSelectionRectPresentation, imageTransformsInterpolated } = stores;\r\n\tcomponent_subscribe($$self, imageSelectionRectPresentation, value => $$invalidate(41, $imageSelectionRectPresentation = value));\r\n\tcomponent_subscribe($$self, imageTransformsInterpolated, value => $$invalidate(42, $imageTransformsInterpolated = value));\r\n\r\n\tfunction shapeutil_toolActive_binding(value) {\r\n\t\tdecorateActiveTool = value;\r\n\t\t$$invalidate(0, decorateActiveTool);\r\n\t}\r\n\r\n\tfunction measure_handler(event) {\r\n\t\tbubble.call(this, $$self, event);\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('isActive' in $$props) $$invalidate(1, isActive = $$props.isActive);\r\n\t\tif ('isActiveFraction' in $$props) $$invalidate(2, isActiveFraction = $$props.isActiveFraction);\r\n\t\tif ('isVisible' in $$props) $$invalidate(3, isVisible = $$props.isVisible);\r\n\t\tif ('stores' in $$props) $$invalidate(4, stores = $$props.stores);\r\n\t\tif ('locale' in $$props) $$invalidate(5, locale = $$props.locale);\r\n\t\tif ('markupEditorToolbar' in $$props) $$invalidate(6, markupEditorToolbar = $$props.markupEditorToolbar);\r\n\t\tif ('markupEditorToolStyles' in $$props) $$invalidate(7, markupEditorToolStyles = $$props.markupEditorToolStyles);\r\n\t\tif ('markupEditorToolRetainStyles' in $$props) $$invalidate(8, markupEditorToolRetainStyles = $$props.markupEditorToolRetainStyles);\r\n\t\tif ('markupEditorShapeStyleControls' in $$props) $$invalidate(9, markupEditorShapeStyleControls = $$props.markupEditorShapeStyleControls);\r\n\t\tif ('markupEditorToolSelectRadius' in $$props) $$invalidate(10, markupEditorToolSelectRadius = $$props.markupEditorToolSelectRadius);\r\n\t\tif ('markupEditorTextInputMode' in $$props) $$invalidate(11, markupEditorTextInputMode = $$props.markupEditorTextInputMode);\r\n\t\tif ('willRenderShapePresetToolbar' in $$props) $$invalidate(12, willRenderShapePresetToolbar = $$props.willRenderShapePresetToolbar);\r\n\t\tif ('decorateTools' in $$props) $$invalidate(13, decorateTools = $$props.decorateTools);\r\n\t\tif ('decorateToolShapes' in $$props) $$invalidate(14, decorateToolShapes = $$props.decorateToolShapes);\r\n\t\tif ('decorateShapeControls' in $$props) $$invalidate(15, decorateShapeControls = $$props.decorateShapeControls);\r\n\t\tif ('decorateActiveTool' in $$props) $$invalidate(0, decorateActiveTool = $$props.decorateActiveTool);\r\n\t\tif ('decorateEnableButtonFlipVertical' in $$props) $$invalidate(16, decorateEnableButtonFlipVertical = $$props.decorateEnableButtonFlipVertical);\r\n\t\tif ('decorateEnableSelectImagePreset' in $$props) $$invalidate(17, decorateEnableSelectImagePreset = $$props.decorateEnableSelectImagePreset);\r\n\t\tif ('decorateEnableDropImagePreset' in $$props) $$invalidate(18, decorateEnableDropImagePreset = $$props.decorateEnableDropImagePreset);\r\n\t\tif ('decoratePresets' in $$props) $$invalidate(19, decoratePresets = $$props.decoratePresets);\r\n\t\tif ('decorateWillRenderShapePresetToolbar' in $$props) $$invalidate(20, decorateWillRenderShapePresetToolbar = $$props.decorateWillRenderShapePresetToolbar);\r\n\t\tif ('enableSelectToolToAddShape' in $$props) $$invalidate(21, enableSelectToolToAddShape = $$props.enableSelectToolToAddShape);\r\n\t\tif ('enableTapToAddText' in $$props) $$invalidate(22, enableTapToAddText = $$props.enableTapToAddText);\r\n\t\tif ('enableViewTool' in $$props) $$invalidate(23, enableViewTool = $$props.enableViewTool);\r\n\t\tif ('enableMoveTool' in $$props) $$invalidate(24, enableMoveTool = $$props.enableMoveTool);\r\n\t\tif ('enableAutoSelectMoveTool' in $$props) $$invalidate(25, enableAutoSelectMoveTool = $$props.enableAutoSelectMoveTool);\r\n\t\tif ('willRenderShapeControls' in $$props) $$invalidate(26, willRenderShapeControls = $$props.willRenderShapeControls);\r\n\t\tif ('beforeAddShape' in $$props) $$invalidate(27, beforeAddShape = $$props.beforeAddShape);\r\n\t\tif ('beforeRemoveShape' in $$props) $$invalidate(28, beforeRemoveShape = $$props.beforeRemoveShape);\r\n\t\tif ('beforeDeselectShape' in $$props) $$invalidate(29, beforeDeselectShape = $$props.beforeDeselectShape);\r\n\t\tif ('beforeSelectShape' in $$props) $$invalidate(30, beforeSelectShape = $$props.beforeSelectShape);\r\n\t\tif ('beforeUpdateShape' in $$props) $$invalidate(31, beforeUpdateShape = $$props.beforeUpdateShape);\r\n\t\tif ('markupEditorWillStartInteraction' in $$props) $$invalidate(32, markupEditorWillStartInteraction = $$props.markupEditorWillStartInteraction);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[1] & /*$imageTransformsInterpolated*/ 2048) {\r\n\t\t\t$$invalidate(40, presentationZoom = $imageTransformsInterpolated\r\n\t\t\t? $imageTransformsInterpolated.scale\r\n\t\t\t: 1);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$imageSelectionRectPresentation, presentationZoom*/ 1536) {\r\n\t\t\t$$invalidate(34, mapScreenPointToImagePoint = screenPoint => {\r\n\t\t\t\tconst mappedPoint = vectorClone(screenPoint);\r\n\t\t\t\tmappedPoint.x -= $imageSelectionRectPresentation.x;\r\n\t\t\t\tmappedPoint.y -= $imageSelectionRectPresentation.y;\r\n\t\t\t\tmappedPoint.x /= presentationZoom;\r\n\t\t\t\tmappedPoint.y /= presentationZoom;\r\n\t\t\t\treturn mappedPoint;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*presentationZoom, $imageSelectionRectPresentation*/ 1536) {\r\n\t\t\t$$invalidate(33, mapImagePointToScreenPoint = imagePoint => {\r\n\t\t\t\tconst mappedPoint = vectorClone(imagePoint);\r\n\t\t\t\tmappedPoint.x *= presentationZoom;\r\n\t\t\t\tmappedPoint.y *= presentationZoom;\r\n\t\t\t\tmappedPoint.x += $imageSelectionRectPresentation.x;\r\n\t\t\t\tmappedPoint.y += $imageSelectionRectPresentation.y;\r\n\t\t\t\treturn mappedPoint;\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tdecorateActiveTool,\r\n\t\tisActive,\r\n\t\tisActiveFraction,\r\n\t\tisVisible,\r\n\t\tstores,\r\n\t\tlocale,\r\n\t\tmarkupEditorToolbar,\r\n\t\tmarkupEditorToolStyles,\r\n\t\tmarkupEditorToolRetainStyles,\r\n\t\tmarkupEditorShapeStyleControls,\r\n\t\tmarkupEditorToolSelectRadius,\r\n\t\tmarkupEditorTextInputMode,\r\n\t\twillRenderShapePresetToolbar,\r\n\t\tdecorateTools,\r\n\t\tdecorateToolShapes,\r\n\t\tdecorateShapeControls,\r\n\t\tdecorateEnableButtonFlipVertical,\r\n\t\tdecorateEnableSelectImagePreset,\r\n\t\tdecorateEnableDropImagePreset,\r\n\t\tdecoratePresets,\r\n\t\tdecorateWillRenderShapePresetToolbar,\r\n\t\tenableSelectToolToAddShape,\r\n\t\tenableTapToAddText,\r\n\t\tenableViewTool,\r\n\t\tenableMoveTool,\r\n\t\tenableAutoSelectMoveTool,\r\n\t\twillRenderShapeControls,\r\n\t\tbeforeAddShape,\r\n\t\tbeforeRemoveShape,\r\n\t\tbeforeDeselectShape,\r\n\t\tbeforeSelectShape,\r\n\t\tbeforeUpdateShape,\r\n\t\tmarkupEditorWillStartInteraction,\r\n\t\tmapImagePointToScreenPoint,\r\n\t\tmapScreenPointToImagePoint,\r\n\t\timageCropRect,\r\n\t\timageDecoration,\r\n\t\timageSelectionRectPresentation,\r\n\t\timageTransformsInterpolated,\r\n\t\tname,\r\n\t\tpresentationZoom,\r\n\t\t$imageSelectionRectPresentation,\r\n\t\t$imageTransformsInterpolated,\r\n\t\tshapeutil_toolActive_binding,\r\n\t\tmeasure_handler\r\n\t];\r\n}\r\n\r\nclass Decorate extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$7,\r\n\t\t\tcreate_fragment$7,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tname: 39,\r\n\t\t\t\tisActive: 1,\r\n\t\t\t\tisActiveFraction: 2,\r\n\t\t\t\tisVisible: 3,\r\n\t\t\t\tstores: 4,\r\n\t\t\t\tlocale: 5,\r\n\t\t\t\tmarkupEditorToolbar: 6,\r\n\t\t\t\tmarkupEditorToolStyles: 7,\r\n\t\t\t\tmarkupEditorToolRetainStyles: 8,\r\n\t\t\t\tmarkupEditorShapeStyleControls: 9,\r\n\t\t\t\tmarkupEditorToolSelectRadius: 10,\r\n\t\t\t\tmarkupEditorTextInputMode: 11,\r\n\t\t\t\twillRenderShapePresetToolbar: 12,\r\n\t\t\t\tdecorateTools: 13,\r\n\t\t\t\tdecorateToolShapes: 14,\r\n\t\t\t\tdecorateShapeControls: 15,\r\n\t\t\t\tdecorateActiveTool: 0,\r\n\t\t\t\tdecorateEnableButtonFlipVertical: 16,\r\n\t\t\t\tdecorateEnableSelectImagePreset: 17,\r\n\t\t\t\tdecorateEnableDropImagePreset: 18,\r\n\t\t\t\tdecoratePresets: 19,\r\n\t\t\t\tdecorateWillRenderShapePresetToolbar: 20,\r\n\t\t\t\tenableSelectToolToAddShape: 21,\r\n\t\t\t\tenableTapToAddText: 22,\r\n\t\t\t\tenableViewTool: 23,\r\n\t\t\t\tenableMoveTool: 24,\r\n\t\t\t\tenableAutoSelectMoveTool: 25,\r\n\t\t\t\twillRenderShapeControls: 26,\r\n\t\t\t\tbeforeAddShape: 27,\r\n\t\t\t\tbeforeRemoveShape: 28,\r\n\t\t\t\tbeforeDeselectShape: 29,\r\n\t\t\t\tbeforeSelectShape: 30,\r\n\t\t\t\tbeforeUpdateShape: 31,\r\n\t\t\t\tmarkupEditorWillStartInteraction: 32\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1]\r\n\t\t);\r\n\t}\r\n\r\n\tget name() {\r\n\t\treturn this.$$.ctx[39];\r\n\t}\r\n\r\n\tget isActive() {\r\n\t\treturn this.$$.ctx[1];\r\n\t}\r\n\r\n\tset isActive(isActive) {\r\n\t\tthis.$$set({ isActive });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget isActiveFraction() {\r\n\t\treturn this.$$.ctx[2];\r\n\t}\r\n\r\n\tset isActiveFraction(isActiveFraction) {\r\n\t\tthis.$$set({ isActiveFraction });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget isVisible() {\r\n\t\treturn this.$$.ctx[3];\r\n\t}\r\n\r\n\tset isVisible(isVisible) {\r\n\t\tthis.$$set({ isVisible });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stores() {\r\n\t\treturn this.$$.ctx[4];\r\n\t}\r\n\r\n\tset stores(stores) {\r\n\t\tthis.$$set({ stores });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget locale() {\r\n\t\treturn this.$$.ctx[5];\r\n\t}\r\n\r\n\tset locale(locale) {\r\n\t\tthis.$$set({ locale });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorToolbar() {\r\n\t\treturn this.$$.ctx[6];\r\n\t}\r\n\r\n\tset markupEditorToolbar(markupEditorToolbar) {\r\n\t\tthis.$$set({ markupEditorToolbar });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorToolStyles() {\r\n\t\treturn this.$$.ctx[7];\r\n\t}\r\n\r\n\tset markupEditorToolStyles(markupEditorToolStyles) {\r\n\t\tthis.$$set({ markupEditorToolStyles });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorToolRetainStyles() {\r\n\t\treturn this.$$.ctx[8];\r\n\t}\r\n\r\n\tset markupEditorToolRetainStyles(markupEditorToolRetainStyles) {\r\n\t\tthis.$$set({ markupEditorToolRetainStyles });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorShapeStyleControls() {\r\n\t\treturn this.$$.ctx[9];\r\n\t}\r\n\r\n\tset markupEditorShapeStyleControls(markupEditorShapeStyleControls) {\r\n\t\tthis.$$set({ markupEditorShapeStyleControls });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorToolSelectRadius() {\r\n\t\treturn this.$$.ctx[10];\r\n\t}\r\n\r\n\tset markupEditorToolSelectRadius(markupEditorToolSelectRadius) {\r\n\t\tthis.$$set({ markupEditorToolSelectRadius });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorTextInputMode() {\r\n\t\treturn this.$$.ctx[11];\r\n\t}\r\n\r\n\tset markupEditorTextInputMode(markupEditorTextInputMode) {\r\n\t\tthis.$$set({ markupEditorTextInputMode });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget willRenderShapePresetToolbar() {\r\n\t\treturn this.$$.ctx[12];\r\n\t}\r\n\r\n\tset willRenderShapePresetToolbar(willRenderShapePresetToolbar) {\r\n\t\tthis.$$set({ willRenderShapePresetToolbar });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget decorateTools() {\r\n\t\treturn this.$$.ctx[13];\r\n\t}\r\n\r\n\tset decorateTools(decorateTools) {\r\n\t\tthis.$$set({ decorateTools });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget decorateToolShapes() {\r\n\t\treturn this.$$.ctx[14];\r\n\t}\r\n\r\n\tset decorateToolShapes(decorateToolShapes) {\r\n\t\tthis.$$set({ decorateToolShapes });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget decorateShapeControls() {\r\n\t\treturn this.$$.ctx[15];\r\n\t}\r\n\r\n\tset decorateShapeControls(decorateShapeControls) {\r\n\t\tthis.$$set({ decorateShapeControls });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget decorateActiveTool() {\r\n\t\treturn this.$$.ctx[0];\r\n\t}\r\n\r\n\tset decorateActiveTool(decorateActiveTool) {\r\n\t\tthis.$$set({ decorateActiveTool });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget decorateEnableButtonFlipVertical() {\r\n\t\treturn this.$$.ctx[16];\r\n\t}\r\n\r\n\tset decorateEnableButtonFlipVertical(decorateEnableButtonFlipVertical) {\r\n\t\tthis.$$set({ decorateEnableButtonFlipVertical });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget decorateEnableSelectImagePreset() {\r\n\t\treturn this.$$.ctx[17];\r\n\t}\r\n\r\n\tset decorateEnableSelectImagePreset(decorateEnableSelectImagePreset) {\r\n\t\tthis.$$set({ decorateEnableSelectImagePreset });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget decorateEnableDropImagePreset() {\r\n\t\treturn this.$$.ctx[18];\r\n\t}\r\n\r\n\tset decorateEnableDropImagePreset(decorateEnableDropImagePreset) {\r\n\t\tthis.$$set({ decorateEnableDropImagePreset });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget decoratePresets() {\r\n\t\treturn this.$$.ctx[19];\r\n\t}\r\n\r\n\tset decoratePresets(decoratePresets) {\r\n\t\tthis.$$set({ decoratePresets });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget decorateWillRenderShapePresetToolbar() {\r\n\t\treturn this.$$.ctx[20];\r\n\t}\r\n\r\n\tset decorateWillRenderShapePresetToolbar(decorateWillRenderShapePresetToolbar) {\r\n\t\tthis.$$set({ decorateWillRenderShapePresetToolbar });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableSelectToolToAddShape() {\r\n\t\treturn this.$$.ctx[21];\r\n\t}\r\n\r\n\tset enableSelectToolToAddShape(enableSelectToolToAddShape) {\r\n\t\tthis.$$set({ enableSelectToolToAddShape });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableTapToAddText() {\r\n\t\treturn this.$$.ctx[22];\r\n\t}\r\n\r\n\tset enableTapToAddText(enableTapToAddText) {\r\n\t\tthis.$$set({ enableTapToAddText });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableViewTool() {\r\n\t\treturn this.$$.ctx[23];\r\n\t}\r\n\r\n\tset enableViewTool(enableViewTool) {\r\n\t\tthis.$$set({ enableViewTool });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableMoveTool() {\r\n\t\treturn this.$$.ctx[24];\r\n\t}\r\n\r\n\tset enableMoveTool(enableMoveTool) {\r\n\t\tthis.$$set({ enableMoveTool });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget enableAutoSelectMoveTool() {\r\n\t\treturn this.$$.ctx[25];\r\n\t}\r\n\r\n\tset enableAutoSelectMoveTool(enableAutoSelectMoveTool) {\r\n\t\tthis.$$set({ enableAutoSelectMoveTool });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget willRenderShapeControls() {\r\n\t\treturn this.$$.ctx[26];\r\n\t}\r\n\r\n\tset willRenderShapeControls(willRenderShapeControls) {\r\n\t\tthis.$$set({ willRenderShapeControls });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget beforeAddShape() {\r\n\t\treturn this.$$.ctx[27];\r\n\t}\r\n\r\n\tset beforeAddShape(beforeAddShape) {\r\n\t\tthis.$$set({ beforeAddShape });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget beforeRemoveShape() {\r\n\t\treturn this.$$.ctx[28];\r\n\t}\r\n\r\n\tset beforeRemoveShape(beforeRemoveShape) {\r\n\t\tthis.$$set({ beforeRemoveShape });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget beforeDeselectShape() {\r\n\t\treturn this.$$.ctx[29];\r\n\t}\r\n\r\n\tset beforeDeselectShape(beforeDeselectShape) {\r\n\t\tthis.$$set({ beforeDeselectShape });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget beforeSelectShape() {\r\n\t\treturn this.$$.ctx[30];\r\n\t}\r\n\r\n\tset beforeSelectShape(beforeSelectShape) {\r\n\t\tthis.$$set({ beforeSelectShape });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget beforeUpdateShape() {\r\n\t\treturn this.$$.ctx[31];\r\n\t}\r\n\r\n\tset beforeUpdateShape(beforeUpdateShape) {\r\n\t\tthis.$$set({ beforeUpdateShape });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorWillStartInteraction() {\r\n\t\treturn this.$$.ctx[32];\r\n\t}\r\n\r\n\tset markupEditorWillStartInteraction(markupEditorWillStartInteraction) {\r\n\t\tthis.$$set({ markupEditorWillStartInteraction });\r\n\t\tflush();\r\n\t}\r\n}\r\n\r\n// @ts-ignore\r\nvar _plugin_decorate = { util: ['decorate', Decorate, ({ duration }) => !duration] };\r\n\r\n/* src/core/ui/plugins/sticker/index.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$6(ctx) {\r\n\tlet shapeutil;\r\n\tlet current;\r\n\r\n\tshapeutil = new ShapeUtil({\r\n\t\t\tprops: {\r\n\t\t\t\tstores: /*stores*/ ctx[3],\r\n\t\t\t\tlocale: /*locale*/ ctx[4],\r\n\t\t\t\tisActive: /*isActive*/ ctx[0],\r\n\t\t\t\tisActiveFraction: /*isActiveFraction*/ ctx[1],\r\n\t\t\t\tisVisible: /*isVisible*/ ctx[2],\r\n\t\t\t\tmapScreenPointToImagePoint: /*mapScreenPointToImagePoint*/ ctx[24],\r\n\t\t\t\tmapImagePointToScreenPoint: /*mapImagePointToScreenPoint*/ ctx[23],\r\n\t\t\t\tutilKey: 'sticker',\r\n\t\t\t\tshapePresets: /*stickers*/ ctx[5],\r\n\t\t\t\tshapes: /*stickerStickToImage*/ ctx[6]\r\n\t\t\t\t? /*imageAnnotation*/ ctx[30]\r\n\t\t\t\t: /*imageDecoration*/ ctx[31],\r\n\t\t\t\ttoolActive: 'preset',\r\n\t\t\t\timageFlipX: /*stickerStickToImage*/ ctx[6]\r\n\t\t\t\t? /*$imageFlipX*/ ctx[22]\r\n\t\t\t\t: false,\r\n\t\t\t\timageFlipY: /*stickerStickToImage*/ ctx[6]\r\n\t\t\t\t? /*$imageFlipY*/ ctx[21]\r\n\t\t\t\t: false,\r\n\t\t\t\timageRotation: /*stickerStickToImage*/ ctx[6]\r\n\t\t\t\t? /*$imageRotation*/ ctx[26]\r\n\t\t\t\t: 0,\r\n\t\t\t\tparentRect: /*stickerStickToImage*/ ctx[6]\r\n\t\t\t\t? /*imageSize*/ ctx[32]\r\n\t\t\t\t: /*imageCropRect*/ ctx[28],\r\n\t\t\t\tenablePresetDropImage: /*stickerEnableDropImagePreset*/ ctx[7],\r\n\t\t\t\tenablePresetSelectImage: /*enablePresetSelectImage*/ ctx[25],\r\n\t\t\t\tenableButtonFlipVertical: /*stickersEnableButtonFlipVertical*/ ctx[10] || /*stickerEnableButtonFlipVertical*/ ctx[8],\r\n\t\t\t\ttoolSelectRadius: /*markupEditorToolSelectRadius*/ ctx[13],\r\n\t\t\t\twillStartInteraction: /*markupEditorWillStartInteraction*/ ctx[20],\r\n\t\t\t\twillRenderPresetToolbar: /*stickersWillRenderShapePresetToolbar*/ ctx[11] || /*stickerWillRenderShapePresetToolbar*/ ctx[9] || /*willRenderShapePresetToolbar*/ ctx[14],\r\n\t\t\t\thooks: {\r\n\t\t\t\t\twillRenderShapeControls: /*willRenderShapeControls*/ ctx[12],\r\n\t\t\t\t\tbeforeAddShape: /*beforeAddShape*/ ctx[15],\r\n\t\t\t\t\tbeforeRemoveShape: /*beforeRemoveShape*/ ctx[16],\r\n\t\t\t\t\tbeforeDeselectShape: /*beforeDeselectShape*/ ctx[17],\r\n\t\t\t\t\tbeforeSelectShape: /*beforeSelectShape*/ ctx[18],\r\n\t\t\t\t\tbeforeUpdateShape: /*beforeUpdateShape*/ ctx[19]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tshapeutil.$on(\"measure\", /*measure_handler*/ ctx[47]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(shapeutil.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(shapeutil, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst shapeutil_changes = {};\r\n\t\t\tif (dirty[0] & /*stores*/ 8) shapeutil_changes.stores = /*stores*/ ctx[3];\r\n\t\t\tif (dirty[0] & /*locale*/ 16) shapeutil_changes.locale = /*locale*/ ctx[4];\r\n\t\t\tif (dirty[0] & /*isActive*/ 1) shapeutil_changes.isActive = /*isActive*/ ctx[0];\r\n\t\t\tif (dirty[0] & /*isActiveFraction*/ 2) shapeutil_changes.isActiveFraction = /*isActiveFraction*/ ctx[1];\r\n\t\t\tif (dirty[0] & /*isVisible*/ 4) shapeutil_changes.isVisible = /*isVisible*/ ctx[2];\r\n\t\t\tif (dirty[0] & /*mapScreenPointToImagePoint*/ 16777216) shapeutil_changes.mapScreenPointToImagePoint = /*mapScreenPointToImagePoint*/ ctx[24];\r\n\t\t\tif (dirty[0] & /*mapImagePointToScreenPoint*/ 8388608) shapeutil_changes.mapImagePointToScreenPoint = /*mapImagePointToScreenPoint*/ ctx[23];\r\n\t\t\tif (dirty[0] & /*stickers*/ 32) shapeutil_changes.shapePresets = /*stickers*/ ctx[5];\r\n\r\n\t\t\tif (dirty[0] & /*stickerStickToImage*/ 64) shapeutil_changes.shapes = /*stickerStickToImage*/ ctx[6]\r\n\t\t\t? /*imageAnnotation*/ ctx[30]\r\n\t\t\t: /*imageDecoration*/ ctx[31];\r\n\r\n\t\t\tif (dirty[0] & /*stickerStickToImage, $imageFlipX*/ 4194368) shapeutil_changes.imageFlipX = /*stickerStickToImage*/ ctx[6]\r\n\t\t\t? /*$imageFlipX*/ ctx[22]\r\n\t\t\t: false;\r\n\r\n\t\t\tif (dirty[0] & /*stickerStickToImage, $imageFlipY*/ 2097216) shapeutil_changes.imageFlipY = /*stickerStickToImage*/ ctx[6]\r\n\t\t\t? /*$imageFlipY*/ ctx[21]\r\n\t\t\t: false;\r\n\r\n\t\t\tif (dirty[0] & /*stickerStickToImage, $imageRotation*/ 67108928) shapeutil_changes.imageRotation = /*stickerStickToImage*/ ctx[6]\r\n\t\t\t? /*$imageRotation*/ ctx[26]\r\n\t\t\t: 0;\r\n\r\n\t\t\tif (dirty[0] & /*stickerStickToImage*/ 64) shapeutil_changes.parentRect = /*stickerStickToImage*/ ctx[6]\r\n\t\t\t? /*imageSize*/ ctx[32]\r\n\t\t\t: /*imageCropRect*/ ctx[28];\r\n\r\n\t\t\tif (dirty[0] & /*stickerEnableDropImagePreset*/ 128) shapeutil_changes.enablePresetDropImage = /*stickerEnableDropImagePreset*/ ctx[7];\r\n\t\t\tif (dirty[0] & /*enablePresetSelectImage*/ 33554432) shapeutil_changes.enablePresetSelectImage = /*enablePresetSelectImage*/ ctx[25];\r\n\t\t\tif (dirty[0] & /*stickersEnableButtonFlipVertical, stickerEnableButtonFlipVertical*/ 1280) shapeutil_changes.enableButtonFlipVertical = /*stickersEnableButtonFlipVertical*/ ctx[10] || /*stickerEnableButtonFlipVertical*/ ctx[8];\r\n\t\t\tif (dirty[0] & /*markupEditorToolSelectRadius*/ 8192) shapeutil_changes.toolSelectRadius = /*markupEditorToolSelectRadius*/ ctx[13];\r\n\t\t\tif (dirty[0] & /*markupEditorWillStartInteraction*/ 1048576) shapeutil_changes.willStartInteraction = /*markupEditorWillStartInteraction*/ ctx[20];\r\n\t\t\tif (dirty[0] & /*stickersWillRenderShapePresetToolbar, stickerWillRenderShapePresetToolbar, willRenderShapePresetToolbar*/ 18944) shapeutil_changes.willRenderPresetToolbar = /*stickersWillRenderShapePresetToolbar*/ ctx[11] || /*stickerWillRenderShapePresetToolbar*/ ctx[9] || /*willRenderShapePresetToolbar*/ ctx[14];\r\n\r\n\t\t\tif (dirty[0] & /*willRenderShapeControls, beforeAddShape, beforeRemoveShape, beforeDeselectShape, beforeSelectShape, beforeUpdateShape*/ 1019904) shapeutil_changes.hooks = {\r\n\t\t\t\twillRenderShapeControls: /*willRenderShapeControls*/ ctx[12],\r\n\t\t\t\tbeforeAddShape: /*beforeAddShape*/ ctx[15],\r\n\t\t\t\tbeforeRemoveShape: /*beforeRemoveShape*/ ctx[16],\r\n\t\t\t\tbeforeDeselectShape: /*beforeDeselectShape*/ ctx[17],\r\n\t\t\t\tbeforeSelectShape: /*beforeSelectShape*/ ctx[18],\r\n\t\t\t\tbeforeUpdateShape: /*beforeUpdateShape*/ ctx[19]\r\n\t\t\t};\r\n\r\n\t\t\tshapeutil.$set(shapeutil_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(shapeutil.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(shapeutil.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(shapeutil, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$6($$self, $$props, $$invalidate) {\r\n\tlet presentationZoom;\r\n\tlet enablePresetSelectImage;\r\n\tlet mapScreenPointToImagePoint;\r\n\tlet mapImagePointToScreenPoint;\r\n\tlet $imageSelectionRectPresentation;\r\n\tlet $imageFlipY;\r\n\tlet $imageFlipX;\r\n\tlet $imageTransformsInterpolated;\r\n\tlet $imageTransforms;\r\n\tlet $imageSize;\r\n\tlet $rootRect;\r\n\tlet $imageRotation;\r\n\tconst name = 'sticker';\r\n\tlet { isActive } = $$props;\r\n\tlet { isActiveFraction } = $$props;\r\n\tlet { isVisible } = $$props;\r\n\tlet { stores } = $$props;\r\n\tlet { locale = {} } = $$props;\r\n\tlet { stickers = [] } = $$props;\r\n\tlet { stickerStickToImage = false } = $$props;\r\n\tlet { stickerEnableSelectImagePreset = true } = $$props;\r\n\tlet { stickerEnableDropImagePreset = true } = $$props;\r\n\tlet { stickerEnableButtonFlipVertical = false } = $$props;\r\n\tlet { stickerWillRenderShapePresetToolbar = undefined } = $$props;\r\n\tlet { stickerEnableSelectImage = true } = $$props;\r\n\tlet { stickersEnableButtonFlipVertical = false } = $$props;\r\n\tlet { stickersWillRenderShapePresetToolbar = undefined } = $$props;\r\n\tlet { willRenderShapeControls = undefined } = $$props;\r\n\tlet { markupEditorToolSelectRadius = undefined } = $$props;\r\n\tlet { willRenderShapePresetToolbar = undefined } = $$props;\r\n\tlet { beforeAddShape = undefined } = $$props;\r\n\tlet { beforeRemoveShape = undefined } = $$props;\r\n\tlet { beforeDeselectShape = undefined } = $$props;\r\n\tlet { beforeSelectShape = undefined } = $$props;\r\n\tlet { beforeUpdateShape = undefined } = $$props;\r\n\tlet { markupEditorWillStartInteraction = undefined } = $$props;\r\n\r\n\t// connect filter choice to stores\r\n\tconst { rootRect, imageCropRect, imageSelectionRectPresentation, imageAnnotation, imageDecoration, imageSize, imageTransforms, imageTransformsInterpolated, imageRotation, imageFlipX, imageFlipY } = stores;\r\n\r\n\tcomponent_subscribe($$self, rootRect, value => $$invalidate(46, $rootRect = value));\r\n\tcomponent_subscribe($$self, imageSelectionRectPresentation, value => $$invalidate(42, $imageSelectionRectPresentation = value));\r\n\tcomponent_subscribe($$self, imageSize, value => $$invalidate(45, $imageSize = value));\r\n\tcomponent_subscribe($$self, imageTransforms, value => $$invalidate(44, $imageTransforms = value));\r\n\tcomponent_subscribe($$self, imageTransformsInterpolated, value => $$invalidate(43, $imageTransformsInterpolated = value));\r\n\tcomponent_subscribe($$self, imageRotation, value => $$invalidate(26, $imageRotation = value));\r\n\tcomponent_subscribe($$self, imageFlipX, value => $$invalidate(22, $imageFlipX = value));\r\n\tcomponent_subscribe($$self, imageFlipY, value => $$invalidate(21, $imageFlipY = value));\r\n\r\n\tfunction measure_handler(event) {\r\n\t\tbubble.call(this, $$self, event);\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('isActive' in $$props) $$invalidate(0, isActive = $$props.isActive);\r\n\t\tif ('isActiveFraction' in $$props) $$invalidate(1, isActiveFraction = $$props.isActiveFraction);\r\n\t\tif ('isVisible' in $$props) $$invalidate(2, isVisible = $$props.isVisible);\r\n\t\tif ('stores' in $$props) $$invalidate(3, stores = $$props.stores);\r\n\t\tif ('locale' in $$props) $$invalidate(4, locale = $$props.locale);\r\n\t\tif ('stickers' in $$props) $$invalidate(5, stickers = $$props.stickers);\r\n\t\tif ('stickerStickToImage' in $$props) $$invalidate(6, stickerStickToImage = $$props.stickerStickToImage);\r\n\t\tif ('stickerEnableSelectImagePreset' in $$props) $$invalidate(39, stickerEnableSelectImagePreset = $$props.stickerEnableSelectImagePreset);\r\n\t\tif ('stickerEnableDropImagePreset' in $$props) $$invalidate(7, stickerEnableDropImagePreset = $$props.stickerEnableDropImagePreset);\r\n\t\tif ('stickerEnableButtonFlipVertical' in $$props) $$invalidate(8, stickerEnableButtonFlipVertical = $$props.stickerEnableButtonFlipVertical);\r\n\t\tif ('stickerWillRenderShapePresetToolbar' in $$props) $$invalidate(9, stickerWillRenderShapePresetToolbar = $$props.stickerWillRenderShapePresetToolbar);\r\n\t\tif ('stickerEnableSelectImage' in $$props) $$invalidate(40, stickerEnableSelectImage = $$props.stickerEnableSelectImage);\r\n\t\tif ('stickersEnableButtonFlipVertical' in $$props) $$invalidate(10, stickersEnableButtonFlipVertical = $$props.stickersEnableButtonFlipVertical);\r\n\t\tif ('stickersWillRenderShapePresetToolbar' in $$props) $$invalidate(11, stickersWillRenderShapePresetToolbar = $$props.stickersWillRenderShapePresetToolbar);\r\n\t\tif ('willRenderShapeControls' in $$props) $$invalidate(12, willRenderShapeControls = $$props.willRenderShapeControls);\r\n\t\tif ('markupEditorToolSelectRadius' in $$props) $$invalidate(13, markupEditorToolSelectRadius = $$props.markupEditorToolSelectRadius);\r\n\t\tif ('willRenderShapePresetToolbar' in $$props) $$invalidate(14, willRenderShapePresetToolbar = $$props.willRenderShapePresetToolbar);\r\n\t\tif ('beforeAddShape' in $$props) $$invalidate(15, beforeAddShape = $$props.beforeAddShape);\r\n\t\tif ('beforeRemoveShape' in $$props) $$invalidate(16, beforeRemoveShape = $$props.beforeRemoveShape);\r\n\t\tif ('beforeDeselectShape' in $$props) $$invalidate(17, beforeDeselectShape = $$props.beforeDeselectShape);\r\n\t\tif ('beforeSelectShape' in $$props) $$invalidate(18, beforeSelectShape = $$props.beforeSelectShape);\r\n\t\tif ('beforeUpdateShape' in $$props) $$invalidate(19, beforeUpdateShape = $$props.beforeUpdateShape);\r\n\t\tif ('markupEditorWillStartInteraction' in $$props) $$invalidate(20, markupEditorWillStartInteraction = $$props.markupEditorWillStartInteraction);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[1] & /*$imageTransformsInterpolated*/ 4096) {\r\n\t\t\t$$invalidate(41, presentationZoom = $imageTransformsInterpolated\r\n\t\t\t? $imageTransformsInterpolated.scale\r\n\t\t\t: 1);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*stickerEnableSelectImagePreset, stickerEnableSelectImage*/ 768) {\r\n\t\t\t$$invalidate(25, enablePresetSelectImage = stickerEnableSelectImagePreset === false\r\n\t\t\t? false\r\n\t\t\t: stickerEnableSelectImage); // || stickerEnableSelectImagePreset\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*stickerStickToImage, $imageFlipX, $imageFlipY*/ 6291520 | $$self.$$.dirty[1] & /*$rootRect, $imageSize, $imageTransformsInterpolated, $imageTransforms, $imageSelectionRectPresentation, presentationZoom*/ 64512) {\r\n\t\t\t//\r\n\t\t\t// Mapping coordinates\r\n\t\t\t//\r\n\t\t\t$$invalidate(24, mapScreenPointToImagePoint = stickerStickToImage\r\n\t\t\t? point => _mapScreenPointToImagePoint(point, $rootRect, $imageSize, $imageTransformsInterpolated.origin, $imageTransformsInterpolated.translation, $imageTransforms.rotation.z, $imageTransformsInterpolated.scale, $imageFlipX, $imageFlipY)\r\n\t\t\t: point => {\r\n\t\t\t\t\tconst mappedPoint = vectorClone(point);\r\n\t\t\t\t\tmappedPoint.x -= $imageSelectionRectPresentation.x;\r\n\t\t\t\t\tmappedPoint.y -= $imageSelectionRectPresentation.y;\r\n\t\t\t\t\tmappedPoint.x /= presentationZoom;\r\n\t\t\t\t\tmappedPoint.y /= presentationZoom;\r\n\t\t\t\t\treturn mappedPoint;\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*stickerStickToImage, $imageFlipX, $imageFlipY*/ 6291520 | $$self.$$.dirty[1] & /*$rootRect, $imageSize, $imageTransformsInterpolated, $imageTransforms, presentationZoom, $imageSelectionRectPresentation*/ 64512) {\r\n\t\t\t$$invalidate(23, mapImagePointToScreenPoint = stickerStickToImage\r\n\t\t\t? point => _mapImagePointToScreenPoint(point, $rootRect, $imageSize, $imageTransformsInterpolated.origin, $imageTransformsInterpolated.translation, $imageTransforms.rotation.z, $imageTransformsInterpolated.scale, $imageFlipX, $imageFlipY)\r\n\t\t\t: point => {\r\n\t\t\t\t\tconst mappedPoint = vectorClone(point);\r\n\t\t\t\t\tmappedPoint.x *= presentationZoom;\r\n\t\t\t\t\tmappedPoint.y *= presentationZoom;\r\n\t\t\t\t\tmappedPoint.x += $imageSelectionRectPresentation.x;\r\n\t\t\t\t\tmappedPoint.y += $imageSelectionRectPresentation.y;\r\n\t\t\t\t\treturn mappedPoint;\r\n\t\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tisActive,\r\n\t\tisActiveFraction,\r\n\t\tisVisible,\r\n\t\tstores,\r\n\t\tlocale,\r\n\t\tstickers,\r\n\t\tstickerStickToImage,\r\n\t\tstickerEnableDropImagePreset,\r\n\t\tstickerEnableButtonFlipVertical,\r\n\t\tstickerWillRenderShapePresetToolbar,\r\n\t\tstickersEnableButtonFlipVertical,\r\n\t\tstickersWillRenderShapePresetToolbar,\r\n\t\twillRenderShapeControls,\r\n\t\tmarkupEditorToolSelectRadius,\r\n\t\twillRenderShapePresetToolbar,\r\n\t\tbeforeAddShape,\r\n\t\tbeforeRemoveShape,\r\n\t\tbeforeDeselectShape,\r\n\t\tbeforeSelectShape,\r\n\t\tbeforeUpdateShape,\r\n\t\tmarkupEditorWillStartInteraction,\r\n\t\t$imageFlipY,\r\n\t\t$imageFlipX,\r\n\t\tmapImagePointToScreenPoint,\r\n\t\tmapScreenPointToImagePoint,\r\n\t\tenablePresetSelectImage,\r\n\t\t$imageRotation,\r\n\t\trootRect,\r\n\t\timageCropRect,\r\n\t\timageSelectionRectPresentation,\r\n\t\timageAnnotation,\r\n\t\timageDecoration,\r\n\t\timageSize,\r\n\t\timageTransforms,\r\n\t\timageTransformsInterpolated,\r\n\t\timageRotation,\r\n\t\timageFlipX,\r\n\t\timageFlipY,\r\n\t\tname,\r\n\t\tstickerEnableSelectImagePreset,\r\n\t\tstickerEnableSelectImage,\r\n\t\tpresentationZoom,\r\n\t\t$imageSelectionRectPresentation,\r\n\t\t$imageTransformsInterpolated,\r\n\t\t$imageTransforms,\r\n\t\t$imageSize,\r\n\t\t$rootRect,\r\n\t\tmeasure_handler\r\n\t];\r\n}\r\n\r\nclass Sticker extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$6,\r\n\t\t\tcreate_fragment$6,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tname: 38,\r\n\t\t\t\tisActive: 0,\r\n\t\t\t\tisActiveFraction: 1,\r\n\t\t\t\tisVisible: 2,\r\n\t\t\t\tstores: 3,\r\n\t\t\t\tlocale: 4,\r\n\t\t\t\tstickers: 5,\r\n\t\t\t\tstickerStickToImage: 6,\r\n\t\t\t\tstickerEnableSelectImagePreset: 39,\r\n\t\t\t\tstickerEnableDropImagePreset: 7,\r\n\t\t\t\tstickerEnableButtonFlipVertical: 8,\r\n\t\t\t\tstickerWillRenderShapePresetToolbar: 9,\r\n\t\t\t\tstickerEnableSelectImage: 40,\r\n\t\t\t\tstickersEnableButtonFlipVertical: 10,\r\n\t\t\t\tstickersWillRenderShapePresetToolbar: 11,\r\n\t\t\t\twillRenderShapeControls: 12,\r\n\t\t\t\tmarkupEditorToolSelectRadius: 13,\r\n\t\t\t\twillRenderShapePresetToolbar: 14,\r\n\t\t\t\tbeforeAddShape: 15,\r\n\t\t\t\tbeforeRemoveShape: 16,\r\n\t\t\t\tbeforeDeselectShape: 17,\r\n\t\t\t\tbeforeSelectShape: 18,\r\n\t\t\t\tbeforeUpdateShape: 19,\r\n\t\t\t\tmarkupEditorWillStartInteraction: 20\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1]\r\n\t\t);\r\n\t}\r\n\r\n\tget name() {\r\n\t\treturn this.$$.ctx[38];\r\n\t}\r\n\r\n\tget isActive() {\r\n\t\treturn this.$$.ctx[0];\r\n\t}\r\n\r\n\tset isActive(isActive) {\r\n\t\tthis.$$set({ isActive });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget isActiveFraction() {\r\n\t\treturn this.$$.ctx[1];\r\n\t}\r\n\r\n\tset isActiveFraction(isActiveFraction) {\r\n\t\tthis.$$set({ isActiveFraction });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget isVisible() {\r\n\t\treturn this.$$.ctx[2];\r\n\t}\r\n\r\n\tset isVisible(isVisible) {\r\n\t\tthis.$$set({ isVisible });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stores() {\r\n\t\treturn this.$$.ctx[3];\r\n\t}\r\n\r\n\tset stores(stores) {\r\n\t\tthis.$$set({ stores });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget locale() {\r\n\t\treturn this.$$.ctx[4];\r\n\t}\r\n\r\n\tset locale(locale) {\r\n\t\tthis.$$set({ locale });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stickers() {\r\n\t\treturn this.$$.ctx[5];\r\n\t}\r\n\r\n\tset stickers(stickers) {\r\n\t\tthis.$$set({ stickers });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stickerStickToImage() {\r\n\t\treturn this.$$.ctx[6];\r\n\t}\r\n\r\n\tset stickerStickToImage(stickerStickToImage) {\r\n\t\tthis.$$set({ stickerStickToImage });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stickerEnableSelectImagePreset() {\r\n\t\treturn this.$$.ctx[39];\r\n\t}\r\n\r\n\tset stickerEnableSelectImagePreset(stickerEnableSelectImagePreset) {\r\n\t\tthis.$$set({ stickerEnableSelectImagePreset });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stickerEnableDropImagePreset() {\r\n\t\treturn this.$$.ctx[7];\r\n\t}\r\n\r\n\tset stickerEnableDropImagePreset(stickerEnableDropImagePreset) {\r\n\t\tthis.$$set({ stickerEnableDropImagePreset });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stickerEnableButtonFlipVertical() {\r\n\t\treturn this.$$.ctx[8];\r\n\t}\r\n\r\n\tset stickerEnableButtonFlipVertical(stickerEnableButtonFlipVertical) {\r\n\t\tthis.$$set({ stickerEnableButtonFlipVertical });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stickerWillRenderShapePresetToolbar() {\r\n\t\treturn this.$$.ctx[9];\r\n\t}\r\n\r\n\tset stickerWillRenderShapePresetToolbar(stickerWillRenderShapePresetToolbar) {\r\n\t\tthis.$$set({ stickerWillRenderShapePresetToolbar });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stickerEnableSelectImage() {\r\n\t\treturn this.$$.ctx[40];\r\n\t}\r\n\r\n\tset stickerEnableSelectImage(stickerEnableSelectImage) {\r\n\t\tthis.$$set({ stickerEnableSelectImage });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stickersEnableButtonFlipVertical() {\r\n\t\treturn this.$$.ctx[10];\r\n\t}\r\n\r\n\tset stickersEnableButtonFlipVertical(stickersEnableButtonFlipVertical) {\r\n\t\tthis.$$set({ stickersEnableButtonFlipVertical });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stickersWillRenderShapePresetToolbar() {\r\n\t\treturn this.$$.ctx[11];\r\n\t}\r\n\r\n\tset stickersWillRenderShapePresetToolbar(stickersWillRenderShapePresetToolbar) {\r\n\t\tthis.$$set({ stickersWillRenderShapePresetToolbar });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget willRenderShapeControls() {\r\n\t\treturn this.$$.ctx[12];\r\n\t}\r\n\r\n\tset willRenderShapeControls(willRenderShapeControls) {\r\n\t\tthis.$$set({ willRenderShapeControls });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorToolSelectRadius() {\r\n\t\treturn this.$$.ctx[13];\r\n\t}\r\n\r\n\tset markupEditorToolSelectRadius(markupEditorToolSelectRadius) {\r\n\t\tthis.$$set({ markupEditorToolSelectRadius });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget willRenderShapePresetToolbar() {\r\n\t\treturn this.$$.ctx[14];\r\n\t}\r\n\r\n\tset willRenderShapePresetToolbar(willRenderShapePresetToolbar) {\r\n\t\tthis.$$set({ willRenderShapePresetToolbar });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget beforeAddShape() {\r\n\t\treturn this.$$.ctx[15];\r\n\t}\r\n\r\n\tset beforeAddShape(beforeAddShape) {\r\n\t\tthis.$$set({ beforeAddShape });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget beforeRemoveShape() {\r\n\t\treturn this.$$.ctx[16];\r\n\t}\r\n\r\n\tset beforeRemoveShape(beforeRemoveShape) {\r\n\t\tthis.$$set({ beforeRemoveShape });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget beforeDeselectShape() {\r\n\t\treturn this.$$.ctx[17];\r\n\t}\r\n\r\n\tset beforeDeselectShape(beforeDeselectShape) {\r\n\t\tthis.$$set({ beforeDeselectShape });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget beforeSelectShape() {\r\n\t\treturn this.$$.ctx[18];\r\n\t}\r\n\r\n\tset beforeSelectShape(beforeSelectShape) {\r\n\t\tthis.$$set({ beforeSelectShape });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget beforeUpdateShape() {\r\n\t\treturn this.$$.ctx[19];\r\n\t}\r\n\r\n\tset beforeUpdateShape(beforeUpdateShape) {\r\n\t\tthis.$$set({ beforeUpdateShape });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorWillStartInteraction() {\r\n\t\treturn this.$$.ctx[20];\r\n\t}\r\n\r\n\tset markupEditorWillStartInteraction(markupEditorWillStartInteraction) {\r\n\t\tthis.$$set({ markupEditorWillStartInteraction });\r\n\t\tflush();\r\n\t}\r\n}\r\n\r\n// @ts-ignore\r\nvar _plugin_sticker = { util: ['sticker', Sticker, ({ duration }) => !duration] };\r\n\r\n/* src/core/ui/plugins/frame/index.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_option_slot(ctx) {\r\n\tlet div;\r\n\tlet html_tag;\r\n\tlet raw_value = (/*getOptionThumb*/ ctx[14](/*option*/ ctx[33].value) || '') + \"\";\r\n\tlet t0;\r\n\tlet span;\r\n\r\n\tlet t1_value = (isFunction(/*option*/ ctx[33].label)\r\n\t? /*option*/ ctx[33].label(/*locale*/ ctx[1])\r\n\t: /*option*/ ctx[33].label) + \"\";\r\n\r\n\tlet t1;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\thtml_tag = new HtmlTag(false);\r\n\t\t\tt0 = space();\r\n\t\t\tspan = element(\"span\");\r\n\t\t\tt1 = text(t1_value);\r\n\t\t\thtml_tag.a = t0;\r\n\t\t\tattr(div, \"slot\", \"option\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\thtml_tag.m(raw_value, div);\r\n\t\t\tappend(div, t0);\r\n\t\t\tappend(div, span);\r\n\t\t\tappend(span, t1);\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty[1] & /*option*/ 4 && raw_value !== (raw_value = (/*getOptionThumb*/ ctx[14](/*option*/ ctx[33].value) || '') + \"\")) html_tag.p(raw_value);\r\n\r\n\t\t\tif (dirty[0] & /*locale*/ 2 | dirty[1] & /*option*/ 4 && t1_value !== (t1_value = (isFunction(/*option*/ ctx[33].label)\r\n\t\t\t? /*option*/ ctx[33].label(/*locale*/ ctx[1])\r\n\t\t\t: /*option*/ ctx[33].label) + \"\")) set_data(t1, t1_value);\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (157:8) <Scrollable elasticity={scrollElasticity}>\r\nfunction create_default_slot$2(ctx) {\r\n\tlet radiogroup;\r\n\tlet current;\r\n\r\n\tradiogroup = new RadioGroup({\r\n\t\t\tprops: {\r\n\t\t\t\tlocale: /*locale*/ ctx[1],\r\n\t\t\t\tclass: \"PinturaControlList\",\r\n\t\t\t\tlayout: \"row\",\r\n\t\t\t\toptions: /*frameOptions*/ ctx[2],\r\n\t\t\t\tselectedIndex: /*selectedFrameIndex*/ ctx[11],\r\n\t\t\t\tonchange: /*handleChangeFrame*/ ctx[12],\r\n\t\t\t\t$$slots: {\r\n\t\t\t\t\toption: [\r\n\t\t\t\t\t\tcreate_option_slot,\r\n\t\t\t\t\t\t({ option }) => ({ 33: option }),\r\n\t\t\t\t\t\t({ option }) => [0, option ? 4 : 0]\r\n\t\t\t\t\t]\r\n\t\t\t\t},\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(radiogroup.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(radiogroup, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst radiogroup_changes = {};\r\n\t\t\tif (dirty[0] & /*locale*/ 2) radiogroup_changes.locale = /*locale*/ ctx[1];\r\n\t\t\tif (dirty[0] & /*frameOptions*/ 4) radiogroup_changes.options = /*frameOptions*/ ctx[2];\r\n\r\n\t\t\tif (dirty[0] & /*locale*/ 2 | dirty[1] & /*$$scope, option*/ 12) {\r\n\t\t\t\tradiogroup_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tradiogroup.$set(radiogroup_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(radiogroup.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(radiogroup.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(radiogroup, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (148:4) \r\nfunction create_footer_slot$1(ctx) {\r\n\tlet div;\r\n\tlet shapestyleeditor;\r\n\tlet t;\r\n\tlet scrollable;\r\n\tlet current;\r\n\r\n\tshapestyleeditor = new ShapeStyleEditor({\r\n\t\t\tprops: {\r\n\t\t\t\tlocale: /*locale*/ ctx[1],\r\n\t\t\t\tclass: \"PinturaControlPanels\",\r\n\t\t\t\tshape: /*$imageFrame*/ ctx[6],\r\n\t\t\t\tonchange: /*handleUpdateSelectedFrameShape*/ ctx[13],\r\n\t\t\t\tcontrols: /*markupEditorShapeStyleControls*/ ctx[3],\r\n\t\t\t\tscrollElasticity: /*computedScrollElasticity*/ ctx[5]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tscrollable = new Scrollable({\r\n\t\t\tprops: {\r\n\t\t\t\telasticity: /*scrollElasticity*/ ctx[9],\r\n\t\t\t\t$$slots: { default: [create_default_slot$2] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tcreate_component(shapestyleeditor.$$.fragment);\r\n\t\t\tt = space();\r\n\t\t\tcreate_component(scrollable.$$.fragment);\r\n\t\t\tattr(div, \"slot\", \"footer\");\r\n\t\t\tattr(div, \"style\", /*footerStyle*/ ctx[4]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tmount_component(shapestyleeditor, div, null);\r\n\t\t\tappend(div, t);\r\n\t\t\tmount_component(scrollable, div, null);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst shapestyleeditor_changes = {};\r\n\t\t\tif (dirty[0] & /*locale*/ 2) shapestyleeditor_changes.locale = /*locale*/ ctx[1];\r\n\t\t\tif (dirty[0] & /*$imageFrame*/ 64) shapestyleeditor_changes.shape = /*$imageFrame*/ ctx[6];\r\n\t\t\tif (dirty[0] & /*markupEditorShapeStyleControls*/ 8) shapestyleeditor_changes.controls = /*markupEditorShapeStyleControls*/ ctx[3];\r\n\t\t\tif (dirty[0] & /*computedScrollElasticity*/ 32) shapestyleeditor_changes.scrollElasticity = /*computedScrollElasticity*/ ctx[5];\r\n\t\t\tshapestyleeditor.$set(shapestyleeditor_changes);\r\n\t\t\tconst scrollable_changes = {};\r\n\r\n\t\t\tif (dirty[0] & /*locale, frameOptions*/ 6 | dirty[1] & /*$$scope*/ 8) {\r\n\t\t\t\tscrollable_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tscrollable.$set(scrollable_changes);\r\n\r\n\t\t\tif (!current || dirty[0] & /*footerStyle*/ 16) {\r\n\t\t\t\tattr(div, \"style\", /*footerStyle*/ ctx[4]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(shapestyleeditor.$$.fragment, local);\r\n\t\t\ttransition_in(scrollable.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(shapestyleeditor.$$.fragment, local);\r\n\t\t\ttransition_out(scrollable.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tdestroy_component(shapestyleeditor);\r\n\t\t\tdestroy_component(scrollable);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$5(ctx) {\r\n\tlet util;\r\n\tlet current;\r\n\r\n\tutil = new Util({\r\n\t\t\tprops: {\r\n\t\t\t\t$$slots: { footer: [create_footer_slot$1] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tutil.$on(\"measure\", /*measure_handler*/ ctx[23]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(util.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(util, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst util_changes = {};\r\n\r\n\t\t\tif (dirty[0] & /*footerStyle, locale, frameOptions, $imageFrame, markupEditorShapeStyleControls, computedScrollElasticity*/ 126 | dirty[1] & /*$$scope*/ 8) {\r\n\t\t\t\tutil_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tutil.$set(util_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(util.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(util.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(util, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$5($$self, $$props, $$invalidate) {\r\n\tlet computedScrollElasticity;\r\n\tlet footerStyle;\r\n\tlet $footerOffset;\r\n\r\n\tlet $isActive,\r\n\t\t$$unsubscribe_isActive = noop,\r\n\t\t$$subscribe_isActive = () => ($$unsubscribe_isActive(), $$unsubscribe_isActive = subscribe(isActive, $$value => $$invalidate(20, $isActive = $$value)), isActive);\r\n\r\n\tlet $animation;\r\n\tlet $imageFrame;\r\n\tlet $elasticityMultiplier;\r\n\t$$self.$$.on_destroy.push(() => $$unsubscribe_isActive());\r\n\tconst name = 'frame';\r\n\tlet { isActive } = $$props;\r\n\t$$subscribe_isActive();\r\n\tlet { stores } = $$props;\r\n\tlet { locale = {} } = $$props;\r\n\tlet { frameStyles = {} } = $$props;\r\n\tlet { frameOptions = [] } = $$props;\r\n\tlet { markupEditorShapeStyleControls = undefined } = $$props;\r\n\r\n\t//\r\n\t// context\r\n\t//\r\n\tconst elasticityMultiplier = getContext('elasticityMultiplier');\r\n\r\n\tcomponent_subscribe($$self, elasticityMultiplier, value => $$invalidate(22, $elasticityMultiplier = value));\r\n\r\n\t// connect filter choice to stores\r\n\tconst { history, animation, scrollElasticity, imageFrame, allowPan, allowZoom, enableZoomControls } = stores;\r\n\r\n\tcomponent_subscribe($$self, animation, value => $$invalidate(21, $animation = value));\r\n\tcomponent_subscribe($$self, imageFrame, value => $$invalidate(6, $imageFrame = value));\r\n\r\n\t// current index in frame list\r\n\tlet selectedFrameIndex = $imageFrame\r\n\t? frameOptions.findIndex(([id]) => id === $imageFrame.id)\r\n\t: 0;\r\n\r\n\t// default frame styles\r\n\tlet frameActiveStyles = {};\r\n\r\n\tconst handleChangeFrame = ({ value }) => {\r\n\t\t// get new frame\r\n\t\tconst frameBase = frameStyles[value];\r\n\r\n\t\t// no new frame selected\r\n\t\tif (!frameBase || !frameBase.shape) {\r\n\t\t\timageFrame.set(undefined);\r\n\t\t\thistory.write();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst { shape } = frameBase;\r\n\r\n\t\t// create new base frame\r\n\t\tconst frame = {\r\n\t\t\tid: value,\r\n\t\t\t// copy the frame base, it's possible that this frame has a different layout\r\n\t\t\t...shapeDeepCopy(shape),\r\n\t\t\t// set base styles\r\n\t\t\t...Object.keys(frameActiveStyles).reduce(\r\n\t\t\t\t(frameStyles, prop) => {\r\n\t\t\t\t\tif (!shape[prop]) return frameStyles;\r\n\t\t\t\t\tframeStyles[prop] = frameActiveStyles[prop];\r\n\t\t\t\t\treturn frameStyles;\r\n\t\t\t\t},\r\n\t\t\t\t{}\r\n\t\t\t)\r\n\t\t};\r\n\r\n\t\timageFrame.set(frame);\r\n\t\thistory.write();\r\n\t};\r\n\r\n\tlet updateWriteHistoryTimeoutId;\r\n\r\n\tfunction handleUpdateSelectedFrameShape(props) {\r\n\t\t// remember color style for when creating or styling other element\r\n\t\tif (hasProp(props, 'frameColor')) frameActiveStyles.frameColor = props.frameColor;\r\n\r\n\t\t// it's possible we're only updating default styles\r\n\t\tif (!$imageFrame) return;\r\n\r\n\t\t// frameSelected\r\n\t\tshapeUpdateProps($imageFrame, props);\r\n\r\n\t\t// update shape so ui shape controls are updated\r\n\t\timageFrame.set($imageFrame);\r\n\r\n\t\t// so we don't write every state change to history\r\n\t\tclearTimeout(updateWriteHistoryTimeoutId);\r\n\r\n\t\tupdateWriteHistoryTimeoutId = setTimeout(\r\n\t\t\t() => {\r\n\t\t\t\thistory.write();\r\n\t\t\t},\r\n\t\t\t200\r\n\t\t);\r\n\t}\r\n\r\n\tconst isIncompleteSVGMarkup = str => (/rect|path|circle|line|<g>/i).test(str);\r\n\tconst isHTML = str => (/div/i).test(str);\r\n\r\n\tconst getThumb = value => {\r\n\t\tif (isHTML(value)) return value;\r\n\r\n\t\t// could be full svg\r\n\t\tif (isSVGMarkup(value)) return value;\r\n\r\n\t\t// could be a partial svg in which case we turn it into a full svg\r\n\t\tif (isIncompleteSVGMarkup(value)) return `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" aria-hidden=\"true\" focusable=\"false\" stroke-linecap=\"round\" stroke-linejoin=\"round\">${value}</svg>`;\r\n\r\n\t\t// if not, must be URL\r\n\t\treturn `<img src=\"${value}\" alt=\"\"/>`;\r\n\t};\r\n\r\n\tconst getOptionThumb = key => {\r\n\t\tconst frameStyle = frameStyles[key];\r\n\t\tif (!frameStyle || !frameStyle.thumb) return;\r\n\t\treturn getThumb(frameStyle.thumb);\r\n\t};\r\n\r\n\t//\r\n\t// Footer style\r\n\t//\r\n\tconst footerOffset = spring($animation ? 20 : 0);\r\n\r\n\tcomponent_subscribe($$self, footerOffset, value => $$invalidate(19, $footerOffset = value));\r\n\r\n\tfunction measure_handler(event) {\r\n\t\tbubble.call(this, $$self, event);\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('isActive' in $$props) $$subscribe_isActive($$invalidate(0, isActive = $$props.isActive));\r\n\t\tif ('stores' in $$props) $$invalidate(17, stores = $$props.stores);\r\n\t\tif ('locale' in $$props) $$invalidate(1, locale = $$props.locale);\r\n\t\tif ('frameStyles' in $$props) $$invalidate(18, frameStyles = $$props.frameStyles);\r\n\t\tif ('frameOptions' in $$props) $$invalidate(2, frameOptions = $$props.frameOptions);\r\n\t\tif ('markupEditorShapeStyleControls' in $$props) $$invalidate(3, markupEditorShapeStyleControls = $$props.markupEditorShapeStyleControls);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 1048576) {\r\n\t\t\t// enable pan and zoom\r\n\t\t\tallowPan.set($isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 1048576) {\r\n\t\t\tallowZoom.set($isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$isActive*/ 1048576) {\r\n\t\t\tenableZoomControls.set($isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$elasticityMultiplier*/ 4194304) {\r\n\t\t\t//\r\n\t\t\t// scroll components\r\n\t\t\t//\r\n\t\t\t$$invalidate(5, computedScrollElasticity = $elasticityMultiplier * scrollElasticity);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$animation, $isActive*/ 3145728) {\r\n\t\t\t$animation && footerOffset.set($isActive ? 0 : 20);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*$footerOffset*/ 524288) {\r\n\t\t\t$$invalidate(4, footerStyle = $footerOffset\r\n\t\t\t? `transform: translateY(${$footerOffset}px)`\r\n\t\t\t: undefined);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tisActive,\r\n\t\tlocale,\r\n\t\tframeOptions,\r\n\t\tmarkupEditorShapeStyleControls,\r\n\t\tfooterStyle,\r\n\t\tcomputedScrollElasticity,\r\n\t\t$imageFrame,\r\n\t\telasticityMultiplier,\r\n\t\tanimation,\r\n\t\tscrollElasticity,\r\n\t\timageFrame,\r\n\t\tselectedFrameIndex,\r\n\t\thandleChangeFrame,\r\n\t\thandleUpdateSelectedFrameShape,\r\n\t\tgetOptionThumb,\r\n\t\tfooterOffset,\r\n\t\tname,\r\n\t\tstores,\r\n\t\tframeStyles,\r\n\t\t$footerOffset,\r\n\t\t$isActive,\r\n\t\t$animation,\r\n\t\t$elasticityMultiplier,\r\n\t\tmeasure_handler\r\n\t];\r\n}\r\n\r\nclass Frame extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$5,\r\n\t\t\tcreate_fragment$5,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tname: 16,\r\n\t\t\t\tisActive: 0,\r\n\t\t\t\tstores: 17,\r\n\t\t\t\tlocale: 1,\r\n\t\t\t\tframeStyles: 18,\r\n\t\t\t\tframeOptions: 2,\r\n\t\t\t\tmarkupEditorShapeStyleControls: 3\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1]\r\n\t\t);\r\n\t}\r\n\r\n\tget name() {\r\n\t\treturn this.$$.ctx[16];\r\n\t}\r\n\r\n\tget isActive() {\r\n\t\treturn this.$$.ctx[0];\r\n\t}\r\n\r\n\tset isActive(isActive) {\r\n\t\tthis.$$set({ isActive });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stores() {\r\n\t\treturn this.$$.ctx[17];\r\n\t}\r\n\r\n\tset stores(stores) {\r\n\t\tthis.$$set({ stores });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget locale() {\r\n\t\treturn this.$$.ctx[1];\r\n\t}\r\n\r\n\tset locale(locale) {\r\n\t\tthis.$$set({ locale });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget frameStyles() {\r\n\t\treturn this.$$.ctx[18];\r\n\t}\r\n\r\n\tset frameStyles(frameStyles) {\r\n\t\tthis.$$set({ frameStyles });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget frameOptions() {\r\n\t\treturn this.$$.ctx[2];\r\n\t}\r\n\r\n\tset frameOptions(frameOptions) {\r\n\t\tthis.$$set({ frameOptions });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorShapeStyleControls() {\r\n\t\treturn this.$$.ctx[3];\r\n\t}\r\n\r\n\tset markupEditorShapeStyleControls(markupEditorShapeStyleControls) {\r\n\t\tthis.$$set({ markupEditorShapeStyleControls });\r\n\t\tflush();\r\n\t}\r\n}\r\n\r\n// @ts-ignore\r\nvar _plugin_frame = { util: ['frame', Frame, ({ duration }) => !duration] };\r\n\r\n/* src/core/ui/plugins/resize/DimensionInput.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$4(ctx) {\r\n\tlet div;\r\n\tlet input;\r\n\tlet input_value_value;\r\n\tlet t0;\r\n\tlet label_1;\r\n\tlet t1;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tinput = element(\"input\");\r\n\t\t\tt0 = space();\r\n\t\t\tlabel_1 = element(\"label\");\r\n\t\t\tt1 = text(/*label*/ ctx[1]);\r\n\t\t\tattr(input, \"id\", /*id*/ ctx[0]);\r\n\t\t\tattr(input, \"type\", \"number\");\r\n\t\t\tattr(input, \"min\", \"1\");\r\n\t\t\tattr(input, \"inputmode\", \"numeric\");\r\n\t\t\tattr(input, \"pattern\", \"[0-9]*\");\r\n\t\t\tattr(input, \"data-state\", /*state*/ ctx[3]);\r\n\t\t\tattr(input, \"autocomplete\", \"off\");\r\n\t\t\tattr(input, \"placeholder\", /*placeholder*/ ctx[4]);\r\n\r\n\t\t\tinput.value = input_value_value = /*value*/ ctx[5] === undefined\r\n\t\t\t? ''\r\n\t\t\t: /*format*/ ctx[7](/*value*/ ctx[5] + '');\r\n\r\n\t\t\tattr(label_1, \"for\", /*id*/ ctx[0]);\r\n\t\t\tattr(label_1, \"title\", /*title*/ ctx[2]);\r\n\t\t\tattr(label_1, \"aria-label\", /*title*/ ctx[2]);\r\n\t\t\tattr(div, \"class\", \"PinturaInputDimension\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tappend(div, input);\r\n\t\t\tappend(div, t0);\r\n\t\t\tappend(div, label_1);\r\n\t\t\tappend(label_1, t1);\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = listen(input, \"input\", /*input_handler*/ ctx[8]);\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tif (dirty & /*id*/ 1) {\r\n\t\t\t\tattr(input, \"id\", /*id*/ ctx[0]);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty & /*state*/ 8) {\r\n\t\t\t\tattr(input, \"data-state\", /*state*/ ctx[3]);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty & /*placeholder*/ 16) {\r\n\t\t\t\tattr(input, \"placeholder\", /*placeholder*/ ctx[4]);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty & /*value, format*/ 160 && input_value_value !== (input_value_value = /*value*/ ctx[5] === undefined\r\n\t\t\t? ''\r\n\t\t\t: /*format*/ ctx[7](/*value*/ ctx[5] + '')) && input.value !== input_value_value) {\r\n\t\t\t\tinput.value = input_value_value;\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty & /*label*/ 2) set_data(t1, /*label*/ ctx[1]);\r\n\r\n\t\t\tif (dirty & /*id*/ 1) {\r\n\t\t\t\tattr(label_1, \"for\", /*id*/ ctx[0]);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty & /*title*/ 4) {\r\n\t\t\t\tattr(label_1, \"title\", /*title*/ ctx[2]);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty & /*title*/ 4) {\r\n\t\t\t\tattr(label_1, \"aria-label\", /*title*/ ctx[2]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti: noop,\r\n\t\to: noop,\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tmounted = false;\r\n\t\t\tdispose();\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$4($$self, $$props, $$invalidate) {\r\n\tlet { id } = $$props;\r\n\tlet { label } = $$props;\r\n\tlet { title } = $$props;\r\n\tlet { state } = $$props;\r\n\tlet { placeholder } = $$props;\r\n\tlet { value } = $$props;\r\n\tlet { onchange } = $$props;\r\n\tlet { format = str => str.replace(/\\D/g, '') } = $$props;\r\n\tconst input_handler = e => onchange(format(e.currentTarget.value));\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('id' in $$props) $$invalidate(0, id = $$props.id);\r\n\t\tif ('label' in $$props) $$invalidate(1, label = $$props.label);\r\n\t\tif ('title' in $$props) $$invalidate(2, title = $$props.title);\r\n\t\tif ('state' in $$props) $$invalidate(3, state = $$props.state);\r\n\t\tif ('placeholder' in $$props) $$invalidate(4, placeholder = $$props.placeholder);\r\n\t\tif ('value' in $$props) $$invalidate(5, value = $$props.value);\r\n\t\tif ('onchange' in $$props) $$invalidate(6, onchange = $$props.onchange);\r\n\t\tif ('format' in $$props) $$invalidate(7, format = $$props.format);\r\n\t};\r\n\r\n\treturn [id, label, title, state, placeholder, value, onchange, format, input_handler];\r\n}\r\n\r\nclass DimensionInput extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$4, create_fragment$4, safe_not_equal, {\r\n\t\t\tid: 0,\r\n\t\t\tlabel: 1,\r\n\t\t\ttitle: 2,\r\n\t\t\tstate: 3,\r\n\t\t\tplaceholder: 4,\r\n\t\t\tvalue: 5,\r\n\t\t\tonchange: 6,\r\n\t\t\tformat: 7\r\n\t\t});\r\n\t}\r\n}\r\n\r\n/* src/core/ui/plugins/resize/DimensionLock.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_default_slot$1(ctx) {\r\n\tlet g;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tg = svg_element(\"g\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, g, anchor);\r\n\t\t\tg.innerHTML = /*icon*/ ctx[2];\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif (dirty & /*icon*/ 4) g.innerHTML = /*icon*/ ctx[2];\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(g);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$3(ctx) {\r\n\tlet div;\r\n\tlet input;\r\n\tlet t;\r\n\tlet label;\r\n\tlet icon_1;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\r\n\ticon_1 = new Icon({\r\n\t\t\tprops: {\r\n\t\t\t\t$$slots: { default: [create_default_slot$1] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tinput = element(\"input\");\r\n\t\t\tt = space();\r\n\t\t\tlabel = element(\"label\");\r\n\t\t\tcreate_component(icon_1.$$.fragment);\r\n\t\t\tattr(input, \"id\", /*id*/ ctx[0]);\r\n\t\t\tattr(input, \"class\", \"implicit\");\r\n\t\t\tattr(input, \"type\", \"checkbox\");\r\n\t\t\tinput.checked = /*locked*/ ctx[1];\r\n\t\t\tattr(label, \"for\", /*id*/ ctx[0]);\r\n\t\t\tattr(label, \"title\", /*title*/ ctx[3]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\tappend(div, input);\r\n\t\t\tappend(div, t);\r\n\t\t\tappend(div, label);\r\n\t\t\tmount_component(icon_1, label, null);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = listen(input, \"change\", /*change_handler*/ ctx[5]);\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tif (!current || dirty & /*id*/ 1) {\r\n\t\t\t\tattr(input, \"id\", /*id*/ ctx[0]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*locked*/ 2) {\r\n\t\t\t\tinput.checked = /*locked*/ ctx[1];\r\n\t\t\t}\r\n\r\n\t\t\tconst icon_1_changes = {};\r\n\r\n\t\t\tif (dirty & /*$$scope, icon*/ 68) {\r\n\t\t\t\ticon_1_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\ticon_1.$set(icon_1_changes);\r\n\r\n\t\t\tif (!current || dirty & /*id*/ 1) {\r\n\t\t\t\tattr(label, \"for\", /*id*/ ctx[0]);\r\n\t\t\t}\r\n\r\n\t\t\tif (!current || dirty & /*title*/ 8) {\r\n\t\t\t\tattr(label, \"title\", /*title*/ ctx[3]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(icon_1.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(icon_1.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\tdestroy_component(icon_1);\r\n\t\t\tmounted = false;\r\n\t\t\tdispose();\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$3($$self, $$props, $$invalidate) {\r\n\tlet { id } = $$props;\r\n\tlet { locked } = $$props;\r\n\tlet { icon } = $$props;\r\n\tlet { title } = $$props;\r\n\tlet { onchange } = $$props;\r\n\tconst change_handler = e => onchange(e.currentTarget.checked);\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('id' in $$props) $$invalidate(0, id = $$props.id);\r\n\t\tif ('locked' in $$props) $$invalidate(1, locked = $$props.locked);\r\n\t\tif ('icon' in $$props) $$invalidate(2, icon = $$props.icon);\r\n\t\tif ('title' in $$props) $$invalidate(3, title = $$props.title);\r\n\t\tif ('onchange' in $$props) $$invalidate(4, onchange = $$props.onchange);\r\n\t};\r\n\r\n\treturn [id, locked, icon, title, onchange, change_handler];\r\n}\r\n\r\nclass DimensionLock extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$3, create_fragment$3, safe_not_equal, {\r\n\t\t\tid: 0,\r\n\t\t\tlocked: 1,\r\n\t\t\ticon: 2,\r\n\t\t\ttitle: 3,\r\n\t\t\tonchange: 4\r\n\t\t});\r\n\t}\r\n}\r\n\r\n/* src/core/ui/plugins/resize/index.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_default_slot(ctx) {\r\n\tlet t;\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tt = text(\"Save\");\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, t, anchor);\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(t);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// (596:4) \r\nfunction create_footer_slot(ctx) {\r\n\tlet form;\r\n\tlet div1;\r\n\tlet fieldset;\r\n\tlet legend;\r\n\tlet t0_value = /*locale*/ ctx[1].resizeLabelFormCaption + \"\";\r\n\tlet t0;\r\n\tlet t1;\r\n\tlet div0;\r\n\tlet dynamiccomponenttree;\r\n\tlet t2;\r\n\tlet button;\r\n\tlet current;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tdynamiccomponenttree = new DynamicComponentTree_1({ props: { items: /*tools*/ ctx[4] } });\r\n\r\n\tbutton = new Button({\r\n\t\t\tprops: {\r\n\t\t\t\ttype: \"submit\",\r\n\t\t\t\tclass: \"implicit\",\r\n\t\t\t\t$$slots: { default: [create_default_slot] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tform = element(\"form\");\r\n\t\t\tdiv1 = element(\"div\");\r\n\t\t\tfieldset = element(\"fieldset\");\r\n\t\t\tlegend = element(\"legend\");\r\n\t\t\tt0 = text(t0_value);\r\n\t\t\tt1 = space();\r\n\t\t\tdiv0 = element(\"div\");\r\n\t\t\tcreate_component(dynamiccomponenttree.$$.fragment);\r\n\t\t\tt2 = space();\r\n\t\t\tcreate_component(button.$$.fragment);\r\n\t\t\tattr(legend, \"class\", \"implicit\");\r\n\t\t\tattr(div0, \"class\", \"PinturaFieldsetInner\");\r\n\t\t\tattr(div1, \"class\", \"PinturaFormInner\");\r\n\t\t\tattr(form, \"slot\", \"footer\");\r\n\t\t\tattr(form, \"style\", /*footerStyle*/ ctx[3]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, form, anchor);\r\n\t\t\tappend(form, div1);\r\n\t\t\tappend(div1, fieldset);\r\n\t\t\tappend(fieldset, legend);\r\n\t\t\tappend(legend, t0);\r\n\t\t\tappend(fieldset, t1);\r\n\t\t\tappend(fieldset, div0);\r\n\t\t\tmount_component(dynamiccomponenttree, div0, null);\r\n\t\t\t/*div0_binding*/ ctx[64](div0);\r\n\t\t\tappend(div1, t2);\r\n\t\t\tmount_component(button, div1, null);\r\n\t\t\tcurrent = true;\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(div0, \"focusin\", /*handleFocusIn*/ ctx[15]),\r\n\t\t\t\t\tlisten(div0, \"focusout\", /*handleFocusOut*/ ctx[16]),\r\n\t\t\t\t\tlisten(form, \"submit\", prevent_default(/*handleSubmit*/ ctx[17]))\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tif ((!current || dirty[0] & /*locale*/ 2) && t0_value !== (t0_value = /*locale*/ ctx[1].resizeLabelFormCaption + \"\")) set_data(t0, t0_value);\r\n\t\t\tconst dynamiccomponenttree_changes = {};\r\n\t\t\tif (dirty[0] & /*tools*/ 16) dynamiccomponenttree_changes.items = /*tools*/ ctx[4];\r\n\t\t\tdynamiccomponenttree.$set(dynamiccomponenttree_changes);\r\n\t\t\tconst button_changes = {};\r\n\r\n\t\t\tif (dirty[3] & /*$$scope*/ 4) {\r\n\t\t\t\tbutton_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tbutton.$set(button_changes);\r\n\r\n\t\t\tif (!current || dirty[0] & /*footerStyle*/ 8) {\r\n\t\t\t\tattr(form, \"style\", /*footerStyle*/ ctx[3]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(dynamiccomponenttree.$$.fragment, local);\r\n\t\t\ttransition_in(button.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(dynamiccomponenttree.$$.fragment, local);\r\n\t\t\ttransition_out(button.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(form);\r\n\t\t\tdestroy_component(dynamiccomponenttree);\r\n\t\t\t/*div0_binding*/ ctx[64](null);\r\n\t\t\tdestroy_component(button);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction create_fragment$2(ctx) {\r\n\tlet util;\r\n\tlet current;\r\n\r\n\tutil = new Util({\r\n\t\t\tprops: {\r\n\t\t\t\t$$slots: { footer: [create_footer_slot] },\r\n\t\t\t\t$$scope: { ctx }\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tutil.$on(\"measure\", /*measure_handler*/ ctx[65]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(util.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(util, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, dirty) {\r\n\t\t\tconst util_changes = {};\r\n\r\n\t\t\tif (dirty[0] & /*footerStyle, fieldsGroup, tools, locale*/ 30 | dirty[3] & /*$$scope*/ 4) {\r\n\t\t\t\tutil_changes.$$scope = { dirty, ctx };\r\n\t\t\t}\r\n\r\n\t\t\tutil.$set(util_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(util.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(util.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(util, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$2($$self, $$props, $$invalidate) {\r\n\tlet sizePresetLabel;\r\n\tlet widthPresetLabel;\r\n\tlet heightPresetLabel;\r\n\tlet canRenderSizePresets;\r\n\tlet canRenderWidthPresets;\r\n\tlet canRenderHeightPresets;\r\n\tlet canRenderSizeInputs;\r\n\tlet tools;\r\n\tlet footerStyle;\r\n\tlet $footerOffset;\r\n\r\n\tlet $isActive,\r\n\t\t$$unsubscribe_isActive = noop,\r\n\t\t$$subscribe_isActive = () => ($$unsubscribe_isActive(), $$unsubscribe_isActive = subscribe(isActive, $$value => $$invalidate(48, $isActive = $$value)), isActive);\r\n\r\n\tlet $animation;\r\n\tlet $env;\r\n\tlet $imageCropRect;\r\n\tlet $imageCropRectAspectRatio;\r\n\tlet $iconActiveFraction;\r\n\tlet $heightPresetSelectedIndex;\r\n\tlet $formattedResizeHeightPresetOptions;\r\n\tlet $widthPresetSelectedIndex;\r\n\tlet $formattedResizeWidthPresetOptions;\r\n\tlet $sizePresetSelectedIndex;\r\n\tlet $formattedResizeSizePresetOptions;\r\n\tlet $imageOutputSize;\r\n\tlet $imageCropAspectRatio;\r\n\tlet $formattedResizeHeightPresetOptionsFlattened;\r\n\tlet $formattedResizeWidthPresetOptionsFlattened;\r\n\tlet $formattedResizeSizePresetOptionsFlattened;\r\n\tlet $imageSize;\r\n\tlet $imageSelectionZoom;\r\n\tlet $imageSelectionPan;\r\n\t$$self.$$.on_destroy.push(() => $$unsubscribe_isActive());\r\n\r\n\tconst formatValue = (value, min = 0, max = 9999) => {\r\n\t\tif (isString(value)) {\r\n\t\t\tvalue = value.replace(/\\D/g, '');\r\n\t\t\tif (!value.length) return;\r\n\t\t}\r\n\r\n\t\tconst v = Math.round(value);\r\n\t\tif (Number.isNaN(v)) return;\r\n\t\treturn clamp(v, min, max);\r\n\t};\r\n\r\n\tconst name = 'resize';\r\n\tlet { isActive } = $$props;\r\n\t$$subscribe_isActive();\r\n\tlet { stores } = $$props;\r\n\tlet { locale = {} } = $$props;\r\n\tlet { resizeMinSize = sizeCreate(1, 1) } = $$props;\r\n\tlet { resizeMaxSize = sizeCreate(9999, 9999) } = $$props;\r\n\tlet { resizeSizePresetOptions = undefined } = $$props;\r\n\tlet { resizeWidthPresetOptions = undefined } = $$props;\r\n\tlet { resizeHeightPresetOptions = undefined } = $$props;\r\n\tlet { resizeWillRenderFooter = passthrough } = $$props;\r\n\r\n\t// offset\r\n\tconst iconActiveFraction = spring(0, { stiffness: 0.15, damping: 0.3 });\r\n\r\n\tcomponent_subscribe($$self, iconActiveFraction, value => $$invalidate(53, $iconActiveFraction = value));\r\n\tconst { animation, imageSize, imageCropRect, imageCropRectAspectRatio, imageCropAspectRatio, imageOutputSize, imageSelectionZoom, imageSelectionPan, history, env, allowPan, allowZoom, enableZoomControls } = stores;\r\n\tcomponent_subscribe($$self, animation, value => $$invalidate(49, $animation = value));\r\n\tcomponent_subscribe($$self, imageSize, value => $$invalidate(72, $imageSize = value));\r\n\tcomponent_subscribe($$self, imageCropRect, value => $$invalidate(51, $imageCropRect = value));\r\n\tcomponent_subscribe($$self, imageCropRectAspectRatio, value => $$invalidate(52, $imageCropRectAspectRatio = value));\r\n\tcomponent_subscribe($$self, imageCropAspectRatio, value => $$invalidate(71, $imageCropAspectRatio = value));\r\n\tcomponent_subscribe($$self, imageOutputSize, value => $$invalidate(60, $imageOutputSize = value));\r\n\tcomponent_subscribe($$self, imageSelectionZoom, value => $$invalidate(73, $imageSelectionZoom = value));\r\n\tcomponent_subscribe($$self, imageSelectionPan, value => $$invalidate(74, $imageSelectionPan = value));\r\n\tcomponent_subscribe($$self, env, value => $$invalidate(50, $env = value));\r\n\tconst formId = getUniqueId();\r\n\tlet fieldsGroup;\r\n\tlet maintainAspectRatio = false;\r\n\tlet width;\r\n\tlet height;\r\n\tlet activeField;\r\n\tlet lastActiveField;\r\n\tlet storedImageSelectionPan = vectorCreateEmpty();\r\n\tlet storedImageSelectionZoom;\r\n\r\n\tconst rememberPanZoom = () => {\r\n\t\tstoredImageSelectionPan = $imageSelectionPan;\r\n\t\tstoredImageSelectionZoom = $imageSelectionZoom;\r\n\t};\r\n\r\n\t// zoom image preview so it scales to show the actual image output size\r\n\tconst updateSelectionScale = outputSize => {\r\n\t\t// always reset to center\r\n\t\tset_store_value(imageSelectionPan, $imageSelectionPan = vectorCreateEmpty(), $imageSelectionPan);\r\n\r\n\t\t// no resizing, zoom to actual size\r\n\t\tif (!outputSize || !$imageCropRect) {\r\n\t\t\tset_store_value(imageSelectionZoom, $imageSelectionZoom = 1, $imageSelectionZoom);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// zoom image to fit image target size\r\n\t\tset_store_value(imageSelectionZoom, $imageSelectionZoom = outputSize.width / $imageCropRect.width || outputSize.height / $imageCropRect.height, $imageSelectionZoom);\r\n\t};\r\n\r\n\tconst resetSelectionScale = () => {\r\n\t\tset_store_value(imageSelectionPan, $imageSelectionPan = storedImageSelectionPan, $imageSelectionPan);\r\n\t\tset_store_value(imageSelectionZoom, $imageSelectionZoom = storedImageSelectionZoom, $imageSelectionZoom);\r\n\t};\r\n\r\n\tconst getState = (value, field, activeField, resizeMinSize, resizeMaxSize) => value != null && activeField !== field\r\n\t? value >= resizeMinSize[field] && value <= resizeMaxSize[field]\r\n\t\t? 'valid'\r\n\t\t: 'invalid'\r\n\t: 'undetermined';\r\n\r\n\tconst getWidthPlaceholder = (value, cropAspectRatio, cropRect) => Math.round(value != null ? value * cropAspectRatio : cropRect.width);\r\n\r\n\tconst getHeightPlaceholder = (value, cropAspectRatio, cropRect) => Math.round(value != null\r\n\t? value / cropAspectRatio\r\n\t: cropRect.height);\r\n\r\n\t// populate active field\r\n\tconst handleFocusIn = e => {\r\n\t\tconst id = e.target.id;\r\n\r\n\t\tif ((/width/).test(id)) {\r\n\t\t\t$$invalidate(39, activeField = 'width');\r\n\t\t} else if ((/height/).test(id)) {\r\n\t\t\t$$invalidate(39, activeField = 'height');\r\n\t\t} else if ((/aspectRatio/i).test(id)) {\r\n\t\t\t$$invalidate(39, activeField = 'lock');\r\n\t\t} else {\r\n\t\t\t$$invalidate(39, activeField = undefined);\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleFocusOut = e => {\r\n\t\tif (!fieldsGroup.contains(e.relatedTarget)) handleSubmit();\r\n\t\t$$invalidate(39, activeField = undefined);\r\n\t};\r\n\r\n\t// sync fields if one has a value and aspect ratio should be maintained\r\n\tconst syncFields = () => {\r\n\t\tif (!maintainAspectRatio || !width || !height) return;\r\n\r\n\t\tif (activeField === 'width') {\r\n\t\t\t// sync height field\r\n\t\t\t$$invalidate(38, height = Math.round(width / $imageCropRectAspectRatio));\r\n\t\t} else if (activeField === 'height') {\r\n\t\t\t// sync width field\r\n\t\t\t$$invalidate(37, width = Math.round(height * $imageCropRectAspectRatio));\r\n\t\t} else {\r\n\t\t\tif (lastActiveField === 'width') {\r\n\t\t\t\t$$invalidate(38, height = Math.round(width / $imageCropRectAspectRatio));\r\n\t\t\t} else if (lastActiveField === 'height') {\r\n\t\t\t\t$$invalidate(37, width = Math.round(height * $imageCropRectAspectRatio));\r\n\t\t\t}\r\n\r\n\t\t\tconsolidateSize();\r\n\t\t}\r\n\t};\r\n\r\n\t// $: if (maintainAspectRatio && width && height) syncFields()\r\n\tconst consolidateSize = forcedAspectRatio => {\r\n\t\t// first need to limit values\r\n\t\tlet inputWidth = formatValue(width);\r\n\r\n\t\tlet inputHeight = formatValue(height);\r\n\t\tlet currentWidth = inputWidth;\r\n\t\tlet currentHeight = inputHeight;\r\n\t\tlet bothAxisDefined = currentWidth && currentHeight;\r\n\t\tlet aspectRatio = forcedAspectRatio || $imageCropRectAspectRatio;\r\n\r\n\t\t// done, no consolidation needed\r\n\t\tif (!currentWidth && !currentHeight) return;\r\n\r\n\t\t// need to fill in missing values\r\n\t\tif (currentWidth && !currentHeight) {\r\n\t\t\tcurrentHeight = Math.round(currentWidth / aspectRatio);\r\n\t\t} else if (currentHeight && !currentWidth) {\r\n\t\t\tcurrentWidth = Math.round(currentHeight * aspectRatio);\r\n\t\t}\r\n\r\n\t\taspectRatio = forcedAspectRatio || bothAxisDefined\r\n\t\t? getAspectRatio(currentWidth, currentHeight)\r\n\t\t: $imageCropRectAspectRatio;\r\n\r\n\t\t// now we have both width and height let's re-fit the min max size\r\n\t\tlet currentSize = sizeCreate(currentWidth, currentHeight);\r\n\r\n\t\tif (!sizeContains(resizeMaxSize, currentSize)) {\r\n\t\t\t// too big\r\n\t\t\tcurrentSize = rectContainRect(resizeMaxSize, aspectRatio);\r\n\t\t}\r\n\r\n\t\tif (!sizeContains(currentSize, resizeMinSize)) {\r\n\t\t\t// too small\r\n\t\t\tcurrentSize = rectCoverRect(resizeMinSize, aspectRatio);\r\n\t\t}\r\n\r\n\t\t$$invalidate(37, width = inputWidth != null\r\n\t\t? Math.round(currentSize.width)\r\n\t\t: undefined);\r\n\r\n\t\t$$invalidate(38, height = inputHeight != null\r\n\t\t? Math.round(currentSize.height)\r\n\t\t: undefined);\r\n\t};\r\n\r\n\tconst handleSubmit = () => {\r\n\t\t// calculate correct values\r\n\t\tconsolidateSize();\r\n\r\n\t\t// get curent values so we can check if they were changed (if not, no need to write history or update)\r\n\t\tconst { width: currentWidth, height: currentHeight } = $imageOutputSize || {};\r\n\r\n\t\t// no need to update\r\n\t\tif (currentWidth === width && currentHeight === height) return;\r\n\r\n\t\t// update state\r\n\t\tif (!width && !height) {\r\n\t\t\t// reset image crop\r\n\t\t\tset_store_value(imageCropAspectRatio, $imageCropAspectRatio = $imageSize.width / $imageSize.height, $imageCropAspectRatio);\r\n\r\n\t\t\tset_store_value(imageCropAspectRatio, $imageCropAspectRatio = undefined, $imageCropAspectRatio);\r\n\r\n\t\t\t// reset output size\r\n\t\t\tset_store_value(imageOutputSize, $imageOutputSize = undefined, $imageOutputSize);\r\n\t\t} else {\r\n\t\t\tif (width && height) set_store_value(imageCropAspectRatio, $imageCropAspectRatio = width / height, $imageCropAspectRatio);\r\n\t\t\tset_store_value(imageOutputSize, $imageOutputSize = sizeCreate(width, height), $imageOutputSize);\r\n\t\t}\r\n\r\n\t\thistory.write();\r\n\t};\r\n\r\n\t// handle external updates to outputSize\r\n\tconst imageOutputSizeUnsub = imageOutputSize.subscribe(size => {\r\n\t\tif (!size) {\r\n\t\t\t$$invalidate(37, width = undefined);\r\n\t\t\t$$invalidate(38, height = undefined);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t$$invalidate(37, width = size.width);\r\n\t\t$$invalidate(38, height = size.height);\r\n\r\n\t\t// make sure the size conforms to min max\r\n\t\tconsolidateSize();\r\n\t});\r\n\r\n\t// if the crop aspect ratio is changed we need to align width/height\r\n\tconst imageCropAspectRatioUnsub = imageCropAspectRatio.subscribe(cropAspectRatio => {\r\n\t\t// exit if no dimensions supplied\r\n\t\tif (!width && !height) return;\r\n\r\n\t\t// no crop aspect ratio has been selected, so all is fine\r\n\t\tif (!cropAspectRatio) return;\r\n\r\n\t\t// fix size to match new aspect ratio of the crop\r\n\t\tif (width && height && getAspectRatio(width, height) !== cropAspectRatio) {\r\n\t\t\t$$invalidate(38, height = width / cropAspectRatio);\r\n\t\t\tconsolidateSize(cropAspectRatio);\r\n\t\t} else {\r\n\t\t\tconsolidateSize();\r\n\t\t}\r\n\t});\r\n\r\n\t//\r\n\t// size presets\r\n\t//\r\n\tconst formatPresetDimensionOption = option => {\r\n\t\tif (isString(option[0])) {\r\n\t\t\toption[1] = option[1].map(formatPresetDimensionOption);\r\n\t\t\treturn option;\r\n\t\t}\r\n\r\n\t\treturn isNumber(option) ? [option, '' + option] : option;\r\n\t};\r\n\r\n\tconst formatPresetSizeOption = option => {\r\n\t\tif (isString(option[0])) {\r\n\t\t\toption[1] = option[1].map(formatPresetSizeOption);\r\n\t\t\treturn option;\r\n\t\t}\r\n\r\n\t\tlet [value, label] = option;\r\n\r\n\t\t// Size only\r\n\t\tif (isNumber(value) && isNumber(label)) {\r\n\t\t\tconst [w, h] = [value, label];\r\n\t\t\tlabel = `${w} &times; ${h}`;\r\n\t\t\tvalue = [w, h];\r\n\t\t}\r\n\r\n\t\treturn [value, label];\r\n\t};\r\n\r\n\tconst formattedResizeSizePresetOptions = writable();\r\n\tcomponent_subscribe($$self, formattedResizeSizePresetOptions, value => $$invalidate(59, $formattedResizeSizePresetOptions = value));\r\n\tconst formattedResizeSizePresetOptionsFlattened = writable();\r\n\tcomponent_subscribe($$self, formattedResizeSizePresetOptionsFlattened, value => $$invalidate(63, $formattedResizeSizePresetOptionsFlattened = value));\r\n\tconst formattedResizeWidthPresetOptions = writable();\r\n\tcomponent_subscribe($$self, formattedResizeWidthPresetOptions, value => $$invalidate(57, $formattedResizeWidthPresetOptions = value));\r\n\tconst formattedResizeWidthPresetOptionsFlattened = writable();\r\n\tcomponent_subscribe($$self, formattedResizeWidthPresetOptionsFlattened, value => $$invalidate(62, $formattedResizeWidthPresetOptionsFlattened = value));\r\n\tconst formattedResizeHeightPresetOptions = writable();\r\n\tcomponent_subscribe($$self, formattedResizeHeightPresetOptions, value => $$invalidate(55, $formattedResizeHeightPresetOptions = value));\r\n\tconst formattedResizeHeightPresetOptionsFlattened = writable();\r\n\tcomponent_subscribe($$self, formattedResizeHeightPresetOptionsFlattened, value => $$invalidate(61, $formattedResizeHeightPresetOptionsFlattened = value));\r\n\r\n\tconst sizePresetSelectedIndex = derived([imageOutputSize, formattedResizeSizePresetOptionsFlattened], ([$imageOutputSize, $formattedResizeSizePresetOptionsFlattened], set) => {\r\n\t\tif (!$formattedResizeSizePresetOptionsFlattened) return set(-1);\r\n\r\n\t\tconst index = $formattedResizeSizePresetOptionsFlattened.findIndex(([value]) => {\r\n\t\t\tif (!value && !$imageOutputSize) return true;\r\n\t\t\tif (!value) return false;\r\n\t\t\tconst [width, height] = value;\r\n\t\t\treturn $imageOutputSize.width === width && $imageOutputSize.height === height;\r\n\t\t});\r\n\r\n\t\tset(index < 0 ? 0 : index);\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, sizePresetSelectedIndex, value => $$invalidate(58, $sizePresetSelectedIndex = value));\r\n\r\n\tconst widthPresetSelectedIndex = derived([imageOutputSize, formattedResizeWidthPresetOptionsFlattened], ([$imageOutputSize, $formattedResizeWidthPresetOptionsFlattened], set) => {\r\n\t\tif (!$formattedResizeWidthPresetOptionsFlattened) return set(-1);\r\n\r\n\t\tconst index = $formattedResizeWidthPresetOptionsFlattened.findIndex(([value]) => {\r\n\t\t\tif (!value && !$imageOutputSize) return true;\r\n\t\t\tif (!value) return false;\r\n\t\t\treturn $imageOutputSize.width === value;\r\n\t\t});\r\n\r\n\t\tset(index < 0 ? 0 : index);\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, widthPresetSelectedIndex, value => $$invalidate(56, $widthPresetSelectedIndex = value));\r\n\r\n\tconst heightPresetSelectedIndex = derived([imageOutputSize, formattedResizeHeightPresetOptionsFlattened], ([$imageOutputSize, $formattedResizeHeightPresetOptionsFlattened], set) => {\r\n\t\tif (!$formattedResizeHeightPresetOptionsFlattened) return set(-1);\r\n\r\n\t\tconst index = $formattedResizeHeightPresetOptionsFlattened.findIndex(([value]) => {\r\n\t\t\tif (!value && !$imageOutputSize) return true;\r\n\t\t\tif (!value) return false;\r\n\t\t\treturn $imageOutputSize.height === value;\r\n\t\t});\r\n\r\n\t\tset(index < 0 ? 0 : index);\r\n\t});\r\n\r\n\tcomponent_subscribe($$self, heightPresetSelectedIndex, value => $$invalidate(54, $heightPresetSelectedIndex = value));\r\n\tlet storedCropRect = undefined;\r\n\tlet storedCropAspectRatio = undefined;\r\n\r\n\tconst setImageOutputSizeWithArray = size => {\r\n\t\tif (size && !storedCropRect) {\r\n\t\t\tstoredCropRect = { ...$imageCropRect };\r\n\t\t\tstoredCropAspectRatio = $imageCropAspectRatio;\r\n\t\t}\r\n\r\n\t\tif (!size) {\r\n\t\t\tset_store_value(imageCropRect, $imageCropRect = storedCropRect, $imageCropRect);\r\n\t\t\tset_store_value(imageCropAspectRatio, $imageCropAspectRatio = storedCropAspectRatio, $imageCropAspectRatio);\r\n\t\t\tset_store_value(imageOutputSize, $imageOutputSize = undefined, $imageOutputSize);\r\n\t\t\tstoredCropRect = undefined;\r\n\t\t\tstoredCropAspectRatio = undefined;\r\n\t\t} else {\r\n\t\t\tset_store_value(imageCropAspectRatio, $imageCropAspectRatio = getAspectRatio(size[0], size[1]), $imageCropAspectRatio);\r\n\t\t\tset_store_value(imageOutputSize, $imageOutputSize = sizeCreateFromArray(size), $imageOutputSize);\r\n\t\t}\r\n\r\n\t\thistory.write();\r\n\t};\r\n\r\n\t//\r\n\t// toolbar\r\n\t//\r\n\tconst redrawTrigger = getContext('redrawTrigger');\r\n\r\n\t//\r\n\t// Footer\r\n\t//\r\n\tconst footerOffset = spring($animation ? 20 : 0);\r\n\r\n\tcomponent_subscribe($$self, footerOffset, value => $$invalidate(47, $footerOffset = value));\r\n\r\n\t//\r\n\t// Clean up\r\n\t//\r\n\tonDestroy(() => {\r\n\t\timageOutputSizeUnsub();\r\n\t\timageCropAspectRatioUnsub();\r\n\t});\r\n\r\n\tfunction div0_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\tfieldsGroup = $$value;\r\n\t\t\t$$invalidate(2, fieldsGroup);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction measure_handler(event) {\r\n\t\tbubble.call(this, $$self, event);\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('isActive' in $$props) $$subscribe_isActive($$invalidate(0, isActive = $$props.isActive));\r\n\t\tif ('stores' in $$props) $$invalidate(29, stores = $$props.stores);\r\n\t\tif ('locale' in $$props) $$invalidate(1, locale = $$props.locale);\r\n\t\tif ('resizeMinSize' in $$props) $$invalidate(30, resizeMinSize = $$props.resizeMinSize);\r\n\t\tif ('resizeMaxSize' in $$props) $$invalidate(31, resizeMaxSize = $$props.resizeMaxSize);\r\n\t\tif ('resizeSizePresetOptions' in $$props) $$invalidate(32, resizeSizePresetOptions = $$props.resizeSizePresetOptions);\r\n\t\tif ('resizeWidthPresetOptions' in $$props) $$invalidate(33, resizeWidthPresetOptions = $$props.resizeWidthPresetOptions);\r\n\t\tif ('resizeHeightPresetOptions' in $$props) $$invalidate(34, resizeHeightPresetOptions = $$props.resizeHeightPresetOptions);\r\n\t\tif ('resizeWillRenderFooter' in $$props) $$invalidate(35, resizeWillRenderFooter = $$props.resizeWillRenderFooter);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[1] & /*$isActive*/ 131072) {\r\n\t\t\t// fully disable pan and zoom when resize tool is active\r\n\t\t\tallowPan.set(!$isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$isActive*/ 131072) {\r\n\t\t\tallowZoom.set(!$isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$isActive*/ 131072) {\r\n\t\t\tenableZoomControls.set(!$isActive);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*resizeSizePresetOptions, $formattedResizeSizePresetOptions*/ 268435458) {\r\n\t\t\tif (resizeSizePresetOptions) {\r\n\t\t\t\tset_store_value(formattedResizeSizePresetOptions, $formattedResizeSizePresetOptions = resizeSizePresetOptions.map(formatPresetSizeOption), $formattedResizeSizePresetOptions);\r\n\t\t\t\tset_store_value(formattedResizeSizePresetOptionsFlattened, $formattedResizeSizePresetOptionsFlattened = flattenOptions($formattedResizeSizePresetOptions), $formattedResizeSizePresetOptionsFlattened);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$formattedResizeSizePresetOptions*/ 268435456) {\r\n\t\t\t//\r\n\t\t\t// helper bools\r\n\t\t\t//\r\n\t\t\t$$invalidate(46, canRenderSizePresets = !!$formattedResizeSizePresetOptions);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$sizePresetSelectedIndex*/ 134217728 | $$self.$$.dirty[2] & /*$formattedResizeSizePresetOptionsFlattened*/ 2) {\r\n\t\t\t$$invalidate(45, sizePresetLabel = $sizePresetSelectedIndex > -1 && $formattedResizeSizePresetOptionsFlattened[$sizePresetSelectedIndex][1]);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*resizeWidthPresetOptions, $formattedResizeWidthPresetOptions*/ 67108868) {\r\n\t\t\tif (resizeWidthPresetOptions) {\r\n\t\t\t\tset_store_value(formattedResizeWidthPresetOptions, $formattedResizeWidthPresetOptions = resizeWidthPresetOptions.map(formatPresetDimensionOption), $formattedResizeWidthPresetOptions);\r\n\t\t\t\tset_store_value(formattedResizeWidthPresetOptionsFlattened, $formattedResizeWidthPresetOptionsFlattened = flattenOptions($formattedResizeWidthPresetOptions), $formattedResizeWidthPresetOptionsFlattened);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*canRenderSizePresets, $formattedResizeWidthPresetOptions*/ 67141632) {\r\n\t\t\t$$invalidate(43, canRenderWidthPresets = !canRenderSizePresets && $formattedResizeWidthPresetOptions);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$widthPresetSelectedIndex*/ 33554432 | $$self.$$.dirty[2] & /*$formattedResizeWidthPresetOptionsFlattened*/ 1) {\r\n\t\t\t$$invalidate(44, widthPresetLabel = $widthPresetSelectedIndex > -1 && $formattedResizeWidthPresetOptionsFlattened[$widthPresetSelectedIndex][1]);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*resizeHeightPresetOptions, $formattedResizeHeightPresetOptions*/ 16777224) {\r\n\t\t\tif (resizeHeightPresetOptions) {\r\n\t\t\t\tset_store_value(formattedResizeHeightPresetOptions, $formattedResizeHeightPresetOptions = resizeHeightPresetOptions.map(formatPresetDimensionOption), $formattedResizeHeightPresetOptions);\r\n\t\t\t\tset_store_value(formattedResizeHeightPresetOptionsFlattened, $formattedResizeHeightPresetOptionsFlattened = flattenOptions($formattedResizeHeightPresetOptions), $formattedResizeHeightPresetOptionsFlattened);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*canRenderSizePresets, $formattedResizeHeightPresetOptions*/ 16809984) {\r\n\t\t\t$$invalidate(42, canRenderHeightPresets = !canRenderSizePresets && $formattedResizeHeightPresetOptions);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$heightPresetSelectedIndex, $formattedResizeHeightPresetOptionsFlattened*/ 1082130432) {\r\n\t\t\t$$invalidate(41, heightPresetLabel = $heightPresetSelectedIndex > -1 && $formattedResizeHeightPresetOptionsFlattened[$heightPresetSelectedIndex][1]);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*canRenderSizePresets, canRenderWidthPresets, canRenderHeightPresets*/ 38912) {\r\n\t\t\t$$invalidate(40, canRenderSizeInputs = !canRenderSizePresets && !canRenderWidthPresets && !canRenderHeightPresets);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*locale, resizeMinSize*/ 1073741826 | $$self.$$.dirty[1] & /*resizeWillRenderFooter, canRenderSizePresets, sizePresetLabel, $formattedResizeSizePresetOptions, $sizePresetSelectedIndex, canRenderWidthPresets, widthPresetLabel, $formattedResizeWidthPresetOptions, $widthPresetSelectedIndex, canRenderHeightPresets, heightPresetLabel, $formattedResizeHeightPresetOptions, $heightPresetSelectedIndex, canRenderSizeInputs, height, $imageCropRectAspectRatio, $imageCropRect, width, activeField, resizeMaxSize, maintainAspectRatio, $iconActiveFraction, $env*/ 536412145) {\r\n\t\t\t$$invalidate(4, tools = redrawTrigger && runSafe(() => resizeWillRenderFooter(\r\n\t\t\t\t[\r\n\t\t\t\t\tcanRenderSizePresets && [\r\n\t\t\t\t\t\t'Dropdown',\r\n\t\t\t\t\t\t'size-presets',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlabel: sizePresetLabel,\r\n\t\t\t\t\t\t\toptions: $formattedResizeSizePresetOptions,\r\n\t\t\t\t\t\t\tonchange: item => setImageOutputSizeWithArray(item.value),\r\n\t\t\t\t\t\t\tselectedIndex: $sizePresetSelectedIndex\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\tcanRenderWidthPresets && [\r\n\t\t\t\t\t\t'Dropdown',\r\n\t\t\t\t\t\t'width-presets',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlabel: widthPresetLabel,\r\n\t\t\t\t\t\t\toptions: $formattedResizeWidthPresetOptions,\r\n\t\t\t\t\t\t\tonchange: item => {\r\n\t\t\t\t\t\t\t\t$$invalidate(37, width = item.value);\r\n\t\t\t\t\t\t\t\thandleSubmit();\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tselectedIndex: $widthPresetSelectedIndex\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\tcanRenderWidthPresets && canRenderHeightPresets && [\r\n\t\t\t\t\t\t'span',\r\n\t\t\t\t\t\t'times',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tclass: 'PinturaResizeLabel',\r\n\t\t\t\t\t\t\tinnerHTML: '&times;'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\tcanRenderHeightPresets && [\r\n\t\t\t\t\t\t'Dropdown',\r\n\t\t\t\t\t\t'height-presets',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlabel: heightPresetLabel,\r\n\t\t\t\t\t\t\toptions: $formattedResizeHeightPresetOptions,\r\n\t\t\t\t\t\t\tonchange: item => {\r\n\t\t\t\t\t\t\t\t$$invalidate(38, height = item.value);\r\n\t\t\t\t\t\t\t\thandleSubmit();\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tselectedIndex: $heightPresetSelectedIndex\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\tcanRenderSizeInputs && [\r\n\t\t\t\t\t\tDimensionInput,\r\n\t\t\t\t\t\t'width-input',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid: `width-${formId}`,\r\n\t\t\t\t\t\t\ttitle: locale.resizeTitleInputWidth,\r\n\t\t\t\t\t\t\tlabel: locale.resizeLabelInputWidth,\r\n\t\t\t\t\t\t\tplaceholder: getWidthPlaceholder(formatValue(height), $imageCropRectAspectRatio, $imageCropRect),\r\n\t\t\t\t\t\t\tvalue: width,\r\n\t\t\t\t\t\t\tstate: getState(formatValue(width), 'width', activeField, resizeMinSize, resizeMaxSize),\r\n\t\t\t\t\t\t\tonchange: value => {\r\n\t\t\t\t\t\t\t\t$$invalidate(37, width = value);\r\n\t\t\t\t\t\t\t\tsyncFields();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\tcanRenderSizeInputs && [\r\n\t\t\t\t\t\tDimensionLock,\r\n\t\t\t\t\t\t'aspect-ratio-lock',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid: `aspect-ratio-lock-${formId}`,\r\n\t\t\t\t\t\t\ttitle: locale.resizeTitleButtonMaintainAspectRatio,\r\n\t\t\t\t\t\t\ticon: isString(locale.resizeIconButtonMaintainAspectRatio)\r\n\t\t\t\t\t\t\t? locale.resizeIconButtonMaintainAspectRatio\r\n\t\t\t\t\t\t\t: locale.resizeIconButtonMaintainAspectRatio(maintainAspectRatio, $iconActiveFraction),\r\n\t\t\t\t\t\t\tlocked: maintainAspectRatio,\r\n\t\t\t\t\t\t\tonchange: locked => {\r\n\t\t\t\t\t\t\t\t$$invalidate(36, maintainAspectRatio = locked);\r\n\t\t\t\t\t\t\t\tsyncFields();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\tcanRenderSizeInputs && [\r\n\t\t\t\t\t\tDimensionInput,\r\n\t\t\t\t\t\t'height-input',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid: `height-${formId}`,\r\n\t\t\t\t\t\t\ttitle: locale.resizeTitleInputHeight,\r\n\t\t\t\t\t\t\tlabel: locale.resizeLabelInputHeight,\r\n\t\t\t\t\t\t\tplaceholder: getHeightPlaceholder(formatValue(width), $imageCropRectAspectRatio, $imageCropRect),\r\n\t\t\t\t\t\t\tvalue: height,\r\n\t\t\t\t\t\t\tstate: getState(formatValue(height), 'height', activeField, resizeMinSize, resizeMaxSize),\r\n\t\t\t\t\t\t\tonchange: value => {\r\n\t\t\t\t\t\t\t\t$$invalidate(38, height = value);\r\n\t\t\t\t\t\t\t\tsyncFields();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t].filter(Boolean),\r\n\t\t\t\t{ ...$env },\r\n\t\t\t\t() => redrawTrigger.set({})\r\n\t\t\t)).filter(Boolean));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*maintainAspectRatio*/ 32) {\r\n\t\t\ticonActiveFraction.set(maintainAspectRatio ? 1 : 0);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*activeField*/ 256) {\r\n\t\t\tif (activeField) lastActiveField = activeField;\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$isActive*/ 131072) {\r\n\t\t\tif ($isActive) rememberPanZoom();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$isActive, $imageOutputSize*/ 537001984) {\r\n\t\t\t$isActive\r\n\t\t\t? updateSelectionScale($imageOutputSize)\r\n\t\t\t: resetSelectionScale();\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$animation, $isActive*/ 393216) {\r\n\t\t\t$animation && footerOffset.set($isActive ? 0 : 20);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[1] & /*$footerOffset*/ 65536) {\r\n\t\t\t$$invalidate(3, footerStyle = $footerOffset\r\n\t\t\t? `transform: translateY(${$footerOffset}px)`\r\n\t\t\t: undefined);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tisActive,\r\n\t\tlocale,\r\n\t\tfieldsGroup,\r\n\t\tfooterStyle,\r\n\t\ttools,\r\n\t\ticonActiveFraction,\r\n\t\tanimation,\r\n\t\timageSize,\r\n\t\timageCropRect,\r\n\t\timageCropRectAspectRatio,\r\n\t\timageCropAspectRatio,\r\n\t\timageOutputSize,\r\n\t\timageSelectionZoom,\r\n\t\timageSelectionPan,\r\n\t\tenv,\r\n\t\thandleFocusIn,\r\n\t\thandleFocusOut,\r\n\t\thandleSubmit,\r\n\t\tformattedResizeSizePresetOptions,\r\n\t\tformattedResizeSizePresetOptionsFlattened,\r\n\t\tformattedResizeWidthPresetOptions,\r\n\t\tformattedResizeWidthPresetOptionsFlattened,\r\n\t\tformattedResizeHeightPresetOptions,\r\n\t\tformattedResizeHeightPresetOptionsFlattened,\r\n\t\tsizePresetSelectedIndex,\r\n\t\twidthPresetSelectedIndex,\r\n\t\theightPresetSelectedIndex,\r\n\t\tfooterOffset,\r\n\t\tname,\r\n\t\tstores,\r\n\t\tresizeMinSize,\r\n\t\tresizeMaxSize,\r\n\t\tresizeSizePresetOptions,\r\n\t\tresizeWidthPresetOptions,\r\n\t\tresizeHeightPresetOptions,\r\n\t\tresizeWillRenderFooter,\r\n\t\tmaintainAspectRatio,\r\n\t\twidth,\r\n\t\theight,\r\n\t\tactiveField,\r\n\t\tcanRenderSizeInputs,\r\n\t\theightPresetLabel,\r\n\t\tcanRenderHeightPresets,\r\n\t\tcanRenderWidthPresets,\r\n\t\twidthPresetLabel,\r\n\t\tsizePresetLabel,\r\n\t\tcanRenderSizePresets,\r\n\t\t$footerOffset,\r\n\t\t$isActive,\r\n\t\t$animation,\r\n\t\t$env,\r\n\t\t$imageCropRect,\r\n\t\t$imageCropRectAspectRatio,\r\n\t\t$iconActiveFraction,\r\n\t\t$heightPresetSelectedIndex,\r\n\t\t$formattedResizeHeightPresetOptions,\r\n\t\t$widthPresetSelectedIndex,\r\n\t\t$formattedResizeWidthPresetOptions,\r\n\t\t$sizePresetSelectedIndex,\r\n\t\t$formattedResizeSizePresetOptions,\r\n\t\t$imageOutputSize,\r\n\t\t$formattedResizeHeightPresetOptionsFlattened,\r\n\t\t$formattedResizeWidthPresetOptionsFlattened,\r\n\t\t$formattedResizeSizePresetOptionsFlattened,\r\n\t\tdiv0_binding,\r\n\t\tmeasure_handler\r\n\t];\r\n}\r\n\r\nclass Resize extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance$2,\r\n\t\t\tcreate_fragment$2,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\tname: 28,\r\n\t\t\t\tisActive: 0,\r\n\t\t\t\tstores: 29,\r\n\t\t\t\tlocale: 1,\r\n\t\t\t\tresizeMinSize: 30,\r\n\t\t\t\tresizeMaxSize: 31,\r\n\t\t\t\tresizeSizePresetOptions: 32,\r\n\t\t\t\tresizeWidthPresetOptions: 33,\r\n\t\t\t\tresizeHeightPresetOptions: 34,\r\n\t\t\t\tresizeWillRenderFooter: 35\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1, -1, -1]\r\n\t\t);\r\n\t}\r\n\r\n\tget name() {\r\n\t\treturn this.$$.ctx[28];\r\n\t}\r\n\r\n\tget isActive() {\r\n\t\treturn this.$$.ctx[0];\r\n\t}\r\n\r\n\tset isActive(isActive) {\r\n\t\tthis.$$set({ isActive });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stores() {\r\n\t\treturn this.$$.ctx[29];\r\n\t}\r\n\r\n\tset stores(stores) {\r\n\t\tthis.$$set({ stores });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget locale() {\r\n\t\treturn this.$$.ctx[1];\r\n\t}\r\n\r\n\tset locale(locale) {\r\n\t\tthis.$$set({ locale });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget resizeMinSize() {\r\n\t\treturn this.$$.ctx[30];\r\n\t}\r\n\r\n\tset resizeMinSize(resizeMinSize) {\r\n\t\tthis.$$set({ resizeMinSize });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget resizeMaxSize() {\r\n\t\treturn this.$$.ctx[31];\r\n\t}\r\n\r\n\tset resizeMaxSize(resizeMaxSize) {\r\n\t\tthis.$$set({ resizeMaxSize });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget resizeSizePresetOptions() {\r\n\t\treturn this.$$.ctx[32];\r\n\t}\r\n\r\n\tset resizeSizePresetOptions(resizeSizePresetOptions) {\r\n\t\tthis.$$set({ resizeSizePresetOptions });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget resizeWidthPresetOptions() {\r\n\t\treturn this.$$.ctx[33];\r\n\t}\r\n\r\n\tset resizeWidthPresetOptions(resizeWidthPresetOptions) {\r\n\t\tthis.$$set({ resizeWidthPresetOptions });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget resizeHeightPresetOptions() {\r\n\t\treturn this.$$.ctx[34];\r\n\t}\r\n\r\n\tset resizeHeightPresetOptions(resizeHeightPresetOptions) {\r\n\t\tthis.$$set({ resizeHeightPresetOptions });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget resizeWillRenderFooter() {\r\n\t\treturn this.$$.ctx[35];\r\n\t}\r\n\r\n\tset resizeWillRenderFooter(resizeWillRenderFooter) {\r\n\t\tthis.$$set({ resizeWillRenderFooter });\r\n\t\tflush();\r\n\t}\r\n}\r\n\r\n// @ts-ignore\r\nvar _plugin_resize = { util: ['resize', Resize, ({ duration }) => !duration] };\r\n\r\n/* src/core/ui/plugins/redact/index.svelte generated by Svelte v3.50.1 */\r\n\r\nfunction create_fragment$1(ctx) {\r\n\tlet shapeutil;\r\n\tlet current;\r\n\r\n\tshapeutil = new ShapeUtil({\r\n\t\t\tprops: {\r\n\t\t\t\tstores: /*stores*/ ctx[3],\r\n\t\t\t\tlocale: /*locale*/ ctx[4],\r\n\t\t\t\tisActive: /*isActive*/ ctx[0],\r\n\t\t\t\tisActiveFraction: /*isActiveFraction*/ ctx[1],\r\n\t\t\t\tisVisible: /*isVisible*/ ctx[2],\r\n\t\t\t\tmapScreenPointToImagePoint: /*mapScreenPointToImagePoint*/ ctx[9],\r\n\t\t\t\tmapImagePointToScreenPoint: /*mapImagePointToScreenPoint*/ ctx[8],\r\n\t\t\t\tutilKey: 'redact',\r\n\t\t\t\timageRotation: /*$imageRotation*/ ctx[10],\r\n\t\t\t\timageFlipX: /*$imageFlipX*/ ctx[7],\r\n\t\t\t\timageFlipY: /*$imageFlipY*/ ctx[6],\r\n\t\t\t\tshapes: /*imageRedaction*/ ctx[11],\r\n\t\t\t\ttoolbar: ['rect'],\r\n\t\t\t\ttoolShapes: {\r\n\t\t\t\t\trectangle: [{ x: 0, y: 0, width: 0, height: 0 }]\r\n\t\t\t\t},\r\n\t\t\t\ttoolActive: 'rectangle',\r\n\t\t\t\tparentRect: /*imageSize*/ ctx[13],\r\n\t\t\t\tenablePresetDropImage: false,\r\n\t\t\t\tenablePresetSelectImage: false,\r\n\t\t\t\twillStartInteraction: /*markupEditorWillStartInteraction*/ ctx[5],\r\n\t\t\t\thooks: {\r\n\t\t\t\t\twillRenderShapeControls: /*func*/ ctx[24]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tshapeutil.$on(\"measure\", /*measure_handler*/ ctx[25]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tcreate_component(shapeutil.$$.fragment);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tmount_component(shapeutil, target, anchor);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\tp(ctx, [dirty]) {\r\n\t\t\tconst shapeutil_changes = {};\r\n\t\t\tif (dirty & /*stores*/ 8) shapeutil_changes.stores = /*stores*/ ctx[3];\r\n\t\t\tif (dirty & /*locale*/ 16) shapeutil_changes.locale = /*locale*/ ctx[4];\r\n\t\t\tif (dirty & /*isActive*/ 1) shapeutil_changes.isActive = /*isActive*/ ctx[0];\r\n\t\t\tif (dirty & /*isActiveFraction*/ 2) shapeutil_changes.isActiveFraction = /*isActiveFraction*/ ctx[1];\r\n\t\t\tif (dirty & /*isVisible*/ 4) shapeutil_changes.isVisible = /*isVisible*/ ctx[2];\r\n\t\t\tif (dirty & /*mapScreenPointToImagePoint*/ 512) shapeutil_changes.mapScreenPointToImagePoint = /*mapScreenPointToImagePoint*/ ctx[9];\r\n\t\t\tif (dirty & /*mapImagePointToScreenPoint*/ 256) shapeutil_changes.mapImagePointToScreenPoint = /*mapImagePointToScreenPoint*/ ctx[8];\r\n\t\t\tif (dirty & /*$imageRotation*/ 1024) shapeutil_changes.imageRotation = /*$imageRotation*/ ctx[10];\r\n\t\t\tif (dirty & /*$imageFlipX*/ 128) shapeutil_changes.imageFlipX = /*$imageFlipX*/ ctx[7];\r\n\t\t\tif (dirty & /*$imageFlipY*/ 64) shapeutil_changes.imageFlipY = /*$imageFlipY*/ ctx[6];\r\n\t\t\tif (dirty & /*markupEditorWillStartInteraction*/ 32) shapeutil_changes.willStartInteraction = /*markupEditorWillStartInteraction*/ ctx[5];\r\n\t\t\tshapeutil.$set(shapeutil_changes);\r\n\t\t},\r\n\t\ti(local) {\r\n\t\t\tif (current) return;\r\n\t\t\ttransition_in(shapeutil.$$.fragment, local);\r\n\t\t\tcurrent = true;\r\n\t\t},\r\n\t\to(local) {\r\n\t\t\ttransition_out(shapeutil.$$.fragment, local);\r\n\t\t\tcurrent = false;\r\n\t\t},\r\n\t\td(detaching) {\r\n\t\t\tdestroy_component(shapeutil, detaching);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance$1($$self, $$props, $$invalidate) {\r\n\tlet mapScreenPointToImagePoint;\r\n\tlet mapImagePointToScreenPoint;\r\n\tlet $imageFlipY;\r\n\tlet $imageFlipX;\r\n\tlet $imageTransformsInterpolated;\r\n\tlet $imageTransforms;\r\n\tlet $imageSize;\r\n\tlet $rootRect;\r\n\tlet $imageRotation;\r\n\tconst name = 'redact';\r\n\tlet { isActive } = $$props;\r\n\tlet { isActiveFraction } = $$props;\r\n\tlet { isVisible } = $$props;\r\n\tlet { stores } = $$props;\r\n\tlet { locale = {} } = $$props;\r\n\tlet { markupEditorWillStartInteraction = undefined } = $$props;\r\n\r\n\t// connect filter choice to stores\r\n\tconst { imageRedaction, rootRect, imageSize, imageRotation, imageFlipX, imageFlipY, imageTransforms, imageTransformsInterpolated } = stores;\r\n\r\n\tcomponent_subscribe($$self, rootRect, value => $$invalidate(23, $rootRect = value));\r\n\tcomponent_subscribe($$self, imageSize, value => $$invalidate(22, $imageSize = value));\r\n\tcomponent_subscribe($$self, imageRotation, value => $$invalidate(10, $imageRotation = value));\r\n\tcomponent_subscribe($$self, imageFlipX, value => $$invalidate(7, $imageFlipX = value));\r\n\tcomponent_subscribe($$self, imageFlipY, value => $$invalidate(6, $imageFlipY = value));\r\n\tcomponent_subscribe($$self, imageTransforms, value => $$invalidate(21, $imageTransforms = value));\r\n\tcomponent_subscribe($$self, imageTransformsInterpolated, value => $$invalidate(20, $imageTransformsInterpolated = value));\r\n\r\n\tconst func = controls => {\r\n\t\tconst children = getNodeChildren(controls[0]);\r\n\t\tremoveNode('to-front', children);\r\n\t\treturn controls;\r\n\t};\r\n\r\n\tfunction measure_handler(event) {\r\n\t\tbubble.call(this, $$self, event);\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('isActive' in $$props) $$invalidate(0, isActive = $$props.isActive);\r\n\t\tif ('isActiveFraction' in $$props) $$invalidate(1, isActiveFraction = $$props.isActiveFraction);\r\n\t\tif ('isVisible' in $$props) $$invalidate(2, isVisible = $$props.isVisible);\r\n\t\tif ('stores' in $$props) $$invalidate(3, stores = $$props.stores);\r\n\t\tif ('locale' in $$props) $$invalidate(4, locale = $$props.locale);\r\n\t\tif ('markupEditorWillStartInteraction' in $$props) $$invalidate(5, markupEditorWillStartInteraction = $$props.markupEditorWillStartInteraction);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty & /*$rootRect, $imageSize, $imageTransformsInterpolated, $imageTransforms, $imageFlipX, $imageFlipY*/ 15728832) {\r\n\t\t\t//\r\n\t\t\t// Mapping coordinates\r\n\t\t\t//\r\n\t\t\t$$invalidate(9, mapScreenPointToImagePoint = point => _mapScreenPointToImagePoint(point, $rootRect, $imageSize, $imageTransformsInterpolated.origin, $imageTransformsInterpolated.translation, $imageTransforms.rotation.z, $imageTransformsInterpolated.scale, $imageFlipX, $imageFlipY));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty & /*$rootRect, $imageSize, $imageTransformsInterpolated, $imageTransforms, $imageFlipX, $imageFlipY*/ 15728832) {\r\n\t\t\t$$invalidate(8, mapImagePointToScreenPoint = point => _mapImagePointToScreenPoint(point, $rootRect, $imageSize, $imageTransformsInterpolated.origin, $imageTransformsInterpolated.translation, $imageTransforms.rotation.z, $imageTransformsInterpolated.scale, $imageFlipX, $imageFlipY));\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\tisActive,\r\n\t\tisActiveFraction,\r\n\t\tisVisible,\r\n\t\tstores,\r\n\t\tlocale,\r\n\t\tmarkupEditorWillStartInteraction,\r\n\t\t$imageFlipY,\r\n\t\t$imageFlipX,\r\n\t\tmapImagePointToScreenPoint,\r\n\t\tmapScreenPointToImagePoint,\r\n\t\t$imageRotation,\r\n\t\timageRedaction,\r\n\t\trootRect,\r\n\t\timageSize,\r\n\t\timageRotation,\r\n\t\timageFlipX,\r\n\t\timageFlipY,\r\n\t\timageTransforms,\r\n\t\timageTransformsInterpolated,\r\n\t\tname,\r\n\t\t$imageTransformsInterpolated,\r\n\t\t$imageTransforms,\r\n\t\t$imageSize,\r\n\t\t$rootRect,\r\n\t\tfunc,\r\n\t\tmeasure_handler\r\n\t];\r\n}\r\n\r\nclass Redact extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(this, options, instance$1, create_fragment$1, safe_not_equal, {\r\n\t\t\tname: 19,\r\n\t\t\tisActive: 0,\r\n\t\t\tisActiveFraction: 1,\r\n\t\t\tisVisible: 2,\r\n\t\t\tstores: 3,\r\n\t\t\tlocale: 4,\r\n\t\t\tmarkupEditorWillStartInteraction: 5\r\n\t\t});\r\n\t}\r\n\r\n\tget name() {\r\n\t\treturn this.$$.ctx[19];\r\n\t}\r\n\r\n\tget isActive() {\r\n\t\treturn this.$$.ctx[0];\r\n\t}\r\n\r\n\tset isActive(isActive) {\r\n\t\tthis.$$set({ isActive });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget isActiveFraction() {\r\n\t\treturn this.$$.ctx[1];\r\n\t}\r\n\r\n\tset isActiveFraction(isActiveFraction) {\r\n\t\tthis.$$set({ isActiveFraction });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget isVisible() {\r\n\t\treturn this.$$.ctx[2];\r\n\t}\r\n\r\n\tset isVisible(isVisible) {\r\n\t\tthis.$$set({ isVisible });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget stores() {\r\n\t\treturn this.$$.ctx[3];\r\n\t}\r\n\r\n\tset stores(stores) {\r\n\t\tthis.$$set({ stores });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget locale() {\r\n\t\treturn this.$$.ctx[4];\r\n\t}\r\n\r\n\tset locale(locale) {\r\n\t\tthis.$$set({ locale });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget markupEditorWillStartInteraction() {\r\n\t\treturn this.$$.ctx[5];\r\n\t}\r\n\r\n\tset markupEditorWillStartInteraction(markupEditorWillStartInteraction) {\r\n\t\tthis.$$set({ markupEditorWillStartInteraction });\r\n\t\tflush();\r\n\t}\r\n}\r\n\r\n// @ts-ignore\r\nvar _plugin_redact = { util: ['redact', Redact, ({ duration }) => !duration] };\r\n\r\nconst IconCross =\r\n    '<g fill=\"none\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\"><path d=\"M18 6L6 18M6 6l12 12\"></path></path></g>';\r\n\r\nconst CharacterA =\r\n    '<path fill=\"none\" d=\"M9 15 L12 9 L15 15 M10 13.5 h3\" stroke=\"currentColor\" stroke-width=\".125em\"/>';\r\n\r\nvar _locale_en_gb = {\r\n    // generic\r\n    labelReset: 'Reset',\r\n    labelDefault: 'Default',\r\n    labelAuto: 'Auto',\r\n    labelNone: 'None',\r\n    labelEdit: 'Edit',\r\n    labelClose: 'Close',\r\n    labelSupportError: (features) => `${features.join(', ')} not supported on this browser`,\r\n\r\n    // defaults\r\n    labelColor: 'Color',\r\n    labelWidth: 'Width',\r\n    labelSize: 'Size',\r\n    labelOffset: 'Offset',\r\n    labelAmount: 'Amount',\r\n    labelInset: 'Inset',\r\n    labelRadius: 'Radius',\r\n\r\n    // controls\r\n    labelColorPalette: 'Color palette',\r\n\r\n    // sizes\r\n    labelSizeExtraSmall: 'Extra small',\r\n    labelSizeSmall: 'Small',\r\n    labelSizeMediumSmall: 'Medium small',\r\n    labelSizeMedium: 'Medium',\r\n    labelSizeMediumLarge: 'Medium large',\r\n    labelSizeLarge: 'Large',\r\n    labelSizeExtraLarge: 'Extra large',\r\n\r\n    // default buttons\r\n\r\n    labelButtonCancel: 'Cancel',\r\n    labelButtonUndo: 'Undo',\r\n    labelButtonRedo: 'Redo',\r\n    labelButtonRevert: 'Revert',\r\n    labelButtonExport: 'Done',\r\n\r\n    // zoom\r\n    labelZoomIn: 'Zoom in',\r\n    labelZoomOut: 'Zoom out',\r\n    labelZoomFit: 'Fit to view',\r\n    labelZoomActual: 'Actual size',\r\n    iconZoomIn: '<path stroke=\"currentColor\" stroke-width=\".125em\" d=\"M8 12 h8 M12 8 v8\" />',\r\n    iconZoomOut: '<path stroke=\"currentColor\" stroke-width=\".125em\" d=\"M9 12 h6\" />',\r\n\r\n    // icons\r\n    iconSupportError: `<g fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z\"/><g><line x1=\"12\" y1=\"9\" x2=\"12\" y2=\"13\"/><line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"/></g>`,\r\n    iconButtonClose: IconCross,\r\n    iconButtonRevert: `<g fill=\"none\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\"><path d=\"M7.388 18.538a8 8 0 10-2.992-9.03\"/><path fill=\"currentColor\" d=\"M2.794 11.696L2.37 6.714l5.088 3.18z\"/><path d=\"M12 8v4M12 12l4 2\"/></g>`,\r\n    iconButtonUndo: `<g fill=\"none\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\"><path d=\"M10 8h4c2.485 0 5 2 5 5s-2.515 5-5 5h-4\"/><path fill=\"currentColor\" d=\"M5 8l4-3v6z\"/></g>`,\r\n    iconButtonRedo: `<g fill=\"none\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\"><path d=\"M14 8h-4c-2.485 0-5 2-5 5s2.515 5 5 5h4\"/><path fill=\"currentColor\" d=\"M19 8l-4-3v6z\"/></g>`,\r\n    iconButtonExport: `<polyline points=\"20 6 9 17 4 12\" fill=\"none\" stroke=\"currentColor\" stroke-width=\".125em\"></polyline>`,\r\n    iconButtonSelectImage: `<g fill=\"none\" stroke=\"currentColor\" stroke-width=\"0.0625em\"><path d=\"M8 21 L15 11 L19 15\"/><path d=\"M15 2 v5 h5\"/><path d=\"M8 2 h8 l4 4 v12 q0 4 -4 4 h-8 q-4 0 -4 -4 v-12 q0 -4 4 -4z\"/></g><circle fill=\"currentColor\" cx=\"10\" cy=\"8\" r=\"1.5\"/>`,\r\n\r\n    // status\r\n    statusLabelButtonClose: 'Close',\r\n    statusIconButtonClose: IconCross,\r\n    statusLabelLoadImage: (state) => {\r\n        if (!state || !state.task) return 'Waiting for image';\r\n        if (state.error)\r\n            return state.error.code === 'IMAGE_TOO_SMALL'\r\n                ? 'Minimum image size is {minWidth} &times; {minHeight}'\r\n                : 'Error loading image';\r\n        if (state.task === 'blob-to-bitmap') return 'Preparing image&hellip;';\r\n        return 'Loading image&hellip;';\r\n    },\r\n\r\n    // processing status message\r\n    statusLabelProcessImage: (state) => {\r\n        if (!state || !state.task) return undefined;\r\n        if (state.task === 'store') {\r\n            if (state.error) return 'Error uploading image';\r\n            return 'Uploading image&hellip;';\r\n        }\r\n        if (state.error) return 'Error processing image';\r\n        return 'Processing image&hellip;';\r\n    },\r\n};\r\n\r\nconst MarkupEditor = {\r\n    shapeLabelButtonSelectSticker: 'Select image',\r\n    shapeIconButtonSelectSticker: `<g fill=\"none\" stroke=\"currentColor\" stroke-width=\"0.0625em\"><path d=\"M8 21 L15 11 L19 15\"/><path d=\"M15 2 v5 h5\"/><path d=\"M8 2 h8 l4 4 v12 q0 4 -4 4 h-8 q-4 0 -4 -4 v-12 q0 -4 4 -4z\"/></g><circle fill=\"currentColor\" cx=\"10\" cy=\"8\" r=\"1.5\"/>`,\r\n\r\n    shapeIconButtonFlipHorizontal: `<g stroke=\"currentColor\" stroke-width=\".125em\"><path fill=\"none\" d=\"M6 6.5h5v11H6z\"/><path fill=\"currentColor\" d=\"M15 6.5h3v11h-3z\"/><path d=\"M11 4v16\" fill=\"currentColor\"/></g>`,\r\n    shapeIconButtonFlipVertical: `<g stroke=\"currentColor\" stroke-width=\".125em\"><rect x=\"7\" y=\"8\" width=\"11\" height=\"5\" fill=\"none\"/><rect x=\"7\" y=\"17\" width=\"11\" height=\"2\" fill=\"currentColor\"/><line x1=\"5\" y1=\"13\" x2=\"20\" y2=\"13\"/></g>`,\r\n    shapeIconButtonRemove: `<g fill=\"none\" fill-rule=\"evenodd\"><path stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M7.5 7h9z\"/><path d=\"M7.916 9h8.168a1 1 0 01.99 1.14l-.972 6.862a2 2 0 01-1.473 1.653c-.877.23-1.753.345-2.629.345-.876 0-1.752-.115-2.628-.345a2 2 0 01-1.473-1.653l-.973-6.862A1 1 0 017.916 9z\" fill=\"currentColor\"/><rect fill=\"currentColor\" x=\"10\" y=\"5\" width=\"4\" height=\"3\" rx=\"1\"/></g>`,\r\n    shapeIconButtonDuplicate: `<g fill=\"none\" fill-rule=\"evenodd\"><path d=\"M15 13.994V16a2 2 0 01-2 2H8a2 2 0 01-2-2v-5a2 2 0 012-2h2.142\" stroke=\"currentColor\" stroke-width=\".125em\"/><path d=\"M15 9V8a1 1 0 00-2 0v1h-1a1 1 0 000 2h1v1a1 1 0 002 0v-1h1a1 1 0 000-2h-1zm-4-4h6a2 2 0 012 2v6a2 2 0 01-2 2h-6a2 2 0 01-2-2V7a2 2 0 012-2z\" fill=\"currentColor\"/></g>`,\r\n    shapeIconButtonMoveToFront: `<g fill=\"none\" fill-rule=\"evenodd\"><rect fill=\"currentColor\" x=\"11\" y=\"13\" width=\"8\" height=\"2\" rx=\"1\"/><rect fill=\"currentColor\" x=\"9\" y=\"17\" width=\"10\" height=\"2\" rx=\"1\"/><path d=\"M11.364 8H10a5 5 0 000 10M12 6.5L14.5 8 12 9.5z\" stroke=\"currentColor\" stroke-width=\".125em\" stroke-linecap=\"round\"/></g>`,\r\n\r\n    shapeIconButtonTextLayoutAutoWidth: `${CharacterA}`,\r\n    shapeIconButtonTextLayoutAutoHeight: `<g fill=\"currentColor\"><circle cx=\"4\" cy=\"12\" r=\"1.5\"/><circle cx=\"20\" cy=\"12\" r=\"1.5\"/></g>${CharacterA}`,\r\n    shapeIconButtonTextLayoutFixedSize: `<g fill=\"currentColor\"><circle cx=\"5\" cy=\"6\" r=\"1.5\"/><circle cx=\"19\" cy=\"6\" r=\"1.5\"/><circle cx=\"19\" cy=\"19\" r=\"1.5\"/><circle cx=\"5\" cy=\"19\" r=\"1.5\"/></g>${CharacterA}`,\r\n\r\n    shapeTitleButtonTextLayoutAutoWidth: 'Auto width',\r\n    shapeTitleButtonTextLayoutAutoHeight: 'Auto height',\r\n    shapeTitleButtonTextLayoutFixedSize: 'Fixed size',\r\n\r\n    shapeTitleButtonFlipHorizontal: 'Flip Horizontal',\r\n    shapeTitleButtonFlipVertical: 'Flip Vertical',\r\n    shapeTitleButtonRemove: 'Remove',\r\n    shapeTitleButtonDuplicate: 'Duplicate',\r\n    shapeTitleButtonMoveToFront: 'Move to front',\r\n\r\n    shapeLabelInputText: 'Edit text',\r\n\r\n    shapeIconInputCancel: `<g fill=\"none\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\"><path d=\"M18 6L6 18M6 6l12 12\"/></g>`,\r\n    shapeIconInputConfirm: `<g fill=\"none\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\"><polyline points=\"20 6 9 17 4 12\"/></g>`,\r\n    shapeLabelInputCancel: 'Cancel',\r\n    shapeLabelInputConfirm: 'Confirm',\r\n\r\n    shapeLabelStrokeNone: 'No outline',\r\n\r\n    shapeLabelFontStyleNormal: 'Normal',\r\n    shapeLabelFontStyleBold: 'Bold',\r\n    shapeLabelFontStyleItalic: 'Italic',\r\n    shapeLabelFontStyleItalicBold: 'Bold Italic',\r\n\r\n    shapeTitleBackgroundColor: 'Fill color',\r\n\r\n    shapeTitleCornerRadius: 'Corner radius',\r\n\r\n    shapeTitleFontFamily: 'Font',\r\n    shapeTitleFontSize: 'Font size',\r\n    shapeTitleFontStyle: 'Font style',\r\n    shapeTitleLineHeight: 'Line height',\r\n\r\n    shapeTitleLineStart: 'Start',\r\n    shapeTitleLineEnd: 'End',\r\n    shapeTitleStrokeWidth: 'Line width',\r\n    shapeTitleStrokeColor: 'Line color',\r\n\r\n    shapeTitleLineDecorationBar: 'Bar',\r\n    shapeTitleLineDecorationCircle: 'Circle',\r\n    shapeTitleLineDecorationSquare: 'Square',\r\n    shapeTitleLineDecorationArrow: 'Arrow',\r\n    shapeTitleLineDecorationCircleSolid: 'Circle solid',\r\n    shapeTitleLineDecorationSquareSolid: 'Square solid',\r\n    shapeTitleLineDecorationArrowSolid: 'Arrow solid',\r\n\r\n    shapeIconLineDecorationBar: `<g stroke=\"currentColor\" stroke-linecap=\"round\" stroke-width=\".125em\"><path d=\"M5,12 H16\"/><path d=\"M16,8 V16\"/></g>`,\r\n    shapeIconLineDecorationCircle: `<g stroke=\"currentColor\" stroke-linecap=\"round\"><path stroke-width=\".125em\" d=\"M5,12 H12\"/><circle fill=\"none\" stroke-width=\".125em\" cx=\"16\" cy=\"12\" r=\"4\"/></g>`,\r\n    shapeIconLineDecorationSquare: `<g stroke=\"currentColor\" stroke-linecap=\"round\"><path stroke-width=\".125em\" d=\"M5,12 H12\"/><rect fill=\"none\" stroke-width=\".125em\" x=\"12\" y=\"8\" width=\"8\" height=\"8\"/></g>`,\r\n    shapeIconLineDecorationArrow: `<g stroke=\"currentColor\" stroke-linecap=\"round\" stroke-width=\".125em\"><path d=\"M5,12 H16 M13,7 l6,5 l-6,5\" fill=\"none\"/></g>`,\r\n    shapeIconLineDecorationCircleSolid: `<g stroke=\"currentColor\" stroke-linecap=\"round\"><path stroke-width=\".125em\" d=\"M5,12 H12\"/><circle fill=\"currentColor\" cx=\"16\" cy=\"12\" r=\"4\"/></g>`,\r\n    shapeIconLineDecorationSquareSolid: `<g stroke=\"currentColor\" stroke-linecap=\"round\"><path stroke-width=\".125em\" d=\"M5,12 H12\"/><rect fill=\"currentColor\" x=\"12\" y=\"8\" width=\"8\" height=\"8\"/></g>`,\r\n    shapeIconLineDecorationArrowSolid: `<g stroke=\"currentColor\" stroke-linecap=\"round\" stroke-width=\".125em\"><path d=\"M5,12 H16\"/><path d=\"M13,7 l6,5 l-6,5z\" fill=\"currentColor\"/></g>`,\r\n\r\n    shapeTitleColorTransparent: 'Transparent',\r\n    shapeTitleColorWhite: 'White',\r\n    shapeTitleColorSilver: 'Silver',\r\n    shapeTitleColorGray: 'Gray',\r\n    shapeTitleColorBlack: 'Black',\r\n    shapeTitleColorNavy: 'Navy',\r\n    shapeTitleColorBlue: 'Blue',\r\n    shapeTitleColorAqua: 'Aqua',\r\n    shapeTitleColorTeal: 'Teal',\r\n    shapeTitleColorOlive: 'Olive',\r\n    shapeTitleColorGreen: 'Green',\r\n    shapeTitleColorYellow: 'Yellow',\r\n    shapeTitleColorOrange: 'Orange',\r\n    shapeTitleColorRed: 'Red',\r\n    shapeTitleColorMaroon: 'Maroon',\r\n    shapeTitleColorFuchsia: 'Fuchsia',\r\n    shapeTitleColorPurple: 'Purple',\r\n\r\n    shapeTitleTextColor: 'Font color',\r\n    shapeTitleTextAlign: 'Text align',\r\n    shapeTitleTextAlignLeft: 'Left align text',\r\n    shapeTitleTextAlignCenter: 'Center align text',\r\n    shapeTitleTextAlignRight: 'Right align text',\r\n\r\n    shapeIconTextAlignLeft: `<g stroke-width=\".125em\" stroke=\"currentColor\"><line x1=\"5\" y1=\"8\" x2=\"15\" y2=\"8\"/><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"/><line x1=\"5\" y1=\"16\" x2=\"14\" y2=\"16\"/></g>`,\r\n    shapeIconTextAlignCenter: `<g stroke-width=\".125em\" stroke=\"currentColor\"><line x1=\"7\" y1=\"8\" x2=\"17\" y2=\"8\"/><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"/><line x1=\"8\" y1=\"16\" x2=\"16\" y2=\"16\"/></g>`,\r\n    shapeIconTextAlignRight: `<g stroke-width=\".125em\" stroke=\"currentColor\"><line x1=\"9\" y1=\"8\" x2=\"19\" y2=\"8\"/><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"/><line x1=\"11\" y1=\"16\" x2=\"19\" y2=\"16\"/></g>`,\r\n\r\n    shapeLabelToolMove: 'Move',\r\n    shapeLabelToolView: 'View',\r\n    shapeLabelToolSharpie: 'Sharpie',\r\n    shapeLabelToolEraser: 'Eraser',\r\n    shapeLabelToolPath: 'Path',\r\n    shapeLabelToolRectangle: 'Rectangle',\r\n    shapeLabelToolEllipse: 'Ellipse',\r\n    shapeLabelToolArrow: 'Arrow',\r\n    shapeLabelToolLine: 'Line',\r\n    shapeLabelToolText: 'Text',\r\n    shapeLabelToolPreset: 'Stickers',\r\n\r\n    shapeIconToolView: `<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M10.98 9.703V2.567c0-1.19 1.19-1.785 1.784-1.785.595 0 1.784.595 1.784 1.785v3.568\"/><path d=\"M14.548 9.703V4.35c0-1.19 1.19-1.784 1.784-1.784.595 0 1.784.594 1.784 1.784v2.973\"/><path d=\"M18.116 10.244V7.271c0-1.19 1.19-1.784 1.784-1.784.595 0 1.785.595 1.785 1.784 0 1.19 0 8.92-1.19 12.488-1.19 3.569-10.704 4.758-13.678 0-2.973-4.757-2.973-4.757-4.163-6.541-1.189-1.784-1.153-2.974-.594-3.568.558-.595 1.784-1.19 2.973.594 1.277 1.916 2.07 2.907 2.379 2.974V5.487c0-1.19 1.19-1.784 1.784-1.784.595 0 1.784.595 1.784 1.784V8.46\"/></g>`,\r\n    shapeIconToolMove: `<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><path d=\"M6 2 L6 19 L18 13 Z M13 18 L16 24\" stroke=\"currentColor\" stroke-width=\".125em\" fill=\"none\" fill-rule=\"evenodd\" stroke-linejoin=\"round\"/></g>`,\r\n    shapeIconToolSharpie: `<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><path d=\"M2.025 5c5.616-2.732 8.833-3.857 9.65-3.374C12.903 2.351.518 12.666 2.026 14 3.534 15.334 16.536.566 17.73 2.566 18.924 4.566 3.98 17.187 4.831 18c.851.813 9.848-6 11.643-6 1.087 0-2.53 5.11-2.92 7-.086.41 3.323-1.498 4.773-1 .494.17.64 2.317 1.319 3 .439.443 1.332.776 2.679 1\" stroke=\"currentColor\" stroke-width=\".125em\" fill=\"none\" fill-rule=\"evenodd\" stroke-linejoin=\"round\"/></g>`,\r\n    shapeIconToolEraser: `<g stroke-width=\".125em\" stroke=\"currentColor\" stroke-linecap=\"round\" fill=\"none\"><g transform=\"translate(3, 15) rotate(-45)\"><rect x=\"0\" y=\"0\" width=\"18\" height=\"10\" rx=\"3\"/></g><line x1=\"11\" y1=\"21\" x2=\"18\" y2=\"21\"/><line x1=\"20\" y1=\"21\" x2=\"22\" y2=\"21\"/></g>`,\r\n\r\n    shapeIconToolPath: `<g stroke-width=\".125em\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" fill=\"none\">\r\n    \r\n    <circle cx=\"21\" cy=\"3\" r=\"2\"/>\r\n    <circle cx=\"9\" cy=\"9\" r=\"2\"/>\r\n    <circle cx=\"3\" cy=\"21\" r=\"2\"/>\r\n\r\n    <path d=\"M19 4 11 8 M8 11 4 19\"/>\r\n    \r\n    </g>`,\r\n\r\n    shapeIconToolRectangle: `<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><rect x=\"2\" y=\"2\" width=\"20\" height=\"20\" rx=\"3\"/></g>`,\r\n    shapeIconToolEllipse: `<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><circle cx=\"12\" cy=\"12\" r=\"11\"/></g>`,\r\n    shapeIconToolArrow: `<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><line x1=\"20\" y1=\"3\" x2=\"6\" y2=\"21\"/><path d=\"m10 6 L21.5 1 L20 13.5\" fill=\"currentColor\" stroke=\"none\"/></g>`,\r\n    shapeIconToolLine: `<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><line x1=\"20\" y1=\"3\" x2=\"6\" y2=\"21\"/></g>`,\r\n    shapeIconToolText: `<g stroke=\"none\" fill=\"currentColor\" transform=\"translate(6,0)\"><path d=\"M8.14 20.085c.459 0 .901-.034 1.329-.102a8.597 8.597 0 001.015-.21v1.984c-.281.135-.695.247-1.242.336a9.328 9.328 0 01-1.477.133c-3.312 0-4.968-1.745-4.968-5.235V6.804H.344v-1.25l2.453-1.078L3.89.819h1.5v3.97h4.97v2.015H5.39v10.078c0 1.031.245 1.823.735 2.375s1.161.828 2.015.828z\"/>`,\r\n    shapeIconToolPreset: `<g fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\"><path d=\"M12 22c2.773 0 1.189-5.177 3-7 1.796-1.808 7-.25 7-3 0-5.523-4.477-10-10-10S2 6.477 2 12s4.477 10 10 10z\"></path><path d=\"M20 17c-3 3-5 5-8 5\"></path></g>`,\r\n};\r\n\r\nvar _plugin_crop_locale_en_gb = {\r\n    cropLabel: 'Crop',\r\n    cropIcon:\r\n        '<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><path d=\"M23 17H9a2 2 0 0 1-2-2v-5m0-3V1 M1 7h14a2 2 0 0 1 2 2v7m0 4v3\"/></g>',\r\n    cropIconButtonRecenter: `<path stroke=\"currentColor\" fill=\"none\" stroke-width=\"2\" stroke-linejoin=\"bevel\" d=\"M1.5 7.5v-6h6M1.5 16.5v6h6M22.5 16.5v6h-6M22.5 7.5v-6h-6\"/><circle cx=\"12\" cy=\"12\" r=\"3.5\" fill=\"currentColor\" stroke=\"none\"/>`,\r\n    cropIconButtonRotateLeft:\r\n        '<g stroke=\"none\" fill=\"currentColor\"><path fill=\"none\" d=\"M-1-1h582v402H-1z\"/><rect x=\"3\" rx=\"1\" height=\"12\" width=\"12\" y=\"9\"/><path d=\"M15 5h-1a5 5 0 015 5 1 1 0 002 0 7 7 0 00-7-7h-1.374l.747-.747A1 1 0 0011.958.84L9.603 3.194a1 1 0 000 1.415l2.355 2.355a1 1 0 001.415-1.414l-.55-.55H15z\"/></g>',\r\n    cropIconButtonRotateRight:\r\n        '<g stroke=\"none\" fill=\"currentColor\"><path fill=\"none\" d=\"M-1-1h582v402H-1z\"/><path d=\"M11.177 5H10a5 5 0 00-5 5 1 1 0 01-2 0 7 7 0 017-7h1.374l-.747-.747A1 1 0 0112.042.84l2.355 2.355a1 1 0 010 1.415l-2.355 2.354a1 1 0 01-1.415-1.414l.55-.55z\"/><rect rx=\"1\" height=\"12\" width=\"12\" y=\"9\" x=\"9\"/></g>',\r\n    cropIconButtonFlipVertical:\r\n        '<g stroke=\"none\" fill=\"currentColor\"><path d=\"M19.993 12.143H7a1 1 0 0 1-1-1V5.994a1 1 0 0 1 1.368-.93l12.993 5.15a1 1 0 0 1-.368 1.93z\"/><path d=\"M19.993 14a1 1 0 0 1 .368 1.93L7.368 21.078A1 1 0 0 1 6 20.148V15a1 1 0 0 1 1-1h12.993z\" opacity=\".6\"/></g>',\r\n    cropIconButtonFlipHorizontal:\r\n        '<g stroke=\"none\" fill=\"currentColor\"><path d=\"M11.93 7.007V20a1 1 0 0 1-1 1H5.78a1 1 0 0 1-.93-1.368l5.15-12.993a1 1 0 0 1 1.929.368z\"/><path d=\"M14 7.007V20a1 1 0 0 0 1 1h5.149a1 1 0 0 0 .93-1.368l-5.15-12.993A1 1 0 0 0 14 7.007z\" opacity=\".6\"/></g>',\r\n\r\n    cropIconSelectPreset: (locale, aspectRatio) => {\r\n        const [a, b, c] = !aspectRatio\r\n            ? [0.2, 0.3, 0.4]\r\n            : [\r\n                  aspectRatio < 1 ? 1 : 0.3,\r\n                  aspectRatio === 1 ? 0.85 : 0.5,\r\n                  aspectRatio > 1 ? 1 : 0.3,\r\n              ];\r\n        return `<g fill=\"currentColor\">\r\n            <rect opacity=\"${a}\" x=\"2\" y=\"4\" width=\"10\" height=\"18\" rx=\"1\"/>\r\n            <rect opacity=\"${b}\" x=\"4\" y=\"8\" width=\"14\" height=\"14\" rx=\"1\"/>\r\n            <rect opacity=\"${c}\" x=\"6\" y=\"12\" width=\"17\" height=\"10\" rx=\"1\"/>\r\n        </g>`;\r\n    },\r\n\r\n    cropIconCropBoundary: (locale, isBoundToImage) => {\r\n        const [a, b, c, d] = isBoundToImage ? [0.3, 1, 0, 0] : [0, 0, 0.3, 1];\r\n        return `<g fill=\"currentColor\">\r\n            <rect opacity=\"${a}\" x=\"2\" y=\"3\" width=\"20\" height=\"20\" rx=\"1\"/>\r\n            <rect opacity=\"${b}\" x=\"7\" y=\"8\" width=\"10\" height=\"10\" rx=\"1\"/>\r\n            <rect opacity=\"${c}\" x=\"4\" y=\"8\" width=\"14\" height=\"14\" rx=\"1\"/>\r\n            <rect opacity=\"${d}\" x=\"12\" y=\"4\" width=\"10\" height=\"10\" rx=\"1\"/>\r\n        </g>`;\r\n    },\r\n\r\n    cropLabelButtonRecenter: 'Recenter',\r\n    cropLabelButtonRotateLeft: 'Rotate left',\r\n    cropLabelButtonRotateRight: 'Rotate right',\r\n    cropLabelButtonFlipHorizontal: 'Flip horizontal',\r\n    cropLabelButtonFlipVertical: 'Flip vertical',\r\n\r\n    cropLabelSelectPreset: 'Crop shape',\r\n\r\n    cropLabelCropBoundary: 'Crop boundary',\r\n    cropLabelCropBoundaryEdge: 'Edge of image',\r\n    cropLabelCropBoundaryNone: 'None',\r\n\r\n    cropLabelTabRotation: 'Rotation',\r\n    cropLabelTabZoom: 'Scale',\r\n};\r\n\r\nvar _plugin_filter_locale_en_gb = {\r\n    filterLabel: 'Filter',\r\n    filterIcon:\r\n        '<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><path d=\"M18.347 9.907a6.5 6.5 0 1 0-1.872 3.306M3.26 11.574a6.5 6.5 0 1 0 2.815-1.417 M10.15 17.897A6.503 6.503 0 0 0 16.5 23a6.5 6.5 0 1 0-6.183-8.51\"/></g>',\r\n    filterLabelChrome: 'Chrome',\r\n    filterLabelFade: 'Fade',\r\n    filterLabelCold: 'Cold',\r\n    filterLabelWarm: 'Warm',\r\n    filterLabelPastel: 'Pastel',\r\n    filterLabelMonoDefault: 'Mono',\r\n    filterLabelMonoNoir: 'Noir',\r\n    filterLabelMonoWash: 'Wash',\r\n    filterLabelMonoStark: 'Stark',\r\n    filterLabelSepiaDefault: 'Sepia',\r\n    filterLabelSepiaBlues: 'Blues',\r\n    filterLabelSepiaRust: 'Rust',\r\n    filterLabelSepiaColor: 'Color',\r\n};\r\n\r\nvar _plugin_finetune_locale_en_gb = {\r\n    finetuneLabel: 'Finetune',\r\n    finetuneIcon:\r\n        '<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><path d=\"M4 1v5.5m0 3.503V23M12 1v10.5m0 3.5v8M20 1v15.5m0 3.5v3M2 7h4M10 12h4M18 17h4\"/></g>',\r\n\r\n    finetuneLabelBrightness: 'Brightness',\r\n    finetuneLabelContrast: 'Contrast',\r\n    finetuneLabelSaturation: 'Saturation',\r\n    finetuneLabelExposure: 'Exposure',\r\n    finetuneLabelTemperature: 'Temperature',\r\n    finetuneLabelGamma: 'Gamma',\r\n    finetuneLabelClarity: 'Clarity',\r\n    finetuneLabelVignette: 'Vignette',\r\n};\r\n\r\nvar _plugin_resize_locale_en_gb = {\r\n    resizeLabel: 'Resize',\r\n    resizeIcon:\r\n        '<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><rect x=\"2\" y=\"12\" width=\"10\" height=\"10\" rx=\"2\"/><path d=\"M4 11.5V4a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-5.5\"/><path d=\"M14 10l3.365-3.365M14 6h4v4\"/></g>',\r\n\r\n    resizeLabelFormCaption: 'Image output size',\r\n\r\n    resizeLabelInputWidth: 'w',\r\n    resizeTitleInputWidth: 'Width',\r\n    resizeLabelInputHeight: 'h',\r\n    resizeTitleInputHeight: 'Height',\r\n\r\n    resizeTitleButtonMaintainAspectRatio: 'Maintain aspectratio',\r\n\r\n    resizeIconButtonMaintainAspectRatio: (active, activeFraction) => `\r\n        <defs>\r\n            <mask id=\"mask1\" x=\"0\" y=\"0\" width=\"24\" height=\"24\" >\r\n                <rect x=\"0\" y=\"0\" width=\"24\" height=\"10\" fill=\"#fff\" stroke=\"none\"/>\r\n            </mask>\r\n        </defs>\r\n        <g fill=\"none\" fill-rule=\"evenodd\">\r\n            <g  mask=\"url(#mask1)\">\r\n                <path transform=\"translate(0 ${\r\n                    (activeFraction - 1) * 3\r\n                })\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" d=\"M9.401 10.205v-.804a2.599 2.599 0 0 1 5.198 0V17\"/>\r\n            </g>\r\n            <rect fill=\"currentColor\" x=\"7\" y=\"10\" width=\"10\" height=\"7\" rx=\"1.5\"/>\r\n        </g>\r\n    `,\r\n};\r\n\r\nvar _plugin_decorate_locale_en_gb = {\r\n    decorateLabel: 'Decorate',\r\n    decorateIcon:\r\n        '<g fill=\"none\" fill-rule=\"evenodd\"><path stroke=\"currentColor\" stroke-width=\".125em\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 18.5l-6.466 3.4 1.235-7.2-5.23-5.1 7.228-1.05L12 2l3.233 6.55 7.229 1.05-5.231 5.1 1.235 7.2z\"/></g>',\r\n};\r\n\r\nvar _plugin_annotate_locale_en_gb = {\r\n    annotateLabel: 'Annotate',\r\n    annotateIcon:\r\n        '<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><path d=\"M17.086 2.914a2.828 2.828 0 1 1 4 4l-14.5 14.5-5.5 1.5 1.5-5.5 14.5-14.5z\"/></g>',\r\n};\r\n\r\nvar _plugin_sticker_locale_en_gb = {\r\n    stickerLabel: 'Sticker',\r\n    stickerIcon:\r\n        '<g fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\"><path d=\"M12 22c2.773 0 1.189-5.177 3-7 1.796-1.808 7-.25 7-3 0-5.523-4.477-10-10-10S2 6.477 2 12s4.477 10 10 10z\"/><path d=\"M20 17c-3 3-5 5-8 5\"/></g>',\r\n};\r\n\r\nvar _plugin_frame_locale_en_gb = {\r\n    frameLabel: 'Frame',\r\n    frameIcon: `<g fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\">\r\n            <rect x=\"2\" y=\"2\" width=\"20\" height=\"20\" rx=\"4\"/>\r\n            <rect x=\"6\" y=\"6\" width=\"12\" height=\"12\" rx=\"1\"/>\r\n        </g>`,\r\n\r\n    frameLabelMatSharp: 'Mat',\r\n    frameLabelMatRound: 'Bevel',\r\n    frameLabelLineSingle: 'Line',\r\n    frameLabelLineMultiple: 'Zebra',\r\n    frameLabelEdgeSeparate: 'Inset',\r\n    frameLabelEdgeOverlap: 'Plus',\r\n    frameLabelEdgeCross: 'Lumber',\r\n    frameLabelCornerHooks: 'Hook',\r\n    frameLabelPolaroid: 'Polaroid',\r\n};\r\n\r\nvar _plugin_redact_locale_en_gb = {\r\n    redactLabel: 'Redact',\r\n    redactIcon: `<g fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\">\r\n        <path d=\"M 4 5 l 1 -1\"/>\r\n        <path d=\"M 4 10 l 6 -6\"/>\r\n        <path d=\"M 4 15 l 11 -11\"/>\r\n        <path d=\"M 4 20 l 16 -16\"/>\r\n        <path d=\"M 9 20 l 11 -11\"/>\r\n        <path d=\"M 14 20 l 6 -6\"/>\r\n        <path d=\"M 19 20 l 1 -1\"/>\r\n    </g>`,\r\n};\r\n\r\nvar hasDefinedCustomElement = (name) => document.createElement(name).constructor !== HTMLElement;\r\n\r\nvar linkAccessors = (destination, origin) => {\r\n    const descriptors = Object.getOwnPropertyDescriptors(destination);\r\n    Object.keys(descriptors).forEach((key) => {\r\n        // props, set new setter and getter\r\n        if (!!descriptors[key]['get']) {\r\n            Object.defineProperty(origin, key, {\r\n                get: () => destination[key],\r\n                set: (value) => (destination[key] = value),\r\n            });\r\n        }\r\n        // method, copy reference\r\n        else {\r\n            origin[key] = destination[key];\r\n        }\r\n    });\r\n};\r\n\r\nvar hasDoctype = () => isBrowser() && document.doctype !== null;\r\n\r\nvar initEditorView = (target) => {\r\n    const accessors = {};\r\n    const { sub, pub } = pubsub();\r\n    // catch missing doctype\r\n    if (!hasDoctype())\r\n        console.warn('Browser is in quirks mode, add <!DOCTYPE html> to page to fix render issues');\r\n    // create editor core\r\n    const core = createImageEditor();\r\n    linkAccessors(core, accessors);\r\n    // create editor view\r\n    const view = attachEditorView(target, core.stores);\r\n    linkAccessors(view, accessors);\r\n    // listen for UI interaction and link to editor API (internals)\r\n    const unsubs = ['loadImage', 'processImage', 'abortProcessImage', 'abortLoadImage'].map((event) => view.on(event, (e) => {\r\n        // run core method, if returns a promise, we silence errors as those are passed to the UI via stores\r\n        const returned = core[event](e && e.detail);\r\n        if (returned instanceof Promise)\r\n            returned.catch(noop$1);\r\n    }));\r\n    // auto subscribes on each possible publisher\r\n    const subscribe = (event, cb) => {\r\n        const unsubInit = sub(event, cb);\r\n        const unsubCore = core.on(event, cb);\r\n        const unsubView = view.on(event, cb);\r\n        return () => {\r\n            unsubInit();\r\n            unsubCore();\r\n            unsubView();\r\n        };\r\n    };\r\n    // handles every event, useful for routing events from the options object\r\n    accessors.handleEvent = noop$1;\r\n    const handleEventUnsubs = editorEvents.map((type) => subscribe(type, (res) => accessors.handleEvent(type, res)));\r\n    // set up new api\r\n    defineMethods(accessors, {\r\n        on: subscribe,\r\n        updateImage: (src) => new Promise((resolve, reject) => {\r\n            // save history\r\n            const storedHistory = accessors.history.get();\r\n            // save state\r\n            const storedState = accessors.imageState;\r\n            // update image\r\n            core.loadImage(src)\r\n                .then((res) => {\r\n                // restore history\r\n                accessors.history.set(storedHistory);\r\n                // restore state\r\n                accessors.imageState = storedState;\r\n                // done!\r\n                resolve(res);\r\n            })\r\n                .catch(reject);\r\n        }),\r\n        close: () => {\r\n            pub('close');\r\n        },\r\n        destroy: () => {\r\n            // unsub\r\n            [...unsubs, ...handleEventUnsubs].forEach((unsub) => unsub());\r\n            // destroy\r\n            view.destroy();\r\n            core.destroy();\r\n            // destroyed\r\n            pub('destroy');\r\n        },\r\n    });\r\n    setTimeout(() => pub('init', accessors), 0);\r\n    return accessors;\r\n};\r\n\r\nconst TAG = 'pintura-editor';\r\nvar _defineCustomElements = () => new Promise((resolve) => {\r\n    if (!PinturaImageEditorElement)\r\n        return resolve([]);\r\n    !hasDefinedCustomElement(TAG) && customElements.define(TAG, PinturaImageEditorElement);\r\n    customElements.whenDefined(TAG).then(() => resolve(document.querySelectorAll(TAG)));\r\n});\r\nconst PinturaImageEditorElement = isBrowser() &&\r\n    class extends HTMLElement {\r\n        constructor() {\r\n            super();\r\n            this._editor = undefined;\r\n            this._unsubs = undefined;\r\n        }\r\n        static get observedAttributes() {\r\n            return ['src'];\r\n        }\r\n        attributeChangedCallback(attrName, oldValue, newValue) {\r\n            this[attrName] = newValue;\r\n        }\r\n        connectedCallback() {\r\n            this._editor = initEditorView(this);\r\n            linkAccessors(this._editor, this);\r\n            this._editor.src = this.getAttribute('src');\r\n            this._unsubs = dispatchEditorEvents(this._editor, this);\r\n        }\r\n        disconnectedCallback() {\r\n            this._editor.destroy();\r\n            this._unsubs.forEach((unsub) => unsub());\r\n        }\r\n    };\r\n\r\nconst CSS_CLASS_NAME = 'pintura-editor';\r\nvar _appendEditor = (target, options = {}) => {\r\n    const element = isString(target)\r\n        ? document.querySelector(target)\r\n        : target;\r\n    if (!isElement(element))\r\n        return undefined;\r\n    options.class = options.class ? `${CSS_CLASS_NAME} ${options.class}` : CSS_CLASS_NAME;\r\n    const accessors = initEditorView(element);\r\n    return Object.assign(accessors, options);\r\n};\r\n\r\n/* src/core/ui/modal/index.svelte generated by Svelte v3.50.1 */\r\n\r\nconst { document: document_1, window: window_1 } = globals;\r\n\r\nfunction create_fragment(ctx) {\r\n\tlet t;\r\n\tlet div;\r\n\tlet mounted;\r\n\tlet dispose;\r\n\tadd_render_callback(/*onwindowresize*/ ctx[27]);\r\n\r\n\treturn {\r\n\t\tc() {\r\n\t\t\tt = space();\r\n\t\t\tdiv = element(\"div\");\r\n\t\t\tattr(div, \"class\", /*className*/ ctx[4]);\r\n\t\t\tattr(div, \"style\", /*style*/ ctx[5]);\r\n\t\t},\r\n\t\tm(target, anchor) {\r\n\t\t\tinsert(target, t, anchor);\r\n\t\t\tinsert(target, div, anchor);\r\n\t\t\t/*div_binding*/ ctx[28](div);\r\n\r\n\t\t\tif (!mounted) {\r\n\t\t\t\tdispose = [\r\n\t\t\t\t\tlisten(window_1, \"keydown\", /*handleKey*/ ctx[10]),\r\n\t\t\t\t\tlisten(window_1, \"orientationchange\", /*spawnMeasureElement*/ ctx[11]),\r\n\t\t\t\t\tlisten(window_1, \"resize\", /*onwindowresize*/ ctx[27]),\r\n\t\t\t\t\tlisten(document_1.body, \"focusin\", function () {\r\n\t\t\t\t\t\tif (is_function(!/*hidden*/ ctx[1] && /*handleFocusIn*/ ctx[7])) (!/*hidden*/ ctx[1] && /*handleFocusIn*/ ctx[7]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(document_1.body, \"focusout\", function () {\r\n\t\t\t\t\t\tif (is_function(/*hasFocussedTextField*/ ctx[2] && /*handleFocusOut*/ ctx[8])) (/*hasFocussedTextField*/ ctx[2] && /*handleFocusOut*/ ctx[8]).apply(this, arguments);\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tlisten(div, \"wheel\", /*handleWheel*/ ctx[9], { passive: false })\r\n\t\t\t\t];\r\n\r\n\t\t\t\tmounted = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tp(new_ctx, dirty) {\r\n\t\t\tctx = new_ctx;\r\n\r\n\t\t\tif (dirty[0] & /*className*/ 16) {\r\n\t\t\t\tattr(div, \"class\", /*className*/ ctx[4]);\r\n\t\t\t}\r\n\r\n\t\t\tif (dirty[0] & /*style*/ 32) {\r\n\t\t\t\tattr(div, \"style\", /*style*/ ctx[5]);\r\n\t\t\t}\r\n\t\t},\r\n\t\ti: noop,\r\n\t\to: noop,\r\n\t\td(detaching) {\r\n\t\t\tif (detaching) detach(t);\r\n\t\t\tif (detaching) detach(div);\r\n\t\t\t/*div_binding*/ ctx[28](null);\r\n\t\t\tmounted = false;\r\n\t\t\trun_all(dispose);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction instance($$self, $$props, $$invalidate) {\r\n\tlet o;\r\n\tlet viewportRules;\r\n\tlet isOpaque;\r\n\tlet isIOSFooterVisible;\r\n\tlet style;\r\n\tlet className;\r\n\tlet scrollsBodyOnInteraction;\r\n\tlet $opacity;\r\n\tconst dispatch = createEventDispatcher();\r\n\tlet { root } = $$props;\r\n\tlet { preventZoomViewport = true } = $$props;\r\n\tlet { preventScrollBodyIfNeeded = true } = $$props;\r\n\tlet { preventFooterOverlapIfNeeded = true } = $$props;\r\n\tlet { class: klass = undefined } = $$props;\r\n\tlet hidden = true;\r\n\tlet hiding = false;\r\n\tlet showing = false;\r\n\tlet doc = isBrowser() && document.documentElement;\r\n\tlet body = isBrowser() && document.body;\r\n\tlet head = isBrowser() && document.head;\r\n\tconst opacity = spring(0, { precision: 0.001, damping: 0.5 });\r\n\tcomponent_subscribe($$self, opacity, value => $$invalidate(26, $opacity = value));\r\n\r\n\t// animate hide and show\r\n\tconst opacityUnsub = opacity.subscribe(o => {\r\n\t\tif (showing && o >= 1) {\r\n\t\t\t$$invalidate(19, showing = false); // now shown\r\n\t\t\t$$invalidate(1, hidden = false);\r\n\t\t\tdispatch('show');\r\n\t\t} else if (hiding && o <= 0) {\r\n\t\t\t$$invalidate(18, hiding = false); // now hidden\r\n\t\t\t$$invalidate(1, hidden = true);\r\n\t\t\tdispatch('hide');\r\n\t\t}\r\n\t});\r\n\r\n\tlet hasFocussedTextField = false;\r\n\tlet viewportDefaults = undefined;\r\n\tlet themeDefaults = undefined;\r\n\tlet showTimeoutId = undefined;\r\n\tconst getViewPortElement = () => document.querySelector('meta[name=viewport]');\r\n\tconst getThemeElements = () => Array.from(document.querySelectorAll('meta[name=theme-color]'));\r\n\r\n\tconst show = () => {\r\n\t\t// is visible, or busy becoming visible\r\n\t\tif (showing || !hidden) return;\r\n\r\n\t\t// now in 'showing' transition\r\n\t\t$$invalidate(19, showing = true);\r\n\r\n\t\t// store default viewport element values\r\n\t\tconst viewportElement = getViewPortElement() || h('meta', { name: 'viewport' });\r\n\r\n\t\tviewportDefaults = !viewportDefaults && viewportElement.getAttribute('content');\r\n\r\n\t\tviewportElement.setAttribute('content', viewportRules + ((/cover/).test(viewportDefaults)\r\n\t\t? ',viewport-fit=cover'\r\n\t\t: ''));\r\n\r\n\t\tif (!viewportElement.parentNode) head.append(viewportElement);\r\n\r\n\t\t// store default theme element values\r\n\t\tconst backgroundColor = getComputedStyle(root).getPropertyValue('--color-background');\r\n\r\n\t\tconst themeElements = getThemeElements();\r\n\r\n\t\tif (themeElements.length) {\r\n\t\t\t// store defaults\r\n\t\t\tthemeDefaults = themeElements.map(element => element.getAttribute('content'));\r\n\t\t} else {\r\n\t\t\t// create element\r\n\t\t\tconst themeElement = h('meta', { name: 'theme-color' });\r\n\r\n\t\t\thead.append(themeElement);\r\n\t\t\tthemeElements.push(themeElement);\r\n\t\t}\r\n\r\n\t\t// update colors\r\n\t\tthemeElements.forEach(element => element.setAttribute('content', `rgb(${backgroundColor})`));\r\n\r\n\t\tclearTimeout(showTimeoutId);\r\n\t\tshowTimeoutId = setTimeout(() => opacity.set(1), 250);\r\n\t};\r\n\r\n\tconst hide = () => {\r\n\t\t// is hiding or already hidden\r\n\t\tif (hiding || hidden) return;\r\n\r\n\t\t// if previous command was show, we need to prevent the timeout from kicking off\r\n\t\tclearTimeout(showTimeoutId);\r\n\r\n\t\t// now in 'hiding' transition\r\n\t\t$$invalidate(18, hiding = true);\r\n\r\n\t\t// get a reference to the viewport element, it should be there as we created it earlier,\r\n\t\t// we restore defaults if the viewport metatag was defined, if not, we destroy it\r\n\t\tconst viewportElement = getViewPortElement();\r\n\r\n\t\tif (viewportDefaults) viewportElement.setAttribute('content', viewportDefaults); else viewportElement.remove();\r\n\r\n\t\t// restore colors\r\n\t\tconst themeElements = getThemeElements();\r\n\r\n\t\tif (themeDefaults) {\r\n\t\t\tthemeElements.forEach((element, index) => {\r\n\t\t\t\telement.setAttribute('content', themeDefaults[index]);\r\n\t\t\t});\r\n\t\t} else themeElements.forEach(element => element.remove());\r\n\r\n\t\t// let's hide!\r\n\t\topacity.set(0);\r\n\t};\r\n\r\n\t//\r\n\t// handle soft keyboard impact on window height\r\n\t//\r\n\tlet focusOutTimer;\r\n\r\n\tlet focusInWindowHeight;\r\n\r\n\tconst handleFocusIn = e => {\r\n\t\t// test if is text input element\r\n\t\tif (!isTextField(e.target)) return;\r\n\r\n\t\t// now focussing a field\r\n\t\t$$invalidate(2, hasFocussedTextField = true);\r\n\r\n\t\tfocusInWindowHeight = windowHeight;\r\n\t};\r\n\r\n\tconst handleFocusOut = e => {\r\n\t\t// test if is text input element\r\n\t\tif (!isTextField(e.target)) return;\r\n\r\n\t\t// prevent accidentally setting two timers\r\n\t\tclearTimeout(focusOutTimer);\r\n\r\n\t\t// test if window height changed, if not, no soft keyboard appeared and we can set false to focus state immidiately\r\n\t\tif (focusInWindowHeight === windowHeight) {\r\n\t\t\t$$invalidate(2, hasFocussedTextField = false);\r\n\t\t} else // soft keyboard might have appeared, test for window height change before setting unfocus state\r\n\t\t{\r\n\t\t\tconst windowCurrentHeight = windowHeight;\r\n\t\t\trunWhen(() => windowHeight !== windowCurrentHeight, () => $$invalidate(2, hasFocussedTextField = false));\r\n\t\t}\r\n\t};\r\n\r\n\tconst runWhen = (test, cb) => {\r\n\t\tconst frame = () => {\r\n\t\t\tif (test()) {\r\n\t\t\t\tcb();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\trequestAnimationFrame(frame);\r\n\t\t};\r\n\r\n\t\trequestAnimationFrame(frame);\r\n\t};\r\n\r\n\t//\r\n\t// end soft keyboard logic\r\n\t//\r\n\t// prevent mousewheel from scrolling content behind modal\r\n\tconst handleWheel = e => {\r\n\t\tif (e.target && (/PinturaStage/).test(e.target.className)) e.preventDefault();\r\n\t};\r\n\r\n\t// handle escape to close modal\r\n\tconst handleKey = e => {\r\n\t\t// get key type\r\n\t\tconst { key } = e;\r\n\r\n\t\t// only deal with escape key\r\n\t\tif (!(/escape/i).test(key)) return;\r\n\r\n\t\t// don't close when in an input or textuarea\r\n\t\tconst targetElement = e.target;\r\n\r\n\t\tif (targetElement && (/input|textarea/i).test(targetElement.nodeName)) return;\r\n\r\n\t\t// only close if I'm the top modal\r\n\t\tconst modals = document.querySelectorAll('.PinturaModal');\r\n\r\n\t\tif (modals[modals.length - 1] !== root) return;\r\n\r\n\t\t// request close\r\n\t\tdispatch('close');\r\n\t};\r\n\r\n\t// this logic scales modal to fit viewport height\r\n\tlet windowHeight = 0;\r\n\r\n\tlet windowHeightComputed;\r\n\r\n\t// iOS measure actual page height so we can make optional use of available space\r\n\tlet measureElement;\r\n\r\n\tlet measureElementHeight = undefined;\r\n\r\n\tconst spawnMeasureElement = () => {\r\n\t\t// can't spawn more than one\r\n\t\tif (measureElement) return;\r\n\r\n\t\t// create measure element and append to body\r\n\t\tmeasureElement = h('div', {\r\n\t\t\tstyle: 'position:fixed;height:100vh;top:0'\r\n\t\t});\r\n\r\n\t\tbody.append(measureElement);\r\n\t};\r\n\r\n\tonMount(() => {\r\n\t\t// no need to run this logic if is not on iOS\r\n\t\tif (!preventFooterOverlapIfNeeded || !isIOS()) return;\r\n\r\n\t\t// will be used in first read to determine page height and bottom padding\r\n\t\tspawnMeasureElement();\r\n\t});\r\n\r\n\tafterUpdate(() => {\r\n\t\t// will only run on iOS\r\n\t\tif (!measureElement) return;\r\n\r\n\t\t// get height and store\r\n\t\t$$invalidate(21, measureElementHeight = measureElement.offsetHeight);\r\n\r\n\t\t// remove measure element\r\n\t\tmeasureElement.remove();\r\n\r\n\t\tmeasureElement = undefined;\r\n\t});\r\n\r\n\t//\r\n\t// document lock style for iOS 15.0\r\n\t//\r\n\tlet scrollOffsetY = undefined;\r\n\r\n\t// syncs height of doc lock with window\r\n\tconst syncHeight = () => doc.style.setProperty('--pintura-document-height', `${window.innerHeight}px`);\r\n\r\n\tconst toggleDocumentLock = isOpaque => {\r\n\t\tif (isOpaque) {\r\n\t\t\tscrollOffsetY = window.scrollY;\r\n\r\n\t\t\t// prevents safari on iOS 15.0 from scrolling body and showing footer on drag interaction\r\n\t\t\tdoc.classList.add('PinturaDocumentLock');\r\n\r\n\t\t\t// need to do this to sync height of initial window\r\n\t\t\tsyncHeight();\r\n\r\n\t\t\t// also sync on resize\r\n\t\t\twindow.addEventListener('resize', syncHeight);\r\n\t\t} else {\r\n\t\t\t// stop syncing height\r\n\t\t\twindow.removeEventListener('resize', syncHeight);\r\n\r\n\t\t\t// clean up\r\n\t\t\tdoc.classList.remove('PinturaDocumentLock');\r\n\r\n\t\t\tisNumber(scrollOffsetY) && window.scrollTo(0, scrollOffsetY);\r\n\t\t\tscrollOffsetY = undefined;\r\n\t\t}\r\n\t};\r\n\r\n\t//\r\n\t// clean up when removed\r\n\t//\r\n\tonDestroy(() => {\r\n\t\t// make sure no longer locking body element\r\n\t\tdoc.classList.remove('PinturaModalBodyLock');\r\n\r\n\t\t// clean up subs\r\n\t\topacityUnsub();\r\n\t});\r\n\r\n\tfunction onwindowresize() {\r\n\t\t$$invalidate(3, windowHeight = window_1.innerHeight);\r\n\t}\r\n\r\n\tfunction div_binding($$value) {\r\n\t\tbinding_callbacks[$$value ? 'unshift' : 'push'](() => {\r\n\t\t\troot = $$value;\r\n\t\t\t$$invalidate(0, root);\r\n\t\t});\r\n\t}\r\n\r\n\t$$self.$$set = $$props => {\r\n\t\tif ('root' in $$props) $$invalidate(0, root = $$props.root);\r\n\t\tif ('preventZoomViewport' in $$props) $$invalidate(12, preventZoomViewport = $$props.preventZoomViewport);\r\n\t\tif ('preventScrollBodyIfNeeded' in $$props) $$invalidate(13, preventScrollBodyIfNeeded = $$props.preventScrollBodyIfNeeded);\r\n\t\tif ('preventFooterOverlapIfNeeded' in $$props) $$invalidate(14, preventFooterOverlapIfNeeded = $$props.preventFooterOverlapIfNeeded);\r\n\t\tif ('class' in $$props) $$invalidate(15, klass = $$props.class);\r\n\t};\r\n\r\n\t$$self.$$.update = () => {\r\n\t\tif ($$self.$$.dirty[0] & /*showing, hiding, $opacity, hidden*/ 67895298) {\r\n\t\t\t$$invalidate(25, o = showing || hiding ? $opacity : hidden ? 0 : 1);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*preventZoomViewport*/ 4096) {\r\n\t\t\tviewportRules = 'width=device-width,height=device-height,initial-scale=1' + (preventZoomViewport\r\n\t\t\t? ',maximum-scale=1,user-scalable=0'\r\n\t\t\t: '');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*showing, hidden, hiding*/ 786434) {\r\n\t\t\t$$invalidate(22, isOpaque = !showing && !hidden && !hiding);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*hasFocussedTextField, windowHeight*/ 12) {\r\n\t\t\tif (!hasFocussedTextField) $$invalidate(20, windowHeightComputed = windowHeight);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*measureElementHeight, windowHeight*/ 2097160) {\r\n\t\t\t$$invalidate(24, isIOSFooterVisible = isNumber(measureElementHeight)\r\n\t\t\t? `--viewport-pad-footer:${measureElementHeight > windowHeight ? 0 : 1}`\r\n\t\t\t: '');\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*o, windowHeightComputed, isIOSFooterVisible*/ 51380224) {\r\n\t\t\t$$invalidate(5, style = `opacity:${o};height:${windowHeightComputed}px;--editor-modal:1;${isIOSFooterVisible}`);\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*klass*/ 32768) {\r\n\t\t\t$$invalidate(4, className = arrayJoin(['pintura-editor', 'PinturaModal', klass]));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*preventScrollBodyIfNeeded*/ 8192) {\r\n\t\t\t$$invalidate(23, scrollsBodyOnInteraction = preventScrollBodyIfNeeded && isIOS() && (/15_/).test(navigator.userAgent));\r\n\t\t}\r\n\r\n\t\tif ($$self.$$.dirty[0] & /*scrollsBodyOnInteraction, isOpaque*/ 12582912) {\r\n\t\t\tscrollsBodyOnInteraction && toggleDocumentLock(isOpaque);\r\n\t\t}\r\n\t};\r\n\r\n\treturn [\r\n\t\troot,\r\n\t\thidden,\r\n\t\thasFocussedTextField,\r\n\t\twindowHeight,\r\n\t\tclassName,\r\n\t\tstyle,\r\n\t\topacity,\r\n\t\thandleFocusIn,\r\n\t\thandleFocusOut,\r\n\t\thandleWheel,\r\n\t\thandleKey,\r\n\t\tspawnMeasureElement,\r\n\t\tpreventZoomViewport,\r\n\t\tpreventScrollBodyIfNeeded,\r\n\t\tpreventFooterOverlapIfNeeded,\r\n\t\tklass,\r\n\t\tshow,\r\n\t\thide,\r\n\t\thiding,\r\n\t\tshowing,\r\n\t\twindowHeightComputed,\r\n\t\tmeasureElementHeight,\r\n\t\tisOpaque,\r\n\t\tscrollsBodyOnInteraction,\r\n\t\tisIOSFooterVisible,\r\n\t\to,\r\n\t\t$opacity,\r\n\t\tonwindowresize,\r\n\t\tdiv_binding\r\n\t];\r\n}\r\n\r\nclass Modal extends SvelteComponent {\r\n\tconstructor(options) {\r\n\t\tsuper();\r\n\r\n\t\tinit(\r\n\t\t\tthis,\r\n\t\t\toptions,\r\n\t\t\tinstance,\r\n\t\t\tcreate_fragment,\r\n\t\t\tsafe_not_equal,\r\n\t\t\t{\r\n\t\t\t\troot: 0,\r\n\t\t\t\tpreventZoomViewport: 12,\r\n\t\t\t\tpreventScrollBodyIfNeeded: 13,\r\n\t\t\t\tpreventFooterOverlapIfNeeded: 14,\r\n\t\t\t\tclass: 15,\r\n\t\t\t\tshow: 16,\r\n\t\t\t\thide: 17\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t[-1, -1]\r\n\t\t);\r\n\t}\r\n\r\n\tget root() {\r\n\t\treturn this.$$.ctx[0];\r\n\t}\r\n\r\n\tset root(root) {\r\n\t\tthis.$$set({ root });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget preventZoomViewport() {\r\n\t\treturn this.$$.ctx[12];\r\n\t}\r\n\r\n\tset preventZoomViewport(preventZoomViewport) {\r\n\t\tthis.$$set({ preventZoomViewport });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget preventScrollBodyIfNeeded() {\r\n\t\treturn this.$$.ctx[13];\r\n\t}\r\n\r\n\tset preventScrollBodyIfNeeded(preventScrollBodyIfNeeded) {\r\n\t\tthis.$$set({ preventScrollBodyIfNeeded });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget preventFooterOverlapIfNeeded() {\r\n\t\treturn this.$$.ctx[14];\r\n\t}\r\n\r\n\tset preventFooterOverlapIfNeeded(preventFooterOverlapIfNeeded) {\r\n\t\tthis.$$set({ preventFooterOverlapIfNeeded });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget class() {\r\n\t\treturn this.$$.ctx[15];\r\n\t}\r\n\r\n\tset class(klass) {\r\n\t\tthis.$$set({ class: klass });\r\n\t\tflush();\r\n\t}\r\n\r\n\tget show() {\r\n\t\treturn this.$$.ctx[16];\r\n\t}\r\n\r\n\tget hide() {\r\n\t\treturn this.$$.ctx[17];\r\n\t}\r\n}\r\n\r\n// we export a function that renders the view as to not export svelte component related code to outside the ui dir\r\nvar createModal = (options = {}, parent) => new Modal({\r\n    target: parent || document.body,\r\n    props: {\r\n        class: options.class,\r\n        preventZoomViewport: options.preventZoomViewport,\r\n        preventScrollBodyIfNeeded: options.preventScrollBodyIfNeeded,\r\n        preventFooterOverlapIfNeeded: options.preventFooterOverlapIfNeeded,\r\n    },\r\n});\r\n\r\nvar _openEditor = (options = {}, parent) => {\r\n    // set up pub/sub for the app layer\r\n    const { sub, pub } = pubsub();\r\n    const accessors = {};\r\n    const modal = createModal(options, parent);\r\n    const hide = () => {\r\n        if (!modal.hide)\r\n            return; // was destroyed\r\n        modal.hide();\r\n    };\r\n    const show = () => {\r\n        if (!modal.show)\r\n            return; // was destroyed\r\n        modal.show();\r\n    };\r\n    const view = initEditorView(modal.root);\r\n    linkAccessors(view, accessors);\r\n    // link up handle event\r\n    accessors.handleEvent = noop$1;\r\n    view.handleEvent = (type, detail) => {\r\n        // need to do this so we pass correct accessors\r\n        if (type === 'init')\r\n            return accessors.handleEvent(type, accessors);\r\n        // other events\r\n        accessors.handleEvent(type, detail);\r\n    };\r\n    // route close request from view to modal\r\n    view.on('close', async () => {\r\n        const { willClose } = options;\r\n        if (!willClose)\r\n            return hide();\r\n        const shouldClose = await willClose();\r\n        if (shouldClose)\r\n            hide();\r\n    });\r\n    const subscribe = (event, cb) => {\r\n        // capture modal related events\r\n        if (/show|hide/.test(event))\r\n            return sub(event, cb);\r\n        // route rest of events to view\r\n        return view.on(event, cb);\r\n    };\r\n    const modalHandleEventUnsubs = ['show', 'hide'].map((type) => subscribe(type, (detail) => accessors.handleEvent(type, detail)));\r\n    // cleans up view\r\n    const destroy = () => {\r\n        // unsub\r\n        modalHandleEventUnsubs.forEach((unsub) => unsub());\r\n        // remove\r\n        hide();\r\n        modal.$destroy();\r\n        view.destroy();\r\n    };\r\n    defineMethods(accessors, {\r\n        on: subscribe,\r\n        destroy,\r\n        hide,\r\n        show,\r\n    });\r\n    // add element root query\r\n    Object.defineProperty(accessors, 'modal', {\r\n        get: () => modal.root,\r\n        set: () => undefined,\r\n    });\r\n    // route modal events\r\n    modal.$on('close', view.close);\r\n    modal.$on('show', () => pub('show'));\r\n    modal.$on('hide', () => {\r\n        pub('hide');\r\n        if (options.enableAutoDestroy !== false)\r\n            destroy();\r\n    });\r\n    // modal behavior\r\n    if (options.enableAutoHide !== false)\r\n        view.on('process', hide);\r\n    view.on('loadstart', show);\r\n    // test if should\r\n    if (options.enableButtonClose !== false)\r\n        options.enableButtonClose = true;\r\n    // delete class\r\n    delete options.class;\r\n    // update props\r\n    Object.assign(accessors, options);\r\n    return accessors;\r\n};\r\n\r\nvar _overlayEditor = (target, options) => {\r\n    const editor = _appendEditor(target, {\r\n        ...options,\r\n        layout: 'overlay',\r\n    });\r\n    return editor;\r\n};\r\n\r\n// helper method to calculate end style params that are passed to lineEnd style functions\r\nconst getLineEndParams = (start, end, strokeWidth, isSolid) => {\r\n    const direction = vectorCreate(end.x - start.x, end.y - start.y);\r\n    const normal = vectorNormalize(direction);\r\n    const scaledSize = 5 * strokeWidth;\r\n    let scaledSizeHalf;\r\n    // solid\r\n    if (isSolid) {\r\n        scaledSizeHalf = scaledSize * 0.5;\r\n    }\r\n    // stroke\r\n    else {\r\n        scaledSizeHalf = Math.ceil((scaledSize - 1) * 0.5);\r\n    }\r\n    const offset = vectorMultiply(vectorClone(normal), scaledSizeHalf);\r\n    return {\r\n        anchor: vectorClone(start),\r\n        offset,\r\n        normal,\r\n        solid: isSolid,\r\n        size: scaledSize,\r\n        sizeHalf: scaledSizeHalf,\r\n    };\r\n};\r\n// various available styles\r\nconst lineEndStyleArrow = ({ anchor, solid, normal, offset, size, sizeHalf, strokeWidth, strokeColor }, anchorRef) => {\r\n    const x = anchor.x;\r\n    const y = anchor.y;\r\n    const tipOffset = vectorMultiply(vectorClone(normal), size);\r\n    const inset = vectorCreate(x + tipOffset.x, y + tipOffset.y);\r\n    vectorMultiply(tipOffset, 0.55);\r\n    if (solid) {\r\n        // move back so arrow triangle overlaps with end of line (otherwise line sticks out of triangle tip)\r\n        vectorAdd(anchorRef, offset);\r\n        const arrowOffset = vectorMultiply(vectorClone(normal), sizeHalf * 0.5);\r\n        return [\r\n            {\r\n                points: [\r\n                    vectorCreate(x - arrowOffset.x, y - arrowOffset.y),\r\n                    vectorCreate(inset.x - tipOffset.y, inset.y + tipOffset.x),\r\n                    vectorCreate(inset.x + tipOffset.y, inset.y - tipOffset.x),\r\n                ],\r\n                pathClose: true,\r\n                backgroundColor: strokeColor,\r\n            },\r\n        ];\r\n    }\r\n    else {\r\n        // this prevents trouble with sharp line rendering in webgl\r\n        const p = vectorMultiply(vectorPerpendicular(vectorClone(normal)), 0.5);\r\n        const tipLeft = vectorCreate(x - p.x, y - p.y);\r\n        const tipRight = vectorCreate(x + p.x, y + p.y);\r\n        return [\r\n            {\r\n                points: [\r\n                    vectorCreate(inset.x + tipOffset.y, inset.y - tipOffset.x),\r\n                    tipLeft,\r\n                    vectorCreate(x, y),\r\n                    tipRight,\r\n                    vectorCreate(inset.x - tipOffset.y, inset.y + tipOffset.x),\r\n                ],\r\n                pathClose: false,\r\n                strokeWidth: strokeWidth,\r\n                strokeColor: strokeColor,\r\n            },\r\n        ];\r\n    }\r\n};\r\nconst lineEndStyleCircle = ({ anchor, solid, offset, normal, sizeHalf, strokeWidth, strokeColor }, anchorRef) => {\r\n    // update anchor point position\r\n    vectorAdd(anchorRef, offset);\r\n    // if solid, move line slightly towards circle as to make them overlap\r\n    if (solid)\r\n        vectorAdd(anchorRef, vectorInvert(vectorClone(normal)));\r\n    return [\r\n        {\r\n            x: anchor.x,\r\n            y: anchor.y,\r\n            rx: sizeHalf,\r\n            ry: sizeHalf,\r\n            backgroundColor: solid ? strokeColor : undefined,\r\n            strokeWidth: solid ? undefined : strokeWidth,\r\n            strokeColor: solid ? undefined : strokeColor,\r\n        },\r\n    ];\r\n};\r\nconst lineEndStyleBar = ({ anchor, offset, strokeWidth, strokeColor }) => {\r\n    return [\r\n        {\r\n            points: [\r\n                vectorCreate(anchor.x - offset.y, anchor.y + offset.x),\r\n                vectorCreate(anchor.x + offset.y, anchor.y - offset.x),\r\n            ],\r\n            strokeWidth,\r\n            strokeColor,\r\n        },\r\n    ];\r\n};\r\nconst lineEndStyleSquare = ({ anchor, solid, offset, normal, sizeHalf, strokeWidth, strokeColor }, anchorRef) => {\r\n    // update anchor point position\r\n    vectorAdd(anchorRef, offset);\r\n    return [\r\n        {\r\n            x: anchor.x - sizeHalf,\r\n            y: anchor.y - sizeHalf,\r\n            width: sizeHalf * 2,\r\n            height: sizeHalf * 2,\r\n            rotation: vectorAngle(normal),\r\n            backgroundColor: solid ? strokeColor : undefined,\r\n            strokeWidth: solid ? undefined : strokeWidth,\r\n            strokeColor: solid ? undefined : strokeColor,\r\n        },\r\n    ];\r\n};\r\n// this method parses the shape and checks if lineStart or lineEnd is being used\r\nconst createLineEndProcessor = (styles = {}) => (shape) => {\r\n    if (!hasProp(shape, 'lineStart') && !hasProp(shape, 'lineEnd'))\r\n        return;\r\n    // resulting shapes\r\n    const res = [];\r\n    const { lineStart, lineEnd, strokeWidth, strokeColor } = shape;\r\n    const start = vectorCreate(shape.x1, shape.y1);\r\n    const end = vectorCreate(shape.x2, shape.y2);\r\n    const points = [start, end];\r\n    // handle lineStart\r\n    if (lineStart) {\r\n        const [style, solid] = lineStart.split('-');\r\n        const process = styles[style];\r\n        if (process) {\r\n            const params = getLineEndParams(start, end, strokeWidth, !!solid);\r\n            res.push(...process({\r\n                ...params,\r\n                strokeColor,\r\n                strokeWidth,\r\n            }, start));\r\n        }\r\n    }\r\n    // handle lineEnd\r\n    if (lineEnd) {\r\n        const [style, solid] = lineEnd.split('-');\r\n        const process = styles[style];\r\n        if (process) {\r\n            const params = getLineEndParams(end, start, strokeWidth, !!solid);\r\n            res.push(...process({\r\n                ...params,\r\n                strokeColor,\r\n                strokeWidth,\r\n            }, end));\r\n        }\r\n    }\r\n    return [\r\n        // return inner path\r\n        {\r\n            points,\r\n            strokeWidth,\r\n            strokeColor,\r\n        },\r\n        // add line end styles\r\n        ...res,\r\n    ];\r\n};\r\n// the default line end styles available, can import and extend\r\nconst createDefaultLineEndStyles = () => ({\r\n    arrow: lineEndStyleArrow,\r\n    circle: lineEndStyleCircle,\r\n    square: lineEndStyleSquare,\r\n    bar: lineEndStyleBar,\r\n});\r\n\r\nconst safeFactor = (value, factor) => {\r\n    const v = parseFloat(value) * factor;\r\n    return isString(value) ? `${v}%` : v;\r\n};\r\nconst toValue = (value, total) => (isString(value) ? toPixelValue(value, total) : value);\r\nconst frameStyleSolid = (shape) => [\r\n    {\r\n        ...shape,\r\n        frameStyle: 'line',\r\n        frameInset: 0,\r\n        frameOffset: 0,\r\n        frameSize: shape.frameSize ? safeFactor(shape.frameSize, 2) : '2.5%',\r\n        frameRadius: shape.frameRound ? safeFactor(shape.frameSize, 2) : 0,\r\n    },\r\n];\r\nconst frameStyleNine = ({ width: contextWidth, height: contextHeight, frameImage, frameSize = '15%', frameOutset = 0, frameSlices = {\r\n    x1: 0.15,\r\n    y1: 0.15,\r\n    x2: 0.85,\r\n    y2: 0.85,\r\n}, }, { isPreview }) => {\r\n    // need a frame image to render a frame\r\n    if (!frameImage)\r\n        return [];\r\n    const contextSize = Math.sqrt(contextWidth * contextHeight);\r\n    const size = toValue(frameSize, contextSize);\r\n    const width = isPreview ? size : Math.round(size);\r\n    const height = width;\r\n    const outset = toValue(frameOutset, contextSize);\r\n    const outsetDouble = outset * 2;\r\n    const { x1, x2, y1, y2 } = frameSlices;\r\n    const shapeCoordinates = {\r\n        x0: 0,\r\n        y0: 0,\r\n        x1: width,\r\n        y1: height,\r\n        x2: contextWidth - width,\r\n        y2: contextHeight - height,\r\n        x3: contextWidth,\r\n        y3: contextHeight,\r\n        cw: width,\r\n        ch: height,\r\n        ew: contextWidth - width - width,\r\n        eh: contextHeight - height - height,\r\n    };\r\n    const overlap = isPreview ? 1 : 0;\r\n    const overlapDouble = overlap * 2;\r\n    const expandsCanvas = outset > 0;\r\n    const cornerGeneric = {\r\n        expandsCanvas,\r\n        width: shapeCoordinates.cw,\r\n        height: shapeCoordinates.ch,\r\n        backgroundImage: frameImage,\r\n    };\r\n    return [\r\n        // edges\r\n        {\r\n            // t\r\n            expandsCanvas,\r\n            x: shapeCoordinates.x1 - overlap - outset,\r\n            y: shapeCoordinates.y0 - outset,\r\n            width: shapeCoordinates.ew + overlapDouble + outsetDouble,\r\n            height: shapeCoordinates.ch,\r\n            backgroundCorners: [\r\n                { x: x1, y: 0 },\r\n                { x: x2, y: 0 },\r\n                { x: x2, y: y1 },\r\n                { x: x1, y: y1 },\r\n            ],\r\n            backgroundImage: frameImage,\r\n        },\r\n        {\r\n            // b\r\n            expandsCanvas,\r\n            x: shapeCoordinates.x1 - overlap - outset,\r\n            y: shapeCoordinates.y2 + outset,\r\n            width: shapeCoordinates.ew + overlapDouble + outsetDouble,\r\n            height: shapeCoordinates.ch,\r\n            backgroundCorners: [\r\n                { x: x1, y: y2 },\r\n                { x: x2, y: y2 },\r\n                { x: x2, y: 1 },\r\n                { x: x1, y: 1 },\r\n            ],\r\n            backgroundImage: frameImage,\r\n        },\r\n        {\r\n            // l\r\n            expandsCanvas,\r\n            x: shapeCoordinates.x0 - outset,\r\n            y: shapeCoordinates.y1 - overlap - outset,\r\n            width: shapeCoordinates.cw,\r\n            height: shapeCoordinates.eh + overlapDouble + outsetDouble,\r\n            backgroundCorners: [\r\n                { x: 0, y: y1 },\r\n                { x: x1, y: y1 },\r\n                { x: x1, y: y2 },\r\n                { x: 0, y: y2 },\r\n            ],\r\n            backgroundImage: frameImage,\r\n        },\r\n        {\r\n            // r\r\n            expandsCanvas,\r\n            x: shapeCoordinates.x2 + outset,\r\n            y: shapeCoordinates.y1 - overlap - outset,\r\n            width: shapeCoordinates.cw,\r\n            height: shapeCoordinates.eh + overlapDouble + outsetDouble,\r\n            backgroundCorners: [\r\n                { x: x2, y: y1 },\r\n                { x: 1, y: y1 },\r\n                { x: 1, y: y2 },\r\n                { x: x2, y: y2 },\r\n            ],\r\n            backgroundImage: frameImage,\r\n        },\r\n        // corners\r\n        {\r\n            // tl\r\n            ...cornerGeneric,\r\n            x: shapeCoordinates.x0 - outset,\r\n            y: shapeCoordinates.y0 - outset,\r\n            backgroundCorners: [\r\n                { x: 0, y: 0 },\r\n                { x: x1, y: 0 },\r\n                { x: x1, y: y1 },\r\n                { x: 0, y: y1 },\r\n            ],\r\n        },\r\n        {\r\n            // tr\r\n            ...cornerGeneric,\r\n            x: shapeCoordinates.x2 + outset,\r\n            y: shapeCoordinates.y0 - outset,\r\n            backgroundCorners: [\r\n                { x: x2, y: 0 },\r\n                { x: 1, y: 0 },\r\n                { x: 1, y: y1 },\r\n                { x: x2, y: y1 },\r\n            ],\r\n        },\r\n        {\r\n            // br\r\n            ...cornerGeneric,\r\n            x: shapeCoordinates.x2 + outset,\r\n            y: shapeCoordinates.y2 + outset,\r\n            backgroundCorners: [\r\n                { x: x2, y: y2 },\r\n                { x: 1, y: y2 },\r\n                { x: 1, y: 1 },\r\n                { x: x2, y: 1 },\r\n            ],\r\n        },\r\n        {\r\n            // bl\r\n            ...cornerGeneric,\r\n            x: shapeCoordinates.x0 - outset,\r\n            y: shapeCoordinates.y2 + outset,\r\n            backgroundCorners: [\r\n                { x: 0, y: y2 },\r\n                { x: x1, y: y2 },\r\n                { x: x1, y: 1 },\r\n                { x: 0, y: 1 },\r\n            ],\r\n        },\r\n    ];\r\n};\r\nconst frameStyleLine = ({ x, y, width, height, frameInset = '3.5%', frameSize = '.25%', frameColor = [1, 1, 1], frameOffset = '5%', frameAmount = 1, frameRadius = 0, expandsCanvas = false, }, { isPreview }) => {\r\n    const size = Math.sqrt(width * height);\r\n    let frameSizeValue = toValue(frameSize, size);\r\n    const frameInsetValue = toValue(frameInset, size);\r\n    const frameOffsetValue = toValue(frameOffset, size);\r\n    let center = 0;\r\n    if (!isPreview) {\r\n        frameSizeValue = Math.max(1, Math.round(frameSizeValue));\r\n        center = frameSizeValue % 2 == 0 ? 0 : 0.5;\r\n    }\r\n    const r = toValue(safeFactor(frameRadius, frameAmount), size);\r\n    return new Array(frameAmount).fill(undefined).map((_, index) => {\r\n        const offset = frameOffsetValue * index;\r\n        let left = x + frameInsetValue + offset;\r\n        let top = y + frameInsetValue + offset;\r\n        let right = x + width - frameInsetValue - offset;\r\n        let bottom = y + height - frameInsetValue - offset;\r\n        if (!isPreview) {\r\n            left = Math.round(left);\r\n            top = Math.round(top);\r\n            right = Math.round(right);\r\n            bottom = Math.round(bottom);\r\n        }\r\n        const radius = r > 0 ? r - offset : 0;\r\n        return {\r\n            x: left + center,\r\n            y: top + center,\r\n            width: right - left,\r\n            height: bottom - top,\r\n            cornerRadius: radius,\r\n            strokeWidth: frameSizeValue,\r\n            strokeColor: frameColor,\r\n            expandsCanvas,\r\n        };\r\n    });\r\n};\r\nconst frameStyleEdge = ({ x, y, width, height, frameSize = '.25%', frameOffset = 0, frameInset = '2.5%', frameColor = [1, 1, 1], }, { isPreview }) => {\r\n    const size = Math.sqrt(width * height);\r\n    let frameSizeValue = toValue(frameSize, size);\r\n    let frameInsetValue = toValue(frameInset, size);\r\n    let frameOffsetValue = toValue(frameOffset, size);\r\n    let center = 0;\r\n    if (!isPreview) {\r\n        frameSizeValue = Math.max(1, Math.round(frameSizeValue));\r\n        frameInsetValue = Math.round(frameInsetValue);\r\n        frameOffsetValue = Math.round(frameOffsetValue);\r\n        center = frameSizeValue % 2 == 0 ? 0 : 0.5;\r\n    }\r\n    const offset = frameOffsetValue - frameInsetValue;\r\n    const left = x + frameInsetValue + center;\r\n    const top = y + frameInsetValue + center;\r\n    const right = x + width - frameInsetValue - center;\r\n    const bottom = y + height - frameInsetValue - center;\r\n    return [\r\n        // top\r\n        {\r\n            points: [vectorCreate(left + offset, top), vectorCreate(right - offset, top)],\r\n        },\r\n        {\r\n            points: [vectorCreate(right, top + offset), vectorCreate(right, bottom - offset)],\r\n        },\r\n        {\r\n            points: [vectorCreate(right - offset, bottom), vectorCreate(left + offset, bottom)],\r\n        },\r\n        {\r\n            points: [vectorCreate(left, bottom - offset), vectorCreate(left, top + offset)],\r\n        },\r\n    ].map((shape) => {\r\n        shape.strokeWidth = frameSizeValue;\r\n        shape.strokeColor = frameColor;\r\n        return shape;\r\n    });\r\n};\r\nconst frameStyleHook = ({ x, y, width, height, frameSize = '.25%', frameInset = '2.5%', frameLength = '2.5%', frameColor = [1, 1, 1], }, { isPreview }) => {\r\n    const size = Math.sqrt(width * height);\r\n    let frameSizeValue = toValue(frameSize, size);\r\n    let frameInsetValue = toValue(frameInset, size);\r\n    let frameLengthValue = toValue(frameLength, size);\r\n    let center = 0;\r\n    if (!isPreview) {\r\n        frameSizeValue = Math.max(1, Math.round(frameSizeValue));\r\n        frameInsetValue = Math.round(frameInsetValue);\r\n        frameLengthValue = Math.round(frameLengthValue);\r\n        center = frameSizeValue % 2 == 0 ? 0 : 0.5;\r\n    }\r\n    const left = x + frameInsetValue + center;\r\n    const top = y + frameInsetValue + center;\r\n    const right = x + width - frameInsetValue - center;\r\n    const bottom = y + height - frameInsetValue - center;\r\n    return [\r\n        // top\r\n        {\r\n            points: [\r\n                vectorCreate(left, top + frameLengthValue),\r\n                vectorCreate(left, top),\r\n                vectorCreate(left + frameLengthValue, top),\r\n            ],\r\n        },\r\n        {\r\n            points: [\r\n                vectorCreate(right - frameLengthValue, top),\r\n                vectorCreate(right, top),\r\n                vectorCreate(right, top + frameLengthValue),\r\n            ],\r\n        },\r\n        {\r\n            points: [\r\n                vectorCreate(right, bottom - frameLengthValue),\r\n                vectorCreate(right, bottom),\r\n                vectorCreate(right - frameLengthValue, bottom),\r\n            ],\r\n        },\r\n        {\r\n            points: [\r\n                vectorCreate(left + frameLengthValue, bottom),\r\n                vectorCreate(left, bottom),\r\n                vectorCreate(left, bottom - frameLengthValue),\r\n            ],\r\n        },\r\n    ].map((shape) => {\r\n        shape.strokeWidth = frameSizeValue;\r\n        shape.strokeColor = frameColor;\r\n        return shape;\r\n    });\r\n};\r\nconst frameStylePolaroid = ({ x, y, width, height, frameColor = [1, 1, 1] }, { isPreview }) => {\r\n    const size = Math.sqrt(width * height);\r\n    const borderWidth = 0.1 * size;\r\n    let chinHeight = 0.2 * size;\r\n    let overlap = 0;\r\n    const borderWidthHalf = 0.5 * borderWidth;\r\n    if (!isPreview) {\r\n        chinHeight = Math.ceil(chinHeight);\r\n    }\r\n    else {\r\n        overlap = 1;\r\n    }\r\n    // always remove opacity\r\n    frameColor.length = 3;\r\n    return [\r\n        // border\r\n        {\r\n            id: 'border',\r\n            x: x - borderWidthHalf + overlap,\r\n            y: y - borderWidthHalf + overlap,\r\n            width: width + borderWidth - overlap * 2,\r\n            height: height + chinHeight - overlap * 2,\r\n            frameStyle: 'line',\r\n            frameInset: 0,\r\n            frameOffset: 0,\r\n            frameSize: borderWidth,\r\n            frameColor,\r\n            expandsCanvas: true,\r\n        },\r\n        // chin\r\n        {\r\n            id: 'chin',\r\n            x: x - borderWidthHalf,\r\n            y: height - overlap,\r\n            width: width + borderWidth,\r\n            height: chinHeight,\r\n            backgroundColor: frameColor,\r\n            expandsCanvas: true,\r\n        },\r\n    ].filter(Boolean);\r\n};\r\nconst createFrameStyleProcessor = (styles = {}) => (shape, options) => {\r\n    // handle solid frameStyle\r\n    if (!hasProp(shape, 'frameStyle'))\r\n        return;\r\n    const style = shape.frameStyle;\r\n    // get parser for style\r\n    const process = styles[style];\r\n    if (!process)\r\n        return;\r\n    // remove frameStyle property so we don't get endless loops\r\n    const { frameStyle, ...shapeReadyToParse } = shape;\r\n    return process(shapeReadyToParse, options);\r\n};\r\n// the default frame styles available, can import and extend\r\nconst createDefaultFrameStyles = () => ({\r\n    solid: frameStyleSolid,\r\n    hook: frameStyleHook,\r\n    line: frameStyleLine,\r\n    edge: frameStyleEdge,\r\n    polaroid: frameStylePolaroid,\r\n    nine: frameStyleNine,\r\n});\r\n\r\n// the default lineEnd parser to use\r\nconst createDefaultLineEndProcessors = () => createLineEndProcessor(createDefaultLineEndStyles());\r\nconst createDefaultFrameStyleProcessor = () => createFrameStyleProcessor(createDefaultFrameStyles());\r\nconst createDefaultShapeProcessors = () => [\r\n    createDefaultFrameStyleProcessor(),\r\n    createDefaultLineEndProcessors(),\r\n];\r\nconst createShapePreprocessor$1 = (processors) => {\r\n    const processShape = (shape, options = { isPreview: true }) => {\r\n        const res = processors\r\n            .map((process) => {\r\n            const res = process(shape, options);\r\n            // processor wasn't a match?\r\n            if (!res)\r\n                return;\r\n            return res.map((shape) => processShape(shape, options));\r\n        })\r\n            .filter(Boolean)\r\n            .flat();\r\n        return !res.length ? shape : res.flat();\r\n    };\r\n    return processShape;\r\n};\r\n\r\nconst createDefaultImageReader = createDefaultImageReader$1;\r\nconst createDefaultImageWriter = createDefaultImageWriter$1;\r\nconst createDefaultMediaWriter = createDefaultMediaWriter$1;\r\n\r\nconst createDefaultImageOrienter = () => ({\r\n    read: getImageOrientationFromFile,\r\n    apply: orientImageData,\r\n});\r\nconst createDefaultImageScrambler = (configurationOptions = {}) => {\r\n    // default configuration\r\n    const { blurAmount, dataSizeScalar, scrambleAmount, backgroundColor } = configurationOptions;\r\n\r\n    // as called from editor ui\r\n    return (imageData, uiOptions) => {\r\n        return imageDataScramble(imageData, {\r\n            blurAmount,\r\n            scrambleAmount,\r\n            backgroundColor,\r\n            ...uiOptions,\r\n            dataSizeScalar: dataSizeScalar || uiOptions.dataSizeScalar,\r\n        });\r\n    };\r\n};\r\nconst createEditor = createImageEditor;\r\nconst getEditorProps = () => getEditorProps$1().concat(getEditorViewProps()); // private api for framework components\r\n\r\nconst createMarkupEditorToolbar = createToolbar;\r\nconst createMarkupEditorToolStyles = createToolStyles;\r\n\r\n// markup editor style controls\r\nconst createMarkupEditorShapeStyleControls = createShapeStyleControls;\r\n\r\nconst markup_editor_defaults = {\r\n    markupEditorToolbar: createToolbar(),\r\n    markupEditorToolStyles: createToolStyles(),\r\n    markupEditorShapeStyleControls: createShapeStyleControls(),\r\n};\r\nconst setPlugins = setEditorViewPlugins;\r\n\r\nconst plugin_crop = _plugin_crop;\r\nconst plugin_filter = _plugin_filter;\r\nconst plugin_finetune = _plugin_finetune;\r\nconst plugin_annotate = _plugin_annotate;\r\nconst plugin_decorate = _plugin_decorate;\r\nconst plugin_sticker = _plugin_sticker;\r\nconst plugin_frame = _plugin_frame;\r\nconst plugin_redact = _plugin_redact;\r\nconst plugin_resize = _plugin_resize;\r\n\r\nconst plugin_finetune_defaults = _plugin_finetune_defaults;\r\nconst plugin_filter_defaults = _plugin_filter_defaults;\r\nconst plugin_frame_defaults = _plugin_frame_defaults;\r\n\r\nconst locale_en_gb = _locale_en_gb;\r\nconst markup_editor_locale_en_gb = MarkupEditor;\r\n\r\nconst plugin_crop_locale_en_gb = _plugin_crop_locale_en_gb;\r\nconst plugin_filter_locale_en_gb = _plugin_filter_locale_en_gb;\r\nconst plugin_finetune_locale_en_gb = _plugin_finetune_locale_en_gb;\r\nconst plugin_resize_locale_en_gb = _plugin_resize_locale_en_gb;\r\nconst plugin_decorate_locale_en_gb = _plugin_decorate_locale_en_gb;\r\nconst plugin_annotate_locale_en_gb = _plugin_annotate_locale_en_gb;\r\nconst plugin_sticker_locale_en_gb = _plugin_sticker_locale_en_gb;\r\nconst plugin_frame_locale_en_gb = _plugin_frame_locale_en_gb;\r\nconst plugin_redact_locale_en_gb = _plugin_redact_locale_en_gb;\r\n\r\nconst elementsToEditor = (factory, targets, options = {}) => {\r\n    const elements = isString(targets) ? Array.from(document.querySelectorAll(targets)) : targets;\r\n    return elements.filter(Boolean).map((element) => factory(element, deepCopy(options)));\r\n};\r\n\r\nconst appendEditor = _appendEditor;\r\nconst openEditor = _openEditor;\r\nconst overlayEditor = _overlayEditor;\r\nconst appendEditors = (targets, options) => elementsToEditor(appendEditor, targets, options);\r\n\r\nconst createShapePreprocessor = createShapePreprocessor$1;\r\n\r\nconst createDefaultShapePreprocessor = (customProcessors = []) => {\r\n    return createShapePreprocessor$1([...createDefaultShapeProcessors(), ...customProcessors]);\r\n};\r\n\r\n//\r\n// creating default editors\r\n//\r\n\r\nconst getEditorDefaultReadWriteOptions = (options = {}) => {\r\n    let readerProps = undefined;\r\n    if (!Array.isArray(options.imageReader)) {\r\n        readerProps = options.imageReader;\r\n        delete options.imageReader;\r\n    }\r\n\r\n    let imageWriter;\r\n    if (!Array.isArray(options.imageWriter)) {\r\n        if (isFunction(options.imageWriter)) {\r\n            imageWriter = options.imageWriter;\r\n        } else {\r\n            imageWriter = createDefaultImageWriter(options.imageWriter);\r\n        }\r\n        delete options.imageWriter;\r\n    } else {\r\n        imageWriter = createDefaultImageWriter();\r\n    }\r\n\r\n    let scramblerProps = undefined;\r\n    if (!isFunction(options.imageScrambler)) {\r\n        scramblerProps = options.imageScrambler;\r\n        delete options.imageScrambler;\r\n    }\r\n\r\n    return {\r\n        // default handling of images\r\n        imageReader: createDefaultImageReader(readerProps),\r\n        imageWriter,\r\n        imageOrienter: createDefaultImageOrienter(),\r\n        imageScrambler: createDefaultImageScrambler(scramblerProps),\r\n    };\r\n};\r\n\r\nconst processDefaultImage = (src, options = {}) => {\r\n    // get default read/write options object\r\n    const defaultReadWriteOptions = getEditorDefaultReadWriteOptions(options);\r\n\r\n    // handle custom shape preprocessorss\r\n    const shapePreprocessor =\r\n        typeof options.shapePreprocessor === 'function'\r\n            ? options.shapePreprocessor\r\n            : createDefaultShapePreprocessor(options.shapePreprocessor);\r\n    delete options.shapePreprocessor;\r\n\r\n    // create huge config object\r\n    options = mergeObjects([\r\n        {\r\n            // set reader / writer / orienter\r\n            ...defaultReadWriteOptions,\r\n\r\n            // shape preprocessor\r\n            shapePreprocessor,\r\n\r\n            // stickers stick to image by default\r\n            stickerStickToImage: true,\r\n        },\r\n        options,\r\n    ]);\r\n    return processImage(src, options);\r\n};\r\n\r\nconst getEditorDefaults = (options = {}) => {\r\n    // load all plugins\r\n    setEditorViewPlugins(\r\n        ...[\r\n            plugin_crop,\r\n            plugin_filter,\r\n            plugin_finetune,\r\n            plugin_annotate,\r\n            plugin_decorate,\r\n            plugin_sticker,\r\n            plugin_frame,\r\n            plugin_redact,\r\n            plugin_resize,\r\n        ].filter(Boolean)\r\n    );\r\n\r\n    // auto hide stickers util if no stickers defined\r\n    const utils = [\r\n        'trim', // if a video is loaded we show trim plugin at the top\r\n        'crop',\r\n        'filter',\r\n        'finetune',\r\n        'annotate',\r\n        'decorate',\r\n        options.stickers && 'sticker',\r\n        'frame',\r\n        'redact',\r\n        'resize',\r\n    ].filter(Boolean);\r\n\r\n    // get default read/write options object\r\n    const defaultReadWriteOptions = getEditorDefaultReadWriteOptions(options);\r\n\r\n    // locale\r\n    const locale = {\r\n        ...locale_en_gb,\r\n        ...markup_editor_locale_en_gb,\r\n        ...plugin_crop_locale_en_gb,\r\n        ...plugin_filter_locale_en_gb,\r\n        ...plugin_finetune_locale_en_gb,\r\n        ...plugin_frame_locale_en_gb,\r\n        ...plugin_redact_locale_en_gb,\r\n        ...plugin_resize_locale_en_gb,\r\n        ...plugin_decorate_locale_en_gb,\r\n        ...plugin_annotate_locale_en_gb,\r\n        ...plugin_sticker_locale_en_gb,\r\n        ...options.locale,\r\n    };\r\n    delete options.locale;\r\n\r\n    // handle custom shape preprocessorss\r\n    const shapePreprocessor =\r\n        typeof options.shapePreprocessor === 'function'\r\n            ? options.shapePreprocessor\r\n            : createDefaultShapePreprocessor(options.shapePreprocessor);\r\n    delete options.shapePreprocessor;\r\n\r\n    // create huge config object\r\n    return mergeObjects([\r\n        {\r\n            // set reader / writer / orienter\r\n            ...defaultReadWriteOptions,\r\n\r\n            // shape preprocessor\r\n            shapePreprocessor,\r\n\r\n            // default utils\r\n            utils,\r\n\r\n            // default plugin options\r\n            ...plugin_finetune_defaults,\r\n            ...plugin_filter_defaults,\r\n            ...plugin_frame_defaults,\r\n            ...markup_editor_defaults,\r\n\r\n            // stickers stick to image by default\r\n            stickerStickToImage: true,\r\n\r\n            // locale\r\n            locale,\r\n        },\r\n        options,\r\n    ]);\r\n};\r\n\r\nconst defineCustomElements = async (options = {}) => {\r\n    const elements = await _defineCustomElements();\r\n    elements.forEach((editor) => Object.assign(editor, deepCopy(options)));\r\n    return elements;\r\n};\r\n\r\nconst defineDefaultCustomElements = (options) =>\r\n    defineCustomElements(getEditorDefaults(options));\r\n\r\nconst openDefaultEditor = (options, parent) =>\r\n    openEditor(getEditorDefaults(options), parent);\r\n\r\nconst appendDefaultEditor = (element, options) =>\r\n    appendEditor(element, getEditorDefaults(options));\r\n\r\nconst overlayDefaultEditor = (element, options) =>\r\n    overlayEditor(element, getEditorDefaults(options));\r\n\r\nconst appendDefaultEditors = (targets, options) =>\r\n    elementsToEditor(appendDefaultEditor, targets, options);\r\n\r\nexport { appendDefaultEditor, appendDefaultEditors, appendEditor, appendEditors, appendNode, blobToFile, colorStringToColorArray, createDefaultColorOptions, createDefaultFontFamilyOptions, createDefaultFontScaleOptions, createDefaultFontSizeOptions, createDefaultFontStyleOptions, createDefaultFrameStyles, createDefaultImageOrienter, createDefaultImageReader, createDefaultImageScrambler, createDefaultImageWriter, createDefaultLineEndStyleOptions, createDefaultLineEndStyles, createDefaultLineHeightOptions, createDefaultLineHeightScaleOptions, createDefaultMediaWriter, createDefaultShapePreprocessor, createDefaultStrokeScaleOptions, createDefaultStrokeWidthOptions, createDefaultTextAlignOptions, createEditor, createFrameStyleProcessor, createLineEndProcessor, createBackgroundColorControl as createMarkupEditorBackgroundColorControl, createColorControl as createMarkupEditorColorControl, createColorOptions as createMarkupEditorColorOptions, createFontColorControl as createMarkupEditorFontColorControl, createFontFamilyControl as createMarkupEditorFontFamilyControl, createFontFamilyOptions as createMarkupEditorFontFamilyOptions, createFontScaleOptions as createMarkupEditorFontScaleOptions, createFontSizeControl as createMarkupEditorFontSizeControl, createFontSizeOptions as createMarkupEditorFontSizeOptions, createFontStyleControl as createMarkupEditorFontStyleControl, createFontStyleOptions as createMarkupEditorFontStyleOptions, createLineEndStyleControl as createMarkupEditorLineEndStyleControl, createLineEndStyleOptions as createMarkupEditorLineEndStyleOptions, createLineHeightControl as createMarkupEditorLineHeightControl, createLineHeightOptions as createMarkupEditorLineHeightOptions, createLineHeightScaleOptions as createMarkupEditorLineHeightScaleOptions, createLineStartStyleControl as createMarkupEditorLineStartStyleControl, createMarkupEditorShapeStyleControls, createStrokeColorControl as createMarkupEditorStrokeColorControl, createStrokeScaleOptions as createMarkupEditorStrokeScaleOptions, createStrokeWidthControl as createMarkupEditorStrokeWidthControl, createStrokeWidthOptions as createMarkupEditorStrokeWidthOptions, createTextAlignControl as createMarkupEditorTextAlignControl, createToolStyle as createMarkupEditorToolStyle, createMarkupEditorToolStyles, createMarkupEditorToolbar, createNode, createShapePreprocessor, defineCustomElements, defineDefaultCustomElements, degToRad, dispatchEditorEvents, brightness as effectBrightness, clarity as effectClarity, contrast as effectContrast, exposure as effectExposure, gamma as effectGamma, saturation as effectSaturation, temperature as effectTemperature, vignette as effectVignette, chrome as filterChrome, cold as filterCold, fade as filterFade, invert as filterInvert, monoDefault as filterMonoDefault, monoNoir as filterMonoNoir, monoStark as filterMonoStark, monoWash as filterMonoWash, pastel as filterPastel, sepiaBlues as filterSepiaBlues, sepiaColor as filterSepiaColor, sepiaDefault as filterSepiaDefault, sepiaRust as filterSepiaRust, warm as filterWarm, findNode, edgeCross as frameEdgeCross, edgeOverlap as frameEdgeOverlap, edgeSeparate as frameEdgeSeparate, hook as frameHook, lineMultiple as frameLineMultiple, lineSingle as frameLineSingle, polaroid as framePolaroid, solidRound as frameSolidRound, solidSharp as frameSolidSharp, getEditorDefaults, getEditorProps, imageStateToCanvas, insertNodeAfter, insertNodeBefore, isModernBrowser as isSupported, legacyDataToImageState, locale_en_gb, markup_editor_defaults, markup_editor_locale_en_gb, naturalAspectRatioToNumber, openDefaultEditor, openEditor, overlayDefaultEditor, overlayEditor, plugin_annotate, plugin_annotate_locale_en_gb, plugin_crop, plugin_crop_locale_en_gb, plugin_decorate, plugin_decorate_locale_en_gb, plugin_filter, plugin_filter_defaults, plugin_filter_locale_en_gb, plugin_finetune, plugin_finetune_defaults, plugin_finetune_locale_en_gb, plugin_frame, plugin_frame_defaults, plugin_frame_locale_en_gb, plugin_redact, plugin_redact_locale_en_gb, plugin_resize, plugin_resize_locale_en_gb, plugin_sticker, plugin_sticker_locale_en_gb, processDefaultImage, processImage, removeNode, setPlugins, shapeGetCenter, shapeGetLength, shapeGetLevel, supportsWebGL };\r\n","import {\r\n    // editor\r\n    appendEditor,\r\n    createDefaultImageReader,\r\n    createDefaultImageWriter,\r\n    createDefaultShapePreprocessor,\r\n    createNode,\r\n    appendNode,\r\n    findNode,\r\n    locale_en_gb,\r\n\r\n    // plugins\r\n    setPlugins,\r\n    plugin_crop,\r\n    plugin_crop_locale_en_gb,\r\n    plugin_filter,\r\n    plugin_filter_defaults,\r\n    plugin_filter_locale_en_gb,\r\n    plugin_finetune,\r\n    plugin_finetune_defaults,\r\n    plugin_finetune_locale_en_gb,\r\n    plugin_annotate,\r\n    plugin_annotate_locale_en_gb,\r\n    markup_editor_defaults,\r\n    markup_editor_locale_en_gb,\r\n    plugin_frame,\r\n    plugin_frame_defaults,\r\n    plugin_frame_locale_en_gb,\r\n} from '../pintura/pintura.js';\r\n\r\nlet editor;\r\nlet panel;               \r\n\r\n//\r\n// helper functions\r\n//\r\nconst h = (name, attributes, children = []) => {\r\n    const el = document.createElement(name);\r\n    const descriptors = Object.getOwnPropertyDescriptors(el.__proto__);\r\n    for (const key in attributes) {\r\n        if (key === 'style') {\r\n            el.style.cssText = attributes[key];\r\n        } else if (\r\n            (descriptors[key] && descriptors[key].set) ||\r\n            /textContent|innerHTML/.test(key) ||\r\n            typeof attributes[key] === 'function'\r\n        ) {\r\n            el[key] = attributes[key];\r\n        } else {\r\n            el.setAttribute(key, attributes[key]);\r\n        }\r\n    }\r\n    children.forEach((child) => el.appendChild(child));\r\n    return el;\r\n};\r\n\r\nconst handleCustomize = () => {\r\n    var radios = document.getElementsByName('cropinputtype');\r\n    if (radios[0].checked) {\r\n        const {expectedWidth, expectedHeight, ratioWidth, ratioHeight} = window;\r\n        inputedSize.width = expectedWidth.value;\r\n        inputedSize.height = expectedHeight.value;\r\n        inputedRatio.width = expectedWidth.value;\r\n        inputedRatio.height = expectedHeight.value;\r\n        var width = parseFloat(expectedWidth.value) * 300;\r\n        var height = parseFloat(expectedHeight.value) * 300;\r\n        // no need to update\r\n        if (editor.imageCropSize.width === width && editor.imageCropSize.height === height) return;\r\n\r\n        // update state\r\n        if (height > 0) {\r\n            editor.imageCropAspectRatio = width / height;\r\n        }\r\n        // var currentCrop = editor.imageCrop;\r\n        // editor.imageCrop = {x: currentCrop.x + (currentCrop.width - width) / 2,\r\n        //                     y: currentCrop.y + (currentCrop.height - height) / 2,\r\n        //                     width: width,\r\n        //                     height: height}\r\n        \r\n        editor.history.write();\r\n    } else if (radios[1].checked) {\r\n        inputedRatio.width = ratioWidth.value;\r\n        inputedRatio.height = ratioHeight.value;\r\n        // update state\r\n        var width = parseFloat(ratioWidth.value);\r\n        var height = parseFloat(ratioHeight.value);\r\n        if (height > 0) {\r\n            editor.imageCropAspectRatio = width / height;\r\n        }\r\n        editor.history.write();\r\n    }\r\n    \r\n    setTimeout(\"expectedHeight.dispatchEvent(ke)\", 300);\r\n}\r\n\r\nconst inputtypeChange = (e) => {\r\n    const {expectedWidth, expectedHeight, ratioWidth, ratioHeight} = window;\r\n    var radios = document.getElementsByName('cropinputtype');\r\n\r\n    expectedWidth.disabled = !radios[0].checked;\r\n    expectedHeight.disabled = !radios[0].checked;\r\n    ratioWidth.disabled = !radios[1].checked;\r\n    ratioHeight.disabled = !radios[1].checked;\r\n\r\n    if (!expectedWidth.disabled) {\r\n        expectedWidth.focus();\r\n        expectedWidth.select();\r\n    }\r\n    if (!ratioWidth.disabled) {\r\n        ratioWidth.focus();\r\n        ratioWidth.select();\r\n    }\r\n}\r\n\r\nsetPlugins(\r\n    plugin_crop,\r\n    plugin_filter,\r\n    plugin_finetune,\r\n    plugin_frame,\r\n    // plugin_annotate,\r\n);\r\n\r\n// create panel content\r\nconst form = h(\r\n    'form',\r\n    {\r\n        class: 'export-form',\r\n    },\r\n    [\r\n        h('div', {style:'padding-bottom:0.25em'} ,[\r\n            h('span', {style:'width:6.8em;text-align:right;display:inline-block', textContent:'w'}, ),\r\n            h('span', {style:'width:4.3em;text-align:right;display:inline-block', textContent:'h'}, ),\r\n        ]),\r\n        h('ul',\r\n            {},\r\n            [h( \r\n                'li',\r\n                {},[                     \r\n                // crop size\r\n                h(\r\n                    'label',\r\n                    {                                   \r\n                    },\r\n                    [\r\n                        h('input', { name: 'cropinputtype', type: 'radio', checked: 'true', value:'size',\r\n                                onchange: (event) => {inputtypeChange(event)}}),\r\n\r\n                        h('span', { class: \"customizeinput\",textContent: 'Print size :', }, [                            \r\n                            h('input', {\r\n                                id: 'expectedWidth',\r\n                                type: 'number',\r\n                                min: 0,\r\n                                max: 100,\r\n                                // value: editor.imageCropSize.width / 300,\r\n                                step: 0.1,\r\n                                onkeydown: (event) => {\r\n                                    // If return key\r\n                                    if (event.keyCode == 13) {\r\n                                        handleCustomize();\r\n                                    }\r\n                                }\r\n                            }),\r\n                            h('span', {\r\n                                textContent: 'x',\r\n                                style: 'width: 1.5em;display: inline-block;text-align: right;margin: 0;'\r\n                            }),\r\n                            h('input', {\r\n                                id: 'expectedHeight',\r\n                                type: 'number',\r\n                                min: 0,\r\n                                // value: editor.imageCropSize.height / 300,\r\n                                max: 100,\r\n                                step: 0.1,\r\n                                onkeydown: (event) => {\r\n                                    // If return key\r\n                                    if (event.keyCode == 13) {\r\n                                        handleCustomize();\r\n                                    }\r\n                                }\r\n                            }),\r\n                            h('span', {\r\n                                textContent: 'inch',\r\n                            }),\r\n                        ]),\r\n                    ]\r\n                ),\r\n                ]\r\n            ),\r\n            h( \r\n                'li',\r\n                {},[                     \r\n                // crop ratio\r\n                h(\r\n                    'label',\r\n                    {                                 \r\n                        \r\n                    },\r\n                    [\r\n                        h('input', { name: 'cropinputtype', type: 'radio', value:'type',\r\n                             onchange: (event) => {inputtypeChange(event)}}),\r\n\r\n                        h('span', { class: \"customizeinput\", textContent: 'Print ratio:'}, [   \r\n                            h('input', {\r\n                                id: 'ratioWidth',\r\n                                type: 'number',\r\n                                min: 0,\r\n                                max: 100,\r\n                                step: 1,\r\n                                disabled: true,\r\n                                onkeydown: (event) => {\r\n                                    // If return key\r\n                                    if (event.keyCode == 13) {\r\n                                        handleCustomize();\r\n                                    }\r\n                                }\r\n                            }),\r\n                            h('span', {\r\n                                textContent: ':',\r\n                                style: 'width: 1.5em;display: inline-block;text-align: right;margin: 0;'\r\n                            }),\r\n                            h('input', {\r\n                                id: 'ratioHeight',\r\n                                type: 'number',\r\n                                min: 0,\r\n                                max: 100,\r\n                                step: 1,\r\n                                disabled: true,\r\n                                onkeydown: (event) => {\r\n                                    // If return key\r\n                                    if (event.keyCode == 13) {\r\n                                        handleCustomize();\r\n                                    }\r\n                                },\r\n                            }),\r\n                        ]),\r\n                    ]\r\n                ),\r\n                ]\r\n            )\r\n                        ])\r\n    ]\r\n);\r\n\r\n// inline\r\n{\r\n    editor = appendEditor('.inline-editor', {\r\n        src: './sample.jfif',\r\n        // This will set a square crop aspect ratio\r\n        imageCropAspectRatio: 4 / 3,\r\n        imageCrop: {\r\n            x: 400,\r\n            y: 300,\r\n            width: 1000,\r\n            height: 720,\r\n        },\r\n        // Offer different crop options\r\n        cropSelectPresetFilter: 'landscape',\r\n        cropSelectPresetOptions: cropSelectOptions,\r\n        cropWillRenderTools: (tools, env) => {\r\n            // insert your item\r\n            panel = createNode('Panel', 'customize', {\r\n                            buttonLabel: ' ',\r\n                            buttonClass: 'PinturaButtonHidden', \r\n                            onshow: value => {\r\n                                const {expectedWidth, expectedHeight, ratioWidth, ratioHeight} = window;\r\n                                var realWidth = (editor.imageCropSize.width / 300).toFixed(1);\r\n                                var realHeight = (editor.imageCropSize.height / 300).toFixed(1);\r\n                                if ( inputedSize.width > 0 && inputedSize.height > 0 \r\n                                    && realWidth > inputedSize.width && realHeight > inputedSize.height) {\r\n                                    expectedWidth.value = inputedSize.width;\r\n                                    expectedHeight.value = inputedSize.height;\r\n                                } else {\r\n                                    expectedWidth.value = realWidth;\r\n                                    expectedHeight.value = realHeight;\r\n                                }\r\n                                \r\n                                var cropRatio = editor.imageCropSize.width / editor.imageCropSize.height;\r\n                                if(!ratioWidth.disabled && ratioWidth.value.length > 0 && ratioHeight.value.length > 0) {\r\n                                    if (cropRatio == ratioWidth.value / ratioHeight.value)\r\n                                        return;\r\n                                }\r\n\r\n                                var ratioLabel = getRatioLabel(cropRatio);\r\n                                \r\n                                if (ratioLabel.widthLable != 0) ratioWidth.value = ratioLabel.widthLable;\r\n                                if (ratioLabel.heightLable != 0) ratioHeight.value = ratioLabel.heightLable;\r\n\r\n                                if(ratioWidth.value.length == 0) ratioWidth.value = expectedWidth.value;\r\n                                if(ratioHeight.value.length == 0) ratioHeight.value = expectedHeight.value;\r\n                            }, \r\n                            root: form,\r\n                        });\r\n            return [panel,  ...tools,];\r\n        },\r\n\r\n        cropEnableRotationInput: true,\r\n        cropEnableButtonRotateLeft: true,\r\n        // cropEnableButtonFlipHorizontal: false,\r\n        cropEnableZoomInput: true,\r\n        cropImageSelectionCornerStyle: 'hook',\r\n        cropEnableSelectPreset: true,\r\n        cropEnableInfoIndicator: true,\r\n        hasCropSelectPresetOptions: true,\r\n        imageReader: createDefaultImageReader(),\r\n        imageWriter: createDefaultImageWriter(),\r\n        shapePreprocessor: createDefaultShapePreprocessor(),\r\n        enableBrowseImage: true,                    \r\n        ...plugin_filter_defaults,\r\n        ...plugin_frame_defaults,\r\n        ...plugin_finetune_defaults,\r\n        ...markup_editor_defaults,\r\n        locale: {\r\n            ...locale_en_gb,\r\n            ...plugin_crop_locale_en_gb,\r\n            ...plugin_finetune_locale_en_gb,\r\n            ...plugin_filter_locale_en_gb,\r\n            ...plugin_annotate_locale_en_gb,\r\n            ...plugin_frame_locale_en_gb,\r\n            ...markup_editor_locale_en_gb,\r\n        },\r\n    });\r\n\r\n    const downloadFile = (file) => {\r\n        // Create a hidden link and set the URL using createObjectURL\r\n        const link = document.createElement('a');\r\n        link.style.display = 'none';\r\n        link.href = URL.createObjectURL(file);\r\n        link.download = file.name;\r\n\r\n        // We need to add the link to the DOM for \"click()\" to work\r\n        document.body.appendChild(link);\r\n        link.click();\r\n\r\n        // To make this work on Firefox we need to wait a short moment before clean up\r\n        setTimeout(() => {\r\n            URL.revokeObjectURL(link.href);\r\n            link.parentNode.removeChild(link);\r\n        }, 0);\r\n    };\r\n\r\n    editor.on('load', (res) => console.log('inline result', res));\r\n\r\n    editor.on('process', (res) => {\r\n        downloadFile(res.dest);\r\n            // var resultUrl = URL.createObjectURL(res.dest);\r\n            // document\r\n            //     .querySelector('.inline-result')\r\n            //     .setAttribute('src', resultUrl)\r\n        }\r\n    );\r\n}\r\n"],"names":["Markers","value","name","subvalue","dataViewGetApplicationMarkers","view","getUint16","length","byteLength","marker","res","offset","getUint8","markerDescription","find","descriptor","size","arrayBufferImageExif","data","key","DataView","markers","exif","tags","getUint32","byteAlignment","storedAsLittleEndian","getTagOffsets","offsets","i","max","tagOffset","push","read","address","tagOffsets","write","forEach","setUint16","dataViewGetExifTags","undefined","backup","getNativeAPIRef","API","window","noop$1","args","FileReaderDataFormat","ArrayBuffer","result$c","isBrowser","document","result$b","canOrientImages","Promise","resolve","testSrc","testImage","Image","onload","naturalWidth","src","canvasToImageData","canvas","getContext","getImageData","width","height","h","attributes","children","el","createElement","descriptors","Object","getOwnPropertyDescriptors","__proto__","style","cssText","set","test","setAttribute","child","appendChild","MATRICES","releaseCanvas","ctx","clearRect","isImageData","obj","imageDataToCanvas","async","imageData","orientation","inMemoryCanvas","putImageData","transform","apply","getImageOrientationMatrix","drawImage","HTMLCanvasElement","orientImageData","isObject","v","copy","val","deepCopy","dst","Array","isArray","keys","isString","isFunction","canCreateImageBitmap","isSVGFile","blob","type","getUniqueId","Math","random","toString","substr","workerPool","Map","thread","fn","transferList","reject","workerKey","pooledWorker","get","workerFn","wrapFunction","url","URL","createObjectURL","Blob","functionToBlob","messages","worker","Worker","terminationTimeout","terminate","clearTimeout","revokeObjectURL","delete","onmessage","e","id","content","error","setTimeout","has","message","messageId","postMessage","blobToImageData","imageBlob","canvasMemoryLimit","file","done","createImageBitmap","then","bitmap","canvasWidth","canvasHeight","requiredCanvasMemory","canvasScalar","sqrt","floor","OffscreenCanvas","catch","err","imageElement","image","options","ready","naturalHeight","imageToCanvas","complete","onerror","blobToCanvas","canvasToBlob","mimeType","quality","toBlob","imageDataToBlob","matroska","getExtensionFromMimeType","ext","match","post","split","ImageExtensionsRegex","getMimeTypeFromFilename","filename","pop","toLowerCase","blobToFile","mimetype","lastModified","Date","getTime","blobHasMimeType","blobMimeType","fileMimeType","targetMimeTypeExtension","lastIndexOf","getFilenameWithoutExtension","matchFilenameToMimeType","slice","getAspectRatio","w","passthrough","PI","HALF_PI","QUART_PI","isRotatedSideways","a","rotationLimited","abs","Direction","Top","Right","Bottom","Left","TopLeft","TopRight","BottomRight","BottomLeft","DirectionCoordinateTable","fixPrecision","precision","parseFloat","toFixed","scale","scalar","pivot","vectorCreateEmpty","vectorCreate","x","y","vectorCreateFromAny","vectorCreateFromPointerEvent","pageX","pageY","vectorClone","vectorInvert","vectorRotate","radians","cos","sin","tx","ty","vectorLength","vectorNormalize","vectorEqual","b","vectorApply","vectorAdd","vectorSubtract","vectorMultiply","f","vectorCross","vectorDistanceSquared","vectorDistance","vectorScale","vectorCenter","vectorsFlip","points","flipX","flipY","cx","cy","point","vectorsRotate","angle","s","c","p","rx","ry","toSize","sizeClone","sizeCreateFromAny","sizeCreateFromRect","r","sizeCreateFromElement","element","nodeName","sizeCreate","sizeEqual","format","sizeScale","sizeCenter","sizeRotate","sizeContains","sizeApply","lineCreate","start","end","lineClone","line","lineExtend","amount","n","m","CornerSigns","toRect","rectClone$1","rect","rectCreateEmpty","rectCreateFromSize","rectCreateFromAny","rectCreateFromPoints","xMin","xMax","yMin","yMax","min","rectCreateWithCenter","center","rectCreate","rectCenter","rectTranslate$1","t","rectScale$1","rectClamp","sizeMin","sizeMax","rectGetCornerByTarget","target","xf","yf","rectMultiply","factor","rectDivide","rectEqual","rectAspectRatio","rectUpdate","rectUpdateWithRect","rectRotate","rectGetCorners","map","vertex","rectCenterRect","rectContainsPoint","rectCoverRect","aspectRatio","inputAspectRatio","rectContainRect","rectToBounds","rectApply","rectApplyPerspective","perspective","corner","index","sign","rectNormalizeOffset","convexPolyCentroid","vertices","first","last","fx","fy","twiceArea","l","lineLineIntersection","getLineLineIntersectionPoint","d","denominator","uA","uB","linePointsIntersection","ignoreIdenticalLines","breakOnIntersection","intersections","intersection","quadLines","arr","next","quadToLines","extension","isElement","HTMLElement","RegExp","isFile","File","canvasToFile","getFilenameFromURL","shift","fn$1","Node","prototype","replaceChildren","parent","newChildren","lastChild","removeChild","append","container","class","timeoutId","appendForMeasuring","parentNode","body","remove","result$a","isSafari","navigator","userAgent","getImageElementSize","shouldAutoRemove","measure","clearInterval","intervalId","setInterval","getVideoElementSize","videoWidth","videoHeight","readyState","onloadedmetadata","isImage","getAsVideoOrImageElement","elementSrc","createImage","preload","isVideoElement","getImageSize","mediaElement","createProgressEvent","loaded","lengthComputable","total","getResponseHeader","xhr","header","parse","getAllResponseHeaders","indexOf","getFilenameFromContentDisposition","matches","splice","trim","replace","filter","decodeURI","EditorError","Error","constructor","code","metadata","super","this","configureXHR","headers","credentials","entries","setRequestHeader","withCredentials","isBlob","isImageBitmap","srcToFile","onprogress","dataURI","fetch","includes","dataURIToFile","handleError","XMLHttpRequest","response","status","willRequest","resourceType","requestInit","open","responseType","send","console","fetchFile","urlToFile","awaitComplete","imageToFile","result$9","isUserAgent","result$8","isIOS","platform","maxTouchPoints","orientImageSize","isJPEG","stringify","JSON","ctxRotate","rotation","translate","rotate","cropImageData","crop","imageSize","shouldFlip","shouldRotate","cropDefined","cropCoversImage","shouldCrop","imageDataOut","ctxScale","restore","outputSize","ctxTranslate","resizeTransform","inputWidth","inputHeight","outputWidth","round","outputHeight","inputData","outputData","Uint8ClampedArray","scaleX","scaleY","scaleXHalf","ceil","scaleYHalf","j","x2","weight","weights","weightsAlpha","g","centerY","yy","dy","centerX","w0","xx","dx","ref","imageDataObjectToImageData","ImageData","createImageData","resizeImageData","fit","upscale","targetWidth","targetHeight","scalarWidth","scalarHeight","buffer","colorEffect","matrix","m11","m12","m13","m14","m15","m21","m22","m23","m24","m25","m31","m32","m33","m34","m35","m41","m42","m43","m44","m45","mr","mg","mb","ma","or","og","ob","convolutionEffect","kernelWeight","reduce","prev","curr","side","sideHalf","scy","scx","srcOff","vignetteEffect","strength","dist","fr","fg","fb","br","bg","bb","ba","fa","ca","dm","input","output","alpha","noiseEffect","level","monochrome","rand","pixel","average","gammaEffect","pow","filterImageData","colorMatrix","convolutionMatrix","gamma","gammaLevel","noise","noiseLevel","vignette","vignetteStrength","filters","clarity","isIdentityMatrix","chain","transforms","filterChain","filterInstructions","isNumber","hasProp","hasOwnProperty","isBinary","colorArrayToRGBA","color","objectUID","values","join","whenSVGSafeForDrawing","img","delay","timeout","Uint32Array","some","isContextBlank","safariDrawCache","blobToDataURL","reader","FileReader","result","readAsDataURL","pubsub","subs","sub","event","callback","subscriber","pub","TextPadding","textGetStyles","fontSize","fontFamily","fontVariant","fontWeight","fontStyle","textAlign","lineHeight","textGetContentEditableStyles","text","disableNewline","isAutoWidth","allowNewline","textGetLineCount","wordBreak","whiteSpace","textGetInitialLineOffset","TextMeasureCache","TextSizeCache","textToSize","uid","endsWith","contenteditable","spellcheck","innerHTML","getBoundingClientRect","StyleSheetLoaders","getRulesRemote","styleSheetContent","loader","txt","cb","createStyleSheetLoader","loadStylesheet","head","tempStyleSheet","from","styleSheets","styleSheet","ownerNode","cssRules","RemoteStyleSheetRulesCache","getCSSPropertyValue","rule","getPropertyValue","isMatchingFontRule","getFontSources","fontFaceRules","href","rules","importRule","CSSImportRule","filterImportRules","remoteRules","CSSFontFaceRule","filterFontFaceRules","getFontFaceRulesSafe","ruleSets","all","ruleSet","getDocumentStylesheetFontFaceRules","matchingRules","fontRule","getMatchingFontRule","parentStyleSheet","styleSheetPath","origin","pathname","getPathFromURL","fontSrcFirst","fontProps","prop","props","FontLocal","FontCache","textToImage","imageWidth","imageHeight","paddingLeft","paddingRight","pixelRatio","textStyles","textContentEditableStyles","fontEmbed","fontStyles","fontSources","fontFaces","fontSource","dataType","dataURL","getFontFaceEmbed","svg","safariCacheKey","svgToImage","shapeDeepCopy","shape","shapeShallowCopy","shapeLineGetStartPoint","x1","y1","shapeLineGetEndPoint","y2","shapeIsText","shapeIsTextBlock","shapeHasRelativeSize","shapeIsRect","shapeHasComputedSize","shapeIsEllipse","shapeIsLine","shapeIsPath","shapeIsVisible","opacity","shapeHasSize","shapeCanStyle","disableStyle","shapeDeleteRelativeProps","left","right","top","bottom","shapeDeleteTransformProps","shapeFormatStroke","strokeWidth","strokeColor","shapeFormatFill","backgroundColor","backgroundImage","shapeFormat","disableErase","shapeFormatDefaults","shapeFormatTextBlock","shapeFormatTextBox","shapeFormatText","cornerRadius","shapeFormatRect","disableResize","disableMove","shapeFormatPath","lineStart","lineEnd","shapeFormatLine","shapeFormatEllipse","xRegExp","yRegExp","computeProps","context","compute","shapeComputeDisplay","shapeComputeRect","shapesBounds","shapes","parentRect","bounds","shapeBounds","shapesFromCompositShape","parser","shapeCopy","shapeScale","shapeHasNumericStroke","_scale","isCanvas","cache","getImage","onMetadata","onLoad","onError","onComplete","imageLoadState","loading","bus","cloneNode","onSize","sizeCalculated","reportSize","location","crossOrigin","finally","drawCanvas","srcRect","destRect","ctxDrawImage","draw","save","clip","getDrawImageParams","backgroundSize","backgroundCorners","defineRectShape","radius","beginPath","moveTo","arcTo","closePath","ctxRoundRect","fillRectShape","fill","strokeRectShape","stroke","drawRect","lineWidth","strokeStyle","fillStyle","globalAlpha","drawEllipse","ellipse","drawText","drawLine","lineStartPosition","lineEndPosition","lineTo","drawPath","pathClose","drawShape","shapeIsTextBox","shapeGetCenter","ctxFlip","subShapes","drawShapes","drawnShapes","drawImageData","contextBounds","computeShape","preprocessShape","computedShapes","flat","fillImageData","hasBackgroundColor","globalCompositeOperation","fillRect","getColorMatrixFromColorMatrices","colorMatrices","previous","current","dotColorMatrix","getImageRedactionScaleFactor","redactionShapes","imageRes","maxShapeSize","maxShapeRes","roundFraction","noop","identity","tar","k","run","blank_object","create","run_all","fns","is_function","thing","safe_not_equal","subscribe","store","callbacks","unsub","unsubscribe","get_store_value","_","component_subscribe","component","$$","on_destroy","create_slot","definition","$$scope","slot_ctx","get_slot_context","get_slot_changes","dirty","lets","merged","len","update_slot_base","slot","slot_definition","slot_changes","get_slot_context_fn","slot_context","get_all_dirty_from_scope","exclude_internal_props","compute_rest_props","rest","Set","set_store_value","ret","action_destroyer","action_result","destroy","is_client","now","performance","raf","requestAnimationFrame","tasks","run_tasks","task","loop","promise","fulfill","add","abort","node","get_root_for_style","root","getRootNode","ownerDocument","host","append_empty_stylesheet","style_element","sheet","append_stylesheet","insert","anchor","insertBefore","detach","svg_element","createElementNS","createTextNode","space","empty","listen","handler","addEventListener","removeEventListener","stop_propagation","stopPropagation","call","attr","attribute","removeAttribute","getAttribute","set_attributes","set_data","wholeText","custom_event","detail","bubbles","cancelable","createEvent","initCustomEvent","HtmlTag","is_svg","html","childNodes","managed_styles","current_component","active","create_rule","duration","ease","step","keyframes","str","hash","charCodeAt","doc","stylesheet","info","create_style_information","insertRule","animation","set_current_component","get_current_component","onMount","on_mount","onDestroy","createEventDispatcher","defaultPrevented","setContext","bubble","dirty_components","binding_callbacks","render_callbacks","flush_callbacks","resolved_promise","update_scheduled","schedule_update","flush","tick$1","add_render_callback","add_flush_callback","seen_callbacks","flushidx","saved_component","update","clear","fragment","before_update","after_update","dispatch","direction","kind","dispatchEvent","outroing","outros","group_outros","check_outros","transition_in","block","local","transition_out","o","null_transition","create_bidirectional_transition","params","intro","config","running_program","pending_program","animation_name","clear_animation","anim","deleted","delete_rule","init","program","group","go","easing","tick","css","globals","globalThis","global","destroy_block","lookup","outro_and_destroy_block","update_keyed_each","old_blocks","get_key","dynamic","list","create_each_block","get_context","old_indexes","new_blocks","new_lookup","deltas","child_ctx","will_move","did_move","new_block","old_block","new_key","old_key","get_spread_update","levels","updates","to_null_out","accounted_for","get_spread_object","spread_props","bind","bound","create_component","mount_component","customElement","new_on_destroy","destroy_component","detaching","instance","create_fragment","not_equal","append_styles","parent_component","on_disconnect","skip_bound","make_dirty","hydrate","nodes","SvelteComponent","$destroy","$on","$set","$$props","$$set","subscriber_queue","readable","writable","stop","subscribers","new_value","run_queue","invalidate","derived","stores","initial_value","single","stores_array","auto","inited","pending","cleanup","sync","unsubscribers","UPDATE_VALUE","updateValue","DEFAULT_VALUE","defaultValue","CUSTOM_STORE","DERIVED_STORE","UNIQUE_DERIVED_STORE","selectedStores","isEqual","currentValue","isFirst","storeValues","MAP_STORE","valueMapper","observedStores","sorter","storedItems","$observedStores","mapValue","item","setValue","items","mappedItems","sort","createStores","accessors","opts","assign","storeInstance","onUpdate","ignoreFirstCallback","updateStoreValue","nextValue","previousValue","createStore$1","property","defineProperty","_set","newValue","defineMethods","object","api","pointInPoly","aX","aY","bX","bY","edgeX","edgeY","offsetRectToFitPolygon","poly","polyLines","atan2","ray","lineExtended","rectOffset","every","limitCropRectToImage","rectVertexes","rectCenterPosition","rectVertex","lineMultiply","intersectionFound","rectLimitedVertices","rectLimitedToPolygon","getImagePolygon","imageRotation","imagePerspective","imageRect","imageCenter","imagePoly","imageVertex","imagePolyBounds","getMaxSizeInRect","innerAngle","rotationSigned","rotationSignedMod","rotationSignedModHalf","hyp","getBaseCropRect","transformedCropRect","imageTransformedVertices","imageRotatedBoundsCenter","cropCenterInTransformedImage","deRotatedCropCenter","cropFromCenterOfTransformedImage","originalCropCenterOffset","clamp","ORDERED_STATE_PROPS","clone","filterShapeState","startsWith","arrayEqual","isCropCentered","cropCenter","imageRotatedVertices","imageBoundsCenter","formatShape","_isFormatted","_isDraft","_context","ImageStorePropDescriptors","$size","perspectiveX","perspectiveY","rotationNext","rotationPrevious","loadState","rotationRange","cropMinSize","cropMaxSize","cropLimitToImage","cropOrigin","beforeComplete","cropWasAtMaxSize","cropRect","maxSize","isCropMaxSize","cropWasCentered","imageRotationPrevious","imageRotationRange","cropLimitToImageBounds","cropRectOrigin","minSize","didAttemptDoubleTurn","cropRectBase","imageTransformedCorners","perspectiveOffset","rotateCropOffset","imageBoundsRect","imageCentroid","cropOffset","cropRectOut","minScalar","maxScalar","imageTurns","imageRotationClamped","applyRotationAction","$rotation","prevValue","cropNext","cropPrevious","cropAspectRatio","cropRectPrevious","cropRectNext","previousCropRectCenter","nextCropRectCenter","cw","ch","imagePolygon","maxSizeInRect","intendedAspectRatio","intendedCenter","containedRect","limitRectToImage","applyCropRectAction","cropOut","aspectRatioNext","aspectRatioPrevious","toNumericAspectRatio","aspectRatioDist","sizeTurn","cropSize","limitToImageNext","limitToImagePrevious","$crop","$cropSize","cropRectAspectRatio","$cropRectAspectRatio","$cropMinSize","$cropMaxSize","$cropLimitToImage","range","updateCropRange","prevRange","nextRange","$isRotatedSideways","imageIsRotatedSideways","Infinity","requiredSpace","acos","rangeHorizontal","rangeVertical","asin","Number","isNaN","updateRotationRange","padColorArray","frameShapeNext","frameStyle","isAssigningState","forceState","state","redaction","annotation","decoration","setState","process","chainTasks","chainOptions","processOptions","ontaskstart","ontaskprogress","ontaskend","token","cancelled","cancel","editorEventsToBubble","imagePrivateProps","imagePublicProps","getImagePropGroupedName","charAt","toUpperCase","isImageState","createImageEditor","getImageObjSafe","images","initialImageProps","initialImagePropsBackup","unsubSrc","imageReader","loadSrc","unsubReader","loadImage","imageLoadAbort","cropLimitedToImage","imageCropLimitToImage","imageCropLmitedToImage","imageCropMinSize","minImageSize","removeImage","createProcessingHandler","stateProp","eventKey","getStore","setStore","timeStamp","hasError","onabort","taskProgress","taskLengthComputable","ontaskerror","readerOptions","imageReadToken","imageReadCancelled","imageReadHandler","readerState","dest","minWidth","minHeight","writer","processState","imageWriteHandler","writerState","imageState","imageWriteToken","imageWriteCancelled","writerOptions","on","createImageCore","fin","unsubs","imageCrop","imageRotatedSize","imageCropAspectRatio","propKeys","filteredOptions","filtered","applyImageOptionsOrState","imageWriter","imageProcessAbort","abortLoadImage","editImage","unsubReject","unsubResolve","processImage","isImageSource","shapePreprocessor","imageScrambler","willRequestResource","abortProcessImage","getCanvasMemoryLimit","isSafari15","filterObjectProperties","createCanvasImageDrawer","imageDataResizer","createDefaultImageReader$1","createDefaultImageWriter$1","targetSize","connect","getter","setter","progressUpdated","AnyToFile","srcProp","destProp","BlobReadImageSize","getMediaDuration","BlobReadMediaDuration","ImageSizeMatchOrientation","srcSize","srcOrientation","destSize","BlobReadImageHead","dataFormat","readFile","blobReadSection","ImageHeadReadExifOrientationTag","ImageHeadClearExifOrientationTag","CalculateCanvasScalar","srcImageSize","srcCanvasSize","srcImageState","destImageSize","destScalar","naturalSize","canvasSize","BlobToImageData","ImageDataMatchOrientation","srcImageData","ImageDataFill","ImageDataCrop","ImageDataResize","destImageScaledSize","MAX_SAFE_INTEGER","ImageDataFilter","destImageData","Boolean","ImageDataRedact","imageBackgroundColor","scrambledCanvas","dataSizeScalar","path","Path2D","corners","addPath","imageSmoothingEnabled","ImageDataAnnotate","imageSizeScalar","imageTargetSize","imageSizeScaled","scaledSize","imageScaledSize","rotatedRect","getImageTransformedRect","rotatedSize","isPreview","ImageDataDecorate","ImageDataFrame","frame","contaxtScalar","ImageDataToBlob","srcFile","destBlob","ImageDataToCanvas","destCanvas","writeImageHead","headEnd","section","blobWriteSection","BlobWriteImageHead","srcBlob","srcHead","BlobToFile","renameFile","destFile","defaultFilename","Store","dataset","destStore","beforeSend","request","upload","ontimeout","encodeURI","FormData","formData","PropFilter","allowlist","orientImage","outputProps","preprocessImageFile","createStore","genericOptions","copyImageHead","preprocessImageSource","preprocessImageState","postprocessImageData","postprocessImageBlob","result$7","supportsWebGL2","isPowerOf2","stringReplace","prefix","postfix","SHADER_VERT_SNIPPETS","SHADER_FRAG_SNIPPETS","mask","colorize","maskapply","maskfeatherapply","edgeaa","cornerradius","fragcolor","compileShader","gl","shader","createShader","transpiledSrc","VERTEX_SHADER","FRAGMENT_SHADER","transpileShader","shaderSource","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","vertexShaderCode","fragmentShaderCode","attribs","uniforms","vertexShader","fragmentShader","createProgram","attachShader","linkProgram","locations","getAttribLocation","getUniformLocation","detachShader","deleteShader","deleteProgram","canMipMap","source","applyOpacity","mat4Create","mat","Float32Array","mat4Ortho","near","far","lr","bt","nf","mat4Translate","z","mat4Scale","mat4RotateX","rad","a10","a11","a12","a13","a20","a21","a22","a23","mat4RotateY","a00","a01","a02","a03","mat4RotateZ","getWebGLContext","attrs","getIndex","isPointInTriangle","ab","bc","ap","bp","cp","c1","c2","c3","createPathSegment","tangent","miter","normal","miterLength","vectorDot","rectPointsToVertices","createRectPoints","pushRectCornerPoints","limit","getWebGLTextureSizeLimit","getParameter","MAX_TEXTURE_SIZE","result$6","isFirefox","RECT_UV","RECT_UV_ROTATED","SHOULD_APPLY_ROTATED_UV_TO_VIDEO_TEXTURES","CLARITY_IDENTITY","COLOR_MATRIX_IDENTITY$1","COLOR_TRANSPARENT","NO_CORNERS","calculateBackgroundUVMap","backgroundPosition","viewPixelDensity","createWebGLCanvas","viewSize","viewSizeVisual","textureSizeLimit","viewAspectRatio","pathSharpness","overlayMatrixCanvas","imageFrameBuffer","overlayMatrix","maskTop","maskRight","maskBottom","maskLeft","maskOpacity","maskBounds","IMAGE_MASK_FEATHER","RECT_MASK_FEATHER","CANVAS_COLOR_R","CANVAS_COLOR_G","CANVAS_COLOR_B","CANVAS_COLOR_A","indexTextureMap","disablePreviewStencil","stencilOp","KEEP","stencilFunc","ALWAYS","stencilMask","FOV","FOV_TAN_HALF","tan","antialias","premultipliedAlpha","stencil","getExtension","disable","DEPTH_TEST","enable","STENCIL_TEST","BLEND","blendFunc","ONE","ONE_MINUS_SRC_ALPHA","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","transparentTexture","createTexture","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","Uint8Array","imageOverlayTexture","overlayFramebuffer","createFramebuffer","imageBlendTexture","blendFramebuffer","imageShader","imagePositionsBuffer","createBuffer","texturePositionsBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","texturePositionsRotatedBuffer","pathShader","pathBuffer","strokePath","close","useProgram","enableVertexAttribArray","aPosition","aNormal","aMiter","createPathVertices","stride","BYTES_PER_ELEMENT","normalOffset","miterOffset","uniform1f","uWidth","uSharpness","uniform4fv","uColor","uniformMatrix4fv","uMatrix","uniform4f","uCanvasColor","uniform1fv","uMaskBounds","uMaskOpacity","vertexAttribPointer","FLOAT","drawArrays","TRIANGLE_STRIP","disableVertexAttribArray","triangleShader","trianglesBuffer","rectShader","rectBuffer","rectTextureBuffer","rectCornerBuffer","ellipseShader","ellipseBuffer","ellipseTextureBuffer","glTextures","imageFramebufferSize","drawToImageFramebuffer","pixelDensity","textureScalar","textureWidth","textureHeight","bindFramebuffer","FRAMEBUFFER","texParameteri","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","framebufferTexture2D","COLOR_ATTACHMENT0","mat4ScaleY","viewport","colorMask","clearColor","COLOR_BUFFER_BIT","textureDelete","texture","forceRelease","retain","deleteTexture","strokeClose","computedPoints","computedStrokeWidth","triangles","isIntersectingSelf","va","vb","area","getPolygonArea","reverse","totalVertices","indexList","vc","vaToVb","vaToVc","isEar","safe","triangulate","TRIANGLES","fillTriangles","backgroundUVMap","maskFeather","inverted","rectOut","cornerRadiusOut","limitCornerRadius","rectFill","colorFilter","uv","aTexCoord","aRectCoord","uniform2fv","uSize","uPosition","uniform1i","uInverted","uCornerRadius","uMaskFeather","uTexture","uTextureColor","uTextureOpacity","activeTexture","TEXTURE0","tl","tr","bl","createRectOutline","uRadius","fillEllipse","resolution","ellipseToPolygon","createEllipseOutline","textureSize","originX","originY","translateX","translateY","rotateX","rotateY","rotateZ","maskCornerRadius","imageOverlayColor","enableOverlay","enableBlend","enableAntialiasing","imagePositions","viewZ","fovy","aspect","mat4Perspective","uniform2f","uTextureSize","blendTextureIndex","blendTexture","uTextureBlend","overlayTextureIndex","overlayTexture","uTextureOverlay","rotateUV","isRotatedVideo","textureIsRotatedVideo","clarityWeight","uOverlayColor","uClarityKernel","uClarityKernelWeight","uColorGamma","uColorVignette","uAntialias","uColorOffset","uColorMatrix","uOpacity","uMaskCornerRadius","textureFilterNearest","NEAREST","textureFilterLinear","textureCreate","textureUpdate","LINEAR_MIPMAP_LINEAR","TEXTURE_MAG_FILTER","generateMipmap","applyTextureProperties","updateTexture","textureGetSize","enablePreviewStencil","REPLACE","applyPreviewStencil","EQUAL","setCanvasColor","resetCanvasMatrix","updateCanvasMatrix","translation","imageOrigin","imageVisualCenter","imageAbsoluteCenter","drawToCanvas","drawingBufferWidth","drawingBufferHeight","drawToImageBlendBuffer","drawToImageOverlayBuffer","enableMask","maskX","maskY","maskWidth","maskHeight","disableMask","resize","release","circOut","is_date","get_interpolator","bi","delta","interpolators","tweened","defaults","target_value","previous_task","started","interpolate","elapsed","tick_spring","last_value","current_value","velocity","dt","stiffness","damping","inv_mass","settled","next_value","spring","last_time","current_token","inv_mass_recovery_rate","cancel_task","hard","soft","rate","fulfil","prefersReducedMotion","mql","matchMedia","addListener","removeListener","rectNext","updateNodeRect","CustomEvent","measureViewRect","clientRect","measureOffset","offsetLeft","offsetTop","offsetWidth","offsetHeight","observer","observedNodes","measurable","observePosition","observeViewRect","once","disabled","ResizeObserver","entry","observe","unobserve","disconnect","focusvisible","isKeyboardInteraction","pointerdown","keydown","keyup","focus","focusVisible","blur","getResourceFromItem","getAsFile","getAsString","dropable","handleDragOver","preventDefault","handleDrop","resources","dataTransfer","getResourcesFromEvent","result$5","isSoftwareRendering","failIfMajorPerformanceCaveat","create_fragment$P","div","canvas_1","mounted","dispose","instance$Q","$$self","$$invalidate","canDraw","drawUpdate","$maskFrameOpacityStore","$background","$imageOverlayColor","$maskOpacityStore","$mask","isAnimated","isTransparent","maskRect","maskFrameOpacity","maskMarkupOpacity","clipAnnotationsToImage","textPixelRatio","willRender","didRender","loadImageData","interfaceImages","canvasGL","updateSpring","SPRING_PROPS_FRACTION","backgroundColorAnimationDuration","background","maskOpacityStore","maskFrameOpacityStore","requestRedraw","redrawForce","Textures","PlaceholderTextures","getImageTexture","imageRendering","isTexture","WebGLTexture","drawImageHelper","overlayColor","sharpenOffsetX","sharpenOffsetY","atActualSize","EPSILON","backgroundCornersToUVMap","EmptyVector","shapeTexture","_isLoading","backgroundImageRendering","lastCharPosition","textSize","measurement","endMarker","elementRect","endMarkerRect","textMeasure","textUID","xOffset","yOffset","widthRounded","heightRounded","textureSizeScalar","getTextTexture","getShapeTexture","_translate","shapeRect","shapeBackgroundColor","shapeStrokeColor","shapeCornerRadius","textureAspectRatio","pixelTextureSize","_prerender","isFirstDraw","wasFlipping","usedBlendTextures","usedAnnotationTextures","usedTextures","redraw","imagesTop","blendShapes","blendShapesDirty","annotationShapes","annotationShapesDirty","interfaceShapes","decorationShapes","frameShapes","selectionRect","canvasBackgroundColor","imagesMask","imagesMaskOpacity","imagesOverlayColor","xFlipProgress","yFlipProgress","isFlipping","imagesSize","imagesBackgroundColor","imagesBackgroundImage","hasBlendShapes","hasAnnotations","hasImageBackgroundColor","hasPreviewStencil","backR","backG","backB","frontA","frontR","frontG","frontB","fA","back","front","bR","bG","bB","fR","fG","fB","blendWithCanvasBackground","shapesInside","expandsCanvas","shapesOutside","backgroundRect","registeredTexture","usedTexture","releaseUnusedTextures","lastDraw","redrawThrottled","afterUpdate","propertyValue","getComputedStyle","durationToMilliseconds","$$value","Canvas","arrayJoin","get_each_context$9","get_default_slot_changes$1","tab","get_default_slot_context$1","create_if_block$g","ul","ul_class_value","each_blocks","each_1_lookup","each_value","create_each_block$9","key_1","li","button","button_disabled_value","li_aria_controls_value","li_id_value","li_aria_selected_value","default_slot_template","default","default_slot","keydown_handler","click_handler","tabId","selected","new_ctx","create_fragment$O","if_block_anchor","if_block","instance$P","tabNodes","shouldRender","$$slots","slots","klass","tabs","layout","focusTab","querySelectorAll","handleClickTab","handleKeyTab","findIndex","isActive","TabList","get_default_slot_changes_1","panel","get_default_slot_context_1","panelIsActive","get_each_context$8","shouldDraw","panelId","tabindex","labelledBy","hidden","visible","get_default_slot_changes","get_default_slot_context","create_else_block$6","div1","div0","div0_class_value","create_if_block$f","div_class_value","create_each_block$8","create_if_block_1$e","div_hidden_value","div_id_value","div_tabindex_value","div_aria_labelledby_value","div_data_inert_value","create_fragment$N","current_block_type_index","if_block_creators","if_blocks","select_block_type","previous_block_index","instance$O","panelNodes","panelClass","panels","drawCache","isVisible","TabPanels","getComponentExportedProps","Component","create_fragment$M","svg_viewBox_value","instance$N","Icon","nudgeable","shiftMultiplier","stopKeydownPropagation","isHorizontalDirection","isVerticalDirection","handleKeydown","isShift","shiftKey","isVerticalAction","isHorizontalAction","multiplier","toFraction","get_knob_slot_changes","get_knob_slot_context","create_if_block$e","button0","icon0","button1","icon1","create_default_slot_1$7","create_default_slot$h","icon0_changes","icon1_changes","create_fragment$L","div4","div3","input_1","input_1_style_value","t0","t1","div2","div1_class_value","div3_style_value","t2","div4_class_value","knob_slot_template","knob","knob_slot","arguments","instance$M","numberValue","fraction","position","axis","dimension","offsetSizeProp","pageAxisProp","knobControllerStyle","inputSize","inputOffset","pageOffset","valuePrev","valuePrevIntended","valueMin","valueMax","trackStyle","trackClass","knobStyle","knobClass","ongrab","onchange","onrelease","onexceed","getValue","enableSpinButtons","enableForceUseKnob","enableStopPropagation","enablePointerdownListener","maxInteractionDistance","formatValue","numberRoundTo","setValueByOffset","grabbed","released","intendedValue","minValue","maxValue","nudgeTimer","handlePointerMove","handlePointerUp","documentElement","updateDir","updateTimer","didUpdate","handleUpdaterUp","activeElement","dir","Slider","eventDistanceToKnob","handlePointerDown","isEventTarget","contains","create_if_block_1$d","icon_1","create_default_slot$g","icon_1_changes","create_if_block$d","span","create_fragment$K","default_slot_or_fallback","if_block0","if_block1","fallback_block$2","instance$L","handleDown","handleUp","elButtonInnerClass","elButtonClass","elLabelClass","holdTimer","label","labelClass","innerClass","hideLabel","icon","onclick","onkeydown","onhold","action","holdThreshold","holdSpeedUpFactor","holdSpeedMin","hold","holdStep","Button","getElement","create_if_block$c","switch_instance","updating_name","switch_instance_anchor","switch_instance_spread_levels","switch_instance_name_binding","switch_value","switch_props","switch_instance_props","switch_instance_changes","old_component","create_fragment$J","instance$K","componentProps","isLocal","$isActivePrivateStore","$opacityClamped","$isAnimated","locale","opacityClamped","$opacity","isHidden","isActivePrivateStore","stateProps","isActiveFraction","ComponentView","componentExportedProps","componentComputedProps","computedProps","componentComputedStateProps","computedStateProps","panelName","rootElement","handleMeasure","hasBeenMounted","UtilPanel","INERTIA_DURATION_MULTIPLIER","interactable","inertia","inertiaDurationMultiplier","shouldStartInteraction","pinch","multiTouch","getEventPosition","clientX","clientY","resetInertia","inertiaTweenUnsubscribe","pointers","getPointerTimestamp","getPointersCenter","flattenPointerOrigin","pointer","getPointer","pointerId","getPointerIndex","isSingleTouching","isMultiTouching","inertiaTween","inertiaOrigin","inertiaTranslation","pinchOffsetDistance","currentTranslation","currentScale","isGesture","lastTapPosition","lastTapTimeStamp","handlePointerdown","isContextMenuAction","timeStampInitial","velocityHistory","velocityAverage","interactionState","distance","getDistance","getInteractionState","addPointer","handlePointermove","handlePointerup","moveLast","eventPosition","interactionDuration","updatePointer","centerBetweenPointers","removedPointer","array","predicate","arrayRemove","removePointer","pinchCurrentDistance","isTap","isDoubleTap","interactionEnd","interactionDistanceSquared","inertiaPrevented","preventInertia","force","handleEnd","handleInertiaUpdate","tapState","elastify","log10","elastifyRects","elastifyVectors","unitToPixels","parseInt","getWheelDelta","deltaX","deltaY","wheelDelta","wheelDeltaX","wheelDeltaY","ArrowKeys","Up","Down","create_fragment$I","nudgeable_action","passive","instance$J","containerStyle","containerFeatherSize","overflows","containerState","childStyle","$scrollOffset","scrollOrigin","scrollRect","scrollContainerRect","scrollReleased","scrollState","scrollOffset","scrollBlockInteractionDist","scrollStep","scrollFocusMargin","scrollDirection","scrollAutoCancel","elasticity","onscroll","maskFeatherSize","maskFeatherStartOpacity","maskFeatherEndOpacity","scroll","overflowStyle","scrollAtRest","scrollOffsetUnsub","pos","limitOffsetToContainer","scrollFirstMove","scrollCancelled","scrollTranslationPrev","setScrollOffset","elastic","animate","preventScrollState","offsetLimited","offsetVisual","snapToPosition","startOffset","endOffset","speed","diff","isHorizontalTranslation","isHoldingShift","classList","currentScrollOffset","margin","querySelector","Scrollable","fade$1","create_fragment$H","span_transition","instance$I","onmeasure","StatusMessage","create_fragment$G","span1","circle0","circle1","span0","instance$H","formattedValue","circleValue","circleOpacity","$animatedOpacity","$animatedProgressClamped","progress","labelBusy","animatedValue","animatedOpacity","animatedProgressClamped","$animatedValue","animatedProgressClampedUnsub","ProgressIndicator","create_fragment$F","span_class_value","instance$G","StatusAside","create_if_block_2$b","label_for_value","label_levels","for","label_data","create_if_block_1$c","div_levels","div_data","create_if_block$b","create_fragment$E","instance$F","Tag","getDevicePixelRatio","devicePixelRatio","snapToPixel","preventScroll","scrollTop","get_details_slot_changes","get_details_slot_context","get_label_slot_changes","get_label_slot_context","create_else_block$5","button_spread_levels","button_props","create_default_slot$f","button_changes","create_if_block_2$a","label_slot_template","label_slot","create_if_block_1$b","details_slot_template","details","details_slot","create_fragment$D","if_block2_anchor","panelMargin","instance$E","buttonElement","offsetProgress","isAnimating","tipScale","tipOpacity","tipStyle","buttonProps","$portal","$position","$offset","$portalRootRect","buttonClass","buttonLabel","onshow","onhide","portal","portalRootRect","panelSize","buttonComponent","buttonRect","syncButtonRect","isTargetSelf","detailPanel","trigger","downOutsidePanel","handleClick","handleButtonKeydown","detailPanelRef","parentLeft","parentTop","parentRight","parentBottom","panelLeft","panelTop","panelRight","panelBottom","Panel","create_fragment$C","label_1","li_class_value","checked","instance$D","inputId","$keysPressedStored","ArrowKeyCodes","keysPressedStored","RadioItem","flattenOptions","concat","mapOption","option","optionMapper","mappedOption","localize","localizeOptions","localizeOptions$1","isDeepEqual","get_each_context$7","get_option_slot_changes_1","get_option_slot_context_1","get_each_context_1","get_option_slot_changes","get_option_slot_context","get_group_slot_changes","get_group_slot_context","create_if_block_1$a","fieldset","fieldset_class_value","create_if_block_7$1","create_each_block$7","legend","legend_class_value","create_else_block$4","radioitem","create_default_slot_2$4","radioitem_changes","create_if_block_2$9","group_slot_template","group_slot","group_slot_or_fallback","t_value","fallback_block_1","each_value_1","create_each_block_1","create_if_block_6$2","create_default_slot_3$2","icon_changes","raw_value","create_if_block_5$4","option_slot_template","option_slot","option_slot_or_fallback","fallback_block_2","create_if_block_4$6","create_default_slot_1$6","create_if_block_3$7","create_default_slot$e","fallback_block$1","create_fragment$B","if_block1_anchor","instance$C","localizedOptions","mappedOptions","flattenedOptions","selectedIndex","optionFilter","optionLabelClass","title","optionClass","optionGroupClass","getOptionIndex","flattenedOption","changeSelection","payload","opop","mapOptions","getUndefinedOptionIndex","RadioGroup","get_controls_slot_changes","get_controls_slot_context","create_if_block_2$8","create_default_slot_1$5","create_label_slot$2","span0_class_value","span1_title_value","span1_class_value","create_group_slot$1","create_if_block_1$9","create_default_slot$d","create_if_block$a","sublabel","create_option_slot$4","html_tag","span0_style_value","create_details_slot$3","radiogroup","controls_slot_template","controls","controls_slot","radiogroup_changes","create_fragment$A","updating_isActive","panel_isActive_binding","panel_props","panel_changes","instance$B","selectedLabel","dropdownVisible","optionIconStyle","optionLabelStyle","ondestroy","optionValue","optionLabel","getUndefinedOptionLabel","hiddenButtons","getElementsByClassName","click","Dropdown","create_details_slot$2","create_fragment$z","instance$A","firstChild","hasChildNodes","replaceChild","DynamicPanel","hide","show","create_if_block$9","create_default_slot$c","create_label_slot$1","create_details_slot$1","slider","slider_spread_levels","slider_props","slider_changes","create_fragment$y","instance$z","omit_props_names","$$restProps","currentLabel","syncLabel","getLabel","$$new_props","ToggleSlider","get_each_context$6","create_else_block$3","create_if_block$8","tag","create_default_slot$b","tag_changes","create_if_block_3$6","html_anchor","create_if_block_2$7","textContent","create_if_block_1$8","dynamiccomponenttree","DynamicComponentTree_1","discardEmptyItems","dynamiccomponenttree_changes","select_block_type_1","create_each_block$6","key_2","show_if","create_fragment$x","each_1_anchor","instance$y","treeUniqueKey","ComponentMap","isComponent","shouldRenderItem","ImagePropsDerived","ImageStoreProps","createPing","isTextField","isTextInput","isContentEditable","toKebabCase","abbr","mediaQueryStore","query","mm","matchMedia$1","isVideoFile","blobToImageBitmap","ImageOrienter","video","onseeked","drawFrame","onloadeddata","currentTime","load","videoToImageData","toImageData","imageBitmap","imageBitmapToImageData","imageDataContain","result$4","supportsWebGL","COLOR_MATRIX_IDENTITY","SPRING_PROPS","isDarkColor","result$3","toPercentageNumber","getEventPositionInViewport","getEventPositionInStage","viewOffset","stageOffset","positionInViewport","instance$x","canZoom","canPan","imageFitsOnStage","zoomLevels","zoomMin","zoomMax","zoomLevelSelectedIndex","zoomLevelCurrent","zoomLevelLabel","$imageSelectionPan","$imageSelectionZoom","$imageSelectionRect","$stageRect","$rootRect","$imageSelectionStageFitScalar","$imagePreviewUpscale","$isInteracting","$stageScalar","$imageSelectionStoredState","allowPan","allowZoom","enablePan","enableZoom","enableZoomControls","enableZoomInput","enablePanInput","enablePanLimit","panLimitGutterScalar","zoomOptions","zoomAdjustStep","zoomAdjustFactor","zoomAdjustWheelFactor","imageSelectionRectCentered","imageSelectionRectScalar","zoomLevel","zoomControls","zoomMultiTouching","isInteracting","rootRect","stageRect","stageScalar","imageSelectionPan","imageSelectionZoom","imageSelectionStageFitScalar","imageSelectionRect","imageSelectionStoredState","imagePreviewUpscale","panOrigin","zoomOrigin","isPanningToCenter","currentDistanceToCenter","isPanning","main","storePanAndZoom","pan","zoom","isImageSelectionPanCentered","resetPanAndZoom","zoomAdjust","snapToCenter","updateZoomAdjust","setZoomAdjust","getPanLimitedTranslation","safeRect","gutterScalar","nextRect","nextRectLimited","manipulatePan","panTranslation","nextPan","nextPanLimited","didPan","lastDragInteraction","handleDragStart","handleDrag","nextZoom","nextDistanceToCenter","handleDragRelease","handleDragEnd","interaction","wheelSnapZoomTimer","lastWheelEventTimestamp","wheelFastZoomCounter","wheelFastZoomShouldHandle","didSnap","handleWheel","newTranslation","wheelInterval","isZoomingFast","zoomCenter","currentZoom","nextZoomDistanceToCenter","isZoomingOut","isZoomingToCenter","isZoomingFlick","stageWheelPosition","originSelectionRect","originSelectionRectCenter","zoomedSelectionRect","zoomedSelectionRectCenter","rectTranslation","vectorUpdate","getListenerFunction","toggleZoomWheelInput","togglePanInput","interactableInstance","drag","currentScalar","labelZoomFit","labelZoomActual","av","bv","MIN_SAFE_INTEGER","labelZoomOut","iconZoomOut","labelZoomIn","iconZoomIn","setProperty","CanvasPanAndZoom","window_1$1","create_if_block_1$7","create_if_block_6$1","create_if_block_2$6","div_style_value","create_if_block_7","create_if_block_8","statusmessage","aside","create_if_block_9","statusmessage_changes","statusaside","create_default_slot_4$1","statusaside_changes","create_default_slot_6","create_if_block_11","progressindicator","progressIndicator","progressindicator_changes","create_if_block_10","closeButton","create_default_slot_5$1","iconSupportError","if_block2","t3","t4","canvaspanandzoom","updating_zoomLevel","updating_zoomControls","updating_zoomMultiTouching","create_if_block_5$3","create_if_block_4$5","create_if_block_3$5","create_else_block$2","canvaspanandzoom_zoomLevel_binding","canvaspanandzoom_zoomControls_binding","canvaspanandzoom_zoomMultiTouching_binding","canvaspanandzoom_props","imageSelectionRectElasticity","canvas_changes","canvaspanandzoom_changes","scrollable","scrollElasticity","create_default_slot_1$4","scrollable_changes","create_default_slot_3$1","create_default_slot_2$3","t1_value","tablist","tablist_spread_levels","tablist_props","tablist_changes","utilpanel","updating_component","utilpanel_component_binding_1","utilpanel_props","utilpanel_changes","tabpanels","tabpanels_spread_levels","tabpanels_props","create_default_slot$a","tabpanels_changes","func","utilpanel_component_binding","create_if_block$7","span_style_value","create_fragment$w","OVERLAY_ID","instance$w","isOverlayModeEnabled","showUtils","maxImageDataSize","supportsAnimations","canAnimate","acceptsAnimations","overlayMin","overlayOverlap","overlayLeft","overlayTop","overlayRight","overlayBottom","gradientOverlays","imageTransformsSnapPixels","canUndo","canRedo","utilsFiltered","utilsAvailable","utilsDefined","utilsMerged","utilSelected","utilsVisibleFraction","tabsConfig","shouldRenderTabs","className","horizontalSpace","hasLimitedSpace","verticalSpace","isModal","isCenteredHorizontally","isCenteredVertically","isCentered","isNarrow","isLandscape","isCompact","hasSwipeNavigation","activeUtilTools","navigationHorizontalPreference","navigationVerticalPreference","toolbarVerticalPreference","controlGroupsVerticalPreference","controlTabsVerticalpreference","rootRectDefined","rootElementComputedStyle","envStr","imageCanvasState","hasProps","missingFeatures","isSupportsError","isStartLoadingImageSource","isImageLoadError","isWaitingForImage","imageLoadProgress","isLoadingImageData","isCreatingImagePreview","isProcessingImage","imageLoadShowProgressIndicator","imageLoadStatusLabel","imageProcessStatusLabel","imageProcessProgress","imageProcessShowProgressIndicator","isImageProcessingError","isCustomStatus","isStatusActive","isStatusVisible","hasAside","statusIndent","statusTransform","needsInteractionLock","preventTouchHandler","handleTouchMove","toolbarItems","hasClientRect","canRender","hasImageRedaction","imageRedactionScalar","routePing","isReady","$utilRect","$imageFrame","$imageDecoration","$imageSize","$imageFlipY","$imageFlipX","$imageRotation","$imageAnnotation","$isInteractingFraction","$rootLineColor","$rootForegroundColor","$imagePreview","$imageRedaction","$imageBackgroundColor","$imageScrambler","$pressedKeysStore","$clientRect","$env","$redrawTrigger","$imageProcessingPreparing","$statusOffset","$asideWidth","$statusWidth","$statusOpacity","$wasProcessingImage","$imageVisualLoadComplete","$imageProcessState","$imageLoadState","$imagePreviewSource","$activeImages","$imageProps","$shouldAnimate","$imagePreviewModifiers","$imageTransforms","$pointerHoverable","$pointerAccuracy","$utilTools","$mediaDuration","$previewShouldUpscale","$history","$imageState","$tabRect","$imageFile","$imageOverlayMarkup","$overlayBottomRect","$overlayOpacity","$rootBackgroundColor","$overlayRightRect","$overlayTopRect","$overlayLeftRect","$pixelRatio","$imageSelectionRectPresentation","$stagePadding","$stagePadded","$imageSelectionRectStaticScalar","$imageCropRect","$imageStaticBounds","$imageCropRectIntent","$imageSelectionRectSnapshot","$imageIsStatic","$imageCropRectSnapshot","$presentationScalar","$imageSelectionScalar","$imageSelectionRectIntent","$imageSelectionRectOffset","$prefersReducedMotion","$imageCropAspectRatio","$enablePanInputStore","$enablePanInputProp","$shapePreprocessor","$images","$mediaTrim","$willRequest","$elasticityMultiplierStore","$asideOffset","$asideOpacity","$toolRect","$imageCropLimitToImage","$interfaceImages","$willRequestResource","$imageOverlay","$allowPan","$enablePanInputStatus","$allowZoom","$enableZoomInputStore","$enableZoomControlsProp","$imageSelectionRectCentered","$imageSelectionRectScalar","$disabledTransition","$$unsubscribe_imagePreview","$$unsubscribe_history","eventProxy","layoutMode","util","utils","animations","previewUpscale","previewPad","previewMaskOpacity","markupMaskOpacity","elasticityMultiplier","willRevert","willProcessImage","willRenderCanvas","willRenderToolbar","willSetHistoryInitialState","enableButtonExport","enableButtonRevert","enableNavigateHistory","enableToolbar","enableUtils","enableButtonClose","enableDropImage","enablePasteImage","enableBrowseImage","previewImageDataMaxSize","previewImageTextPixelRatio","layoutDirectionPreference","layoutHorizontalUtilsPreference","layoutVerticalUtilsPreference","layoutVerticalToolbarPreference","layoutVerticalControlGroupsPreference","layoutVerticalControlTabsPreference","markupEditorZoomLevel","markupEditorZoomLevels","markupEditorZoomAdjustStep","markupEditorZoomAdjustFactor","markupEditorZoomAdjustWheelFactor","markupEditorInteractionMode","enableCanvasAlpha","zoomPresetOptions","imagePreviewSrc","imageOrienter","pluginComponents","pluginOptions","pluginInterface","redrawTrigger","elasticityMultiplierStore","registeredPluginsComponents","disabledTransition","glMaxTextureSize","maxTextureSize","fetchSrc","statusText","imageSourceToImageData","imageProxy","proxyStores","publish","proxy","newImage","createImageProxy","imageFile","mediaDuration","mediaTrim","imageProcessState","imageCropRect","imageCropMaxSize","cropRange","imageCropRange","imageCropRectOrigin","imageCropRectAspectRatio","imageOutputSize","imageFlipX","imageFlipY","imageBackgroundImageSrc","imageColorMatrix","imageConvolutionMatrix","imageGamma","imageVignette","imageNoise","imageDecoration","imageAnnotation","imageRedaction","imageFrame","createImageSrcLoader","minDuration","readAsArrayBuffer","inTrack","B","D","A","E","getRotationMetadataInDataView","getVideoFileRotationMetadata","playsInline","getRangeCenter","timer","backgroundImageDataCancelToken","imageBackgroundImageData","$backgroundImageSrc","imageStateUnsub","utilSelectedStore","enablePanInputStore","enableZoomInputStore","enableZoomControlsProp","enablePanInputProp","enablePanInputStatus","rootBackgroundColor","rootForegroundColor","rootLineColor","rootColorSecondary","tabRect","toolRect","utilRect","pointerAccuracy","pointerHoverable","isTransformingImage","isInteractingFraction","animator","shouldAnimate","previewShouldUpscale","imageIsStatic","imageCropRectSnapshot","imageCropRectIntent","imageCropRectPresentation","elasticRect","imageSelectionRectSnapshot","imageSelectionRectIntent","imageSelectionRectOffset","getFrameOutset","presentationRect","stageRecenter","stageRectBase","$stageRecenter","utilOffsetY","prevStagePadding","shouldPadPreview","stagePadding","$shouldPadPreview","$stageRectBase","newStagePadding","stagePadded","utilRectPadded","imageStaticCorners","imageStaticBounds","$imageStaticCorners","rectRotated","imageStaticVisualCorners","rectScaled","rectCentered","imageSelectionScalar","imageSelectionStoredStateReset","imageSelectionRectPresentation","snapPixels","updater","instantUpdate","imageSelectionRectStaticScalar","centerImageStaticBounds","selectionScaledWidth","selectionScaledHeight","childRect","rectOffsetInRect","getImageSelectionRectCentered","stageRectPrev","stageScalePrev","calculateImageSelectionRect","stageRectCurrent","centeredImageSelectionRect","hasSetInitialStageScalar","stageScalarUnsub","stageRectUnsub","imageIsStaticUnsub","isStatic","presentationScalarSnapshot","imageSelectionRectSnapshotUnsub","cropRectClone","imageSelectionRectUnsub","rectAdd","imageCropRectUnsub","imageSelectionRectAspectRatio","imageScalar","presentationScalar","$imageScalar","prevFrameOutset","frameOutset","newFrameOutset","frameHasOutset","$frameOutset","imageOutlineOpacity","imageOutline","$colorOpacity","$rect","$rectScalar","$frameHasOutset","shadeColor","isDarkOutline","frameColor","imageOverlayMarkup","imageOverlay","$imageOutline","overlayOpacity","overlayLeftRect","overlayTopRect","overlayRightRect","overlayBottomRect","imageVisualLoadComplete","imagePreviewSource","imagePreviewLoaderCancelToken","imagePreview","canvasClone","minPreviewLoaderDuration","activeImages","imagePreviewCurrent","imagePreviewModifiers","imageTransforms","$imageCropRectPresentation","$isTransformingImage","imageSelectionRectTranslation","imageScale","viewRect","viewCenter","stageCenter","cropRectBaseCenter","imageTranslation","imageOffset","imageSelectionCenter","imageSelectionOffset","calculateImageTransforms","imageEffects","$colorMatrix","$convolutionMatrix","$gamma","$vignette","$noise","windowWidth","windowHeight","shouldPreventSwipe","major","minor","canPreventNavSwipe","env","initialPixelRatio","handleResolutionChange","resolutionObserver","history","getState","updateSubs","isInteger","undo","newIndex","redo","revert","newState","lastState","newStateEntries","historyCreate","setInitialHistoryState","baseRect","baseCropRect","baseEditorState","editorInitialHistoryState","imageLoadStateUnsub","shouldReset","imageProcessingPreparing","handleExport","shouldProcess","statusOpacity","imageProcessStateUnsub","triggerUpdate","addStore","storeDidUpdate","unshift","storeList","imageTransformsInterpolated","utilTools","imageSelectionMultiTouching","imageSelectionZoomCurrent","utilStores","rangeInputElasticity","utilsUniqueId","utilsVisible","iOS","syncColor","colorArray","colorString","q","exec","hexToRGB","getColorPropertyValue","syncColors","imageProps","$imageEffects","backgroundImageData","updateImagePreviews","currentImageProps","lastImagePreview","loadTimer","wasProcessingImage","statusState","asideOffset","asideOpacity","asideWidth","statusWidth","statusOffset","asideWidthUpdateTimer","handleCloseImageLoadError","handleCloseImageProcessError","handleTouchStart","touches","innerWidth","pressedKeysStore","handleUserFile","isBitmap","handleSelectFile","browseFileSystem","accept","fileInput","handleFileChange","files","browse","scrambledPreviewImage","rootPortal","rootPortalStore","getStageState","foregroundColor","lineColor","utilVisibility","imageAnnotationShapesDirty","decorationShapesDirty","imageDecorationShapesDirty","frameShapesDirty","imageFrameShapesDirty","imageBlendShapesDirty","positionDecorationShape","transformDecorationShape","flattenShapes","flattenedShapes","flattenShape","shapeIsTextEmpty","canvasComputedScale","canvasComputedAnnotationBaseShapes","canvasComputedAnnotationShapes","canvasComputedBlendShapes","canvasComputedDecorationShapes","canvasComputedFrameShapes","canvasComputedSelectionRect","createCanvasState","canvasState","blendShapesToDraw","annotationShapesToDraw","decorationShapesToDraw","interfaceShapesToDraw","frameShapesToDraw","canvasScaleChanged","canvasDirty","alwaysOnTop","imageAnnotationRequiresPreprocessing","canvasComputedInterfaceShapes","plugin","changed","layoutPreference","currentAspectRatio","nextAspectRatio","syncRootAspectRatio","isSupported","overlayMarkupFiltered","markup","utilId","tabIcon","tabLabel","isDisabled","hasToolbar","hasNavigation","imageIntro","resizeInitial","opacityInitial","storeEntries","storeArray","storeSetters","stateCache","calculatedState","addImagePreview","imagesToRemove","labelSupportError","minLoaderDuration","statusLabelLoadImage","statusLabelProcessImage","showProgress","isError","errorCallback","statusLabelButtonClose","statusIconButtonClose","springProps","runSafe","labelClose","iconButtonClose","labelButtonRevert","iconButtonRevert","labelButtonUndo","iconButtonUndo","labelButtonRedo","iconButtonRedo","iconButtonSelectImage","iconButtonExport","imagePreviewData","editorOptions","updateScrambledPreview","route","createPingRouter","propertyName","keyCode","metaKey","ctrlKey","keySet","pressedKey","xPercentage","yPercentage","innerHeight","clipboardData","drawState","Ui","utilPrivateProps","viewPrivateProps","mergeProps","editorProps","pluginProps","propPluginRef","editorEvents","_plugin_finetune_defaults","finetuneControlConfiguration","base","brightness","matrices","contrast","saturation","exposure","temperature","finetuneOptions","finetuneLabelBrightness","finetuneLabelContrast","finetuneLabelSaturation","finetuneLabelExposure","finetuneLabelTemperature","finetuneLabelGamma","finetuneLabelClarity","finetuneLabelVignette","HSVToRGB","create_fragment$v","instance$v","colorValue","ColorPreview","create_if_block_4$4","create_label_slot","colorpreview","colorpreview_changes","create_if_block_2$5","div0_style_value","div1_style_value","div2_style_value","create_if_block_3$4","create_if_block$6","labelColorPalette","create_option_slot$3","create_group_slot","create_if_block_1$6","create_details_slot","create_fragment$u","instance$u","sx","sy","hue","valueAsRGB","valueAsRGBA","valueAsRGBAFullyTransparent","valueAsRGBAFullyOpaque","valueAsRGBAFullySaturated","hidePresetLabel","enableOpacity","enablePresets","enablePicker","updateProps","syncControls","valueAsHSV","RGBToHSV","rgba","updateColorArray","inputPageOffset","offsetX","offsetY","vectorCreateFromPointerEventOffset","ColorPicker","upperCaseFirstLetter","result$1","canCheckFontAvailability","fonts","check","toLocaleFn","localePrefix","mapToSizeOption","createLocaleMapper","toolColorDefault","toolStrokeWidthDefault","toolStrokeColorDefault","toolShapeDefaults","eraser","eraseRadius","rectangle","createToolStyle","inputMode","createToolbarItem","tool","createDefaultColorOptions","transparent","white","silver","gray","black","navy","blue","aqua","teal","olive","green","yellow","orange","red","maroon","fuchsia","purple","createDefaultFontScaleOptions","extraSmall","small","mediumSmall","medium","mediumLarge","large","extraLarge","createDefaultLineHeightScaleOptions","createDefaultStrokeScaleOptions","createDefaultLineEndStyleOptions","createDefaultFontFamilyOptions","createDefaultTextAlignOptions","createDefaultFontStyleOptions","createColorOptions","colors","createFontScaleOptions","scales","createLineHeightScaleOptions","createStrokeScaleOptions","createFontFamilyOptions","createFontStyleOptions","styles","createLineEndStyleOptions","createTextAlignOptions","align","createControlOptions","defaultKey","defaultOptions","someFontsAvailableInStack","stack","createColorControl","labelColor","createSliderControl","FontTestClass","createFontFamilyControl","fontFamilies","shapeTitleFontFamily","testId","getElementById","tester","fontFamilyOption","createBackgroundColorControl","shapeTitleBackgroundColor","createStrokeColorControl","shapeTitleStrokeColor","defaultStrokeWidth","createLineControl","titleKey","createLineStartStyleControl","createLineEndStyleControl","createFontColorControl","shapeTitleTextColor","createFontStyleControl","shapeTitleFontStyle","createFontSizeControl","shapeTitleFontSize","createTextAlignControl","shapeTitleTextAlign","createLineHeightControl","shapeTitleLineHeight","create_fragment$t","instance$t","didMount","Measure","get_footer_slot_changes","get_footer_slot_context","get_main_slot_changes","get_main_slot_context","get_header_slot_changes","get_header_slot_context","create_if_block_2$4","header_slot_template","header_slot","create_if_block_1$5","footer_slot_template","footer","footer_slot","create_fragment$s","main_slot_template","main_slot","main_slot_or_fallback","fallback_block","instance$s","hasHeader","hasFooter","Util","create_if_block$5","create_fragment$r","interactable_action","instance$r","valueMinLimited","valueMaxLimited","barSize","baseFraction","isLimited","rangeMask","labelReset","valueLabel","oninputstart","oninputmove","oninputend","nudgeMultiplier","number","increment","svgSize","svgPadding","createPathCircle","interactionOrigin","interactionRange","interactionReleased","interactionOptions","snap","translatePosition","targetLimited","targetElastic","targetVisual","targetValid","positionToValue","valueToPosition","positionUnsub","currentPosition","updatePosition","positionTarget","svgWidth","indicatorCenter","svgHeight","centerShape","limitedMin","limitedMax","to","getMask","valueAtPosition","vectorCreateFromSize","RangeInput","create_fragment$q","instance$q","overflow","childWidth","childMaxWidth","parentWidth","testOverflow","Toolbar","DirectionRectMap","get_each_context$5","create_each_block$5","div_aria_label_value","div_data_direction_value","div_data_shape_value","create_fragment$p","instance$p","mappedDirections","$selectionOpacity","$selectionScale","selectionScale","selectionOpacity","currentDirection","isCorner","RectManipulator","gesturable","handleGestureStart","handleGestureChange","handleGestureEnd","clean","DirectionInversionTable","getTranslationInfo","translateHorizontally","translateVertically","limitRectDirectionTranslation","anchorDirectionCoordinates","anchorPosition","targetDirectionCoordinates","targetPosition","translateToRight","translateToLeft","translateToTop","translateToBottom","translateAxis","interactionBounds","getInteractionBounds","innerR","inner","outerR","outer","innerL","outerL","innerB","outerB","innerT","outerT","pointerLength","pointerLengthMin","pointerLengthMax","pointerLengthLimited","pointerAspectRatio","pointerScaled","limitedBounds","maxSizeLimitedToBounds","maxSizeLimited","minSizeLimited","applyRectDirectionTranslation","radToDeg","create_fragment$o","rangeinput","rangeinput_changes","instance$o","turns","rotationMin","rotationMax","ImageRotator","createPrintInfo","printWidth","printHeight","inputedSize","createMaxPrintInfo","createRatioInfo","ratioLabel","getRatioLabel","widthLable","heightLable","create_fragment$n","resolutionSpan","ratioPart","spanPrint","spanMaxPrint","resolutionLabel","fullPrint","maxPrint","ratioText","resolutionWidthText","resolutionHeightText","sizePart","instance$n","ImageInfo","create_controls_slot","create_fragment$m","dropdown","dropdown_changes","instance$m","selectedFilterIndex","filterOptions","onfilterchange","getIcon","getCheckmark","mapGroupedOptions","createOptionMapper","CropPresetList","fixVectorPrecision","rectFixPrecision","floatEquals","create_default_slot_2$2","create_header_slot","toolbar","toolbar_changes","create_if_block_5$2","cropLabelButtonRecenter","cropIconButtonRecenter","create_if_block_4$3","rectmanipulator","rectmanipulator_changes","create_if_block_3$3","imageinfo","imageinfo_changes","create_main_slot$1","interactable_function$1","create_if_block$4","create_default_slot_1$3","create_default_slot$9","create_if_block_2$3","imageZoomLevelBase","imageZoomLevelMax","create_if_block_1$4","imagerotator","imagerotator_changes","create_footer_slot$5","create_fragment$l","updating_root","util_root_binding","util_props","util_changes","instance$l","hasCropSelectPresetOptions","cropTools","imageZoomLevelMin","imageSelectionCenteredRect","isImageSelectionDisplayed","isImageSelectionCentered","isResizingSelection","isMaxSelectionRect","isOverlayMode","canZoomToCenter","canCenter","shouldRenderInfoIndicator","shouldRenderImageSelection","shouldRenderImageSelectionRecenterButton","hasPlentyVerticalSpace","shouldRenderPresetSelect","shouldRenderToolbar","couldRenderZoomInput","shouldRenderZoomInput","shouldRenderFooter","footerStyle","$footerOffset","$isActive","$imageSelectionGuides","$utilRectPadded","$imageCropRangeAspectRatio","$imageCropMinSize","$imageCropRange","$imageCropRectOrigin","$imageStaticVisualCorners","$imageCropMaxSize","$imageOutputSize","$selectedPresetIndex","$formattedCropPresetOptions","$elasticityMultiplier","$imageRotationRange","$imageZoomLevelRange","$imageZoomLevel","$recenterOpacity","$recenterOffset","$$unsubscribe_isActive","$$subscribe_isActive","cropImageSelectionCornerStyle","cropWillRenderImageSelectionGuides","interactionFraction","isRotating","rows","cols","cropAutoCenterImageSelectionTimeout","cropEnableZoomMatchImageAspectRatio","cropEnableRotateMatchImageAspectRatio","cropEnableRotationInput","cropEnableZoom","cropEnableZoomInput","cropEnableZoomAutoHide","cropEnableImageSelection","cropEnableInfoIndicator","cropEnableZoomTowardsWheelPosition","cropEnableLimitWheelInputToCropSelection","cropEnableCenterImageSelection","cropEnableButtonRotateLeft","cropEnableButtonRotateRight","cropEnableButtonFlipHorizontal","cropEnableButtonFlipVertical","cropSelectPresetOptions","cropEnableSelectPreset","cropEnableFilterMatchAspectRatio","cropSelectPresetFilter","cropEnableButtonToggleCropLimit","cropWillRenderTools","cropActiveTransformTool","cropMinimizeToolbar","cropInteractionFocus","cropRotationRange","formattedCropPresetOptions","isCustomCrop","turnAspectRatio","applyCropPresetFilter","hasValidRotatedCropAspectRatio","rotatedImageCropAspectRatio","applyRotation","imageSizeRotated","isRotated","imageSelectionRectMinSize","imageSelectionRectMaxSize","translateSelection","directionTranslation","cropAspectRatioLimited","rectIntended","rectOrigin","rectLimitInRect","boundsLimited","boundsIntent","rectLimited","rectTarget","quad","anchorFixed","rectTargetCorner","quadEdges","cornersOrigin","cornersTarget","anchorIndex","getLineIntersectionWithQuad","quadEdge","rayOrigin","cornerDist","intersectionDist","isManipulatingEdge","cornerOrigin","cornerTarget","isDiagonal","pX","pY","getRectLimitedToQuad","translateUp","translateRight","translateLeft","translateDown","couldExceedBounds","cropSizeMax","imageIsRotated","interactionCropRect","interactionCropRectForce","manipulateImage","imageSelectionRectZoomFactor","scaledTranslation","cropIntent","forceTranslation","imageCropRangeAspectRatio","imageZoomLevelRange","rangeMinSize","rangeMaxSize","minZoom","maxZoom","calculateZoomLevel","imageZoomLevel","currentCropWidth","currentCropHeight","currentCropAspectRatio","imageCropMaxRect","resizeImage","rangeWidth","rangeHeight","targetX","targetY","gestureOriginCropRect","handleScaleGesture","zoomHistoryTimeoutId","handleRecenterAction","cropAutoCenterImageSelectionTimeoutId","recenterOpacity","recenterOffset","selectedPresetIndex","$cropAspectRatio","matchedOptionValue","outputSizeMatches","aspectRatioMatches","getAspectRatioBySelectedIndex","selectedValue","imageSelectionGuides","yo","xo","cropUniqueId","stageRef","transformToolInitial","transformSelected","footerOffset","cropIconSelectPreset","cropLabelSelectPreset","optionAspectRatio","maxCropSize","aspectRatioDefined","getSelectionPresetOptionIcon","cropIconCropBoundary","cropLabelCropBoundary","cropLabelCropBoundaryEdge","cropLabelCropBoundaryNone","cropLabelButtonRotateLeft","cropIconButtonRotateLeft","cropLabelButtonRotateRight","cropIconButtonRotateRight","cropLabelButtonFlipHorizontal","cropIconButtonFlipHorizontal","cropLabelButtonFlipVertical","cropIconButtonFlipVertical","overlayMarkup","syncGuides","cropLabelTabZoom","cropLabelTabRotation","currentCropRect","isMinSize","isAtMaxCropSize","newCropRect","selectionOffset","imageSelectionScale","expandedImageSelection","_plugin_crop","create_option_slot$2","measure_handler_1","assign_div0","unassign_div0","FILTER_PREVIEW_CLASS_NAME","create_default_slot$8","create_footer_slot$4","updating_maskFeatherStartOpacity","updating_maskFeatherEndOpacity","updating_maskFeatherSize","scrollable_maskFeatherStartOpacity_binding","scrollable_maskFeatherEndOpacity_binding","scrollable_maskFeatherSize_binding","scrollable_props","create_fragment$k","instance$k","filterOptionsFlattened","$imageColorMatrix","$imageTiles","$isActiveFraction","$imageGamma","$tileRects","$animation","$canvasSize","$$unsubscribe_isActiveFraction","$$subscribe_isActiveFraction","filterFunctions","tileRects","handleTileResize","tileRectFirst","tileCornerRadius","tileElements","tileLeftOpacity","tileRightOpacity","tileMargin","tileScrollContainerRect","tileWrapperOffset","footerRect","tileScrollOffset","imageTiles","cloneImageTile","tile","filterInterfaceImages","filterColorMatrix","getFilterIndex","containerLeft","containerRight","tileRect","tileLeft","tileRight","preview","cloneImageTransforms","_plugin_filter","create_default_slot_2$1","create_default_slot_1$2","create_default_slot$7","rangeinput_spread_levels","rangeinput_props","create_footer_slot$3","create_fragment$j","instance$j","tabSelected","$panelValues","$rangeInputConfig","finetuneNudgePrecision","imageEffectStores","panelValues","rangeInputConfig","_plugin_finetune","get_each_context$2","create_each_block$2","t0_value","create_default_slot$5","create_fragment$e","instance$e","ShapeStyleControls","get_each_context$1","create_each_block$1","shapestylecontrols","shapestylecontrols_changes","create_fragment$d","instance$d","controlKeys","activeControls","currentStyleControlSets","styleControlSets","styleKey","styleKeys","componentCustomProps","getShapeControls","controlSet","getStyleControlSets","ShapeStyleEditor","document_1$1","create_option_slot","create_default_slot$2","create_footer_slot$1","shapestyleeditor","shapestyleeditor_changes","create_fragment$5","instance$5","computedScrollElasticity","frameStyles","frameOptions","markupEditorShapeStyleControls","updateWriteHistoryTimeoutId","selectedFrameIndex","frameActiveStyles","frameBase","shapeGetPropPixelTotal","toPercentage","shapeUpdateProp","shapeUpdateProps","thumb","_plugin_frame","IconCross","CharacterA","_locale_en_gb","labelDefault","labelAuto","labelNone","labelEdit","features","labelWidth","labelSize","labelOffset","labelAmount","labelInset","labelRadius","labelSizeExtraSmall","labelSizeSmall","labelSizeMediumSmall","labelSizeMedium","labelSizeMediumLarge","labelSizeLarge","labelSizeExtraLarge","labelButtonCancel","labelButtonExport","MarkupEditor","shapeLabelButtonSelectSticker","shapeIconButtonSelectSticker","shapeIconButtonFlipHorizontal","shapeIconButtonFlipVertical","shapeIconButtonRemove","shapeIconButtonDuplicate","shapeIconButtonMoveToFront","shapeIconButtonTextLayoutAutoWidth","shapeIconButtonTextLayoutAutoHeight","shapeIconButtonTextLayoutFixedSize","shapeTitleButtonTextLayoutAutoWidth","shapeTitleButtonTextLayoutAutoHeight","shapeTitleButtonTextLayoutFixedSize","shapeTitleButtonFlipHorizontal","shapeTitleButtonFlipVertical","shapeTitleButtonRemove","shapeTitleButtonDuplicate","shapeTitleButtonMoveToFront","shapeLabelInputText","shapeIconInputCancel","shapeIconInputConfirm","shapeLabelInputCancel","shapeLabelInputConfirm","shapeLabelStrokeNone","shapeLabelFontStyleNormal","shapeLabelFontStyleBold","shapeLabelFontStyleItalic","shapeLabelFontStyleItalicBold","shapeTitleCornerRadius","shapeTitleLineStart","shapeTitleLineEnd","shapeTitleStrokeWidth","shapeTitleLineDecorationBar","shapeTitleLineDecorationCircle","shapeTitleLineDecorationSquare","shapeTitleLineDecorationArrow","shapeTitleLineDecorationCircleSolid","shapeTitleLineDecorationSquareSolid","shapeTitleLineDecorationArrowSolid","shapeIconLineDecorationBar","shapeIconLineDecorationCircle","shapeIconLineDecorationSquare","shapeIconLineDecorationArrow","shapeIconLineDecorationCircleSolid","shapeIconLineDecorationSquareSolid","shapeIconLineDecorationArrowSolid","shapeTitleColorTransparent","shapeTitleColorWhite","shapeTitleColorSilver","shapeTitleColorGray","shapeTitleColorBlack","shapeTitleColorNavy","shapeTitleColorBlue","shapeTitleColorAqua","shapeTitleColorTeal","shapeTitleColorOlive","shapeTitleColorGreen","shapeTitleColorYellow","shapeTitleColorOrange","shapeTitleColorRed","shapeTitleColorMaroon","shapeTitleColorFuchsia","shapeTitleColorPurple","shapeTitleTextAlignLeft","shapeTitleTextAlignCenter","shapeTitleTextAlignRight","shapeIconTextAlignLeft","shapeIconTextAlignCenter","shapeIconTextAlignRight","shapeLabelToolMove","shapeLabelToolView","shapeLabelToolSharpie","shapeLabelToolEraser","shapeLabelToolPath","shapeLabelToolRectangle","shapeLabelToolEllipse","shapeLabelToolArrow","shapeLabelToolLine","shapeLabelToolText","shapeLabelToolPreset","shapeIconToolView","shapeIconToolMove","shapeIconToolSharpie","shapeIconToolEraser","shapeIconToolPath","shapeIconToolRectangle","shapeIconToolEllipse","shapeIconToolArrow","shapeIconToolLine","shapeIconToolText","shapeIconToolPreset","linkAccessors","destination","CSS_CLASS_NAME","document_1","window_1","getLineEndParams","isSolid","scaledSizeHalf","solid","sizeHalf","lineEndStyleArrow","anchorRef","tipOffset","inset","arrowOffset","vectorPerpendicular","tipLeft","tipRight","lineEndStyleCircle","lineEndStyleBar","lineEndStyleSquare","safeFactor","toValue","percentage","toPixelValue","frameStyleSolid","frameInset","frameOffset","frameSize","frameRadius","frameRound","frameStyleNine","contextWidth","contextHeight","frameImage","frameSlices","contextSize","outset","outsetDouble","shapeCoordinates","x0","y0","x3","y3","ew","eh","overlap","overlapDouble","cornerGeneric","frameStyleLine","frameAmount","frameSizeValue","frameInsetValue","frameOffsetValue","frameStyleEdge","frameStyleHook","frameLength","frameLengthValue","frameStylePolaroid","borderWidth","chinHeight","borderWidthHalf","createDefaultImageReader","createDefaultImageWriter","markup_editor_defaults","markupEditorToolbar","tools","createToolbar","markupEditorToolStyles","sharpie","arrow","colorOptions","lineEndStyleOptions","fontFamilyOptions","fontStyleOptions","textAlignOptions","strokeWidthOptions","fontSizeOptions","lineHeightOptions","defaultColor","defaultNumber","defaultPercentage","fontStyle_fontWeight","createShapeStyleControls","plugin_finetune_defaults","plugin_filter_defaults","chrome","fade","pastel","cold","warm","monoDefault","monoWash","monoNoir","monoStark","sepiaDefault","sepiaRust","sepiaBlues","sepiaColor","filterLabelChrome","filterLabelFade","filterLabelCold","filterLabelWarm","filterLabelPastel","filterLabelMonoDefault","filterLabelMonoNoir","filterLabelMonoStark","filterLabelMonoWash","filterLabelSepiaDefault","filterLabelSepiaRust","filterLabelSepiaBlues","filterLabelSepiaColor","plugin_frame_defaults","solidSharp","solidRound","lineSingle","lineMultiple","edgeSeparate","edgeCross","edgeOverlap","hook","polaroid","frameLabelMatSharp","frameLabelMatRound","frameLabelLineSingle","frameLabelLineMultiple","frameLabelEdgeCross","frameLabelEdgeSeparate","frameLabelEdgeOverlap","frameLabelCornerHooks","frameLabelPolaroid","locale_en_gb","markup_editor_locale_en_gb","plugin_crop_locale_en_gb","cropLabel","cropIcon","isBoundToImage","plugin_filter_locale_en_gb","filterLabel","filterIcon","plugin_finetune_locale_en_gb","finetuneLabel","finetuneIcon","plugin_annotate_locale_en_gb","annotateLabel","annotateIcon","plugin_frame_locale_en_gb","frameLabel","frameIcon","appendEditor","doctype","warn","core","editor","isDestroyed","plugins","updateImagePreview","getCollapsed","attachEditorView","returned","unsubInit","unsubCore","unsubView","handleEvent","handleEventUnsubs","updateImage","storedHistory","storedState","initEditorView","createDefaultShapePreprocessor","customProcessors","processors","processShape","createShapePreprocessor$1","shapeReadyToParse","createFrameStyleProcessor","edge","nine","createLineEndProcessor","circle","square","bar","handleCustomize","radios","getElementsByName","expectedWidth","expectedHeight","ratioWidth","ratioHeight","inputedRatio","imageCropSize","inputtypeChange","select","setPlugins","cropSelectOptions","createNode","realWidth","realHeight","cropRatio","downloadFile","link","display","download","log"],"sourceRoot":""}